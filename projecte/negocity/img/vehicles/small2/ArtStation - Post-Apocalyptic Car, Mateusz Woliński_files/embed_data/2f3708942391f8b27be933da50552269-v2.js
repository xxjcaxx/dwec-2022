/*! For license information please see 2f3708942391f8b27be933da50552269-v2.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(self,(function(){return(self.webpackChunksketchfab=self.webpackChunksketchfab||[]).push([[5991,1923,1961,6100,223,5998,8805,163,1884,67,9267,8077,2144,7198],{U51L:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("iXW5"),r=i("R4My"),a=i.n(r),o=i("Hjnd"),s=i.n(o),l=i("57NU"),u=i("Bxp5");const h=n.Z.extend({el:['<div class="widget slider-widget">','          <div class="widget-wrapper">','              <div class="bar">','                  <div class="slide">','                      <div class="cursor"></div>',"                  </div>","              </div>","          </div>","      </div>"].join(""),events:(0,l.Z)({},n.Z.prototype.events,{"mousedown .bar":"trackDrag","mousedown .cursor":"cursorDrag","touchstart .bar":"trackDrag","touchstart .cursor":"cursorDrag"}),constructor:function(e,t){t=(0,u.Z)(t||{},{model:new(a().Model),name:"value",minimum:0,maximum:1,step:.01,orientation:"horizontal"}),n.Z.prototype.constructor.call(this,e,t),void 0===this.get()&&this.set(0)},initialize:function(){this.$slide=this.$(".slide"),"vertical"===this.options.orientation&&this.$el.addClass("--vertical"),this.started=!1,this.render()},delegateEvents:function(){n.Z.prototype.delegateEvents.apply(this,arguments),s()(window).on("mousemove.delegateEvents"+this.cid,this.moveEvent.bind(this)),s()(window).on("mouseup.delegateEvents"+this.cid,this.stopEvent.bind(this)),s()(window).on("touchmove.delegateEvents"+this.cid,this.moveEvent.bind(this)),s()(window).on("touchend.delegateEvents"+this.cid,this.stopEvent.bind(this))},undelegateEvents:function(){n.Z.prototype.undelegateEvents.apply(this,arguments),s()(window).off(".delegateEvents"+this.cid)},render:function(){var e=this.options.maximum-this.options.minimum,t=(this.get()-this.options.minimum)/e*100,i={};"vertical"===this.options.orientation?i.height=t+"%":i.width=t+"%",this.$slide.css(i)},startEvent:function(e){e.preventDefault(),this.$el.addClass("fast"),this.started=!0},stopEvent:function(e){this.started&&(e.preventDefault(),this.$el.removeClass("fast"),this.started=!1)},moveEvent:function(e){this.started&&(e.preventDefault(),this.selectEvent(e))},selectEvent:function(e){var t,i;if(e.preventDefault(),"horizontal"===this.options.orientation){var n=this.$el.offset().left,r=this.$el.width();void 0===(i=e.pageX)&&(i=e.originalEvent.touches[0].pageX),t=(i-n)/r}else if("vertical"===this.options.orientation){var a=this.$el.offset().top,o=this.$el.height();(i=e.pageY)||(i=e.originalEvent.touches[0].pageY),t=(a+o-i)/o}t=Math.min(Math.max(0,t),1),t=this.options.minimum+t*(this.options.maximum-this.options.minimum),this.change(t)},cursorDrag:function(e){this.startEvent(e),e.stopPropagation()},trackDrag:function(e){this.startEvent(e),this.moveEvent(e)}})},AFIE:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("U51L"),r=i("57NU"),a=i("Bxp5"),o=i("cA2Q");const s=n.Z.extend({el:['<div class="widget slider-widget volume-slider-widget">','          <div class="widget-wrapper">','              <a class="fa fa-volume-up"></a>','              <div class="bar">','                  <div class="slide">','                      <div class="cursor"></div>',"                  </div>","              </div>","          </div>","      </div>"].join(""),events:(0,r.Z)({},n.Z.prototype.events,{"click .fa":"onoff","touchstart .fa":"onoff"}),constructor:function(e,t){t=(0,a.Z)(t||{},{name:"volume",minimum:0,maximum:1,step:.1}),n.Z.prototype.constructor.call(this,e,t)},initialize:function(){n.Z.prototype.initialize.apply(this,arguments),this.isMute=0===this.get(),this.value=this.get(),this.model.on("change:"+this.options.name,(0,o.Z)(function(){0===this.get()?(this.isMute=!0,this.mute(this.$(".fa"))):this.isMute&&(this.isMute=!1,this.unmute(this.$(".fa")))}.bind(this)))},mute:function(e){e.removeClass("fa-volume-up").addClass("fa-volume-off")},unmute:function(e){e.removeClass("fa-volume-off").addClass("fa-volume-up")},onoff:function(){this.isMute?(0!==this.value&&null!==this.value||(this.value=1),this.model.set("mute",!1),this.set(this.value),this.model.set("playing",!0)):(this.value=this.get(),this.set(0),this.model.set("mute",!0))},cursorDrag:function(){n.Z.prototype.cursorDrag.apply(this,arguments),this.value=null}})},iXW5:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("Hjnd"),r=i.n(n),a=i("57NU"),o=i("di37"),s=i("0jT9"),l=i("QjRD"),u=i("CUTc"),h=i("cWnn");const c=l.Z.extend({mixins:[u.Z,h.Z],el:'<div class="widget"/>',constructor:function(e,t){this.environment=(0,a.Z)({},e?e.environment:{},(t||{}).environment),this.options=t||{},this.collection=this.options.collection,this.model=this.options.model,l.Z.call(this,t)},initialize:function(e){l.Z.prototype.initialize.call(this,e),this.render(),void 0!==this.options.id&&(this.id=this.options.id,this.$el.attr("id",this.id)),void 0!==this.options.className&&(this.className=this.options.className,this.$el.addClass(this.className)),void 0!==this.options.title&&this.$el.attr("title",this.options.title)},$:function(e){var t=this.$el;return this.$el.find(e).filter((function(){return r()(this).parent().closest(".widget").is(t)}))},delegateEvents:function(e){e||(e=(0,o.Z)(this,"events")||{});var t=this.$el;return l.Z.prototype.delegateEvents.call(this,Object.keys(e).reduce(function(i,n){var a=e[n];return(0,s.Z)(a)||(a=this[e[n]]),a?(i[n]=function(e){e&&e.currentTarget&&!r()(e.currentTarget).closest(".widget").is(t)||a.apply(this,arguments)}.bind(this),i):i}.bind(this),{})),this.model&&this.model.on("change",this.modelChangeEvent,this),this},undelegateEvents:function(){return l.Z.prototype.undelegateEvents.apply(this,arguments),this.model&&this.model.off("change",this.modelChangeEvent,this),this},modelChangeEvent:function(){var e=this.options.name,t=e+".",i=!e,n=Object.keys(this.model.changedAttributes()||{}).some((function(i){return i===e||0===i.indexOf(t)}));(i||n)&&this.render()},change:function(e,t){1===arguments.length&&(t=e,e=void 0);var i=!0,n=function(){i=!1},r={target:this,which:e,value:t,preventDefault:n};return this.trigger("change.before",r),!!i&&(this.defaultAction(e,t),this.trigger("change"),!0)},defaultAction:function(e,t){this.set(t)},field:function(e){return this.options.name+(e?"."+e:"")},get:function(e){return this.model.get(this.field(e))},set:function(e,t){return 1===arguments.length&&(t=e,e=void 0),this.model.set(this.field(e),t)},disable:function(){this._disabled=!0,this.$el.addClass("disabled")},enable:function(){this._disabled=!1,this.$el.removeClass("disabled")}},{reify:function(){var e=arguments,t=this,i=function(){t.apply(this,e)};return i.prototype=this.prototype,new i}})},Cx7h:e=>{var t={ApiCoreVersion:"1_0",start:"-",stop:"-",load:"-",gotoAnnotation:"-",getAnnotationList:"-",lookat:"-",setFov:"-",getCurrentTime:"-",play:"-",pause:"-",seekTo:"-",getAnimations:"-",setCurrentAnimationByUID:"-",setCycleMode:"-",setSpeed:"-",getSceneGraph:"-",getNodeMap:"-",getMatrix:"-",setMatrix:"-",hide:"-",show:"-",translate:"-",rotate:"-",getRootMatrixNode:"-",getCameraLookAt:"-",setCameraLookAt:"-",getScreenShot:"-",getMaterialList:"-",getTextureList:"-",addTexture:"-",updateTexture:"-",setTextureQuality:"-",setMaterial:"-",setPostProcessing:"-",getPostProcessing:"-"},i=Object.assign({},t,{getWorldToScreenCoordinates:"-"}),n=Object.assign({},i,{ApiCoreVersion:"1_2",pickColor:"-",setListenerOptions:"-",unselectAnnotation:"-"}),r=Object.assign({},n,{ApiCoreVersion:"1_3",setCameraEasing:"-",showAnnotation:"-",hideAnnotation:"-",getAnnotation:"-",updateAnnotation:"-",createAnnotation:"-",removeAnnotation:"-",pickFromScene:"-",pickFromScreen:"-",addVideoTexture:"-",translate:"-",rotate:"-"}),a=Object.assign({},r,{}),o=Object.assign({},a,{ApiCoreVersion:"1_4",getEnvironment:"-",getLight:"-",getFov:"-",getRootMatrixNode:"-",getShadingStyle:"-",getWireframe:"-",setCurrentAnimationByUID:"-",setEnvironment:"-",setLight:"-",setShadingStyle:"-",setWireframe:"-"}),s=Object.assign({},o,{ApiCoreVersion:"1_5",setAnnotationsTexture:"-",addVideoTexture:"-",gotoAnnotation:"-",setBackground:"-",getBackgroundList:"-",setEnvironment:"-",getEnvironmentList:"-",setCycleMode:"-"}),l=Object.assign({},s,{}),u=Object.assign({},l,{mouseMove:"-",mouseDown:"-",mouseUp:"-",mouseClick:"-",mouseDblClick:"-",mouseWheel:"-",startRecord:"-",endRecord:"-"}),h=Object.assign({},u,{ApiCoreVersion:"1_6",createAnnotationFromScenePosition:"-",createAnnotationFromWorldPosition:"-",getAnimations:"-",hideAnnotationTooltip:"-",removeAllAnnotations:"-",setCameraConstraints:"-",setEnableCameraConstraints:"-",setAnnotationCameraTransition:"-",showAnnotationTooltip:"-",recenterCamera:"-",setUserInteraction:"-"}),c=Object.assign({},h,{ApiCoreVersion:"1_7",setUVOffset:"-",setUVRotation:"-",setUVScale:"-",refreshCanvas:"-",refreshDraw:"-",setHighlightOptions:"-",highlightMaterial:"-"}),A=Object.assign({},c,{setEnableCameraConstraints:"-"}),d=Object.assign({},A,{ApiCoreVersion:"1_8",isLightFeatureEnabled:"-",startAR:"-",hide:"-",focusOnVisibleGeometries:"-",setCameraLookAtEndAnimationCallback:"-",setEnableCameraConstraints:"-",setLightFeatureEnabled:"-",setSpeed:"-",show:"-"}),g=Object.assign({},d,{createAnnotationFromWorldPosition:"-",createAnnotationFromScenePosition:"-",hideAnnotationTooltip:"-",showAnnotationTooltip:"-",hideAnnotationTooltips:"-",showAnnotationTooltips:"-"}),f=Object.assign({},g,{hideAnnotationTooltip:"-",showAnnotationTooltip:"-",hideAnnotationTooltips:"-",showAnnotationTooltips:"-"}),p=Object.assign({},f,{ApiCoreVersion:"1_9",hideAnnotationTooltip:"-",showAnnotationTooltip:"-",hideAnnotationTooltips:"-",removeTexture:"-"}),m=Object.assign({},p,{ApiCoreVersion:"1_10",createMaterial:"-",assignMaterial:"-",createDecal:"-",destroyDecal:"-",pickFromTextureCoordinates:"-",findDecalFromWorldPosition:"-"}),_=Object.assign({},m,{pickFromTextureCoordinates:"-",findDecalFromWorldPosition:"-"});e.exports={"1.0.0":t,"1.0.1":t,"1.0.2":t,"1.0.3":t,"1.1.0":i,"1.2.0":n,"1.2.1":n,"1.3.0":r,"1.3.1":a,"1.4.0":o,"1.4.1":o,"1.4.2":o,"1.5.0":s,"1.5.1":l,"1.5.2":u,"1.6.0":h,"1.7.0":c,"1.7.1":A,"1.8.0":d,"1.8.1":g,"1.8.2":f,"1.9.0":p,"1.10.0":m,"1.10.1":_}},dcVb:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("QLbI");const r=function(e,t){if(window.parent){var i={type:"api.ready",instanceId:n.ZP.string("api_id",void 0),error:e,httpStatus:t};window.parent.postMessage(i,function(e){if(!e||!e.length)return"*";var t=e.split("//");return t[0]+"//"+t[1].split("/")[0]}(document.referrer))}}},r4hN:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("57NU"),r=i("gmtI"),a=i("0RVg"),o=i("/VXM"),s=i("qVk2"),l=i("7olf"),u=i("W8Jb");const h=a.Z.extend((0,n.Z)({optionTypes:{modelUid:o.Z.string},model:r.Z,url:function(){return(0,u.Z)("textures",this.options.modelUid,this.options.checkPrefetch)},comparator:function(e,t){return"None"===e.get("label")?-1:"None"===t.get("label")?1:(0,s.Z)(e.get("label"),t.get("label"))},isValid:function(){this.each((function(e){e.isValid()}))},getImageFromURL:function(e){var t=e.split("/").pop();return this.find((function(e){var i=!1;return e.get("images").forEach((function(e){i||-1!==e.url.indexOf(t)&&(i=!0)})),i}))}},l.Z))},"7olf":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("3r8u");const r={addNewImage:function(e){if(!this.model)throw new Error("This collection must implement a model.");var t,i=e.uid;i?t=i.replace(/tmp_/,""):i="tmp_"+(t=e.id||(0,n.Z)());var r=new this.model({images:[{uid:i,url:e.url,width:e.width,height:e.height}],uid:i,id:t,name:e.name||"newImage",imageFile:e.imageFile,internal:e.internal});return this.set(r,{merge:!0,add:!0,remove:!1}),r}}},ZSSq:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i("DF+G"),r=i.n(n),a=i("Hjnd"),o=i.n(a);function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){r()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e){return{name:"PreventPageScroll",constructor:function(){this.events=function(e,t){var i,n={},r=e?" "+e:"";return n["wheel"+r]=function(e){var t=-1/4*e.originalEvent.wheelDelta;t&&(e.preventDefault(),o()(e.currentTarget).scrollTop(t+o()(e.currentTarget).scrollTop()))},n["touchstart"+r]=function(e){i=e.originalEvent.touches[0].pageY},n["touchmove"+r]=function(e){e.preventDefault();var t=i-e.originalEvent.touches[0].pageY;i=e.originalEvent.touches[0].pageY,o()(e.currentTarget).scrollTop(t+o()(e.currentTarget).scrollTop())},l(l({},t),n)}(e,this.events)}}}},xPSL:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("dutp"),r=i.n(n),a=i("rhtQ"),o=i.n(a),s=i("65jS"),l=i("Oyie");function u(e){var t=o()(e.find(".image-container"));return new l((function(e){window.requestAnimationFrame((function(){t.forEach((function(e){e.classList.remove("--loading")})),e()}))}))}const h={name:"WithImageContainers",afterRender:function(){var e,t;(e=this.$el,t=o()(e.find(".image-container .image-container__image")).map((function(e){return[e.getAttribute("data-background"),e]})).filter((function(e){return!!r()(e,1)[0]})).map((function(e){var t=r()(e,2),i=t[0],n=t[1];return n.removeAttribute("data-background"),new l((function(e,t){var r=(0,s.jo)(n,(function(a){a&&(r(),(0,s.po)(i).then((function(){n.style.backgroundImage="url(".concat(i,")"),e()})).catch((function(){t("Image failed to load on scroll")})))}),{margin:200})}))})),l.all(t).then((function(){return e}))).then(u)}}},Usly:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("DF+G"),r=i.n(n),a=i("Hjnd"),o=i.n(a),s=i("0jT9"),l=i("9HWo"),u=i("hDWi"),h=Symbol("windowCallbackKey");const c={name:"WithWindowEvents",constructor:function(){var e=this;this[h]={listeners:[]},this.events=(0,l.iE)(this.events,(function(t,i){var n=(0,u.L0)(i);if("window"!==n.selector)return r()({},i,t);if("string"==typeof t&&!e[t])throw new Error("WithWindowEvents error: "+e.displayName+"."+t+" is not defined.");return e[h].listeners.push({eventName:n.eventName,callback:function(){for(var i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(0,s.Z)(t)?t.call.apply(t,[e].concat(r)):(i=e[t]).call.apply(i,[e].concat(r))}}),{}}))},delegateEvents:function(){this[h].listeners.forEach((function(e){o()(window).on(e.eventName,e.callback)}))},undelegateEvents:function(){this[h].listeners.forEach((function(e){o()(window).off(e.eventName,e.callback)}))},beforeRemove:function(){this[h].listeners.forEach((function(e){o()(window).off(e.eventName,e.callback)}))}}},BTkA:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("30e2"),r=i.n(n),a=i("Hjnd"),o=i.n(a),s=i("ydx7"),l=i("BW0+"),u=i("l0U/"),h=i("qKlK");const c=s.Z.extend({save:function(e,t){null!=e&&"object"!==r()(e)||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile")),i.append("modelUid",t.modelUID),o().ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"})},endpoint:function(){return"/backgrounds".concat(this.isNew()?"":"/".concat(this.get("uid")))}},(0,u.Z)({fileTypes:h.Z.backgroundFiletypes,maxFileSize:h.Z.maxBackgroundFilesize})).extend(l.Z)},qGIA:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("l0U/"),r=i("UNIa"),a=i("sa1k"),o=i("qKlK"),s=i("ydx7"),l=i("rRD0"),u=i("Oyie");const h=s.Z.extend({endpoint:function(){return"/environments/".concat(this.get("uid"))},checkStatusAndRetry:function(){var e=this;return a.Z.retry(1/0,(function(){return r.Z.getEnvironmentProcessingStatus(e.get("uid"),{allowPrefetching:!1}).then((function(e){return e||u.reject(new l.Ms)})).then((function(e){return["SUCCEEDED","FAILED"].includes(e.processing.toUpperCase())?e:u.reject(new l.Ms)}))}),{interval:1e4}).catch((function(){return{processing:"FAILED",error:"The server failed to answer in time"}}))}},(0,n.Z)({fileTypes:o.Z.environmentFiletypes,maxFileSize:o.Z.maxEnvironmentFilesize}))},BTJo:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A});var n=i("30e2"),r=i.n(n),a=i("R4My"),o=i.n(a),s=i("Hjnd"),l=i.n(s),u=i("ydx7"),h=i("Z10h"),c=i("Oyie");const A=u.Z.extend({defaults:function(){return{name:"",content:"",position:[0,0,0],eye:[0,0,0],target:[0,0,0],lastComputedScenePosition:[0,0,0],lastComputedWorldPosition:[0,0,0],uidImage:void 0,imageFile:void 0,preview:"",hovered:!0,geometryUid:-1,indices:[-1,-1,-1],barycentricWeights:[0,0,0],localPosition:[0,0,0],visible:!0}},endpoint:function(){return"/hotspots".concat(this.isNew()?"":"/".concat(this.get("uid")))},remove:function(){return c.resolve(o().ajax({type:"DELETE",url:this.url()}))},appendArray:function(e,t,i){for(var n=0,r=i.length;n<r;++n)e.append(t,i[n])},_dumpOptions:function(){return{eye:this.get("eye").toString(),target:this.get("target").toString(),position:this.get("position").toString(),content:this.get("content").raw,name:this.get("name"),imFile:this.get("imFile")}},registerOptions:function(){this._lastOptions=this._dumpOptions()},hasChangedOptions:function(){if(!this._lastOptions)return!0;var e=this._dumpOptions(),t=this._lastOptions;for(var i in t)if(t[i]!==e[i])return!0;return!1},save:function(e,t){var i=this._lastOptions;if(!this.hasChangedOptions())return c.resolve();this.registerOptions(),null!=e&&"object"!==r()(e)||(t=e);var n=this.isNew(),a=new FormData,o=this.get("imageFile");void 0===this.get("uidImage")&&o&&a.append("imageFile",o),a.append("model",t.modelUID),a.append("name",(0,h.sanitize)(this.get("name")));var s=this.get("content").raw;a.append("content",null!==s?s:""),this.appendArray(a,"eye",this.get("eye")),this.appendArray(a,"target",this.get("target")),this.appendArray(a,"position",this.get("position"));var u=this,A=l().ajax({type:n?"POST":"PATCH",url:this.url(),data:a,cache:!1,contentType:!1,processData:!1,success:function(e){n&&(u.set("uid",e.uid),e.images.length>0&&u.set("uidImage",e.images[0].uid))},error:function(e){this._lastOptions=i,console.error(e.stack)}.bind(this)});return c.resolve(A)},_validate:function(e,t){return(t=t||{}).validate=!0,u.Z.prototype._validate.call(this,e,t)},validate:function(e){var t=e.eye,i=e.target,n=i[0]-t[0],r=i[1]-t[1],a=i[2]-t[2],o=Math.sqrt(n*n+r*r+a*a);if(o<=1e-8)return i[0]=e.position[0],i[1]=e.position[1],i[2]=e.position[2],!1;if(o<=.001){var s=.01/o;i[0]=t[0]+n*s,i[1]=t[1]+r*s,i[2]=t[2]+a*s}return!1}})},"BW0+":(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("58Pd"),r=i("uuWb"),a=i("5Cxy"),o=i("2fWj"),s=r.Z.osg,l=function(e,t,i,n){var r=i-e,a=n-t;return r*r+a*a},u=function(e){return o.Z.isPowerOf2(e.width)&&o.Z.isPowerOf2(e.height)};const h={isVideoURL:function(e){var t=e.split("."),i=t[t.length-1].toLowerCase();return"ogv"===i||"ogg"===i||"mp4"===i||"avi"===i||"webm"===i},isVideo:function(){return this.isVideoURL(this.get("images")[0].url)},getUID:function(){return this.get("uid")},getImages:function(){return this.get("images")},getURL:function(){console.error("dont call ImageSet.getURL")},filterPng:function(e,t){var i=e[0];if(!i)return e;for(var r=1;r<e.length;++r)if(e[r].width===i.width&&e[r].height===i.height)return(0,n.Z)(e,(function(e){return e.url.endsWith(".png")===t}));return e},findFormat:function(e){var t=(0,n.Z)(this.get("images"),(function(t){return!t.options||t.options.format===e}));return"N"===e&&(0,a.Z)().preferOriginalNormalMap?this.filterPng(t,!0):t},getFilteredImages:function(e){if(!e||!(0,a.Z)().imageCompression)return this.findFormat();var t;switch(e){case s.Texture.ALPHA:if((t=this.findFormat("A")).length>0)return t;break;case s.Texture.RGB:if((t=this.findFormat("RGB")).length>0)return t;if((t=this.findFormat("N")).length>0)return t;break;case s.Texture.LUMINANCE:if((t=this.findFormat("R")).length>0)return t;if((t=this.findFormat("RGB")).length>0)return t;if((t=this.findFormat("N")).length>0)return t}return this.findFormat()},findImageNearestPowerOfTwoUpToResolution:function(e,t,i){return this.findImageNearestUpToResolution(e,t,!0,i)},findImageNearestUpToResolution:function(e,t,i,n){for(var r,a,o=1/0,s=!1,h=1/0,c=this.getFilteredImages(n),A=0,d=c.length;A<d;++A){var g=c[A],f=l(e,t,g.width,g.height);if(f<o&&(o=f,r=g),!(g.width>e||g.height>t))if(i){var p=u(g);s&&!p||(!a||!s&&p||f<h||h===1/0&&g.width>a.width&&g.height>a.height)&&(a=g,s=p,h=f)}else(!a||f<h||h===1/0&&g.width>a.width&&g.height>a.height)&&(a=g,h=f)}return a||r},findImageSmallest:function(e){return this.findImageNearestToResolution(0,0,e)},findImageWidget:function(){return this.findImageNearestToResolution(0,0,s.Texture.RGB)},findImageNearestToResolution:function(e,t,i){for(var n,r=1/0,a=this.getFilteredImages(i),o=0,s=a.length;o<s;++o){var u=a[o],h=l(e,t,u.width,u.height);h<r&&(r=h,n=u)}return n}}},ofNU:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A});var n=i("30e2"),r=i.n(n),a=i("Hjnd"),o=i.n(a),s=i("ydx7"),l=i("BW0+"),u=i("l0U/"),h=i("qKlK"),c=i("Oyie");const A=s.Z.extend({endpoint:function(){return"/matcaps".concat(this.isNew()?"":"/".concat(this.get("uid")))},save:function(e,t){null!=e&&"object"!==r()(e)||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile"),this.get("name")),i.append("modelUid",t.modelUID),c.resolve(o().ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"}))},getProxyImage:function(){var e=this.findImageSmallest();return e||console.error("MISSING IMAGE DATA!"),{label:this.get("name"),value:this.get("uid")||this.get("id"),image:e.url,imageModel:this,deletable:!this.get("isDefault")}}},(0,u.Z)({fileTypes:h.Z.matcapFiletypes,maxFileSize:h.Z.maxMatcapFilesize})).extend(l.Z)},"W+BB":(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i("30e2"),r=i.n(n),a=i("R4My"),o=i.n(a),s=i("k2rr"),l=i("qKlK"),u=i("l0U/"),h=i("pUXo"),c=i("20m0"),A=i("Oyie");const d=s.Z.extend({getModelOptionPath:function(){return"#.definitions.soundtrack"},getName:function(){return"Soundtrack"},initDefaults:function(e){var t=this._flattenObject(e,this._typeMap);this.set((0,h.Z)(t,this.attributes)),this.get("uid")||this.set("uid","tmp_"+this.get("cid"))},defaults:function(){return{cid:this.cid,lastComputedScenePosition:[0,0,0],lastComputedWorldPosition:[0,0,0]}},isNew:function(){var e=this.get("uid");return void 0===e||!(!e||!e.toString().startsWith("tmp_"))},makeUrl:function(){return c.Z.domain+"/sounds".concat(this.isNew()?"":"/".concat(this.get("uid")))},duplicate:function(){var e=new this.constructor;return e.setJSON(this.getJSON()),e.set("name",this.get("name")),e.set("url",this.get("url")),e.set("files",this.get("files")),e},save:function(e,t){if(!this.isNew())return A.resolve();null!=e&&"object"!==r()(e)||(t=e);var i=new FormData;i.append("soundFile",this.get("files")[0]),i.append("name",this.get("name")),i.append("model",t.modelUID);var n=this;return A.resolve(o().ajax({type:"POST",url:this.makeUrl(),data:i,processData:!1,contentType:!1})).then((function(e){n.set("uid",e.uid)}))}},(0,u.Z)({fileTypes:l.Z.soundFiletypes,maxFileSize:l.Z.maxSoundFilesize}))},gmtI:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("30e2"),r=i.n(n),a=i("Hjnd"),o=i.n(a),s=i("ydx7"),l=i("BW0+"),u=i("Oyie");const h=s.Z.extend({defaults:{colorSpace:"unknown"},endpoint:function(){return"/textures".concat(this.isNew()?"":"/".concat(this.get("uid")))},isValid:function(){var e=this.get("name");return void 0===e&&console.warn("no name for Texture "+this.id),e=e||this.id,void 0===this.get("images")&&console.warn("no images for Texture "+e),void 0===this.get("uid")&&console.warn("no uid for Texture "+e),!0},save:function(e,t){null!=e&&"object"!==r()(e)||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile"),this.get("name")),i.append("colorSpace",this.get("colorSpace")),i.append("modelUid",t.modelUID),u.resolve(o().ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"}))},saveColorspace:function(){return u.resolve(o().ajax({url:this.url(),data:{colorSpace:this.get("colorSpace")},type:"PATCH"}))}}).extend(l.Z)},"98X6":(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("30e2"),r=i.n(n),a=i("ydx7"),o=i("UNIa");const s=a.Z.extend({save:function(e,t){return null!=e&&"object"!==r()(e)||(t=e),o.Z.createThumbnail({imageFile:this.get("imageFile"),source:this.get("source"),modelUid:t.modelUID})},endpoint:function(){return"/thumbnails"}})},"l0U/":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("5sFf"),r=i("WeWI");function a(e){var t={fileTypes:function(e,t){var i=t.name.replace(/^.*\.([^.]*)$/,"$1").toLowerCase();if(!(-1!==e.indexOf(i)))return{type:"fileTypes",message:"<p>Unsupported format. Please upload a "+e.join(", ").toUpperCase()+".</p>"}},maxFileSize:function(e,t){if(!(t.size<e)){var i=Math.floor(e/1024/1024)+"MB",n=Math.ceil(t.size/1024/1024)+"MB";return{type:"maxFileSize",message:r.Z.getFromString('<p>The {{ fileName | default("selected") }} image file size is too large. The maximum file size is {{ maxSizeLabel}} (your file is {{ currentSizeLabel }}).<p/>',{fileName:t.name,maxSizeLabel:i,currentSizeLabel:n})}}}},i={fileTypes:"<p>The file type you tried to upload is not currently supported by Sketchfab.</p>",maxFileSize:'        <p>To reduce your file size, you can:</p>        <ul class="--disc">            <li>resize your image to a lower resolution.</li>            <li>use a more efficient file format like JPEG.</li>            <li>reduce the JPEG quality.</li>        </ul>        '};return{name:"Validator",validateFile:function(i,r){if(null==e)return console.error("Ruleset not defined");var a,o=[];return(0,n.Z)(e,(function(e,n){(a=t[n](e,i))&&o.push(a)})),r?o.length>0?o:void 0:this.concatErrorMessages(o)},concatErrorMessages:function(e){return e.reduce((function(e,t){return e.concat(e,t.message)}),"")},getExtraErrorInformation:function(e){return i[e]}}}},"6bX3":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("HS/+"),r=i("9HWo");const a=n.Z.extend({displayName:"PureComponent",shouldViewUpdate:function(e,t){return!(0,r.w8)(this.options,e)||!(0,r.w8)(this.state,t)}})},J7eK:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>a});var n=function(e){var t=0;return e<.0031308?e>0&&(t=12.92*e):t=1.055*Math.pow(e,1/2.4)-.055,t},r=function(e){var t=0;return e<.04045?e>=0&&(t=e*(1/12.92)):t=Math.pow((e+.055)*(1/1.055),2.4),t};const a={linearToSrgb1:n,srgbToLinear1:r,linearToSrgb:function(e,t){var i=t||new Array(e.length);return i[0]=n(e[0]),i[1]=n(e[1]),i[2]=n(e[2]),i.length>3&&e.length>3&&(i[3]=e[3]),i},srgbToLinear:function(e,t){var i=t||new Array(e.length);return i[0]=r(e[0]),i[1]=r(e[1]),i[2]=r(e[2]),i.length>3&&e.length>3&&(i[3]=e[3]),i},encodeRGBM:function(e,t,i){i[3]=Math.min(1,Math.max(e[0]/t,i[1]/t,i[2]/t,1e-6)),i[3]=Math.ceil(255*i[3])/255;var n=1/(t*i[3]);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i},decodeRGBM:function(e,t,i){var n=t*e[3];return i[0]=n*i[0],i[1]=n*i[1],i[2]=n*i[2],i},rgbToHex:function(e){var t=Math.round(255*e.r),i=Math.round(255*e.g);return"#"+(16777216|Math.round(255*e.b)|i<<8|t<<16).toString(16).substr(1)}}},lVmk:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("lZH+"),r=i.n(n);function a(){var e={},t=new(r())((function(t,i){e.resolve=t,e.reject=i}));return t.resolve=e.resolve,t.reject=e.reject,t.promise=t,t}},hDWi:(e,t,i)=>{"use strict";i.d(t,{PF:()=>a,UW:()=>o,L0:()=>s,wv:()=>l,eF:()=>u,QG:()=>A,IO:()=>d});var n=i("/HjK"),r=i("W5nl");function a(e){return e.preventDefault(),e}function o(e){return e.stopPropagation(),e}function s(e){return{eventName:e.split(" ")[0],selector:e.split(" ").slice(1).join(" ")}}function l(e){var t=e.originalEvent||e;return{x:t.type.match(/^touch/)?t.changedTouches[0]?t.changedTouches[0].pageX:0:t.clientX,y:t.type.match(/^touch/)?t.changedTouches[0]?t.changedTouches[0].pageY:0:t.clientY}}function u(e,t){return t.velocity=function(e,t){var i=l(t),n=e?l(e):i;return{x:i.x-n.x,y:i.y-n.y}}(e,t),t}var h=function(e){var t=l(e),i=t.x,n=t.y;return e.dragX=i,e.dragY=n,e},c=function(e,t,i){return function(a){var o=!1,s=!1,l=(0,n.Z)((0,r.Rp)(u,void 0,(function(e){o=!0,s||i.onDrag(h(e))})),16);window.addEventListener(e,l),window.addEventListener(t,(function n(r){s=!0,o&&i.onDragEnd(h(r)),window.removeEventListener(e,l),window.removeEventListener(t,n)})),i.onDragStart(h(a))}},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onDrag,i=e.onDragStart,n=void 0===i?function(e){return e}:i,r=e.onDragEnd,a=void 0===r?function(e){return e}:r;return{onMouseDown:c("mousemove","mouseup",{onDrag:t,onDragStart:n,onDragEnd:a}),onTouchStart:c("touchmove","touchend",{onDrag:t,onDragStart:n,onDragEnd:a})}},d=function(e){return function(t){13===function(e){return e.which||e.keyCode}(t)&&e(t)}}},"2kHV":(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i("Hjnd"),r=i.n(n),a=i("qKlK"),o=i("Oyie"),s=["<script>","  (function(d, s, id){","     var js, fjs = d.getElementsByTagName(s)[0];","     if (d.getElementById(id)) {return;}","     js = d.createElement(s); js.id = id;",'     js.src = "//connect.facebook.net/en_US/sdk.js";',"     fjs.parentNode.insertBefore(js, fjs);",'   }(document, "script", "facebook-jssdk"));',"<\/script>"].join(""),l=null;const u={getSDK:function(){return window.FB?o.resolve(window.FB):l||(l=new o((function(e){var t=r()(s);r()("body").append(t),window.fbAsyncInit=function(){window.FB.init({appId:a.Z.facebookAppId,status:!0,cookie:!0,xfbml:!0,version:a.Z.facebookApiVersion}),e(window.FB)}})))}}},WTdA:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var n=i("tOkR"),r=i("Bxp5"),a=i("57NU"),o=i("N6Kc"),s=i("Hjnd"),l=i.n(s),u=i("R4My"),h=i.n(u),c=i("jpNh"),A=function(e,t){if(Array.isArray(e))this.shortcuts=e||[];else{if(!(0,n.Z)(e))throw new Error("Shortcut manager needs a shortcut object to function");this.shortcutGroup=e,this.shortcuts=e.shortcuts||[]}this.options=t||{},this.handlers={},this.options=(0,r.Z)({},this.options,{listen:!1}),this.options.listen&&this.listen()},d=new(i.n(c)());d.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&("button"===document.activeElement.tagName.toLowerCase()||("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.contentEditable&&"true"===t.contentEditable))},(0,a.Z)(A.prototype,h().Events),A.prototype.listen=function(e){void 0===e?this.shortcuts.forEach(this._listen.bind(this)):Array.isArray(e)?(this.shortcuts=this.shortcuts.concat(e),e.forEach(this._listen.bind(this))):this._listen(e)},A.prototype.stopListening=function(e){e.forEach(function(e){d.unbind(this._getShortcut(e).keyCombinations),delete this.handlers[e]}.bind(this))},A.prototype.getTitle=function(){return this.shortcutGroup&&this.shortcutGroup.name||""},A.prototype.getShortcut=function(e){return this.shortcuts.filter((function(t){return t.id===e}))[0]||""},A.prototype.getShortDescriptionById=function(e){var t="";return this.shortcuts.forEach(function(i){i.id===e&&(t=this._formatKeyCombination(i.keyCombinations).replace("<br />",""))}.bind(this)),t},A.prototype.generateHelpSection=function(){var e=l()("<div />"),t=this.getTitle();return t&&e.append('<span class="title">'+t+"</span>"),this.shortcuts.filter(this._validate).forEach(function(t){t.name&&e.append("<b>"+t.name+"</b>"),e.append(this._formatKeyCombination(t.keyCombinations))}.bind(this)),e.html()||""},A.prototype.hasKeyCombination=function(e){var t=!1;return this.shortcuts.forEach((function(i){t||(Array.isArray(i.shortcuts)?i.shortcuts.forEach((function(i){t=i===e})):t=i.shortcuts===e)})),t},A.prototype._formatKeyCombination=function(e){return[].concat(e).map((function(e){return"<kbd>"+e+"</kbd>"})).join(" or ")+"<br />"},A.prototype._listen=function(e){this._validate(e)&&!this.handlers[e.id]&&(this.handlers[e.id]=this._notify.bind(this,e),d.bind(e.keyCombinations,this.handlers[e.id]))},A.prototype._getShortcut=function(e){return(0,o.Z)(this.shortcuts,(function(t){return t.id===e}))},A.prototype._validate=function(e){return!!e.keyCombinations&&!!e.id},A.prototype._notify=function(e,t){this.trigger(e.id,e,t)};const g=A},cA2Q:(e,t,i)=>{"use strict";function n(e){var t=Array.prototype.slice.call(arguments,1),i=e.bind.apply(e,t);return i(),i}i.d(t,{Z:()=>n})},W1n1:(e,t,i)=>{"use strict";var n=i("lZH+");i.n(n)().config({warnings:!1,longStackTraces:!1,cancellation:!0,monitoring:!1})},gQUg:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=function(e){var t,i=window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder;t=e.split(",")[0].indexOf("base64")>=0?window.atob(e.split(",")[1]):window.decodeURI(e.split(",")[1]);for(var n,r=e.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),o=new Uint8Array(a),s=0;s<t.length;s++)o[s]=t.charCodeAt(s);if(void 0!==window.Blob)n=new Blob([o],{type:r});else if(void 0!==i){var l=new i;l.append(a),n=l.getBlob(r)}return n}},W8Jb:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("ELsZ"),r=i("59ul"),a="";(0,r.Z)()||(0,n.Z)()||(a+="?optimized=1");const o=function(e,t,i){var n="/i/models/"+t;if(e&&(n+="/"+e+a),i&&!window.prefetchedData[n])throw console.error("Missing prefetch "+n),new Error("Missing prefetch "+n);return n}},n0Kg:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n,r=i("5Cxy"),a=[{type:"VERTEX_SHADER",text:["attribute vec3 aPosition;","void main() {","gl_Position = vec4(aPosition, 1.0);","}"].join("\n")},{type:"FRAGMENT_SHADER",text:["#version 100","#ifdef GL_FRAGMENT_PRECISION_HIGH","  precision highp float;","#else"," precision mediump float;","#endif","uniform sampler2D uT0;","uniform sampler2D uT1;","uniform sampler2D uT2;","uniform sampler2D uT3;","uniform ivec4 uR;","varying vec2 vT;","varying vec3 vC;","varying vec3 vColor;","varying vec4 vColor2;","void f(in vec3 a, out vec3 b) {","b = 2.0 * a;","}","#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055","#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)","float linearTosRGB(const in float color) { return LIN_SRGB(color); }","vec3 linearTosRGB(const in vec3 color) { return vec3(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b)); }","vec4 linearTosRGB(const in vec4 color) { return vec4(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b), color.a); }","void main(void) {","vec4 col;","col.r = linearTosRGB(vColor2.r);","col.rgb = linearTosRGB(vColor);","f(vC, col.xyz);","if ( uR.x == 3 ) {","  col.rgb = texture2D( uT0, vT ).aaa;","  col.a = uR.y == 0 ? texture2D( uT1, vT ).r : texture2D( uT1, vT ).a;","} else if ( uR.x == 2 ) {","  col.rgb = texture2D( uT0, vT ).rgb;","  col.a = uR.y == 0 ? texture2D( uT1, vT ).r : texture2D( uT1, vT ).a;","} else {","  col.r = uR.x == 0 ? texture2D( uT0, vT ).r : texture2D( uT0, vT ).a;","  col.g = uR.y == 0 ? texture2D( uT1, vT ).r : texture2D( uT1, vT ).a;","  col.b = uR.z == 0 ? texture2D( uT2, vT ).r : texture2D( uT2, vT ).a;","  col.a = uR.w == 0 ? texture2D( uT3, vT ).r : texture2D( uT3, vT ).a;","}","gl_FragColor = gl_FrontFacing ? vec4(col.rgb, 1.0) : col;","}"].join("\n")}];function o(e){var t=e&&e.getExtension("WEBGL_lose_context");return t&&t.loseContext(),!0}function s(){if(void 0!==window.sketchfabWebGLSupport)return window.sketchfabWebGLSupport;if(n=!1,window.sketchfabWebGLSupport=n,!window.Set||!window.Map||!window.Uint8ClampedArray)return!1;var e=null;try{var t=["webgl","experimental-webgl"],i={antialias:!1},s=document.createElement("canvas");if(!s||!s.getContext)return!1;for(var l=0;l<t.length&&!(e=s.getContext(t[l],i));l++);if(!(e&&e.getParameter&&e.getExtension&&e.getShaderPrecisionFormat))return o(e)&&!1;var u=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);if(!u||u<64)return o(e)&&!1;var h=e.getParameter(e.MAX_VARYING_VECTORS);if(!h||h<8)return o(e)&&!1;var c=e.getExtension("WEBGL_debug_renderer_info");if(c&&"Google SwiftShader"===e.getParameter(c.UNMASKED_RENDERER_WEBGL)&&!(0,r.Z)().allowSwiftShader)return o(e)&&!1;n=a.every((function(t){return function(e,t,i){var n=t;"string"==typeof n&&(n=e[t]);var r=e.createShader(n);return e.shaderSource(r,i),e.compileShader(r),!(!e.getShaderParameter(r,e.COMPILE_STATUS)&&!e.isContextLost()&&(console.warn("Could't compile shader "+i),console.warn(e.getShaderInfoLog(r)),console.warn("You may want to consider a browser that fully supports WebGL."),1))}(e,t.type,t.text)})),o(e)}catch(t){return o(e)&&!1}return window.sketchfabWebGLSupport=n,n}},ELsZ:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=!1;const r=function(e){return void 0!==e&&(n=e),n}},b5Bu:(e,t,i)=>{"use strict";i.d(t,{d:()=>r,Z:()=>a});var n=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"),r=n&&navigator.userAgent.match("Version/15.0 Safari");const a=n},p5Kp:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("qKlK"),r=i("cgbd"),a=i("XF2a");const o={showPopup:function(){var e=a.n2.store.getState(),t=a.wl.authUser.canAccessFeature("ff_read_only_mode",e),i="?utm_source=website&utm_campaign=maintenance_error",o=new r.Z({title:t?"Maintenance":"Error",text:t?'Sketchfab is undergoing maintenance.<br>See: <a href="https://forum.sketchfab.com/t/sketchfab-operations/6678'.concat(i," target=_blank>Operations forum post</a>"):'An unknown error occurred. Please try again later or <a href="'.concat(n.Z.hosts.faq,"/requests/new").concat(i,'&type=website" target="_blank">contact our support team</a> if the problem persists.'),buttons:{ok:!0},safe:!0});return o.open().then((function(){o.close()})),o}}},fszX:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i("R4My"),r=i.n(n),a=i("QLbI"),o=i("zxPi"),s=i("3Alh"),l=i("qKlK"),u=i("5Cxy"),h=i("W8Jb"),c=i("Oyie"),A=function(e,t){var i=new(r().Model);return i.url=e+t,i.fetch().then((function(e){return window.prefetchedData[t]=e,e}))};const d=function(){var e=function(){if("dev"!==l.Z.buildMode){var e=!1;if(l.Z.prodHookDomainsBlacklist.forEach((function(t){document.location.href.indexOf(t)>-1&&(e=!0)})),e)return}if(-1!==window.location.search.substr(1).indexOf("hook_")){for(var t,i="hook_".length,n=window.location.search.substr(1).split(o.BJ),r=0;r<n.length;++r){var s=n[r];if(-1!==s.indexOf("hook_")){t=s.substr(i,s.indexOf("=")-i);break}}if(t&&a.ZP.bool("hook_"+t))return"https://"+("prod"===t?"sketchfab.com":"fatvoxel"===t?"fatvoxel.com":t+".fatvoxel.com")}}();if(e){var t=(0,u.Z)().model;if(t){var i=function(e,t){for(var i=["","animations","backgrounds","environments","hotspots","matcaps","sounds","textures"],n=[],r=0;r<i.length;++r){var a=(0,h.Z)(i[r],t);n.push(A(e,a))}return c.all(n).then((function(i){var n=i[0].version;return A(e,"/i/models/".concat(t,"/versions/").concat(n.uid,"/options")).then((function(e){return i[0].options=e,new s.Z(i[0])}))}))}(e,t);s.Z.get=function(){return i}}}}},iDLZ:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("HS/+"),r=i("WeWI"),a=i("/VXM");i("6c1T");const o=n.Z.extend({displayName:"Popup",optionTypes:{child:a.Z.component.isRequired,title:a.Z.string,className:a.Z.string,isClosable:a.Z.bool,width:a.Z.number},defaultOptions:{className:"",isClosable:!0},state:{},events:{},template:function(){var e=this.options,t=e.width,i=e.className,n=e.isClosable,a=e.title,o=e.child;return r.Z.getFromMacro("skfb_front/macros/components/molecules/popup","popup",[{className:i,isClosable:n,width:t,title:a,components:this.createChildrenComponents({child:o})}])}})},AxWo:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var n=i("Hjnd"),r=i.n(n),a=i("di37"),o=i("yfOW"),s=i("PGhl"),l=i("rRD0"),u=i("hDWi"),h=i("pcq+"),c=i("/VXM"),A=i("69kl"),d=i("mV4i"),g=i("Fgrz"),f=i("Oyie"),p=[];const m=o.Z.extend({parent:"body",el:'<div data-element="popup" />',optionTypes:{cleanOnClose:c.Z.bool,shouldExitOnClickOutside:c.Z.bool,shouldExitOnEscape:c.Z.bool,shouldRejectOnCancel:c.Z.bool},defaultOptions:{cleanOnClose:!0,shouldExitOnClickOutside:!0,shouldExitOnEscape:!0,shouldRejectOnCancel:!1},events:{'click [data-action="close"]':"cancel","click button:not([type])":u.PF,"mousedown .popup-container":"onMouseDown","mouseup .popup-container":"onMouseUp"},onMouseDown:function(e){this.lastMouseDownTarget=e.target},onMouseUp:function(e){this.options.shouldExitOnClickOutside&&e.currentTarget===this.lastMouseDownTarget&&(this.cancel(),delete this.lastMouseDownTarget)},constructor:function(){this.onKeyDown=this.onKeyDown.bind(this),this.identifier=Symbol(Math.random()),this.resizeHandler=function(){r().each(p,(function(e,t){t.setHeightForMobileResolution()}))}.bind(this),o.Z.apply(this,arguments)},initialize:function(){o.Z.prototype.initialize.apply(this,arguments),this.renderLayout()},setElement:function(){return o.Z.prototype.setElement.apply(this,arguments),this.$container=this.$(".popup-container"),this},delegateEvents:function(){o.Z.prototype.delegateEvents.apply(this,arguments),r()(window).on("resize",this.resizeHandler),document.addEventListener("keydown",this.onKeyDown,!0)},undelegateEvents:function(){o.Z.prototype.undelegateEvents.apply(this,arguments),r()(window).off("resize",this.resizeHandler),document.removeEventListener("keydown",this.onKeyDown,!0)},getPromise:function(){return this._promise||(this._promise=(0,d.pJ)()),this._promise},open:function(){return-1!==p.indexOf(this)?(this.show(),this.setElement(this.$el),this.getPromise()):(this.render(),p.unshift(this),r()((0,a.Z)(this,"parent")).append(this.$el),this.setElement(this.$el),this.hide(),this.setHeightForMobileResolution(),window.requestAnimationFrame(function(){this.show()}.bind(this)),this.getPromise())},show:function(){this.$container.removeClass("hidden"),document.body.classList.add("--prevent-scroll"),A.K.add(this.identifier)},hide:function(){this.$container.addClass("hidden"),A.K.delete(this.identifier),A.K.isEmpty()&&document.body.classList.remove("--prevent-scroll")},setIsLoading:function(e){this.$container.toggleClass("popup-loading",e)},isHidden:function(){return this.$container.hasClass("hidden")},onKeyDown:function(e){27===e.keyCode&&this.options.shouldExitOnEscape&&A.K.getTopPopup()===this.identifier&&(this.cancel(),e.stopPropagation())},cancel:function(e){return this._close(),this.options.shouldRejectOnCancel?this.getPromise().reject(new l.ud(e)):this.getPromise().resolve()},continue:function(e){return this._close(),this.getPromise().resolve(e)},_close:function(e,t){return this.$container.closest(".inline-popup").length>0?this:this.options.cleanOnClose||t?(this.hide(),(0,d.Vs)(500,(0,g.Z)(this.$el)).catch((function(){})).then(this.remove.bind(this))):(this.hide(),f.resolve())},close:function(e){return this._close(null,e)},replaceWith:function(e,t){return this.close(t),e.open()},setHeightForMobileResolution:function(){if(h.default.any){var e=this.$(".js-popup");(0,s.Nc)({width:window.innerWidth,breakpoint:"breakpointXSmall"})&&e.css({height:window.innerHeight})}},resize:function(e){var t=this.$(".js-popup");e.width&&t.width(e.width),e.height&&t.height(e.height)},autofocus:function(){var e=window.scrollX,t=window.scrollY;this.$(".form-input:visible").length>0?(this.$(".form-input").eq(0).focus(),window.scrollTo(e,t)):(this.$(".btn-primary, .submit").focus(),window.scrollTo(e,t))},_removeElement:function(){this.$el.remove()},remove:function(){return this.undelegateEvents(),o.Z.prototype.remove.apply(this,arguments)},renderLayout:function(){this.$el.html(this.template()),this.$container=this.$(".popup-container")},afterRender:function(){o.Z.prototype.afterRender.apply(this,arguments),this.renderChildren()}})},pjGz:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=i("3he7").Z.extend({events:{"click .close":"hide","touchstart .close":"hide"},show:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.removeClass("hidden")},hide:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.addClass("hidden")},isVisible:function(){return!this.el.classList.contains("hidden")}})},"3he7":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("yfOW");const r=n.Z.extend({constructor:function(e){this.viewer=e.viewer,this.widgets=e.widgets,n.Z.apply(this,arguments)},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},isEnabled:function(){return this.$el.hasClass("disabled")}})},sbxc:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("yfOW"),r=i("di37"),a=i("3eAj"),o=i("Hjnd"),s=i.n(o),l=i("WeWI"),u=i("Fgrz"),h=i("/VXM");i("9NVG");const c=n.Z.extend({displayName:"Notification",optionTypes:{parent:h.Z.string,class:h.Z.string,content:h.Z.string,delay:h.Z.number},defaultOptions:{parent:".flashmessage-container"},events:{'click [data-action="close"]':"onClickClose"},template:function(){return l.Z.getFromMacro("skfb_front/macros/notification","flashmessage",[this.options.class,this.options.content,{safecontent:"True"}])},initialize:function(){n.Z.prototype.initialize.apply(this,arguments),this.render(),this.options.delay&&this.close(this.options.delay)},render:function(){this.$el.html((0,r.Z)(this,"template")),s()(this.options.parent).append(this.$el);var e=this.$el.find(".notification");e.addClass("hidden"),(0,a.Z)(e.removeClass.bind(e,"hidden"))},onClickClose:function(e){e&&e.preventDefault&&e.preventDefault(),this.close(0)},close:function(e){var t=this;e=e||0;var i=this.$el.find(".notification");return setTimeout((function(){i.addClass("hidden"),(0,u.Z)(i).then((function(){t.$el.parent()[0].removeChild(t.el)}))}),e),this}})},uine:(e,t,i)=>{"use strict";i.d(t,{Z:()=>vt});var n=i("Hjnd"),r=i.n(n),a=i("57NU"),o=i("5sFf"),s=i("D5DJ"),l=i("3eAj"),u=i("3Alh"),h=i("lWrq"),c=i("qKlK"),A=i("5Eyw"),d=i.n(A),g=i("yfOW"),f=i("rRD0"),p=i("n0Kg"),m=i("ELsZ"),_=i("pcq+"),v=i("b5Bu"),C=i("eAdV"),b=i("WTdA"),S=i("Z10h"),E=i("C+0K"),y=i("5Cxy"),I=i("sZ3N"),x=i("jJ0f"),T=i("0RVg");const w=i("ydx7").Z.extend({}),M=T.Z.extend({model:w,parse:function(e){return e.results.images},url:function(){return"/i/models/"+this.options.uid+"/fallback"}});const R=g.Z.extend({_isLoaded:!1,_context:null,isMoving:!1,startX:0,sensitivity:20,sprite:{current:0,steps:15,ratio:null,width:0},size:1,autospinTimer:null,events:{mousedown:"onMouseDown",mouseup:"onMouseUp","mousemove ":"onMouseMove",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove"},constructor:function(){this._boundResizeEvent=this.onWindowResize.bind(this),g.Z.prototype.constructor.apply(this,arguments)},initialize:function(){g.Z.prototype.initialize.apply(this,arguments),this.$viewport=r()(),this.$image=r()()},delegateEvents:function(){g.Z.prototype.delegateEvents.apply(this,arguments),r()(window).on("resize",this._boundResizeEvent)},undelegateEvents:function(){g.Z.prototype.undelegateEvents.apply(this,arguments),r()(window).off("resize",this._boundResizeEvent),this.autospinTimer&&clearInterval(this.autospinTimer)},isViewerReady:function(){return this._isLoaded},run:function(){var e=new x.Z;this._context=e,this.$el.show(),this.$el.siblings(".webgl").hide(),this.$el.siblings(".osd").hide();var t=this.model.get("uid"),i=this._fallbackCollection=new M([],{uid:t});return i.fetch().then(function(){i.length>0?this.displayFallback():this.displayNoFallbackError()}.bind(this)).catch(function(){this.displayNoFallbackError()}.bind(this)),this._isLoaded=!0,!0},getContext:function(){return this._context},getFeatures:function(){return{}},findBestImage:function(){for(var e,t=this._fallbackCollection.toJSON(),i=this.$el.height(),n=1/0,r=0,a=t.length;r<a;++r){var o=t[r],s=Math.abs(i-o.height);s<n&&(n=s,e=o)}return e},displayFallback:function(){this.$viewport=r()(".fallback-viewport"),this.$image=this.$viewport.find("img.fallback-sprite");var e=this.findBestImage(),t=e.url;this._currentHeight=e.height,this.$image.on("load",function(e){var t=e.target.naturalHeight,i=e.target.naturalWidth/this.sprite.steps;this.sprite.ratio=t?i/t:0,r()(e.target).css("display","block"),this.trigger("secondary-progress",{progress:1}),this.trigger("success"),this.displayFallbackWarning(),this.onWindowResize()}.bind(this)),this.$image.on("error",function(e){console.error("Fallback loading failed. URL : "+t+" ERROR : "+e.toString()),this.trigger("fail"),this.displayFallbackLoadingError()}.bind(this)),this.$image.attr("src",t)},displayFallbackLoadingError:function(){this.$el.find(".fallback-error-loading").show()},displayNoFallbackError:function(){this.$el.find(".fallback-error-nofallback").show()},displayFallbackWarning:function(){this._warningDisplayed||(this._warningDisplayed=!0,this.$el.find(".fallback-warning").show(),this.fallbackWarning=setTimeout(function(){this.$el.find(".fallback-warning").fadeOut()}.bind(this),5e3))},onWindowResize:function(){if(this._fallbackCollection.length){var e,t,i=this.$el.width(),n=this.$el.height(),r=i/n;this.findBestImage().height>this._currentHeight&&this.displayFallback(),2===this.size?r<this.sprite.ratio?(e=i,t=Math.floor(e/this.sprite.ratio)):(t=n,e=Math.floor(t*this.sprite.ratio)):r<this.sprite.ratio?(t=n,e=Math.floor(t*this.sprite.ratio)):(e=i,t=Math.floor(e/this.sprite.ratio)),this.$viewport.width(e).height(t).css({"margin-top":Math.round(-1*t/2),"margin-left":Math.round(-1*e/2)}),this.sprite.width=Math.round(this.$image.prop("scrollHeight")*this.sprite.ratio),this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)}},onMouseDown:function(e){e.preventDefault(),this.isMoving=!0,this.startX=e.clientX},onMouseMove:function(e){e.preventDefault(),this.move(e.clientX)},onMouseUp:function(e){e.preventDefault(),this.isMoving=!1},onTouchStart:function(e){e.preventDefault(),this.isMoving=!0;var t=e.originalEvent.touches[0];this.startX=t.clientX},onTouchMove:function(e){e.preventDefault(),this.move(e.originalEvent.touches[0].clientX)},onTouchEnd:function(e){e.preventDefault(),this.isMoving=!1},move:function(e){this.isMoving&&(this.autospinTimer&&this.stopAutospin(),e>this.startX+this.sensitivity&&(this.startX=e,this.moveRight()),e<this.startX-this.sensitivity&&(this.startX=e,this.moveLeft()))},moveRight:function(){0===this.sprite.current?this.sprite.current=this.sprite.steps-1:this.sprite.current=this.sprite.current-1,this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},moveLeft:function(){this.sprite.current=(this.sprite.current+1)%this.sprite.steps,this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},startAutospin:function(){this.autospinTimer=setInterval((0,I.Z)((function(){this.moveLeft()}),this),500)},stopAutospin:function(){clearInterval(this.autospinTimer),this.autospinTimer=null},toggleAutospin:function(){this.autospinTimer?this.stopAutospin():this.startAutospin()}});var B=i("Thrf");const N=function(e){var t=r()(document);t.on("fullscreenchange",e),t.on("webkitfullscreenchange",e),t.on("MSFullscreenchange",e),t.on("mozfullscreenchange",e)},D=function(e){var t=r()(document);t.off("fullscreenchange",e),t.off("webkitfullscreenchange",e),t.off("MSFullscreenchange",e),t.off("mozfullscreenchange",e)},P=function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled},F=function(){return document.fullScreen||document.mozFullScreen||void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement||document.webkitIsFullScreen},O=function(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},L=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()};var k=i("O/gg"),Z=i("4Pmp"),U=i("R/vy"),V=i("pjGz"),Q=i("DF+G"),G=i.n(Q),H=i("N6Kc"),z=i("SMDa"),W=i("+gM6"),j=i("PSPx"),q=i("UNIa"),J=i("oa+f");var Y=i("zxPi"),K=i("QLbI"),X=i("WeWI"),$=i("PGhl"),ee=i("Nppi"),te=i("3he7"),ie=i("9HNn"),ne=i("bP3Y"),re=i("KKY1"),ae=i("Fgrz"),oe=(0,ie.Z)(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>">','   <p class="setting-label"><%= label %></p>',"</div>"].join("")),se=(0,ie.Z)(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>" data-setting-type="<%= type %>">','   <p class="setting-label"><%= label %></p>','   <p class="setting-value" data-value="<%= value %>" ><%= prettyValue %></p>',"</div>"].join("")),le=(0,ie.Z)(['   <a class="control-menu-back back">Back</a>','   <ul class="setting-list" data-setting="<%= name %>" data-setting-type="<%= type %>">',"       <%= listItems %>","   </ul>"].join("")),ue=(0,ie.Z)(['<li class="setting-item <% if (selected) { %>selected<% } %>" data-value="<%= value %>">',"   <%= prettyValue %>",'   <span class="shortcut" title="Keyboard shortcut"><%= shortcut %></span>',"</li>"].join(""));const he=te.Z.extend({events:{"click .setting":"onSettingClick","touchend .setting":"onSettingClick","click .back":"togglePane","touchend .back":"togglePane","click .setting-item":"onSettingValueClick","touchend .setting-item":"onSettingValueClick",'click [data-setting="viewerMode"] li':"onViewerModeChange",'touchend [data-setting="viewerMode"] li':"onViewerModeChange"},initialize:function(e){if(te.Z.prototype.initialize.apply(this,arguments),this.settings=e.settings,this.viewer=e.viewer,(0,W.Z)(this.settings))return console.warn("No settings object given to SettingsMenu"),void this.$el.hide();this.$list=this.$(".control-menu-list"),this.$pane=this.$(".control-menu-pane"),this.$el.on("click touchend",'.wireframe-colors a[data-setting="wireframeColor"]:not(.active)',this.onWireframeColorClick.bind(this)),this.$el.on("click touchend",'.wireframe-colors a[data-setting="wireframeColor"].active',this.onDisableWireframeClick.bind(this)),this.$el.on("click touchend",'.wireframe-colors a[data-setting="wireframeEnable"]',this.onDisableWireframeClick.bind(this)),this.viewer.proxySettings.on("change",this.render.bind(this))},onViewerModeChange:function(e){e&&"touchend"===e.type&&e.preventDefault(),"0"===this.viewer.proxySettings.get("viewerMode")?this.viewer.subviews.osd.show("Click and hold to rotate",{position:"top",duration:3e3}):this.viewer.subviews.osd.show("Mouse to look around, keyboard to move",{position:"top",duration:3e3})},onDisableWireframeClick:function(e){e&&"touchend"===e.type&&e.preventDefault();var t=this.$('.wireframe-colors [data-setting="wireframeEnable"]');this.viewer.proxySettings.set("wireframeEnable",!1),t.parent().find(".active").removeClass("active"),t.addClass("active")},onWireframeColorClick:function(e){e&&"touchend"===e.type&&e.preventDefault();var t=r()(e.currentTarget),i=t.attr("data-value");this.viewer.proxySettings.set("wireframeColor",i),this.viewer.proxySettings.set("wireframeEnable",!0),t.parent().find(".active").removeClass("active"),t.addClass("active")},onSettingClick:function(e){e&&"touchend"===e.type&&e.preventDefault&&e.preventDefault();var t=r()(e.currentTarget).attr("data-setting"),i=this.settings[t];if(i.name=t,i.isButton)return this[i.action]&&this[i.action](e);this.renderSettingPane(i),this.togglePane(!0)},onSettingValueClick:function(e){e.preventDefault(),e.stopPropagation();var t=r()(e.currentTarget),i=t.attr("data-value"),n=t.closest("[data-setting]"),a=n.attr("data-setting");switch(n.attr("data-setting-type")||"string"){case"number":i=parseFloat(i);break;case"bool":i="true"===i}this.viewer.proxySettings.set(a,i)},onSettingChangeWhileOpen:function(){this.renderSettingPane(this._currentSetting)},renderSettingPane:function(e){var t,i="",n="string",r=this.viewer.proxySettings.get(e.name),a=this.getSettingFromValue(e.name,r),s=this.viewer._currentModel.get("options").shading.type;this._currentSetting&&this.viewer.proxySettings.off("change:"+this._currentSetting.name,this.onSettingChangeWhileOpen,this),this._currentSetting=e,this._currentSetting&&this.viewer.proxySettings.on("change:"+this._currentSetting.name,this.onSettingChangeWhileOpen,this),"shadingStyle"===e.name&&"lit"!==s||(0,o.Z)(e.settings,(function(e){i+=ue({value:e.value,type:e.type||n,prettyValue:e.label,selected:a===e,shortcut:e.shortcut||""})})),t=(e.paneTemplate||le)({listItems:i,name:e.name,type:e.type||n,viewerSettings:this.viewer.proxySettings.toJSON()}),this.$pane.html(t);var l=this.viewer.scene.getFeatures().webVR.getModel();"viewerMode"!==this._currentSetting.name||l.get("hasNativeHMD")?this.$('[data-value="2"]').show():this.$('[data-value="2"]').hide()},getSettingFromValue:function(e,t){var i;return(this.settings[e].settings||[]).forEach((function(e){e.value!==t&&e.value+""!=t+""||(i=e)})),i},togglePane:function(e,t){var i=this;t&&"touchend"===t.type&&t.preventDefault(),this.$el.toggleClass("detail",e),(0,ae.Z)(this.$(".control-menu-wrapper")).then((function(){i.$el.hasClass("detail")||i.clearPane()}))},clearPane:function(){this.$pane.html("")},render:function(){var e="",t=this.viewer.scene.getFeatures().quality.getModel(),i=this.viewer.scene.getFeatures().hotspot.getModel(),n=this.viewer.scene.getFeatures().animation.getModel(),r=[];(0,o.Z)(this.settings,(function(e,t){var i=(0,ne.Z)(e);i.name=t,r.push(i)})),r=(0,re.Z)(r,"order"),(0,o.Z)(r,function(t){var i,n=t.name;if(t.isButton)i=oe({name:n,label:t.label,group:t.group});else{var r=this.getSettingFromValue(n,this.viewer.proxySettings.get(n))||t.settings[0];i=se({name:n,label:t.label,value:r.value,prettyValue:r.label,group:t.group,type:r.type})}e+=i}.bind(this)),this.$list.html(e),te.Z.prototype.render.apply(this,arguments),n&&n.get("animations").length?this.$('[data-setting-group="animation"]').show():this.$('[data-setting-group="animation"]').hide(),t&&t.get("promiseReady").isFulfilled()?this.$('[data-setting-group="textureQuality"]').show():this.$('[data-setting-group="textureQuality"]').hide(),i&&i.get("hotspots").length?this.$('[data-setting-group="annotation"]').show():this.$('[data-setting-group="annotation"]').hide(),t&&t.get("promiseReady").isFulfilled()&&window.requestAnimationFrame(function(){var e=this.getSettingFromValue("textureQuality",t.get("level"));this.$('[data-setting="textureQuality"] .setting-value').attr("data-value",e.value).text(e.label)}.bind(this))},onTextureQualityReady:function(e){var t=this.viewer.scene.getFeatures().quality;if(t)if(e.low||e.mid||e.high){var i=t.getModel().get("level");this.viewer.proxySettings.set("textureQuality",i),this.render()}else this.$('[data-setting="textureQuality"]').remove()}});var ce=i("cgbd");function Ae(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function de(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(i),!0).forEach((function(t){G()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ae(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ge=c.Z.shortcuts;(0,y.Z)().uiInspector?(ge.inspectorControl.shortcuts[0].keyCombinations="1",ge.inspectorControl.shortcuts[1].keyCombinations="2",ge.inspectorControl.shortcuts[2].keyCombinations="3",ge.inspectorControl.shortcuts[3].keyCombinations="4",ge.inspectorControl.shortcuts[4].keyCombinations="6",ge.viewerRendering.shortcuts[0].keyCombinations="",ge.viewerRendering.shortcuts[1].keyCombinations="",ge.viewerRendering.shortcuts[2].keyCombinations="",ge.viewerRendering.shortcuts[3].keyCombinations="5"):(ge.inspectorControl.shortcuts[0].keyCombinations="",ge.inspectorControl.shortcuts[1].keyCombinations="",ge.inspectorControl.shortcuts[2].keyCombinations="",ge.inspectorControl.shortcuts[3].keyCombinations="",ge.inspectorControl.shortcuts[4].keyCombinations="");var fe=new b.Z(ge.viewerRendering),pe=function(e){var t=X.Z.getFromString('<a           class="{{ className }} {{ "active" if isActive else "" }}"           data-setting="{{ dataSetting }}"           data-value="{{ dataValue }}"           title="{{ title }}">        </a>');return X.Z.getFromString('<p class="wireframe-title">        Wireframe         <span class="shortcut" title="Keyboard shortcut">           {{ shortcut | safe }}        </span>        </p>        <div class="wireframe-colors">           {{ colorItems | safe }}        </div>')({shortcut:fe.getShortDescriptionById("toggleWireframe"),colorItems:[{title:"Off",className:"colors-none",dataSetting:"wireframeEnable",dataValue:"0"},{title:"Black",className:"colors-black",dataSetting:"wireframeColor",dataValue:"000000FF"},{title:"White",className:"colors-white",dataSetting:"wireframeColor",dataValue:"ffffffFF"},{title:"Red",className:"colors-red",dataSetting:"wireframeColor",dataValue:"ff0000FF"},{title:"Blue",className:"colors-blue",dataSetting:"wireframeColor",dataValue:"0000FFFF"},{title:"Green",className:"colors-green",dataSetting:"wireframeColor",dataValue:"00FF00FF"},{title:"Yellow",className:"colors-yellow",dataSetting:"wireframeColor",dataValue:"FFFF00FF"}].map((function(i){return t(de(de({},i),{},{isActive:e.wireframeColor===i.dataValue}))})).join("")})},me={};(0,y.Z)().uiInspector||(me.shadingStyle={label:"Rendering",settings:[{label:"Lit",value:"lit",shortcut:fe.getShortDescriptionById("defaultRenderingMode")},{label:"Shadeless",value:"shadeless",shortcut:fe.getShortDescriptionById("shadelessRenderingMode")},{label:"MatCap",value:"matcap",shortcut:fe.getShortDescriptionById("matcapRenderingMode")}],paneTemplate:function(e){var t=e.viewerSettings.hasWireframe,i=e.viewerSettings.wireframeColor;return X.Z.getFromString('    <div class="setting-list-header">               <a class="back control-menu-back">Back</a>               <span class="setting-list-header-help">Key</span>           </div>            <ul class="setting-list" data-setting="{{ name }}">                {{ listItems | safe }}            </ul>            {{ wireframe | safe }}',de(de({},e),{},{wireframe:t?pe({wireframeColor:i}):""}))},order:2});const _e=te.Z.extend({events:{"click .help":"onHelpClick","click .ar":"onArClick","click .vr":"onVrClick","click .fullscreen":"onFullscreenClick","click .theatre":"onTheatreClick","touchend .control.tooltip":"replaceDOMElement"},constructor:function(){this.fullScreenChange=this.fullScreenChange.bind(this),this.onVrClick=this.onVrClick.bind(this),this.onFullscreenClick=this.onFullscreenClick.bind(this),this.onTheatreClick=this.onTheatreClick.bind(this),this.onArClick=this.onArClick.bind(this),te.Z.prototype.constructor.apply(this,arguments)},initialize:function(){te.Z.prototype.initialize.apply(this,arguments),this.enableVR=!1,this.wasClicked=this.$el.parents(".model-container").hasClass("theatre"),!P()&&(0,J.Z)()&&window.self===window.top&&(this.viewer.$el.addClass("no-fullscreen"),this.viewer.$el.find(".controls .settings").addClass("shift-menu-left"));var e=window.innerWidth;try{e=window.parent.innerWidth}catch(e){}(0,$.Nc)({width:e,breakpoint:"breakpointMedium"})&&this.viewer.$el.find(".controls .general-controls .theatre").hide(),this._theatreActive="false"!==h.ZP.get("sb_theatre_mode","false"),this.viewer.on("model-loaded",this.updateNavigationSettings.bind(this)),this.generalControlsShortcuts=new b.Z(ge.generalControls),this.generalControlsShortcuts.on("fullscreen",this.onToggleFullScreen,this),this.generalControlsShortcuts.listen([this.generalControlsShortcuts.getShortcut("fullscreen")])},delegateEvents:function(){te.Z.prototype.delegateEvents.apply(this,arguments),this.onFullScreenChange(this.fullScreenChange),this.viewer.proxySettings.on("change",this.renderSettings,this),this.viewer.on("model-loaded",this.setModelListeners.bind(this))},undelegateEvents:function(){if(te.Z.prototype.undelegateEvents.apply(this,arguments),!this.$el)return this;this.offFullScreenChange(this.fullScreenChange),this.viewer.proxySettings.off("change",this.renderSettings,this),this.viewer.on("model-loaded",this.removeModelListeners.bind(this))},setModelListeners:function(){this.viewer.scene.getFeatures().animation.getModel().get("animations").on("add remove reset",this.renderSettings,this);var e=this.viewer.scene.getFeatures().camera.getModel();this.listenTo(e,"change:useCameraConstraints",this.updateNavigationSettings.bind(this))},removeModelListeners:function(){this.viewer.scene.getFeatures().animation.getModel().get("animations").off("add remove reset",this.renderSettings,this);var e=this.viewer.scene.getFeatures().camera.getModel();this.stopListening(e,"change:useCameraConstraints",this.updateNavigationSettings.bind(this))},setHasAnimations:function(e){this.hasAnimations=e},getSettingLabelForValue:function(e,t){return(0,H.Z)(me[e].settings,(function(e){return e.value===t})).label},getEmbedUrl:function(e){var t=K.ZP.craft(de(de({},(0,Y.Qc)(location.search)),e));return this.viewer._currentModel.get("embedUrl")+"?"+t},onHelpClick:function(e){e.preventDefault(),e.stopPropagation(),this.viewer.subviews.helpOverlay.show()},generateTextureQualitySettings:function(e){me.textureQuality={label:"Textures",group:"textureQuality",settings:[{label:"LD",value:"0"},{label:"SD",value:"1"},{label:"HD",value:"2"}],order:5};var t=0;["low","mid","high"].forEach(function(i,n){e[i]||(me.textureQuality.settings.splice(n-t,1),t++)}.bind(this)),(0,z.Z)(me.textureQuality.settings).label="HD",this.renderSettings()},updateNavigationSettings:function(){this.viewer.scene.getFeatures().camera.getModel().get("useCameraConstraints")?delete me.viewerMode:me.viewerMode||(me.viewerMode={label:"Navigation",settings:[{label:"Orbit",value:"0"},{label:"First Person",value:"1"}],order:4}),this.renderSettings()},renderSettings:function(){(0,W.Z)(me)?this.$(".control.settings").hide():(this.$(".control.settings").show(),this.settings||(this.settings=new he({el:this.$(".settings-menu"),viewer:this.viewer,settings:me})),this.settings.render())},getQrCode:function(){if((0,y.Z)().uiArQrcode){var e=document.getElementById("qrCode"),t=q.Z.getArRedirectionUrl(this.viewer._currentModel.get("uid"));return i.e(6565).then(i.t.bind(i,"l+dK",23)).then((function(i){return i.toCanvas(e,t,(function(e){e&&console.error(e)}))}))}},getPlatform:function(){var e=_.default.apple.device,t=_.default.android.device;if(e){var i=function(){try{return parseInt(navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/)[1],10)}catch(e){console.error(e)}}(),n=document.createElement("a");return i>=11||n.relList&&n.relList.supports("ar")?"ios":"mobileIos"}return t?function(){try{return parseInt(navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/i)[1],10)}catch(e){console.error(e)}}()>=7?"android":"mobileAndroid":"others"},openArDesktopInstructions:function(){this.viewer._currentModel.sharing().then(function(){var e=this.viewer._currentModel.get("sharing").shortUrl;this.viewer.subviews.arOverlayDesktop.setUrl(e),this.viewer.subviews.arOverlayDesktop.show()}.bind(this))},openArMobileInstructions:function(e,t){this.viewer.subviews.arOverlayMobile.setPlatform(e),this.viewer.subviews.arOverlayMobile.setMinVersion(t),this.viewer.subviews.arOverlayMobile.show()},setArLoaderListener:function(){var e=this;document.addEventListener("visibilitychange",(function t(){e.viewer.subviews.arOverlayLoading.hide(),document.removeEventListener("visibilitychange",t,!1)}),!1)},onArClick:function(e){var t=this;e.stopPropagation();var i=this.getPlatform(),n=this.viewer._currentModel.get("viewerUrl"),r=this.viewer._currentModel.get("name");"ios"===i?(this.viewer.subviews.arOverlayLoading.show(),this.setArLoaderListener(),v.Z||setTimeout(function(){this.viewer.subviews.arOverlayLoading.hide()}.bind(this),1e4),q.Z.getModelArEnterprise(i,this.viewer._currentModel.id).then((function(e){var t=document.createElement("a"),i=document.createElement("img");t.href=e.url,t.rel="ar",t.appendChild(i),t.click()})).catch((function(e){t.viewer.subviews.arOverlayLoading.hide(),t.viewer.subviews.arOverlayErrorMessage.show(),console.error(e)}))):"android"===i?(this.viewer.subviews.arOverlayLoading.show(),this.setArLoaderListener(),q.Z.getModelArEnterprise(i,this.viewer._currentModel.id).then((function(e){var t=e.url;window.location.href="intent://arvr.google.com/scene-viewer/1.0?file="+encodeURIComponent(t)+"&mode=ar_preferred&link="+encodeURIComponent(n)+"&title="+encodeURIComponent(r)+"#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=https://developers.google.com/ar;end;"})).catch((function(e){t.viewer.subviews.arOverlayLoading.hide(),t.viewer.subviews.arOverlayErrorMessage.show(),console.error(e)}))):"mobileIos"===i?this.openArMobileInstructions("iOS","11"):"mobileAndroid"===i?this.openArMobileInstructions("Android","7"):(this.getQrCode(),this.openArDesktopInstructions())},onVrClick:function(e){var t=this,i=function(){t.widgets.hotspots&&(t.widgets.hotspots.hideTooltips(),t.widgets.hotspots.currentHotspot=-1,t.widgets.hotspots.renderControl());var i=t.viewer.scene.getFeatures().webVR.getModel();if(i.on("presentVrFailed",function(){this.openVrInstructions()}.bind(t)),t.viewer.scene.getViewerOSGJS().isVRSupported()&&!_.default.apple.device){if(t.viewer.scene.getViewerOSGJS().needsVRPolyFill()){var n=new ee.Z({message:"Initializing VR ..."});return n.open(),void t.viewer.scene.getViewerOSGJS().loadWebxrPolyFill().then(function(){var t=this,i=new ce.Z({title:"Ready",text:'Press the "Enter VR" button to proceed.',buttons:{ok:!0,okLabel:"Enter VR"}});n.replaceWith(i),i.getPromise().then((function(){return t.onVrClick(e)}))}.bind(t)).catch(function(){n.hide(),this.openVrInstructions()}.bind(t))}i.set("enable",!i.get("enable"))}else _.default.any?(i.set("cardboard",!0),t.fullscreenVR(e),i.set("enable",!i.get("enable"))):t.openVrInstructions()};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){"granted"===e&&i()})).catch((function(){alert("Accelerometer permission couldn't be granted. Please try again at a later time.")})):i(),e.stopPropagation()},openVrWindow:function(){this.viewer._currentModel&&window.open(this.getEmbedUrl({cardboard:1,autostart:1}),"skfbCardboard","menubar=no,toolbar=no")},openVrInstructions:function(){this.viewer._currentModel.sharing().then(function(){this.viewer.subviews.helperVrOverlay.setUrl(this.getEmbedUrl({cardboard:1,autostart:1})),this.viewer.subviews.helperVrOverlay.show()}.bind(this))},isTheatreActive:function(){return this._theatreActive},onTheatreClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.isTheatreActive(),i=j.Z.me().get("isAnonymous")&&!this.wasClicked;this.wasClicked=!0,this.viewer.trigger(t&&!i?"leaveTheatreMode":"enterTheatreMode");try{t&&!i?window.parent.postMessage("leaveTheatreMode","*"):window.parent.postMessage("enterTheatreMode","*")}catch(e){}return h.ZP.set("sb_theatre_mode",!t),this._theatreActive=!t,!1},onFullscreenClick:function(e,t){e.stopPropagation(),this.onToggleFullScreen(t)},onToggleFullScreen:function(e){P()?F()?L():O(this.viewer.el):e?this.openVrWindow():this.openFakeFullscreen()},openFakeFullscreen:function(){this.viewer._currentModel&&(_.default.any?window.open(this.getEmbedUrl()):window.open(this.getEmbedUrl(),"skfbFullscreenFallback","menubar=no,toolbar=no"))},onFullScreenChange:function(e){N(e)},offFullScreenChange:function(e){D(e)},fullScreenChange:function(){r()('[data-action="fullscreen"] > .icon').toggleClass("icon-fullscreen-icon").toggleClass("icon-fullscreen-off-icon"),this.viewer.$el.toggleClass("fullscreen",F()),this.viewer.scene.trigger("resizeViewerOnNextFrame",-1,-1);var e=this.viewer.scene.getFeatures().webVR;if(e){var t=e.getModel();F()?!0===this.enableVR&&t.set("enable",!0):!0===this.enableVR&&(t.set("enable",!1),this.enableVR=!1)}},fullscreenVR:function(e){return this.enableVR=!0,this.onFullscreenClick(e,!0)},replaceDOMElement:(0,s.Z)((function(e){var t=e.target.parentElement,i=e.target.nextSibling;t&&(t.removeChild(e.target),(0,l.Z)((function(){t.insertBefore(e.target,i)})))}),2e3)});var ve=i("O8uY"),Ce={passive:!0};const be=te.Z.extend({VIEWER_MODE_ORBIT:0,VIEWER_MODE_FPS:1,HOTSPOT_CYCLE_PAUSE:1e4,events:{"click .has-menu":"toggleMenu","touchstart .has-menu":"toggleMenuTouch",keydown:"onKeydown","mousedown  .webgl .canvas":"cameraMoveStart","touchstart .webgl .canvas":"cameraMoveStart","mousedown  .webgl":"mouseDownEvent","mouseup    .webgl":"mouseUpEvent","touchstart .webgl":"mouseDownEvent","touchend   .webgl":"mouseUpEvent","mousedown  .fallback":"mouseDownEvent","touchstart .fallback":"mouseDownEvent"},constructor:function(){this.globalCloseEvent=this.globalCloseEvent.bind(this),this.globalMouseUpEvent=this.globalMouseUpEvent.bind(this),this.onKeydown=this.onKeydown.bind(this),this.onMousewheel=this.onMousewheel.bind(this),te.Z.prototype.constructor.apply(this,arguments)},delegateEvents:function(){te.Z.prototype.delegateEvents.apply(this,arguments);var e=r()(document);e.on("keydown",this.onKeydown),e.on("mousedown",this.globalCloseEvent),e.on("mouseup",this.globalMouseUpEvent),e.on("mousewheel.delegateEvents"+this.cid,".annotation",this.preventScroll),document.addEventListener("wheel",this.onMousewheel,Ce)},undelegateEvents:function(){te.Z.prototype.undelegateEvents.apply(this,arguments);var e=r()(document);e.off("keydown",this.onKeydown),e.off("mousedown",this.globalCloseEvent),e.off("mouseup",this.globalMouseUpEvent),e.off("mousewheel.delegateEvents"+this.cid,".annotation",this.preventScroll),document.removeEventListener("wheel",this.onMousewheel,Ce)},enable:function(){this.$(".gui").removeClass("hidden"),(0,l.Z)(function(){this.$(".gui").addClass("enabled")}.bind(this))},disable:function(){this.$(".gui").removeClass("enabled").addClass("hidden")},closeMenus:function(){this.$(".gui").find(".has-menu").removeClass("active"),this.viewer.subviews.generalControls&&this.viewer.subviews.generalControls.settings&&this.viewer.subviews.generalControls.settings.togglePane(!1)},cameraMoveStart:function(){this.viewer.$(".webgl").addClass("camera-moving"),this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots.pauseHotspotCycleInterval()},cameraMoveEnd:function(){this.viewer.$(".webgl").removeClass("camera-moving"),this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots._hotspotCycleIntervalPaused&&this.viewer.subviews.hotspots.beginHotspotCycleInterval(this.HOTSPOT_CYCLE_PAUSE)},onMousewheel:function(){if(this.viewer.scene){var e=this.viewer.scene.getFeatures();if(Object.prototype.hasOwnProperty.call(e,"camera"))if(e.camera.getModel().get("indexManipulator")===this.VIEWER_MODE_FPS){var t=this.viewer.scene.getViewerOSGJS().getManipulator().getCurrentManipulator()._stepFactor,i=Math.round(t/4*100);this.viewer.subviews.osd.show("Walking speed: "+i,{duration:1e3})}}},onKeydown:function(e){var t=document.activeElement,i="";32===e.which&&t&&(i=t.tagName,-1!==["BODY","CANVAS"].indexOf(i)&&(this.recenter(),e.preventDefault())),e.which>=96&&e.which<=105&&this.timeline&&this.timeline.setCurrentAnimation(e.which-96),27===e.which&&(this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots._hotspots.length&&(this.viewer.subviews.hotspots.currentHotspot=-1,this.viewer.subviews.hotspots.applyCurrentHotspot(),this.viewer.subviews.hotspots.unrevealHotspots(),this.viewer.subviews.hotspots.stopHotspotCycleInterval()),this.closeMenus(),this.viewer.subviews.helpOverlay.hide())},preventParentScroll:function(e,t){var i=r()(".hotspot-controls .list"),n=i.height(),a=i.children()[0].scrollHeight,o=i.children()[0].scrollTop;(o===a-n&&t<0||0===o&&t>0)&&e.preventDefault()},preventScroll:function(e){e.preventDefault()},globalMouseUpEvent:function(){this.cameraMoveEnd()},globalCloseEvent:function(e){r()(e.target).hasClass("has-menu")||r()(e.target).parents(".has-menu").length||this.closeMenus(e)},toggleMenuTouch:function(e){if("label"===e.target.tagName.toLowerCase())return e;e.preventDefault(),e.stopPropagation(),this.toggleMenu(e)},toggleMenu:function(e){if("label"===e.target.tagName.toLowerCase())return e;e.preventDefault(),e.stopPropagation();var t=r()(e.currentTarget);t.hasClass("active")?e.currentTarget===e.target&&t.attr("data-title",t.attr("title")).removeClass("active"):(this.closeMenus(),t.attr("title",t.attr("data-title")).removeAttr("data-title").addClass("active"))},renderSetting:function(e,t){this.viewer.$('[data-setting="'+e+'"]').removeClass("active"),"wireframeColor"===e&&!1===this.viewer.proxySettings.get("wireframeEnable")||this.viewer.$('[data-setting="'+e+'"][data-value="'+t+'"]').addClass("active")},getPointerPosition:function(e){var t,i=e.originalEvent?e.originalEvent:e,n={};return i.touches&&i.touches.length||i.changedTouches&&i.changedTouches.length?(t=(t=i.touches&&i.touches.length?i.touches:i.changedTouches)[0],n.x=t.pageX,n.y=t.pageY,n.type="Touch"):(n.x=e.pageX,n.y=e.pageY,n.type="Mouse"),n},mouseDownEvent:function(e){this.mouseDownPosition=this.getPointerPosition(e),this.viewer.subviews.hint.hide(),"touchstart"===e.type&&(e.target===e.currentTarget||this.scene&&this.scene.getCanvas&&e.target===this.viewer.scene.getCanvas())&&e.preventDefault()},mouseUpEvent:function(e){if(this.mouseDownPosition){var t=this.getPointerPosition(e);if(this.viewer.$el.hasClass("started")){if(Math.abs(this.mouseDownPosition.x-t.x)>20||Math.abs(this.mouseDownPosition.y-t.y)>20){var i=this.viewer._currentModel?this.viewer._currentModel.get("uid"):this.viewer._currentUid;ve.default.modelEmbedModelInteraction(i,t.type)}this.mouseDownPosition=null}}},recenter:function(){this.viewer.scene&&this.viewer.scene.getViewerOSGJS().getManipulator().computeHomePosition()}}),Se=te.Z.extend({events:{"click .close":"close"},close:function(e){e&&e.preventDefault&&e.preventDefault()}});var Ee=i("ZSSq"),ye=c.Z.shortcuts;const Ie=V.Z.extend({displayName:"HelpOverlay",mixins:[(0,Ee.Z)(".tabs-container")],events:{"click .tabs a":"onTabClick","touchstart .tabs a":"onTabClick",'click [data-action="reset-camera"]':"onResetCameraClick",'touchstart [data-action="reset-camera"]':"onResetCameraClick"},initialize:function(){V.Z.prototype.initialize.apply(this,arguments),this.generalShortcuts=new b.Z(ye.generalControls),this.renderingShortcuts=new b.Z(ye.viewerRendering),this.annotationShortcuts=new b.Z(ye.annotationControl),this.animationShortcuts=new b.Z(ye.animationControl),this.soundShortcuts=new b.Z(ye.sound),this.inspectorShortcuts=new b.Z(ye.inspectorControl),this.render()},onResetCameraClick:function(e){e.preventDefault(),this.hide(),this.viewer.scene.getFeaturesManager().focusOnSavedCamera(2),(0,l.Z)((function(e){e.target.blur()}),e)},render:function(){var e=this.renderingShortcuts.generateHelpSection(),t=this.generalShortcuts.generateHelpSection(),i=this.animationShortcuts.generateHelpSection(),n=this.annotationShortcuts.generateHelpSection(),r=this.inspectorShortcuts.generateHelpSection(),a=this.soundShortcuts.generateHelpSection();this.$(".rendering-shortcuts").html(e),this.$(".general-shortcuts").html(t),this.$(".animation-shortcuts").html(i),this.$(".annotation-shortcuts").html(n),this.$(".inspector-shortcuts").html(r),this.$(".sound-shortcuts").html(a)},onTabClick:function(e){e.preventDefault();var t=r()(e.currentTarget),i=t.attr("data-target"),n=this.$("[data-tab].active"),a=this.$('[data-tab="'+i+'"]');this.$(".tabs li").removeClass("active"),t.parent().addClass("active"),n.removeClass("active"),a.addClass("active")}});var xe=i("Bxp5");const Te=te.Z.extend({initialize:function(){te.Z.prototype.initialize.apply(this,arguments),this.$hint=this.$(".viewer-hint");var e=_.default.any?"touch &amp; drag<br>to rotate":"click &amp; hold<br>to rotate";this.$hint.find(".viewer-movehint .label").html(e),this.options.fallback&&this.$hint.addClass("fallback-position")},show:function(e){e=(0,xe.Z)((0,a.Z)({},e),{force:!1});var t=1===h.ZP.get("sf_show_viewer_hint",1),i=(0,y.Z)().uiHint;2===i&&(e.force=!0),(e.force||1===i&&t)&&this.$hint.addClass("active")},hide:function(e){e=(0,xe.Z)((0,a.Z)({},e),{remember:!0}),this.$hint.removeClass("active"),e.remember&&h.ZP.set("sf_show_viewer_hint",0,{expires:15552e6})}});var we=i("92w9");const Me=V.Z.extend({mixins:[we.Z,(0,Ee.Z)(".js-scrollable")],setModel:function(e){this.model=e,this.render()},render:function(){this.model&&(this.$(".hotspot-title").html((0,S.sanitize)(this.model.get("name"))),this.$(".hotspot-content").html(this.model.get("content").rendered),this.handleLazyLoading())}});var Re=i("uuWb"),Be=i("/VXM"),Ne=Re.Z.osg,De=new(d())({device:"VWR"});const Pe=te.Z.extend({optionTypes:{color:Be.Z.string},reset:function(){this._primaryProgress=0,this._secondaryProgress=0},handleLoading:function(e){e.scene.on("primary-progress",function(e){if(this.setPrimaryProgress(e.progress),(0,y.Z)().isApp){var t=De.createMessage({data:{progress:e.progress+""}});this.previousMessage&&this.previousMessage.removeFromHash(),t.appendToHash(),this.previousMessage=t}}.bind(this)),e.scene.on("secondary-progress",function(e){this.setSecondaryProgress(e.progress)}.bind(this)),e.scene.on("success",function(){this.viewer.$el.removeClass("model-loading").addClass("model-loaded"),e.model.trigger("status:loaded"),this.trigger("loaded")}.bind(this)),e.scene.on("fail",function(){Ne.error("Viewer instanciation failed")}.bind(this))},setPrimaryProgress:function(e){this._primaryProgress=Math.min(Math.max(this._primaryProgress,e),1),this.updateMainProgressBar(),1===this._primaryProgress&&this.setSecondaryProgress(0)},setSecondaryProgress:function(e){this._secondaryProgress=Math.min(Math.max(0,e),1),this.updateSecondaryProgressBar()},updateMainProgressBar:function(){var e=this._primaryProgress,t=1===e;this.$(".main-progress").toggleClass("loading",!t),this.$(".main-progress-display__progress").css({width:100*e+"%"}),this.$(".main-progress-percentage").text(Math.floor(100*e)+" %")},updateSecondaryProgressBar:function(){var e=this._secondaryProgress;this.$(".secondary-progress-percentage").text(Math.floor(100*e)+" %"),this.$(".secondary-progress-display").css("width",100*e+"%");var t=1===this._primaryProgress,i=1===e;this.$(".secondary-progress").toggleClass("visible",t&&!i)}});var Fe=i("1416"),Oe=i("BiNt"),Le=i("yqde"),ke=i("Usly"),Ze=i("6bX3"),Ue=i("sToK"),Ve=(i("i3rb"),i("65jS")),Qe=i("d1tj");function Ge(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function He(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(i),!0).forEach((function(t){G()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ge(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const ze=Ze.Z.extend({displayName:"Dropdown",mixins:[(0,Ee.Z)('[data-ref="menu"]'),ke.Z],optionTypes:{child:Be.Z.component.isRequired,labelTitle:Be.Z.string,labelValue:Be.Z.string,longestLabelValue:Be.Z.string,placeholder:Be.Z.string,color:Be.Z.string,className:Be.Z.string,theme:Be.Z.oneOf(["dark","light","white-background","grey-background"]),menuAlign:Be.Z.oneOf(["left","right"]),disabled:Be.Z.bool,withBackground:Be.Z.bool,grey:Be.Z.bool},defaultOptions:{color:"",theme:"light",menuAlign:"left",disabled:!1,withBackground:!1,grey:!1},events:{'click [data-action="toggle-menu"]:not([data-disabled="true"])':"onToggle","click window":"onWindowClick","resize window":"setMenuPosition"},state:{isOpen:!1},viewDidMount:function(){this.setMenuPosition()},viewDidUpdate:function(){this.setMenuPosition()},onToggle:function(){this.setState({isOpen:!this.state.isOpen})},onWindowClick:function(e){!(0,Ve.Ub)(this.el,e.target)&&this.state.isOpen&&this.setState({isOpen:!1})},setMenuPosition:function(){var e=this.el.getBoundingClientRect(),t=this.refs.menu.getBoundingClientRect();this.refs.$menu.css({bottom:-Math.min(0,window.innerHeight-(e.bottom+t.height+10)),right:"right"===this.options.menuAlign?Math.min(0,e.right-(t.width+10)):"auto",left:"left"===this.options.menuAlign?Math.min(0,window.innerWidth-(e.left+t.width+10)):"auto"})},scrollToHeightPercent:function(e){var t=this.refs.$menu.prop("scrollHeight");this.refs.$menu.scrollTop((0,Qe.vX)(0,1,e)*t)},template:function(){var e=this;return X.Z.getFromMacro("skfb_front/macros/components/atoms/dropdown","dropdown",[{isOpen:this.state.isOpen&&!this.options.disabled,labelTitle:this.options.labelTitle,labelValue:this.options.labelValue,longestLabelValue:this.options.longestLabelValue,placeholder:this.options.placeholder,color:this.options.color,disabled:this.options.disabled,withBackground:this.options.withBackground,grey:this.options.grey,theme:this.options.theme,className:this.options.className,components:this.createChildrenComponents({child:[].concat(this.options.child).map((function(t,i){return He(He({},t),{},{options:He(He({},t.options),{},{key:t.options.key||i,dropdown:{isOpen:e.state.isOpen,onToggle:e.onToggle.bind(e),scrollToHeightPercent:e.scrollToHeightPercent.bind(e)}})})}))})}])}});var We=(0,Le.Z)((function(e,t){return e+t})),je=function(e,t){return(0,Ue.zy)(e,{},(function(e){return e.value===t}))},qe=Ze.Z.extend({displayName:"DropdownOptionList",mixins:[ke.Z],optionTypes:{value:Be.Z.string.isRequired,options:Be.Z.arrayOf(Be.Z.shape({title:Be.Z.string.isRequired,value:Be.Z.string.isRequired,default:Be.Z.bool}).isRequired).isRequired,onSelectOption:Be.Z.func.isRequired,dropdown:Be.Z.shape({isOpen:Be.Z.bool.isRequired,onToggle:Be.Z.func.isRequired,scrollToHeightPercent:Be.Z.func.isRequired}).isRequired,color:Be.Z.string,theme:Be.Z.string,closeOnSelection:Be.Z.bool},events:{'click [data-action="select-option"]':"onOptionClick",'mouseenter [data-action="select-option"]':"onMouseEnterOption",'mouseleave [data-action="select-option"]':"onMouseLeaveOption","keydown window":"onWindowKeyDown"},viewDidMount:function(){this.updateScrollPosition()},viewDidUpdate:function(){this.updateScrollPosition()},getSelectedIndex:function(){return this.options.options.indexOf(je(this.options.options,this.options.value))},onOptionClick:function(e){this.options.onSelectOption(e.target.getAttribute("data-value")),this.options.closeOnSelection&&this.options.dropdown.isOpen&&this.options.dropdown.onToggle()},onMouseEnterOption:function(e){e.target.style.color=this.options.color},onMouseLeaveOption:function(e){e.target.getAttribute("data-active")||(e.target.style.color="")},onWindowKeyDown:function(e){this.options.dropdown.isOpen&&this.options.options.length&&(38!==e.which&&40!==e.which||e.preventDefault(),38===e.which&&this.selectIndex(We(-1)),40===e.which&&this.selectIndex(We(1)))},selectIndex:function(e){var t=this.getSelectedIndex(),i=this.options.options.length,n=(i+e(t))%i;this.options.onSelectOption(this.options.options[n].value),this.scrollAtNextRender=!0},scrollToSelectedOption:function(){var e=(this.getSelectedIndex()-1)/this.options.options.length;this.options.dropdown.scrollToHeightPercent(e)},updateScrollPosition:function(){this.scrollAtNextRender&&(this.scrollAtNextRender=!1,this.scrollToSelectedOption())},template:function(){return X.Z.getFromString(["<ul class=\"c-dropdown-select {{ '--' + theme + '-theme' if theme else '' }}\">","    {% for optionItem in options %}","        {% set isActive = optionItem.value == value %}","        <li",'            class="c-dropdown-select__option {{ {',"                '--active': isActive",'            } | class_names }}"','            style="{{ {',"                'color': color if isActive else ''",'            } | style }}"','            {% if isActive %} data-active="true" {% endif %}','            data-value="{{ optionItem.value }}"','            data-action="select-option">',"            {{ optionItem.title }}","        </li>","    {% endfor %}","</ul>"].join("\n"),{options:this.options.options,value:this.options.value,color:this.options.color,theme:this.options.theme})}});const Je=Ze.Z.extend({displayName:"DropdownSelect",optionTypes:{value:Be.Z.string.isRequired,onChange:Be.Z.func.isRequired,options:Be.Z.arrayOf(Be.Z.shape({title:Be.Z.string.isRequired,value:Be.Z.string.isRequired,default:Be.Z.bool}).isRequired).isRequired,title:Be.Z.string,placeholder:Be.Z.string,color:Be.Z.string,theme:Be.Z.oneOf(["dark","light","white-background","grey-background"]),menuAlign:Be.Z.oneOf(["left","right"]),disabled:Be.Z.bool,closeOnSelection:Be.Z.bool,autoScale:Be.Z.bool},defaultOptions:{theme:"light",closeOnSelection:!0,autoScale:!1},initialize:function(){Ze.Z.prototype.initialize.apply(this,arguments);var e=this.getDefaultValue();!this.options.value&&e&&this.options.onChange(e)},getDefaultValue:function(){return(0,Ue.zy)(this.options.options,{},(function(e){return e.default})).value},template:function(){return X.Z.getFromString("{{ components.dropdown | component }}",{components:this.createChildrenComponents({dropdown:{viewClass:ze,options:{disabled:this.options.disabled,labelTitle:this.options.title,labelValue:je(this.options.options,this.options.value).title,longestLabelValue:this.options.autoScale?this.options.options.reduce((function(e,t){return e.length>t.title.length?e:t.title}),""):"",placeholder:this.options.placeholder,color:this.options.color,theme:this.options.theme,className:this.options.className,menuAlign:this.options.menuAlign,child:{viewClass:qe,options:{value:this.options.value,options:this.options.options,color:this.options.color,theme:this.options.theme,closeOnSelection:this.options.closeOnSelection,onSelectOption:this.options.onChange}}}}})})}});i("R8ae");const Ye=Ze.Z.extend({displayName:"SwitchButton",optionTypes:{isChecked:Be.Z.bool.isRequired,onChange:Be.Z.func.isRequired,prepopulated:Be.Z.bool,disabled:Be.Z.bool,name:Be.Z.string},defaultOptions:{prepopulated:!1,disabled:!1,name:""},events:{click:function(e){e.preventDefault(),this.options.onChange(!this.options.isChecked)}},initialize:function(){Ze.Z.prototype.initialize.apply(this,arguments),this.options.prepopulated&&this.options.onChange(this.refs.$input.prop("checked"))},template:function(){return X.Z.getFromMacro("skfb_front/macros/components/atoms/switch-button","switch_button",[{isChecked:this.options.isChecked,name:this.options.name,disabled:this.options.disabled}])}});i("S0rz");function Ke(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Xe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(i),!0).forEach((function(t){G()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ke(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const $e=Ze.Z.extend({displayName:"LabelSwitchButton",optionTypes:{isChecked:Be.Z.bool.isRequired,onChange:Be.Z.func.isRequired,label:Be.Z.string,error:Be.Z.string,attrs:Be.Z.object},defaultOptions:{attrs:{}},template:function(){var e=this.options.isTouched&&!!this.options.error;return X.Z.getFromMacro("skfb_front/macros/components/molecules/label-switch-button","label_switch_button",[{label:this.options.label,error:e?this.options.error:"",components:this.createChildrenComponents({switchButton:{viewClass:Ye,options:Xe(Xe({},this.options),{},{attrs:{classNames:Xe({"--error":e},this.options.attrs.classNames)}})}})}])}});function et(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function tt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?et(Object(i),!0).forEach((function(t){G()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):et(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var it=c.Z.shortcuts,nt={render:{title:"Render ("+it.inspectorControl.shortcuts[0].keyCombinations+")",displayViews:[{text:"Final Render",icon:"viewer-icon-final-render",value:"Default",has2dView:!1},{text:"No Post-Processing",icon:"viewer-icon-final-render",value:"DefaultNoPostProcess",has2dView:!1}]},animation:{title:"Animation ("+it.inspectorControl.shortcuts[4].keyCombinations+")",displayViews:[{text:"Bones",icon:"viewer-icon-bones",value:"Bones",has2dView:!0},{text:"Bones Influence",icon:"viewer-icon-influences",value:"BoneWeights",has2dView:!0}]},materials:{title:"Material channels ("+it.inspectorControl.shortcuts[1].keyCombinations+")",displayViews:[{text:"Albedo",icon:"viewer-icon-diffuse",value:"DiffusePBR",has2dView:!0},{text:"Base Color",icon:"viewer-icon-diffuse",value:"AlbedoPBR",has2dView:!0},{text:"Diffuse",icon:"viewer-icon-diffuse",value:"DiffuseColor",has2dView:!0},{text:"Specular",icon:"viewer-icon-specular",value:"SpecularPBR",has2dView:!0},{text:"Metalness",icon:"viewer-icon-metalness",value:"MetalnessPBR",has2dView:!0},{text:"Specular Color",icon:"viewer-icon-specular",value:"SpecularColor",has2dView:!0},{text:"Glossiness",icon:"viewer-icon-roughness",value:"GlossinessPBR",has2dView:!0},{text:"Anisotropy",icon:"viewer-icon-normal-map",value:"Anisotropy",has2dView:!0},{text:"Roughness",icon:"viewer-icon-roughness",value:"RoughnessPBR",has2dView:!0},{text:"Specular Glossiness",icon:"viewer-icon-specular",value:"SpecularHardness",has2dView:!0},{text:"Scattering",icon:"viewer-icon-subsurface",value:"SubsurfaceScattering",has2dView:!0},{text:"Translucency",icon:"viewer-icon-subsurface",value:"SubsurfaceTranslucency",has2dView:!0},{text:"Normal Map",icon:"viewer-icon-normal-map",value:"NormalMap",has2dView:!0},{text:"Bump Map",icon:"viewer-icon-normal-map",value:"BumpMap",has2dView:!0},{text:"AO map",icon:"viewer-icon-AO",value:"AOPBR",has2dView:!0},{text:"Cavity",icon:"viewer-icon-AO",value:"CavityPBR",has2dView:!0},{text:"Lightmap",icon:"viewer-icon-lightmap",value:"DiffuseIntensity",has2dView:!0},{text:"Displacement",icon:"viewer-icon-displacement",value:"Displacement",has2dView:!0},{text:"Opacity",icon:"viewer-icon-transparency",value:"Opacity",has2dView:!0},{text:"Alpha Masking",icon:"viewer-icon-transparency",value:"AlphaMask",has2dView:!0},{text:"Emission",icon:"viewer-icon-emission",value:"EmitColor",has2dView:!0},{text:"Specular F0",icon:"viewer-icon-specular",value:"SpecularF0",has2dView:!0},{text:"Vertex Color",icon:"viewer-icon-diffuse",value:"VertexColor",has2dView:!0},{text:"Vertex Alpha",icon:"viewer-icon-transparency",value:"VertexAlpha",has2dView:!0},{text:"Clear Coat",icon:"viewer-icon-specular",value:"ClearCoat",has2dView:!0},{text:"Clear Coat Roughness",icon:"viewer-icon-roughness",value:"ClearCoatRoughness",has2dView:!0},{text:"Clear Coat Normal Map",icon:"viewer-icon-normal-map",value:"ClearCoatNormalMap",has2dView:!0},{text:"Sheen",icon:"viewer-icon-specular",value:"Sheen",has2dView:!0},{text:"Sheen Roughness",icon:"viewer-icon-roughness",value:"SheenRoughness",has2dView:!0}]},geometry:{title:"Geometry ("+it.inspectorControl.shortcuts[2].keyCombinations+")",displayViews:[{text:"Matcap",icon:"viewer-icon-final-render",value:"MatcapFlat",has2dView:!1},{text:"Matcap+Surface",icon:"viewer-icon-final-render",value:"MatcapDetail",has2dView:!1},{text:"Wireframe",icon:"viewer-icon-geometry",value:"Wireframe",has2dView:!0},{text:"Vertex Normals",icon:"viewer-icon-vertex-normals",value:"VertexNormal",has2dView:!1}]},uv:{title:"UV ("+it.inspectorControl.shortcuts[3].keyCombinations+")",displayViews:[{text:"UV Checker",icon:"viewer-icon-UV",value:"UVChecker",has2dView:!0}]}},rt=X.Z.getFromString('\n        <div class="model-inspector__wireframe">\n            {{ wireframe | safe }}\n        </div>\n        <div class="model-inspector__single-sided-button"></div>\n        {{ components.singleSidedButton | component }}\n        {% if inspectableTextures or isStaff %}\n            <div class="mode__title">Viewport{%if not inspectableTextures and isStaff %} (Staff only){% endif %}</div>\n            <div class="toggle-button{%if not inspectableTextures and isStaff %} --staff{% endif %}">\n                <span class="toggle-button__option">\n                    <input type="radio" name="splitType" data-value="3d" id="splitType-3d">\n                    <label for="splitType-3d">3D</label>\n                </span>\n                <span class="toggle-button__option">\n                    <input type="radio" name="splitType" data-value="split" id="splitType-split">\n                    <label for="splitType-split">3D + 2D</label>\n                </span>\n                <span class="toggle-button__option">\n                    <input type="radio" name="splitType" data-value="2d" id="splitType-2d">\n                    <label for="splitType-2d">2D</label>\n                </span>\n            </div>\n        {% endif %}\n       {% for category, mode in modes %}\n            {% if mode.displayViews %}\n                <div class="mode__title">{{ mode.title }}</div>\n            {% endif %}\n            <ul>\n                {% for button in mode.displayViews %}\n                    <li                        class="mode {{ "selected" if button.value == active else "" }}" data-mode="{{ mode.title }}" data-value="{{ button.value }}"\n                        style="{{ button.style }}"\n                    >\n                        <i class="mode__icon {{ button.icon }}"></i>\n                        <span>{{ button.text }}</span>\n                    </li>\n                    {% endfor %}\n            </ul>\n       {% endfor %}\n    '),at=["displayView","material","splitType","texCoord","forceSingleSided"],ot={displayView:"Default",forceSingleSided:!1,splitType:"3d"};const st=te.Z.extend({mixins:[(0,Ee.Z)(".js-scrollable")],children:{singleSidedButton:{selector:".model-inspector__single-sided-button",viewClass:$e,options:function(){var e=this;return{label:"Single Sided",isChecked:Boolean(this.model.get("forceSingleSided")),onChange:function(t){return e.model.set("forceSingleSided",t)}}}},materialSelector:{selector:".model-inspector__2D-options .model-inspector__material-options",viewClass:Je,shouldCreateChild:function(){return this.canInspectTextures()&&"3d"!==this.model.get("splitType")},options:function(){var e=this;return{theme:"dark",value:this.model.get("material").toString(),onChange:function(t){return e.model.set("material",t)},options:this.model.get("materialList").filter((function(e){return!e.uidUniqueMerged})).map(function(e){var t=e.uidListUnusedDuplicates.length?"Merged ("+e.name+", ...)":e.name;return{title:this.model.materialHasTextureInView2d(e.uid)?t:t+" (no texture)",value:e.uid}}.bind(this)).sort((function(e,t){return e.title<t.title?-1:e.title>t.title?1:void 0})),closeOnSelection:!1,autoScale:!0}}},UVSelector:{selector:".model-inspector__2D-options .model-inspector__UV-options",viewClass:Je,shouldCreateChild:function(){return this.canInspectTextures()&&this.model.getCurrentUVs().length>1},options:function(){return{theme:"dark",value:this.model.get("texCoord").toString(),onChange:function(e){this.model.set("texCoord",e)}.bind(this),options:this.model.getCurrentUVs().sort((function(e,t){return e-t})).map((function(e){return{title:"UV "+e.toString(),value:e.toString()}})),closeOnSelection:!1,autoScale:!0}}}},events:{"click .mode":"onSelectDisplayView","click .model-inspector__minimize":"toggleVisibility",'click [name="splitType"]':"onSelectSplitType","click [data-setting]":"changeWireframe"},initialize:function(){te.Z.prototype.initialize.apply(this,arguments),this.initializeShortcuts(),this.updateModes(),this.updateSavedState(),this._selectors=this.$(".model-inspector__2D-options"),this.render(),this._selectors.css({visibility:"hidden"})},delegateEvents:function(){te.Z.prototype.delegateEvents.apply(this,arguments),this.model.on("change:displayView",this.updateDisplayViewUI,this),this.model.on("change:material change:texCoord change:displayView change:forceSingleSided",this.renderChildren,this),this.model.on("change:material change:displayView change:splitType",this.update2DView,this),this.model.on("change:availableDisplayView",this.updateAvailableDisplayView,this),this.model.on("change:uiVisible",this.show,this)},undelegateEvents:function(){te.Z.prototype.undelegateEvents.apply(this,arguments),this.model.off("change:displayView",this.updateDisplayViewUI,this),this.model.off("change:material change:texCoord change:displayView change:forceSingleSided",this.renderChildren,this),this.model.off("change:material change:displayView change:splitType",this.update2DView,this),this.model.off("change:availableDisplayView",this.updateAvailableDisplayView,this),this.model.off("change:uiVisible",this.show,this)},updateModes:function(){var e=this.model.get("availableDisplayView");this.modes=(0,Fe.Z)(nt,(function(t,i,n){var r=i.displayViews.filter((function(t){return-1!==e.indexOf(t.value)}));if(0===r.length)return t;var o=(0,a.Z)({},i,{displayViews:r});return t[n]=o,t}),{}),this.modeNamesWith2d=(0,Fe.Z)(this.modes,(function(e,t){var i=t.displayViews.filter((function(e){return e.has2dView})).map((function(e){return e.value}));return e.concat(i)}),[])},changeWireframe:function(e){var t=e.currentTarget.dataset.setting,i=e.currentTarget.dataset.value;if("wireframeEnable"===t){var n=!this.options.wireframeModel.get("wireframeEnable");return this.options.wireframeModel.set("wireframeEnable",n)}this.options.wireframeModel.set("wireframeEnable",!0),this.options.wireframeModel.set(t,i)},onSelectDisplayView:function(e){var t=e.currentTarget.getAttribute("data-value");this.model.set("displayView",t)},canInspectTextures:function(){return this.options.inspectableTextures||j.Z.me().get("isStaff")},_currentModeHas2dView:function(){var e=this.model.get("displayView");return-1!==this.modeNamesWith2d.indexOf(e)},_getDisplayViewLabel:function(){return this.$el.find("[data-value="+this.model.get("displayView")+"]").text().trim()},updateDisplayViewUI:function(){this.$el.find(".selected").removeClass("selected"),this.$el.find("[data-value="+this.model.get("displayView")+"]").addClass("selected")},updateAvailableDisplayView:function(){this.updateModes(),-1===this.model.get("availableDisplayView").indexOf(this._savedState.displayView)&&(this._savedState.displayView="Default"),this.render()},update2DView:function(){if(this.canInspectTextures())if(this.updateSelectorsUI(),"3d"===this.model.get("splitType")||this.model.materialHasContentInView2d(this.model.get("material")))this.$el.find(".model-inspector__empty-2d-view").text("");else{var e=this.model.get("materialByUid")[this.model.get("material")].name,t=this.$el.find(".model-inspector__empty-2d-view"),i="2d"===this.model.get("splitType")?"50%":"25%",n="";n=this._currentModeHas2dView()?"No data in "+e+"/"+this._getDisplayViewLabel():"2D view isn't available for "+this._getDisplayViewLabel()+".<br>Select a Material Channel to view textures.",t.html(n).css("right",i)}},updateSelectorsUI:function(){"3d"!==this.model.get("splitType")&&this._currentModeHas2dView()?this._selectors.css({visibility:"visible"}):this._selectors.css({visibility:"hidden"})},onSelectSplitType:function(e){this.canInspectTextures()&&this.model.set("splitType",e.currentTarget.getAttribute("data-value"))},initializeShortcuts:function(){var e=new b.Z(it.inspectorControl),t=this.onShortcut.bind(this),i=function(){this.toggle()}.bind(this);e.on("render materials geometry uv animation",t),e.on("inspector",i),e.listen()},onShortcut:function(e){var t=this.modes[e.id];if(t){var i=this._savedState.displayView,n=((0,Oe.Z)(t.displayViews,(function(e){return e.value===i}))+1)%t.displayViews.length,r=t.displayViews[n];this.model.get("uiVisible")?this.options.osd.hide():(0,m.Z)()?this.model.set("uiVisible",!0):this.options.osd.show(r.text,{duration:1e3}),this.model.set("displayView",r.value),this.updateSavedState()}},close:function(){this.$el.removeClass("--show"),this.updateSavedState(),this.model.set(ot)},show:function(e,t){this.$el.toggleClass("--show --open",t)},restoreState:function(){this.model.set(this._savedState)},updateSavedState:function(){var e=this;this._savedState=at.reduce((function(t,i){return tt(tt({},t),{},G()({},i,e.model.get(i)))}),{})},toggle:function(){this.model.get("uiVisible")?(this.model.set("uiVisible",!1),this.close()):(this.model.set("uiVisible",!0),this.restoreState())},toggleVisibility:function(){this.$el.toggleClass("--open")},render:function(){var e=this.viewer.proxySettings.get("setting.name");this.$(".model-inspector__modes").html(rt({inspectableTextures:this.options.inspectableTextures,modes:this.modes,active:this.model.get("displayView"),wireframe:pe({wireframeColor:e}),isStaff:j.Z.me().get("isStaff")})),this.renderChildren(),this.afterRender()},afterRender:function(){this.$('[data-value="'+this.model.get("splitType")+'"]').prop("checked",!0)}}),lt=te.Z.extend({events:{"click .osd":"hide"},show:function(e,t){this.osdTimeout&&window.clearTimeout(this.osdTimeout),t=(0,a.Z)({position:"center"},t);var i=this.$(".osd");i.find(".osd-content").html(e),i.addClass("active"),i.removeClass("osd-top osd-center"),i.addClass("osd-"+t.position),t.duration&&(t.duration=Math.max(0,t.duration),t.duration!==1/0&&(this.osdTimeout=setTimeout(this.hide.bind(this),t.duration)))},hide:function(){this.$(".osd").removeClass("active")}});var ut=i("98X6"),ht=i("LyKb"),ct=i("gQUg"),At=i("Oyie"),dt=Re.Z.osg;const gt=te.Z.extend({events:{"mouseover .snapshot .button":"showGuides","mouseout .snapshot .button":"hideGuides"},initialize:function(){te.Z.prototype.initialize.apply(this,arguments),this.$el.find(".snapshot .button").on("click",this.onSnapshot.bind(this))},onSnapshot:function(e){var t=this.viewer.scene;e.preventDefault();var i=this.$el.find(".snapshot"),n=this.$el.find(".snapshot-flash"),r=this.$el.find(".img-container");if(!i.hasClass("progress")){i.addClass("progress"),n.addClass("active"),setTimeout((function(){n.removeClass("active")}),2e3);var a=!0,o=t.getFeatures();if(o.camera){o.camera.getModel().saveCameraPosition();var s=t.getFeatures().saveUI;s||((s=new ht.Z).init(t.getFeaturesManager()._context),s._views[0].enableSaving()),a=s._views[0].save()}At.all([t.getScreenShot(1920,1080),a]).then(this.onTakeScreenshot.bind(this,i,r))}},onTakeScreenshot:function(e,t,i){var n=i[0].toDataURL("image/jpeg"),r=(0,ct.Z)(n),a=new ut.Z({imageFile:r}),o=this.viewer._currentModel,s=a.save({modelUID:o.get("uid")}),l=t.find("img");l&&(l.remove(),null!==this.previewTimeout&&(window.clearTimeout(this.previewTimeout),this.previewTimeout=null));var u=new Image;u.src=n,t.prepend(u),t.removeClass("invisible"),this.previewTimeout=setTimeout((function(){t.addClass("invisible")}),4e3),s.then((function(){e.removeClass("progress"),e.addClass("success"),setTimeout((function(){e.removeClass("success")}),2e3)})).catch((function(){new ce.Z({title:"Save settings error",text:"An unexpected error happened. The thumbnail has NOT been saved.",buttons:{ok:!0}}).open(),dt.error("Error while saving snapshot"),e.removeClass("progress")}))},showGuides:(0,s.Z)((function(){this.$(".snapshot-guides").addClass("active")}),100),hideGuides:(0,s.Z)((function(){this.$(".snapshot-guides").removeClass("active")}),100)});var ft=i("AFIE");const pt=te.Z.extend({_isHover:!1,events:{touchstart:"onTouchStart",mousedown:"onClick",mouseover:"onMouseover",mouseout:"onMouseout",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){te.Z.prototype.initialize.apply(this,arguments),this.previousValue=null,this._touched=!1,this.$icon=this.$(".fa"),this.listenTo(this.model,"change:volume",this.render.bind(this)),this.render(),this.$volumeMenu=this.$(".volume-menu"),this.slider=new ft.Z(void 0,{model:this.model,global:!0,orientation:"vertical"}),this.$volumeMenu.append(this.slider.$el),this.initializeShortcuts()},delegateEvents:function(){te.Z.prototype.delegateEvents.apply(this,arguments),r()(window).on("mouseup.delegateEvents"+this.cid,this.onVolumeInteractionEnd.bind(this)),r()(window).on("touchend.delegateEvents"+this.cid,this.onVolumeInteractionEnd.bind(this))},undelegateEvents:function(){te.Z.prototype.undelegateEvents.apply(this,arguments),r()(window).off(".delegateEvents"+this.cid)},initializeShortcuts:function(){this.soundControlShortcuts=new b.Z(c.Z.shortcuts.sound),this.soundControlShortcuts.on("mute",this.toggleMute.bind(this)),this.soundControlShortcuts.listen()},onTouchStart:function(){this._touched=!0},onClick:function(e){e.preventDefault();var t=r()(e.target);t.is(".volume-menu")||t.parents(".volume-menu").length||this.toggleMute()},onMouseEnter:function(){this._isHover=!0},onMouseLeave:function(){this._isHover=!1},toggleMute:function(){this.slider.onoff()},togglePane:function(e){this.$el.toggleClass("--active",e)},onMouseover:function(){this._touched?this._touched=!1:this.togglePane(!0)},onMouseout:function(){!1===this.slider.started&&this.togglePane(!1)},onVolumeInteractionEnd:function(){this.model.get("enable")&&(this._isHover||this.togglePane(!1))},show:function(){this.viewer.$el.addClass("sound-enabled")},hide:function(){this.viewer.$el.removeClass("sound-enabled")},render:function(){var e=this.model.get("volume");return this.$icon.toggleClass("fa-volume-up",e>=.5),this.$icon.toggleClass("fa-volume-down",e>0&&e<.5),this.$icon.toggleClass("fa-volume-off",0===e),this}});var mt=c.Z.shortcuts,_t=new(d())({device:"WEB",listen:!0});const vt=g.Z.extend({subviews:{},events:{'click [data-action="start"]':"onStart",'click [data-action="stop"]':"onStop",click:"globalCloseEvent",touchend:"globalCloseEvent",'click [data-action="inspector"]':"toggleInspector",'click [data-action="ascii"]':"toggleASCII"},initialize:function(){g.Z.prototype.initialize.apply(this,arguments),this.canDisplay3D=(0,p.Z)()&&!(0,y.Z)().forceFallback,this.proxySettings=new u.Z({shadingStyle:null,viewerMode:null,wireframeColor:null,wireframeEnable:null,hasWireframe:null,annotationsVisible:null,textureQuality:null,speed:null,cycleMode:null,fps:null}),this.initializeMandatorySubviews(),this.initializeHashMessages(),this.initializeSoundManager(),this.delegateGlobalMoveEvent(),this.delegateSubviews(),this.isVR()&&_.default.apple.device&&this.hackIosCanvasRender(),_.default.any||!v.Z||(0,y.Z)().transparent||this.hackDesktopSafariCanvasBackground()},_createSubview:function(e,t,i){return this.subviews[e]=new t((0,a.Z)({},{viewer:this,widgets:this.subviews},i)),this.subviews[e]},globalCloseEvent:function(e){r()(e.target).hasClass("has-menu")||r()(e.target).parents(".has-menu").length||(this.subviews.hotspots&&this.subviews.hotspots.toggleAnnotationList(!1),this.subviews.gui.closeMenus())},delegateGlobalMoveEvent:function(){var e;(0,m.Z)()||(this.el.addEventListener("touchmove",this.preventScroll.bind(this),{passive:!1}),this.$el.on("mousedown touchstart",function(e){"canvas"===e.target.tagName.toLowerCase()&&(clearTimeout(this._showGuiTimeout),clearTimeout(this._hideGuiTimeout),this._hideGuiTimeout=setTimeout(function(){this.$el.addClass("moving")}.bind(this),150))}.bind(this)),this.$el.on("mouseup touchend",function(e){"canvas"===e.target.tagName.toLowerCase()&&(clearTimeout(this._hideGuiTimeout),clearTimeout(this._showGuiTimeout),e.preventDefault(),this._showGuiTimeout=setTimeout(function(){this.$el.hasClass("moving")&&this.$el.removeClass("moving")}.bind(this),500))}.bind(this)),this.$el.on("wheel",function(t){"canvas"===t.target.tagName.toLowerCase()&&(this.$el.addClass("moving"),clearTimeout(e),e=setTimeout(function(){this.$el.removeClass("moving")}.bind(this),300))}.bind(this)),r()(this.el).on("mouseout",function(e){var t=e.relatedTarget||e.toElement;_.default.any||(clearTimeout(this.globalIdleTimeout),this.$el.find(t).length||(this.globalIdleTimeout=setTimeout(this.onGlobalIdleTimeout.bind(this),3500)))}.bind(this)),r()(this.el).on("mouseenter mousein",function(){clearTimeout(this.globalIdleTimeout),(this.$el.hasClass("idle")||this.$el.hasClass("moving"))&&(this.$el.removeClass("idle moving"),(0,o.Z)(this.subviews,(function(e){e.trigger("idle",!1)})))}.bind(this)))},preventScroll:function(e){if(e.target.classList.contains("canvas"))return e.preventDefault();var t=void 0!==e.target.dataset.hotspotTarget;this.subviews&&this.subviews.helpOverlay&&!this.subviews.helpOverlay.isVisible()&&!t&&e.preventDefault()},onGlobalIdleTimeout:function(){(0,m.Z)()||(this.$el.addClass("idle"),(0,o.Z)(this.subviews,(function(e){e.trigger("idle",!0)})))},initializeMandatorySubviews:function(){this._createSubview("gui",be,{el:this.$el}),this._createSubview("loading",Pe,{el:this.$(".loading-container")}),this._createSubview("hint",Te,{el:this.$el,fallback:!this.canDisplay3D}),this._createSubview("generalControls",_e,{el:this.canDisplay3D?this.$(".general-controls"):this.$(".fallback .controls"),fallback:!this.canDisplay3D}),this._createSubview("header",Se,{el:this.$(".titlebar")}),this._createSubview("snapshot",gt,{el:this.$el}),this._createSubview("helpOverlay",Ie,{el:this.$(".help.overlay")}),this._createSubview("hotspotsOverlay",Me,{el:this.$(".hotspots-overlay")}),this._createSubview("arOverlayDesktop",V.Z.extend({setUrl:function(e){this.$(".url").attr("href",e).text(e)}}),{el:this.$(".ar-overlay-desktop")}),this._createSubview("arOverlayMobile",V.Z.extend({setPlatform:function(e){this.$(".mobilePlatform").text(e)},setMinVersion:function(e){this.$(".minVersion").text(e)}}),{el:this.$(".ar-overlay-mobile")}),this._createSubview("arOverlayLoading",V.Z.extend({}),{el:this.$(".ar-overlay-loading")}),this._createSubview("arOverlayErrorMessage",V.Z.extend({}),{el:this.$(".ar-overlay-error")}),this._createSubview("helperVrOverlay",V.Z.extend({setUrl:function(e){this.$(".url").attr("href",e)}}),{el:this.$(".helper-vr-overlay")}),this._createSubview("osd",lt,{el:this.$el})},initShortcuts:function(){this.viewerRenderingShortcuts=new b.Z(mt.viewerRendering),this.viewerRenderingShortcuts.on("toggleWireframe",function(){if(this.proxySettings.get("hasWireframe")&&(0,y.Z)().uiInspector){var e=!this.proxySettings.get("wireframeEnable");this.proxySettings.set("wireframeEnable",e)}}.bind(this)),this.viewerRenderingShortcuts.on("inspector",this.toggleInspector,this),this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("toggleWireframe"),this.viewerRenderingShortcuts.getShortcut("inspector")]),this.viewerRenderingShortcuts.on("defaultRenderingMode",function(){this.proxySettings.set("shadingStyle","lit")}.bind(this)),this.viewerRenderingShortcuts.on("shadelessRenderingMode",function(){this.proxySettings.set("shadingStyle","shadeless")}.bind(this)),this.viewerRenderingShortcuts.on("matcapRenderingMode",function(){this.proxySettings.set("shadingStyle","matcap")}.bind(this)),this.updateShorcuts()},updateShorcuts:function(){"lit"===this._currentModel.get("options").shading.type||(0,m.Z)()?this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("defaultRenderingMode"),this.viewerRenderingShortcuts.getShortcut("shadelessRenderingMode"),this.viewerRenderingShortcuts.getShortcut("matcapRenderingMode")]):this.viewerRenderingShortcuts.stopListening(["defaultRenderingMode","shadelessRenderingMode","matcapRenderingMode"])},blurHotspots:function(){this.subviews.hotspots&&(this.subviews.hotspots.hideTooltips(),this.subviews.hotspots.currentHotspot=-1,this.subviews.hotspots.renderControl())},initializeHashMessages:function(){(0,y.Z)().isApp&&_t.on("message:vrMode",function(e){var t=parseInt(e.data.vrMode,10);this.blurHotspots(),this.scene.getFeatures().webVR.getModel().set("enable",!!t),e.removeFromHash()}.bind(this))},initializeHotspotsSubviews:function(e){var t=this;Promise.all([i.e(2698),i.e(6932),i.e(95),i.e(53)]).then(i.bind(i,"U5lI")).then((function(i){var n=i.default,r=t.scene.getFeatures().hotspot.getModel();(t._createSubview("hotspots",n,{el:t.$el,model:r,container:t.$(".hotspots"),fallback:!t.canDisplay3D}),0===(0,y.Z)().annotationTooltipVisible)&&t.subviews.hotspots.hideTooltips();"function"==typeof e&&e()}))},initializeAnimationSubviews:function(e){var t=this;i.e(7697).then(i.bind(i,"9boD")).then((function(i){var n=i.default,r=t.scene.getFeatures().animation.getModel();t._createSubview("animationControls",n,{el:t.$(".animation-controls"),model:r,currentModel:t._currentModel,enabled:!t.isVR()}),"function"==typeof e&&e()}))},delegateSubviews:function(){this.isVR()?(this.subviews.gui.disable(),this.subviews.header.disable()):(this.subviews.loading.on("loaded",setTimeout.bind(window,this.subviews.gui.enable.bind(this.subviews.gui),500)),this.subviews.header.enable()),this.subviews.loading.on("loaded",function(){(0,y.Z)().transparent||this.$el.addClass("transparent-pattern")}.bind(this))},onStart:function(){this.start(),this._startTracked||(this._startTracked=!0)},start:function(){this.$el.addClass("started"),this.$el.hasClass("transparent")||this.$el.addClass("transparent-pattern"),this._options&&this.load();var e=this.scene&&this.scene.getViewerOSGJS&&this.scene.getViewerOSGJS();return e&&k.Z.getHasAnimation().then(function(t){if(t){var i=this.scene.getFeatures().animation.getModel();this._wasPlaying&&(i.set("playing",!0),this._wasPlaying=void 0)}e.run()}.bind(this)),B.Z.setEnabled(!0),this.trigger("started"),this},onStop:function(){this.subviews.modelInspector&&(this.subviews.modelInspector.close(),r()(".summary").removeClass("shifted"),r()(".watermark").removeClass("shifted-watermark")),this.stop()},stop:function(){this.$el.removeClass("started");var e=this.scene&&this.scene.getViewerOSGJS&&this.scene.getViewerOSGJS();return e&&(k.Z.getHasAnimation().then(function(e){if(e){var t=this.scene.getFeatures().animation.getModel();this._wasPlaying=t.get("playing"),this._wasPlaying&&t.set("playing",!1)}}.bind(this)),e.stop()),this.subviews.hotspots&&this.subviews.hotspots.triggerHotspotCycle(!1),B.Z.setEnabled(!1),this.trigger("stopped"),this},load:function(){if(this._options){var e=this._options;this._options=null,this.scene&&(this.scene.drop(),this.scene=null),this.subviews.loading.reset(),this.$el.removeClass("model-loaded"),this.$el.addClass("model-loading"),u.Z.get(e.uid).then(this.onModelLoad.bind(this,e)).catch((function(e){console.warn(e)}))}},lookat:function(e,t,i){void 0===i&&(i=1);var n=this.scene.getFeatures().camera.getModel();n.set("animationDuration",i),n.setTargetAndEye(t,e)},isVR:function(){return this.scene?this.scene.getFeatures().webVR.getModel().get("enable"):(0,y.Z)().cardboard>0},isCardboard:function(){return(0,y.Z)().cardboard>0},onModelLoad:function(e,t){E.Z.client.configureScope((function(e){e.setTag("frontend","3d")})),this._currentModel=t,t.hit(),this.scene=this.createScene(t,e);var i=this.scene;this.subviews.loading.handleLoading({model:t,scene:i}),i.run(),this.canDisplay3D?(this.initShortcuts(),this.initViewerFeatures(),this.subviews.hint.show(),this.trigger("model-loaded"),E.Z.client.configureScope((function(e){e.setTag("frontend","web")}))):this.$el.addClass("fallback-mode")},errorHandler:function(e){if(e instanceof f.r){var t,n,r,o,s,l=(0,C.Jw)(e.account);switch(e.feature){case"sound":n="sound track",r="sounds",s=e.limit===c.Z.maxSoundtracksPerModel.ent;break;case"hotspot":n="annotation",r="annotations",s=e.limit===c.Z.maxHotspotsPerModel.ent;break;default:throw e}if(s)o=["You have reached the maximum number of <b>"+n+"s</b> allowed by Sketchfab.","Have custom needs?"],t={text:"Contact us",callback:function(e){e.preventDefault(),Promise.all([i.e(6952),i.e(2356)]).then(i.bind(i,"O3Ms")).then((function(e){return new e.default({title:"Get in touch"}).open()}))}};else{var u=e.value?e.value-e.limit:0;o=["You have reached the maximum number of <b>"+e.limit+" "+n+S.pluralize(e.limit)+"</b> allowed by your plan.","To add a new "+n+", you need to "+(u?" delete "+u+" "+n+S.pluralize(e.limit)+" or ":"")+"upgrade to "+l+" plan."],t={href:"/plans",text:"Upgrade to "+l}}new U.Z((0,a.Z)(e,{popupSubTitle:"You cannot add a new "+n,popupMessages:o,additionalButton:t,popupImg:r})).open()}else this.subviews.osd.show(e.message,arguments)},setScene:function(e){if(this.scene)throw new Error("It is currently impossible to reset a scene");return this._options=e,this._currentUid=e.uid,this},createScene:function(e,t){if(this.canDisplay3D){var i={};return i.el=this.$(".webgl"),i.features=t.features,i.widgetAPI=t.widgetAPI,i.model=e,i.viewerAPI=t.viewerAPI,new Z.Z(i)}return new R({model:e,el:this.$(".fallback"),features:t.features})},initViewerFeatures:function(){this.initializeSound(),k.Z.getModelDisplayed().then(function(){k.Z.getHasAnimation().then(function(e){e&&this.initializeAnimation()}.bind(this)),this.initializeHotspots(),this.initializeShading(),this.initializeViewerMode(),this.initializeTextureQuality(),this.initializeVr(),this.initializeModelInspector()}.bind(this))},initializeHotspots:function(){var e=this.scene.getFeatures().hotspot,t=e&&e.getModel();t&&this.initializeHotspotsSubviews(function(){var e=this.subviews.hotspots;t.setUpdateCallback(e.refreshHotspots.bind(e));var i=t.get("hotspots");i.on("add remove sort change:title change:description change:position",e.refreshHotspots,e),i.on("add remove sort change:name",e.updateHotspotsControls,e),i.on("add remove",(0,s.Z)(this.subviews.generalControls.renderSettings,100),this.subviews.generalControls),i.on("select",e.onHotspotSelected,e),i.on("add",e.showAnnotations,e),i.on("remove",(function(){0===i.length&&e.hideAnnotations()})),this.proxySettings.on("change:annotationsVisible",function(){i.length&&this.proxySettings.get("annotationsVisible")?e.showAnnotations():e.hideAnnotations()}.bind(this)),this.proxySettings.set("annotationsVisible",t.get("visible"),{silent:!0}),t.set("proxyModel",this.proxySettings),e.refreshHotspots(),e.updateHotspotsControls(),k.Z.getFirstCameraAnimation().then(function(){if(t.on("hotspot-error",this.errorHandler.bind(this)),!0===(0,y.Z)().annotationCycleAutostart){var e=Math.max((0,y.Z)().annotation,1);i.trigger("select",i.at(e-1)),this.subviews.hotspots.triggerHotspotCycle(!0)}else(0,y.Z)().annotation>0&&i.trigger("select",i.at((0,y.Z)().annotation-1))}.bind(this))}.bind(this))},initializeAnimation:function(){var e=this.scene.getFeatures().animation.getModel();this.initializeAnimationSubviews(function(){this.$el.addClass("has-animation"),this.subviews.generalControls.setHasAnimations(!0),this.proxySettings.set("speed",e.get("speed")),this.proxySettings.set("cycleMode",e.get("cycleMode")),this.proxySettings.set("fps",e.get("fps")),this.proxySettings.on("change:speed",(function(t,i){e.set("speed",i)})),this.proxySettings.on("change:cycleMode",(function(t,i){e.set("cycleMode",i)})),this.proxySettings.on("change:fps",(function(t,i){e.set("fps",i)})),e.on("change:fps",function(e,t){this.proxySettings.set("fps",t)}.bind(this)),this.$(".osd").addClass("padded"),this.$(".timeline").removeClass("disabled")}.bind(this))},isFeatureAvailable:function(e,t,i){return e&&t&&0!==i.length},initializeModelInspector:function(){var e=this.scene.getFeatures().inspector,t=this.proxySettings,i=this.$(".model-inspector");if(this.isFeatureAvailable((0,y.Z)().uiInspector,e,i)){var n=e.getModel();this._createSubview("modelInspector",st,{model:n,inspectableTextures:(0,m.Z)()||this.scene.model.get("isInspectable"),wireframeModel:t,osd:this.subviews.osd,el:i}),(0,y.Z)().uiInspectorOpen&&this.toggleInspector(),this.subviews.generalControls.listenTo(n,"change:uiVisible",function(e,t){this.$('[data-action="inspector"]').toggleClass("active",t),r()(".viewer").toggleClass("--shifted",t),this.subviews.animationControls&&this.subviews.animationControls.updateBarWidth()}.bind(this)),(0,m.Z)()&&this.listenTo(n,"change:uiVisible",function(e,t){var i=this.scene._widgetAPI,n=this.subviews.modelInspector.model;t?(n.initAvailableView(),i.alert("To edit the model, close the Inspector.",{continue:!0,continueLabel:"Close Inspector"}).then(function(){this.$("canvas").focus(),this.toggleInspector()}.bind(this)).catch((function(e){if("Resuming editor"!==e)throw e}))):i.resume()}.bind(this))}else this.$('[data-action="inspector"]').hide()},toggleInspector:function(){this.subviews.modelInspector&&(this.subviews.modelInspector.toggle(),this.subviews.snapshot.$(".snapshot.widget").toggle(),this.subviews.header.$(".actions").toggle())},toggleASCII:function(){var e=new URLSearchParams(window.location.search);e.set("post_process_ascii","1"!==e.get("post_process_ascii")?"1":"0"),window.location.search=e.toString()},initializeTextureQuality:function(){var e=this,t=this.scene.getFeatures().quality;if(t){var i=t.getModel();i.get("promiseReady").then(function(e){this.subviews.generalControls.generateTextureQualitySettings(e),this.subviews.generalControls.settings.onTextureQualityReady.call(this.subviews.generalControls.settings,e)}.bind(this)),this.proxySettings.on("change:textureQuality",(function(){var t=parseInt(this.get("textureQuality"),10);window.requestAnimationFrame((function(){i.set("level",t)}));var n=e.subviews.generalControls.getSettingLabelForValue("textureQuality",t+"");e.$(".control-badge").text(n).addClass("active")}))}},initializeViewerMode:function(){var e=this.scene.getFeatures().camera;if(e){var t=e.getModel(),i=t.get("indexManipulator");this.proxySettings.set("viewerMode",i),this.subviews.gui.renderSetting("viewerMode",i),this.proxySettings.on("change:viewerMode",function(){t.set("indexManipulator",parseInt(this.proxySettings.get("viewerMode"),10)),this.scene.getFeaturesManager().focusOnSavedCamera(1),this.$("canvas").focus()}.bind(this))}},initializeShading:function(){var e=this.scene.getFeatures().shadingStyle;if(e){var t=e.getModel(),i=this,n=function(){i.proxySettings.set("shadingStyle",t.get("type")),i.proxySettings.set("wireframeColor",t.get("wireframeColor")),i.proxySettings.set("wireframeEnable",t.get("wireframeEnable")),i.proxySettings.set("hasWireframe",t.get("hasWireframe")),i.subviews.gui.renderSetting("wireframeColor",i.proxySettings.get("wireframeColor")),i.subviews.gui.renderSetting("wireframeEnable",i.proxySettings.get("wireframeEnable")?1:0),i.subviews.gui.renderSetting("hasWireframe",i.proxySettings.get("hasWireframe")?1:0),i.subviews.gui.renderSetting("shadingStyle",i.proxySettings.get("shadingStyle"))};n(),this.proxySettings.listenTo(t,"change",n),this.proxySettings.on("change:shadingStyle",(function(){t.set("type",this.get("shadingStyle"))})),this.proxySettings.on("change:wireframeColor",(function(){this.get("wireframeEnable")?t.setWireframeColorSmooth(this.get("wireframeColor")):t.set("wireframeColor",this.get("wireframeColor"))})),this.proxySettings.on("change:wireframeEnable",(function(){t.set("wireframeEnable",!!this.get("wireframeEnable"))}))}},initializeVr:function(){this.isVR()?(this.$el.addClass("vr-mode"),1===h.ZP.get("sf_show_vr_hint",1)&&Promise.all([i.e(6932),i.e(95),i.e(9520)]).then(i.bind(i,"syRd")).then(function(e){var t=e.default()([P()]);this.subviews.osd.show(t,{duration:5e3})}.bind(this)),h.ZP.set("sf_show_vr_hint",0,{expires:504e5})):(0,y.Z)().vrLinkNavigation&&this.subviews.osd.show(_.default.any?"Tap on Screen or Press any button to switch to VR":"Press Enter to switch to VR",{duration:5e3})},initializeSoundManager:function(){this.proxySettings.on("sound-error",this.errorHandler.bind(this)),this.proxySettings.on("sound-hide",this.subviews.osd.hide.bind(this.subviews.osd)),this.proxySettings.on("sound-show",this.subviews.osd.show.bind(this.subviews.osd)),B.Z.setProxyModel(this.proxySettings)},initializeSound:function(){var e=this.scene.getFeatures().sound;if(e){var t=e.getModel(),i=t.get("soundtracks"),n=this._createSubview("sound",pt,{el:this.$(".general-controls .volume"),model:t});i.on("add",n.show,n),i.on("remove",(function(){0===i.length&&n.hide()})),i.length&&t.get("visible")?n.show():this._currentModel.get("soundCount")>0&&k.Z.getModelDisplayed().then(function(){this.subviews.osd.show("Sounds have been temporarily disabled.",{position:"top",duration:4e3})}.bind(this)),t.on("sound-error",this.errorHandler.bind(this))}},hackDesktopSafariCanvasBackground:function(){this.$("canvas").parent().css({backgroundColor:"#000"})},hackIosCanvasRender:function(){(0,l.Z)((function(){r()("canvas")[0].style.width=r()("canvas")[0].clientWidth+1+"px",(0,l.Z)((function(){r()("canvas")[0].style.width=r()("canvas")[0].clientWidth-1+"px",r()("canvas")[0].style.width=""}))}))},isStarted:function(){return this.el.classList.contains("started")}})},cgbd:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});i("ytFi");var n=i("/VXM"),r=i("WeWI");const a=i("AxWo").Z.extend({displayName:"MessagePopup",optionTypes:{title:n.Z.string.isRequired,text:n.Z.string.isRequired,buttons:n.Z.shape({cancel:n.Z.bool,cancelClass:n.Z.string,cancelLabel:n.Z.string,close:n.Z.bool,closeClass:n.Z.string,closeLabel:n.Z.string,continue:n.Z.bool,continueClass:n.Z.string,continueLabel:n.Z.string,ok:n.Z.bool,okClass:n.Z.string,okLabel:n.Z.string,delete:n.Z.bool,deleteClass:n.Z.string,deleteLabel:n.Z.string}),popupClass:n.Z.string,safe:n.Z.bool,popupClosable:n.Z.bool,shouldRejectOnCancel:n.Z.bool},defaultOptions:{shouldRejectOnCancel:!0},events:{"reset form":"cancel","submit form":"continue"},template:function(){return r.Z.get("skfb_front/popups/message",{title:this.options.title,text:this.options.text,buttons:this.options.buttons,safe:this.options.safe,popupClass:this.options.popupClass,popupClosable:this.options.popupClosable})}})},Heae6:(e,t,i)=>{"use strict";i.r(t),(0,i("oa+f").Z)(!0);i("uun7"),i("W1n1");var n=i("Hjnd"),r=i.n(n),a=i("3Alh"),o=i("fszX"),s=i("5Cxy"),l=i("lVmk"),u=i("Cx7h"),h=i.n(u),c=i("lZH+"),A=i.n(c);const d=function(){return{_viewer:void 0,version:"0.2",initialize:function(e,t){this._viewer=e,this._uid=t;var i=this;window.addEventListener("message",(function(e){if(e.data&&e.data.command){var t=e.data;"initialize"!==t.command&&Object.prototype.hasOwnProperty.call(i,t.command)&&i[t.command].call(i,t)}}),!1)},ready:function(){this.answer({status:"load"})},clientReady:function(){return A().resolve()},answer:function(e){e.source=this._uid,void 0!==window.parent&&window.parent.postMessage(e,"*")},start:function(){this._viewer.start(),this.answer({status:"start"})},stop:function(){this._viewer.stop(),this.answer({status:"stop"})},lookat:function(e){this._viewer.lookat&&(this._viewer.lookat(e.eye,e.target,e.duration),window.setTimeout(function(){this.answer({status:"lookat"})}.bind(this),1e3*e.duration),this.answer({status:"lookat start"}))},autospin:function(e){!1===e&&(e=0),this.answer({status:"autospin"})},getViewerAPI:function(){}}};var g=i("uuWb"),f=i("xVFn"),p=i("iEQ1"),m=g.Z.osg,_=function(){m.NodeVisitor.apply(this,arguments),this.reset()};m.createPrototypeObject(_,m.objectInherit(m.NodeVisitor.prototype,{reset:function(){this._nodes=[],this._nodeMap={},this._nodeList={},this._dirty=!0},isDirty:function(){return this._dirty},getRootNode:function(){return this._nodes[0]},getRealNodeMap:function(){return this._nodeList},getRepresentationNodeMap:function(){return this._nodeMap},createNodeEntry:function(e){this._dirty=!1;var t=e.getInstanceID();this._nodeList[t]||(this._nodeList[t]=e);var i={name:e.getName(),instanceID:t,nodeMask:e.getNodeMask()};return this._nodeMap[t]||(this._nodeMap[t]=i),i},applyNode:function(e){var t=this._nodes;this._nodes=[],this.traverse(e);var i=this.createNodeEntry(e);i.children=this._nodes,i.type="Group",t.push(i),this._nodes=t},applyMatrixTransform:function(e){var t=this._nodes;this._nodes=[],this.traverse(e);var i=this.createNodeEntry(e);i.children=this._nodes,i.type="MatrixTransform",i.localMatrix=m.mat4.clone(e.getMatrix()),i.worldMatrix=e.getWorldMatrices()[0],t.push(i),this._nodes=t},applyGeometry:function(e){var t=this._nodes;this._nodes=[],this.traverse(e);var i=this.createNodeEntry(e);i.type=e.className(),t.push(i),this._nodes=t},apply:function(e){var t=e.getTypeID();t===m.Node.typeID?this.applyNode(e):t===m.MatrixTransform.typeID?this.applyMatrixTransform(e):e instanceof m.Geometry?this.applyGeometry(e):this.traverse(e)}}));const v=_;var C=i("WIA/"),b=i("iO85");function S(){this.handlers=[],this.events=[]}S.prototype={subscribe:function(e){this.events.forEach((function(t){e(t.name,t.args)}));var t=this.handlers.push(e);return function(){this.handlers.split(t-1,1)}},emit:function(e,t){this.events.push({name:e,args:t}),this.handlers.forEach((function(i){i(e,t)}))}};const E=S;var y=g.Z.osg,I=function(e){this._translateUpdateCallbackListPerNode={},this._rotateUpdateCallbackListPerNode={},this._nodeList=e};I.prototype={addTranslateUpdateCallback:function(e,t,i){var n=this._translateUpdateCallbackListPerNode[i];n&&(y.mat4.setTranslation(e.getMatrix(),n._target),t._source=n._target),this._translateUpdateCallbackListPerNode[i]=t},addRotateUpdateCallback:function(e,t,i){var n=this._rotateUpdateCallbackListPerNode[i];if(n){var r=n._target,a=y.mat4.create(),o=y.vec3.create();y.mat4.fromQuat(a,r),y.mat4.getTranslation(o,e.getMatrix()),y.mat4.setTranslation(a,o),y.mat4.copy(e.getMatrix(),a),t._source=n._target}this._rotateUpdateCallbackListPerNode[i]=t},removeTranslateUpdateCallback:function(e){delete this._translateUpdateCallbackListPerNode[e]},removeRotateUpdateCallback:function(e){delete this._rotateUpdateCallbackListPerNode[e]},update:function(e,t){var i,n,r;for(n in this._rotateUpdateCallbackListPerNode)i=this._rotateUpdateCallbackListPerNode[n],r=this._nodeList[n],i.update(r,t);for(n in this._translateUpdateCallbackListPerNode)i=this._translateUpdateCallbackListPerNode[n],r=this._nodeList[n],i.update(r,t);return!0}};var x=function(e,t,i,n,r){this._source=e,this._target=t,this._duration=i,this._started=-1,this._easing=n,this._finished=!1,this._callback=r};x.prototype={isFinished:function(){return this._finished},update:function(e,t){if(this._finished)return!0;b.Z.redrawShadow();var i=t.getFrameStamp().getSimulationTime();this._started<0&&(this._started=i);var n=(i-this._started)/this._duration;return n>1&&(this._finished=!0,this._callback&&this._callback(this._result),n=1),this._easing&&(n=this._easing(n)),this.interpolate(n,e),!0}};var T=function(e,t,i,n,r){x.call(this,e,t,i,n,r),this._result=y.vec3.create()};T.prototype=y.objectInherit(x.prototype,{interpolate:function(e,t){y.vec3.lerp(this._result,this._source,this._target,e),y.mat4.setTranslation(t.getMatrix(),this._result),t.dirtyBound()}});var w=function(e,t,i,n,r){x.call(this,e,t,i,n,r),this._result=y.quat.create(),this._translate=y.vec3.create(),this._finalResult=y.mat4.create()};w.prototype=y.objectInherit(x.prototype,{interpolate:function(e,t){y.quat.slerp(this._result,this._source,this._target,e),y.mat4.getTranslation(this._translate,t.getMatrix()),y.mat4.fromQuat(this._finalResult,this._result),y.mat4.setTranslation(this._finalResult,this._translate),y.mat4.copy(t.getMatrix(),this._finalResult),t.dirtyBound()}});var M,R,B=i("8AWZ"),N=i("HF+a"),D=g.Z.osg,P=g.Z.osgAnimation,F=function(e){this._partial=e,this._events={},this._replayEmitter=new E,this._partial.on("model-loaded",function(){this._emitEvents()}.bind(this)),this._sceneGraphVisitor=new v,this._nodeMap=void 0};F.prototype={_filterAnnotationModelMessage:function(e){delete e.refreshAction,delete e.sticky},addGlobalListener:function(e){this._replayEmitter.subscribe(e)},intersectPoint:function(e,t,i,n){var r=this._getFeatureModel("material").findFirstMaterial(e._nodePath);this._replayEmitter.emit("click",{position3D:t,position2D:i,normal:n,instanceID:this._getHitNodeID(e),material:r?r.getJSON():null})},_getFeatureModel:function(e){var t=this._partial.scene.getFeatures()[e];if(t)return t.getModel()},_getViewerOSG:function(){return this._getViewer()._viewer},_getViewer:function(){return this._partial.scene},_emitEvents:function(){var e=["viewerready","annotationFocus","annotationBlur","click"];this._partial.scene.on("all",function(t,i){-1!==e.indexOf(t)&&this._replayEmitter.emit(t,i)}.bind(this)),this.emitEvents=function(){}},_computeSceneGraph:function(){var e=this._sceneGraphVisitor;e.isDirty()&&this._getViewer().getRootModel().accept(e)},_getRootNode:function(){return this._computeSceneGraph(),this._sceneGraphVisitor.getRootNode()},_getRealNodeMap:function(){return this._computeSceneGraph(),this._sceneGraphVisitor.getRealNodeMap()},_getRepresentationNodeMap:function(){return this._computeSceneGraph(),this._sceneGraphVisitor.getRepresentationNodeMap()},_convertDataUriToImage:function(e,t,i){var n=this._getFeatureModel("material").getImageCollection();C.Z.instance.getOrCreateImage(e).promise.then((function(r){var a=n.addNewImage({uid:t,url:e,width:r.getWidth(),height:r.getHeight(),name:e.slice(0,100)});i(null,a.getUID())})).catch((function(){i("failed to add texture")}))},start:function(e){this._partial.start(),e(null)},stop:function(e){this._partial.stop(),e(null)},load:function(e){this._partial.load(),e(null)},gotoAnnotation:function(e,t){var i=this._getFeatureModel("hotspot").get("hotspots"),n=i.at(e);i.trigger("select",n),t(null,e)},getAnnotationList:function(e){var t=this._getFeatureModel("hotspot").get("hotspots").toJSON();t.forEach(this._filterAnnotationModelMessage.bind(this)),e(null,t)},lookat:function(e,t,i,n){this.setCameraLookAt(e,t,i,n)},setFov:function(e,t){var i=this._getFeatureModel("camera");i.set("dollyPrevent",!0);var n=i.setJSON({fov:e});t(n.length?n:null,e),i.set("dollyPrevent",!1)},getCurrentTime:function(e){var t=this._getFeatureModel("animation"),i=t.getCurrentAnimation().get("duration");e(null,t.get("progress")*i/100)},play:function(e){this._getFeatureModel("animation").set("playing",!0),e(null)},pause:function(e){var t=this._getFeatureModel("animation");t?(t.set("playing",!1),e(null)):e("no animation feature")},seekTo:function(e,t){var i=this._getFeatureModel("animation"),n=100*e/i.getCurrentAnimation().get("duration");i.trigger("seek",n),t(null)},getAnimations:function(e){var t=this._getFeatureModel("animation"),i=[];t.get("animations").forEach((function(e){var t=[];t.push(e.get("uid")),t.push(e.get("name")),t.push(e.get("duration")),i.push(t)})),e(null,i)},setCurrentAnimationByUID:function(e,t){this._getFeatureModel("animation").set("currentUID",e),t(null)},setCycleMode:function(e,t){var i=this._getFeatureModel("animation");1===i.get("animations").length&&"all"===e&&(e="one");var n=i.setJSON({cycleMode:e},{validate:!0,warnOnError:!0});t(n&&n.length?n:null)},setSpeed:function(e,t){var i=this._getFeatureModel("animation").setJSON({speed:e},{validate:!0,warnOnError:!0});t(i&&i.length?i:null,e)},getSceneGraph:function(e){e(null,this._getRootNode())},getNodeMap:function(e){e(null,this._getRepresentationNodeMap())},getNodeMask:function(e,t){var i=this._getNodeFromUserNodeID(e);i?t(null,i.getNodeMask()):t("node with id "+e.toString()+" not found")},getMatrix:function(e,t){var i=this._getNodeFromUserNodeID(e);i?t(null,{local:i.getMatrix(),world:i.getWorldMatrices()[0]}):t("node with id "+e.toString()+" not found")},setMatrix:function(e,t,i){var n=this._getNodeFromUserNodeID(e);n?(D.mat4.copy(n.getMatrix(),t),n.dirtyBound(),i(null),b.Z.redrawShadow()):i("node with id "+e.toString()+" not found")},hide:function(e,t){var i=this._getNodeFromUserNodeID(e);i?(i.setNodeMask(0),t(null)):t("show: node id "+e+" not found"),b.Z.redrawShadow()},show:function(e,t){var i=this._getNodeFromUserNodeID(e);i?(i.setNodeMask(-1),t(null)):t("show: node id "+e+" not found"),b.Z.redrawShadow()},translate:function(){var e,t,i=arguments.length,n=arguments[i-1],r=arguments[0],a=arguments[1];4===i?e=arguments[2]:5===i&&(e=arguments[2],t=arguments[3]),e=e||0;var o=P[t]||P.easeOutQuad,s=this._getNodeFromUserNodeID(r);if(s)if(s.getTypeID()===D.MatrixTransform.typeID){if(e>0){var l=D.vec3.create();D.mat4.getTranslation(l,s.getMatrix());var u=new T(l,a,e,o,(function(e){s.removeUpdateCallback(u),n(null,e)}));s.addUpdateCallback(u)}else D.mat4.setTranslation(s.getMatrix(),a),s.dirtyBound(),n(null,a);b.Z.redrawShadow()}else n("you can only translate MatrixTransform nodes");else n("node with id "+r.toString()+" not found")},rotate:(M=D.vec3.create(),R=D.vec3.create(),function(){var e,t,i=arguments.length,n=arguments[i-1],r=arguments[0],a=arguments[1];4===i?e=arguments[2]:5===i&&(e=arguments[2],t=arguments[3]),e=e||0;var o=P[t]||P.easeOutQuad,s=this._getNodeFromUserNodeID(r);if(s)if(s.getTypeID()===D.MatrixTransform.typeID){var l=D.quat.create(),u=D.mat4.create();if(D.mat4.fromRotation(u,-a[0],D.vec3.set(R,a[1],a[2],a[3])),D.mat4.getRotation(l,u),e>0){var h=D.quat.create();D.mat4.getRotation(h,s.getMatrix());var c=new w(h,l,e,o,(function(e){s.removeUpdateCallback(c),n(null,e)}));s.addUpdateCallback(c)}else D.mat4.fromQuat(u,l),D.mat4.getTranslation(M,s.getMatrix()),D.mat4.setTranslation(u,M),D.mat4.copy(s.getMatrix(),u),s.dirtyBound(),n(null,a);b.Z.redrawShadow()}else n("you can only translate MatrixTransform nodes");else n("node with id "+r.toString()+" not found")}),getRootMatrixNode:function(e){var t=this._getViewer().getRootModel();if(t||e("No scene loaded"),!this._nodeInTheMiddle){this._nodeInTheMiddle=new D.MatrixTransform,this._nodeInTheMiddle.setName("NITM");for(var i=t.getChildren(),n=0,r=i.length;n<r;n++)this._nodeInTheMiddle.addChild(i[n]);t.removeChildren(),t.addChild(this._nodeInTheMiddle)}e(null,this._nodeInTheMiddle.getInstanceID(),this._nodeInTheMiddle.getMatrix())},getCameraLookAt:function(e){var t=this._getViewerOSG().getManipulator(),i=[],n=[];t.getTarget(i),t.getEyePosition(n),e(null,{position:n,target:i})},setCameraLookAt:function(e,t){var i=this._getFeatureModel("camera"),n=this._getViewerOSG().getManipulator(),r=arguments[arguments.length-1],a=3===arguments.length?2:arguments[2];a<=0?n.setTargetAndEye(t,e):(i.setTargetAndEye(t,e),i.set("animationDuration",a)),b.Z.redrawShadow(),r(null)},getScreenShot:function(){var e,t,i=arguments.length,n=arguments[i-1],r="image/jpeg";if(2===i)r=arguments[0];else if(3===i)e=Math.floor(arguments[0]),t=Math.floor(arguments[1]);else if(4===i)e=Math.floor(arguments[0]),t=Math.floor(arguments[1]),r=arguments[2];else if(1!==i)return void n("Wrong number of arguments, signature should be (width, height, [callback]), (width, height, mimetype, [callback]), (mimetype, [callback]) or ([callback]).");var a=this._getViewer().getScreenShot(e,t);n(null,a.toDataURL(r))},getMaterialList:function(e){var t=this._getFeatureModel("material");e(null,(0,f.Z)(t.getJSON()))},getTextureList:function(e){e(null,this._getFeatureModel("material").getImageCollection().toJSON())},addTexture:function(e,t){this._convertDataUriToImage(e,void 0,t)},updateTexture:function(e,t,i){this._convertDataUriToImage(e,t,function(e){if(e)i(e);else{var n=this._getFeatureModel("material").getMaterials();for(var r in n){var a=n[r].getChannels();for(var o in a){var s=a[o],l=s.getTextureModel();l&&l.getUID()===t&&s.trigger("updateChannel")}}i(null,t)}}.bind(this))},setTextureQuality:function(e,t){var i=this._getFeatureModel("quality");i.get("promiseReady").then(function(n){var r={ld:0,sd:1,hd:2};if(n.high||(r={ld:0,hd:1}),n.mid||(r={hd:0}),e in r){var a=r[e];i.set("level",a),t(null,"texture quality set to "+a)}else{var o=(0,p.Z)(r,(function(e,t){return t})).join(", ");t(['Quality must be a string "ld", "sd" or "hd".'," Available qualities for this model are : ",o].join(""),null)}}.bind(this))},setMaterial:function(e,t){var i=this._getFeatureModel("material"),n=e.stateSetID,r=i.getMaterialByStateSetID(n);r.setMaterialJSON(e,i.getImageCollection(),{validate:!1,warnOnError:!1}),r.trigger("apply"),b.Z.redrawShadow(),t(null)},setPostProcessing:function(e,t){this._getFeatureModel("postProcess").set(e),t(null)},getPostProcessing:function(e){e(this._getFeatureModel("postProcess").toJSON())},getWorldToScreenCoordinates:function(e,t){var i=B.Z.getScreenPositionFromWorldPoint(e);t({glCoord:i.slice(0,2),canvasCoord:N.Z.glCoordToCanvas(i[0],i[1],i).slice(0,2)})},_getNodeFromUserNodeID:function(e){return this._getRealNodeMap()[e]},_getHitNodeID:function(e){if(e&&e._nodePath&&e._nodePath.length){var t=e._nodePath[e._nodePath.length-1];if(t)return t.getInstanceID()}},fakeGeneral:function(){}};const O=F;var L,k,Z,U,V=i("xWkn"),Q=i("+eNq"),G=i("2oON"),H=i("N96t"),z=i("O/gg"),W=i("/Wmr"),j=i("Oyie"),q=g.Z.osg,J=function(){O.apply(this,arguments),this._displayed=!1,z.Z.getModelDisplayed().then(function(){this._displayed=!0}.bind(this)),this._pickMask={click:Q.Z.PICK_GEOMETRY_FAST,mousemove:Q.Z.PICK_GEOMETRY_FAST}};J.prototype=(0,W.Z)(O.prototype,{addGlobalListener:function(e){H.Z.getBoxReady().then(function(){V.Z.initViewerAPI(this),this._getViewer().getInputManager().setEnable(G.Z.SCENE_VIEWERAPI,!0)}.bind(this)),this._replayEmitter.subscribe(e)},intersectPoint:void 0,_emitEvents:function(){var e={viewerready:"viewerready",started:"viewerstart",stopped:"viewerstop",annotationFocus:"annotationFocus",annotationBlur:"annotationBlur",annotationMouseEnter:"annotationMouseEnter",annotationMouseLeave:"annotationMouseLeave",annotationSelect:"annotationSelect",nodeMouseEnter:"nodeMouseEnter",nodeMouseLeave:"nodeMouseLeave",click:"click",cameraStart:"camerastart",cameraStop:"camerastop"},t=function(t,i){var n=e[t];n&&this._replayEmitter.emit(n,i)}.bind(this);this._partial.on("all",t),this._partial.scene.on("all",t),this._emitEvents=function(){}},onCursorUp:(k=q.vec3.create(),Z=q.vec3.create(),U=q.vec2.create(),function(e){if(this._displayed){U[0]=e.canvasX,U[1]=e.canvasY;var t=B.Z.computeNearestIntersection2D(U[0],U[1],this._pickMask.click),i={position3D:null,position2D:U,normal:null,instanceID:null,material:null};if(t){B.Z.getWorldPositionFromHit(t,Z,k);var n=this._getFeatureModel("material").findFirstMaterial(t._nodePath);i.normal=k,i.position3D=Z,i.instanceID=this._getHitNodeID(t),i.material=n?n.getJSON():null,this._replayEmitter.emit("click",i)}else this._replayEmitter.emit("click",i)}}),onMouseMove:function(){var e,t,i=q.vec3.create(),n=q.vec3.create(),r=q.vec2.create();return function(a){if(this._displayed){r[0]=a.canvasX,r[1]=a.canvasY;var o=B.Z.computeNearestIntersection2D(r[0],r[1],this._pickMask.click);if(o){B.Z.getWorldPositionFromHit(o,n,i);var s=this._getHitNodeID(o),l=this._getFeatureModel("material").findFirstMaterial(o._nodePath);if(t===s)return;return t&&this._replayEmitter.emit("nodeMouseLeave",{position3D:null,position2D:null,normal:i,instanceID:t,material:e}),t=s,e=l?l.getJSON():null,void this._replayEmitter.emit("nodeMouseEnter",{position3D:n,position2D:r,normal:i,instanceID:t,material:e})}t&&(this._replayEmitter.emit("nodeMouseLeave",{position3D:n,position2D:r,normal:i,instanceID:t,material:e}),t=void 0,e=void 0)}}}(),setListenerOptions:function(e){if(e&&"function"!=typeof e)switch(e.name){case"click":this._pickMask.click="slow"===e.pick?Q.Z.PICK_GEOMETRY_SLOW:Q.Z.PICK_GEOMETRY_FAST;break;case"nodeMouseEnter":case"nodeMouseLeave":this._pickMask.mousemove="slow"===e.pick?Q.Z.PICK_GEOMETRY_SLOW:Q.Z.PICK_GEOMETRY_FAST}},pickColor:(L=new Uint8Array(4),function(e,t){new j(function(t,i){var n=this._getViewerOSG().getCamera();n.setFinalDrawCallback((function(r){var a=r.getGraphicContext();if(a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE){a.flush(),a.finish();var o=e[0]*(a.drawingBufferWidth/a.canvas.clientWidth),s=a.drawingBufferHeight*(1-e[1]/a.canvas.clientHeight);a.readPixels(o,s,1,1,a.RGBA,a.UNSIGNED_BYTE,L),t(L),n.setFinalDrawCallback(void 0)}else i()}))}.bind(this)).then((function(){t(L)}))}),unselectAnnotation:function(e){this.gotoAnnotation(-1,e)},requestRedraw:function(){b.Z.redrawShadow()},fakeGeneral:function(){}});const Y=J;var K=i("UNIa"),X=g.Z.osg,$=g.Z.osgAnimation,ee=function(){Y.apply(this,arguments),this.updateDaemon=void 0};ee.prototype=(0,W.Z)(Y.prototype,{setCameraEasing:function(e){this._getFeatureModel("camera").set("easingFunction",e)},hideAnnotation:function(e,t){this._getFeatureModel("hotspot").get("hotspots").at(e).set("visible",!1),b.Z.draw(),t(null)},showAnnotation:function(e,t){this._getFeatureModel("hotspot").get("hotspots").at(e).set("visible",!0),b.Z.draw(),t(null)},createAnnotation:function(e,t,i,n,r,a,o){var s=B.Z.computeNearestIntersection3D(e,t);if(!s)return o(null);var l=this._getFeatureModel("hotspot"),u=l.createHotspot(s,!0);K.Z.getMarkdownPreview(a).then((function(e){u.set({name:r,content:{raw:a,rendered:e.result},eye:i,target:n}),b.Z.redrawShadow(),o(null,l.get("hotspots").length-1),b.Z.draw()}),function(){u.set({name:r,eye:i,target:n}),b.Z.redrawShadow(),o(null,l.get("hotspots").length-1),b.Z.draw()}.bind(this))},updateAnnotation:function(e){var t,i=this._getFeatureModel("hotspot").get("hotspots"),n=i.at(e);if(3===arguments.length){var r=arguments[1],a={};if(r.title&&(a.name=r.title),r.content&&(a.content={raw:r.content}),r.eye&&(a.eye=r.eye),r.target&&(a.target=r.target),t=arguments[2],r.content)return void K.Z.getMarkdownPreview(r.content).then(function(e){a.content.rendered=e.result;var i=n.toJSON();this._filterAnnotationModelMessage(i),t(null,i),n.set(a),b.Z.draw()}.bind(this),function(){var e=n.toJSON();this._filterAnnotationModelMessage(e),t(null,e),n.set(a),b.Z.draw()}.bind(this));n.set(a)}else t=arguments[1];var o=n.toJSON();this._filterAnnotationModelMessage(o),b.Z.redrawShadow(),t(null,o)},getAnnotation:function(e,t){var i=this._getFeatureModel("hotspot").get("hotspots").at(e).toJSON();this._filterAnnotationModelMessage(i),t(null,i)},removeAnnotation:function(e,t){var i=this._getFeatureModel("hotspot").get("hotspots"),n=i.at(e);i.remove(n),b.Z.redrawShadow(),t(null)},pickFromScreen:function(){var e=X.vec3.create(),t=X.vec3.create();return function(i,n){var r=B.Z.computeNearestIntersection2D(i[0],i[1],this._pickMask.click);if(!r)return n(null);B.Z.getWorldPositionFromHit(r,t,e);var a=this._getHitNodeID(r),o=this._getFeatureModel("material").findFirstMaterial(r._nodePath);n(null,{position3D:t,position2D:i,normal:e,instanceID:a,material:o?o.getJSON():null})}}(),pickFromScene:function(){var e=X.vec3.create(),t=X.vec3.create();return function(i,n,r){var a=B.Z.computeNearestIntersection3D(i,n);if(!a)return r(null);B.Z.getWorldPositionFromHit(a,t,e);var o=this._getHitNodeID(a),s=this._getFeatureModel("material").findFirstMaterial(a._nodePath);r(null,{position3D:t,normal:e,instanceID:o,material:s?s.getJSON():null})}}(),addVideoTexture:function(e,t,i){this._convertVideoDataUriToImage(e,void 0,t,i)},_convertVideoDataUriToImage:function(e,t,i,n){var r=this._getFeatureModel("material").getImageCollection();C.Z.instance.getOrCreateImage(e).promise.then((function(a){var o=r.addNewImage({uid:t,url:e,width:a.getWidth(),height:a.getHeight(),name:e.slice(0,100)});void 0!==i&&a.getImage&&(a.getImage().loop=i),n(null,o.getUID())})).catch((function(){n("failed to add texture")}))},translate:function(e,t,i){var n=arguments.length,r=arguments[n-1],a=0,o=$.easeOutQuad;n>2&&((i=arguments[2]).duration&&(a=i.duration),i.easing&&$[i.easing]&&(o=$[i.easing]));var s=this._getNodeFromUserNodeID(e);if(s)if(s.getTypeID()===X.MatrixTransform.typeID){if(a>0){var l=X.vec3.create();X.mat4.getTranslation(l,s.getMatrix());var u=new T(l,t,a,o,function(t){this.updateDaemon.removeTranslateUpdateCallback(e),r(null,t)}.bind(this));this.updateDaemon||this._initUpdateDaemon(),this.updateDaemon.addTranslateUpdateCallback(s,u,e)}else X.mat4.setTranslation(s.getMatrix(),t),s.dirtyBound(),r(null,t);b.Z.redrawShadow()}else r("you can only translate MatrixTransform nodes");else r("node with id "+e.toString()+" not found")},rotate:function(){var e=X.vec3.create(),t=X.vec3.create();return function(i,n,r){var a=arguments.length,o=arguments[a-1],s=0,l=$.easeOutQuad;a>2&&((r=arguments[2]).duration&&(s=r.duration),r.easing&&$[r.easing]&&(l=$[r.easing]));var u=this._getNodeFromUserNodeID(i);if(u)if(u.getTypeID()===X.MatrixTransform.typeID){var h=X.quat.create(),c=X.mat4.create();if(X.mat4.fromRotation(c,-n[0],X.vec3.set(t,n[1],n[2],n[3])),X.mat4.getRotation(h,c),s>0){var A=X.quat.create();X.mat4.getRotation(A,u.getMatrix());var d=new w(A,h,s,l,function(e){this.updateDaemon.removeRotateUpdateCallback(i),o(null,e)}.bind(this));this.updateDaemon||this._initUpdateDaemon(),this.updateDaemon.addRotateUpdateCallback(u,d,i)}else X.mat4.fromQuat(c,h),X.mat4.getTranslation(e,u.getMatrix()),X.mat4.setTranslation(c,e),X.mat4.copy(u.getMatrix(),c),u.dirtyBound(),o(null,n);b.Z.redrawShadow()}else o("you can only rotate MatrixTransform nodes");else o("node with id "+i.toString()+" not found")}}(),_initUpdateDaemon:function(){var e=this._getViewer().getRootModel();this.updateDaemon=new I(this._getRealNodeMap()),e.addUpdateCallback(this.updateDaemon)},fakeGeneral:function(){}});const te=ee;var ie=g.Z.osg,ne=function(){ie.NodeVisitor.apply(this,arguments),this.reset()};ie.createPrototypeObject(ne,ie.objectInherit(ie.NodeVisitor.prototype,{reset:function(){this._nodes=[],this._nodeMap={},this._nodeList={},this._dirty=!0,this._apiSceneID=0},isDirty:function(){return this._dirty},getRootNode:function(){return this._nodes[0]},getRealNodeMap:function(){return this._nodeList},getRepresentationNodeMap:function(){return this._nodeMap},createNodeEntry:function(e){this._dirty=!1;var t=e._uniqueID;this._nodeList[t]||(this._nodeList[t]=e);var i={name:e.getName(),instanceID:t,nodeMask:e.getNodeMask()};return this._nodeMap[t]||(this._nodeMap[t]=i),i},applyNode:function(e){var t=this._nodes;this._nodes=[],this.traverse(e);var i=this.createNodeEntry(e);i.children=this._nodes,i.type="Group",t.push(i),this._nodes=t},applyMatrixTransform:function(e){var t=this._nodes;this._nodes=[],this.traverse(e);var i=this.createNodeEntry(e);i.children=this._nodes,i.type="MatrixTransform",i.localMatrix=ie.mat4.clone(e.getMatrix()),i.worldMatrix=e.getWorldMatrices()[0],t.push(i),this._nodes=t},applyGeometry:function(e){var t=this._nodes;this._nodes=[],this.traverse(e);var i=this.createNodeEntry(e);i.type=e.className(),t.push(i),this._nodes=t},apply:function(e){if(void 0!==e._uniqueID){var t=e.getTypeID();t===ie.Node.typeID?this.applyNode(e):t===ie.MatrixTransform.typeID?this.applyMatrixTransform(e):e instanceof ie.Geometry?this.applyGeometry(e):this.traverse(e)}else this.traverse(e)}}));const re=ne;var ae,oe=g.Z.osg,se=function(){te.apply(this,arguments),this._sceneGraphVisitor=new re,this.updateDaemon=void 0,this._startDrag=!1,this._startCoord=oe.vec2.create()};se.prototype=(0,W.Z)(te.prototype,{addGlobalListener:function(e){H.Z.getBoxReady().then(function(){V.Z.initViewerAPI_1_4(this),this._getViewer().getInputManager().setEnable(G.Z.SCENE_VIEWERAPI_1_4,!0)}.bind(this)),this._replayEmitter.subscribe(e)},onCursorUp:(ae=oe.vec2.create(),function(e){var t=this._startDrag&&oe.vec2.dist(oe.vec2.set(ae,e.glX,e.glY),this._startCoord)>5;this._startDrag=!1,t||Y.prototype.onCursorUp.call(this,e)}),onCursorDown:function(e){oe.vec2.set(this._startCoord,e.glX,e.glY),this._startDrag=!0},getFov:function(e){e(null,this._getFeatureModel("camera").get("fov"))},setCurrentAnimationByUID:function(e,t){O.prototype.setCurrentAnimationByUID.apply(this,arguments),b.Z.redrawShadow(),t(null)},setLight:function(e,t,i){var n=this._getFeatureModel("lighting").get("lights")[e];t&&(void 0!==t.matrix&&n.set("matrix",t.matrix),void 0!==t.enabled&&n.set("enable",t.enabled),void 0!==t.type&&n.set("type",t.type),void 0!==t.shadowEnabled&&n.set("castShadows",t.shadowEnabled),void 0!==t.color&&n.set("color",t.color),void 0!==t.intensity&&n.set("intensity",t.intensity)),b.Z.redrawShadow(),i(null)},getLight:function(e,t){var i=this._getFeatureModel("lighting").get("lights");(!i||e>=i.length)&&t("light with id "+e.toString()+" not found");var n=i[e];t(null,{matrix:n.get("matrix"),enabled:n.get("enable"),shadowEnabled:n.get("castshadows"),color:n.get("color"),intensity:n.get("intensity")})},setEnvironment:function(e,t){var i=this._getFeatureModel("environment");e&&(void 0!==e.enabled&&i.set("enable",e.enabled),void 0!==e.exposure&&i.set("exposure",e.exposure),void 0!==e.lightIntensity&&i.set("lightIntensity",e.lightIntensity),void 0!==e.rotation&&i.set("rotation",e.rotation),void 0!==e.shadowEnabled&&i.set("shadowEnable",e.shadowEnabled)),b.Z.redrawShadow(),t(null)},getEnvironment:function(e){var t=this._getFeatureModel("environment");e(null,{enabled:t.get("enable"),exposure:t.get("exposure"),lightIntensity:t.get("lightIntensity"),rotation:t.get("rotation"),shadowEnabled:t.get("shadowEnable")})},setShadingStyle:function(e,t,i){var n=this._getFeatureModel("shadingStyle");try{n.set("renderer",e),t&&t.type&&n.set("type",t.type)}catch(e){return i(null)}b.Z.redrawShadow(),i(null)},getShadingStyle:function(e){var t=this._getFeatureModel("shadingStyle");e(null,{shadingStyle:t.get("renderer"),type:t.get("type")})},setWireframe:function(e,t,i){var n=this._getFeatureModel("shadingStyle");try{n.set("wireframeEnable",e),t&&t.color&&n.set("wireframeColor",t.color)}catch(e){return i(null)}b.Z.redrawShadow(),i(null)},getWireframe:function(e){var t=this._getFeatureModel("shadingStyle");e(null,{enabled:t.get("wireframeEnable"),color:t.get("wireframeColor")})},_getHitNodeID:function(e){if(e&&e._nodePath&&e._nodePath.length){var t=e._nodePath[e._nodePath.length-1];if(t)return t._uniqueID}},getRootMatrixNode:function(e){var t=this._getViewer().getRootModel();if(t||e("No scene loaded"),!this._nodeInTheMiddle){var i=this._sceneGraphVisitor;i.reset(),this._getViewer().getRootModel().accept(i);var n=0,r=i.getRepresentationNodeMap();for(var a in r){var o=parseInt(a,10);n=n>o?n:o}n++,this._nodeInTheMiddle=new oe.MatrixTransform,this._nodeInTheMiddle.setName("NITM"),this._nodeInTheMiddle._uniqueID=n;for(var s=t.getChildren(),l=0,u=s.length;l<u;l++)this._nodeInTheMiddle.addChild(s[l]);t.removeChildren(),t.addChild(this._nodeInTheMiddle),i.reset(),this._getViewer().getRootModel().accept(i)}e(null,this._nodeInTheMiddle._uniqueID,this._nodeInTheMiddle.getMatrix())},fakeGeneral:function(){}});const le=se;var ue=g.Z.osg,he=function(){re.apply(this,arguments)};ue.createPrototypeObject(he,ue.objectInherit(re.prototype,{setApiCore:function(e){this._apicore=e},createNodeEntry:function(e){this._dirty=!1;var t=e._uniqueID;this._nodeList[t]||(this._nodeList[t]=e);var i=this._apicore._getFeatureModel("material"),n=i?i.findFirstMaterial(this.nodePath):"",r={name:e.getName(),instanceID:t,nodeMask:e.getNodeMask(),materialID:n?n.getJSON().id:null};return this._nodeMap[t]||(this._nodeMap[t]=r),r}}));const ce=he;var Ae=function(){this.actions=[],this.startedAt=0,this.recording=!1};Ae.prototype={addCamera:function(e){if(this.recording){if(this.lastCamera){var t=this.lastCamera;if(t&&t.position[0]===e.position[0]&&t.position[1]===e.position[1]&&t.position[2]===e.position[2]&&t.target[0]===e.target[0]&&t.target[1]===e.target[1]&&t.target[2]===e.target[2])return}this.lastCamera=e,e.type="camera",void 0===e.timeStamp&&(e.timeStamp=this.timeElapsed()),this.actions.push(e)}},addInputEvent:function(e,t){this.recording&&(t.type=e,t.timeStamp=this.timeElapsed(),this.actions.push(t))},start:function(){this.recording||(this.actions=[],this.startedAt=window.performance.now(),this.recording=!0)},stop:function(){this.recording=!1;for(var e=this.actions.length,t=new Float32Array(8*e),i=0,n=0;n<e;n++){var r=this.actions[n];switch(r.type){case"camera":t[i++]=r.timeStamp,t[i++]=1,t[i++]=r.position[0],t[i++]=r.position[1],t[i++]=r.position[2],t[i++]=r.target[0],t[i++]=r.target[1],t[i++]=r.target[2];break;case"click":t[i++]=r.timeStamp,t[i++]=2,t[i++]=r.clientX,t[i++]=r.clientY,t[i++]=r.ctrlKey,t[i++]=r.shiftKey,t[i++]=r.altKey,i++;break;case"wheel":t[i++]=r.timeStamp,t[i++]=3,t[i++]=r.clientX,t[i++]=r.clientY,t[i++]=r.ctrlKey,t[i++]=r.shiftKey,t[i++]=r.altKey,i++;break;case"mousemove":t[i++]=r.timeStamp,t[i++]=4,t[i++]=r.clientX,t[i++]=r.clientY,t[i++]=r.ctrlKey,t[i++]=r.shiftKey,t[i++]=r.altKey,i++;break;case"mousedown":t[i++]=r.timeStamp,t[i++]=5,t[i++]=r.clientX,t[i++]=r.clientY,t[i++]=r.ctrlKey,t[i++]=r.shiftKey,t[i++]=r.altKey,i++;break;case"mouseup":t[i++]=r.timeStamp,t[i++]=6,t[i++]=r.clientX,t[i++]=r.clientY,t[i++]=r.ctrlKey,t[i++]=r.shiftKey,t[i++]=r.altKey,i++;break;case"dblclick":t[i++]=r.timeStamp,t[i++]=7,t[i++]=r.clientX,t[i++]=r.clientY,t[i++]=r.ctrlKey,t[i++]=r.shiftKey,t[i++]=r.altKey,i++}}return this.actions=[],t.slice(0,i)},timeElapsed:function(){return window.performance.now()-this.startedAt}};const de=Ae;var ge=function(){le.apply(this,arguments),this._sceneGraphVisitor=new ce,this._sceneGraphVisitor.setApiCore(this)};ge.prototype=(0,W.Z)(le.prototype,{setAnnotationsTexture:function(e,t){this._getFeatureModel("hotspot").set("textureOptions",e),b.Z.redrawShadow(),t(null)},gotoAnnotation:function(e,t,i){var n=this._getFeatureModel("hotspot").get("hotspots"),r=n.at(e);if(!r)return n.trigger("select",r),void i(null,e);r.set("cameraPreventAnimation",t.preventCameraAnimation),r.set("cameraPreventMove",t.preventCameraMove),n.trigger("select",r),r.set("cameraPreventAnimation",!1),r.set("cameraPreventMove",!1),i(null,e)},_convertVideoDataUriToImage:function(e,t,i,n){var r=this._getFeatureModel("material").getImageCollection();C.Z.instance.getOrCreateImage(e,i||{}).promise.then((function(i){var a=r.addNewImage({uid:t,url:e,width:i.getWidth(),height:i.getHeight(),name:e.slice(0,100)});n(null,a.getUID())})).catch((function(){n("failed to add texture")}))},addVideoTexture:function(e,t,i){this._convertVideoDataUriToImage(e,void 0,t,i)},setBackground:function(e,t){var i=this._getFeatureModel("background");e.uid?(i.set("enable","fixed"),i.set("uid",e.uid)):e.color?(i.set("enable","color"),i.set("color",e.color)):e.enable?i.set("enable",e.enable):e.transparent&&i.set("enable","none"),t(null)},_getUserCollectionList:function(e,t){var i=new XMLHttpRequest;i.open("GET","https://api.sketchfab.com/v3/me/"+t,!0),i.responseType="json",i.onload=function(){if(4===i.readyState&&200===i.status){var t=i.response,n=[];for(var r in t.results){var a=t.results[r];a&&a.uid&&n.push({name:a.name,uid:a.uid})}e(n)}},i.onerror=function(){e(null)},i.send(null)},getBackgroundList:function(e){this._getUserCollectionList(e,"backgrounds")},setEnvironment:function(e,t){var i=this._getFeatureModel("environment");e&&(void 0!==e.enabled&&i.set("enable",e.enabled),void 0!==e.exposure&&i.set("exposure",e.exposure),void 0!==e.lightIntensity&&i.set("lightIntensity",e.lightIntensity),void 0!==e.rotation&&i.set("rotation",e.rotation),void 0!==e.shadowEnabled&&i.set("shadowEnable",e.shadowEnabled),void 0!==e.blur&&i.set("blur",e.blur),void 0!==e.uid&&i.set("uid",e.uid)),b.Z.redrawShadow(),t(null)},getEnvironmentList:function(e){this._getUserCollectionList(e,"environments")},setCycleMode:function(e,t){var i,n=this._getFeatureModel("animation");switch(e){case"loopOne":i="one";break;case"loopAll":i="all";break;case"one":i="oneAndStop";break;case"all":i="";break;default:i=e}n.set("cycleMode",i),b.Z.redrawShadow(),t(null)},_emitEvents:function(){var e={viewerready:"viewerready",started:"viewerstart",stopped:"viewerstop",animationChange:"animationChange",animationEnded:"animationEnded",animationPlay:"animationPlay",animationStop:"animationStop",annotationFocus:"annotationFocus",annotationBlur:"annotationBlur",annotationMouseEnter:"annotationMouseEnter",annotationMouseLeave:"annotationMouseLeave",annotationSelect:"annotationSelect",nodeMouseEnter:"nodeMouseEnter",nodeMouseLeave:"nodeMouseLeave",click:"click",cameraStart:"camerastart",cameraStop:"camerastop"},t=function(t,i){var n=e[t];n&&this._replayEmitter.emit(n,i)}.bind(this);this._partial.on("all",t),this._partial.scene.on("all",t),this._emitEvents=function(){}},_userProvidedEventDispatch:function(e,t,i){if(this.actionsRecorder&&this.actionsRecorder.addInputEvent(e,i),!this._getViewer()||!this._getViewer().getFeaturesManager())return!0;var n=!this._getViewer().getFeaturesManager().getCanvas().dispatchEvent(t);return b.Z.redrawShadow(),n},_userProvidedMouseEventDispatch:function(e,t){var i=new MouseEvent(e,{view:window,bubbles:!0,cancelable:!0,clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey});return this._userProvidedEventDispatch(e,i,t)},mouseMove:function(e,t){t(this._userProvidedMouseEventDispatch("mousemove",e))},mouseDown:function(e,t){t(this._userProvidedMouseEventDispatch("mousedown",e))},mouseUp:function(e,t){t(this._userProvidedMouseEventDispatch("mouseup",e))},mouseClick:function(e,t){t(this._userProvidedMouseEventDispatch("mouseup",e))},mouseDblClick:function(e,t){t(this._userProvidedMouseEventDispatch("dblclick",e))},mouseWheel:function(e,t){var i=new WheelEvent("wheel",{view:window,bubbles:!0,cancelable:!0,deltaX:e.deltaX,deltaY:e.deltaY});t(this._userProvidedEventDispatch("wheel",i,e))},_getCameraInfo:function(){var e={target:[],position:[]};return this.manipulator.getTarget(e.target),this.manipulator.getEyePosition(e.position),e},_cameraRecord:function(){if(this.actionsRecorder){var e=this._getCameraInfo();this.actionsRecorder.addCamera(e),requestAnimationFrame(this._cameraRecordBinding)}},startRecord:function(e){this.actionsRecorder=new de,this.manipulator=this._getViewerOSG().getManipulator();var t=this._getCameraInfo();this.actionsRecorder.start(),t.timeStamp=0,this.actionsRecorder.addCamera(t),this._cameraRecordBinding=this._cameraRecord.bind(this),requestAnimationFrame(this._cameraRecordBinding),e("recording started")},endRecord:function(e){var t=this._getCameraInfo();this.actionsRecorder.addCamera(t),e(this.actionsRecorder.stop()),this.actionsRecorder=void 0},fakeGeneral:function(){}});const fe=ge;var pe=function(){fe.apply(this,arguments)};pe.prototype=(0,W.Z)(fe.prototype,{hideAnnotationTooltip:function(e){this._getFeatureModel("hotspot").get("proxyModel").set("annotationsVisible",!1),e(null)},showAnnotationTooltip:function(e){this._getFeatureModel("hotspot").get("proxyModel").set("annotationsVisible",!0),e(null)},setCameraConstraints:function(e,t){var i=this._getFeatureModel("camera"),n=i.setJSON(e,{validate:!0});i.trigger("change:enableCameraConstraints"),i.set("viewer-api-hotspots",!0),t(n)},setEnableCameraConstraints:function(e,t){this._getFeatureModel("camera").set("enableCameraConstraints",e),t(null)},setAnnotationCameraTransition:function(e,t,i){this._getFeatureModel("hotspot").preventHotspotCameraAction(e,t),i(null)},getAnimations:function(e){var t=this._getFeatureModel("animation").get("animations");if(!t.length)return e(null,[]);var i=new Array(t.length);return t.forEach((function(e){var t=[];t.push(e.get("uid")),t.push(e.get("name")),t.push(e.get("duration")),t.push(e.get("order")),i[e.get("order")]=t})),e(null,i)},_initializeAnnotationMarkdown:function(e,t,i,n,r,a,o){K.Z.getMarkdownPreview(a).then((function(s){t.set({name:r,content:{raw:a,rendered:s.result},eye:i,target:n}),b.Z.redrawShadow(),o(null,e.get("hotspots").length-1),b.Z.draw()}),function(){t.set({name:r,eye:i,target:n}),b.Z.redrawShadow(),o(null,e.get("hotspots").length-1),b.Z.draw()}.bind(this))},createAnnotationFromWorldPosition:function(e,t,i,n,r,a){var o=this._getFeatureModel("hotspot"),s=o.createHotspotFromWorldPosition(e,!0);this._initializeAnnotationMarkdown(o,s,t,i,n,r,a)},createAnnotationFromScenePosition:function(e,t,i,n,r,a){var o=this._getFeatureModel("hotspot"),s=o.createHotspotFromScenePosition(e,!0);this._initializeAnnotationMarkdown(o,s,t,i,n,r,a)},removeAllAnnotations:function(e){for(var t=this._getFeatureModel("hotspot").get("hotspots");t.length>0;)t.remove(t.at(0));b.Z.redrawShadow(),e(null)},recenterCamera:function(e){this._getViewerOSG().getManipulator().computeHomePosition(),e(null)},setUserInteraction:function(e,t){this._getViewer().getInputManager().setEnable(G.Z.SCENE,e),t(null)},fakeGeneral:function(){}});const me=pe;var _e=function(){me.apply(this,arguments)};_e.prototype=(0,W.Z)(me.prototype,{setUVOffset:function(e,t,i,n,r){this._getFeatureModel("material").setUVOffset(e.stateSetID,t,i,n),r(null)},setUVRotation:function(e,t,i,n){this._getFeatureModel("material").setUVRotation(e.stateSetID,t,i),n(null)},setUVScale:function(e,t,i,n,r){this._getFeatureModel("material").setUVScale(e.stateSetID,t,i,n),r(null)},refreshDraw:function(){b.Z.redrawShadow(),b.Z.requestDrawHiddenDefered()},refreshCanvas:function(){var e=this._getViewer().getCanvas(),t=e.width;e.width=t+1,new(A())((function(e){e()})).finally((function(){e.width=t}))},setHighlightOptions:function(e){var t=this._getFeatureModel("outline");t&&(void 0!==e.outlineWidth&&t.set("outlineWidth",e.outlineWidth),void 0!==e.outlineColor&&t.set("colorSelection",e.outlineColor),void 0!==e.highlightColor&&t.set("colorHover",e.highlightColor),void 0!==e.outlineDuration&&t.set("durationOutline",e.outlineDuration),void 0!==e.highlightDuration&&t.set("durationHighlight",e.highlightDuration))},highlightMaterial:function(e){var t=this._getFeatureModel("outline");if(null==e)return t.trigger("hideOutline"),void t.trigger("hideHighlight");var i=this._getFeatureModel("material"),n=e.stateSetID,r=i.getMaterialByStateSetID(n);t.trigger("displayOutlineNoFocus",r.get("stateSet"))},setEnableCameraConstraints:function(e,t){var i=this._getFeatureModel("camera");i.set("enableCameraConstraints",e),i.set("useCameraConstraints",e),t(null)},fakeGeneral:function(){}});const ve=_e;var Ce=g.Z.osg,be=function(){ce.apply(this,arguments)};Ce.createPrototypeObject(be,Ce.objectInherit(ce.prototype,{setApiCore:function(e){this._apicore=e},createNodeEntry:function(e){this._dirty=!1;var t=e._uniqueID;this._nodeList[t]||(this._nodeList[t]=e);var i=this._apicore._getFeatureModel("material"),n=i?i.findFirstMaterial(this.nodePath):"",r={name:e.getName(),instanceID:t,nodeMask:e.getNodeMask(),materialID:n?n.id:null};return this._nodeMap[t]||(this._nodeMap[t]=r),r}}));const Se=be;var Ee=function(){ve.apply(this,arguments),this._sceneGraphVisitor=new Se,this._sceneGraphVisitor.setApiCore(this)};Ee.prototype=(0,W.Z)(ve.prototype,{setSpeed:function(e,t){var i=this._getFeatureModel("animation").setJSON({speed:e},{validate:!0,warnOnError:!0});t(i&&i.length?i:null,e),t(null)},setCameraLookAtEndAnimationCallback:function(){var e=this._getFeatureModel("camera"),t=arguments[arguments.length-1];e.set("userEndAnimationCallback",function(){t(null,!0)}.bind(this))},_emitEvents:function(){var e={viewerready:"viewerready",started:"viewerstart",stopped:"viewerstop",backgroundLoaded:"backgroundLoaded","primary-progress":"modelLoadProgress","secondary-progress":"textureLoadProgress",animationChange:"animationChange",animationEnded:"animationEnded",animationBegan:"animationBegan",animationPlay:"animationPlay",animationStop:"animationStop",annotationFocus:"annotationFocus",annotationBlur:"annotationBlur",annotationMouseEnter:"annotationMouseEnter",annotationMouseLeave:"annotationMouseLeave",annotationSelect:"annotationSelect",nodeMouseEnter:"nodeMouseEnter",nodeMouseLeave:"nodeMouseLeave",click:"click",cameraStart:"camerastart",cameraStop:"camerastop"},t=function(t,i){var n=e[t];n&&this._replayEmitter.emit(n,i)}.bind(this);this._partial.on("all",t),this._partial.scene.on("all",t),this._emitEvents=function(){}},focusOnVisibleGeometries:function(e){var t=this._getViewerOSG().getManipulator().getCurrentManipulator();t.setComputeBoundNodeMaskOverride(0),t.computeHomePosition(2),e(null),b.Z.redrawShadow()},startAR:function(){var e=new Event("fake",{bubbles:!0,cancelable:!1});this._partial.subviews.generalControls.onArClick(e)},setLightFeatureEnabled:function(e,t){this._getFeatureModel("lighting").set("enable",e),b.Z.redrawShadow(),t(null)},isLightFeatureEnabled:function(e){e(null,this._getFeatureModel("lighting").get("enable"))},hide:function(e,t){var i=this._getNodeFromUserNodeID(e);i?(i.setNodeMask(0),i.dirtyBound(),t(null)):t("show: node id "+e+" not found"),b.Z.redrawShadow()},show:function(e,t){var i=this._getNodeFromUserNodeID(e);i?(i.setNodeMask(-1),i.dirtyBound(),t(null)):t("show: node id "+e+" not found"),b.Z.redrawShadow()},setEnableCameraConstraints:function(e,t,i){var n=this._getFeatureModel("camera");n.set("enableCameraConstraints",e),n.set("useCameraConstraints",e),void 0!==i?void 0!==t.preventFocus&&n.set("preventCameraConstraintsFocus",t.preventFocus):i=t,i(null)},_setHotspot:function(e,t,i,n,r,a,o,s){t.set({name:r,content:{raw:a,rendered:o},eye:i,target:n,sticky:null},{silent:!0}),s(null,e.get("hotspots").length-1),t.set("building",void 0),b.Z.draw()},_initializeAnnotationMarkdown:function(e,t,i,n,r,a,o){var s=a&&a.length;if(s){for(var l=[[/!\[([^\[]+)\]\((?:javascript:)?([^\)]+)\)/g],[/\[([^\[]+)\]\((?:javascript:)?([^\)]+)\)/g],[/\n([^\n]+)\n/g],[/\n(#+)(.*)/g],[/(\*\*|__)(.*?)\1/g],[/(\*|_)(.*?)\1/g],[/\~\~(.*?)\~\~/g],[/\:\"(.*?)\"\:/g],[/\n\s*```\n([^]*?)\n\s*```\s*\n/g],[/`(.*?)`/g],[/\n(\*|\-|\+)(.*)/g],[/\n[0-9]+\.(.*)/g],[/\n(&gt;|\>)(.*)/g],[/\n-{5,}/g],[/(\|[^\n]+\|\r?\n)((?:\|:?[-]+:?)+\|)(\n(?:\|[^\n]+\|\r?\n?)*)?/g],[/\s?<\/ul>\s?<ul>/g],[/\s?<\/ol>\s?<ol>/g],[/<\/blockquote>\n<blockquote>/g],[/https?:\/\/[^"']*/g]],u=0;u<l.length&&null===a.match(l[u++]););s=!1}s?K.Z.getMarkdownPreview(a).then(function(s){this._setHotspot(e,t,i,n,r,a,s.result,o)}.bind(this),function(){this._setHotspot(e,t,i,n,r,void 0,void 0,o),t.set({name:r,eye:i,target:n})}.bind(this)):this._setHotspot(e,t,i,n,r,a,a,o)},createAnnotationFromWorldPosition:function(e,t,i,n,r,a){var o=this._getFeatureModel("hotspot"),s=o.createHotspotFromWorldPosition(e,!0,!0);this._initializeAnnotationMarkdown(o,s,t,i,n,r,a)},createAnnotationFromScenePosition:function(e,t,i,n,r,a){var o=this._getFeatureModel("hotspot"),s=o.createHotspotFromScenePosition(e,!0,!0);this._initializeAnnotationMarkdown(o,s,t,i,n,r,a)},_getFeatureModel:function(e){if(this._partial.scene){var t=this._partial.scene.getFeatures()[e];if(t)return t.getModel()}},hideAnnotationTooltip:function(e,t){var i=this._getFeatureModel("hotspot").get("hotspots");if(i){var n=1;return i.each((function(t){n===e&&t.set("hideAnnotationTooltip",!0),n++})),void t(null)}t("no annotations at all")},showAnnotationTooltip:function(e,t){var i=this._getFeatureModel("hotspot");i.get("proxyModel").set("hideAnnotationTooltip",void 0);var n=i.get("hotspots");if(n){var r=1;return n.each((function(t){r===e&&t.set("hideAnnotationTooltip",void 0),r++})),void t(null)}t("no annotations at all")},hideAnnotationTooltips:function(e,t){var i=this._getFeatureModel("hotspot").get("hotspots");if(i)return i.each((function(e){e.set("hideAnnotationTooltip",!0)})),void t(null);t("no annotations at all")},showAnnotationTooltips:function(e){var t=this._getFeatureModel("hotspot");t.get("proxyModel").set("hideAnnotationTooltip",void 0);var i=t.get("hotspots");if(i)return i.each((function(e){e.set("hideAnnotationTooltip",void 0)})),void e(null);e("no annotations at all")},fakeGeneral:function(){}});const ye=Ee;var Ie=function(){ye.apply(this,arguments)};Ie.prototype=(0,W.Z)(ye.prototype,{hideAnnotationTooltip:function(e,t){var i=this._getFeatureModel("hotspot").get("hotspots");if(i){var n=0;return i.each((function(t){n===e&&t.set("hideAnnotationTooltip",!0),n++})),void t(null)}t("no annotations at all")},showAnnotationTooltip:function(e,t){var i=this._getFeatureModel("hotspot");i.get("proxyModel").set("hideAnnotationTooltip",void 0);var n=i.get("hotspots");if(n){var r=0;return n.each((function(t){r===e&&t.set("hideAnnotationTooltip",void 0),r++})),void t(null)}t("no annotations at all")},hideAnnotationTooltips:function(e){var t=this._getFeatureModel("hotspot").get("hotspots");if(t)return t.each((function(e){e.set("hideAnnotationTooltip",!0)})),void e(null);e("no annotations at all")},removeTexture:function(e,t){var i=!1,n=C.Z.instance.getTextureCollection(),r=n.get(e);r&&(r.isTextureNull&&!r.isTextureNull()&&r.releaseGLObjects(),n.remove(e),r.destroy(),i=!0);var a=this._getFeatureModel("material").getImageCollection();if(a&&a.forEach((function(t){void 0!==t&&(t.getUID()===e&&(a.remove(t),i=!0),0===t.getImages.length&&a.remove(t),t.destroy())})),!i)return t("failed to find  texture "+e);t()},fakeGeneral:function(){}});const xe=Ie;var Te=function(){xe.apply(this,arguments)};Te.prototype=(0,W.Z)(xe.prototype,{createMaterial:function(e,t){t(null,this._getFeatureModel("material").makeMaterial(e).getJSON())},assignMaterial:function(e,t,i){var n=this._getFeatureModel("material"),r=this._getNodeFromUserNodeID(e.instanceID);r?(n.assignMaterial(r,t),i(null)):i("Couldn't find node, make sure node.instanceID is set with a proper value")},createDecal:function(e,t){try{var i,n=this._getFeatureView("Decals").createDecalFromData(e);t(void 0!==n?null:"Couldn't create the decal (no surface hit for this position and normal)",n)}catch(i){t("Error when creating decal:\n"+i)}},destroyDecal:function(e,t,i){2===arguments.length&&(i=t);try{var n=this._getFeatureView("Decals");n.destroyDecal(e,t),i(null)}catch(t){i("Error when deleting decal: "+e+":\n"+t)}},findDecalFromWorldPosition:function(e,t){try{t(null,this._getFeatureView("Decals").findDecalFromWorldPosition(e))}catch(e){t("Error when trying to find decal:\n"+e)}},pickFromTextureCoordinates:function(e,t,i){try{var n=this._getNodeFromUserNodeID(e.instanceID);i(null,this._getFeatureView("Decals").getWorldHitFromTexCoord(n,t))}catch(e){console.log(e),i("Error when calling pickFromTextureCoordinates:\n"+e)}},_getFeatureView:function(e){if(this._partial.scene){var t=this._partial.scene.getFeatures()[e];if(t)return t._views[0]}},fakeGeneral:function(){}});const we=Te;var Me=i("n0Kg"),Re=i("PSPx"),Be={APICore1_0:O,APICore1_2:Y,APICore1_3:te,APICore1_4:le,APICore1_5:fe,APICore1_6:me,APICore1_7:ve,APICore1_8:ye,APICore1_9:xe,APICore1_10:we},Ne=function(e){this._definitions={},this._instance=void 0,this._instanceId=e,this._name=void 0,this._parentDomain=this.getMessageTargetDomain(document.referrer),this._defer=new l.Z};Ne.create=function(e,t,i,n){var r;if(t){var a=t;r=new Ne(e);var o=h()[t];if(!o){var s=Object.keys(h()),l=s[s.length-1];o=h()[l],console.warn("you requested api version "+t+" but this version is not available. Returned api version "+l+" instead"),a=l}var u=function(e,t){return new Be[e](t)}("APICore"+o.ApiCoreVersion,i);r.register(a,o,u)}else(r=new d).initialize(i,n),console.warn("you are using a deprecated api, please update to the new one, read mode xxxx");return r},Ne.prototype={ready:function(){if(window.parent){var e=(0,s.Z)().apiHookEnv;if(void 0!==e)if(Re.Z.me().get("isStaff")){var t=new XMLHttpRequest,i=function(e){if(t.readyState===XMLHttpRequest.DONE){var i=JSON.parse(e.target.response);if(i.domain){var n=i.domain;if(n===window.location.hostname);else{var r={type:"api.ready",instanceId:this._instanceId,results:[this._instanceId],options:{domain:n}};window.parent.postMessage(r,this._parentDomain)}}}}.bind(this);t.addEventListener("load",i),t.open("GET","/i/users/viewer-api/authorized-domains?domain="+e);var n=document.cookie.match(new RegExp("sb_csrftoken=([^;]+)"));n||console.error("CRSF cookie missing");var r=n[1];t.setRequestHeader("X-CSRFToken",r),t.send()}var a={type:"api.ready",instanceId:this._instanceId,results:[this._instanceId]};(0,Me.Z)()||(a.error="No Hardware Support for Webgl"),window.parent.postMessage(a,this._parentDomain)}},clientReady:function(){return this._defer.promise},register:function(e,t,i){this._name=e,this._members=Object.keys(t),this._membersMapping=t,this._instance=i,this.init()},getViewerAPI:function(){return this._instance},getMessageTargetDomain:function(e){if(!e||!e.length)return"*";var t=e.split("//");return t[0]+"//"+t[1].split("/")[0]},init:function(){this._defer.resolve();var e=["api.initialize","api.request"],t=Object.getPrototypeOf(this._instance);window.addEventListener("message",function(i){if((i.origin===this._parentDomain||"*"===this._parentDomain)&&i.data&&i.data.type){var n=i.data.type;if(-1!==e.indexOf(n)){var r="api.initialize"!==n;if(!r||i.data.instanceId&&i.data.instanceId===this._instanceId)try{if(r&&this._instanceId!==i.data.instanceId)throw"Invalid request : instance does not exists";if("api.request"===i.data.type){var a=this._membersMapping[i.data.member];if("-"===a&&(a=i.data.member),!a||!t[a])throw"Invalid request : member function does not exists: "+a;if("function"!=typeof t[a])throw"Invalid request : member function does not exists: "+a;for(var o=t[a],s=i.data.arguments.slice(),l=s.length-1;l>=0&&void 0===s[l];l--)s.splice(l,1);return o.length&&"function"==typeof s[o.length-1]&&(s.length=o.length-1),s.push(function(){i.source.postMessage({type:"api.request.result",instanceId:this._instanceId,requestId:i.data.requestId,results:Array.prototype.slice.call(arguments)},this._parentDomain)}.bind(this)),void o.apply(this._instance,s)}if("api.initialize"===i.data.type){if(this._name!==i.data.name)throw"No API named '"+i.data.name+"'";var u=this._members,h=this._instance;if(void 0!==h.addGlobalListener){var c=function(){var e={type:"api.event",instanceId:this._instanceId,results:Array.prototype.slice.call(arguments)};i.source.postMessage(e,this._parentDomain)}.bind(this);h.addGlobalListener(c)}return void i.source.postMessage({type:"api.initialize.result",instanceId:this._instanceId,requestId:i.data.requestId,results:[null,this._instanceId,u]},this._parentDomain)}}catch(e){console.error(e),i.source.postMessage({type:n+".result",instanceId:this._instanceId,requestId:i.data.requestId,results:[e.stack?e.stack:e]},this._parentDomain)}}}}.bind(this))}};const De=Ne;var Pe=i("6YUN"),Fe=i("92w9"),Oe=i("xPSL"),Le=i("yfOW");function ke(){var e=!0,t=!1;try{t=window.self!==window.top}catch(e){t=!0}try{document.cookie}catch(t){e=!1}return t&&!e}var Ze=i("SkFG"),Ue=i("uine"),Ve=i("pjGz"),Qe=i("Iihz");const Ge=Ve.Z.extend({events:{"click .share-link button":"copyToClipboard",'click [data-action="share-on-facebook"]':"shareOnFacebook",'click [data-action="share-on-linkedin"]':"shareOnLinkedin",'click [data-action="share-on-pinterest"]':"shareOnPinterest",'click [data-action="share-on-reddit"]':"shareOnReddit",'click [data-action="share-on-tumblr"]':"shareOnTumblr",'click [data-action="share-on-twitter"]':"shareOnTwitter"},constructor:function(){this.handleKeyboardEvents=this.handleKeyboardEvents.bind(this),Ve.Z.prototype.constructor.apply(this,arguments)},show:function(){var e=this;this.model||(this.model=this.viewer._currentModel),this.model.sharing(),this.model.on("change:sharing",this.render.bind(this)),Ve.Z.prototype.show.apply(this,arguments),this.clipboard||Promise.all([i.e(3009),i.e(8486),i.e(8926),i.e(6701),i.e(1777)]).then(i.t.bind(i,"F1yB",23)).then((function(t){e.clipboard=new t.default(e.$(".share-link button")[0]),e.listenClipboard.call(e),"function"==typeof e.callAfterClipboardLoaded&&e.callAfterClipboardLoaded()}))},delegateEvents:function(){Ve.Z.prototype.delegateEvents.apply(this,arguments),r()(document).on("keyup",this.handleKeyboardEvents)},undelegateEvents:function(){Ve.Z.prototype.undelegateEvents.apply(this,arguments),r()(document).off("keyup",this.handleKeyboardEvents)},handleKeyboardEvents:function(e){27===e.keyCode&&this.hide()},render:function(){this.$(".share-link .text").val(this.model.get("sharing").shortUrl),this.$(".share-social").attr("href",this.model.get("viewerUrl")+"#email"),this.$(".share-embed .button").attr("href",this.model.get("viewerUrl")+"#embed"),this.$(".share-mail").attr("href",Qe.Z.getMailTo({modelName:this.model.get("name"),userName:this.model.get("user").displayName,url:this.model.get("viewerUrl"),isCollectionMode:!1}))},listenClipboard:function(){this.clipboard.on("success",function(){var e=this.viewer?this.viewer:this.options.embedPage.viewer;e&&e.subviews.osd.show("Copied to clipboard.",{duration:5e3,position:"top"})}.bind(this)),this.clipboard.on("error",function(){this.viewer.subviews.osd.show("Could not copy to clipboard.",{duration:5e3,position:"top"})}.bind(this))},copyToClipboard:function(){this.clipboard||(this.callAfterClipboardLoaded=this.copyToClipboard)},getShareModel:function(){return i.e(9356).then(i.bind(i,"U7bl")).then((function(e){return e.default}))},shareOnFacebook:function(e){var t=this;e.preventDefault(),this.getShareModel().then((function(e){e.shareOnFacebook(t.model.get("sharing").shortUrl)}))},shareOnTwitter:function(e){var t=this;e.preventDefault(),this.getShareModel().then((function(e){e.shareOnTwitter(t.model.toJSON(),t.model.get("sharing"))}))},shareOnPinterest:function(e){var t=this;e.preventDefault(),this.getShareModel().then((function(e){e.shareOnPinterest(t.model.toJSON(),t.model.get("sharing"))}))},shareOnReddit:function(e){var t=this;e.preventDefault(),this.getShareModel().then((function(e){e.shareOnReddit(t.model.toJSON(),t.model.get("sharing"))}))},shareOnTumblr:function(e){var t=this;e.preventDefault(),this.getShareModel().then((function(e){e.shareOnTumblr(t.model.toJSON(),t.model.get("sharing"))}))},shareOnLinkedin:function(e){var t=this;e.preventDefault(),this.getShareModel().then((function(e){e.shareOnLinkedin(t.model.toJSON(),t.model.get("sharing"))}))}});const He=Le.Z.extend({mixins:[Oe.Z,Fe.Z],events:{'click [data-action="start"]':"start",'click [data-action="allowRestricted"]':"allowRestricted"},initialize:function(){if(this.options.model.get("hasEnterpriseTracking")&&!(0,s.Z)().dnt&&Promise.resolve().then(i.bind(i,"O8uY")).then((function(e){e.default.initializeEnterprise()})),ke())this.$el.addClass("embed-sandboxed");else if(Le.Z.prototype.initialize.apply(this,arguments),!0!==this.model.get("isDeleted")){var e=!!(0,s.Z)().autostart;(e||(0,s.Z)().apiId)&&this.start(e);var t=(0,s.Z)().uiInfos;if(void 0===t){var n=(0,s.Z)().descButton;t=void 0===n||n}this.initializeSharingOverlay(),this.afterRender()}},start:(0,Pe.Z)((function(e){this.initializeViewer(e)})),allowRestricted:function(){Re.Z.me().setAllowsRestricted(!0),this.$(".overlay.restricted").addClass("hidden")},initializeSharingOverlay:function(){this.shareOverlay=new Ge({el:this.$(".share.overlay"),model:this.model,embedPage:this}),this.onShareClick=this.onShareClick.bind(this),this.$(".titlebar .actions .share").on("click",this.onShareClick)},onShareClick:function(){this.shareOverlay.show()},onViewerStart:function(){this.$(".titlebar .actions .share").off("click",this.onShareClick)},onViewerStop:function(){},initializeViewer:function(e){var t=this.$(".viewer");this.$(".play-button").addClass("loading"),e&&t.addClass("started");var i=new Ue.Z({el:t});this.viewer=i;var n=(0,s.Z)().apiVersion,r=De.create((0,s.Z)().apiId,n,i,this.model.get("uid"));i.on("start",this.onViewerStart),i.on("stop",this.onViewerStop),i.setScene({uid:this.model.get("uid"),features:Ze.Z,viewerAPI:r.getViewerAPI()}),this.$(".play-button").removeClass("loading"),r?(this.api=r,r.ready(),r.clientReady().then((function(){e&&i.start(e)}))):e&&i.start(e)},toggleUserSummary:function(){var e=!(!this.inAvatar&&!this.inUserSummary);this.userSummary[e?"show":"hide"]()},enterAvatar:function(e){var t=r()(e.currentTarget).data("user");this.inAvatar=!0,this.userSummary.setUser(t),this.userSummary.anchor(e.currentTarget),this.toggleUserSummary()},leaveAvatar:function(){this.inAvatar=!1,this.toggleUserSummary()},enterUserSummary:function(){this.inUserSummary=!0,this.toggleUserSummary()},leaveUserSummary:function(){this.inUserSummary=!1,this.toggleUserSummary()}});var ze=i("Em6+"),We=i("sN7K");function je(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return qe(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return qe(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}(0,s.Z)().dnt||i.e(3696).then(i.bind(i,"D1tk"));var Je=["models:embed","models:embed_specific_version"];(0,ze.fN)((function(){(0,o.Z)();var e=function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.pathname+window.location.search,n=je(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=(0,We.EQ)(r,i);if(a)return a}}catch(e){n.e(e)}finally{n.f()}return{}}(Je).model_id;a.Z.get(e).then((function(e){if("ok"===e.get("displayStatus"))return new He({model:e,el:"body"})}))}))},tnUK:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("DF+G"),r=i.n(n),a=i("HS/+"),o=i("WeWI"),s=i("AxWo"),l=i("DM4H");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){r()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.Z.extend({displayName:"Popup",mixins:[l.Z],defaultOptions:h(h({},e.prototype.defaultOptions),t),children:{componentWrapper:{selector:".js-popup-content",viewClass:a.Z.extend({displayName:"PopupWrapper(".concat(e.prototype.displayName,")"),template:function(){return o.Z.getFromString("{{ components.child | component }}",{components:this.createChildrenComponents({child:{viewClass:e,options:this.options}})})}}),options:function(){return h(h({},this.options),{},{popup:{continue:this.continue.bind(this),cancel:this.cancel.bind(this),open:this.open.bind(this),close:this.close.bind(this),remove:this.remove.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),resize:this.resize.bind(this),autofocus:this.autofocus.bind(this)}})}}},template:function(){return o.Z.getFromString('\n                <div class="popup-container">\n                    <div class="popup-overlay"></div>\n                    <div class="js-popup js-popup-content c-popup__container"></div>\n                </div>\n                ',{})}})}},"92w9":(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("pmI/");function r(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==i.return||i.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}const o={name:"LazyLoading",handleLazyLoading:function(){var e=this,t=function(){var t=e.$(".lazyload");if(t.length){var i,a=r(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(!(o instanceof HTMLElement))break;(0,n.S)(o)}}catch(e){a.e(e)}finally{a.f()}t.removeClass("lazyload")}};"complete"===document.readyState?t():window.addEventListener("load",t)},afterInitialize:function(){this.handleLazyLoading()},afterViewDidMount:function(){this.handleLazyLoading()},afterViewDidUpdate:function(){this.handleLazyLoading()}}},"Em6+":(e,t,i)=>{"use strict";i.d(t,{$u:()=>s,fN:()=>l});var n=i("QLbI"),r=i("5Cxy"),a=i("qKlK");function o(){var e;try{if(!(e=window.location!==window.parent.location?document.referrer:document.location.href))throw new Error("url is not defined")}catch(t){e=document.referrer}var t=document.createElement("a");return t.href=e,t}function s(){return o().hostname.replace(/^www\./,"")}function l(e){var t=o().host,i=!1;t===window.location.host?i=!0:a.Z.internalDomains.forEach((function(e){(t===e.domain||e.allowSubdomains&&t&&t.endsWith("."+e.domain))&&(i=!0)})),(0,r.Z)().internal&&!i?document.location.replace(n.ZP.craft("?",n.ZP.reset(window.location.search.substr(1),{internal:null}))):e()}},Iihz:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("2kHV"),r=i("WeWI");i("dzb+");const a={shareOnFacebook:function(e,t){n.Z.getSDK().then((function(i){i.ui({method:"share",href:e,quote:t})}))},shareOnTwitter:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{via:"sketchfab"},n=800,r=400,a=window.screen.width/2-n/2,o=window.screen.height/2-r/2,s="https://twitter.com/intent/tweet?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t);Object.prototype.hasOwnProperty.call(i,"via")&&null!==i.via&&(s+="&via="+i.via);var l=window.open(s,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+n+", height="+r);l&&l.moveTo(a,o)},shareOnPinterest:function(e,t,i){var n=window.screen.width/2-390,r=window.screen.height/2-200,a="http://pinterest.com/pin/create/button/?url="+encodeURIComponent(e)+"&description="+encodeURIComponent(t)+"&media="+encodeURIComponent(i),o=window.open(a,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=780, height=400");o&&o.moveTo(n,r)},shareOnReddit:function(e,t){var i="https://www.reddit.com/submit?url="+encodeURIComponent(e)+"&title="+encodeURIComponent(t);window.open(i,"_blank")},shareOnTumblr:function(e,t){var i=window.screen.width/2-270,n=window.screen.height/2-300,a=r.Z.get("skfb_front/partials/embed/iframe",{model:e,parameters:{flags:[]}}),o="https://www.tumblr.com/widgets/share/tool?posttype=video&content="+encodeURIComponent(a.replace(/(\r\n|\n|\r)/gm,""))+"&canonicalUrl="+encodeURIComponent(t),s=window.open(o,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=540, height=600");s&&s.moveTo(i,n)},shareOnLinkedin:function(e){var t=window.screen.width/2-300,i=window.screen.height/2-235,n="https://www.linkedin.com/cws/share?url="+encodeURIComponent(e),r=window.open(n,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=600, height=470");r&&r.moveTo(t,i)},getMailTo:function(e){var t=e.modelName,i=e.userName,n=e.isCollectionMode,r=e.url,a=t+" by "+i,o=n?["Check out this collection of 3D/VR models on Sketchfab:","\n",a,"\n",r+"?utm_source=email&utm_medium=email&utm_campaign=collection-shared"].join(""):["Check out this model in 3D and virtual reality on Sketchfab:","\n",a,"\n",r+"?utm_source=email&utm_medium=email&utm_campaign=model-shared"].join("");return"mailto:?subject="+encodeURIComponent(a)+"&body="+encodeURIComponent(o)}}},"pcq+":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});const n=(0,i("K9VK").Z)(window.navigator)},"pmI/":(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var n=function(e){var t=e.dataset.uri||"",i=new Image;i.classList.add("lazyloaded"),i.onload=i.onerror=function(){var t=e.offsetWidth,n=i.naturalWidth>t?i.naturalHeight*(t/i.naturalWidth):i.naturalHeight;t?(["transitionend","webkittransitionend","moztransitionend"].forEach((function(t){return e.addEventListener(t,(function(){return e.replaceWith(i)}))}),{once:!0}),n!==e.offsetHeight?e.style.minHeight="".concat(n,"px"):e.classList.add("loaded")):e.replaceWith(i)},i.src=t}},r3Fc:()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/layouts/popup.jinja"]={b_popup_header:function(e,t,i,n,r){var a="";try{i=i.push(!0),a+='\n                <div class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupTitleStyle"),e.opts.autoescape),a+='">\n                    ',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupTitle"),e.opts.autoescape),r(null,a+="\n                </div>\n            ")}catch(e){r(n.handleError(e,null,null))}},b_popup_content:function(e,t,i,n,r){var a="";try{i=i.push(!0),r(null,a+="\n            ")}catch(e){r(n.handleError(e,null,null))}},b_popup_footer:function(e,t,i,n,r){var a="";try{i=i.push(!0),r(null,a+="\n                ")}catch(e){r(n.handleError(e,null,null))}},root:function(e,t,i,n,r){var a="";try{var o,s,l,u,h,c,A,d,g,f,p,m,_,v;n.contextOrFrameLookup(t,i,"isWhiteBackground")?(a+="\n    ",o="c-popup c-popup__container",i.set("popupStyle",o,!0),i.topLevel&&t.setVariable("popupStyle",o),i.topLevel&&t.addExport("popupStyle",o),a+="\n    ",s="c-popup__header",i.set("popupHeaderStyle",s,!0),i.topLevel&&t.setVariable("popupHeaderStyle",s),i.topLevel&&t.addExport("popupHeaderStyle",s),a+="\n    ",l="c-popup__title",i.set("popupTitleStyle",l,!0),i.topLevel&&t.setVariable("popupTitleStyle",l),i.topLevel&&t.addExport("popupTitleStyle",l),a+="\n    ",u="c-popup__actions",i.set("popupActionsStyle",u,!0),i.topLevel&&t.setVariable("popupActionsStyle",u),i.topLevel&&t.addExport("popupActionsStyle",u),a+="\n    ",h="c-popup__close",i.set("popupCloseStyle",h,!0),i.topLevel&&t.setVariable("popupCloseStyle",h),i.topLevel&&t.addExport("popupCloseStyle",h),a+="\n    ",c="c-popup__content",i.set("popupContentStyle",c,!0),i.topLevel&&t.setVariable("popupContentStyle",c),i.topLevel&&t.addExport("popupContentStyle",c),a+="\n    ",A="c-popup__footer",i.set("popupFooterStyle",A,!0),i.topLevel&&t.setVariable("popupFooterStyle",A),i.topLevel&&t.addExport("popupFooterStyle",A),a+="\n"):(a+="\n    ",d="popup",i.set("popupStyle",d,!0),i.topLevel&&t.setVariable("popupStyle",d),i.topLevel&&t.addExport("popupStyle",d),a+="\n    ",g="popup-header",i.set("popupHeaderStyle",g,!0),i.topLevel&&t.setVariable("popupHeaderStyle",g),i.topLevel&&t.addExport("popupHeaderStyle",g),a+="\n    ",f="popup-title",i.set("popupTitleStyle",f,!0),i.topLevel&&t.setVariable("popupTitleStyle",f),i.topLevel&&t.addExport("popupTitleStyle",f),a+="\n    ",p="popup-actions",i.set("popupActionsStyle",p,!0),i.topLevel&&t.setVariable("popupActionsStyle",p),i.topLevel&&t.addExport("popupActionsStyle",p),a+="\n    ",m="popup-close",i.set("popupCloseStyle",m,!0),i.topLevel&&t.setVariable("popupCloseStyle",m),i.topLevel&&t.addExport("popupCloseStyle",m),a+="\n    ",_="popup-content",i.set("popupContentStyle",_,!0),i.topLevel&&t.setVariable("popupContentStyle",_),i.topLevel&&t.addExport("popupContentStyle",_),a+="\n    ",v="popup-footer",i.set("popupFooterStyle",v,!0),i.topLevel&&t.setVariable("popupFooterStyle",v),i.topLevel&&t.addExport("popupFooterStyle",v),a+="\n"),a+='\n\n<div class="popup-container',n.contextOrFrameLookup(t,i,"popupNeedsLoading")&&(a+=" popup-loading"),a+=" ",a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupClass"),e.opts.autoescape),a+='">\n    <form class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupStyle"),e.opts.autoescape),a+=' js-popup" method="post"',n.contextOrFrameLookup(t,i,"allowAutocomplete")||(a+=' autocomplete="off"'),a+=" ",n.contextOrFrameLookup(t,i,"popupAction")&&(a+='action="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupAction"),e.opts.autoescape),a+='"'),a+=">\n\n        ",n.contextOrFrameLookup(t,i,"allowAutocomplete")||(a+="\n            ",a+='\n            <input type="text" style="display:none" />\n            <input type="password" style="display:none" />\n        '),a+='\n\n        <header class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupHeaderStyle"),e.opts.autoescape),a+='">\n\n            ',t.getBlock("popup_header")(e,t,i,n,(function(o,s){o?r(o):(a+=s,a+='\n\n            <div class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupActionsStyle"),e.opts.autoescape),a+='">\n                ',n.contextOrFrameLookup(t,i,"popupClosable")&&(a+='\n                    <a class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupCloseStyle"),e.opts.autoescape),a+='" data-action="close" data-selenium="close-popup">\n                        <i class="fa fa-times"></i>\n                    </a>\n                '),a+='\n            </div>\n\n        </header>\n\n        <div class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupContentStyle"),e.opts.autoescape),a+=" ",a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupContentClass"),e.opts.autoescape),a+='">\n            ',t.getBlock("popup_content")(e,t,i,n,(function(o,s){o?r(o):(a+=s,a+="\n        </div>\n\n        ",e.getFilter("default").call(t,n.contextOrFrameLookup(t,i,"withFooter"),!0)&&(a+='\n            <footer class="',a+=n.suppressValue(n.contextOrFrameLookup(t,i,"popupFooterStyle"),e.opts.autoescape),a+='">\n                ',t.getBlock("popup_footer")(e,t,i,n,(function(e,t){e?r(e):(a+=t,a+="\n            </footer>\n        ")}))),r(null,a+="\n\n    </form>\n\n</div>\n"))})))}))}catch(e){r(n.handleError(e,null,null))}}}},i3rb:()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/components/atoms/dropdown.jinja"]={root:function(e,t,i,n,r){var a="";try{var o=n.makeMacro([],["options"],(function(r){var a=i;i=new n.Frame,(r=r||{}).hasOwnProperty("caller")&&i.set("caller",r.caller),i.set("options",r.hasOwnProperty("options")?r.options:{});var o,s="";return s+="\n    ",o=e.getFilter("merge").call(t,{labelTitle:"",labelValue:"",className:"",longestLabelValue:"",placeholder:"",theme:"",color:"",components:{},disabled:!1,isOpen:!1,withBackground:!1,grey:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",o,!0),i.topLevel&&t.setVariable("options",o),i.topLevel&&t.addExport("options",o),s+='\n    <div\n        class="c-dropdown ',s+=n.suppressValue(e.getFilter("class_names").call(t,{"--disabled":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"disabled"),"--open":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isOpen"),"--with-background":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"withBackground"),"--grey":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"grey")}),e.opts.autoescape),s+=" ",s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"className"),e.opts.autoescape),s+=" ",s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"theme")?"--"+n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"theme")+"-theme":"",e.opts.autoescape),s+='">\n        <div\n            class="c-dropdown__label"\n            data-action="toggle-menu"\n            data-disabled="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"disabled"),e.opts.autoescape),s+='">\n            <span\n                data-ref="labelTitle"\n                class="c-dropdown__label-title">\n                ',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"labelTitle")?n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"labelTitle"):"",e.opts.autoescape),s+='\n            </span>\n\n            <span\n                class="',s+=n.suppressValue(e.getFilter("class_names").call(t,{"c-dropdown__label-value":!0,"--placeholder":!n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"labelValue")}),e.opts.autoescape),s+='"\n                style="',s+=n.suppressValue(e.getFilter("style").call(t,{color:n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"labelValue")?n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"color"):""}),e.opts.autoescape),s+='">\n                <span class="c-dropdown__label-value__text ',s+=n.suppressValue(e.getFilter("class_names").call(t,{"--absolute":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"longestLabelValue")}),e.opts.autoescape),s+='">\n                    ',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"labelValue")?n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"labelValue"):n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"placeholder"),e.opts.autoescape),s+='\n                </span>\n\n                <span class="c-dropdown__label-value__hidden">',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"longestLabelValue"),e.opts.autoescape),s+='</span>\n            </span>\n        </div>\n        <div\n            data-ref="menu"\n            class="c-dropdown__menu ',s+=n.suppressValue(e.getFilter("class_names").call(t,{"--open":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isOpen")}),e.opts.autoescape),s+='">\n            ',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isOpen")?e.getFilter("component").call(t,n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"components"),"child")):"",e.opts.autoescape),s+="\n        </div>\n    </div>\n",i=a,new n.SafeString(s)}));t.addExport("dropdown"),t.setVariable("dropdown",o),r(null,a+="\n")}catch(e){r(n.handleError(e,null,null))}}}},R8ae:()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/components/atoms/switch-button.jinja"]={root:function(e,t,i,n,r){var a="";try{var o=n.makeMacro([],["options"],(function(r){var a=i;i=new n.Frame,(r=r||{}).hasOwnProperty("caller")&&i.set("caller",r.caller),i.set("options",r.hasOwnProperty("options")?r.options:{});var o,s="";return s+="\n    ",o=e.getFilter("merge").call(t,{name:"",isChecked:!1,disabled:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",o,!0),i.topLevel&&t.setVariable("options",o),i.topLevel&&t.addExport("options",o),s+='\n    <div class="form-onoff-wrapper ',s+=n.suppressValue(e.getFilter("class_names").call(t,{"--checked":n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isChecked")}),e.opts.autoescape),s+='">\n        <input\n            id="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"name"),e.opts.autoescape),s+='"\n            class="form-onoff"\n            type="checkbox"\n            name="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"name"),e.opts.autoescape),s+='"\n            data-ref="input"\n            ',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isChecked")&&(s+=' checked="checked"'),s+=' />\n        <label\n            class="',s+=n.suppressValue(e.getFilter("class_names").call(t,{"form-onoff-actor":!0,disabled:n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"disabled")}),e.opts.autoescape),s+='"\n            for="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"name"),e.opts.autoescape),s+='"></label>\n    </div>\n',i=a,new n.SafeString(s)}));t.addExport("switch_button"),t.setVariable("switch_button",o),r(null,a+="\n")}catch(e){r(n.handleError(e,null,null))}}}},S0rz:()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/components/molecules/label-switch-button.jinja"]={root:function(e,t,i,n,r){var a="";try{var o=n.makeMacro([],["options"],(function(r){var a=i;i=new n.Frame,(r=r||{}).hasOwnProperty("caller")&&i.set("caller",r.caller),i.set("options",r.hasOwnProperty("options")?r.options:{});var o="";return o+='\n    <span class="c-label-switch-button">\n        ',o+=n.suppressValue(e.getFilter("component").call(t,n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"components"),"switchButton")),e.opts.autoescape),o+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"label")&&(o+='\n            <label class="c-label-switch-button__label">',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"label"),e.opts.autoescape),o+="</label>\n        "),o+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"error")&&(o+='\n            <p class="form-error c-label-switch-button__error">\n                ',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"error"),e.opts.autoescape),o+="\n            </p>\n        "),o+="\n    </span>\n",i=a,new n.SafeString(o)}));t.addExport("label_switch_button"),t.setVariable("label_switch_button",o),r(null,a+="\n")}catch(e){r(n.handleError(e,null,null))}}}},"6c1T":()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/components/molecules/popup.jinja"]={root:function(e,t,i,n,r){var a="";try{var o=n.makeMacro([],["options"],(function(r){var a=i;i=new n.Frame,(r=r||{}).hasOwnProperty("caller")&&i.set("caller",r.caller),i.set("options",r.hasOwnProperty("options")?r.options:{});var o="";return o+='\n    <section\n        style="',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"width")?"width:"+n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"width")+"px":"",e.opts.autoescape),o+='"\n        class="c-popup ',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"className"),e.opts.autoescape),o+='">\n        ',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"title")&&(o+='\n            <header class="c-popup__header">\n                <div class="c-popup__title">\n                    ',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"title"),e.opts.autoescape),o+='\n                </div>\n\n                <div class="c-popup__actions">\n                    ',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isClosable")&&(o+='\n                        <a data-selenium="close-popup" class="c-popup__close" data-action="close" arial-label="Close popup">\n                            <i class="fa fa-times"></i>\n                        </a>\n                    '),o+="\n                </div>\n            </header>\n        "),o+='\n\n        <div class="c-popup__content c-popup__full-height">\n            ',o+=n.suppressValue(e.getFilter("component").call(t,n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"components"),"child")),e.opts.autoescape),o+="\n        </div>\n    </section>\n",i=a,new n.SafeString(o)}));t.addExport("popup"),t.setVariable("popup",o),r(null,a+="\n")}catch(e){r(n.handleError(e,null,null))}}}},mpKL:()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/hotspot.jinja"]={root:function(e,t,i,n,r){var a=null,o=null;try{var s=n.makeMacro([],["options"],(function(r){var s=i;i=new n.Frame,(r=r||{}).hasOwnProperty("caller")&&i.set("caller",r.caller),i.set("options",r.hasOwnProperty("options")?r.options:{});var l="";l+="\n",i.set("width_before",30,!0),i.topLevel&&t.setVariable("width_before",30),i.topLevel&&t.addExport("width_before",30),l+="\n",i.set("width_next",960,!0),i.topLevel&&t.setVariable("width_next",960),i.topLevel&&t.addExport("width_next",960),l+='\n        <div class="vr-hotspot-content" style="width:',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"widthContent"),e.opts.autoescape),l+='px;" id="hotspot',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"hotspotIndex"),e.opts.autoescape),l+='">\n            <div class="cell" id="default" style="width:1024px;height:576px;position:absolute;top:0;left:0"></div>',i=i.push();var u=(a=5,o=32,n.callWrap(n.contextOrFrameLookup(t,i,"range"),"range",t,[0,n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"column")]));if(u)for(var h=u.length,c=0;c<u.length;c++){var A,d,g=u[c];i.set("column",g),i.set("loop.index",c+1),i.set("loop.index0",c),i.set("loop.revindex",h-c),i.set("loop.revindex0",h-c-1),i.set("loop.first",0===c),i.set("loop.last",c===h-1),i.set("loop.length",h),l+='<div class="page" id="column',l+=n.suppressValue(g,e.opts.autoescape),l+='" style="width:1024px;height:576px;position:absolute;top:0;left:',l+=n.suppressValue(1024*g,e.opts.autoescape),l+='px; overflow: visible">',g>0&&(l+='<div style="width:40px;height:40px;position:absolute;top:250px;left:30px" class="vr-icon vr-icon-arrow-left-white"></div>\n                        <button id="prevPage" style="opacity:0; height: 100%; width:10%; top:0; position: absolute; left: 0;"></button>'),A=n.contextOrFrameLookup(t,i,"width_before")+1024,i.set("width_before",A,!0),i.topLevel&&t.setVariable("width_before",A),i.topLevel&&t.addExport("width_before",A),l+='\n                    <div class="vr-hotspot-title">',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"title"),e.opts.autoescape),l+="</div>",g<1&&(l+='<div class="vr-hotspot-description" style="column-count:',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"column"),e.opts.autoescape),l+=";width:",l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"widthContent"),e.opts.autoescape),l+='px">',l+=n.suppressValue(e.getFilter("safe").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"description")),e.opts.autoescape),l+="</div>"),g+1<n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"column")&&(l+='<button id="nextPage" style="opacity:0; height: 100%; width:10%; top:0; position: absolute; right: 0;"></button>\n                        <div style="width:40px;height:40px;position:absolute;top:250px;left:960px" class="vr-icon vr-icon-arrow-right-white"></div>\n                        ',d=n.contextOrFrameLookup(t,i,"width_next")+1024,i.set("width_next",d,!0),i.topLevel&&t.setVariable("width_next",d),i.topLevel&&t.addExport("width_next",d)),l+='<div class="vr-hotspot-footer">\n                        <div class="vr-hotspot-container-button" >',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"displayNavigation")?l+='<button id="prevButton" class="vr-hotspot-button">Prev</button>\n                                <button id="closeButton" class="vr-hotspot-button">Close annotation</button>\n                                <button id="nextButton" class="vr-hotspot-button">Next</button>':l+='<button id="closeButton" class="vr-hotspot-button">Close annotation</button>',l+="</div>\n                    </div>\n                </div>"}return i=i.pop(),l+="</div>\n",i=s,new n.SafeString(l)}));t.addExport("panel"),t.setVariable("panel",s),r(null,"")}catch(e){r(n.handleError(e,a,o))}}}},"7+CA":()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/model.jinja"]={root:function(e,t,i,n,r){var a=null,o=null,s="";try{var l=n.makeMacro(["model"],["options"],(function(r,s){var l=i;i=new n.Frame,(s=s||{}).hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("model",r),i.set("options",s.hasOwnProperty("options")?s.options:{});var u,h,c="";return c+="\n    ",u=e.getFilter("merge").call(t,{withStaffpickFlag:!0,withStaffpickLink:!1,withRestrictedFlag:!0,displayRecentlyStaffpicked:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",u,!0),i.topLevel&&t.setVariable("options",u),i.topLevel&&t.addExport("options",u),c+="\n    ",h=n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"displayRecentlyStaffpicked")&&n.memberLookup(r,"recentlyStaffpicked"),i.set("recentlyStaffpicked",h,!0),i.topLevel&&t.setVariable("recentlyStaffpicked",h),i.topLevel&&t.addExport("recentlyStaffpicked",h),c+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"withStaffpickLink")&&n.memberLookup(r,"staffpickedAt")?(c+='\n        <meta itemprop="award" content="Staff Pick" />\n        <a href="',c+=n.suppressValue((a=11,o=21,n.callWrap(n.contextOrFrameLookup(t,i,"url"),"url",t,["models:staffpicks"])),e.opts.autoescape),c+='" class="flag --staffpicked" title="See all staff picks"></a>\n    '):n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"withStaffpickFlag")&&n.memberLookup(r,"staffpickedAt")?(c+='\n        <meta itemprop="award" content="Staff Pick" />\n        <span class="flag --staffpicked ',n.contextOrFrameLookup(t,i,"recentlyStaffpicked")&&(c+="--with-text"),c+='" title="Staff Picks"></span>\n    ',c+="\n    "):0==n.memberLookup(r,"isPublished")&&(c+='\n        <span class="flag --draft"></span>\n    '),c+="\n\n    ",(n.memberLookup(r,"isRestricted")||n.memberLookup(r,"isAdult"))&&(c+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"withRestrictedFlag")&&(c+='\n            <a\n                href="https://help.sketchfab.com/hc/en-us/articles/214867883-What-is-Restricted-Content-?utm_source=website&utm_campaign=restrictedcontent"\n                target="_blank"\n                class="flag --restricted"\n                title="Restricted Content"\n                rel="noopener noreferrer"></a>\n        '),c+="\n    "),c+="\n",i=l,new n.SafeString(c)}));t.addExport("model_labels"),t.setVariable("model_labels",l),s+="\n\n";var u=n.makeMacro(["model"],["options"],(function(r,s){var l=i;i=new n.Frame,(s=s||{}).hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("model",r),i.set("options",s.hasOwnProperty("options")?s.options:{});var u,h="";return u=e.getFilter("merge").call(t,{clickable:!0},n.contextOrFrameLookup(t,i,"options")),i.set("options",u,!0),i.topLevel&&t.setVariable("options",u),i.topLevel&&t.addExport("options",u),h+='<span class="model-name">\n\n        ',n.memberLookup(r,"visibility")&&(h+="\n            ","private"==n.memberLookup(r,"visibility")?h+='\n                <i class="icon viewer-icon-eye-slash"></i>\n            ':"protected"==n.memberLookup(r,"visibility")&&(h+='\n                <i class="icon viewer-icon-lock"></i>\n            '),h+="\n        "),h+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"clickable")?(h+='\n            <a class="model-name__label" data-route href="',h+=n.suppressValue(n.memberLookup(r,"viewerUrl"),e.opts.autoescape),h+='"',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"target")&&(h+=' target="',h+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"target"),e.opts.autoescape),h+='"'),h+=' title="',h+=n.suppressValue("store"==n.memberLookup(r,"downloadType")?"Buy ":"",e.opts.autoescape),h+=n.suppressValue(n.memberLookup(r,"name"),e.opts.autoescape),h+=' 3D Model">',h+=n.suppressValue(n.memberLookup(r,"name"),e.opts.autoescape),h+="</a>\n        "):(h+='\n            <span class="model-name__label">',h+=n.suppressValue(n.memberLookup(r,"name"),e.opts.autoescape),h+="</span>\n        "),h+="\n\n        ",h+=n.suppressValue((a=52,o=21,n.callWrap(n.contextOrFrameLookup(t,i,"model_labels"),"model_labels",t,[r,n.contextOrFrameLookup(t,i,"options")])),e.opts.autoescape),h+="\n\n    </span>",i=l,new n.SafeString(h)}));t.addExport("model_name"),t.setVariable("model_name",u),s+="\n\n";var h=n.makeMacro(["model"],["options"],(function(r,a){var o=i;i=new n.Frame,(a=a||{}).hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("model",r),i.set("options",a.hasOwnProperty("options")?a.options:{});var s,l,u="";return s=e.getFilter("merge").call(t,{withUsernameMention:!0,withSuffix:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",s,!0),i.topLevel&&t.setVariable("options",s),i.topLevel&&t.addExport("options",s),l=n.memberLookup(r,"org")?n.memberLookup(r,"org"):n.memberLookup(r,"user"),i.set("uploader",l,!0),i.topLevel&&t.setVariable("uploader",l),i.topLevel&&t.addExport("uploader",l),u+=n.suppressValue(n.memberLookup(r,"name")+" - "+("store"==n.memberLookup(r,"downloadType")?"Buy Royalty Free ":"free"==n.memberLookup(r,"downloadType")?"Download Free ":"")+"3D model by "+n.memberLookup(n.contextOrFrameLookup(t,i,"uploader"),"displayName")+(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"withUsernameMention")?" (@"+n.memberLookup(n.contextOrFrameLookup(t,i,"uploader"),"username")+")":"")+" ["+e.getFilter("truncate").call(t,n.memberLookup(r,"uid"),n.makeKeywordArgs({length:7,killwords:n.contextOrFrameLookup(t,i,"True"),end:""}))+"]"+(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"withSuffix")?" - Sketchfab"+("store"==n.memberLookup(r,"downloadType")?" Store":""):""),e.opts.autoescape),i=o,new n.SafeString(u)}));t.addExport("model_page_title"),t.setVariable("model_page_title",h),s+="\n\n";var c=n.makeMacro(["list"],["options"],(function(r,s){var l=i;i=new n.Frame,(s=s||{}).hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("list",r),i.set("options",s.hasOwnProperty("options")?s.options:{});var u,h,c,A="";u=e.getFilter("merge").call(t,{maxDisplayed:3,othersHref:""},n.contextOrFrameLookup(t,i,"options")),i.set("options",u,!0),i.topLevel&&t.setVariable("options",u),i.topLevel&&t.addExport("options",u),h=e.getFilter("first_n").call(t,r,n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"maxDisplayed")),i.set("shortList",h,!0),i.topLevel&&t.setVariable("shortList",h),i.topLevel&&t.addExport("shortList",h),c=e.getFilter("length").call(t,r)-e.getFilter("length").call(t,n.contextOrFrameLookup(t,i,"shortList")),i.set("otherCount",c,!0),i.topLevel&&t.setVariable("otherCount",c),i.topLevel&&t.addExport("otherCount",c),i=i.push();var d=n.contextOrFrameLookup(t,i,"shortList");if(d)for(var g=d.length,f=0;f<d.length;f++){var p=d[f];i.set("model",p),i.set("loop.index",f+1),i.set("loop.index0",f),i.set("loop.revindex",g-f),i.set("loop.revindex0",g-f-1),i.set("loop.first",0===f),i.set("loop.last",f===g-1),i.set("loop.length",g),n.memberLookup(n.contextOrFrameLookup(t,i,"loop"),"first")||(n.memberLookup(n.contextOrFrameLookup(t,i,"loop"),"last")&&n.contextOrFrameLookup(t,i,"otherCount")<1?A+="<span> and </span>":A+="<span>, </span>"),A+=n.suppressValue((a=85,o=19,n.callWrap(n.contextOrFrameLookup(t,i,"model_name"),"model_name",t,[p,{withStaffpickFlag:!1,withStaffpickLink:!1,withRestrictedFlag:!1}])),e.opts.autoescape)}return i=i.pop(),n.contextOrFrameLookup(t,i,"otherCount")>0&&(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"othersHref")?(A+='<a href="',A+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"othersHref"),e.opts.autoescape),A+='" class="others"> and ',A+=n.suppressValue(n.contextOrFrameLookup(t,i,"otherCount"),e.opts.autoescape),A+=" other",A+=n.suppressValue(e.getFilter("pluralize").call(t,n.contextOrFrameLookup(t,i,"otherCount")),e.opts.autoescape),A+="</a>"):(A+='<span class="others"> and ',A+=n.suppressValue(n.contextOrFrameLookup(t,i,"otherCount"),e.opts.autoescape),A+=" other",A+=n.suppressValue(e.getFilter("pluralize").call(t,n.contextOrFrameLookup(t,i,"otherCount")),e.opts.autoescape),A+="</span>")),i=l,new n.SafeString(A)}));t.addExport("model_name_list"),t.setVariable("model_name_list",c),s+="\n\n";var A=n.makeMacro([],["options"],(function(e){var r=i;i=new n.Frame,(e=e||{}).hasOwnProperty("caller")&&i.set("caller",e.caller),i.set("options",e.hasOwnProperty("options")?e.options:{});var a="";return a+='\n\n    <ul class="hover-menu quicksettings corner',"up"==n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"direction")&&(a+=" hover-menu-up"),"left"==n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"direction")&&(a+=" --left"),a+='">\n        <li><a data-action="remove-model">Remove</a></li>\n    </ul>\n\n',i=r,new n.SafeString(a)}));t.addExport("collection_item_quicksettings"),t.setVariable("collection_item_quicksettings",A),s+="\n\n",s+="\n";var d=n.makeMacro(["authUser","model"],["options"],(function(r,s,l){var u=i;i=new n.Frame,(l=l||{}).hasOwnProperty("caller")&&i.set("caller",l.caller),i.set("authUser",r),i.set("model",s),i.set("options",l.hasOwnProperty("options")?l.options:{});var h,c="";return c+='\n    <div class="model-uploadcard">',h=e.getFilter("merge").call(t,{withStaffpickFlag:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",h,!0),i.topLevel&&t.setVariable("options",h),i.topLevel&&t.addExport("options",h),c+='<h3 class="filename">',n.memberLookup(s,"name")?c+=n.suppressValue((a=116,o=27,n.callWrap(n.contextOrFrameLookup(t,i,"model_name"),"model_name",t,[s,n.contextOrFrameLookup(t,i,"options")])),e.opts.autoescape):(c+='<a data-route href="',c+=n.suppressValue(n.memberLookup(s,"viewerUrl"),e.opts.autoescape),c+='">\n                    ',c+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(s,"originalFileName"),"No file name"),e.opts.autoescape),c+="\n                </a>"),c+='</h3>\n        <div class="meta">\n            ',n.memberLookup(s,"isPublished")?n.memberLookup(s,"processedAt")?(c+='\n                <span class="date" title="',c+=n.suppressValue(n.memberLookup(s,"processedAt"),e.opts.autoescape),c+='">',c+=n.suppressValue(e.getFilter("time_ago").call(t,n.memberLookup(s,"processedAt")),e.opts.autoescape),c+="</span>\n            "):(c+='\n                <span class="date" title="',c+=n.suppressValue(n.memberLookup(s,"createdAt"),e.opts.autoescape),c+='">',c+=n.suppressValue(e.getFilter("time_ago").call(t,n.memberLookup(s,"createdAt")),e.opts.autoescape),c+="</span>\n            "):(c+='\n                <span class="help">\n                    <span class="date">Expires on ',c+=n.suppressValue(e.getFilter("get_delete_draft_date").call(t,n.memberLookup(s,"createdAt")),e.opts.autoescape),c+='</span>\n                    <div class="tooltip tooltip-down">This model will be deleted automatically on ',c+=n.suppressValue(e.getFilter("get_delete_draft_date").call(t,n.memberLookup(s,"createdAt")),e.opts.autoescape),c+="</div>\n                </span>\n            "),c+='\n        </div>\n\n        <div class="status">',0==n.memberLookup(s,"processingStatus")?c+='<div class="help">\n                    <i class="icon spinner-small-slow"></i>\n                    <div class="tooltip tooltip-down">Pending</div>\n                </div>':1==n.memberLookup(s,"processingStatus")?c+='<div class="help">\n                    <i class="icon spinner-small"></i>\n                    <div class="tooltip tooltip-down">Processing</div>\n                </div>':2==n.memberLookup(s,"processingStatus")?n.memberLookup(s,"isPublished")?c+='<div class="help">\n                        <i class="icon fa fa-check"></i>\n                        <div class="tooltip tooltip-down">Published</div>\n                    </div>':(c+='<div class="js-publish-button">\n                        <button type="button" class="button btn-important btn-medium">\n                            Publish\n                        </button>\n                    </div>\n\n                    <a href="',c+=n.suppressValue(n.memberLookup(s,"editorUrl"),e.opts.autoescape),c+='" class="button btn-tertiary btn-medium btn-edit" data-action="edit">\n                        3D Settings\n                    </a>'):3==n.memberLookup(s,"processingStatus")&&(c+='<div class="help">\n                    <i class="icon fa fa-times"></i>\n                    <div class="tooltip tooltip-down">Error</div>\n                </div>'),c+='</div>\n\n        <div class="model-uploadcard-settings">\n            <div class="button btn-medium btn-primary display-icon-only"',n.memberLookup(s,"processingStatus")<2&&(c+=" disabled"),c+='>\n                <i class="fa fa-cog"></i>\n                <div class="js-quicksettings"></div>\n            </div>\n        </div>\n\n    </div>\n\n',i=u,new n.SafeString(c)}));t.addExport("model_uploadcard"),t.setVariable("model_uploadcard",d),s+="\n\n\n";var g=n.makeMacro([],["options"],(function(r){var a=i;i=new n.Frame,(r=r||{}).hasOwnProperty("caller")&&i.set("caller",r.caller),i.set("options",r.hasOwnProperty("options")?r.options:{});var o="";return o+='\n    <div class="annotation" data-hotspot="',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"hotspotIndex"),e.opts.autoescape),o+='">\n        <div class="tooltip">\n            <form class="tooltip-content">\n                <div class="edition">\n                    <input class="title" placeholder="Title *" maxlength="64" required>\n                    <textarea class="description" placeholder="Description (add links, images and other formatting with Markdown)" maxlength="1024" rows="2"></textarea>\n                </div>\n                <div class="render">\n                    <div class="title"></div>\n                    <div class="markdown-editor">\n                        <div class="description markdown-rendered-content inversed"></div>\n                    </div>\n                </div>\n                <div class="meta">\n                    <button type="submit" class="submit button btn-primary btn-small">OK</button>\n                    <div class="meta__mode">\n                        <i class="fa fa-pencil activate-edition selected" title="Edit"></i>\n                        <i class="fa fa-eye activate-render" title="Preview"></i>\n                    </div>\n                </div>\n            </form>\n        </div>\n    </div>\n',i=a,new n.SafeString(o)}));t.addExport("model_hotspot_edit"),t.setVariable("model_hotspot_edit",g),s+="\n\n";var f=n.makeMacro(["src"],["options"],(function(r,a){var o=i;i=new n.Frame,(a=a||{}).hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("src",r),i.set("options",a.hasOwnProperty("options")?a.options:{});var s,l="";return s=e.getFilter("merge").call(t,{title:"A 3D model"},n.contextOrFrameLookup(t,i,"options")),i.set("options",s,!0),i.topLevel&&t.setVariable("options",s),i.topLevel&&t.addExport("options",s),l+="\n    <iframe ",l+=n.suppressValue(e.getFilter("attributes").call(t,{title:n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"title"),class:n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"class"),width:n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"width"),height:n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"height"),src:r,frameborder:"0",allow:"autoplay; fullscreen; xr-spatial-tracking",allowfullscreen:"",mozallowfullscreen:"true",webkitallowfullscreen:"true","xr-spatial-tracking":"true","execution-while-out-of-viewport":"true","execution-while-not-rendered":"true","web-share":"true"}),e.opts.autoescape),l+="></iframe>",i=o,new n.SafeString(l)}));t.addExport("model_iframe"),t.setVariable("model_iframe",f),s+="\n\n";var p=n.makeMacro(["model"],["options"],(function(r,a){var o=i;i=new n.Frame,(a=a||{}).hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("model",r),i.set("options",a.hasOwnProperty("options")?a.options:{});var s,l="";return l+="\n    ",s=e.getFilter("merge").call(t,{className:""},n.contextOrFrameLookup(t,i,"options")),i.set("options",s,!0),i.topLevel&&t.setVariable("options",s),i.topLevel&&t.addExport("options",s),l+='\n    <span class="',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"className"),e.opts.autoescape),l+=' custom-icons icon-eye-icon help">\n        <span class="count">\n            ',l+=n.suppressValue(e.getFilter("humanize_number").call(t,n.memberLookup(r,"viewCount")),e.opts.autoescape),l+='\n        </span>\n        <span class="tooltip tooltip-up">Views</span>\n    </span>\n',i=o,new n.SafeString(l)}));t.addExport("model_view_count"),t.setVariable("model_view_count",p),s+="\n\n";var m=n.makeMacro(["model"],["options"],(function(r,s){var l=i;i=new n.Frame,(s=s||{}).hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("model",r),i.set("options",s.hasOwnProperty("options")?s.options:{});var u,h="";return u=e.getFilter("merge").call(t,{isMine:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",u,!0),i.topLevel&&t.setVariable("options",u),i.topLevel&&t.addExport("options",u),h+='<div class="model-cell__name-container">\n        <p class="model-cell__name ',h+=n.suppressValue(n.memberLookup(r,"isDeleted")?"--deleted":"",e.opts.autoescape),h+='">\n            ',h+=n.suppressValue((a=258,o=23,n.callWrap(n.contextOrFrameLookup(t,i,"model_name"),"model_name",t,[r,{clickable:!n.memberLookup(r,"isDeleted")}])),e.opts.autoescape),h+="\n        </p>\n\n        ",n.memberLookup(r,"isDeleted")&&(h+='\n            <span class="model-cell__deleted-tooltip help">\n                <i class="fa fa-question-circle"></i>\n                <span class="tooltip tooltip-right">\n                    This model was deleted',h+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"isMine")?"":", but no worries, you can still download the latest version!",e.opts.autoescape),h+="\n                </span>\n            </span>\n        "),h+="\n    </div>\n",i=l,new n.SafeString(h)}));t.addExport("model_cell_name"),t.setVariable("model_cell_name",m),r(null,s+="\n")}catch(e){r(n.handleError(e,a,o))}}}},"9NVG":()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/notification.jinja"]={root:function(e,t,i,n,r){var a="";try{a+="\n\n";var o=n.makeMacro(["type","content"],["options"],(function(r,a,o){var s=i;i=new n.Frame,(o=o||{}).hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("type",r),i.set("content",a),i.set("options",o.hasOwnProperty("options")?o.options:{});var l,u="";return u+="\n\n    ",l=e.getFilter("merge").call(t,{safecontent:!1},n.contextOrFrameLookup(t,i,"options")),i.set("options",l,!0),i.topLevel&&t.setVariable("options",l),i.topLevel&&t.addExport("options",l),u+='\n\n    <div class="flashmessage notification ',u+=n.suppressValue(r,e.opts.autoescape),u+='">\n        <div class="inner">\n            <button class="flashmessage-close" data-action="close" title="Close"></button>\n            <div class="message">\n                ',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"safecontent")?(u+="\n                    ",u+=n.suppressValue(e.getFilter("safe").call(t,a),e.opts.autoescape),u+="\n                "):(u+="\n                    ",u+=n.suppressValue(a,e.opts.autoescape),u+="\n                "),u+="\n            </div>\n        </div>\n    </div>\n\n",i=s,new n.SafeString(u)}));t.addExport("flashmessage"),t.setVariable("flashmessage",o),r(null,a+="\n")}catch(e){r(n.handleError(e,null,null))}}}},Bq0d:()=>{(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/vr/vr-menu.jinja"]={root:function(e,t,i,n,r){var a="";try{var o=n.makeMacro([],["options"],(function(e){var r=i;i=new n.Frame,(e=e||{}).hasOwnProperty("caller")&&i.set("caller",e.caller),i.set("options",e.hasOwnProperty("options")?e.options:{});var a="";return a+='\n\n<div style="width:700px;">',n.memberLookup(n.contextOrFrameLookup(t,i,"options"),"hasHotspotsNavigation")&&(a+='<div class="vr-menu-row">\n            <button  id="vrPrevButton" class="vr-button vr-button-small">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-arrow-left-white"></div>\n            </button>\n            <span class="vr-localize-icon">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-map-marker-white"></div>\n            </span>\n            <button id="vrNextButton" class="vr-button vr-button-small">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-arrow-right-white"></div>\n            </button>\n        </div>'),a+='<button id="vrHomeButton" class="vr-button">Home</button>\n    <button id="vrHelpButton" class="vr-button">Help</button>\n    <button id="vrExitButton" class="vr-button vr-round-button">\n        <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-times-white"></div>\n    </button>\n</div>\n',i=r,new n.SafeString(a)}));t.addExport("panel"),t.setVariable("panel",o),r(null,a+="\n")}catch(e){r(n.handleError(e,null,null))}}}},"dzb+":(e,t,i)=>{i("7+CA"),(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/partials/embed/iframe.jinja"]={root:function(e,t,i,n,r){var a=null,o=null,s="";try{e.getTemplate("skfb_front/macros/model.jinja",!1,"skfb_front/partials/embed/iframe.jinja",!1,(function(l,u){l?r(l):u.getExported((function(l,u){if(l)r(l);else if(u.hasOwnProperty("model_iframe")){var h=u.model_iframe;t.setVariable("model_iframe",h),s+='<div class="sketchfab-embed-wrapper">',s+=n.suppressValue((a=0,o=108,n.callWrap(h,"model_iframe",t,[e.getFilter("query_string").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"model"),"embedUrl"),n.memberLookup(n.contextOrFrameLookup(t,i,"parameters"),"flags")),{width:n.memberLookup(n.contextOrFrameLookup(t,i,"parameters"),"width"),height:n.memberLookup(n.contextOrFrameLookup(t,i,"parameters"),"height")}])),e.opts.autoescape),n.memberLookup(n.contextOrFrameLookup(t,i,"parameters"),"byline")&&(s+='\n    <p style="font-size: 13px; font-weight: normal; margin: 5px; color: #4A4A4A;">\n        <a href="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"model"),"viewerUrl"),e.opts.autoescape),s+=n.suppressValue(e.getFilter("safe").call(t,n.contextOrFrameLookup(t,i,"anchor")),e.opts.autoescape),s+='" target="_blank" style="font-weight: bold; color: #1CAAD9;">',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"model"),"name"),e.opts.autoescape),s+='</a>\n        by <a href="',s+=n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,i,"model"),"user"),"profileUrl"),e.opts.autoescape),s+=n.suppressValue(e.getFilter("safe").call(t,n.contextOrFrameLookup(t,i,"anchor")),e.opts.autoescape),s+='" target="_blank" style="font-weight: bold; color: #1CAAD9;">',s+=n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,i,"model"),"user"),"displayName"),e.opts.autoescape),s+='</a>\n        on <a href="https://sketchfab.com',s+=n.suppressValue(e.getFilter("safe").call(t,n.contextOrFrameLookup(t,i,"anchor")),e.opts.autoescape),s+='" target="_blank" style="font-weight: bold; color: #1CAAD9;">Sketchfab</a>\n    </p>\n'),r(null,s+="</div>\n")}else r(new Error("cannot import 'model_iframe'"))}))}))}catch(e){r(n.handleError(e,a,o))}}}},ytFi:(e,t,i)=>{i("r3Fc"),(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/popups/message.jinja"]={b_popup_content:function(e,t,i,n,r){var a="";try{i=i.push(!0),a+="\n\n    ",n.contextOrFrameLookup(t,i,"safe")?(a+="\n        ",a+=n.suppressValue(e.getFilter("safe").call(t,n.contextOrFrameLookup(t,i,"text")),e.opts.autoescape),a+="\n    "):(a+="\n        ",a+=n.suppressValue(n.contextOrFrameLookup(t,i,"text"),e.opts.autoescape),a+="\n    "),r(null,a+="\n\n")}catch(e){r(n.handleError(e,null,null))}},b_popup_footer:function(e,t,i,n,r){var a="";try{i=i.push(!0),a+='\n    <div class="actions">\n\n        ',a+="\n        ",a+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"cancel")&&(a+='\n            <button class="button btn-medium btn-tertiary cancel',n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"cancelClass")&&(a+=" ",a+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"cancelClass"),e.opts.autoescape)),a+='" type="reset">',a+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"cancelLabel"),"Cancel"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"close")&&(a+='\n            <button class="button btn-medium btn-tertiary',n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"cancelClass")&&(a+=" ",a+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"closeClass"),e.opts.autoescape)),a+='" type="reset" data-action="close">',a+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"closeLabel"),"Close"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"continue")&&(a+='\n            <button class="button btn-medium btn-primary submit',n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"continueClass")&&(a+=" ",a+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"continueClass"),e.opts.autoescape)),a+='" type="submit">',a+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"continueLabel"),"Continue"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"ok")&&(a+='\n            <button class="button btn-medium btn-primary submit',n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"okClass")&&(a+=" ",a+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"okClass"),e.opts.autoescape)),a+='" type="submit">',a+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"okLabel"),"OK"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"delete")&&(a+='\n            <button class="button btn-medium btn-danger submit',n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"deleteClass")&&(a+=" ",a+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"deleteClass"),e.opts.autoescape)),a+='" type="submit">',a+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(n.contextOrFrameLookup(t,i,"buttons"),"deleteLabel"),"Delete"),e.opts.autoescape),a+="</button>\n        "),r(null,a+="\n\n    </div>\n")}catch(e){r(n.handleError(e,null,null))}},root:function(e,t,i,n,r){var a="";try{var o=null;e.getTemplate("skfb_front/layouts/popup.jinja",!0,"skfb_front/popups/message.jinja",!1,(function(s,l){if(s)r(s);else{for(var u in(o=l).blocks)t.addBlock(u,o.blocks[u]);var h,c;a+="\n\n",h=n.contextOrFrameLookup(t,i,"title"),i.set("popupTitle",h,!0),i.topLevel&&t.setVariable("popupTitle",h),i.topLevel&&t.addExport("popupTitle",h),a+="\n\n",n.contextOrFrameLookup(t,i,"popupClass")||(a+="\n    ",c="popup-message",i.set("popupClass",c,!0),i.topLevel&&t.setVariable("popupClass",c),i.topLevel&&t.addExport("popupClass",c),a+="\n"),a+="\n\n",(o?function(e,t,i,n,r){r("")}:t.getBlock("popup_content"))(e,t,i,n,(function(s,l){s?r(s):(a+=l,a+="\n\n",(o?function(e,t,i,n,r){r("")}:t.getBlock("popup_footer"))(e,t,i,n,(function(s,l){s?r(s):(a+=l,a+="\n",o?o.rootRenderFunc(e,t,i,n,r):r(null,a))})))}))}}))}catch(e){r(n.handleError(e,null,null))}}}},"8mBa":e=>{e.exports="1438bc6517f4760ac8dc6bc30d7fd95d12652e4f\n"},orRi:e=>{e.exports={blue10:"#e8f7fb",blue20:"#4cc8f1",blue30:"#1db9ed",blue40:"#1caad9",blue50:"#1c88bb",blue60:"#007396",blue70:"#005e74",blue80:"#023748",blue90:"#01222d",skfbWhite:"#ffffff",skfbRed:"#f02624",skfbDarkRed:"#d7100e",skfbLightBlue:"#4cc8f1",skfbLighterBlue:"#e8f7fb",skfbLightBlueBackground:"#f7f9fa",skfbBlue:"#1caad9",skfbDarkBlue:"#1c88bb",skfbLightYellow:"#fff8eb",skfbYellow:"#fed600",skfbOrange:"#ff9e3a",skfbDarkOrange:"#ff8507",skfbGreen:"#28cca7",skfbBrightGreen:"#1ac95d",skfbPurple:"#df1660",skfbDarkPurple:"#c81859",skfbLightPurple:"#ffe4ee",skfbBlack:"#222222",skfbDarkBlack:"#000000",skfbGrey0:"#555555",skfbGrey1:"#888888",skfbGrey2:"#999999",skfbGrey3:"#cccccc",skfbGrey4:"#dddddd",skfbGrey5:"#e7e7e7",skfbGrey6:"#f2f2f2",skfbDarkAlpha:"rgba(0, 0, 0, 0.2)",skfbDarkAlpha2:"rgba(0, 0, 0, 0.4)",skfbBlueAlpha:"rgba(28, 170, 217, 0.1)",skfbEditorGrey0:"#000000",skfbEditorGrey1:"#1a1a1a",skfbEditorGrey2:"#333333",skfbEditorGrey3:"#595959",skfbEditorGrey4:"#666666",skfbEditorGrey5:"#777777",skfbEditorGrey6:"#888888",skfbEditorGrey7:"#cccccc",containerInfoBg:"#ddf6fa",containerInfoBorder:"#8bdded",containerWarningBg:"#fff8eb",containerWarningBorder:"#fed600",containerDangerBg:"#f6d3d6",containerDangerBorder:"#e07881",containerSuccessBg:"#e8fbec",containerSuccessBorder:"#92eca5",colorPositive:"#1ac95d",colorError:"#f02624",colorErrorLighten20:"#f02624",colorRestricted:"#f02624",colorDanger:"#f02624",colorWarning:"#fed600",colorStaff:"#ff9e3a",colorMaster:"#28cca7",websiteBackgroundColor:"#f2f2f2",websiteTopBackgroundColor:"white",websiteTopTextColor:"#222222",websiteTopHoverColor:"#1caad9",websiteTopSearchColor:"#999999",websiteTopSearchActiveColor:"black",websiteOddTextColor:"#555555",websiteOddLinkColor:"#1caad9",websiteOddHoverLinkColor:"#1c88bb",websiteEvenTextColor:"#eeeeee",websiteEvenLinkColor:"white",websiteEvenHoverLinkColor:"#f2f2f2",websiteSidebarIconColor:"#999999",editorColor:"#333333",editorImportantColor:"#0d0d0d",editorKeyColor:"#1a1a1a",editorMinorColor:"#4d4d4d",editorTrivialColor:"#595959",editorTextColor:"#cccccc",editorStrongColor:"white",editorBorderColor:"black",editorActiveColor:"#1caad9",editorScrollbarTrackColor:"#a3a3a3",editorScrollbarThumbColor:"#444444",viewerRadialBackgroundFrom:"#f2f2f2",viewerRadialBackgroundTo:"#b3b3b3",viewerPrimaryLoadingColor:"#1caad9",viewerSecondaryLoadingColor:"#1caad9",viewerBackgroundColor:"black",brandColor:"#1caad9",facebookColor:"#3a589a",twitterColor:"#1d9bf0",appleButtonColor:"white",googleButtonColor:"white",pinterestColor:"#ce1d21",linkedinColor:"#1884bc",instagramColor:"#125688",tumblrColor:"#36465d",redditColor:"#ff5700",mailColor:"#555555",websiteSuccessColor:"#00a317",storeColor:"#df1660",storeColorLighten5:"#e9256d",storeColorDarken5:"#c81456",storeColorDarken10:"#b1114c",storeHoverColor:"#c81859",storeGradient:"linear-gradient(45deg, #a60b43 0%, #f42671 100%)",websiteStoreCheckoutGradient:"linear-gradient(45deg, #1caad9, #4cc8f1)",labelColor:"#888888",dropdownArrowColor:"#b8b8b8",dropdownArrowColorHighlight:"#222222",linkColor:"#1caad9",linkHoverColor:"#1c88bb",privateLimitInfoBg:"#fff8eb",privateLimitInfoBorder:"#fed600",privateLimitReachedBg:"#f6d3d6",privateLimitReachedBorder:"#e07881",colorProUser:"#00aad8",colorPremUser:"#007395",colorEntUser:"#222222",userFlagPro:"#00aad8",userFlagPrem:"#007395",userFlagEnt:"#222222",userFlagStaff:"#ff9e3a",userFlagMaster:"#28cca7",colorHeaderTop:"#2e3338",colorHeaderMain:"#2a404e",colorButtonPrimary:"#1caad9",colorButtonTextBright:"#ffffff",colorButtonPrimaryDarken:"#1687ac",colorButtonPrimaryDarken15:"#137595"}},"1oLb":e=>{e.exports={websiteTopHeight:"60px",websiteBigTopHeight:"86px",websiteBannerHeight:"50px",websiteResponsiveTopHeight:"40px",websiteResponsiveNavigationWidth:"250px",websiteFullscreenPadding:"30px",editorHeaderHeight:"55px",editorPanelWidth:"320px",editorScrollbarWidth:"10px",editorGroupWidgetHeaderHeight:"30px",editorGroupWidgetSwitchWidth:"50px",editorGroupWidgetSwitchHeight:"24px",editorGroupWidgetSwitchMargin:"2px",editorGroupWidgetSwitchCursorWidth:"12px",editorNestedGroupWidgetSwitchMargin:"3px",editorImageWidgetWidth:"30px",editorImageWidgetHeight:"30px",promotionalBannerHeight:"70px",viewerControlSize:"30px",websiteMaxWidth:"2000px",responsiveBreakpointXLarge:"1400px",responsiveBreakpointMedium:"1100px",responsiveBreakpointXSmall:"800px",responsiveBreakpointXXSmall:"480px",breakpointXSmall:"576px",breakpointSmall:"768px",breakpointMediumSmall:"960px",breakpointMedium:"1024px",breakpointMediumLarge:"1280px",breakpointLarge:"1440px",breakpointXLarge:"1920px",responsiveGridOneColumn:"768px",responsiveGridTwoColumn:"1024px",responsiveGridThreeColumn:"1920px"}},"/fpc":(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var n,r,a,o,s,l=i("Hfbx"),u=i("0rAA"),h=i("Heae"),c=i("Xbee"),A=i("2bAw"),d=i("a72h"),g=i("FJW6"),f=function(){h.Z.call(this),this._matrix=c._E.create(),this._position=c.R3.create(),this._matrixDirty=!0,this._scale=c.R3.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=c.gf.create(),this._pivotPoint=c.R3.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=c._E.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=c._E.create(),this._previousModelView=c._E.create(),this._previousPosition=c.R3.create()};u.Z.createPrototypeNode(f,u.Z.objectInherit(h.Z.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(e){this._matrix=e,this.dirtyBound()},setPosition:function(e){this._position=e,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(e){this._rotation=e,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(e){this.setScaleFromVec3(c.R3.fromValues(e,e,e))},setScaleFromvec3:function(e){l.Z.warn("deprecated, use setScaleFromVec3"),this.setScaleFromVec3(e)},setScaleFromVec3:function(e){this._scale=e,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(e){this._minimumScale=e},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(e){this._maximumScale=e},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(e){this._autoScaleToScreen=e,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(e){this._autoRotateToScreen=e},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(e){this._autoScaleTransitionWidthRatio=e},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(e){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===d.Z.RELATIVE_RF?c._E.mul(e,e,this._matrix):c._E.copy(e,this._matrix)},computeMatrix:(o=c.R3.create(),s=c._E.create(),function(){this._matrixDirty&&(c._E.fromQuat(this._matrix,this._rotation),c._E.fromTranslation(s,this._position),c._E.mul(this._matrix,s,this._matrix),c._E.scale(this._matrix,this._matrix,this._scale),c._E.translate(this._matrix,this._matrix,c.R3.neg(o,this._pivotPoint)),this._matrixDirty=!1)}),computeWorldToLocalMatrix:function(){var e=c.R3.create(),t=c.gf.create(),i=c.R3.create(),n=c._E.create();return function(r){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(i[0]=1/this._scale[0],i[1]=1/this._scale[1],i[2]=1/this._scale[2],this.referenceFrame===d.Z.RELATIVE_RF?(c._E.fromTranslation(n,c.R3.neg(e,this._position)),c._E.mul(r,n,r),c.gf.zeroRotation(this._rotation)||(c._E.fromQuat(n,c.gf.invert(t,this._rotation)),c._E.mul(r,n,r)),c._E.fromScaling(n,i),c._E.mul(r,n,r),c._E.fromTranslation(n,this._pivotPoint),c._E.mul(r,n,r)):(c._E.fromQuat(this._matrix,c.gf.invert(t,this._rotation)),c._E.translate(r,r,c.R3.neg(e,this._position)),c._E.fromScaling(n,i),c._E.mul(r,n,r),c._E.fromTranslation(n,this._pivotPoint),c._E.mul(r,n,r)),!0)}}(),computeBound:(a=c._E.create(),function(e){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?e:(g.Z.prototype.computeBound.call(this,e),e.valid()?(c._E.identity(a),this.computeLocalToWorldMatrix(a),e.transformMat4(e,a),e):e)}),accept:function(e){if(e.getVisitorType()===A.Z.CULL_VISITOR){var t=e.getViewport().width(),i=e.getViewport().height(),n=e.getCurrentProjectionMatrix(),r=e.getCurrentModelViewMatrix(),a=this._position,o=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(t!==this._previousWidth||i!==this._previousHeight?o=!0:c._E.exactEquals(n,this._previousProjection)&&c._E.exactEquals(r,this._previousModelView)&&c.R3.exactEquals(a,this._previousPosition)||(o=!0)),this._firstTimeToInitEyePoint=!1,o){if(this._autoScaleToScreen){var s=e.getViewport(),l=this.computePixelSizeVector(s,n,r),u=c.vh.fromValues(this._position[0],this._position[1],this._position[2],1),h=c.vh.dot(u,l),d=1/(h=.48/h);if(this._autoScaleTransitionWidthRatio>0){var f,p,m;if(this._minimumScale>0){var _=this._minimumScale,v=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);m=_+(p=1-2*(f=1/(4*(v-_)))*v)*p/(4*f),d<-p/(2*f)?d=this._minimumScale:d<v&&(d=m+p*d+f*(d*d))}if(this._maximumScale<Number.MAX_VALUE){var C=this._maximumScale,b=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);m=C+(p=1-2*(f=1/(4*(b-C)))*b)*p/(4*f),d>-p/(2*f)?d=this._maximumScale:d>b&&(d=m+p*d+f*(d*d))}}this.setScale(d)}if(this._autoRotateToScreen){var S=c.gf.create();c._E.getRotation(S,r),this.setRotation(c.gf.invert(S,S))}this._previousWidth=t,this._previousHeight=i,c.R3.copy(this._previousPosition,a),c._E.copy(this._previousProjection,n),c._E.copy(this._previousModelView,r)}}g.Z.prototype.accept.call(this,e)},computePixelSizeVector:(n=c.R3.create(),r=c.R3.create(),function(e,t,i){var a=t[0]*e.width()*.5,o=t[8]*e.width()*.5+t[11]*e.width()*.5;c.R3.set(n,i[0]*a+i[2]*o,i[4]*a+i[6]*o,i[8]*a+i[10]*o);var s=t[5]*e.height()*.5,l=t[9]*e.height()*.5+t[11]*e.height()*.5;c.R3.set(r,i[1]*s+i[2]*l,i[5]*s+i[6]*l,i[9]*s+i[10]*l);var u=t[11],h=t[15],A=c.vh.fromValues(i[2]*u,i[6]*u,i[10]*u,i[14]*u+i[15]*h),d=.7071067811/Math.sqrt(c.R3.sqrLen(n)+c.R3.sqrLen(r));return c.vh.scale(A,A,d),A})}),"osg","AutoTransform");const p=f},zI6W:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=i("QrwD"),a=function(e,t,i,n){r.Z.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==e&&this.setSource(e),void 0!==t&&this.setDestination(t),void 0!==i&&this.setSourceAlpha(i),void 0!==n&&this.setDestinationAlpha(n)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,n.Z.createPrototypeStateAttribute(a,n.Z.objectInherit(r.Z.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(e){this.setSourceRGB(e),this.setSourceAlpha(e)},getSource:function(){return this._sourceFactor},setDestination:function(e){this.setDestinationRGB(e),this.setDestinationAlpha(e)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(e){this._sourceFactor="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(e){this._sourceFactorAlpha="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(e){this._destinationFactor="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(e){this._destinationFactorAlpha="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(e){e.applyBlendFunc(this)}}),"osg","BlendFunc");const o=a},Ko9s:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n,r,a=i("Hfbx"),o=i("0rAA"),s=i("Xbee"),l=function(){this._min=s.R3.create(),this._max=s.R3.create(),this.init()};o.Z.createPrototypeObject(l,{init:function(){s.R3.copy(this._min,s.R3.INFINITY),s.R3.copy(this._max,s.R3.NEGATIVE_INFINITY)},volume:function(){var e=this._max[0]-this._min[0];return e*=this._max[1]-this._min[1],e*=this._max[2]-this._min[2]},copy:function(e){s.R3.copy(this._min,e._min),s.R3.copy(this._max,e._max)},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(e){if(e.valid()){var t=this._max,i=this._min,n=e._radius,r=e._center[0],a=e._center[1],o=e._center[2];i[0]=Math.min(i[0],r-n),i[1]=Math.min(i[1],a-n),i[2]=Math.min(i[2],o-n),t[0]=Math.max(t[0],r+n),t[1]=Math.max(t[1],a+n),t[2]=Math.max(t[2],o+n)}},expandByvec3:function(e){a.Z.warn("deprecated, use expandByVec3"),this.expandByVec3(e)},expandByVec3:function(e){var t=this._min,i=this._max;t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),i[0]=Math.max(i[0],e[0]),i[1]=Math.max(i[1],e[1]),i[2]=Math.max(i[2],e[2])},expandByBoundingBox:function(e){if(e.valid()){var t=this._min,i=this._max,n=e._min,r=e._max;n[0]<t[0]&&(t[0]=n[0]),r[0]>i[0]&&(i[0]=r[0]),n[1]<t[1]&&(t[1]=n[1]),r[1]>i[1]&&(i[1]=r[1]),n[2]<t[2]&&(t[2]=n[2]),r[2]>i[2]&&(i[2]=r[2])}},center:function(e){var t=this._min,i=this._max;return e[0]=.5*(t[0]+i[0]),e[1]=.5*(t[1]+i[1]),e[2]=.5*(t[2]+i[2]),e},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var e=this._min,t=this._max,i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return.25*(i*i+n*n+r*r)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(e){return s.R3.copy(this._min,e),this},setMax:function(e){return s.R3.copy(this._max,e),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(e,t){return t[0]=1&e?this._max[0]:this._min[0],t[1]=2&e?this._max[1]:this._min[1],t[2]=4&e?this._max[2]:this._min[2],t},transformMat4:(n=s.R3.create(),r=s.R3.create(),function(e,t){var i=this.getMin(),a=this.getMax();s._E.getTranslation(n,t),s.R3.copy(r,n);for(var o=0;o<3;++o)for(var l=4*o,u=i[o],h=a[o],c=0;c<3;++c){var A=t[l+c],d=A*h,g=A*u;d<g?(n[c]+=d,r[c]+=g):(n[c]+=g,r[c]+=d)}var f=e.getMax(),p=e.getMin();return f[0]=r[0],f[1]=r[1],f[2]=r[2],p[0]=n[0],p[1]=n[1],p[2]=n[2],e})},"osg","BoundingBox");const u=l},EGrC:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A});var n,r,a,o,s=i("Hfbx"),l=i("0rAA"),u=i("Ko9s"),h=i("Xbee"),c=function(){this._center=h.R3.create(),this._radius=-1};l.Z.createPrototypeObject(c,{init:function(){h.R3.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(e,t){this._center=e,this._radius=t},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},volume:function(){var e=this._radius;return e*e*e*Math.PI*4/3},copy:function(e){this._radius=e._radius,h.R3.copy(this._center,e._center)},copyBoundingBox:function(e){e.center(this._center),this._radius=e.radius()},expandByBoundingBox:(a=h.R3.create(),o=new u.Z,function(e){if(e.valid())if(this.valid()){h.R3.copy(o._min,e._min),h.R3.copy(o._max,e._max);for(var t=0;t<8;t++)h.R3.sub(a,e.corner(t,a),this._center),h.R3.normalize(a,a),h.R3.scaleAndAdd(a,this._center,a,-this._radius),o.expandByVec3(a);o.center(this._center),this._radius=o.radius()}else this.copyBoundingBox(e)}),expandByvec3:function(e){s.Z.warn("deprecated, use expandByVec3"),this.expandByVec3(e)},expandByVec3:(r=h.R3.create(),function(e){if(this.valid()){h.R3.sub(r,e,this.center(r));var t=h.R3.length(r);if(t>this.radius()){var i=.5*(t-this.radius());this._center[0]+=r[0]*(i/t),this._center[1]+=r[1]*(i/t),this._center[2]+=r[2]*(i/t),this._radius+=i}}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0}),expandRadiusBySphere:function(e){if(e.valid())if(this.valid()){var t=h.R3.distance(this._center,e._center)+e._radius;t>this._radius&&(this._radius=t)}else h.R3.copy(this._center,e._center),this._radius=e._radius},expandByBoundingSphere:function(e){if(e.valid()){if(!this.valid())return this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],void(this._radius=e.radius());var t=h.R3.distance(e.center(),this.center());if(!(t+e.radius()<=this.radius())){if(t+this.radius()<=e.radius())return this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],void(this._radius=e._radius);var i=.5*(this.radius()+t+e.radius()),n=(i-this.radius())/t;this._center[0]+=(e._center[0]-this._center[0])*n,this._center[1]+=(e._center[1]-this._center[1])*n,this._center[2]+=(e._center[2]-this._center[2])*n,this._radius=i}}},contains:function(e){return!!this.valid()&&h.R3.sqrDist(this.center(),e)<=this.radius2()},intersects:function(e){if(!this.valid()||!e.valid())return!1;var t=this.radius()+e.radius();return h.R3.sqrDist(e.center(),this.center())<=t*t},transformMat4:(n=h.R3.create(),function(e,t){if(!this.valid())return e;e._center!==this._center&&(h.R3.copy(e._center,this._center),e._radius=this._radius);var i=e._center,r=e._radius;return h._E.getSqrScale(n,t),r*=Math.sqrt(Math.max(Math.max(n[0],n[1]),n[2])),e._radius=r,h.R3.transformMat4(i,i,t),e})},"osg","BoundingSphere");const A=c},LERn:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var n=i("Hfbx"),r=i("0rAA"),a=i("vrBm"),o=i("QuvP"),s=i("83E6"),l=i("Xbee"),u=i("5Cxy"),h=function(e){i("sFNe").Z.logMessage(e)},c=function(e,t,i){o.Z.call(this),this._instanceID=a.Z.getInstanceID(),this.dirty(),this._itemSize=i,this._target="string"==typeof e?c[e]:e,this._type=void 0,this._normalize=!1,t&&(void 0===t.byteLength&&(n.Z.warn("BufferArray with non typedArray elements is deprecated"),t=this._target===c.ELEMENT_ARRAY_BUFFER?new r.Z.Uint16Array(t):new r.Z.Float32Array(t)),this.setElements(t)),this._usage=c.STATIC_DRAW},A=function(e,t){return e+Math.random()*(t-e)},d=l.R3.fromValues(A(.1,10),A(4.2,7.5),A(.7,1.5));c.randa=d,c.ELEMENT_ARRAY_BUFFER=34963,c.ARRAY_BUFFER=34962,c.STATIC_DRAW=35044,c.DYNAMIC_DRAW=35048,c.STREAM_DRAW=35040,c._sDeletedGLBufferArrayCache=new window.Map,c.deleteGLBufferArray=function(e,t){c._sDeletedGLBufferArrayCache.has(e)||c._sDeletedGLBufferArrayCache.set(e,[]),c._sDeletedGLBufferArrayCache.get(e).push(t)},c.flushDeletedGLBufferArrays=function(e,t){if(t<=0)return t;if(!c._sDeletedGLBufferArrayCache.has(e))return t;for(var i=0,n=s.Z.instance().tick(),r=c._sDeletedGLBufferArrayCache.get(e),a=r.length-1;a>=0&&i<t;a--)e.deleteBuffer(r[a]),r.splice(a,1),i=s.Z.instance().deltaS(n,s.Z.instance().tick());return t-i},c.flushAllDeletedGLBufferArrays=function(e){if(c._sDeletedGLBufferArrayCache.has(e))for(var t=c._sDeletedGLBufferArrayCache.get(e),i=t.length-1;i>=0;i--)e.deleteBuffer(t[i]),t.splice(i,1)},c.onLostContext=function(e){c._sDeletedGLBufferArrayCache.has(e)&&(c._sDeletedGLBufferArrayCache.get(e).length=0)},r.Z.createPrototypeObject(c,r.Z.objectInherit(o.Z.prototype,{setUsage:function(e){this._usage=e},getUsage:function(){return this._usage},getInstanceID:function(){return this._instanceID},setItemSize:function(e){this._itemSize=e},isValid:function(){return!!this._buffer||!(!this._elements||!this._elements.length)},invalidate:function(){this._buffer=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&(c.deleteGLBufferArray(this._gl,this._buffer),o.Z.removeObject(this._gl,this)),this.invalidate()},setNormalize:function(e){this._normalize=e},getNormalize:function(){return this._normalize},bind:function(e){this._gl||this.setGraphicContext(e);var t=this._target,i=this._buffer;i?e.bindBuffer(t,i):!i&&this._elements.length>0&&(this._buffer=e.createBuffer(),this._numItems=this._elements.length/this._itemSize,e.bindBuffer(t,this._buffer))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},setElements:function(e){var t,i;this._elements=e,this._type=((t=e)instanceof r.Z.Float32Array&&(i=5126),t instanceof r.Z.Int16Array&&(i=5122),t instanceof r.Z.Uint16Array&&(i=5123),t instanceof r.Z.Int8Array&&(i=5120),t instanceof r.Z.Uint8Array&&(i=5121),t instanceof r.Z.Uint8ClampedArray&&(i=5121),t instanceof r.Z.Int32Array&&(i=5124),t instanceof r.Z.Uint32Array&&(i=5125),i),this._dirty=!0},getType:function(){return this._type},compile:function(e){if(this._dirty)return this._QTAN||this._QNOR?this._encodeDirection(e):this._QVS?this._encodeVertex(e):this._QUV?this._encodeUV(e):void this.compileGl(e)},compileGl:function(e){this._dirty&&(e.bufferData(this._target,this._elements,this._usage),this._dirty=!1)},getGlItemSize:function(){return this._glItemSize||this._itemSize},getGlType:function(){return this._glType||this._type},getGlNormalize:function(){return this._glNormalize||this._normalize},getElements:function(){return this._elements},computeMinMaxVertex:function(e,t,i){return this._minMaxVertex(e,t,i)},computeMinMaxUV:function(e,t,i){return this._minMaxUV(e,t,i)},_minMaxVertex:function(e,t,i){for(var n=1/0,r=1/0,a=1/0,o=-1/0,s=-1/0,l=-1/0,u=this.getElements(),h=void 0===i?u.length:i,c=t||0;c<h;c+=3){var A=u[c],d=u[c+1],g=u[c+2];A<n&&(n=A),d<r&&(r=d),g<a&&(a=g),A>o&&(o=A),d>s&&(s=d),g>l&&(l=g)}return o<=n&&(o=.001),s<=r&&(s=.001),l<=a&&(l=.001),e.xmin=n,e.xmax=o,e.ymin=r,e.ymax=s,e.zmin=a,e.zmax=l,e},_minMaxUV:function(e,t,i){for(var n=1/0,r=1/0,a=-1/0,o=-1/0,s=this.getElements(),l=void 0===i?s.length:i,u=t||0;u<l;u+=2){var h=s[u],c=s[u+1];h<n&&(n=h),c<r&&(r=c),h>a&&(a=h),c>o&&(o=c)}return a<=n&&(a=.001),o<=r&&(o=.001),e.xmin=n,e.ymin=r,e.xmax=a,e.ymax=o,e},_compileHook:function(e,t,i,n){var r=this.getElements(),a=this.getItemSize(),o=this.getNormalize();this.setNormalize(i),this.setItemSize(t),this.setElements(e),this._glType=this.getType(),this._glItemSize=t,this._glNormalize=i,this.compileGl(n),this.setElements(r),this.setItemSize(a),this.setNormalize(o),this._dirty=!1},_encodeDirection:function(e){for(var t=this.getElements(),i=t.length,n=32767,r=this.getItemSize(),a=r-1,o=0,s=new Int16Array(a*i/r),l=(0,u.Z)().zoct,h=0;h<i;h+=r){var c=t[h],A=t[h+1],d=t[h+2],g=1/Math.sqrt(c*c+A*A+d*d);if(c*=g,A*=g,d*=g,l){var f=1/(Math.abs(c)+Math.abs(A)+Math.abs(d)),p=c*f,m=A*f,_=d*f,v=_>=0?p:(1-Math.abs(m))*(Math.sign(p)||1),C=_>=0?m:(1-Math.abs(p))*(Math.sign(m)||1);s[o]=n*v,s[o+1]=n*C}else if(d<=-.99999)s[o]=n*Math.sqrt(.5),s[o+1]=n*Math.sqrt(.5);else{var b=1/Math.sqrt(2*d+2);s[o]=n*c*b,s[o+1]=n*A*b}3===a&&(s[o+2]=n*t[h+3]),o+=a}this._compileHook(s,a,!0,e)},_encodeVertex:function(e){var t=this._QVS,i=this._QVT,n=this.getElements(),r=this._FQU||this._minMax&&this._minMax._FQU;r&&h("vFQU - "+this.getInstanceID());for(var a=(0,u.Z)().zq&&!r,o=a?65535:1,s=a?Uint16Array:Float32Array,l=1/(d[0]*t[0]),c=1/(d[1]*t[1]),A=1/(d[2]*t[2]),g=i[0],f=i[1],p=i[2],m=(0,u.Z)().zw,_=this.getItemSize(),v=m?4:3,C=n.length,b=new s(v*C/_),S=0,E=0;E<C;E+=_){var y=l*(n[E]-g),I=c*(n[E+1]-f),x=A*(n[E+2]-p);if(b[S]=o*y,b[S+1]=o*I,b[S+2]=o*x,m){var T=Math.min(b[S],b[S+1],b[S+2]);b[S]-=T,b[S+1]-=T,b[S+2]-=T,b[S+3]=T}S+=v}this._compileHook(b,v,a,e)},_encodeUV:function(e){var t=this._QUV,i=t[0],n=t[1],r=1/t[2],a=1/t[3],o=this.getElements(),s=o.length,u=0;if(Math.max(t[2],t[3])/65535>1/2048)return h("NoQUV - "+this.getInstanceID()),this.compileGl(e),void l.vh.set(t,0,0,1,1);var c=65535*r,A=65535*a,d=new Uint16Array(s);for(u=0;u<s;u+=2)d[u]=c*(o[u]-i),d[u+1]=A*(o[u+1]-n);this._compileHook(d,2,!0,e)}}),"osg","BufferArray");const g=c},"JWq/":(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("LERn"),r=function(e){this._initialBufferArray=void 0,this._bufferArray=void 0,e&&(this.setBufferArray(e),this.setInitialBufferArray(e))},a={setInitialBufferArray:function(e){this._initialBufferArray=e},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(e){this._bufferArray=e.getBufferArray?e.getBufferArray():e},getBufferArray:function(){return this._bufferArray},getGlItemSize:function(){return this._bufferArray.getGlItemSize()},getGlType:function(){return this._bufferArray.getGlType()},getGlNormalize:function(){return this._bufferArray.getGlNormalize()}},o=function(e){return function(){return e.apply(this._bufferArray,arguments)}};for(var s in n.Z.prototype)a[s]=o(n.Z.prototype[s]);r.prototype=a;const l=r},OYOS:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n,r=i("0rAA"),a=i("Heae"),o=i("Z54E"),s=i("Xbee"),l=i("FCEq"),u=i("a72h"),h=function(){a.Z.call(this),o.Z.call(this),this.viewport=void 0,this._graphicContext=void 0,this._scissor=void 0,this.setClearColor(s.vh.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),this.setViewMatrix(s._E.create()),this.setProjectionMatrix(s._E.create()),this.renderOrder=h.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};h.PRE_RENDER=0,h.NESTED_RENDER=1,h.POST_RENDER=2,h.COLOR_BUFFER_BIT=16384,h.DEPTH_BUFFER_BIT=256,h.STENCIL_BUFFER_BIT=1024,r.Z.createPrototypeNode(h,r.Z.objectInherit(o.Z.prototype,r.Z.objectInherit(a.Z.prototype,{getView:function(){return this._view},setView:function(e){this._view=e},getRenderer:function(){return this._renderer},setRenderer:function(e){this._renderer=e},setFinalDrawCallback:function(e){this._finalDrawCallback=e},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(e){this._initialDrawCallback=e},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(e){this._graphicContext=e},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setClearColor:function(e){this.clearColor=e},getClearColor:function(){return this.clearColor},setViewport:function(e){this.viewport=e,this.getOrCreateStateSet().setAttributeAndModes(e)},getViewport:function(){return this.viewport},setScissor:function(e){this._scissor=e,this.getOrCreateStateSet().setAttributeAndModes(this._scissor)},getScissor:function(){return this._scissor},setViewMatrix:function(e){this.modelviewMatrix=e},setViewMatrixAsLookAt:function(e,t,i){s._E.lookAt(this.getViewMatrix(),e,t,i)},setProjectionMatrix:function(e){this.projectionMatrix=e},setProjectionMatrixAsOrtho:function(e,t,i,n,r,a){s._E.ortho(this.getProjectionMatrix(),e,t,i,n,r,a)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(e,t){this.renderOrder=e,this.renderOrderNum=t},getFrameBufferObject:function(){return this.frameBufferObject},setFrameBufferObject:function(e){this.frameBufferObject=e},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(e,t,i){this.frameBufferObject&&this.frameBufferObject.dirty(),i||(i=l.Z.TEXTURE_2D),this._attachments[e]={attachment:e,texture:t,textureTarget:i}},attachRenderBuffer:function(e,t){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[e]={format:t,attachment:e}},computeLocalToWorldMatrix:function(e){return this.referenceFrame===u.Z.RELATIVE_RF?s._E.mul(e,e,this.modelviewMatrix):s._E.copy(e,this.modelviewMatrix),!0},computeWorldToLocalMatrix:(n=s._E.create(),function(e){return s._E.invert(n,this.modelviewMatrix),this.referenceFrame===u.Z.RELATIVE_RF?s._E.mul(e,n,e):s._E.copy(e,n),!0})})),"osg","Camera");const c=h},"10ce":(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n,r=i("Ko9s"),a=i("EUBb"),o=i("Xbee"),s=i("Heae"),l=i("2bAw"),u=i("0rAA"),h=i("BW96"),c=i("U7nq"),A=function(e){l.Z.call(this,e),this._pooledMatrix=new c.Z(o._E.create),this._matrixStack=new h.Z,this._matrixStack.push(o._E.IDENTITY),this._bb=new r.Z};u.Z.createPrototypeObject(A,u.Z.objectInherit(l.Z.prototype,{reset:function(){this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(o._E.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(e){var t=this._pooledMatrix.getOrCreateObject();o._E.copy(t,this._matrixStack.back()),e.computeLocalToWorldMatrix(t,this),this.pushMatrix(t),this.traverse(e),this.popMatrix()},apply:function(e){e instanceof s.Z?this.applyTransform(e):e instanceof a.Z?this.applyBoundingBox(e.getBoundingBox()):this.traverse(e)},pushMatrix:function(e){this._matrixStack.push(e)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:(n=new r.Z,function(e){e.valid()&&(e.transformMat4(n,this._matrixStack.back()),this._bb.expandByBoundingBox(n))}),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor");const d=A},TKk8:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=i("QrwD"),a=function(e){r.Z.call(this),this.setMode(void 0!==e?e:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,n.Z.createPrototypeStateAttribute(a,n.Z.objectInherit(r.Z.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(e){var t=e;"string"==typeof t&&(t=a[t]),this._mode=t},getMode:function(){return this._mode},apply:function(e){e.applyCullFace(this)}}),"osg","CullFace");const o=a},Z54E:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=function(){n.prototype.reset.call(this)};n.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(e){this._computeNearFar=e._computeNearFar,this._nearFarRatio=e._nearFarRatio,this._enableFrustumCulling=e._enableFrustumCulling,this._settingsSourceOverrider=e._settingsSourceOverrider,this._clampProjectionMatrixCallback=e._clampProjectionMatrixCallback},setNearFarRatio:function(e){this._nearFarRatio=e},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(e){this._computeNearFar=e},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(e){this._enableFrustumCulling=e},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(e){this._clampProjectionMatrixCallback=e},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(e){this._LODScale=e},getLODScale:function(){return this._LODScale}};const r=n},"/RJa":(e,t,i)=>{"use strict";i.d(t,{Z:()=>b});var n,r,a,o=i("0rAA"),s=i("EGrC"),l=i("OYOS"),u=i("z6Oe"),h=i("Z54E"),c=i("mQYp"),A=i("Xbee"),d=i("XOVK"),g=i("Heae"),f=i("a72h"),p=i("BW96"),m=i("U7nq"),_=i("kJFG"),v=function(){return new c.Z},C=function(){this._modelViewMatrixStack=new p.Z,this._projectionMatrixStack=new p.Z,this._viewportStack=new p.Z,this._cullingSetStack=new p.Z,this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._pooledMatrix=new m.Z(A._E.create),this._pooledCullingSet=new m.Z(v),this._cameraIndexStack=new p.Z,this._cameraModelViewIndexStack=new p.Z,this._cameraMatrixInverse=new _.Z,this._cameraMatrixInverseRoot=void 0};o.Z.createPrototypeObject(C,o.Z.objectInherit(h.Z.prototype,{reset:function(){this._modelViewMatrixStack.reset(),this._projectionMatrixStack.reset(),this._cullingSetStack.reset(),this._pooledMatrix.reset(),this._pooledCullingSet.reset(),this._cameraModelViewIndexStack.reset(),this._cameraIndexStack.reset(),this._cameraMatrixInverse.reset(),this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack.back()},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack.back()},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.getLength())return this._cameraMatrixInverseRoot;var e=this._cameraIndexStack.back(),t=this.getNodePath()[e].getInstanceID(),i=this._cameraMatrixInverse.getMap()[t];if(void 0===i){var n=this._cameraModelViewIndexStack.back(),r=this._modelViewMatrixStack.getArray()[n];i=this._pooledMatrix.getOrCreateObject(),A._E.invert(i,r),this._cameraMatrixInverse.set(t,i)}return i},getCurrentModelMatrix:function(){var e=this.getCameraInverseMatrix(),t=this._pooledMatrix.getOrCreateObject();return A._E.mul(t,e,this.getCurrentModelViewMatrix())},getCurrentViewMatrix:function(){var e=this._modelViewMatrixStack.getArray();return this._cameraIndexStack.getLength()?e[this._cameraModelViewIndexStack.back()]:e[0]},getViewport:function(){if(0!==this._viewportStack.getLength())return this._viewportStack.back()},getLookVectorLocal:function(e){var t=this.getCurrentModelViewMatrix();return A.R3.set(e,-t[2],-t[6],-t[10])},pushViewport:function(e){this._viewportStack.push(e)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:(a=A._E.create(),function(e,t,i,n){A._E.mul(a,t,i);var r=!!n,o=e[0];o[0]=a[3]-a[0],o[1]=a[7]-a[4],o[2]=a[11]-a[8],o[3]=a[15]-a[12];var s=e[1];s[0]=a[3]+a[0],s[1]=a[7]+a[4],s[2]=a[11]+a[8],s[3]=a[15]+a[12];var l=e[2];l[0]=a[3]+a[1],l[1]=a[7]+a[5],l[2]=a[11]+a[9],l[3]=a[15]+a[13];var u=e[3];if(u[0]=a[3]-a[1],u[1]=a[7]-a[5],u[2]=a[11]-a[9],u[3]=a[15]-a[13],r){var h=e[4];h[0]=a[3]-a[2],h[1]=a[7]-a[6],h[2]=a[11]-a[10],h[3]=a[15]-a[14];var c=e[5];c[0]=a[3]+a[2],c[1]=a[7]+a[6],c[2]=a[11]+a[10],c[3]=a[15]+a[14]}for(var g=n?6:4,f=0;f<g;f++)d.Z.normalizeEquation(e[f])}),pushCullingSet:function(){var e=this._pooledCullingSet.getOrCreateObject();this._enableFrustumCulling&&(A._E.getFrustumPlanes(e.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),e.getFrustum().setupMask(4)),this._cullingSetStack.push(e)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack.back()},pushCurrentMask:function(){var e=this.getCurrentCullingSet();e&&e.pushCurrentMask()},popCurrentMask:function(){var e=this.getCurrentCullingSet();e&&e.popCurrentMask()},isVerticesCulled:function(e){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(e)},isBoundingBoxCulled:function(e){return!!this._enableFrustumCulling&&(e.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(e))},isBoundingSphereCulled:function(e){return!!this._enableFrustumCulling&&(e.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(e))},isCulled:(r=new s.Z,function(e,t){if(!this._enableFrustumCulling)return!1;if(e.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var i=this._pooledMatrix.getOrCreateObject();A._E.identity(i);var n=t.length;return e instanceof g.Z&&n--,u.Z.computeLocalToWorld(t,!0,i,n),e.getBound().transformMat4(r,i),this.getCurrentCullingSet().isBoundingSphereCulled(r)}return this.getCurrentCullingSet().resetCullingMask(),!1}),pushModelViewMatrix:(n=A.R3.create(),function(e){var t=this.getNodePath(),i=t.length;if(i){var r=i-1;t[r].getTypeID()===l.Z.getTypeID()&&t[r].getReferenceFrame()===f.Z.ABSOLUTE_RF&&(this._cameraIndexStack.push(r),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.getLength()))}else{var a=this._pooledMatrix.getOrCreateObject();A._E.invert(a,e),this._cameraMatrixInverseRoot=a}this._modelViewMatrixStack.push(e),this.getLookVectorLocal(n),this._bbCornerFar=(n[0]>=0?1:0)|(n[1]>=0?2:0)|(n[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}),popModelViewMatrix:function(){var e=A.R3.create();return function(){var t=this.getNodePath().length-1;this._cameraIndexStack.getLength()&&t===this._cameraIndexStack.back()&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),this._modelViewMatrixStack.getLength()?this.getLookVectorLocal(e):A.R3.set(e,0,0,-1),this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(e){this._projectionMatrixStack.push(e),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),"osg","CullStack");const b=C},Uf0x:(e,t,i)=>{"use strict";i.d(t,{Z:()=>V});var n,r,a=i("Hfbx"),o=i("0rAA"),s=i("OEJe"),l=i("2bAw"),u=i("Z54E"),h=i("/RJa"),c=i("Xbee"),A=i("aS0i"),d=i("/fpc"),g=i("KOpT"),f=i("1lj/"),p=i("q8o9"),m=i("EUBb"),_=i("eaVu"),v=i("UvG5"),C=i("DynT"),b=i("FJW6"),S=i("fd33"),E=i("m+0q"),y=i("Rqdv"),I=i("OYOS"),x=i("a72h"),T=i("M6jq"),w=i("eyVe"),M=i("KiRa"),R=i("Zodj"),B=i("BW96"),N=i("U7nq"),D=function(){return new _.Z},P=function(){return new u.Z},F=function(){l.Z.call(this,l.Z.TRAVERSE_ACTIVE_CHILDREN),u.Z.call(this),h.Z.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this._camera=void 0,this._pooledLeaf=new N.Z(D),this._pooledRenderStages={},this._pooledCullSettings=new N.Z(P),this._renderBinStack=new B.Z,this.visitorType=l.Z.CULL_VISITOR,this._identityMatrix=c._E.create(),this._renderer=void 0,this._renderStageType=C.Z,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};F.registerApplyFunction=p.Z.registerApplyFunction,F.getApplyFunction=p.Z.getApplyFunction,o.Z.createPrototypeObject(F,o.Z.objectInherit(h.Z.prototype,o.Z.objectInherit(l.Z.prototype,{applyFunctionArray:p.Z.applyFunctionArray,distance:function(e,t){return-(e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+t[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(e){var t=e.getCullCallback();t&&!t.cull(e,this)||this.traverse(e)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:(n=c.R3.create(),r=c.R3.create(),function(e,t){var i,a,o=t.getBoundingBox();if((i=this.distance(o.corner(this._bbCornerNear,n),e))>(a=this.distance(o.corner(this._bbCornerFar,r),e))){var s=i;i=a,a=s}return!(a<0||(i<this._computedNear&&(this._computedNear=i),a>this._computedFar&&(this._computedFar=a),0))}),setStateGraph:function(e){this._rootStateGraph=e,this._currentStateGraph=e},setRenderStage:function(e){this._rootRenderStage=e,this._currentRenderBin=e},setRenderer:function(e){this._renderer=e},getRenderer:function(){return this._renderer},reset:function(){for(var e in h.Z.prototype.reset.call(this),this._pooledLeaf.reset(),this._pooledCullSettings.reset(),this._pooledRenderStages)this._pooledRenderStages[e].reset();v.Z.reset(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(e){this._currentRenderBin=e},addPositionedAttribute:function(e,t){var i=e||this._identityMatrix;this._currentRenderBin.getStage().addPositionAttribute(i,t)},pushStateSet:function(e){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(e),void 0!==e.getBinName()){var t=this._renderBinStack,i=this._currentRenderBin;t.push(i),this._currentRenderBin=i.getStage().findOrInsert(e.getBinNumber(),e.getBinName())}},popStateSet:function(){var e=this._currentStateGraph,t=e.getStateSet();if(this._currentStateGraph=e.getParent(),void 0!==t.getBinName()){var i=this._renderBinStack;0===i.getLength()?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=i.pop()}},popProjectionMatrix:function(){if(!0===this._computeNearFar&&this._computedFar>=this._computedNear){var e=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(e,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(e,this._computedNear,this._computedFar,this._nearFarRatio)}h.Z.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(e,t,i,n,r){var o,s,l=1e-6;if(i<t-l)return a.Z.log("clampProjectionMatrix not applied, invalid depth range, znear = "+t+"  zfar = "+i,!1,!0),!1;if(i<t+l){var u=.5*(t+i);t=u-l,i=u+l}if(Math.abs(e[3])<l&&Math.abs(e[7])<l&&Math.abs(e[11])<l){var h=.02*(i-t);h<1&&(h=1),t=o=t-h,i=s=i+h,e[10]=-2/(s-o),e[14]=-(s+o)/(s-o)}else{var c=i*n;(o=.98*t)<c&&(o=c),t=o,i=s=1.02*i;var A=e[10],d=e[14],g=e[11],f=e[15],p=(-o*A+d)/(-o*g+f),m=(-s*A+d)/(-s*g+f),_=Math.abs(2/(p-m)),v=-(p+m)/2*_;e[2]=e[2]*_+e[3]*v,e[6]=e[6]*_+e[7]*v,e[10]=A*_+g*v,e[14]=d*_+f*v}return void 0!==r&&(r[0]=t,r[1]=i),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(e,t,i){this.pushModelViewMatrix(t),this.pushProjectionMatrix(i)},apply:function(e){this.applyFunctionArray[e.nodeTypeID].call(this,e)},createOrReuseRenderLeaf:function(){return this._pooledLeaf.getOrCreateObject()},createOrReuseRenderStage:function(e){var t=e?e.className():"RenderStage";if(!this._pooledRenderStages[t]){var i=e?e.constructor:C.Z;this._pooledRenderStages[t]=new N.Z((function(){return new i}))}return this._pooledRenderStages[t].getOrCreateObject().init()},postPushGeometry:function(e,t){var i,n;t instanceof w.Z?((n=t.getStateSetAnimation())&&e.pushStateSet(n),(i=t.getSourceGeometry())instanceof R.Z&&(n=i.getStateSetAnimation())&&e.pushStateSet(n)):t instanceof R.Z&&(n=t.getStateSetAnimation())&&e.pushStateSet(n)},prePopGeometry:function(e,t){if(t instanceof w.Z){var i=t.getSourceGeometry();i instanceof R.Z&&i.getStateSetAnimation()&&e.popStateSet(),t.getStateSetAnimation()&&e.popStateSet()}else t instanceof R.Z&&t.getStateSetAnimation()&&e.popStateSet()},pushLeaf:function(e,t){var i=this._currentStateGraph.getLeafs();i.getLength()||this._currentRenderBin.addStateGraph(this._currentStateGraph);var n=this.createOrReuseRenderLeaf();n.init(this._currentStateGraph,e,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),t),i.push(n)}})),"osg","CullVisitor");var O=function(e){if(this._numMatrixTransform++,!this.isCulled(e,this.nodePath)){this.pushCurrentMask();var t=this._pooledMatrix.getOrCreateObject(),i=this.getCurrentModelViewMatrix();c._E.copy(t,i),e.computeLocalToWorldMatrix(t),this.pushModelViewMatrix(t);var n=e.getStateSet();n&&this.pushStateSet(n),this.handleCullCallbacksAndTraverse(e),n&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},L=function(e){if(this._numNode++,!this.isCulled(e,this.nodePath)){this.pushCurrentMask();var t=e.getStateSet();t&&this.pushStateSet(t),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet(),this.popCurrentMask()}},k=c.R3.create(),Z=!1,U=function(e){this._numGeometry++;var t=this.getCurrentModelViewMatrix(),i=e.getBoundingBox(),n=i.valid();if(!this._computeNearFar||!n||this.updateCalculatedNearFar(t,e)){var r=e.getCullCallback();if(!r||r.cull(e,this)){var o=e.getStateSet();o&&this.pushStateSet(o),this.postPushGeometry(this,e);var l=0;n?(l=this.distance(i.center(k),t),s.Z.isNaN(l)?Z||(a.Z.warn("warning geometry has a NaN depth, "+t+" center "+k),Z=!0):this.pushLeaf(e,l)):this.pushLeaf(e,l),this.prePopGeometry(this,e),o&&this.popStateSet()}}};p.Z.registerApplyFunction(b.Z.nodeTypeID,L),p.Z.registerApplyFunction(E.Z.nodeTypeID,L),p.Z.registerApplyFunction(y.Z.nodeTypeID,L),p.Z.registerApplyFunction(I.Z.nodeTypeID,(function(e){this._numCamera++;var t=e.getStateSet();t&&this.pushStateSet(t);var i=this._pooledMatrix.getOrCreateObject(),n=this._pooledMatrix.getOrCreateObject();if(e.getReferenceFrame()===x.Z.RELATIVE_RF){var r=this.getCurrentProjectionMatrix();c._E.mul(n,r,e.getProjectionMatrix());var a=this.getCurrentModelViewMatrix();c._E.mul(i,a,e.getViewMatrix())}else c._E.copy(i,e.getViewMatrix()),c._E.copy(n,e.getProjectionMatrix());var o=this._computedNear,s=this._computedFar,l=this._pooledCullSettings.getOrCreateObject();if(l.reset(),l.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(e),l.getSettingSourceOverrider()===this&&l.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(e,i,n),e.getViewport()&&this.pushViewport(e.getViewport()),e.getRenderOrder()===I.Z.NESTED_RENDER)this.handleCullCallbacksAndTraverse(e);else{var u=this.getCurrentRenderBin(),h=u.getStage(),A=this.createOrReuseRenderStage(this._rootRenderStage);A.setCamera(e),A.setClearDepth(e.getClearDepth()),A.setClearColor(e.getClearColor()),A.setClearMask(e.getClearMask());var d=e.getViewport()?e.getViewport():h.getViewport(),g=e.getScissor()?e.getScissor():h.getScissor();A.setViewport(d),A.setScissor(g),this.setCurrentRenderBin(A),this.handleCullCallbacksAndTraverse(e),this.setCurrentRenderBin(u),e.getRenderOrder()===I.Z.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(A,e.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(A,e.renderOrderNum)}this.popCameraModelViewProjectionMatrix(e),e.getViewport()&&this.popViewport(),this.setCullSettings(l),this._computedNear=o,this._computedFar=s,t&&this.popStateSet()})),p.Z.registerApplyFunction(A.Z.nodeTypeID,O),p.Z.registerApplyFunction(g.Z.nodeTypeID,(function(e){this._numProjection++;var t=this.getCurrentProjectionMatrix(),i=this._pooledMatrix.getOrCreateObject();c._E.mul(i,t,e.getProjectionMatrix()),this.pushProjectionMatrix(i);var n=e.getStateSet();n&&this.pushStateSet(n),this.handleCullCallbacksAndTraverse(e),n&&this.popStateSet(),this.popProjectionMatrix()})),p.Z.registerApplyFunction(m.Z.nodeTypeID,U),p.Z.registerApplyFunction(T.Z.nodeTypeID,O),p.Z.registerApplyFunction(M.Z.nodeTypeID,O),p.Z.registerApplyFunction(d.Z.nodeTypeID,O),p.Z.registerApplyFunction(S.Z.nodeTypeID,L),p.Z.registerApplyFunction(f.Z.nodeTypeID,(function(e){this._numLightSource++;var t=e.getStateSet();t&&this.pushStateSet(t);var i=e.getLight();i&&(e.getReferenceFrame()===x.Z.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),i):this.addPositionedAttribute(null,i)),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet()})),p.Z.registerApplyFunction(w.Z.nodeTypeID,U),p.Z.registerApplyFunction(R.Z.nodeTypeID,U);const V=F},mQYp:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("klI+"),r=function(){this._mask=r.DEFAULT_CULLING,this._frustum=new n.Z};r.prototype={reset:function(){this._mask=r.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(e){this._mask=e},getCullingMask:function(){return this._mask},setFrustum:function(e){this._frustum=e},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(e){return!(!(this._mask&r.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(e))},isBoundingSphereCulled:function(e){return!(!(this._mask&r.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(e))},isVerticesCulled:function(e){return!(!(this._mask&r.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(e))}},r.NO_CULLING=0,r.VIEW_FRUSTUM_LEFT_CULLING=1,r.VIEW_FRUSTUM_RIGHT_CULLING=2,r.VIEW_FRUSTUM_TOP_CULLING=3,r.VIEW_FRUSTUM_BOTTOM_CULLING=4,r.NEAR_PLANE_CULLING=5,r.FAR_PLANE_CULLING=6,r.VIEW_FRUSTUM_SIDES_CULLING=r.VIEW_FRUSTUM_LEFT_CULLING|r.VIEW_FRUSTUM_RIGHT_CULLING|r.VIEW_FRUSTUM_BOTTOM_CULLING|r.VIEW_FRUSTUM_TOP_CULLING,r.VIEW_FRUSTUM_CULLING=r.VIEW_FRUSTUM_SIDES_CULLING|r.NEAR_PLANE_CULLING|r.FAR_PLANE_CULLING,r.DEFAULT_CULLING=r.VIEW_FRUSTUM_SIDES_CULLING,r.ENABLE_ALL_CULLING=r.VIEW_FRUSTUM_CULLING;const a=r},eR0f:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=i("QrwD"),a=function(e,t,i,n){r.Z.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==e&&(this._func="string"==typeof e?a[e]:e),void 0!==t&&(this._near=t),void 0!==i&&(this._far=i),void 0!==n&&(this._writeMask=n)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,n.Z.createPrototypeStateAttribute(a,n.Z.objectInherit(r.Z.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(e,t){this._near=e,this._far=t},setWriteMask:function(e){this._writeMask=e},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(e){e.applyDepth(this)}}),"osg","Depth");const o=a},NzKe:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=function(e,t,i){this._mode=e,this._first=t,this._arrayLengths=i.slice(0)};n.prototype={draw:function(e){for(var t=e.getGraphicContext(),i=this._mode,n=this._first,r=this._arrayLengths,a=0,o=r.length;a<o;a++){var s=r[a];t.drawArrays(i,n,s),n+=s}},getMode:function(){return this._mode},getNumIndices:function(){for(var e=0,t=this._arrayLengths,i=0,n=t.length;i<n;i++)e+=t[i];return e},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(e){this._first=e}};const r=n},epKp:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("nMbz"),r=function(e,t,i){this.mode=e,void 0!==e&&("string"==typeof e&&(e=n.Z[e]),this.mode=e),this.first=t,this.count=i};r.prototype={draw:function(e){0!==this.count&&e.getGraphicContext().drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},setCount:function(e){this.count=e},getCount:function(){return this.count},setFirst:function(e){this.first=e},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(e){return this.first+e}};const a=r},TYv3:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("nMbz"),r=i("EMUO"),a=function(e,t){this.mode=n.Z.POINTS,void 0!==e&&("string"==typeof e&&(e=n.Z[e]),this.mode=e),this.count=0,this.offset=0,this.indices=t,this.uType=a.UNSIGNED_SHORT,void 0!==t&&this.setIndices(t)};a.UNSIGNED_BYTE=5121,a.UNSIGNED_SHORT=5123,a.UNSIGNED_INT=5125,a.prototype={getMode:function(){return this.mode},draw:function(e){0!==this.count&&(e.setIndexArray(this.indices),this.drawElements(e))},drawElements:function(e){e.getGraphicContext().drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(e){var t=e.getElements();r.Z.instance().isWebGL2()&&(1===t.BYTES_PER_ELEMENT?-1!==t.indexOf(255)&&(e.setElements(new Uint16Array(t)),t=e.getElements()):2===t.BYTES_PER_ELEMENT?-1!==t.indexOf(65535)&&(e.setElements(new Uint32Array(t)),t=e.getElements()):4===t.BYTES_PER_ELEMENT&&-1!==t.indexOf(4294967295)&&console.error("primitives restart in a 32bits index buffer, unhandled")),this.indices=e,this.count=t.length;var i=t.BYTES_PER_ELEMENT;1===i?this.uType=a.UNSIGNED_BYTE:2===i?this.uType=a.UNSIGNED_SHORT:4===i&&(this.uType=a.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(e){this.offset=e},getFirst:function(){return this.offset},setCount:function(e){this.count=e},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(e){return this.indices.getElements()[e]}};const o=a},WzzD:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("Hfbx"),r=i("0rAA"),a=i("QuvP"),o=i("QrwD"),s=i("83E6"),l=i("EMUO"),u=function(){a.Z.call(this),o.Z.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._buffers=[],this._dirty=!0,this._hasMRT=l.Z.instance().getWebGLExtension("WEBGL_draw_buffers")};u.COLOR_ATTACHMENT0=36064,u.DEPTH_ATTACHMENT=36096,u.DEPTH_COMPONENT16=33189,u._sDeletedGLFrameBufferCache=new window.Map,u.deleteGLFrameBuffer=function(e,t){u._sDeletedGLFrameBufferCache.has(e)||u._sDeletedGLFrameBufferCache.set(e,[]),u._sDeletedGLFrameBufferCache.get(e).push(t)},u.flushDeletedGLFrameBuffers=function(e,t){if(t<=0)return t;if(!u._sDeletedGLFrameBufferCache.has(e))return t;var i=u._sDeletedGLFrameBufferCache.get(e);if(0===i.length)return t;for(var n=0,r=s.Z.instance().tick(),a=i.length-1;a>=0&&n<t;a--)e.deleteFramebuffer(i[a]),i.splice(a,1),n=s.Z.instance().deltaS(r,s.Z.instance().tick());return t-n},u.flushAllDeletedGLFrameBuffers=function(e){if(u._sDeletedGLFrameBufferCache.has(e)){var t=u._sDeletedGLFrameBufferCache.get(e);if(0!==t.length)for(var i=t.length-1;i>=0;i--)e.deleteFramebuffer(t[i]),t.splice(i,1)}},u._sDeletedGLRenderBufferCache=new window.Map,u.deleteGLRenderBuffer=function(e,t){u._sDeletedGLRenderBufferCache.has(e)||u._sDeletedGLRenderBufferCache.set(e,[]),u._sDeletedGLRenderBufferCache.get(e).push(t)},u.flushDeletedGLRenderBuffers=function(e,t){if(t<=0)return t;if(!u._sDeletedGLRenderBufferCache.has(e))return t;for(var i=0,n=s.Z.instance().tick(),r=u._sDeletedGLRenderBufferCache.get(e),a=r.length-1;a>=0&&i<t;a--)e.deleteRenderbuffer(r[a]),r.splice(a,1),i=s.Z.instance().deltaS(n,s.Z.instance().tick());return t-i},u.flushAllDeletedGLRenderBuffers=function(e){if(u._sDeletedGLRenderBufferCache.has(e))for(var t=u._sDeletedGLRenderBufferCache.get(e),i=t.length-1;i>=0;i--)e.deleteRenderbuffer(t[i]),t.splice(i,1)},u.onLostContext=function(e){if(u._sDeletedGLFrameBufferCache.has(e)){var t=u._sDeletedGLFrameBufferCache.get(e);t.length=0,u._sDeletedGLRenderBufferCache.has(e)&&((t=u._sDeletedGLRenderBufferCache.get(e)).length=0)}},r.Z.createPrototypeStateAttribute(u,r.Z.objectInherit(a.Z.prototype,r.Z.objectInherit(o.Z.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new u},invalidate:function(){if(this._rbo&&this._attachments){for(var e=0,t=this._attachments.length;e<t;++e){var i=this._attachments[e];i.texture||(i.renderBufferObject=void 0)}this._rbo=void 0}this._fbo=void 0,this._buffers.length=0,this._dirty=!0},dirty:function(){this._buffers.length=0,this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(e){this._attachments.push(e)},getAttachment:function(e){if(this._attachments)for(var t=0,i=this._attachments.length;t<i;++t){var n=this._attachments[t];if(n.attachment===e)return n}},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&u.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&u.deleteGLRenderBuffer(this._gl,this._rbo),this.invalidate()},_reportFrameBufferError:function(e){switch(e){case 36054:n.Z.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:n.Z.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:n.Z.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:n.Z.debug("FRAMEBUFFER_UNSUPPORTED");break;default:n.Z.debug("FRAMEBUFFER unknown error "+e.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},getRenderBufferObject:function(){return this._rbo},createFrameBufferObject:function(e){this.setGraphicContext(e.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},setFrameBufferObject:function(e,t){this.setGraphicContext(e.getGraphicContext()),this._fbo=t},createRenderBuffer:function(e,t,i){var n=this._gl,r=n.createRenderbuffer();return n.bindRenderbuffer(n.RENDERBUFFER,r),n.renderbufferStorage(n.RENDERBUFFER,e,t,i),r},framebufferRenderBuffer:function(e,t){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,t),i.framebufferRenderbuffer(i.FRAMEBUFFER,e,i.RENDERBUFFER,t)},framebufferTexture2D:function(e,t,i,n){var r=this._gl;if(e.applyTextureAttribute(1,n),n.isDirty()||!n.getTextureObject())return!1;var a=r.DRAW_FRAMEBUFFER||r.FRAMEBUFFER;return r.framebufferTexture2D(a,t,i,n.getTextureObject().id(),0),!0},bindFrameBufferObject:function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._fbo)},checkStatus:function(){var e=this._gl,t=e.checkFramebufferStatus(e.FRAMEBUFFER);t!==e.FRAMEBUFFER_COMPLETE&&this._reportFrameBufferError(t)},_checkAllowedSize:function(e,t){var i=l.Z.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===e||0===t||t>i||e>i)||(n.Z.error("width ("+e+") or height ("+e+') makes frame buffer not bindable. Max RenderBuffer is "'+i+'"'),!1)},apply:function(e){this._gl||this.setGraphicContext(e.getGraphicContext());var t=this._gl,i=this._attachments,r=i.length;if(0!==r||this._fbo){var a=0;if(!this.isDirty()){for(a=0;a<r;++a){var o=i[a].texture;o&&o.isDirty()&&e.applyTextureAttribute(1,o)}return t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),void(!0===n.Z.reportWebGLError&&this.checkStatus())}this._fbo||this.createFrameBufferObject(e),this.bindFrameBufferObject();var s=this._hasMRT?this._buffers:void 0,l=!1;for(a=0;a<r;++a){var u=i[a];if(u.texture){var h=u.texture;if(!this._checkAllowedSize(h.getWidth(),h.getHeight()))return void this.releaseGLObjects();if(this._hasMRT&&u.attachment>=t.COLOR_ATTACHMENT0&&u.attachment<=t.COLOR_ATTACHMENT15&&-1===s.indexOf(u.attachment)&&s.push(u.attachment),!this.framebufferTexture2D(e,u.attachment,u.textureTarget,h))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(u.width,u.height))return void this.releaseGLObjects();u.renderBufferObject?this._rbo=u.renderBufferObject:(this._rbo=this.createRenderBuffer(u.format,u.width,u.height),u.renderBufferObject=this._rbo),this.framebufferRenderBuffer(u.attachment,this._rbo),l=!0}}s&&s.length>0&&t.drawBuffers(s),this.checkStatus(),l&&t.bindRenderbuffer(t.RENDERBUFFER,null),this._dirty=!1}else t.bindFramebuffer(t.FRAMEBUFFER,null)}})),"osg","FrameBufferObject");const h=u},wh5T:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};n.prototype={setReferenceTime:function(e){this._startSimulation=e},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(e){this._currentSimulation=e},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(e){this._deltaTime=e},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(e){this._frame=e},getFrameNumber:function(){return this._frame}};const r=n},QuvP:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});i("Hfbx");var n=function(){this._gl=void 0,this._onLostContextCallback=void 0};n.prototype={setGraphicContext:function(e){this._gl=e,n.addObject(this._gl,this)},getGraphicContext:function(){return this._gl},setLostContextCallback:function(e){this._onLostContextCallback=e},onLostContext:function(){this.invalidate&&"function"==typeof this.invalidate&&this.invalidate(),this._onLostContextCallback&&this._onLostContextCallback()}},n._sResourcesArrayCache=new window.Map,n.addObject=function(e,t){n._sResourcesArrayCache.has(e)||n._sResourcesArrayCache.set(e,[]);var i=n._sResourcesArrayCache.get(e);-1===i.indexOf(t)&&i.push(t)},n.removeObject=function(e,t){if(n._sResourcesArrayCache.has(e)){var i=n._sResourcesArrayCache.get(e),r=i.indexOf(t);-1!==r&&i.splice(r,1)}},n.onLostContext=function(e){if(n._sResourcesArrayCache.has(e))for(var t=n._sResourcesArrayCache.get(e),i=0,r=t.length;i<r;i++)t[i].onLostContext()};const r=n},BfDR:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});i("Hfbx");var n=i("0rAA"),r=i("vrBm"),a=window.ImageBitmap||function(){},o=function(e){r.Z.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],e&&this.setImage(e),this._isGreyscale=void 0};n.Z.createPrototypeObject(o,n.Z.objectInherit(r.Z.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(e){this._dirty=e},getImage:function(){return this._imageObject instanceof o?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(e){this._url=e},useOrCreateImage:function(e){return e instanceof o==!1?new o(e):e},setImage:function(e){if(!this._url&&e&&(e.src||e.currentSrc)&&(this._url=e.src||e.currentSrc),this._mipmap.length=0,Array.isArray(e)){for(var t=0,i=e.length;t<i;t++)this._mipmap.push(this.useOrCreateImage(e[t]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(e);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:function(){return this.getImage()instanceof a},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var e=this.getImage();return e instanceof Uint8Array||e instanceof Float32Array||e instanceof Uint16Array},setWidth:function(e){this._width=e},setHeight:function(e){this._height=e},getWidth:function(){var e=this.getImage();return this.isImage()?e.naturalWidth:this.isVideo()?e.videoWidth:this.isCanvas()||this.isBitmap()?e.width:this._width},getHeight:function(){var e=this.getImage();return this.isImage()?e.naturalHeight:this.isVideo()?e.videoHeight:this.isCanvas()||this.isBitmap()?e.height:this._height},isGreyscale:function(e){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var t=this._imageObject;this.isCanvas()||(t=document.createElement("canvas"));var i,n,r=t.getContext("2d");t.width=this._imageObject.width,t.height=this._imageObject.height,r.drawImage(this._imageObject,0,0),e||(i=t.width,n=t.height),e>0&&(i=n=e=Math.min(Math.min(t.width,t.height),e));for(var a=!0,o=t.width/i,s=t.height/n,l=0;l<i;l++)for(var u=0;u<n;u++){var h=Math.floor(o*(l+.5)),c=Math.floor(s*(u+.5)),A=r.getImageData(h,c,1,1).data;if(A[0]!==A[1]||A[0]!==A[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof o)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var e=this.getImage();if(e.complete)return void 0===e.naturalWidth||0!==e.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var t=this.getImage();return!!t.complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image");const s=o},vHSS:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("0rAA"),r=i("QrwD"),a=i("LZhK"),o=i("Xbee"),s=function(e,t){r.Z.call(this);var i=void 0!==e?e:0;this._ambient=o.vh.fromValues(.2,.2,.2,1),this._diffuse=o.vh.fromValues(.8,.8,.8,1),this._specular=o.vh.fromValues(.2,.2,.2,1),this._position=o.vh.fromValues(0,0,1,0),this._direction=o.R3.fromValues(0,0,-1),this._ground=o.vh.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=o.vh.fromValues(1,0,0,0),this._lightNumber=i,this._enable=!t,this._dirtyHash=!0,this._hash=""};s.DIRECTION="DIRECTION",s.SPOT="SPOT",s.POINT="POINT",s.HEMI="HEMI",s.uniforms={},n.Z.createPrototypeStateAttribute(s,n.Z.objectInherit(r.Z.prototype,{attributeType:"Light",cloneType:function(){return new s(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this._lightNumber},getUniformName:function(e){return"u"+this.getTypeMember()+"_"+e},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var e=s,t=this.getTypeMember();return e.uniforms[t]||(e.uniforms[t]={viewPosition:a.Z.createFloat4(this.getUniformName("viewPosition")),viewDirection:a.Z.createFloat3(this.getUniformName("viewDirection")),modelViewMatrix:a.Z.createMatrix4(this.getUniformName("modelViewMatrix")),modelViewNormalMatrix:a.Z.createMatrix3(this.getUniformName("modelViewNormalMatrix")),ambient:a.Z.createFloat4(this.getUniformName("ambient")),diffuse:a.Z.createFloat4(this.getUniformName("diffuse")),specular:a.Z.createFloat4(this.getUniformName("specular")),attenuation:a.Z.createFloat4(this.getUniformName("attenuation")),spotCutOff:a.Z.createFloat1(this.getUniformName("spotCutOff")),spotBlend:a.Z.createFloat1(this.getUniformName("spotBlend")),ground:a.Z.createFloat4(this.getUniformName("ground"))}),e.uniforms[t]},isEnabled:function(){return this._enable},setEnabled:function(e){this._enable=e,this._dirtyHash=!0},setAmbient:function(e){o.vh.copy(this._ambient,e)},getAmbient:function(){return this._ambient},setDiffuse:function(e){o.vh.copy(this._diffuse,e)},getDiffuse:function(){return this._diffuse},setSpecular:function(e){o.vh.copy(this._specular,e)},getSpecular:function(){return this._specular},setPosition:function(e){o.vh.copy(this._position,e)},getPosition:function(){return this._position},setDirection:function(e){o.R3.copy(this._direction,e)},getDirection:function(){return this._direction},setSpotCutoff:function(e){this._spotCutoff=e},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(e){this._spotBlend=e},getSpotBlend:function(){return this._spotBlend},setGround:function(e){o.R3.copy(this._ground,e)},getGround:function(){return this._ground},setConstantAttenuation:function(e){this._attenuation[0]=e},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(e){this._attenuation[1]=e},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(e){this._attenuation[2]=e},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(e){return e===s.DIRECTION?this.setLightAsDirection():e===s.SPOT?this.setLightAsSpot():e===s.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?s.DIRECTION:this.isSpotLight()?s.SPOT:this.isHemiLight()?s.HEMI:s.POINT},setLightAsSpot:function(){o.vh.set(this._position,0,0,0,1),o.R3.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90,this._dirtyHash=!0},setLightAsPoint:function(){o.vh.set(this._position,0,0,0,1),o.R3.set(this._direction,0,0,-1),this._ground[3]=-1,this._dirtyHash=!0},setLightAsDirection:function(){o.vh.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1,this._dirtyHash=!0},setLightAsHemi:function(){o.vh.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1,this._dirtyHash=!0},setLightNumber:function(e){this._lightNumber=e,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&-1===this._ground[3]},isHemiLight:function(){return 1===this._ground[3]},applyPositionedUniform:function(e){var t=this.getOrCreateUniforms(),i=t.modelViewMatrix.getInternalArray(),n=t.modelViewNormalMatrix.getInternalArray(),r=t.viewPosition.getInternalArray(),a=t.viewDirection.getInternalArray();o._E.copy(i,e),o.wO.normalFromMat4(n,e),o.vh.transformMat4(r,this._position,i),o.R3.transformMat3(a,this._direction,n)},apply:function(){if(this._enable){var e=this.getOrCreateUniforms();if(this.isSpotLight()){var t=Math.cos(this._spotCutoff*Math.PI/180);e.spotCutOff.setFloat(t),e.spotBlend.setFloat((1-t)*this._spotBlend)}this.isHemiLight()&&e.ground.setFloat4(this._ground),e.attenuation.setFloat4(this._attenuation),e.diffuse.setFloat4(this._diffuse),e.specular.setFloat4(this._specular),e.ambient.setFloat4(this._ambient)}}}),"osg","Light");const l=s},"1lj/":(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n,r=i("0rAA"),a=i("FJW6"),o=i("a72h"),s=i("Xbee"),l=function(){a.Z.call(this),this.setCullingActive(!1),this._light=void 0,this._referenceFrame=o.Z.RELATIVE_RF};r.Z.createPrototypeNode(l,r.Z.objectInherit(a.Z.prototype,{getLight:function(){return this._light},setLight:function(e){this._light=e},setReferenceFrame:function(e){this._referenceFrame=e},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:(n=s.R3.create(),function(e){if(a.Z.prototype.computeBoundingSphere.call(this,e),void 0!==this._light&&this._referenceFrame===o.Z.RELATIVE_RF){var t=this._light.getPosition();0!==t[3]&&e.expandByVec3(s.R3.scale(n,t,1/t[3]))}return e})}),"osg","LightSource");const u=l},fd33:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n,r,a,o,s=i("0rAA"),l=i("FJW6"),u=i("2bAw"),h=i("Xbee"),c=i("EGrC"),A=function(){l.Z.call(this),this._radius=-1,this._range=[],this._rangeMode=A.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=A.USE_BOUNDING_SPHERE_CENTER};A.DISTANCE_FROM_EYE_POINT=0,A.PIXEL_SIZE_ON_SCREEN=1,A.USE_BOUNDING_SPHERE_CENTER=0,A.USER_DEFINED_CENTER=1,A.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,s.Z.createPrototypeNode(A,s.Z.objectInherit(l.Z.prototype,{getRadius:function(){return this._radius},setRadius:function(e){this._radius=e},setCenter:function(e){this._centerMode!==A.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=A.USER_DEFINED_CENTER),this._userDefinedCenter=e},getCenter:function(){return this._centerMode===A.USER_DEFINED_CENTER||this._centerMode===A.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(e){this._centerMode=e},computeBoundingSphere:function(e){if(this._centerMode===A.USER_DEFINED_CENTER&&this._radius>=0)return e.set(this._userDefinedCenter,this._radius),e;if(this._centerMode===A.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){e.set(this._userDefinedCenter,this._radius);var t=new c.Z;return e.expandByBoundingSphere(l.Z.prototype.computeBoundingSphere.call(this,t)),e}return l.Z.prototype.computeBoundingSphere.call(this,e),e},projectBoundingSphere:(o=h.R3.create(),function(e,t,i){h.R3.transformMat4(o,e.center(),t);var n=e.radius2(),r=o[2]*o[2],a=h.R3.sqrLen(o);return-Math.PI*i*i*n*Math.sqrt(Math.abs((a-n)/(n-r)))/(n-r)}),setRangeMode:function(e){this._rangeMode=e},addChildNode:function(e){if(l.Z.prototype.addChild.call(this,e),this.children.length>this._range.length){var t=[],i=0;this._range.lenght>0&&(i=this._range[this._range.length-1][1]),t.push(h.K4.fromValues(i,i)),this._range.push(t)}return!0},addChild:function(e,t,i){if(l.Z.prototype.addChild.call(this,e),this.children.length>this._range.length){var n=[];n.push(h.K4.fromValues(t,t)),this._range.push(n)}return this._range[this.children.length-1][0]=t,this._range[this.children.length-1][1]=i,!0},traverse:(n=h.R3.create(),r=h.R3.create(),a=h._E.create(),function(e){switch(e.traversalMode){case u.Z.TRAVERSE_ALL_CHILDREN:for(var t=0;t<this.children.length;t++)this.children[t].accept(e);break;case u.Z.TRAVERSE_ACTIVE_CHILDREN:var i=0,o=e.getCurrentModelViewMatrix();if(h._E.invert(a,o),this._rangeMode===A.DISTANCE_FROM_EYE_POINT)h.R3.transformMat4(r,n,a),i=h.R3.distance(this.getBound().center(),r)*e.getLODScale();else{var s=e.getCurrentProjectionMatrix();i=(i=this.projectBoundingSphere(this.getBound(),o,s[0]))*e.getViewport().width()*e.getViewport().width()*.25/e.getLODScale()}var l=this.children.length;this._range.length<l&&(l=this._range.length);for(var c=0;c<l;++c)this._range[c][0]<=i&&i<this._range[c][1]&&this.children[c].accept(e)}})}),"osg","Lod");const d=A},YPi5:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("0rAA"),r=i("QrwD"),a=i("Xbee"),o=i("LZhK"),s=function(){r.Z.call(this),this._ambient=a.vh.fromValues(.2,.2,.2,1),this._diffuse=a.vh.fromValues(.8,.8,.8,1),this._specular=a.vh.fromValues(0,0,0,1),this._emission=a.vh.fromValues(0,0,0,1),this._shininess=12.5};n.Z.createPrototypeStateAttribute(s,n.Z.objectInherit(r.Z.prototype,{attributeType:"Material",cloneType:function(){return new s},getParameterName:function(e){return"u"+this.getType()+"_"+e},getOrCreateUniforms:function(){var e=s;return e.uniforms||(e.uniforms={ambient:o.Z.createFloat4("uMaterialAmbient"),diffuse:o.Z.createFloat4("uMaterialDiffuse"),specular:o.Z.createFloat4("uMaterialSpecular"),emission:o.Z.createFloat4("uMaterialEmission"),shininess:o.Z.createFloat1("uMaterialShininess")}),e.uniforms},setEmission:function(e){a.vh.copy(this._emission,e)},getEmission:function(){return this._emission},setAmbient:function(e){a.vh.copy(this._ambient,e)},getAmbient:function(){return this._ambient},setSpecular:function(e){a.vh.copy(this._specular,e)},getSpecular:function(){return this._specular},setDiffuse:function(e){a.vh.copy(this._diffuse,e)},getDiffuse:function(){return this._diffuse},setShininess:function(e){this._shininess=e},getShininess:function(){return this._shininess},setTransparency:function(e){this._diffuse[3]=1-e},getTransparency:function(){return this._diffuse[3]},apply:function(){var e=this.getOrCreateUniforms();e.ambient.setFloat4(this._ambient),e.diffuse.setFloat4(this._diffuse),e.specular.setFloat4(this._specular),e.emission.setFloat4(this._emission),e.shininess.setFloat(this._shininess)}}),"osg","Material");const l=s},aS0i:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n,r=i("0rAA"),a=i("Xbee"),o=i("Heae"),s=i("a72h"),l=function(){o.Z.call(this),this.matrix=a._E.create()};r.Z.createPrototypeNode(l,r.Z.objectInherit(o.Z.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(e){this.matrix=e,this.dirtyBound()},computeLocalToWorldMatrix:function(e){return this.referenceFrame===s.Z.RELATIVE_RF?a._E.mul(e,e,this.matrix):a._E.copy(e,this.matrix),!0},computeWorldToLocalMatrix:(n=a._E.create(),function(e){return a._E.invert(n,this.matrix),this.referenceFrame===s.Z.RELATIVE_RF?a._E.mul(e,n,e):a._E.copy(e,n),!0})}),"osg","MatrixTransform");const u=l},FJW6:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var n=i("0rAA"),r=i("vrBm"),a=i("Ko9s"),o=i("EGrC"),s=i("0/zD"),l=i("2bAw"),u=i("Xbee"),h=i("U7nq"),c=i("z6Oe"),A=i("a72h"),d=function(){r.Z.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new o.Z,this._boundingSphereComputed=!1,this._boundingBox=new a.Z,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a.Z},g=new h.Z(u._E.create),f=function(){var e=g.getOrCreateObject();return u._E.identity(e)},p=new o.Z;n.Z.createPrototypeNode(d,n.Z.objectInherit(r.Z.prototype,{getMinimumBound:function(){var e=this.getBoundingBox(),t=this.getBoundingSphere();return!e.valid()||t.volume()<e.volume()?t:(p.copyBoundingBox(e),p)},getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new s.Z),this.stateset},getStateSet:function(){return this.stateset},accept:function(e){e.validNodeMask(this)&&(e.pushOntoNodePath(this),e.apply(this),e.popFromNodePath())},dirtyBound:function(){if(!0===this._boundingSphereComputed||!0===this._boundingBoxComputed){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var e=this._parents,t=0,i=e.length;t<i;t++)e[t].dirtyBound()}},setNodeMask:function(e){this.nodeMask=e},getNodeMask:function(){return this.nodeMask},setStateSet:function(e){if(this.stateset!==e){var t=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&t--,this.stateset.removeParent(this)),e&&(e.addParent(this),e.requiresUpdateTraversal()&&++t),0!==t&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+t),this.stateset=e}},_updateNumChildrenRequeringUpdateTraversal:function(e){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var t=0,i=this._parents.length;t<i;t++){var n=this._parents[t],r=n.getNumChildrenRequiringUpdateTraversal();n.setNumChildrenRequiringUpdateTraversal(r+e)}},setNumChildrenRequiringUpdateTraversal:function(e){if(this._numChildrenRequiringUpdateTraversal!==e){if(!this._updateCallbacks.length&&this._parents.length){var t=0;if(this._numChildrenRequiringUpdateTraversal>0&&--t,e>0&&++t,0!==t)for(var i=this._parents,n=0,r=i.length;n<r;n++){var a=i[n],o=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(o+t)}}this._numChildrenRequiringUpdateTraversal=e}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(e){var t=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(e),t||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(e){var t=this._updateCallbacks.indexOf(e);-1!==t&&(this._updateCallbacks.splice(t,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(e){this._cullCallback=e},getCullCallback:function(){return this._cullCallback},hasChild:function(e){for(var t=0,i=this.children.length;t<i;t++)if(this.children[t]===e)return!0;return!1},addChild:function(e){if(-1===this.children.indexOf(e))return this.children.push(e),e.addParent(this),this.dirtyBound(),(e.getNumChildrenRequiringUpdateTraversal()>0||e.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),(e.getNumChildrenWithCullingDisabled()>0||!1===e.getCullingActive())&&this.setNumChildrenWithCullingDisabled(this.getNumChildrenWithCullingDisabled()+1),e},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(e){return this.children[e]},getParents:function(){return this._parents},addParent:function(e){this._parents.push(e)},removeParent:function(e){var t=this._parents.indexOf(e);-1!==t&&this._parents.splice(t,1)},removeChildren:function(){var e=this.children,t=e.length;if(t){for(var i=0,n=0;n<t;n++){var r=e[n];r.removeParent(this),(r.getNumChildrenRequiringUpdateTraversal()>0||r.getUpdateCallbackList().length)&&++i}e.length=0,i&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-i),this.dirtyBound()}},removeChild:function(e){var t=this.children,i=t.indexOf(e);-1!==i&&(e.removeParent(this),t.splice(i,1),this.dirtyBound(),(e.getNumChildrenRequiringUpdateTraversal()>0||e.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(e){for(var t=this.children,i=0,n=t.length;i<n;i++){t[i].accept(e)}},ascend:function(e){for(var t=this._parents,i=0,n=t.length;i<n;i++){t[i].accept(e)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(e){var t=i("10ce").Z,n=t.instance=t.instance||new t;return n.setNodeMaskOverride(-1),n.reset(),n.apply(this),e.copy(n.getBoundingBox()),e},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(e){var t,i,n=this.children,r=n.length;if(e.init(),0===r)return e;var a=this._tmpBox;for(a.init(),i=0;i<r;i++)(t=n[i]).referenceFrame!==A.Z.ABSOLUTE_RF&&a.expandByBoundingSphere(t.getBound());if(!a.valid())return e;for(e.set(a.center(e.center()),0),i=0;i<r;i++)(t=n[i]).referenceFrame!==A.Z.ABSOLUTE_RF&&e.expandRadiusBySphere(t.getBound());return e},getWorldMatrices:function(){var e=function(){this.nodePaths=[],this.halt=void 0,l.Z.call(this,l.Z.TRAVERSE_PARENTS)};e.prototype=n.Z.objectInherit(l.Z.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(e){0===e._parents.length||e===this.halt||e.referenceFrame===A.Z.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(e)}});var t=new e;return t.setNodeMaskOverride(-1),function(e,i){t.reset(),t.halt=e,this.accept(t);for(var n=[],r=i||u._E.create,a=0,o=t.nodePaths.length;a<o;a++){var s=t.nodePaths[a],l=r();0!==s.length&&c.Z.computeLocalToWorld(s,!0,l),n.push(l)}return n}}(),getWorldMatrix:function(e,t){var i=this.getWorldMatrices(e,f);return 0===i.length?u._E.identity(t):u._E.copy(t,i[0]),g.reset(),t},setCullingActive:function(e){if(this._cullingActive!==e){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var t=0;if(this._cullingActive||--t,e||++t,0!==t)for(var i=0,n=this._parents.length;i<n;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+t)}this._cullingActive=e}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(e){if(this._numChildrenWithCullingDisabled!==e){if(this._cullingActive&&this._parents.length>0){var t=0;if(this._numChildrenWithCullingDisabled>0&&--t,e>0&&++t,0!==t)for(var i=0,n=this._parents.length;i<n;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+t)}this._numChildrenWithCullingDisabled=e}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node");const m=d},"2bAw":(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=function(e){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=e,void 0===e&&(this.traversalMode=n.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=n.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=n._traversalFunctions[this.traversalMode],this.pushOntoNodePath=n._pushOntoNodePath[this.traversalMode],this.popFromNodePath=n._popFromNodePath[this.traversalMode]};n.TRAVERSE_PARENTS=1,n.TRAVERSE_ALL_CHILDREN=2,n.TRAVERSE_ACTIVE_CHILDREN=3,n.NODE_VISITOR=0,n.UPDATE_VISITOR=1,n.CULL_VISITOR=2;var r=function(e){e.traverse(this)};n._traversalFunctions=[void 0,function(e){e.ascend(this)},r,r];var a=function(e){this.nodePath.push(e)};n._pushOntoNodePath=[void 0,function(e){this.nodePath.unshift(e)},a,a];var o=function(){this.nodePath.pop()};n._popFromNodePath=[void 0,function(){return this.nodePath.shift()},o,o],n.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(e){this.nodeMaskOverride=e},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(e){this.traversalMask=e},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},validNodeMask:function(e){var t=e.getNodeMask();return 0!=(this.traversalMask&(this.nodeMaskOverride|t))},apply:function(e){this.traverse(e)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(e){this._databaseRequestHandler=e},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}};const s=n},vrBm:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=function(){this._name=void 0,this._userdata=void 0,this._instanceID=r.getInstanceID()};n.Z.createPrototypeObject(r,{cloneType:function(){return new(0,this.constructor)},getInstanceID:function(){return this._instanceID},setName:function(e){this._name=e},getName:function(){return this._name},setUserData:function(e){this._userdata=e},getUserData:function(){return this._userdata}},"osg","Object");var a=0;r.getInstanceID=function(){return a+=1};const o=r},wm32:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n,r=i("Hfbx"),a=i("0rAA"),o=i("5Cxy"),s=function(){var e={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,scrollwheel:!0,webgl2:(0,o.Z)().webgl2,powerPreference:"high-performance",shaderStats:!1,stats:!1};for(var t in e)this[t]=e[t]};s.getOptionsURL=function(){if(n)return n;if(n={},!window.location.search)return n;for(var e,t=[],i=window.location.search.slice(1).split("&"),a=0;a<i.length;a++){var o=(e=i[a].split("="))[0];t.push(o);var s=e[1];"0"!==s&&"false"!==s&&(void 0===s&&(s="1"),n[o]=s)}if(void 0!==n.log)switch(n.log.toLowerCase()){case"debug":r.Z.setNotifyLevel(r.Z.DEBUG);break;case"info":r.Z.setNotifyLevel(r.Z.INFO);break;case"notice":r.Z.setNotifyLevel(r.Z.NOTICE);break;case"warn":r.Z.setNotifyLevel(r.Z.WARN);break;case"error":r.Z.setNotifyLevel(r.Z.ERROR);break;case"html":var l=[],u=document.createElement("div"),h=document.createElement("pre");document.addEventListener("DOMContentLoaded",(function(){document.body.insertBefore(u,document.body.firstChild),u.appendChild(h)}));var c=function(e){l.unshift(e),h.innerHTML=l.join("\n")};u.style.overflow="hidden",u.style.position="absolute",u.style.zIndex="10000",u.style.height="100%",u.style.maxWidth="600px",u.style.pointerEvents="none",h.style.overflow="scroll",h.style.width="105%",h.style.height="100%",h.style.fontSize="10px",h.style.pointerEvents="none",["log","error","warn","info","debug"].forEach((function(e){window.console[e]=c}))}return n},s.prototype={extend:function(e){return a.Z.objectMix(this,e),this},get:function(e){return this[e]},getBoolean:function(e){var t=this.getString(e);if(t)return"false"!==t&&"0"!==t},getNumber:function(e){var t=this[e];if(t)return Number(t)},getString:function(e){if(void 0!==this[e])return this[e].toString()},extendWithOptionsURL:function(){this.extend(s.getOptionsURL())}};const l=s},Rqdv:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A});var n,r,a,o=i("0rAA"),s=i("fd33"),l=i("2bAw"),u=i("Xbee"),h=function(){s.Z.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=s.Z.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},c=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};o.Z.createPrototypeNode(h,o.Z.objectInherit(s.Z.prototype,{setRange:function(e,t,i){if(e>=this._range.length){var n=[];n.push([t,t]),this._range.push(n)}this._range[e][0]=t,this._range[e][1]=i},setExpiryTime:function(e){this._expiryTime=e},setDatabasePath:function(e){this._databasePath=e},getDatabasePath:function(){return this._databasePath},setFileName:function(e,t){if(e>=this._perRangeDataList.length){var i=new c;i.filename=t,this._perRangeDataList.push(i)}else this._perRangeDataList[e].filename=t},setFunction:function(e,t){if(e>=this._perRangeDataList.length){var i=new c;i.function=t,this._perRangeDataList.push(i)}else this._perRangeDataList[e].function=t},addChild:function(e,t,i){s.Z.prototype.addChild.call(this,e,t,i),this._perRangeDataList.push(new c)},addChildNode:function(e){s.Z.prototype.addChildNode.call(this,e)},setFrameNumberOfLastTraversal:function(e){this._frameNumberOfLastTraversal=e},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(e,t){this._perRangeDataList[e].timeStamp=t},setFrameNumber:function(e,t){this._perRangeDataList[e].frameNumber=t},setNumChildrenThatCannotBeExpired:function(e){this._numChildrenThatCannotBeExpired=e},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(e){return this._perRangeDataList[e].dbrequest},removeExpiredChildren:function(e,t,i){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var n,r,a=this.children.length-1;n=this._perRangeDataList[a].timeStamp+this._expiryTime,r=this._perRangeDataList[a].frameNumber+this._expiryFrame,n<e&&r<t&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a].function)&&(i.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:(n=u.R3.create(),r=u.R3.create(),a=u._E.create(),function(e){var t=e.traversalMode,i=!1;switch(e.getVisitorType()===l.Z.CULL_VISITOR&&(this._frameNumberOfLastTraversal=e.getFrameStamp().getFrameNumber(),i=!0),t){case l.Z.TRAVERSE_ALL_CHILDREN:for(var o=0;o<this.children.length;o++)this.children[o].accept(e);break;case l.Z.TRAVERSE_ACTIVE_CHILDREN:var h=0,c=e.getCurrentModelViewMatrix();if(u._E.invert(a,c),this._rangeMode===s.Z.DISTANCE_FROM_EYE_POINT)u.R3.transformMat4(r,n,a),h=u.R3.distance(this.getBound().center(),r)*e.getLODScale();else{var A=e.getCurrentProjectionMatrix();(h=(h=this.projectBoundingSphere(this.getBound(),c,A[0]))*e.getViewport().width()*e.getViewport().width()*.25/e.getLODScale())<0&&(h=this._range[this._range.length-1][0])}for(var d=!1,g=-1,f=0;f<this._range.length;++f)this._range[f][0]<=h&&h<this._range[f][1]&&(f<this.children.length?(i&&(this._perRangeDataList[f].timeStamp=e.getFrameStamp().getSimulationTime(),this._perRangeDataList[f].frameNumber=e.getFrameStamp().getFrameNumber()),this.children[f].accept(e),g=f):d=!0);if(d){var p=this.children.length;if(p>0&&p-1!==g&&(i&&(this._perRangeDataList[p-1].timeStamp=e.getFrameStamp().getSimulationTime(),this._perRangeDataList[p-1].frameNumber=e.getFrameStamp().getFrameNumber()),this.children[p-1].accept(e)),p<this._perRangeDataList.length){var m=(this._range[p][0]-h)/(this._range[p][1]-this._range[p][0]);this._rangeMode===s.Z.PIXEL_SIZE_ON_SCREEN&&(m=-m);var _=e.nodePath[e.nodePath.length-1];if(!1===this._perRangeDataList[p].loaded){this._perRangeDataList[p].loaded=!0;var v=e.getDatabaseRequestHandler();this._perRangeDataList[p].dbrequest=v.requestNodeFile(this._perRangeDataList[p].function,this._databasePath+this._perRangeDataList[p].filename,_,e.getFrameStamp().getSimulationTime(),m)}else void 0!==this._perRangeDataList[p].dbrequest?(this._perRangeDataList[p].dbrequest._timeStamp=e.getFrameStamp().getSimulationTime(),this._perRangeDataList[p].dbrequest._priority=m):this._perRangeDataList[p].loaded=!1}}}})}),"osg","PagedLOD");const A=h},XOVK:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n,r=i("0rAA"),a=i("Xbee"),o=r.Z.objectInherit(a.vh,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var e=o.create();return function(t,i){var n=t[0],r=t[1],a=t[2],s=t[3];return e[0]=i[0]*n+i[1]*r+i[2]*a+i[3]*s,e[1]=i[4]*n+i[5]*r+i[6]*a+i[7]*s,e[2]=i[8]*n+i[9]*r+i[10]*a+i[11]*s,e[3]=i[12]*n+i[13]*r+i[14]*a+i[15]*s,o.normalizeEquation(e),o.copy(e,t),t}},normalizeEquation:function(e){var t=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t},getNormal:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},setNormal:function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]},getDistance:function(e){return e[3]},setDistance:function(e,t){e[3]=t},distanceToPlane:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},intersectsOrContainsBoundingSphere:function(e,t){if(!t.valid())return o.OUTSIDE;var i=t.center(),n=t.radius(),r=this.distanceToPlane(e,i);return r<-n?o.OUTSIDE:r<=n?o.INTERSECT:o.INSIDE},instersectsBoundingSphere:function(e,t){return this.intersectsOrContainsBoundingSphere(e,t)===o.INTERSECT},intersectsOrContainsBoundingBox:(n=a.R3.create(),function(e,t){var i=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),r=7&~i;return this.distanceToPlane(e,t.corner(r,n))>0?o.INSIDE:this.distanceToPlane(e,t.corner(i,n))<0?o.OUTSIDE:o.INTERSECT}),intersectsBoundingBox:function(e,t,i){return this.intersectsOrContainsBoundingBox(e,t,i)===o.INTERSECT},intersectOrContainsVertices:function(e,t){for(var i=-1,n=0;n<t.length;n++){var r=this.distanceToPlane(e,t[n]);if(r<0){if(1===i)return o.INTERSECT;i=2}else{if(!(r>0))return o.INTERSECT;if(2===i)return o.INTERSECT;i=1}}return i>0?o.INSIDE:o.OUTSIDE},intersectVertices:function(e,t){return this.intersectOrContainsVertices(e,t)===o.INTERSECT}});const s=o},"klI+":(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i("vrBm"),r=i("XOVK"),a=i("0rAA"),o=i("Xbee"),s=i("BW96"),l=function(){this._clippingMask=0,this._planeList=[r.Z.create(),r.Z.create(),r.Z.create(),r.Z.create(),r.Z.create(),r.Z.create()],this._vertexList=[],this._maskStack=new s.Z,this._resultMask=0,this._maskStack.push(this._resultMask)};a.Z.createPrototypeObject(l,a.Z.objectInherit(n.Z.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(e){this._planeList=e,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var e=0,t=this._planeList.length;e<t;++e)r.Z.init(this._planeList[e]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._planeList.length=0,this._planeList.push(o.vh.set(r.Z.create(),1,0,0,1)),this._planeList.push(o.vh.set(r.Z.create(),-1,0,0,1)),this._planeList.push(o.vh.set(r.Z.create(),0,1,0,1)),this._planeList.push(o.vh.set(r.Z.create(),0,-1,0,1)),e&&this._planeList.push(o.vh.set(r.Z.create(),0,0,1,1)),t&&this._planeList.push(o.vh.set(r.Z.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(e){this._planeList.length=0,this._planeList.push(o.vh.set(r.Z.create(),1,0,0,-e.getMin()[0])),this._planeList.push(o.vh.set(r.Z.create(),-1,0,0,e.getMax()[0])),this._planeList.push(o.vh.set(r.Z.create(),0,1,0,-e.getMin()[1])),this._planeList.push(o.vh.set(r.Z.create(),0,-1,0,e.getMax()[1])),this._planeList.push(o.vh.set(r.Z.create(),0,0,1,-e.getMin()[2])),this._planeList.push(o.vh.set(r.Z.create(),0,0,-1,e.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(e,t){this._referenceVertexList=e._referenceVertexList;var i=this._maskStack.getLength()-1,n=e._maskStack[i];if(0===n)return this._maskStack.getArray()[i]=0,this._resultMask=0,void(this._planeList.length=0);var a,o=1,s=0;for(a=0;a!==e._planeList.length;++a)n&o&&++s,o<<=1;this._planeList.length=s,this._resultMask=0,o=1;var l=0;for(a=0;a!==e._planeList.length;++a)n&o&&(this._planeList[l]=e._planeList[a],r.Z.transformProvidingInverse(this._planeList[l++],t),this._resultMask=this._resultMask<<1|1),o<<=1;this._maskStack.getArray()[i]=this._resultMask},voidset:function(e){this._planeList=e,this.setupMask()},add:function(e){this._planeList.push(e),this.setupMask()},empty:function(){return 0===this._planeList.length},setReferenceVertexList:function(e){this._referenceVertexList=e},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(e){this._resultMask=0;for(var t=void 0!==e?e:this._planeList.length,i=0;i<t;++i)this._resultMask=this._resultMask<<1|1;this._maskStack.reset(),this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack.back()},setResultMask:function(e){this._resultMask=e},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(e){var t=this._maskStack.back();if(!t)return!0;for(var i=1,n=0;n<this._planeList.length;++n){if(t&i&&r.Z.distanceToPlane(this._planeList[n],e)<0)return!1;i<<=1}return!0},containsVertices:function(e){var t=this._maskStack.back();if(!t)return!0;this._resultMask=t;for(var i=0;i<e.length;++i){for(var n=e[i],a=!1,o=1,s=0;!a&&s<this._planeList.length;++s)t&o&&r.Z.distanceToPlane(this._planeList[s],n)<0&&(a=!0),o<<=1;if(!a)return!0}return!1},containsBoundingSphere:function(e){var t=this._maskStack.back();if(!t||!e.valid())return!0;this._resultMask=t;for(var i=1,n=0;n<this._planeList.length;++n){if(this._resultMask&i){var a=r.Z.intersectsOrContainsBoundingSphere(this._planeList[n],e);if(r.Z.OUTSIDE===a)return!1;r.Z.INSIDE===a&&(this._resultMask^=i)}i<<=1}return!0},containsBoundingBox:function(e){var t=this._maskStack.back();if(!t)return!0;this._resultMask=t;for(var i=1,n=0;n<this._planeList.length;++n){if(this._resultMask&i){var a=r.Z.intersectsOrContainsBoundingBox(this._planeList[n],e);if(r.Z.OUTSIDE===a)return!1;r.Z.INSIDE===a&&(this._resultMask^=i)}i<<=1}return!0},containsAllOfVertices:function(e){var t=this._maskStack.back();if(!t)return!1;this._resultMask=t;for(var i=1,n=0;n<this._planeList.length;++n){if(this._resultMask&i){if(r.Z.intersectsOrContainsVertices(this._planeList[n],e)<1)return!1;this._resultMask^=i}i<<=1}return!0},containsAllOfBoundingSphere:function(e){var t=this._maskStack.back();if(!t)return!1;this._resultMask=t;for(var i=1,n=0;n<this._planeList.length;++n){if(this._resultMask&i){if(r.Z.intersectsOrContainsBoundingSphere(this._planeList[n],e)<1)return!1;this._resultMask^=i}i<<=1}return!0},containsAllOfBoundingBox:function(e){var t=this._maskStack.back();if(!t)return!1;this._resultMask=t;for(var i=1,n=0;n<this._planeList.length;++n){if(this._resultMask&i){if(r.Z.intersectsOrContainsBoundingBox(this._planeList[n],e)<1)return!1;this._resultMask^=i}i<<=1}return!0},transformProvidingInverse:function(e){var t=this._maskStack.back();if(t){this._resultMask=t;for(var i=1,n=0;n<this._planeList.length;++n)t&i&&r.Z.transformProvidingInverse(this._planeList[n],e),i<<=1}}}),"osg","Polytope");const u=l},BW96:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=function(){this._pool=[],this._length=0};n.prototype={clean:function(){this._length=0,this._pool.length=0},reset:function(){this._length=0},getLength:function(){return this._length},getArray:function(){return this._pool},back:function(){return this._pool[this._length-1]},pop:function(){return this._length--,this._pool[this._length]},push:function(e){this._length===this._pool.length?this._pool.push(e):this._pool[this._length]=e,this._length++},forEach:function(e){for(var t=0;t<this._length;t++)e(this._pool[t])}};const r=n},kJFG:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("BW96"),r=function(){this._keys=new n.Z,this._map={}};r.prototype={reset:function(){for(var e=this._keys.getArray(),t=this._keys.getLength(),i=0;i<t;i++){var n=e[i];this._map[n]=void 0}this._keys.reset()},set:function(e,t){this._keys.push(e),this._map[e]=t},hasKey:function(e){return void 0!==this._map[e]},getMap:function(){return this._map},getKeys:function(){return this._keys},forEach:function(e){for(var t=this._keys.getArray(),i=this._keys.getLength(),n=0;n<i;n++){var r=t[n];e(r,this._map[r])}}};const a=r},U7nq:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=function(e){this._createFunction=e,this._pool=[],this._length=0};n.prototype={clean:function(){this._pool.length=0,this._length=0},getLength:function(){return this._length},reset:function(){this._length=0},getOrCreateObject:function(){var e;return this._length===this._pool.length?(e=this._createFunction(),this._pool.push(e)):e=this._pool[this._length],this._length++,e},forEach:function(e){for(var t=0;t<this._length;t++)e(this._pool[t])}};const r=n},Axet:(e,t,i)=>{"use strict";i.d(t,{Z:()=>C});var n,r=i("0rAA"),a=i("Hfbx"),o=i("wm32"),s=i("QuvP"),l=i("QrwD"),u=i("UuwK"),h=i("83E6"),c=i("EMUO"),A=o.Z.getOptionsURL(),d=A.shaderStats?{}:void 0,g=A.forceSyncLink,f=new Uint8Array(4),p=function(e){e.flush(),e.finish(),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,f)},m=/uniform\s+\w+\s+(\w+)((\s)?\[(.*?)\])?/g,_=/(in|attribute)\s+\w+\s+(\w+)\s*;/g,v=function(e,t){s.Z.call(this),l.Z.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._asyncCompilation=void 0,this._asyncLinkingExt=g?void 0:c.Z.instance().getWebGLExtension("KHR_parallel_shader_compile"),this._compileClean=void 0,e&&this.setVertexShader(e),t&&this.setFragmentShader(t),this._dirty=!0};v._sDeletedGLProgramCache=new window.Map,v.deleteGLProgram=function(e,t){v._sDeletedGLProgramCache.has(e)||v._sDeletedGLProgramCache.set(e,[]),v._sDeletedGLProgramCache.get(e).push(t)},v.flushDeletedGLPrograms=function(e,t){if(t<=0)return t;if(!v._sDeletedGLProgramCache.has(e))return t;for(var i=0,n=h.Z.instance().tick(),r=v._sDeletedGLProgramCache.get(e),a=r.length-1;a>=0&&i<t;a--)e.deleteProgram(r[a]),r.splice(a,1),i=h.Z.instance().deltaS(n,h.Z.instance().tick());return t-i},v.flushAllDeletedGLPrograms=function(e){if(v._sDeletedGLProgramCache.has(e))for(var t=v._sDeletedGLProgramCache.get(e),i=t.length-1;i>=0;i--)e.deleteProgram(t[i]),t.splice(i,1)},v.onLostContext=function(e){v._sDeletedGLProgramCache.has(e)&&(v._sDeletedGLProgramCache.get(e).length=0,this._asyncCompilation=void 0,this._asyncLinkingExt=g?void 0:c.Z.instance().getWebGLExtension("KHR_parallel_shader_compile"),this._compileClean=void 0)},r.Z.createPrototypeStateAttribute(v,r.Z.objectInherit(s.Z.prototype,r.Z.objectInherit(l.Z.prototype,{attributeType:"Program",cloneType:function(){return new v},setVertexShader:function(e){this._vertex=e,this._nullProgram=!1,e.setText(u.Z.processShader(e.getText()))},setFragmentShader:function(e){this._fragment=e,this._nullProgram=!1,e.setText(u.Z.processShader(e.getText()))},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(e){this._activeUniforms=e},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(e){this._foreignUniforms=e},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(e){this._uniformsCache=e},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(e){this._attributesCache=e},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(e){this._trackAttributes=e},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&(v.deleteGLProgram(this._gl,this._program),s.Z.removeObject(this._gl,this)),this.invalidate())},dirty:function(){this._program=void 0},invalidate:function(){this._cacheUniformId=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._compileClean=void 0,this._program=void 0},_rebuildProgramFromSpector:function(e,t,i,n){this._dirty=!0,this._vertex.invalidate(),this._fragment.invalidate(),this.invalidate(),this._vertex.setText(e),this._fragment.setText(t),this._program=null,this._spectorOnCompiled=i,this._spectorOnError=n,this._compileClean=void 0},_onErrorToSpector:function(e){return!!this._spectorOnError&&(this._spectorOnError(e),!0)},_onCompilationToSpector:function(){this._spectorOnCompiled&&this._spectorOnCompiled(this._program)},_bindProgramToSpector:function(){window&&window.spector&&!this._program.__SPECTOR_rebuildProgram&&(this._program.__SPECTOR_rebuildProgram=this._rebuildProgramFromSpector.bind(this))},_logDebugShaders:function(e,t){if("Failed to create D3D shaders.\n"===t){var i=void 0!==e.rawgl?e.rawgl:e;void 0!==i&&void 0===i.getExtension&&(i=i.getExtension("WEBGL_debug_shaders"))&&(a.Z.error(i.getTranslatedShaderSource(this._vertex.shader)),a.Z.error(i.getTranslatedShaderSource(this._fragment.shader)))}},_activateFailSafe:function(e){var t=e.createProgram();this._vertex.failSafe(e,this._vertex.getText()),this._fragment.failSafe(e,this._fragment.getText()),this._glAttachAndLink(e,t,this._vertex,this._fragment),a.Z.warn("FailSafe shader Activated "),this._program=t},_glAttachAndLink:function(e,t,i,n){e.attachShader(t,i.shader),e.attachShader(t,n.shader),e.linkProgram(t)},_glShaderCompile:function(e,t){t.shader||(d&&(t===this._vertex?d.vert=h.Z.tick():d.frag=h.Z.tick()),t.compile(e,n))},_glShaderCompilationResult:function(e,t){var i=t.getCompilationResult(e,n);return d&&(void 0===this._asyncCompilation&&p(e),t===this._vertex?d.vert=h.Z.tick()-d.vert:d.frag=h.Z.tick()-d.frag),i},compile:function(){var e=this._gl,t=this._fragment.getText(),i=this._vertex.getText();this._attributeMap=function(e){for(var t,i={};null!==(t=_.exec(e));)i[t[2]]=!0;return i}(i),this._uniformMap=function(e){for(var t,i={};null!==(t=m.exec(e));)i[t[1]]=!0;return i}(t+"\n"+i),this._glShaderCompile(e,this._vertex),this._glShaderCompile(e,this._fragment)},getShaderName:function(){if(this._shaderName)return this._shaderName;if(!this._fragment||!this._fragment.getText())return"";var e=this._fragment.getText().match(/^#define\s+SHADER_NAME\s+(.*)$/m);return this._shaderName=e&&e[1]?e[1]:"",this._shaderName},getCompilationResultAndLink:function(e){return!!this._compileClean||(d&&(d.vert=0,d.frag=0,d.link=0,d.total=0,void 0===this._asyncCompilation&&p(e),d.total=h.Z.tick(),a.Z.log(this.getShaderName()+" start"),a.Z.timeStamp(this.getShaderName()+" start")),this._compileClean=this._glShaderCompilationResult(e,this._vertex),this._compileClean=this._glShaderCompilationResult(e,this._fragment)&&this._compileClean,d&&(a.Z.log(this.getShaderName()+" compilation"),a.Z.timeStamp(this.getShaderName()+" compilation")),!!this._compileClean&&(this._program=e.createProgram(),this._attributeMap.Vertex&&e.bindAttribLocation(this._program,0,"Vertex"),this._glAttachAndLink(e,this._program,this._vertex,this._fragment),!0))},getAsyncLinkingStatus:function(){return this._asyncLinkingExt&&!0===this._gl.getProgramParameter(this._program,this._asyncLinkingExt.COMPLETION_STATUS_KHR)},getAsyncCompiling:function(){return this._asyncCompilation},_logShaderStats:function(e){if(void 0===this._asyncCompilation&&p(e),d.link=h.Z.tick()-d.link,d.link){d.total=h.Z.tick()-d.total,this._placeHolder&&(d.total=d.vert+d.frag+d.link);var t=(this._placeHolder?"Async":"")+this.getShaderName()+" - "+d.total.toFixed(2)+"ms";a.Z.group(t),a.Z.log("vertex : "+d.vert.toFixed(2)+"ms"),a.Z.log("fragment : "+d.frag.toFixed(2)+"ms"),a.Z.log("link : "+d.link.toFixed(2)+"ms"),a.Z.log("total : "+d.total.toFixed(2)+"ms"),a.Z.groupEnd(t)}},getLinkResult:function(e){if(this._compileClean){d&&(d.link=h.Z.tick(),a.Z.log(this.getShaderName()+" link"),a.Z.timeStamp(this.getShaderName()+" link"));var t=e.getProgramParameter(this._program,e.LINK_STATUS);if(d&&this._logShaderStats(e),t||e.isContextLost())this._onCompilationToSpector(this._program);else{var i=e.getProgramInfoLog(this._program);if(a.Z.errorFold(i,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text),this._logDebugShaders(e,i),n&&n(this._vertex.text,this._fragment.text,i),this._compileClean=!1,this._onErrorToSpector(i))return!1}}return this._dirty=!1,this._asyncCompilation=-1,this._placeHolder=void 0,this._uniformsCache={},this._attributesCache={},this._compileClean?(this.cacheAttributeList(e,window.Object.keys(this._attributeMap)),this.cacheUniformList(e,window.Object.keys(this._uniformMap))):this._activateFailSafe(e),this._bindProgramToSpector(),this._compileClean},enableAsyncCompilation:function(e,t){this._placeHolder=e,this._asyncCompilation=t},apply:function(e){if(!this._nullProgram)if(this._gl||this.setGraphicContext(e.getGraphicContext()),!this._program||this._dirty)if(this._placeHolder)this._placeHolder.apply(e);else{if(this.compile(),!this.getCompilationResultAndLink(this._gl))return this._dirty=!1,this._asyncLinkingExt=void 0,void(this._asyncCompilation=-1);var t=this._asyncLinkingExt&&this.getAsyncLinkingStatus(),i=this.getShaderName().toLowerCase();if(t||!this._asyncLinkingExt||i&&(-1!==i.indexOf("packer")||-1!==i.indexOf("environment")||-1!==i.indexOf("hotspot")))return this.getLinkResult(this._gl),e.applyProgram(this._program),this._dirty=!1,this._asyncLinkingExt=void 0,void(this._asyncCompilation=-1);this._asyncCompilation=1}else e.applyProgram(this._program)},cacheUniformList:function(e,t){for(var i=this._uniformsCache,n=0,r=t.length;n<r;n++){var a=t[n],o=e.getUniformLocation(this._program,a);null!=o&&void 0===i[a]&&(i[a]=o)}},cacheAttributeList:function(e,t){for(var i=this._attributesCache,n=0,r=t.length;n<r;n++){var a=t[n],o=e.getAttribLocation(this._program,a);-1!==o&&void 0!==o&&void 0===i[a]&&(i[a]=o)}}})),"osg","Program"),v.registerErrorCallback=function(e){n=e};const C=v},KOpT:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("FJW6"),a=i("Xbee"),o=function(){r.Z.call(this),this.projection=a._E.create()};n.Z.createPrototypeNode(o,n.Z.objectInherit(r.Z.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(e){this.projection=e}}),"osg","Projection");const s=o},"9YK+":(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=i("QrwD"),a=function(e,t,i,n){r.Z.call(this),this._x=void 0!==e?e:-1,this._y=void 0!==t?t:-1,this._width=void 0!==i?i:-1,this._height=void 0!==n?n:-1};n.Z.createPrototypeStateAttribute(a,n.Z.objectInherit(r.Z.prototype,{attributeType:"Scissor",cloneType:function(){return new a},setScissor:function(e,t,i,n){this._x=e,this._y=t,this._width=i,this._height=n},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},apply:function(e){e.applyScissor(this)}}),"osg","Scissor");const o=a},"4igZ":(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("Hfbx"),r=i("0rAA"),a=i("83E6"),o=i("QuvP"),s=function(e,t){o.Z.call(this);var i=e;"string"==typeof e&&(i=s[e]),this.type=i,this.setText(t)};s.VERTEX_SHADER=35633,s.FRAGMENT_SHADER=35632;s.VS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\nattribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}\n",s.FS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\n precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}\n",s._sDeletedGLShaderCache=new window.Map,s.deleteGLShader=function(e,t){s._sDeletedGLShaderCache.has(e)||s._sDeletedGLShaderCache.set(e,[]),s._sDeletedGLShaderCache.get(e).push(t)},s.flushDeletedGLShaders=function(e,t){if(t<=0)return t;if(!s._sDeletedGLShaderCache.has(e))return t;for(var i=0,n=a.Z.instance().tick(),r=s._sDeletedGLShaderCache.get(e),o=r.length-1;o>=0&&i<t;o--)e.deleteShader(r[o]),r.splice(o,1),i=a.Z.instance().deltaS(n,a.Z.instance().tick());return t-i},s.flushAllDeletedGLShaders=function(e){if(s._sDeletedGLShaderCache.has(e))for(var t=s._sDeletedGLShaderCache.get(e),i=t.length-1;i>=0;i--)e.deleteShader(t[i]),t.splice(i,1)},s.onLostContext=function(e){s._sDeletedGLShaderCache.has(e)&&(s._sDeletedGLShaderCache.get(e).length=0)},r.Z.createPrototypeObject(s,r.Z.objectInherit(o.Z.prototype,{setText:function(e){this.text=e},getText:function(){return this.text},failSafe:function(e,t){this.shader=e.createShader(this.type);var i=t.match(/#define[\s]+SHADER_NAME[\s]+([\S]+)(\n|$)/);i=i?i[1]:"";var n=this.type===s.VERTEX_SHADER?s.VS_DBG:s.FS_DBG;n+="\n#define SHADER_NAME FailSafe"+i+"\n#else\n"+t+"\n#endif\n",e.shaderSource(this.shader,n),e.compileShader(this.shader)},processErrors:function(e,t){var i,r,a=/ERROR: [\d]+:([\d]+): (.+)/gim,o=t.split("\n"),s=o.length;if(0!==s)if(null===a.exec(e)&&(a=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),a.lastIndex=0,null!==a.exec(e))for(a.lastIndex=0;null!==(r=a.exec(e));){r.index===a.lastIndex&&a.lastIndex++;var l=parseInt(r[1],10);if(!(l>s)){n.Z.error("ERROR "+r[2]+" in line "+l);var u=Math.max(0,l-7),h=Math.max(0,l-2);for(i=u;i<=h;i++)n.Z.warn(o[i].replace(/^[ \t]+/g,""));for(h=Math.max(0,l-1),n.Z.error(o[h].replace(/^[ \t]+/g,"")),u=Math.min(s,l),h=Math.min(s,l+5),i=u;i<h;i++)n.Z.warn(o[i].replace(/^[ \t]+/g,""))}}else n.Z.error(e)},compile:function(e){this._gl||this.setGraphicContext(e),this.shader=e.createShader(this.type),e.shaderSource(this.shader,this.text),e.compileShader(this.shader)},getCompilationResult:function(e,t){if(e.isContextLost())return n.Z.error("can't compile shader, no context"),!1;if(!e.getShaderParameter(this.shader,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(this.shader);this.processErrors(i,this.text);for(var r=this.text.split("\n"),a="\n",o=0,s=r.length;o<s;++o)a+=o+" "+r[o]+"\n";return n.Z.errorFold("can't compile shader",a),t&&t(this.text,a,i),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&(s.deleteGLShader(this._gl,this.shader),o.Z.removeObject(this._gl,this)),this.invalidate()},invalidate:function(){this.shader=void 0}}),"osg","Shader");const l=s},meUd:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=function(){this._globalDefault=void 0,this._lastApplied=void 0,this._changed=!1,this._values=[],this._back=void 0,this._length=0};n.prototype={getLength:function(){return this._length},push:function(e,t){var i;this._length===this._values.length?(i={object:e,value:t},this._values.push(i)):((i=this._values[this._length]).object=e,i.value=t),this._back=i,this._length++},pop:function(){if(this._length){var e=this._values;this._length--;var t=e[this._length];return this._back=this._length?e[this._length-1]:void 0,t}}};const r=n},Fdmx:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var n=i("Xbee"),r=i("Hfbx"),a=i("vrBm"),o=i("Axet"),s=i("QrwD"),l=i("BW96"),u=i("meUd"),h=i("LZhK"),c=i("0rAA"),A=i("EMUO"),d=i("eR0f"),g=i("zI6W"),f=i("TKk8"),p=function(){this._stateClearColor={buffer:{red:0,green:0,blue:0,alpha:0},state:{red:void 0,green:void 0,blue:void 0,alpha:void 0},changed:!0},this._stateClearDepth={buffer:{value:1},state:{value:void 0},changed:!0},this._stateDepthMask={state:{value:!0},buffer:{value:void 0},changed:!0},this._stateViewport={buffer:{x:0,y:0,width:640,height:480},state:{x:void 0,y:void 0,width:void 0,height:void 0},changed:!0},this._stateColorMask={buffer:{red:!0,green:!0,blue:!0,alpha:!0},state:{red:void 0,green:void 0,blue:void 0,alpha:void 0},changed:!0},this._stateScissor={buffer:{enable:!1,x:0,y:0,width:640,height:480},state:{enable:!1,x:void 0,y:void 0,width:void 0,height:void 0},changed:!0},this._stateDepth={buffer:{func:d.Z.LESS,enable:!1,near:0,far:1},state:{func:void 0,enable:!1,near:void 0,far:void 0},changed:!0},this._stateCullFace={buffer:{enable:!1,mode:f.Z.BACK},state:{enable:!1,mode:void 0},changed:!0},this._stateBlendFunc={buffer:{separate:!1,enable:!1,sourceFactor:g.Z.ONE,destinationFactor:g.Z.ZERO,sourceFactorAlpha:g.Z.ONE,destinationFactorAlpha:g.Z.ZERO},state:{separate:void 0,enable:!1,sourceFactor:void 0,destinationFactor:void 0,sourceFactorAlpha:void 0,destinationFactorAlpha:void 0},changed:!0}};p.prototype={clearColor:function(e){var t=this._stateClearColor,i=t.buffer,n=t.state;t.changed=!1,i.red=e[0],i.green=e[1],i.blue=e[2],i.alpha=e[3],n.red===e[0]&&n.green===e[1]&&n.blue===e[2]&&n.alpha===e[3]||(t.changed=!0)},applyClearColor:function(e){var t=this._stateClearColor,i=t.state,n=t.buffer;t.changed=!1,i.red=n.red,i.green=n.green,i.blue=n.blue,i.alpha=n.alpha,e.clearColor(i.red,i.green,i.blue,i.alpha)},clearDepth:function(e){var t=this._stateClearDepth,i=t.buffer,n=t.state;t.changed=!1,i.value=e,n.value!==e&&(t.changed=!0)},applyClearDepth:function(e){var t=this._stateClearDepth,i=t.buffer,n=t.state;t.changed=!1,n.value=i.value,e.clearDepth(n.value)},depthMask:function(e){var t=this._stateDepthMask,i=t.buffer,n=t.state;t.changed=!1,i.value=e,n.value!==e&&(t.changed=!0)},applyDepthMask:function(e){var t=this._stateDepthMask,i=t.buffer,n=t.state;t.changed=!1,n.value=i.value,e.depthMask(n.value)},applyViewportAttribute:function(e){this.viewport(e._x,e._y,e._width,e._height)},viewport:function(e,t,i,n){var r=this._stateViewport,a=r.buffer,o=r.state;r.changed=!1,a.x=e,a.y=t,a.width=i,a.height=n,o.x===e&&o.y===t&&o.width===i&&o.height===n||(r.changed=!0)},applyViewport:function(e){var t=this._stateViewport,i=t.buffer,n=t.state;t.changed=!1,n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,e.viewport(n.x,n.y,n.width,n.height)},applyColorMaskAttribute:function(e){var t=this._stateColorMask,i=t.buffer,n=t.state;t.changed=!1,i.red=e._red,i.green=e._green,i.blue=e._blue,i.alpha=e._alpha,n.red===e._red&&n.green===e._green&&n.blue===e._blue&&n.alpha===e._alpha||(t.changed=!0)},applyColorMask:function(e){var t=this._stateColorMask,i=t.buffer,n=t.state;t.changed=!1,n.red=i.red,n.green=i.green,n.blue=i.blue,n.alpha=i.alpha,e.colorMask(n.red,n.green,n.blue,n.alpha)},applyScissorAttribute:function(e){var t=-1!==e._x,i=this._stateScissor,n=i.buffer,r=i.state;i.changed=!1,n.enable=t,n.x=e._x,n.y=e._y,n.width=e._width,n.height=e._height,r.enable===t&&r.x===e._x&&r.y===e._y&&r.width===e._width&&r.height===e._height||(i.changed=!0)},applyScissor:function(e){var t=this._stateScissor,i=t.buffer,n=t.state;t.changed=!1,n.enable!==i.enable&&(n.enable=i.enable,n.enable?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)),n.enable&&(n.x===i.x&&n.y===i.y&&n.width===i.width&&n.height===i.height||(n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,e.scissor(n.x,n.y,n.width,n.height)))},applyCullFaceAttribute:function(e){var t=this._stateCullFace,i=t.buffer,n=t.state,r=e._mode!==f.Z.DISABLE;t.changed=!1,i.enable=r,i.mode=e._mode,n.enable===r&&n.mode===e._mode||(t.changed=!0)},applyCullFace:function(e){var t=this._stateCullFace,i=t.buffer,n=t.state;t.changed=!1,n.enable!==i.enable&&(n.enable=i.enable,n.enable?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE)),n.enable&&n.mode!==i.mode&&(n.mode=i.mode,e.cullFace(n.mode))},applyDepthAttribute:function(e){var t=e._func!==d.Z.DISABLE,i=this._stateDepth,n=i.buffer,r=i.state;i.changed=!1,n.enable=t,n.func=e._func,n.far=e._far,n.near=e._near,r.enable===t&&r.func===e._func&&r.near===e._near&&r.far===e._far||(i.changed=!0),this.depthMask(e._writeMask)},applyDepth:function(e){var t=this._stateDepth,i=t.buffer,n=t.state;t.changed=!1,n.enable!==i.enable&&(n.enable=i.enable,n.enable?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)),n.enable&&(n.func!==i.func&&(n.func=i.func,e.depthFunc(n.func)),n.near===i.near&&n.far===i.far||(n.far=i.far,n.near=i.near,e.depthRange(n.near,n.far)))},applyBlendFuncAttribute:function(e){var t=this._stateBlendFunc,i=t.buffer,n=t.state,r=e._sourceFactor!==g.Z.DISABLE&&e._destinationFactor!==g.Z.DISABLE;t.changed=!1,i.enable=r,i.separate=e._separate,i.sourceFactor=e._sourceFactor,i.destinationFactor=e._destinationFactor,i.sourceFactorAlpha=e._sourceFactorAlpha,i.destinationFactorAlpha=e._destinationFactorAlpha,n.enable===r&&n.sourceFactor===e._sourceFactor&&n.destinationFactor===e._destinationFactor&&n.sourceFactorAlpha===e._sourceFactorAlpha&&n.destinationFactorAlpha===e._destinationFactorAlpha||(t.changed=!0)},applyBlendFunc:function(e){var t=this._stateBlendFunc,i=t.buffer,n=t.state;t.changed=!1,n.enable!==i.enable&&(n.enable=i.enable,n.enable?e.enable(e.BLEND):e.disable(e.BLEND)),n.enable&&(n.separate=i.separate,n.separate?n.sourceFactor===i.sourceFactor&&n.destinationFactor===i.destinationFactor&&n.sourceFactorAlpha===i.sourceFactorAlpha&&n.destinationFactorAlpha===i.destinationFactorAlpha||(n.sourceFactor=i.sourceFactor,n.destinationFactor=i.destinationFactor,n.sourceFactorAlpha=i.sourceFactorAlpha,n.destinationFactorAlpha=i.destinationFactorAlpha,e.blendFuncSeparate(n.sourceFactor,n.destinationFactor,n.sourceFactorAlpha,n.destinationFactorAlpha)):n.sourceFactor===i.sourceFactor&&n.destinationFactor===i.destinationFactor||(n.sourceFactor=i.sourceFactor,n.destinationFactor=i.destinationFactor,e.blendFunc(n.sourceFactor,n.destinationFactor)))},applyClearStates:function(e){this._stateDepthMask.changed&&this.applyDepthMask(e),this._stateScissor.changed&&this.applyScissor(e),this._stateClearColor.changed&&this.applyClearColor(e),this._stateClearDepth.changed&&this.applyClearDepth(e),this._stateColorMask.changed&&this.applyColorMask(e)},applyDrawStates:function(e){this._stateViewport.changed&&this.applyViewport(e),this._stateScissor.changed&&this.applyScissor(e),this._stateDepth.changed&&this.applyDepth(e),this._stateDepthMask.changed&&this.applyDepthMask(e),this._stateCullFace.changed&&this.applyCullFace(e),this._stateBlendFunc.changed&&this.applyBlendFunc(e),this._stateColorMask.changed&&this.applyColorMask(e)},clear:function(e,t){this.applyClearStates(e),e.clear(t)},drawGeometry:function(e){this.applyDrawStates(e)}};const m=p;var _,v,C,b,S=[void 0,function(e,t){return e[0]===t[0]||(t[0]=e[0],!1)},function(e,t){return e[0]===t[0]&&e[1]===t[1]||(t[0]=e[0],t[1]=e[1],!1)},function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(t[0]=e[0],t[1]=e[1],t[2]=e[2],!1)},function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]||(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],!1)}],E=function(e){a.Z.call(this),this._excludeUniforms={uProjectionMatrix:!0,uModelMatrix:!0,uViewMatrix:!0,uModelViewMatrix:!0,uModelNormalMatrix:!0,uModelViewNormalMatrix:!0,uArrayColorEnabled:!0},this._graphicContext=void 0,this._shaderGeneratorProxy=e,void 0===e&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this._stateSets=new l.Z,this._shaderGeneratorNames=new u.Z,this._uniforms={},this._textureAttributeArrayList=[],this._attributeArray=[],this._projectionMatrix=h.Z.createMatrix4(n._E.create(),"uProjectionMatrix"),this._modelMatrix=h.Z.createMatrix4(n._E.create(),"uModelMatrix"),this._viewMatrix=h.Z.createMatrix4(n._E.create(),"uViewMatrix"),this._modelViewMatrix=h.Z.createMatrix4(n._E.create(),"uModelViewMatrix"),this._modelNormalMatrix=h.Z.createMatrix3(n.wO.create(),"uModelNormalMatrix"),this._modelViewNormalMatrix=h.Z.createMatrix3(n.wO.create(),"uModelViewNormalMatrix");var t=new u.Z;t._globalDefault=h.Z.createFloat1(0,"uArrayColorEnabled"),this._uniforms.ArrayColorEnabled=t,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0,this._program=void 0;var i=new o.Z;this.applyAttribute(i),this._programType=c.Z.getOrCreateStateAttributeTypeMemberIndex(i),this._programAttribute=this._attributeArray[this._programType],this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0,this._stateCache=new m,this.resetStats()};c.Z.createPrototypeObject(E,c.Z.objectInherit(a.Z.prototype,{getExcludeUniforms:function(){return this._excludeUniforms},resetCaches:function(){this._currentVAO=null,this._currentIndexVBO=null,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._programCommonUniformsCache={}},applyColorMask:function(e){this._stateCache.applyColorMaskAttribute(e)},applyBlendFunc:function(e){this._stateCache.applyBlendFuncAttribute(e)},applyCullFace:function(e){this._stateCache.applyCullFaceAttribute(e)},applyDepth:function(e){this._stateCache.applyDepthAttribute(e)},applyViewport:function(e){this._stateCache.applyViewportAttribute(e)},applyScissor:function(e){this._stateCache.applyScissorAttribute(e)},viewport:function(e,t,i,n){this._stateCache.viewport(e,t,i,n)},depthMask:function(e){this._stateCache.depthMask(e)},clearDepth:function(e){this._stateCache.clearDepth(e)},clearColor:function(e){this._stateCache.clearColor(e)},clear:function(e){this._stateCache.clear(this._graphicContext,e)},drawGeometry:function(e){this._stateCache.drawGeometry(this._graphicContext,e)},getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(e){this._graphicContext=e,this._extVAO=A.Z.instance(e).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(e,t,i){var n=this._evaluateOverrideObjectOnStack(e,t,i);n!==t?e.push(n,e._back.value):e.push(t,i)},_evaluateOverrideObjectOnStack:function(e,t,i){var n=e._back;return 0===e._length?t:n.value&s.Z.OVERRIDE&&!(i&s.Z.PROTECTED)?n.object:t},pushStateSet:function(e){this._numPushStateSet++,this._stateSets.push(e),this.pushAttributeMap(this._attributeArray,e._attributeArray,e._activeAttribute);for(var t=e._textureAttributeArrayList,i=e._activeTextureAttributeUnit,n=e._activeTextureAttribute,r=0,a=i.length;r<a;r++){var o=i[r],s=t[o],l=this.getOrCreateTextureAttributeArray(o);this.pushAttributeMap(l,s,n)}e.hasUniform()&&this.pushUniformsList(this._uniforms,e.getUniformList());var u=e.getShaderGeneratorPair();u&&this.pushCheckOverride(this._shaderGeneratorNames,u.getShaderGeneratorName(),u.getValue())},getStateSetStackSize:function(){return this._stateSets.getLength()},insertStateSet:(C=new l.Z,b=C.getArray(),function(e,t){C.reset();for(var i=this.getStateSetStackSize();i>e;)C.push(this._stateSets.back()),this.popStateSet(),i--;this.pushStateSet(t);for(var n=C._length-1;n>=0;n--)this.pushStateSet(b[n])}),removeStateSet:function(){var e=new l.Z,t=e.getArray();return function(i){var n=this.getStateSetStackSize();if(i>=n)r.Z.warn("Warning State:removeStateSet "+i+" out of range");else{for(e.reset();n-1>i;)e.push(this._stateSets.back()),this.popStateSet(),n--;this.popStateSet();for(var a=e._length-1;a>=0;a--)this.pushStateSet(t[a])}}}(),resetCacheFrame:function(){this._lastAppliedModelViewMatrix=this._lastAppliedProjectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(e){this._program!==e&&(this._program=e,this.getGraphicContext().useProgram(e))},applyModelViewMatrix:(v=n.wO.create(),function(e,t){if(this._lastAppliedModelViewMatrix===e)return!1;var i,r=this.getLastProgramApplied().getUniformsCache(),a=this._modelViewMatrix,o=r.uModelViewMatrix,s=this.getGraphicContext();if(o&&(a.setMatrix4(e),a.apply(s,o)),this._lastAppliedModelViewMatrix){for(var l=this._lastAppliedModelViewMatrix,u=0;u<11;u++)if(e[u]!==l[u]){i=!0;break}}else i=!0;return i&&(a=this._modelViewNormalMatrix,(o=r.uModelViewNormalMatrix)&&(n.wO.normalFromMat4(v,e),a.setMatrix3(v),a.apply(s,o)),(o=r.uModelNormalMatrix)&&(n.wO.normalFromMat4(v,t),a.setMatrix3(v),a.apply(s,o))),this._lastAppliedModelViewMatrix=e,!0}),applyProjectionMatrix:function(e){if(this._lastAppliedProjectionMatrix!==e){this._lastAppliedProjectionMatrix=e;var t=this.getLastProgramApplied(),i=this._projectionMatrix,n=t.getUniformsCache()[i.getName()];n&&(i.setMatrix4(e),i.apply(this.getGraphicContext(),n))}},getCurrentShaderGeneratorStateSet:function(e){var t=this._programAttribute,i=e._attributeArray[this._programType];if(!(0!==t._length&&t._back.value!==s.Z.OFF||i&&i.getValue()!==s.Z.OFF)){var n,r=e.getShaderGeneratorPair(),a=this._shaderGeneratorNames;if(r){var o=r.getValue(),l=r.getShaderGeneratorName();n=this._evaluateOverrideObjectOnStack(this._shaderGeneratorNames,l,o)}else a._length&&(n=a._back.object);var u=n;return this._shaderGeneratorProxy.getShaderGenerator(u)}},_applyAttributeMapStateSet:function(e,t){for(var i=0,n=e.length>t.length?e.length:t.length;i<n;i++){var r,a=i,o=a<e.length?e[a]:void 0,s=a<t.length?t[a]:void 0,l=!!o,u=l&&o._changed;if(s||u){var h=s?s.getAttribute():void 0;if(l)if(h){var c=s.getValue();(r=this._evaluateOverrideObjectOnStack(o,h,c))!==h?o._changed&&(this._applyAttributeStack(r,o),o._changed=!1):this._applyAttributeStack(r,o)&&(o._changed=!0)}else o._length?(o._changed=!1,this._applyAttributeStack(o._back.object,o)):(o._changed=!1,this._applyAttributeStack(o._globalDefault,o));else(o=this._createAttributeStack(e,a,h.cloneType()))._changed=!0,this._applyAttributeStack(h,o)}}},_applyTextureAttributeMapListStateSet:function(e,t){for(var i,n,r,a=0;a<16;a++){var o=a;i=o<e.length?e[o]:void 0;var s=o<t.length?t[o]:void 0;if(i||s){n=r=0,i?(r=i.length,s&&(n=s.length)):(i=this.getOrCreateTextureAttributeArray(o),n=s.length);for(var l=r>n?r:n,u=0;u<l;u++){var h,c=u,A=c<r?i[c]:void 0,d=s&&c<s.length?s[c]:void 0,g=!!A,f=g&&A._changed;if(d||f){var p=d?d.getAttribute():void 0;if(g)if(p){var m=d.getValue();(h=this._evaluateOverrideObjectOnStack(A,p,m))!==p?A._changed&&(this._applyTextureAttribute(o,h,A),A._changed=!1):this._applyTextureAttribute(o,h,A)&&(A._changed=!0)}else A._length?(A._changed=!1,this._applyTextureAttribute(o,A._back.object,A)):(A._changed=!1,this._applyTextureAttribute(o,A._globalDefault,A));else h=d.getAttribute(),(A=this._createAttributeStack(i,c,h.cloneType()))._changed=!0,this._applyTextureAttribute(o,h,A)}}}}},applyStateSet:function(e){this._numApply++;var t,i=this.getLastProgramApplied();if(this._currentShaderGenerator=this.getCurrentShaderGeneratorStateSet(e),this._applyAttributeMapStateSet(this._attributeArray,e._attributeArray),this._applyTextureAttributeMapListStateSet(this._textureAttributeArrayList,e._textureAttributeArrayList),this._currentShaderGenerator){var n=this._currentShaderGenerator.getOrCreateProgram(this);this.applyAttribute(n),t=n,this._applyGeneratedProgramUniforms(n,e)}else t=this.getLastProgramApplied(),this._applyCustomProgramUniforms(t,e);i!==t&&(this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0)},popAllStateSets:function(){for(;this._stateSets._length;)this.popStateSet()},popStateSet:function(){if(this._stateSets._length){var e=this._stateSets.pop();this.popAttributeMap(this._attributeArray,e._attributeArray,e._activeAttribute);for(var t=e._textureAttributeArrayList,i=e._activeTextureAttributeUnit,n=e._activeTextureAttribute,r=0,a=i.length;r<a;r++){var o=i[r],s=t[o],l=this._textureAttributeArrayList[o];this.popAttributeMap(l,s,n)}e.hasUniform()&&this.popUniformsList(this._uniforms,e.getUniformList()),e.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(e,t,i){c.Z.arrayDense(t,e);var n=new u.Z;return n._globalDefault=i,e[t]=n,n},haveAppliedAttribute:function(e){if(e){var t=this._attributeArray,i=c.Z.getOrCreateStateAttributeTypeMemberIndex(e),n=i<t.length?t[i]:void 0;n||(n=this._createAttributeStack(t,i,e.cloneType())),n._lastApplied=e,n._changed=!0}},applyAttribute:function(e){var t=c.Z.getOrCreateStateAttributeTypeMemberIndex(e),i=this._attributeArray,n=t<i.length?i[t]:void 0;n||(n=this._createAttributeStack(i,t,e.cloneType())),n._changed=!0,this._applyAttributeStack(e,n)},_applyAttributeStack:function(e,t){return t._lastApplied!==e&&(e.apply&&e.apply(this),t._lastApplied=e,!0)},_applyTextureAttribute:function(e,t,i){if(i._lastApplied===t)return!1;if(i._lastApplied=t,!t.apply)return!0;var n=this.getGraphicContext();return n.activeTexture(n.TEXTURE0+e),t.apply(this,e),!0},applyTextureAttribute:function(e,t){var i=c.Z.getOrCreateTextureStateAttributeTypeMemberIndex(t),n=this.getOrCreateTextureAttributeArray(e),r=n[i];r||(r=this._createAttributeStack(n,i,t.cloneType())),r._changed=!0,this._applyTextureAttribute(e,t,r)},getLastProgramApplied:function(){return this._programAttribute._lastApplied},applyDefault:function(){this.popAllStateSets(),this._currentShaderGenerator=void 0,this.applyAttributeMap(this._attributeArray),this.applyTextureAttributeMapList(this._textureAttributeArrayList)},applyAttributeMap:function(e){for(var t,i=0,n=e.length;i<n;i++){var r;if(t=e[i])r=t._length?t._back.object:t._globalDefault,t._changed&&(t._lastApplied!==r&&(r.apply&&r.apply(this),t._lastApplied=r),t._changed=!1)}},pushUniformsList:function(e,t){var i,n;for(var r in t){var a=t[r];e[i=(n=a.getUniform()).getName()]||this._createAttributeStack(e,i,n),this.pushCheckOverride(e[i],n,a.getValue())}},popUniformsList:function(e,t){for(var i in t)e[i].pop()},applyTextureAttributeMapList:function(e){for(var t,i=this._graphicContext,n=0,r=e.length;n<r;n++)if(t=e[n])for(var a=0,o=t.length;a<o;a++){var s,l=t[a];if(l)s=l._length?l._back.object:l._globalDefault,l._changed&&(l._lastApplied!==s&&(i.activeTexture(i.TEXTURE0+n),s.apply(this,n),l._lastApplied=s),l._changed=!1)}},setGlobalDefaultAttribute:function(e){var t=c.Z.getOrCreateStateAttributeTypeMemberIndex(e);t>=this._attributeArray.length||!this._attributeArray[t]?this._createAttributeStack(this._attributeArray,t,e):this._attributeArray[t]._globalDefault=e},getGlobalDefaultAttribute:function(e){var t=this._attributeArray,i=c.Z.getIdFromTypeMember(e);if(!(void 0===i||i>=t.length))return t[i]?t[i]._globalDefault:void 0},setGlobalDefaultTextureAttribute:function(e,t){var i=this.getOrCreateTextureAttributeArray(e),n=c.Z.getOrCreateTextureStateAttributeTypeMemberIndex(t);n>=i.length||!i[n]?this._createAttributeStack(i,n,t):i[n]._globalDefault=t},getGlobalDefaultTextureAttribute:function(e,t){var i=this.getOrCreateTextureAttributeArray(e),n=c.Z.getTextureIdFromTypeMember(t);if(!(void 0===n||n>=i.length))return i[n]?i[n]._globalDefault:void 0},getOrCreateTextureAttributeArray:function(e){return c.Z.arrayDense(e,this._textureAttributeArrayList),this._textureAttributeArrayList[e]||(this._textureAttributeArrayList[e]=[]),this._textureAttributeArrayList[e]},pushAttributeMap:function(e,t,i){for(var n,r=t.length,a=e.length,o=0,s=i.length;o<s;o++){var l=i[o],u=l<r?t[l]:void 0,h=u.getAttribute();(n=l<a?e[l]:void 0)||(n=this._createAttributeStack(e,l,h.cloneType())),this.pushCheckOverride(n,h,u.getValue()),n._changed=!0}},popAttributeMap:function(e,t,i){for(var n=0,r=i.length;n<r;n++){var a=e[i[n]];a.pop(),a._changed=!0}},setIndexArray:function(e){var t=this._graphicContext;this._currentIndexVBO!==e&&(e.bind(t),this._currentIndexVBO=e),e.isDirty()&&e.compile(t)},lazyDisablingOfVertexAttributes:function(){for(var e=this._vertexAttribMap._keys,t=0,i=e.length;t<i;t++){var n=e[t];this._vertexAttribMap[n]&&(this._vertexAttribMap._disable[n]=!0)}},enableVertexColor:function(){var e=this._programAttribute._lastApplied;if(e.getUniformsCache().uArrayColorEnabled&&e.getAttributesCache().Color){var t=this._uniforms.ArrayColorEnabled._globalDefault;this._previousColorAttribPair[e.getInstanceID()]||(t.setFloat(1),t.apply(this.getGraphicContext(),e.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[e.getInstanceID()]=!0)}},disableVertexColor:function(){var e=this._programAttribute._lastApplied;if(e.getUniformsCache().uArrayColorEnabled&&e.getAttributesCache().Color){var t=this._uniforms.ArrayColorEnabled._globalDefault;this._previousColorAttribPair[e.getInstanceID()]&&(t.setFloat(0),t.apply(this.getGraphicContext(),e.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[e.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var e=this._vertexAttribMap._keys,t=0,i=e.length;t<i;t++)if(!0===this._vertexAttribMap._disable[e[t]]){var n=e[t];this._graphicContext.disableVertexAttribArray(n),this._vertexAttribMap._disable[n]=!1,this._vertexAttribMap[n]=!1}},clearVertexAttribCache:function(){for(var e=this._vertexAttribMap,t=e._keys,i=0,n=t.length;i<n;i++){var r=t[i];e[r]=void 0,e._disable[r]=!1}this._vertexAttribMap._disable.length=0,this._vertexAttribMap._keys.length=0},setVertexArrayObject:function(e){return this._currentVAO!==e&&(this._currentVAO=e,e?e.bind(this._graphicContext):(this._graphicContext.bindVertexArray(null),this.clearVertexAttribCache()),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(e,t){var i=this._vertexAttribMap;i._disable[e]=!1;var n=this._graphicContext,r=!1;t.isDirty()&&(t.bind(n),t.compile(n),r=!0);var a=i[e];a!==t&&(r||t.bind(n),a||(n.enableVertexAttribArray(e),void 0===a&&i._keys.push(e)),i[e]=t,n.vertexAttribPointer(e,t.getGlItemSize(),t.getGlType(),t.getGlNormalize(),0,0))},_getActiveUniformsFromProgramAttributes:function(e,t){var i=this._attributeArray,n=e.getTrackAttributes().attributeKeys;if(n.length>0)for(var r=0,a=n.length;r<a;r++){var o=n[r],s=i[this.typeMember[o]];if(s){var l=s._globalDefault;if(l.getOrCreateUniforms){var u=l.getOrCreateUniforms();for(var h in u)t.push(u[h])}}}},_getActiveUniformsFromProgramTextureAttributes:function(e,t){var i=e.getTrackAttributes().textureAttributeKeys;if(i)for(var n=0,r=i.length;n<r;n++){var a=i[n];if(a){var o=this._textureAttributeArrayList[n];if(o)for(var s=0,l=a.length;s<l;s++){var u=o[a[s]];if(u){var h=u._globalDefault;if(h.getOrCreateUniforms){var c=h.getOrCreateUniforms();for(var A in c)t.push(c[A])}}}}}},_cacheUniformsForCustomProgram:function(e,t){this._getActiveUniformsFromProgramAttributes(e,t),this._getActiveUniformsFromProgramTextureAttributes(e,t);for(var i=this._graphicContext,n={},r=0,a=t.length;r<a;r++){var o=t[r],s=o.getName(),l=i.getUniformLocation(e._program,s);null!=l&&(n[s]=o)}e.trackUniforms=n},_applyCustomProgramUniforms:(_=[],function(e,t){_.length=0,void 0!==e.getTrackAttributes()&&void 0===e.trackUniforms&&this._cacheUniformsForCustomProgram(e,_);var i,n,r=e.getUniformsCache(),a=this._uniforms;for(var o in e.trackUniforms&&(i=e.trackUniforms),r){var s=r[o],l=a[o],u=t&&t.uniforms[o];if(l||u)if(u){var h=t.uniforms[o],c=h.getValue(),A=h.getUniform();n=l?this._evaluateOverrideObjectOnStack(l,A,c):A}else n=l._length?l._back.object:l._globalDefault;else{if(void 0===i){this._checkErrorUniform(o);continue}n=i[o]}n.apply(this._graphicContext,s)}}),_checkErrorUniform:function(e){var t=e.substr(7);this._textureAttributeArrayList[t]&&e==="Texture"+t||this._excludeUniforms[e]||(this._excludeUniforms[e]=1,r.Z.error("Uniform not in the scene hierarchy : "+e))},_computeForeignUniforms:function(e,t){var i=[];for(var n in e){void 0!==e[n]&&void 0===t[n]&&(this._excludeUniforms[n]||i.push(n))}return i},_removeUniformsNotRequiredByProgram:function(e,t){for(var i in e){var n=t[i];null==n&&delete e[i]}},_cacheUniformsForGeneratedProgram:function(e){var t=e.getUniformsCache(),i=e.getActiveUniforms(),n=this._computeForeignUniforms(t,i);e.setForeignUniforms(n),this._removeUniformsNotRequiredByProgram(i,t)},_copyUniformEntry:function(e){var t,i=e.getInternalArray();return i.length<16&&(t=new i.constructor(i.length)),t},_initUniformCache:function(e){var t,i,n,r,a,o=e.getActiveUniforms(),s=e.getForeignUniforms(),l=this._uniforms,u=[],h=[];if(e._cacheUniformId=this._cacheUniformId++,this._programUniformCache[e._cacheUniformId]={},s.length)for(n=u,t=0,i=s.length;t<i;t++){var c=l[s[t]];c&&(a=c._globalDefault,r=this._copyUniformEntry(a),n.push(r))}for(var A in o)a=o[A],r=this._copyUniformEntry(a),h.push(r);this._programUniformCache[e._cacheUniformId].foreign=u,this._programUniformCache[e._cacheUniformId].active=h},_checkCacheAndApplyUniform:function(e,t,i,n,r){var a,o=e.getInternalArray(),s=o.length;if(s<=4){var l=t[i];a=S[s](o,l)}else a=!1;if(!a){var u=n[r];e.apply(this._graphicContext,u)}},_applyGeneratedProgramUniforms:function(e,t){var i,n,r,a,o=this._uniforms,s=e.getForeignUniforms();if(!s){if(this._cacheUniformsForGeneratedProgram(e),s=e.getForeignUniforms(),t){var l=t.uniforms;for(a=0;a<s.length;a++)o[n=s[a]]||l[n]&&(i=l[n].getUniform(),this._createAttributeStack(o,n,i))}this._initUniformCache(e)}var u=e.getUniformsCache(),h=e.getActiveUniforms(),c=this._programUniformCache[e._cacheUniformId].active,A=this._programUniformCache[e._cacheUniformId].foreign,d=0;for(var g in h)i=h[g],this._checkCacheAndApplyUniform(i,c,d,u,g),d++;d=0;var f=s.length;for(a=0;a<f;a++){r=o[n=s[a]];var p=t&&t.uniforms[n];if(p||r){if(p){var m=t.uniforms[n],_=m.getValue(),v=m.getUniform();i=this._evaluateOverrideObjectOnStack(r,v,_)}else r._length?i=r._back.object:(i=r._globalDefault,this._checkErrorUniform(n));this._checkCacheAndApplyUniform(i,A,d,u,n),d++}else this._checkErrorUniform(n)}},_setStateSetsDrawID:function(e){for(var t=this._stateSets.getArray(),i=0,n=this._stateSets.length;i<n;i++)t[i].setDrawID(e)},_stateSetStackChanged:function(e,t){var i=this._stateSets.getArray(),n=this._stateSets.length;if(t!==n)return!0;for(var r=0;r<n;r++)if(e!==i[r].getDrawID())return!0;return!1}}),"osg","State");const y=E},QrwD:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=i("vrBm"),a=function(){r.Z.call(this)};n.Z.createPrototypeStateAttribute(a,n.Z.objectInherit(r.Z.prototype,{_attributeTypeIndex:void 0,getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getType()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,a.OVERRIDE_ON=a.OVERRIDE|a.ON;const o=a},FFaL:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n,r,a=i("0rAA"),o=i("BW96"),s=i("kJFG"),l=i("U7nq"),u=function(){this._depth=0,this._children=new s.Z,this._leafs=new o.Z,this._stateset=void 0,this._parent=void 0};u.pooledStateGraph=new l.Z((function(){return new u})),u.statsNbMoveStateGraph=0,u.reset=function(){u.pooledStateGraph.reset(),u.statsNbMoveStateGraph=0},a.Z.createPrototypeObject(u,{clean:function(){this._leafs.reset(),this._children.reset(),this._depth=0,this._stateset=void 0,this._parent=void 0},getStateSet:function(){return this._stateset},getLeafs:function(){return this._leafs},getParent:function(){return this._parent},findOrInsert:function(e){var t=e.getInstanceID(),i=this._children.getMap()[t];return i||((i=u.pooledStateGraph.getOrCreateObject()).clean(),i._parent=this,i._depth=this._depth+1,i._stateset=e,this._children.set(t,i)),i}},"osg","StateGraph"),u.moveStateGraph=(n=new o.Z,r=n.getArray(),function(e,t,i){u.statsNbMoveStateGraph++,n.reset();var a,o,s=i,l=t;if(s!==l&&void 0!==s)if(void 0!==l){if(l._parent===s._parent)return void 0!==l._stateset&&e.popStateSet(),void(void 0!==s._stateset&&e.pushStateSet(s._stateset));for(;l._depth>s._depth;)void 0!==l._stateset&&e.popStateSet(),l=l._parent;for(n.reset();s._depth>l._depth;)void 0!==s._stateset&&n.push(s._stateset),s=s._parent;for(;l!==s;)void 0!==l._stateset&&e.popStateSet(),l=l._parent,void 0!==s._stateset&&n.push(s._stateset),s=s._parent;for(a=n._length-1,o=0;a>=o;--a)e.pushStateSet(r[a])}else{do{void 0!==s._stateset&&n.push(s._stateset),s=s._parent}while(s);for(a=n._length-1,o=0;a>=o;--a)e.pushStateSet(r[a])}});const h=u},"0/zD":(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("vrBm"),r=i("QrwD"),a=i("0rAA"),o=function(){n.Z.call(this),this._parents=[],this._attributeArray=[],this._textureAttributeArrayList=[],this._activeTextureAttributeUnit=[],this._activeAttribute=[],this._activeTextureAttribute=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms={},this._hasUniform=!1,this._drawID=-1};(o.AttributePair=function(e,t){this._object=e,this._value=t}).prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},a.Z.createPrototypeObject(o,a.Z.objectInherit(n.Z.prototype,{setDrawID:function(e){this._drawID=e},getDrawID:function(){return this._drawID},getAttributePair:function(e,t){return new o.AttributePair(e,t)},addUniform:function(e,t){var i=void 0!==t?t:r.Z.ON,n=e.getName();this.uniforms[n]=this.getAttributePair(e,i),this._hasUniform=!0},addParent:function(e){this._parents.push(e)},removeParent:function(e){var t=this._parents.indexOf(e);-1!==t&&this._parents.splice(t,1)},removeUniform:function(e){this.removeUniformByName(e.getName())},removeUniformByName:function(e){delete this.uniforms[e],this._hasUniform=!!window.Object.keys(this.uniforms).length},hasUniform:function(){return this._hasUniform},getUniform:function(e){var t=this.uniforms;if(t[e])return t[e].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(e,t,i){this._setTextureAttribute(e,this.getAttributePair(t,void 0!==i?i:r.Z.ON))},getNumTextureAttributeLists:function(){return this._textureAttributeArrayList.length},getTextureAttribute:function(e,t){var i=a.Z.getTextureIdFromTypeMember(t);if(void 0!==i&&this._hasTextureAttribute(e,i)){var n=this._textureAttributeArrayList[e];return n[i]?n[i].getAttribute():void 0}},removeTextureAttribute:function(e,t){var i=a.Z.getTextureIdFromTypeMember(t);void 0!==i&&this._hasTextureAttribute(e,i)&&(this._textureAttributeArrayList[e][i]=void 0,this._computeValidTextureUnit())},getAttribute:function(e){var t=a.Z.getIdFromTypeMember(e);if(void 0!==t&&this._hasAttribute(t))return this._attributeArray[t].getAttribute()},setAttributeAndModes:function(e,t){this._setAttribute(this.getAttributePair(e,void 0!==t?t:r.Z.ON))},setAttribute:function(e,t){this.setAttributeAndModes(e,t)},removeAttribute:function(e){var t=a.Z.getIdFromTypeMember(e);this._hasAttribute(t)&&(this._attributeArray[t]=void 0,this._computeValidAttribute())},setRenderingHint:function(e){"OPAQUE_BIN"===e?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===e?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(e){var t=this._updateCallbackList.indexOf(e);if(-1!==t&&(this._updateCallbackList.splice(t,1),0===this._updateCallbackList.length))for(var i=this._parents,n=0,r=i.length;n<r;n++){var a=i[n];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(e){var t=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(e),!t)for(var i=this._parents,n=0,r=i.length;n<r;n++){var a=i[n];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(e){return-1!==this._updateCallbackList.indexOf(e)},setRenderBinDetails:function(e,t){this._binNumber=e,this._binName=t},getAttributeMap:function(){for(var e={},t=0,i=this._attributeArray.length;t<i;t++){var n=this._attributeArray[t];if(n)e[n.getAttribute().getTypeMember()]=n}return e},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(e){this._binNumber=e},setBinName:function(e){this._binName=e},getAttributeList:function(){for(var e=this._attributeArray,t=[],i=0,n=e.length;i<n;i++)e[i]&&t.push(e[i]);return t},setShaderGeneratorName:function(e,t){this._shaderGeneratorPair=this.getAttributePair(e,void 0!==t?t:r.Z.ON)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var e=0,t=this._textureAttributeArrayList.length;e<t;e++){var i=this.getTextureAttribute(e,"Texture");i&&i.releaseGLObjects()}for(var n=this.getAttributeList(),r=0,a=n.length;r<a;r++)n[r]._object.releaseGLObjects&&n[r]._object.releaseGLObjects()},_setTextureAttribute:function(e,t){a.Z.arrayDense(e,this._textureAttributeArrayList),this._textureAttributeArrayList[e]||(this._textureAttributeArrayList[e]=[]);var i=a.Z.getOrCreateTextureStateAttributeTypeMemberIndex(t.getAttribute());a.Z.arrayDense(i,this._textureAttributeArrayList[e]),this._textureAttributeArrayList[e][i]=t,this._computeValidTextureUnit()},_computeValidTextureUnit:function(){this._activeTextureAttributeUnit.length=0,this._activeTextureAttribute.length=0;for(var e=this._textureAttributeArrayList,t=0,i=e.length;t<i;t++){var n=e[t];if(n&&n.length){for(var r=!1,a=0,o=n.length;a<o;a++)n[a]&&(r=!0,-1===this._activeTextureAttribute.indexOf(a)&&this._activeTextureAttribute.push(a));r&&this._activeTextureAttributeUnit.push(t)}}},_computeValidAttribute:function(){this._activeAttribute.length=0;for(var e=this._attributeArray,t=0,i=e.length;t<i;t++)e[t]&&this._activeAttribute.push(t)},_setAttribute:function(e){var t=a.Z.getOrCreateStateAttributeTypeMemberIndex(e.getAttribute());a.Z.arrayDense(t,this._attributeArray),this._attributeArray[t]=e,this._computeValidAttribute()},_hasAttribute:function(e){return!(e>=this._attributeArray.length)&&!!this._attributeArray[e]},_hasTextureAttribute:function(e,t){return!(e>=this._textureAttributeArrayList.length||!this._textureAttributeArrayList[e])&&(!(t>=this._textureAttributeArrayList[e].length)&&!!this._textureAttributeArrayList[e][t])}}),"osg","StateSet");const s=o},"m+0q":(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("FJW6"),a=i("2bAw"),o=function(){r.Z.call(this),this._values=[]};n.Z.createPrototypeNode(o,n.Z.objectInherit(r.Z.prototype,{addChild:function(e,t){return r.Z.prototype.addChild.call(this,e),void 0===t&&(t=!0),this.children.length>this._values.length?this._values.push(t):this._values[this.children.length-1]=t,!0},setValue:function(e,t){e<this._values.length&&(this._values[e]=t)},getValue:function(e){if(e<this._values.length)return this._values[e]},setAllChildrenOff:function(){for(var e=0;e<this._values.length;++e)this._values[e]=!1},setAllChildrenOn:function(){for(var e=0;e<this._values.length;++e)this._values[e]=!0},traverse:function(e){switch(e.traversalMode){case a.Z.TRAVERSE_ALL_CHILDREN:for(var t=0;t<this.children.length;++t)this.children[t].accept(e);break;case a.Z.TRAVERSE_ACTIVE_CHILDREN:var i=this.children.length;for(this._values.length<i&&(i=this._values.length),t=0;t<i;++t)!0===this._values[t]&&this.children[t].accept(e)}}}),"osg","Switch");const s=o},FCEq:(e,t,i)=>{"use strict";i.d(t,{Z:()=>M});var n=i("Hfbx"),r=i("0rAA"),a=i("QrwD"),o=i("LZhK"),s=i("QuvP"),l=i("83E6"),u=function(e,t,i,n){this._target=e,this._internalFormat=t,this._width=i,this._height=n,this._size=0,this.computeSize()};u.prototype={match:function(e){return e._target===this._target&&e._internalFormat===this._internalFormat&&e._width===this._width&&e._height===this._height},computeSize:function(){var e=i("FCEq").Z,t=0;switch(this._internalFormat){case 1:case e.ALPHA:case e.LUMINANCE:t=8;break;case e.LUMINANCE_ALPHA:case 2:t=16;break;case e.RGB:case 3:t=24;break;case e.RGBA:case 4:t=32}var n=Math.ceil(this._width*this._height*t)/8;this._target===e.TEXTURE_CUBE_MAP&&(n*=6),n+=n/3,this._size=n},getSize:function(){return this._size}},u.getHash=function(){var e=Array.prototype.slice.call(arguments),t="";return e.forEach((function(e){t+=e})),t};var h=function(e,t,i){this._texture=e,this._id=t,this._textureSet=i};h.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(e){e.bindTexture(this.target(),this._id)}};var c=function(e){this._profile=e,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};c.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(e,t){var i;if(this._orphanedTextureObjects.length>0)return(i=this.takeFromOrphans())._texture=t,this._usedTextureObjects.push(i),i;var n=e.createTexture();return i=new h(t,n,this),this._usedTextureObjects.push(i),i},takeFromOrphans:function(){if(this._orphanedTextureObjects.length)return this._orphanedTextureObjects.pop()},orphan:function(e){var t=this._usedTextureObjects.indexOf(e);-1!==t&&(this._orphanedTextureObjects.push(this._usedTextureObjects[t]),this._usedTextureObjects.splice(t,1))},flushDeletedTextureObjects:function(e,t){if(t<=0)return t;var i,n=this._orphanedTextureObjects.length,r=0,a=l.Z.instance().tick();for(i=0;i<n&&r<t;i++)e.deleteTexture(this._orphanedTextureObjects[i].id()),this._orphanedTextureObjects[i].reset(),r=l.Z.instance().deltaS(a,l.Z.instance().tick());return this._orphanedTextureObjects.splice(0,i),t-r},flushAllDeletedTextureObjects:function(e){for(var t=this._orphanedTextureObjects.length,i=this.getProfile().getSize(),r=0,a=t;r<a;++r)e.deleteTexture(this._orphanedTextureObjects[r].id()),this._orphanedTextureObjects[r].reset();this._orphanedTextureObjects.length=0,n.Z.info("TextureManager: released "+t+" with "+t*i/1048576+" MB")},onLostContext:function(){var e,t;for(t=this._orphanedTextureObjects.length,e=0;e<t;++e)this._orphanedTextureObjects[e].reset();for(this._orphanedTextureObjects.length=0,t=this._usedTextureObjects.length,e=0;e<t;++e)this._usedTextureObjects[e].reset();this._usedTextureObjects.length=0}};var A=function(){this._textureSetMap={}};A.prototype={generateTextureObject:function(e,t,i,n,r,a){var o=u.getHash(i,n,r,a);return void 0===this._textureSetMap[o]&&(this._textureSetMap[o]=new c(new u(i,n,r,a))),this._textureSetMap[o].takeOrGenerate(e,t)},updateStats:function(e){var t=0,i=0;for(var n in this._textureSetMap){var r=this._textureSetMap[n].getProfile().getSize();t+=this._textureSetMap[n].getUsedTextureObjects().length*r,i+=this._textureSetMap[n].getOrphanedTextureObjects().length*r}var a=1048576;e.getCounter("textureused").set(t/a),e.getCounter("texturereserved").set(i/a),e.getCounter("texturetotal").set((t+i)/a)},reportStats:function(){var e=0;for(var t in this._textureSetMap){var i=this._textureSetMap[t].getProfile(),r=i.getSize()/1048576,a=this._textureSetMap[t].getUsedTextureObjects().length;e+=r*=a,n.Z.notice(String(r)+" MB with "+a+" texture of "+i._width+"x"+i._height+" "+i._internalFormat)}n.Z.notice(String(e)+" MB in total")},flushAllDeletedTextureObjects:function(e){for(var t in this._textureSetMap)this._textureSetMap[t].flushAllDeletedTextureObjects(e)},onLostContext:function(e){for(var t in this._textureSetMap)this._textureSetMap[t].onLostContext(e)},flushDeletedTextureObjects:function(e,t){var i=t;for(var n in this._textureSetMap)if((i=this._textureSetMap[n].flushDeletedTextureObjects(e,i))<=0)break;return i},releaseTextureObject:function(e){e&&e.getTextureSet().orphan(e)}};const d=A;var g=i("EMUO"),f=i("N6zH"),p=i("duFD");function m(e,t,i){var n=e.createShader(t);return delete e.shaderSource,e.shaderSource(n,i),delete e.compileShader,e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.log("ERROR TP: "+e.getShaderInfoLog(n)),null)}var _=null;function v(e){if(_)return _;_={};var t=0;e.createVertexArray&&(t=e.createVertexArray(),e.bindVertexArray(t));var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),e.STATIC_DRAW);var n=e.createProgram(),r=m(e,e.VERTEX_SHADER,f),a=m(e,e.FRAGMENT_SHADER,p);if(e.attachShader(n,r),e.attachShader(n,a),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))return null;e.useProgram(n);var o={attribLocations:{vertex:e.getAttribLocation(n,"aVertex")},uniformLocations:{uSampler:e.getUniformLocation(n,"uT"),uSize:e.getUniformLocation(n,"uS"),uOffset:e.getUniformLocation(n,"uO"),uYFlipped:e.getUniformLocation(n,"uY")}};if(t){var s=e.FLOAT;e.vertexAttribPointer(o.attribLocations.vertex,2,s,!1,0,0),e.enableVertexAttribArray(o.attribLocations.vertex)}var l=e.createFramebuffer();return _.prepare=function(r,a,s){if(e.useProgram(n),e.uniform1i(o.uniformLocations.uOffset,r),e.uniform1i(o.uniformLocations.uSampler,0),e.uniform1i(o.uniformLocations.uYFlipped,s),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a),t)e.bindVertexArray(t);else{var l=e.FLOAT;e.bindBuffer(e.ARRAY_BUFFER,i),e.vertexAttribPointer(o.attribLocations.vertex,2,l,!1,0,0),e.enableVertexAttribArray(o.attribLocations.vertex)}e.disable(e.BLEND),e.disable(e.DEPTH_TEST)},_.renderInto=function(t,i,n){e.uniform2i(o.uniformLocations.uSize,i,n),e.bindFramebuffer(e.FRAMEBUFFER,l),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.viewport(0,0,i,n),e.drawArrays(e.TRIANGLES,0,6)},_}const C=function(e,t,i,n,r,a){var o=e.getParameter(e.ARRAY_BUFFER_BINDING),s=e.getParameter(e.CURRENT_PROGRAM),l=e.getParameter(e.FRAMEBUFFER_BINDING),u=e.getParameter(e.BLEND),h=e.getParameter(e.DEPTH_TEST),c=e.getParameter(e.VIEWPORT),A=e.getParameter(e.ACTIVE_TEXTURE),d=0;e.bindVertexArray&&(d=e.getParameter(e.VERTEX_ARRAY_BINDING));var g=i[5].width,f=i[5].height;e.bindTexture(i[0],r),e.texImage2D(i[0],i[1],e.RGBA,g,f,0,e.RGBA,e.UNSIGNED_BYTE,null);var p=e.createTexture();e.bindTexture(e.TEXTURE_2D,p),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),n?e.compressedTexImage2D.apply(e,i):e.texImage2D.apply(e,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var m=v(e);t*=64,t%=g*f,m.prepare(-t,p,a),m.renderInto(r,g,f),e.deleteTexture(p),e.bindFramebuffer(e.FRAMEBUFFER,l),e.bindBuffer(e.ARRAY_BUFFER,o),e.useProgram(s),e.viewport(c[0],c[1],c[2],c[3]),u&&e.enable(e.BLEND),h&&e.enable(e.DEPTH_TEST),d&&e.bindVertexArray(d),e.activeTexture(A),e.bindTexture(i[0],r)};var b=i("BfDR"),S=window.ImageBitmap||function(){},E=function(e){return 0!==e&&(e&1+~e)===e},y=function(){a.Z.call(this),s.Z.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},I=function(e,t){var i=y[e];return void 0===i?(n.Z.warn("bad Texture enum argument "+e+"\nfallback to "+t),t):i};y.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,y.UNPACK_FLIP_Y_WEBGL=37440,y.BROWSER_DEFAULT_WEBGL=37444,y.NONE=0,y.DEPTH_COMPONENT=6402,y.DEPTH_COMPONENT16=33189,y.DEPTH_STENCIL=34041,y.DEPTH24_STENCIL8=35056,y.DEPTH_COMPONENT24=33190,y.DEPTH_COMPONENT32F=36012,y.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,y.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,y.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,y.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,y.COMPRESSED_RGB_ATC_WEBGL=35986,y.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,y.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,y.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,y.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,y.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,y.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,y.COMPRESSED_RGB_ETC1_WEBGL=36196,y.LINEAR=9729,y.NEAREST=9728,y.NEAREST_MIPMAP_NEAREST=9984,y.LINEAR_MIPMAP_NEAREST=9985,y.NEAREST_MIPMAP_LINEAR=9986,y.LINEAR_MIPMAP_LINEAR=9987,y.TEXTURE_MAX_ANISOTROPY_EXT=34046,y.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,y.CLAMP_TO_EDGE=33071,y.REPEAT=10497,y.MIRRORED_REPEAT=33648,y.TEXTURE_2D=3553,y.TEXTURE_CUBE_MAP=34067,y.TEXTURE_BINDING_CUBE_MAP=34068,y.TEXTURE_CUBE_MAP_POSITIVE_X=34069,y.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,y.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,y.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,y.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,y.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,y.MAX_CUBE_MAP_TEXTURE_SIZE=34076,y.UNSIGNED_BYTE=5121,y.UNSIGNED_SHORT=5123,y.UNSIGNED_SHORT_4_4_4_4=32819,y.UNSIGNED_SHORT_5_5_5_1=32820,y.UNSIGNED_SHORT_5_6_5=33635,y.FLOAT=5126,y.HALF_FLOAT_OES=36193,y.HALF_FLOAT=5131,y.UNSIGNED_INT_10F_11F_11F_REV=35899,y.UNSIGNED_INT_24_8=34042,y.ALPHA=6406,y.RGB=6407,y.RGBA=6408,y.LUMINANCE=6409,y.LUMINANCE_ALPHA=6410,y.RED_INTEGER=36244,y.RGB_INTEGER=36248,y.RGBA_INTEGER=36249,y.RG_INTEGER=33320,y.RED=6403,y.R8=33321,y.R8UI=33330,y.RG8=33323,y.RG8UI=33336,y.RGB8=36758,y.RGB565=36194,y.RGB9_E5=35901,y.RGB8UI=36221,y.RGBA8=32856,y.RGB5_A1=32855,y.RGBA4=32854,y.RGBA8UI=36220,y.SRGB8_ALPHA8=35907,y.SRGB8=35905,y.R16F=33325,y.RG16F=33327,y.RGB16F=34843,y.RGBA16F=34842,y.R11F_G11F_B10F=35898,y.R32F=33326,y.RG32F=33328,y.RGB32F=34837,y.RGBA32F=34836;var x,T=((x={})[y.R8]=y.LUMINANCE,x[y.R8UI]=y.LUMINANCE,x[y.R16F]=y.LUMINANCE,x[y.R32F]=y.LUMINANCE,x[y.SRGB8]=y.LUMINANCE,x[y.RG8]=y.RGB,x[y.RG8UI]=y.RGB,x[y.RG16F]=y.RGB,x[y.RG32F]=y.RGB,x[y.RGB8]=y.RGB,x[y.RGB565]=y.RGB,x[y.RGB9_E5]=y.RGB,x[y.RGB8UI]=y.RGB,x[y.RGB5_A1]=y.RGB,x[y.RGB16F]=y.RGB,x[y.RGB32F]=y.RGB,x[y.RGBA8]=y.RGBA,x[y.R11F_G11F_B10F]=y.RGBA,x[y.RGBA16F]=y.RGBA,x[y.RGBA32F]=y.RGBA,x[y.SRGB8_ALPHA8]=y.RGBA,x),w=function(){var e={},t={},i={},n={},r={},a={};return e[y.FLOAT]=t,e[y.HALF_FLOAT]=e[y.HALF_FLOAT_OES]=i,e[y.UNSIGNED_SHORT]=n,e[y.UNSIGNED_INT]=r,e[y.UNSIGNED_INT_24_8]=a,i[y.LUMINANCE]=y.R16F,i[y.RGB]=y.RGB16F,i[y.RGBA]=y.RGBA16F,t[y.LUMINANCE]=y.R32F,t[y.RGB]=y.RGB32F,t[y.RGBA]=y.RGBA32F,n[y.DEPTH_COMPONENT]=y.DEPTH_COMPONENT16,r[y.DEPTH_COMPONENT]=y.DEPTH_COMPONENT32F,a[y.DEPTH_STENCIL]=y.DEPTH24_STENCIL8,e}();y._sTextureManager=new window.Map,y.getTextureManager=function(e){return y._sTextureManager.has(e)||y._sTextureManager.set(e,new d),y._sTextureManager.get(e)},y.getEnumFromString=function(e){var t=e;return"string"==typeof t&&(t=I(t,e)),t},r.Z.createPrototypeStateAttribute(y,r.Z.objectInherit(s.Z.prototype,r.Z.objectInherit(a.Z.prototype,{attributeType:"Texture",cloneType:function(){return new y},invalidate:function(){this._textureObject=void 0,this.dirty()},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(e){if(void 0===y.uniforms&&(y.uniforms=[]),void 0===y.uniforms[e]){var t=this.getType()+e;y.uniforms[e]={texture:o.Z.createInt1(e,t)}}return y.uniforms[e]},setDefaultParameters:function(){this._image=void 0,this._magFilter=y.LINEAR,this._minFilter=y.LINEAR,this._maxAnisotropy=1,this._wrapS=y.CLAMP_TO_EDGE,this._wrapT=y.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=y.TEXTURE_2D,this.setInternalFormatType(y.UNSIGNED_BYTE),this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=y.NONE},setColorSpaceConversion:function(e){this._colorSpaceConversion=e},setFlipY:function(e){this._flipY=e},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(e,t){var i=g.Z.instance().getWebGLParameter("MAX_TEXTURE_SIZE");e===this._textureWidth&&t===this._textureHeight||this.dirty(),void 0!==e&&(e>i?(n.Z.error("width ("+e+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureWidth=i):this._textureWidth=e),void 0!==t&&(t>i?(n.Z.error("height ("+t+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureHeight=i):this._textureHeight=t),this._textureNull=!1},init:function(e){this._gl||this.setGraphicContext(e.getGraphicContext()),this._textureObject||(this._textureObject=y.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(e){this._applyTexImage2DCallbacks.indexOf(e)<0&&this._applyTexImage2DCallbacks.push(e)},removeApplyTexImage2DCallback:function(e){var t=this._applyTexImage2DCallbacks.indexOf(e);t>=0&&this._applyTexImage2DCallbacks.splice(t,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&(y.getTextureManager(this._gl).releaseTextureObject(this._textureObject),s.Z.removeObject(this._gl,this)),this.invalidate()},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(e){this._wrapS="string"==typeof e?I(e,y.CLAMP_TO_EDGE):e,this.dirtyTextureParameters()},setWrapT:function(e){this._wrapT="string"==typeof e?I(e,y.CLAMP_TO_EDGE):e,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(e){this._maxAnisotropy=e,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(e){this._minFilter="string"==typeof e?I(e,y.LINEAR):e,this.dirtyTextureParameters()},setMagFilter:function(e){this._magFilter="string"==typeof e?I(e,y.LINEAR):e,this.dirtyTextureParameters()},setImage:function(e,t){var i=e;(e instanceof window.Image||e instanceof HTMLCanvasElement||e instanceof S||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Float32Array)&&(i=new b.Z(e)),this._image=i,this.setImageFormat(t),i&&(i.getWidth&&i.getHeight?this.setTextureSize(i.getWidth(),i.getHeight()):i.width&&i.height&&this.setTextureSize(i.width,i.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(e){var t=e;t?("string"==typeof t&&(t=y[t]),this._imageFormat=t):this._imageFormat=y.RGBA},setInternalFormatType:function(e){this._type="string"==typeof e?y[e]:e},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(e){this._unrefImageDataAfterApply=e},checkIsCompressed:function(e){switch(e||this._internalFormat){case y.COMPRESSED_RGB_S3TC_DXT1_EXT:case y.COMPRESSED_RGBA_S3TC_DXT1_EXT:case y.COMPRESSED_RGBA_S3TC_DXT3_EXT:case y.COMPRESSED_RGBA_S3TC_DXT5_EXT:case y.COMPRESSED_RGB_ATC_WEBGL:case y.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case y.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case y.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case y.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case y.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case y.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case y.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(e){var t=e;t?("string"==typeof t&&(t=y[t]),this._isCompressed=this.checkIsCompressed(t)):(this._isCompressed=!1,t=y.RGBA),this._internalFormat=t},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(e,t){if(E(this._textureWidth)&&E(this._textureHeight)||(this._wrapT=y.CLAMP_TO_EDGE,this._wrapS=y.CLAMP_TO_EDGE,this._minFilter!==y.LINEAR_MIPMAP_LINEAR&&this._minFilter!==y.LINEAR_MIPMAP_NEAREST||(this._minFilter=y.LINEAR)),e.texParameteri(t,e.TEXTURE_MAG_FILTER,this._magFilter),e.texParameteri(t,e.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&y.ANISOTROPIC_SUPPORT_EXT){var i=this._maxAnisotropy<y.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:y.ANISOTROPIC_SUPPORT_MAX;e.texParameterf(t,y.TEXTURE_MAX_ANISOTROPY_EXT,i)}e.texParameteri(t,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(t,e.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(e,t){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var i=this._image;if(i&&i.hasMipmap())for(var n=this._getInternalFormatGL(),r=i.getMipmap(),a=1,o=r.length;a<o;a++){var s=r[a];this._isCompressed?this.applyTexImage2D(e,this._textureTarget,a,n,s.getWidth(),s.getHeight(),0,s.getImage()):this.applyTexImage2D(e,this._textureTarget,a,n,s.getWidth(),s.getHeight(),0,this._internalFormat,this._type,s.getImage())}else e.generateMipmap(t)}},hasMipmapFilter:function(){return this._minFilter===y.NEAREST_MIPMAP_NEAREST||this._minFilter===y.LINEAR_MIPMAP_NEAREST||this._minFilter===y.NEAREST_MIPMAP_LINEAR||this._minFilter===y.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(e){var t=Array.prototype.slice.call(arguments,1),i=0;if(this._textureObject._texture._textureTarget===e.TEXTURE_2D&&7===t.length&&(i=t.pop()),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),i){var n=this._textureObject._id;C(e,i,t,this._isCompressed,n,this._flipY)}else e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this._flipY),this._isCompressed?e.compressedTexImage2D.apply(e,t):e.texImage2D.apply(e,t);var r=this._applyTexImage2DCallbacks.length;if(r>0)for(var a=0,o=r;a<o;a++)this._applyTexImage2DCallbacks[a].call(this)},computeTextureFormat:function(){this._internalFormat||(this._internalFormat=this._imageFormat||y.RGBA),this._imageFormat=this._internalFormat},applyImage:function(e){var t=this._getInternalFormatGL(),i=this._image||null,n=i&&i.getImage(),r=this._getTypeGL();this._isCompressed?this.applyTexImage2D(e,this._textureTarget,0,t,this._textureWidth,this._textureHeight,0,n):!n||i.isTypedArray()?this.applyTexImage2D(e,this._textureTarget,0,t,this._textureWidth,this._textureHeight,0,this._internalFormat,r,n):this.applyTexImage2D(e,this._textureTarget,0,t,this._internalFormat,r,n,i.pk),i&&i.setDirty(!1)},apply:function(e){var t=e.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1,this.setGraphicContext(t)),void 0===this._textureObject||this.isDirty())if(this._textureNull)t.bindTexture(this._textureTarget,null);else{var i=this._image;if(void 0!==i)if(i.isReady()){this.computeTextureFormat();var n=i.getWidth()||this._textureWidth,r=i.getHeight()||this._textureHeight;this.setTextureSize(n,r),this._textureObject||this.init(e),this._textureObject.bind(t),this.applyImage(t),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else t.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(e),this._textureObject.bind(t),this.applyImage(t),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(t),void 0!==this._image&&this._image.isDirty()&&(this.applyImage(t),this.dirtyMipmap()),this.isDirtyMipmap()&&this.generateMipmap(t,this._textureTarget)},_getInternalFormatGL:function(){var e=this._internalFormat;if(!g.Z.instance().isWebGL2())return T[e]||e;var t=w[this._type];return t&&t[e]||e},_getTypeGL:function(){return this._type!==y.HALF_FLOAT||g.Z.instance().isWebGL2()?this._type:y.HALF_FLOAT_OES}})),"osg","Texture"),y.textureNull=new y,y.createFromImage=function(e,t){var i=new y;return i.setImage(e,t),i},y.createFromCanvas=function(e,t){return y.createFromImage(e,t)};const M=y},"83E6":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=function(){var e=window||global;if(void 0===e.performance)return function(){return Date.now()};var t=e.performance.now||e.performance.mozNow||e.performance.msNow||e.performance.oNow||e.performance.webkitNow||function(){return Date.now()};return function(){return t.apply(e.performance,arguments)}}(),r=function(){};r.instance=function(){return r._instance||(r._instance=new r),r._instance},r.tick=n,r.prototype={deltaS:function(e,t){return(t-e)/1e3},deltaM:function(e,t){return t-e},tick:function(){return n()}};const a=r},sh3Z:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("Hfbx"),r=i("EMUO"),a=function(e){this._enabled=!1,this.reset(e)};a.FRAME_COUNT=0,a.instance=function(e,t){return a._instance?e&&(a._instance.getContext()!==e||t)&&(a._instance.setContext(e),a._instance.reset(e)):a._instance=new a(e),a._instance},a.prototype={reset:function(e){if(e){var t=r.Z.instance(e).getDisjointTimerQuery();if(!t)return this;if(e.getQueryParameter||(e.getQueryParameter=t.getQueryObjectEXT.bind(t)),this._hasTimeElapsed=e.getQuery(t.TIME_ELAPSED_EXT,t.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=e.getQuery(t.TIMESTAMP_EXT,t.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||n.Z.debug("Warning: do not use interleaved GPU query"),this._ext=t,this._gl=e,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0},getContext:function(){return this._gl},setContext:function(e){this._gl=e},setFrameAverageCount:function(e){this._frameAverageCount=e},clearQueries:function(){for(var e=this._glQueries,t=0,i=e.length;t<i;++t){var n=e[t];this._gl.deleteQuery(n._pollingStartQuery),n._pollingEndQuery&&this._gl.deleteQuery(n)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:function(){this._enabled=!!this._ext},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(e){this._callback=e},createUserQuery:function(e){var t;return(t=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0})._id=e,t._frame=a.FRAME_COUNT,t._isOpened=!0,t._siblings=[],t},createGLQuery:function(){var e={_isWaiting:!1,_pollingStartQuery:void 0,_pollingEndQuery:void 0,_averageTimer:0,_resultCount:0};return this._hasTimeStamp&&(e._pollingEndQuery=this._gl.createQuery()),e._pollingStartQuery=this._gl.createQuery(),this._glQueries.push(e),e},getOrCreateLastGLQuery:function(){var e=this._glQueries[this._queryCount-1];return e||(e=this._glQueries[this._queryCount-1]=this.createGLQuery())},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var e=this.getOrCreateLastGLQuery();e._isWaiting||this._gl.beginQuery(this._ext.TIME_ELAPSED_EXT,e._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._gl.endQuery(this._ext.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(e){var t=this._queriesByID[e];if(!t)return t=this._queriesByID[e]=this.createUserQuery(e),this._userQueries.push(t),t;if(t._frame===a.FRAME_COUNT){if(t._isOpened)return t;for(var i=t._siblings,n=0,r=i.length;n<r;++n){var o=i[n];if(o._frame!==a.FRAME_COUNT||o._isOpened)return o._frame=a.FRAME_COUNT,o}var s=this.createUserQuery();return i.push(s),s}return t._frame=a.FRAME_COUNT,t},start:function(e){if(this._enabled){var t=this.getAvailableQueryByID(e);t._isOpened=!0,this._hasTimeStamp?t._isWaiting||this._ext.queryCounterEXT(t._pollingStartQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,t._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(e){if(this._enabled){var t=this.getAvailableQueryByID(e);t._isOpened=!1,this._hasTimeStamp?t._isWaiting||this._ext.queryCounterEXT(t._pollingEndQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),t._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(e){for(var t=0,i=this._glQueries,n=e._startIndex;n<e._endIndex;++n){var r=i[n]._averageTimer;if(r<0)return-1;t+=r}return t},computeFullAverageTime:function(e){var t=this.computeQueryAverageTime(e);if(t<0)return-1;for(var i=e._siblings,n=0,r=i.length;n<r;++n){var o=i[n];if(o._frame===a.FRAME_COUNT-1){var s=this.computeQueryAverageTime(o);if(s<0)return-1;t+=s}}return t},pollQueries:function(){if(a.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var e,t=this._glQueries,i=t.length;if(this._gl.getParameter(this._ext.GPU_DISJOINT_EXT))for(e=0;e<i;++e)t[e]._isWaiting=!1;else{for(e=0;e<i;++e)this.pollQuery(t[e]);var n=this._userQueries,r=n.length;for(e=0;e<r;++e){var o=n[e],s=this.computeFullAverageTime(o);s>0&&this._callback(s,o._id)}}}},pollQuery:function(e){e._isWaiting=!1;var t,i=this._hasTimeStamp?e._pollingEndQuery:e._pollingStartQuery;if(!this._gl.getQueryParameter(i,this._gl.QUERY_RESULT_AVAILABLE))return e._isWaiting=!0,0;if(this._hasTimeStamp){var n=this._gl.getQueryParameter(e._pollingStartQuery,this._gl.QUERY_RESULT);t=this._gl.getQueryParameter(i,this._gl.QUERY_RESULT)-n}else t=this._gl.getQueryParameter(i,this._gl.QUERY_RESULT);return e._resultCount++,e._resultCount>this._frameAverageCount&&(e._averageTimer=0,e._resultCount=1),e._averageTimer=e._averageTimer+(t-e._averageTimer)/e._resultCount,e._averageTimer}};const o=a},Heae:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n,r=i("0rAA"),a=i("FJW6"),o=i("Xbee"),s=i("a72h"),l=function(){a.Z.call(this),this.referenceFrame=s.Z.RELATIVE_RF};r.Z.createPrototypeNode(l,r.Z.objectInherit(a.Z.prototype,{setReferenceFrame:function(e){this.referenceFrame=e},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:(n=o._E.create(),function(e){return a.Z.prototype.computeBoundingSphere.call(this,e),e.valid()?(o._E.identity(n),this.computeLocalToWorldMatrix(n),e.transformMat4(e,n),e):e})}),"osg","Transform");const u=l},LZhK:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("Hfbx"),r=function(e){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=e,this._type=void 0,this._isMatrix=!1};r.isUniform=function(e){return"object"==typeof e&&window.Object.getPrototypeOf(e)===r.prototype},(r.prototype={getName:function(){return this._name},getType:function(){return this._type},apply:function(e,t){this._cache||(this._cache=e[this._glCall]),this._isMatrix?this._cache.call(e,t,this._transpose,this._data):this._cache.call(e,t,this._data)},setInternalArray:function(e){n.Z.warn("setInternalArray deprecated, please use getInternalArray instead: "+e.length),this._data=e},getInternalArray:function(){return this._data},setFloat:function(e){this._data[0]=e},setFloat1:function(e){this._data[0]=e[0]},setFloat2:function(e){this._data[0]=e[0],this._data[1]=e[1]},setFloat3:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]},setFloat4:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2],this._data[3]=e[3]},setFloat9:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2],this._data[3]=e[3],this._data[4]=e[4],this._data[5]=e[5],this._data[6]=e[6],this._data[7]=e[7],this._data[8]=e[8]},setFloat16:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2],this._data[3]=e[3],this._data[4]=e[4],this._data[5]=e[5],this._data[6]=e[6],this._data[7]=e[7],this._data[8]=e[8],this._data[9]=e[9],this._data[10]=e[10],this._data[11]=e[11],this._data[12]=e[12],this._data[13]=e[13],this._data[14]=e[14],this._data[15]=e[15]}}).setVec2=r.prototype.setFloat2,r.prototype.setVec3=r.prototype.setFloat3,r.prototype.setVec4=r.prototype.setFloat4,r.prototype.setMatrix4=r.prototype.setFloat16,r.prototype.setMatrix3=r.prototype.setFloat9,r.prototype.setInt=r.prototype.setFloat,r.prototype.setInt1=r.prototype.setFloat1,r.prototype.setInt2=r.prototype.setFloat2,r.prototype.setInt3=r.prototype.setFloat3,r.prototype.setInt4=r.prototype.setFloat4;var a=function(e,t,i,n,a,o){var s=t&&t.length?e:void 0,l=new r(void 0!==s?t:e);if(l._data=i,void 0!==s)if(s.length)for(var u=0,h=s.length;u<h;++u)l._data[u]=s[u];else l._data[0]=s;return l._glCall=n,l._type=a,l._isMatrix=!!o,l},o=function(e,t,i){return i&&!i.length?i:"string"!=typeof t?(t.length||1)/e:1};r.createFloat1=function(e,t){return a(e,t,new Float32Array(1*o(1,e,t)),"uniform1fv","float")},r.createFloat2=function(e,t){return a(e,t,new Float32Array(2*o(2,e,t)),"uniform2fv","vec2")},r.createFloat3=function(e,t){return a(e,t,new Float32Array(3*o(3,e,t)),"uniform3fv","vec3")},r.createFloat4=function(e,t){return a(e,t,new Float32Array(4*o(4,e,t)),"uniform4fv","vec4")},r.createInt1=function(e,t){return a(e,t,new Int32Array(1*o(1,e,t)),"uniform1iv","int")},r.createInt2=function(e,t){return a(e,t,new Int32Array(2*o(2,e,t)),"uniform2iv","vec2i")},r.createInt3=function(e,t){return a(e,t,new Int32Array(3*o(3,e,t)),"uniform3iv","vec3i")},r.createInt4=function(e,t){return a(e,t,new Int32Array(4*o(4,e,t)),"uniform4iv","vec4i")},r.createMatrix2=function(e,t){return a(e,t,function(e){for(var t=new Float32Array(4*e),i=0;i<t.length;i+=4)t[i]=t[i+3]=1;return t}(o(4,e,t)),"uniformMatrix2fv","mat2",!0)},r.createMatrix3=function(e,t){return a(e,t,function(e){for(var t=new Float32Array(9*e),i=0;i<t.length;i+=9)t[i]=t[i+4]=t[i+8]=1;return t}(o(9,e,t)),"uniformMatrix3fv","mat3",!0)},r.createMatrix4=function(e,t){return a(e,t,function(e){for(var t=new Float32Array(16*e),i=0;i<t.length;i+=16)t[i]=t[i+5]=t[i+10]=t[i+15]=1;return t}(o(16,e,t)),"uniformMatrix4fv","mat4",!0)},r.float=r.createFloatArray=r.createFloat=r.createFloat1,r.vec2=r.createFloat2Array=r.createFloat2,r.vec3=r.createFloat3Array=r.createFloat3,r.vec4=r.createFloat4Array=r.createFloat4,r.int=r.createIntArray=r.createInt=r.createInt1,r.vec2i=r.createInt2Array=r.createInt2,r.vec3i=r.createInt3Array=r.createInt3,r.vec4i=r.createInt4Array=r.createInt4,r.mat2=r.createMat2Array=r.createMat2=r.createMatrix2,r.mat3=r.createMat3Array=r.createMat3=r.createMatrix3,r.mat4=r.createMat4Array=r.createMat4=r.createMatrix4;const s=r},nRps:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("0rAA"),r=i("2bAw"),a=function(){r.Z.call(this),this.visitorType=r.Z.UPDATE_VISITOR,this._numUpdateCallback=0};n.Z.createPrototypeObject(a,n.Z.objectInherit(r.Z.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(e){var t=e.getStateSet();if(t&&t.requiresUpdateTraversal()){var i=t.getUpdateCallbackList(),n=i.length;if(n){this._numUpdateCallback+=n;for(var r=0,a=n;r<a;r++)i[r].update(t,this)}}for(var o=e.getUpdateCallbackList(),s=o.length,l=0;l<s;l++)if(this._numUpdateCallback++,!o[l].update(e,this))return;e.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(e)}}),"osg","NodeVisitor");const o=a},"8dss":(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("0rAA"),r=i("vrBm"),a=i("QuvP"),o=i("83E6"),s=function(){a.Z.call(this),this._instanceID=r.Z.getInstanceID(),this._vaoObject=void 0,this.dirty()};s._sDeletedGLVertexArrayObjectCache=new window.Map,s.deleteGLVertexArrayObject=function(e,t){s._sDeletedGLVertexArrayObjectCache.has(e)||s._sDeletedGLVertexArrayObjectCache.set(e,[]),s._sDeletedGLVertexArrayObjectCache.get(e).push(t)},s.flushDeletedGLVertexArrayObjects=function(e,t){if(t<=0)return t;if(!s._sDeletedGLVertexArrayObjectCache.has(e))return t;for(var i=0,n=o.Z.instance().tick(),r=s._sDeletedGLVertexArrayObjectCache.get(e),a=r.length-1;a>=0&&i<t;a--)e.deleteVertexArray(r[a]),r.splice(a,1),i=o.Z.instance().deltaS(n,o.Z.instance().tick());return t-i},s.flushAllDeletedGLVertexArrayObjects=function(e){if(s._sDeletedGLVertexArrayObjectCache.has(e))for(var t=s._sDeletedGLVertexArrayObjectCache.get(e),i=t.length-1;i>=0;i--)e.deleteVertexArray(t[i]),t.splice(i,1)},s.onLostContext=function(e){s._sDeletedGLVertexArrayObjectCache.has(e)&&(s._sDeletedGLVertexArrayObjectCache.get(e).length=0)},n.Z.createPrototypeObject(s,n.Z.objectInherit(a.Z.prototype,{getInstanceID:function(){return this._instanceID},invalidate:function(){this._vaoObject=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._vaoObject&&void 0!==this._gl&&(s.deleteGLVertexArrayObject(this._gl,this._vaoObject),a.Z.removeObject(this._gl,this)),this.invalidate()},create:function(e){this._vaoObject=e.createVertexArray(),this._dirty=!1},bind:function(e){this._gl||this.setGraphicContext(e),this._vaoObject&&e.bindVertexArray(this._vaoObject)},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}}),"osg","VertexArrayObject");const l=s},"2Uq9":(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n,r,a,o=i("0rAA"),s=i("QrwD"),l=i("Xbee"),u=function(e,t,i,n){s.Z.call(this),this._x=void 0!==e?e:0,this._y=void 0!==t?t:0,this._width=void 0!==i?i:800,this._height=void 0!==n?n:600};o.Z.createPrototypeStateAttribute(u,o.Z.objectInherit(s.Z.prototype,{attributeType:"Viewport",cloneType:function(){return new u},setViewport:function(e,t,i,n){this._x=e,this._y=t,this._width=i,this._height=n},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:(n=l._E.create(),r=l._E.create(),a=l.R3.create(),function(e){l._E.fromTranslation(n,l.R3.ONE),l._E.fromScaling(r,[.5*this._width,.5*this._height,.5]);var t=l._E.fromTranslation(e,l.R3.set(a,this._x,this._y,0));return l._E.mul(t,t,l._E.mul(r,r,n))}),apply:function(e){e.applyViewport(this)}}),"osg","Viewport");const h=u},EMUO:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n,r=i("Hfbx"),a=i("pZnz"),o=i("wm32"),s=i("5Cxy"),l=function(){n||(n=i("FCEq").Z),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};l.instance=function(e,t){if(!l._instance){var i,n=e;if(!n){"undefined"!=typeof window&&window.gli&&(i=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var s=document.createElement("canvas");s.width=32,s.height=32;var u=new o.Z;u.extend({antialias:!1}),u.extendWithOptionsURL(),n=a.Z.setupWebGL(s,u,(function(){})),this._webglTemporary=n}l._instance=new l,n?l._instance.init(n):r.Z.warn("no support for webgl context detected."),i&&(window.gli.host.inspectContext=i)}if(e){if(this._webglTemporary&&this._webglTemporary!==e){var h=n&&n.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._webglTemporary=null}(t||e!==this._webglTemporary)&&(l._instance.initContextDependant(e),this._webglTemporary=e)}return l._instance},l.prototype={getContext:function(){return this._gl},initContextDependant:function(e){this._gl=e,this._isGL2=void 0!==window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext,this.initWebGLExtensions(e),(0,s.Z)().webglUniforms&&(this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=64),this.hasLinearHalfFloatRTT(e),this.hasLinearFloatRTT(e),this.hasHalfFloatRTT(e),this.hasFloatRTT(e)},init:function(e){if(this.initWebGLParameters(e),this.initPlatformSupport(),this.initBugDB(e),this.initContextDependant(e),this._isGL2)for(var t=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float_linear","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],i=l._instance.getWebGLExtensions(),n=function(){},r=0,a=t.length;r<a;r++)i[t[r]]=n},isWebGL2:function(){return this._isGL2},initBugDB:function(e){var t=this._webGLPlatforms,i=this._webGLParameters;if(t.Apple&&(i.UNMASKED_VENDOR_WEBGL&&-1===i.UNMASKED_VENDOR_WEBGL.indexOf("Intel")||(this._bugsDB.OES_standard_derivatives=!0)),e.getExtension("EXT_shader_texture_lod")){var n={type:"FRAGMENT_SHADER",text:["#version 100","#extension GL_EXT_shader_texture_lod : require","#ifdef GL_FRAGMENT_PRECISION_HIGH","  precision highp float;","#else"," precision mediump float;","#endif","uniform samplerCube uT0;","varying vec3 vC;","void main(void) {","  gl_FragColor = textureCubeLodEXT(uT0, vC, 1.0);","}"].join("\n")};this.checkShader(e,n.type,n.text)||(this._bugsDB.EXT_shader_texture_lod=!0)}},checkShader:function(e,t,i){var n=t;"string"==typeof n&&(n=e[t]);var a=e.createShader(n);return e.shaderSource(a,i),e.compileShader(a),!(!e.getShaderParameter(a,e.COMPILE_STATUS)&&!e.isContextLost())||(r.Z.warn(e.getShaderInfoLog(a)),!1)},initPlatformSupport:function(){var e=this._webGLPlatforms;e.Apple=-1!==navigator.vendor.indexOf("Apple")||-1!==navigator.vendor.indexOf("OS X"),e.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(e){return this._webGLPlatforms[e]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(e){return this._webGLParameters[e]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(e,t,i){var r=t+","+i;if(void 0!==this._checkRTT[r])return this._checkRTT[r];if(!e)return!1;switch((0,s.Z)().webglRenderTexture){case"none":return!1;case"float":if(t===n.FLOAT&&i===n.LINEAR)return!1;break;case"half_float":if(t===n.FLOAT)return!1;if(i===n.LINEAR)return!1;break;case"half_float_linear":if(t===n.FLOAT)return!1}var a=e.RGBA,o=a;if(this._isGL2){if(t===n.FLOAT&&(o=e.RGBA32F,i!==n.LINEAR))return this._webGLExtensions.EXT_color_buffer_float;if(t===n.HALF_FLOAT_OES&&(o=e.RGBA16F,i!==n.LINEAR))return this._webGLExtensions.EXT_color_buffer_half_float}var l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,o,5,5,0,a,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i);var u=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l,0);var h=this._checkRTT[r]=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;if(h){e.clearColor(1,0,0,1),e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT);var c=new Float32Array(104);e.flush(),e.finish(),e.readPixels(0,0,5,5,e.RGBA,e.FLOAT,c),h=1===c[0]}return e.deleteTexture(l),e.deleteFramebuffer(u),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),h},hasLinearHalfFloatRTT:function(e){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(e,n.HALF_FLOAT_OES,n.LINEAR)},hasLinearFloatRTT:function(e){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(e,n.FLOAT,n.LINEAR)},hasHalfFloatRTT:function(e){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(e,n.HALF_FLOAT_OES,n.NEAREST)},hasFloatRTT:function(e){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(e,n.FLOAT,n.NEAREST)},queryPrecision:function(e,t,i){var n=e.getShaderPrecisionFormat(t,i);return!!n&&0!==n.precision},hasVAO:function(){return!!this._webGLExtensions.OES_vertex_array_object},getDisjointTimerQuery:function(){return this._webGLExtensions.EXT_disjoint_timer_query_webgl2||this._webGLExtensions.EXT_disjoint_timer_query},initWebGLParameters:function(e){if(e){for(var t=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],i=this._webGLParameters,n=0,r=t.length;n<r;++n){var a=t[n];i[a]=e.getParameter(e[a])}this.queryPrecision(e,e.FRAGMENT_SHADER,e.HIGH_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(e,e.FRAGMENT_SHADER,e.MEDIUM_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(e,e.FRAGMENT_SHADER,e.LOW_FLOAT)&&(i.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(e,e.FRAGMENT_SHADER,e.HIGH_INT)?i.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(e,e.FRAGMENT_SHADER,e.MEDIUM_INT)?i.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(e,e.FRAGMENT_SHADER,e.LOW_INT)&&(i.MAX_SHADER_PRECISION_INT="low");var o=e.getExtension("WEBGL_debug_renderer_info");o&&(i.UNMASKED_RENDERER_WEBGL=e.getParameter(o.UNMASKED_RENDERER_WEBGL),i.UNMASKED_VENDOR_WEBGL=e.getParameter(o.UNMASKED_VENDOR_WEBGL))}},applyExtension:function(e,t){var i=e.getExtension(t),n=t.split("_")[0],r="_"+n,a=new RegExp(n+"$"),o=new RegExp(r);for(var s in i){if("function"==typeof i[s]){var l=s.replace(a,"");void 0===e[l]&&(e[l]=i[s].bind(i))}else{var u=s.replace(o,"");void 0===e[u]&&(e[u]=i[s])}}},getWebGLExtension:function(e){return this._webGLExtensions[e]},getWebGLExtensions:function(){return this._webGLExtensions},_checkShader:function(e,t,i){var n=t;"string"==typeof n&&(n=e[t]);var r=e.createShader(n);return e.shaderSource(r,i),e.compileShader(r),!(!e.getShaderParameter(r,e.COMPILE_STATUS)&&!e.isContextLost())},_doubleCheckExtension:function(e,t){var i=["#version 100","#extension GL_%ext% : require","precision mediump float;","varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"].join("\n");return this._checkShader(e,"FRAGMENT_SHADER",i.replace(/\%ext\%/g,t))},initWebGLExtensions:function(e,t){if(e){var i=t;if(void 0===i&&(i=!0),(0,s.Z)().webglExt){var r=e.getSupportedExtensions();if(r){for(var a=this._webGLExtensions,o=0,l=r.length;o<l;++o){var u=r[o];i&&this._bugsDB[u]||(a[u]=e.getExtension(u),this._isGL2||this.applyExtension(e,u))}if(!this._isGL2){var h="EXT_shader_texture_lod";a[h]&&!this._doubleCheckExtension(e,h)&&delete a[h]}var c=this.getWebGLExtension("EXT_texture_filter_anisotropic");c&&(n.ANISOTROPIC_SUPPORT_EXT=!0,n.ANISOTROPIC_SUPPORT_MAX=e.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}else this._webGLExtensions={}}}};const u=l},z6Oe:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("Xbee"),r=i("a72h");const a={computeLocalToWorld:function(e,t,i,a){var o=t,s=void 0!==a?a:e.length;void 0===o&&(o=!0);var l=i||n._E.create(),u=0;if(o){for(u=s-1;u>=0;u--){var h=e[u];if("Camera"===h.className()&&(h.getReferenceFrame()!==r.Z.RELATIVE_RF||0===h.getParents().length))break}u+=1}for(var c=u,A=s;c<A;c++){var d=e[c];d.computeLocalToWorldMatrix&&d.computeLocalToWorldMatrix(l)}return l}}},q8o9:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=[];const r={applyFunctionArray:n,registerApplyFunction:function(e,t){n[e]=t},getApplyFunction:function(e){return n[e]}}},Xbee:(e,t,i)=>{"use strict";i.d(t,{sh:()=>r,wO:()=>S,_E:()=>b,gf:()=>E,K4:()=>_,R3:()=>v,vh:()=>C});var n=i("OEJe"),r=i("F9s5");const a={ArrayType:Float64Array};r.glMatrix.setMatrixArrayType(a.ArrayType),r.glMatrix.EPSILON=1e-9;var o,s,l,u,h,c,A,d,g,f,p,m,_=r.vec2,v=r.vec3,C=r.vec4,b=r.mat4,S=r.mat3,E=r.quat;v.create32=function(){return new Float32Array(3)},v.create64=function(){return new Float64Array(3)},v.fromValues32=function(e,t,i){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=i,n},v.fromValues64=function(e,t,i){var n=new Float64Array(3);return n[0]=e,n[1]=t,n[2]=i,n},v.init=function(e){return v.set(e,0,0,0)},v.transformMat4Rotate=function(e,t,i){var n=t[0],r=t[1],a=t[2];return e[0]=i[0]*n+i[1]*r+i[2]*a,e[1]=i[4]*n+i[5]*r+i[6]*a,e[2]=i[8]*n+i[9]*r+i[10]*a,e},v.valid=function(e){return!n.Z.isNaN(e[0])&&(!n.Z.isNaN(e[1])&&!n.Z.isNaN(e[2]))},v.neg=v.negate,v.ZERO=v.create(),v.ONE=v.fromValues(1,1,1),v.INFINITY=v.fromValues(1/0,1/0,1/0),v.NEGATIVE_INFINITY=v.fromValues(-1/0,-1/0,-1/0),_.create32=function(){return new Float32Array(2)},_.create64=function(){return new Float64Array(2)},_.fromValues32=function(e,t){var i=new Float32Array(2);return i[0]=e,i[1]=t,i},_.fromValues64=function(e,t){var i=new Float64Array(2);return i[0]=e,i[1]=t,i},_.init=function(e){return _.set(e,0,0)},_.valid=function(e){return!n.Z.isNaN(e[0])&&!n.Z.isNaN(e[1])},_.ZERO=_.create(),_.ONE=_.fromValues(1,1),_.INFINITY=_.fromValues(1/0,1/0),_.NEGATIVE_INFINITY=_.fromValues(-1/0,-1/0),C.create32=function(){return new Float32Array(4)},C.create64=function(){return new Float64Array(4)},C.fromValues32=function(e,t,i,n){var r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},C.fromValues64=function(e,t,i,n){var r=new Float64Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},C.init=function(e){return C.set(e,0,0,0,0)},C.valid=function(e){return!n.Z.isNaN(e[0])&&(!n.Z.isNaN(e[1])&&(!n.Z.isNaN(e[2])&&!n.Z.isNaN(e[3])))},C.neg=C.negate,C.ZERO=C.create(),C.ONE=C.fromValues(1,1,1,1),C.INFINITY=C.fromValues(1/0,1/0,1/0,1/0),C.NEGATIVE_INFINITY=C.fromValues(-1/0,-1/0,-1/0,-1/0),E.IDENTITY=E.create(),E.zeroRotation=function(e){return 0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]},E.create32=function(){var e=new Float32Array(4);return e[3]=1,e},E.create64=function(){var e=new Float64Array(4);return e[3]=1,e},E.fromValues32=C.fromValues32,E.fromValues64=C.fromValues64,E.init=E.identity,E.nlerp=function(e,t,i,n){var r,a,o,s,l=t[0],u=t[1],h=t[2],c=t[3],A=i[0],d=i[1],g=i[2],f=i[3],p=1-n;l*A+u*d+h*g+c*f<0?(r=l*p-A*n,a=u*p-d*n,o=h*p-g*n,s=c*p-f*n):(r=l*p+A*n,a=u*p+d*n,o=h*p+g*n,s=c*p+f*n);var m=1/Math.sqrt(r*r+a*a+o*o+s*s);return e[0]=r*m,e[1]=a*m,e[2]=o*m,e[3]=s*m,e},S.IDENTITY=S.create(),S.create32=function(){var e=new Float32Array(9);return e[0]=e[4]=e[8]=1,e},S.create64=function(){var e=new Float64Array(9);return e[0]=e[4]=e[8]=1,e},b.IDENTITY=b.create(),b.create32=function(){var e=new Float32Array(16);return e[0]=e[5]=e[10]=e[15]=1,e},b.create64=function(){var e=new Float64Array(16);return e[0]=e[5]=e[10]=e[15]=1,e},b.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},b.getFrustum=function(e,t){var i,n,r,a,o,s;if(0!==t[3]||0!==t[7]||-1!==t[11]||0!==t[15])return!1;var l=t[14]/(t[10]-1),u=t[14]/(1+t[10]);return n=l*(t[8]-1)/t[0],i=l*(1+t[8])/t[0],r=l*(1+t[9])/t[5],a=l*(t[9]-1)/t[5],o=l,s=u,e.left=n,e.right=i,e.top=r,e.bottom=a,e.zNear=o,e.zFar=s,!0},b.getPerspective=(o={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0},function(e,t){return b.getFrustum(o,t)&&(e.fovy=180/Math.PI*(Math.atan(o.top/o.zNear)-Math.atan(o.bottom/o.zNear)),e.aspectRatio=(o.right-o.left)/(o.top-o.bottom)),e.zNear=o.zNear,e.zFar=o.zFar,e}),b.getLookAt=(s=b.create(),l=v.create(),u=v.fromValues(0,1,0),h=v.fromValues(0,0,-1),function(e,t,i,n,r){var a=void 0!==r?r:1;b.invert(s,n),b.getTranslation(e,s),v.transformMat4Rotate(i,u,n),v.transformMat4Rotate(t,h,n),v.normalize(t,t),v.add(t,v.scale(l,t,a),e)}),b.getFrustumPlanes=(c=b.create(),function(e,t,i,n){b.mul(c,t,i);var r=!!n,a=e[0];a[0]=c[3]-c[0],a[1]=c[7]-c[4],a[2]=c[11]-c[8],a[3]=c[15]-c[12];var o=e[1];o[0]=c[3]+c[0],o[1]=c[7]+c[4],o[2]=c[11]+c[8],o[3]=c[15]+c[12];var s=e[2];s[0]=c[3]+c[1],s[1]=c[7]+c[5],s[2]=c[11]+c[9],s[3]=c[15]+c[13];var l=e[3];l[0]=c[3]-c[1],l[1]=c[7]-c[5],l[2]=c[11]-c[9],l[3]=c[15]-c[13];var u=4;if(r){u=6;var h=e[4];h[0]=c[3]-c[2],h[1]=c[7]-c[6],h[2]=c[11]-c[10],h[3]=c[15]-c[14];var A=e[5];A[0]=c[3]+c[2],A[1]=c[7]+c[6],A[2]=c[11]+c[10],A[3]=c[15]+c[14]}for(var d=0;d<u;d++){var g=e[d],f=1/Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);g[0]*=f,g[1]*=f,g[2]*=f,g[3]*=f}}),b.infiniteFrustum=function(e,t,i,n,r,a){var o=2*a/(i-t),s=2*a/(r-n),l=(i+t)/(i-t),u=(r+n)/(r-n);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=l,e[9]=u,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=-2*a,e[15]=0,e},b.lookAtDirection=(A=v.create(),d=v.create(),g=v.create(),function(e,t,i,n){var r=i;return v.cross(A,r,n),v.normalize(A,A),v.cross(d,A,r),v.normalize(d,d),e[0]=A[0],e[1]=d[0],e[2]=-r[0],e[3]=0,e[4]=A[1],e[5]=d[1],e[6]=-r[1],e[7]=0,e[8]=A[2],e[9]=d[2],e[10]=-r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,b.translate(e,e,v.neg(g,t))}),b.getScale=(f=v.create(),p=v.create(),m=v.create(),function(e,t){return f[0]=t[0],f[1]=t[4],f[2]=t[8],p[0]=t[1],p[1]=t[5],p[2]=t[9],m[0]=t[2],m[1]=t[6],m[2]=t[10],e[0]=v.length(f),e[1]=v.length(p),e[2]=v.length(m),e}),b.getSqrScale=function(){var e=v.create(),t=v.create(),i=v.create();return function(n,r){return e[0]=r[0],e[1]=r[4],e[2]=r[8],t[0]=r[1],t[1]=r[5],t[2]=r[9],i[0]=r[2],i[1]=r[6],i[2]=r[10],n[0]=v.sqrLen(e),n[1]=v.sqrLen(t),n[2]=v.sqrLen(i),n}}();var y=b.rotate;b.rotate=function(e,t,i,n){return y(e,t,i,n)||b.identity(e)};var I=b.fromRotation;b.fromRotation=function(e,t,i){return I(e,t,i)||b.identity(e)}},OEJe:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={clamp:function(e,t,i){return Math.min(i,Math.max(t,e))},smoothStep:function(e,t,i){if(i<=e)return 0;if(i>=t)return 1;var n=(i-e)/(t-e);return n*n*(3-2*n)},isNaN:function(e){return e!=e}}},Hfbx:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n={};function r(){var e=arguments[0];if(n.console&&!(e>n.currentNotifyLevel)){var t=arguments[1],i=Array.prototype.slice.call(arguments);i=i.splice(2,arguments.length),n.console[t].apply(n.console,i),n.traceLogCall&&e!==n.ERROR&&console.trace()}}function a(e,t,i,r){!n.console||e>n.currentNotifyLevel||(n.console.groupCollapsed&&n.console.groupCollapsed(i),n.console[t](r),n.traceLogCall&&e!==n.ERROR&&console.trace(),n.console.groupEnd&&n.console.groupEnd())}function o(e,t){return t?[e.slice(0,4),e.slice(4,8),e.slice(8,12),e.slice(12,16)]:[[e[0],e[4],e[8],e[12]],[e[1],e[5],e[9],e[13]],[e[2],e[6],e[10],e[14]],[e[3],e[7],e[11],e[15]]]}function s(e,t,i){e>n.currentNotifyLevel||n.console.table&&r("table",o(t,i))}function l(e,t,i,r){e>n.currentNotifyLevel||n.console.table&&a("table",t,o(i,r))}n.ALWAYS=0,n.FATAL=n.ERROR=1,n.WARN=2,n.NOTICE=n.LOG=3,n.INFO=4,n.DEBUG=5,n.currentNotifyLevel=n.LOG,n.console=window.console;for(var u=["error","warn","log","info","debug"],h=0;h<u.length;++h){var c=u[h],A=n[c.toUpperCase()];n[c]=r.bind(n,A,c),n[c+"Fold"]=a.bind(n,A,c),n[c+"Matrix"]=s.bind(n,A),n[c+"MatrixFold"]=l.bind(n,A)}n.group=r.bind(n,n.LOG,"group"),n.groupCollapsed=r.bind(n,n.LOG,"groupCollapsed"),n.groupEnd=n.console.groupEnd,n.notice=n.log,n.noticeFold=n.logFold,n.noticeMatrix=n.logMatrix,n.noticeMatrixFold=n.logMatrixFold,n.timeStamp=function(){},n.assert=function(e,t){void 0===this.console||e||this.console.assert(e,t)},n.setNotifyLevel=function(e,t){n.currentNotifyLevel=e,void 0!==t&&(n.traceLogCall=t)},n.getNotifyLevel=function(){return n.currentNotifyLevel},n.reportWebGLError=!1,n.setConsole=function(e){n.console=e},window.getElementsById=function(e){n.setConsole(e)};const d=n},zyQd:(e,t,i)=>{"use strict";i.d(t,{Z:()=>nt});var n=i("/fpc"),r=i("0rAA"),a=i("QrwD"),o=function(){a.Z.call(this),this._attributeEnable=!1};r.Z.createPrototypeStateAttribute(o,r.Z.objectInherit(a.Z.prototype,{attributeType:"Billboard",cloneType:function(){return new o},setEnabled:function(e){this._attributeEnable=e},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard");const s=o;var l=i("Xbee"),u=function(e){a.Z.call(this),this._constantColor=l.vh.create(),l.vh.set(this._constantColor,1,1,1,1),void 0!==e&&this.setConstantColor(e)};r.Z.createPrototypeStateAttribute(u,r.Z.objectInherit(a.Z.prototype,{attributeType:"BlendColor",cloneType:function(){return new u},setConstantColor:function(e){l.vh.copy(this._constantColor,e)},getConstantColor:function(){return this._constantColor},apply:function(e){e.getGraphicContext().blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor");const h=u;var c=i("zI6W"),A=i("Ko9s"),d=i("EGrC"),g=i("LERn"),f=i("JWq/"),p=i("OYOS"),m=function(e,t,i,n){a.Z.call(this),this._red=!0,this._green=!0,this._blue=!0,this._alpha=!0,void 0!==e&&void 0!==t&&void 0!==i&&this.setMask(e,t,i,n)};r.Z.createPrototypeStateAttribute(m,r.Z.objectInherit(a.Z.prototype,{attributeType:"ColorMask",cloneType:function(){return new m},setMask:function(e,t,i,n){this._red=!!e,this._green=!!t,this._blue=!!i,this._alpha=!!n},apply:function(e){e.applyColorMask(this)}}),"osg","ColorMask");const _=m;var v,C,b,S=i("10ce"),E=i("z6Oe"),y=i("TKk8"),I=i("mQYp"),x=i("Z54E"),T=i("/RJa"),w=i("Uf0x"),M=i("eR0f"),R=i("NzKe"),B=i("epKp"),N=i("TYv3"),D=function(){this._radiusEquator=D.WGS_84_RADIUS_EQUATOR,this._radiusPolar=D.WGS_84_RADIUS_POLAR,this.computeCoefficients()};D.WGS_84_RADIUS_EQUATOR=6378137,D.WGS_84_RADIUS_POLAR=6356752.3142,D.prototype={setRadiusEquator:function(e){this._radiusEquator=e,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(e){this._radiusPolar=e,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(e,t,i,n){var r=Math.sin(e),a=Math.cos(e),o=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*r*r),s=(o+i)*a*Math.cos(t),l=(o+i)*a*Math.sin(t),u=(o*(1-this._eccentricitySquared)+i)*r;return n[0]=s,n[1]=l,n[2]=u,n},convertXYZToLatLongHeight:function(e,t,i,n){var r=Math.sqrt(e*e+t*t),a=Math.atan2(i*this._radiusEquator,r*this._radiusPolar),o=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),s=Math.sin(a),l=Math.cos(a),u=Math.atan((i+o*this._radiusPolar*s*s*s)/(r-this._eccentricitySquared*this._radiusEquator*l*l*l)),h=Math.atan2(t,e),c=Math.sin(u),A=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*c*c),d=Math.cos(u);0===d&&(d=1);var g=r/d-A;return n[0]=u,n[1]=h,n[2]=g,n},computeLocalUpVector:function(e,t,i){var n,r,a=this.convertXYZToLatLongHeight(e,t,i,l.R3.create());return n=a[0],r=a[1],[Math.cos(r)*Math.cos(n),Math.sin(r)*Math.cos(n),Math.sin(n)]},isWGS84:function(){return this._radiusEquator===D.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===D.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var e=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*e-e*e},computeLocalToWorldTransformFromLatLongHeight:function(e,t,i,n){var r=this.convertLatLongHeightToXYZ(e,t,i,n);return l._E.fromTranslation(n,r),this.computeCoordinateFrame(e,t,n),n},computeLocalToWorldTransformFromXYZ:function(e,t,i){var n=this.convertXYZToLatLongHeight(e,t,i,l.R3.create()),r=l._E.fromTranslation(l._E.create(),l.R3.fromValues(e,t,i));return this.computeCoordinateFrame(n[0],n[1],r),r},computeCoordinateFrame:(v=l.R3.create(),C=l.R3.create(),b=l.R3.create(),function(e,t,i){v[0]=Math.cos(t)*Math.cos(e),v[1]=Math.sin(t)*Math.cos(e),v[2]=Math.sin(e),C[0]=-Math.sin(t),C[1]=-Math.cos(t),l.R3.cross(b,v,C),l._E.set(i,C[0],C[1],C[2],0,b[0],b[1],b[2],0,v[0],v[1],v[2],0,0,0,0,1)})};const P=D;var F=i("WzzD"),O=i("wh5T"),L=i("EUBb"),k=i("QuvP"),Z=i("BfDR"),U=i("lZH+"),V=i.n(U),Q=function(e){Z.Z.call(this,e),this._canPlayDefered=void 0};Q.PAUSE=0,Q.PLAYING=1,r.Z.createPrototypeObject(Q,r.Z.objectInherit(Z.Z.prototype,{isDirty:function(){return this._status===Q.PLAYING},setImage:function(e){Z.Z.prototype.setImage.call(this,e),this._status=Q.STOP,e.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(e){this._imageObject.loop=e},play:function(){this._imageObject.play(),this._status=Q.PLAYING},stop:function(){this._imageObject.pause(),this._status=Q.PAUSE},whenReady:function(){if(!this._imageObject)return V().reject();var e=this;return new(V())((function(t){e._canPlayDefered||(e._canPlayDefered=t,e._imageObject.readyState>3?e._canPlayDefered(e):e._imageObject.addEventListener("canplaythrough",e._canPlayDefered.bind(e._canPlayDefered,e),!0))}))}}),"osg","ImageStream");const G=Q;var H=i("Pd7s"),z=i("nMbz"),W=i("Hfbx"),j=function(e,t){this._bb=new A.Z,this._first=e,this._second=t,this._nodeRayStart=l.R3.create(),this._nodeRayEnd=l.R3.create()},q=function(){this._numVertexIndices=0};q.prototype={apply:function(e){e.getAttributes().Vertex&&(0,H.Z)(e,this)},operatorPoint:function(){this._numVertexIndices+=2},operatorLine:function(){this._numVertexIndices+=3},operatorTriangle:function(){this._numVertexIndices+=4}};var J=function(e){this._buildKdTree=e,this._numIndices=0};J.prototype={apply:function(e){e.getAttributes().Vertex&&(0,H.Z)(e,this)},operatorPoint:function(e){var t=this._buildKdTree._kdTree.getVertices(),i=3*e;this._buildKdTree._kdTree.addPoint(e),this._buildKdTree._primitiveIndices[this._numIndices]=this._numIndices;var n=this._buildKdTree._centers,r=3*this._numIndices;n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],this._numIndices++},operatorLine:function(e,t){if(e!==t){var i=this._buildKdTree._kdTree.getVertices(),n=3*e,r=3*t;this._buildKdTree._kdTree.addLine(e,t);var a=this._numIndices;this._buildKdTree._primitiveIndices[a]=a;var o=3*a,s=i[n],l=i[n+1],u=i[n+2],h=i[r],c=i[r+1],A=i[r+2],d=s<h?s:h,g=l<c?l:c,f=u<A?u:A,p=s>h?s:h,m=l>c?l:c,_=u>A?u:A,v=this._buildKdTree._centers;v[o]=.5*(d+p),v[o+1]=.5*(g+m),v[o+2]=.5*(f+_),this._numIndices++}},operatorTriangle:function(e,t,i){if(e!==t&&e!==i&&t!==i){var n=this._buildKdTree._kdTree.getVertices(),r=3*e,a=3*t,o=3*i;this._buildKdTree._kdTree.addTriangle(e,t,i);var s=this._numIndices;this._buildKdTree._primitiveIndices[s]=s;var l=3*s,u=n[r],h=n[r+1],c=n[r+2],A=n[a],d=n[a+1],g=n[a+2],f=n[o],p=n[o+1],m=n[o+2],_=u<A?u<f?u:f:A<f?A:f,v=h<d?h<p?h:p:d<p?d:p,C=c<g?c<m?c:m:g<m?g:m,b=u>A?u>f?u:f:A>f?A:f,S=h>d?h>p?h:p:d>p?d:p,E=c>g?c>m?c:m:g>m?g:m,y=this._buildKdTree._centers;y[l]=.5*(_+b),y[l+1]=.5*(v+S),y[l+2]=.5*(C+E),this._numIndices++}}};var Y=function(e){this._kdTree=e,this._bb=new A.Z,this._primitiveIndices=void 0,this._centers=void 0,this._axisOrder=l.R3.create(),this._stackLength=0};Y.prototype={build:function(e,t){var i=e._targetNumTrianglesPerLeaf,n=t.getVertexAttributeList().Vertex;if(!n)return!1;var r=n.getElements();if(!r)return!1;var a=r.length/3;if(a<i)return!1;this._bb.copy(t.getBoundingBox()),this._kdTree.setVertices(r),this.computeDivisions(e),e._numVerticesProcessed+=a;for(var o=0,s=t.getPrimitiveSetList(),l=s.length,u=0;u<l;u++){var h=s[u],c=h.getMode();c===z.Z.TRIANGLE_STRIP||c===z.Z.TRIANGLE_FAN?o+=3*Math.abs(h.getCount()-2):o+=3*h.getCount()}var d=new q(this);d.apply(t);var g=d._numVertexIndices;this._primitiveIndices=new Uint32Array(o/3),this._centers=new Float32Array(o),this._kdTree.setPrimitiveIndices(new Uint32Array(o));var f=a>65535?new Uint32Array(g):new Uint16Array(g);this._kdTree.setVertexIndices(f);var p=new J(this);p.apply(t);var m=this._kdTree.getPrimitiveIndices().slice(0,this._kdTree.getNumPrimitiveIndices());this._kdTree.setPrimitiveIndices(m);var _=this._kdTree.getVertexIndices().slice(0,this._kdTree.getNumVertexIndices());this._kdTree.setVertexIndices(_),this._primitiveIndices=this._primitiveIndices.slice(0,p._numIndices),this._centers=this._centers.slice(0,3*p._numIndices);var v=new j(-1,this._primitiveIndices.length);v._bb.copy(this._bb);var C=this._kdTree.addNode(v),b=new A.Z;b.copy(this._bb),this.divide(e,b,C,0);var S=this._kdTree.getPrimitiveIndices();for(l=this._primitiveIndices.length,u=0;u<l;++u)this._primitiveIndices[u]=S[this._primitiveIndices[u]];return this._kdTree.setPrimitiveIndices(this._primitiveIndices),this._kdTree.getNodes().length>0},computeDivisions:function(e){this._stackLength=e._maxNumLevels;var t=this._bb._max,i=this._bb._min,n=t[0]-i[0],r=t[1]-i[1],a=t[2]-i[2],o=this._axisOrder;o[0]=n>=r&&n>=a?0:r>=a?1:2,o[2]=n<r&&n<a?0:r<a?1:2;var s=o[0]+o[2];o[1]=3===s?0:2===s?1:2},divide:function(e,t,i,n){var r=this._kdTree,a=this._primitiveIndices,o=r.getNodes(),s=o[i],l=s._first,u=s._second,h=-l-1,c=h+u-1;if(!(n<this._stackLength&&l<0&&u>e._targetNumTrianglesPerLeaf))return l<0&&this.computeNodeBox(s,h,c),i;if(l>=0)return i;for(var A=this._axisOrder[n%3],d=.5*(t._min[A]+t._max[A]),g=0,f=0,p=!1,m=h,_=c,v=this._centers;m<_;){for(;m<_&&v[3*a[m]+A]<=d;)++m;for(;m<_&&v[3*a[_]+A]>d;)--_;if(m<_){var C=a[m];a[m]=a[_],a[_]=C,++m,--_}}m===_&&(v[3*a[m]+A]<=d?++m:--_),_-h<=-1?(g=0,f=i,p=!0):c-m<=-1?(g=i,f=0,p=!0):(g=r.addNode(new j(-h-1,_-h+1)),f=r.addNode(new j(-m-1,c-m+1)));var b=t._max[A];t._max[A]=d;var S=0!==g?this.divide(e,t,g,n+1):0;t._max[A]=b,b=t._min[A],t._min[A]=d;var E=0!==f?this.divide(e,t,f,n+1):0;if(t._min[A]=b,!p){s._first=S,s._second=E,p=!0;var y=s._bb;y.init(),0!==S&&y.expandByBoundingBox(o[S]._bb),0!==E&&y.expandByBoundingBox(o[E]._bb)}return i},computeNodeBox:function(e,t,i){for(var n=1/0,r=1/0,a=1/0,o=-1/0,s=-1/0,l=-1/0,u=this._kdTree.getVertexIndices(),h=this._kdTree.getPrimitiveIndices(),c=this._kdTree.getVertices(),A=t;A<=i;++A)for(var d=h[this._primitiveIndices[A]],g=u[d++],f=0;f<g;++f){var p=3*u[d++],m=c[p],_=c[p+1],v=c[p+2];m<n&&(n=m),_<r&&(r=_),v<a&&(a=v),m>o&&(o=m),_>s&&(s=_),v>l&&(l=v)}var C=1e-6,b=e._bb,S=b._min,E=b._max;S[0]=n-C,S[1]=r-C,S[2]=a-C,E[0]=o+C,E[1]=s+C,E[2]=l+C}};var K=function(){this._vertices=null,this._kdNodes=[],this._primitiveIndices=void 0,this._vertexIndices=void 0,this._numVertexIndices=0,this._numPrimitiveIndices=0};r.Z.createPrototypeObject(K,{getVertices:function(){return this._vertices},setVertices:function(e){this._vertices=e},getNumPrimitiveIndices:function(){return this._numPrimitiveIndices},getNumVertexIndices:function(){return this._numVertexIndices},setPrimitiveIndices:function(e){this._primitiveIndices=e},getPrimitiveIndices:function(){return this._primitiveIndices},setVertexIndices:function(e){this._vertexIndices=e},getVertexIndices:function(){return this._vertexIndices},getNodes:function(){return this._kdNodes},addPoint:function(e){var t=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=t,this._vertexIndices[this._numVertexIndices++]=1,this._vertexIndices[this._numVertexIndices++]=e},addLine:function(e,t){var i=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=i,this._vertexIndices[this._numVertexIndices++]=2,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=t},addTriangle:function(e,t,i){var n=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=n,this._vertexIndices[this._numVertexIndices++]=3,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=i},addNode:function(e){return this._kdNodes.push(e),this._kdNodes.length-1},build:function(e,t){return new Y(this).build(e,t)},_intersectFunctor:function(e,t){var i=-t._first-1,n=i+t._second,r=this._vertexIndices;e.setVertices(this._vertices),e.setPrimitiveIndex(i);for(var a=i;a<n;++a){var o=this._primitiveIndices[a],s=r[o++];3===s?e.operatorTriangle(r[o],r[o+1],r[o+2]):2===s?e.operatorLine(r[o],r[o+1]):1===s?e.operatorPoint(r[o]):W.Z.error("KdTree::intersect() unsupported vertices count :"+s)}},intersect:function(e,t){t._first<0?this._intersectFunctor(e,t):e.enter(t._bb)&&(t._first>0&&this.intersect(e,this._kdNodes[t._first]),t._second>0&&this.intersect(e,this._kdNodes[t._second]),e.leave())},intersectLineSegment:function(e,t,i,n){if(t._first<0)this._intersectFunctor(e,t);else{var r=t._nodeRayStart,a=t._nodeRayEnd;l.R3.copy(r,i),l.R3.copy(a,n);var o,s=this._kdNodes;t._first>0&&(o=s[t._first],e.enter(o._bb,r,a)&&this.intersectLineSegment(e,o,r,a)),t._second>0&&(l.R3.copy(r,i),l.R3.copy(a,n),o=s[t._second],e.enter(o._bb,r,a)&&this.intersectLineSegment(e,o,r,a))}}},"osg","KdTree");const X=K;var $=i("2bAw"),ee=function(e){if($.Z.call(this),this._buildOptions={_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20},e){var t=e._targetNumTrianglesPerLeaf,i=e._maxNumLevels;void 0!==t&&(this._buildOptions._targetNumTrianglesPerLeaf=t),void 0!==i&&(this._buildOptions._maxNumLevels=i)}};r.Z.createPrototypeObject(ee,r.Z.objectInherit($.Z.prototype,{apply:function(e){if(e.getShape&&void 0===e.getShape()){var t=new X;t.build(this._buildOptions,e)&&e.setShape(t)}this.traverse(e)}}),"osg","KdTreeBuilder");const te=ee;var ie=i("vHSS"),ne=i("1lj/"),re=function(e){a.Z.call(this),this.lineWidth=1,void 0!==e&&(this.lineWidth=e)};r.Z.createPrototypeStateAttribute(re,r.Z.objectInherit(a.Z.prototype,{attributeType:"LineWidth",cloneType:function(){return new re},apply:function(e){e.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth");const ae=re;var oe=i("fd33"),se=i("YPi5"),le=i("OEJe"),ue=i("aS0i"),he=i("U7nq"),ce=i("BW96"),Ae=i("kJFG"),de=i("FJW6"),ge=i("vrBm"),fe=i("wm32"),pe=i("Rqdv"),me=i("klI+"),_e=i("LZhK"),ve=function(e){a.Z.call(this),this._enable=!e,this._pointSize=1,this._circleShape=!1,this._dirtyHash=!0,this._hash=""};r.Z.createPrototypeStateAttribute(ve,r.Z.objectInherit(a.Z.prototype,{attributeType:"PointSize",cloneType:function(){return new ve(!0)},setCircleShape:function(e){this._circleShape=e,this._dirtyHash=!0},isCircleShape:function(){return this._circleShape},setEnabled:function(e){this._enable=e,this._dirtyHash=!0},isEnabled:function(){return this._enable},setPointSize:function(e){this._pointSize=e},getOrCreateUniforms:function(){var e=ve;return e.uniforms||(e.uniforms={pointSize:_e.Z.createFloat(1,"uPointSize")}),e.uniforms},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._circleShape?"1":"0")},apply:function(){this._enable&&this.getOrCreateUniforms().pointSize.setFloat(this._pointSize)}}),"osg","PointSizeAttribute");const Ce=ve;var be,Se,Ee,ye=i("XOVK"),Ie=[],xe=[];Ie[z.Z.POINTS]=(be=l.R3.create(),function(e,t,i,n,r){for(var a=e+t,o=e;o<a;++o){var s=3*i[o];be[0]=r[s],be[1]=r[s+1],be[2]=r[s+2],n.operatorPoint(be)}}),Ie[z.Z.LINES]=(Se=l.R3.create(),Ee=l.R3.create(),function(e,t,i,n,r){for(var a=e+t,o=e;o<a-1;o+=2){var s=3*i[o];Se[0]=r[s],Se[1]=r[s+1],Se[2]=r[s+2],s=3*i[o+1],Ee[0]=r[s],Ee[1]=r[s+1],Ee[2]=r[s+2],n.operatorLine(Se,Ee)}}),Ie[z.Z.LINE_STRIP]=function(){var e=l.R3.create(),t=l.R3.create();return function(i,n,r,a,o){for(var s=i+n,l=i;l<s-1;++l){var u=3*r[l];e[0]=o[u],e[1]=o[u+1],e[2]=o[u+2],u=3*r[l+1],t[0]=o[u],t[1]=o[u+1],t[2]=o[u+2],a.operatorLine(e,t)}}}(),Ie[z.Z.LINE_LOOP]=function(){var e=l.R3.create(),t=l.R3.create();return function(i,n,r,a,o){for(var s=i+n-1,l=i;l<s;++l){var u=3*r[l];e[0]=o[u],e[1]=o[u+1],e[2]=o[u+2],u=3*r[l+1],t[0]=o[u],t[1]=o[u+1],t[2]=o[u+2],a.operatorLine(e,t)}s=3*r[s],e[0]=o[s],e[1]=o[s+1],e[2]=o[s+2];var h=3*r[0];t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2],a.operatorLine(e,t)}}(),Ie[z.Z.TRIANGLES]=function(){var e=l.R3.create(),t=l.R3.create(),i=l.R3.create();return function(n,r,a,o,s){for(var l=n+r,u=n;u<l;u+=3){var h=3*a[u];e[0]=s[h],e[1]=s[h+1],e[2]=s[h+2],h=3*a[u+1],t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*a[u+2],i[0]=s[h],i[1]=s[h+1],i[2]=s[h+2],o.operatorTriangle(e,t,i)}}}(),Ie[z.Z.TRIANGLE_STRIP]=function(){var e=l.R3.create(),t=l.R3.create(),i=l.R3.create();return function(n,r,a,o,s){for(var l=2,u=n;l<r;++l,++u){var h=3*a[u];e[0]=s[h],e[1]=s[h+1],e[2]=s[h+2],h=3*a[u+1],t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*a[u+2],i[0]=s[h],i[1]=s[h+1],i[2]=s[h+2],l%2?o.operatorTriangle(e,i,t):o.operatorTriangle(e,t,i)}}}(),Ie[z.Z.TRIANGLE_FAN]=function(){var e=l.R3.create(),t=l.R3.create(),i=l.R3.create();return function(n,r,a,o,s){for(var l=a[n],u=2,h=n+1;u<r;++u,++h){e[0]=s[l],e[1]=s[l+1],e[2]=s[l+2];var c=3*a[h];t[0]=s[c],t[1]=s[c+1],t[2]=s[c+2],c=3*a[h+1],i[0]=s[c],i[1]=s[c+1],i[2]=s[c+2],o.operatorTriangle(e,t,i)}}}(),xe[z.Z.POINTS]=function(){var e=l.R3.create();return function(t,i,n,r){for(var a=t;a<t+i;++a){var o=3*a;e[0]=r[o],e[1]=r[o+1],e[2]=r[o+2],n.operatorPoint(e)}}}(),xe[z.Z.LINES]=function(){var e=l.R3.create(),t=l.R3.create();return function(i,n,r,a){for(var o=i;o<i+n-1;o+=2){var s=3*o;e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],s=3*(o+1),t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],r.operatorLine(e,t)}}}(),xe[z.Z.LINE_STRIP]=function(){var e=l.R3.create(),t=l.R3.create();return function(i,n,r,a){for(var o=i;o<i+n-1;++o){var s=3*o;e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],s=3*(o+1),t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],r.operatorLine(e,t)}}}(),xe[z.Z.LINE_LOOP]=function(){var e=l.R3.create(),t=l.R3.create();return function(i,n,r,a){for(var o=i+n-1,s=i;s<o;++s){var l=3*s;e[0]=a[l],e[1]=a[l+1],e[2]=a[l+2],l=3*(s+1),t[0]=a[l],t[1]=a[l+1],t[2]=a[l+2],r.operatorLine(e,t)}o*=3,e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],i*=3,t[0]=a[i],t[1]=a[i+1],t[2]=a[i+2],r.operatorLine(e,t)}}(),xe[z.Z.TRIANGLES]=function(){var e=l.R3.create(),t=l.R3.create(),i=l.R3.create();return function(n,r,a,o){for(var s=n;s<n+r;s+=3){var l=3*s;e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*(s+1),t[0]=o[l],t[1]=o[l+1],t[2]=o[l+2],l=3*(s+2),i[0]=o[l],i[1]=o[l+1],i[2]=o[l+2],a.operatorTriangle(e,t,i)}}}(),xe[z.Z.TRIANGLE_STRIP]=function(){var e=l.R3.create(),t=l.R3.create(),i=l.R3.create();return function(n,r,a,o){for(var s=2,l=n;s<r;++s,++l){var u=3*l;e[0]=o[u],e[1]=o[u+1],e[2]=o[u+2],u=3*(l+1),t[0]=o[u],t[1]=o[u+1],t[2]=o[u+2],u=3*(l+2),i[0]=o[u],i[1]=o[u+1],i[2]=o[u+2],s%2?a.operatorTriangle(e,i,t):a.operatorTriangle(e,t,i)}}}(),xe[z.Z.TRIANGLE_FAN]=function(){var e=l.R3.create(),t=l.R3.create(),i=l.R3.create();return function(n,r,a,o){for(var s=2,l=n+1;s<r;++s,++l){e[0]=o[n],e[1]=o[n+1],e[2]=o[n+2];var u=3*l;t[0]=o[u],t[1]=o[u+1],t[2]=o[u+2],u=3*(l+1),i[0]=o[u],i[1]=o[u+1],i[2]=o[u+2],a.operatorTriangle(e,t,i)}}}();const Te=function(e,t,i){var n=e.getPrimitiveSetList();if(n)for(var r,a=n.length,o=0;o<a;o++){var s=n[o];if(s instanceof N.Z){if(r=Ie[s.getMode()]){var l=s.indices.getElements();r(s.getFirst()/l.BYTES_PER_ELEMENT,s.getCount(),l,t,i)}}else s instanceof B.Z&&(r=xe[s.getMode()])&&r(s.getFirst(),s.getCount(),t,i)}};var we=i("Axet"),Me=i("KOpT"),Re=i("UvG5"),Be=i("eaVu"),Ne=i("DynT"),De=i("4igZ"),Pe=i("EZIT"),Fe=i("meUd"),Oe=i("Fdmx"),Le=i("FFaL"),ke=i("0/zD"),Ze=i("m+0q"),Ue=i("FCEq"),Ve=function(){Ue.Z.call(this),this._images={};for(var e=0;e<6;e++)this._images[Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X+e]=new Z.Z};r.Z.createPrototypeStateAttribute(Ve,r.Z.objectInherit(Ue.Z.prototype,{setDefaultParameters:function(){Ue.Z.prototype.setDefaultParameters.call(this),this._textureTarget=Ue.Z.TEXTURE_CUBE_MAP,this._flipY=!1},invalidate:function(){Ue.Z.prototype.invalidate.call(this);for(var e=Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X;e<Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X+6;e++){var t=this._images[e];this._images[Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()&&t.dirty()}this.dirty()},cloneType:function(){return new Ve},setImage:function(e,t,i){var n=e;"string"==typeof n&&(n=Ue.Z[n]),this._images[n].setImage(t,i),this.setImageFormat(i),this.setTextureSize(this._images[n].getWidth(),this._images[n].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(e){return this._images[e].getImage()},initCubemapContent:function(e){var t=this._internalFormat;return this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_X,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),!0},generateMipmap:function(e,t){if(this.hasMipmapFilter()){if(this._images[Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var i=0;i<6;i++){var n=this._images[Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X+i];n.hasMipmap()||W.Z.error("mipmap not set correctly for TextureCubemap");for(var r=this._internalFormat,a=1;a<n.getMipmap().length;a++){var o=n.getMipmap()[a].getWidth();this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,a,r,o,o,0,r,this._type,n.getMipmap()[a].getImage())}}else e.generateMipmap(t);this._dirtyMipmap=!1}},applyImageTarget:function(e,t,i){var n=this._images[i];return n.getImage()&&n.isReady()?n.isDirty()?(this.setTextureSize(n.getWidth(),n.getHeight()),n.setDirty(!1),n.isTypedArray()?this.applyTexImage2D(e,i,0,t,this._textureWidth,this._textureHeight,0,t,this._type,n.getImage()):this.applyTexImage2D(e,i,0,t,t,this._type,n.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&n.hasMipmap()||n.release(),1):1:0},initCubemapContentImage:function(e){var t=this._internalFormat,i=0;return i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_POSITIVE_Z),6===(i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_NEGATIVE_Z))},apply:function(e){var t=e.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this.setGraphicContext(t)),void 0===this._textureObject||this.isDirty())if(this._textureNull)t.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(e)),this._textureObject.bind(t),(this._images[Ue.Z.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(t):this.initCubemapContent(t))&&(this._dirty=!1,this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget))}else this._textureObject.bind(t),this.isDirtyMipmap()&&this.generateMipmap(t,this._textureTarget)}}),"osg","TextureCubeMap");const Qe=Ve;var Ge=i("Heae"),He=function(){},ze=He.functorDrawElements=[],We=He.functorDrawArrays=[];ze[z.Z.TRIANGLES]=function(e,t,i,n){for(var r=e+t,a=e;a<r;a+=3)n(i[a],i[a+1],i[a+2])},ze[z.Z.TRIANGLE_STRIP]=function(e,t,i,n){for(var r=2,a=e;r<t;++r,++a)r%2?n(i[a],i[a+2],i[a+1]):n(i[a],i[a+1],i[a+2])},ze[z.Z.TRIANGLE_FAN]=function(e,t,i,n){for(var r=i[e],a=2,o=e+1;a<t;++a,++o)n(r,i[o],i[o+1])},We[z.Z.TRIANGLES]=function(e,t,i){for(var n=2,r=e;n<t;n+=3,r+=3)i(r,r+1,r+2)},We[z.Z.TRIANGLE_STRIP]=function(e,t,i){for(var n=2,r=e;n<t;++n,++r)n%2?i(r,r+2,r+1):i(r,r+1,r+2)},We[z.Z.TRIANGLE_FAN]=function(e,t,i){for(var n=2,r=e+1;n<t;++n,++r)i(e,r,r+1)},He.prototype={init:function(e,t){this._geom=e,this._cb=t},apply:function(){var e=this._geom.getPrimitiveSetList();if(e)for(var t,i=this._cb,n=e.length,r=0;r<n;r++){var a=e[r];if(a instanceof N.Z){if(t=ze[a.getMode()]){var o=a.indices.getElements();t(a.getFirst()/o.BYTES_PER_ELEMENT,a.getCount(),o,i)}}else a instanceof B.Z&&(t=We[a.getMode()])&&t(a.getFirst(),a.getCount(),i)}}};const je=He;var qe=i("nRps"),Je=i("2Uq9"),Ye=i("9YK+"),Ke=i("a72h"),Xe=i("83E6"),$e=i("sh3Z"),et=i("8dss"),tt=i("EMUO"),it={};it.AutoTransform=n.Z,it.BillboardAttribute=s,it.BlendColor=h,it.BlendFunc=c.Z,it.BoundingBox=A.Z,it.BoundingSphere=d.Z,it.BufferArray=g.Z,it.BufferArrayProxy=f.Z,it.ColorMask=_,it.Camera=p.Z,it.ColorMask=_,it.ComputeBoundsVisitor=S.Z,r.Z.objectMix(it,E.Z),it.CullFace=y.Z,it.CullingSet=I.Z,it.CullSettings=x.Z,it.CullStack=T.Z,it.CullVisitor=w.Z,it.Depth=M.Z,it.DrawArrayLengths=R.Z,it.DrawArrays=B.Z,it.DrawElements=N.Z,it.EllipsoidModel=P,it.WGS_84_RADIUS_EQUATOR=P.WGS_84_RADIUS_EQUATOR,it.WGS_84_RADIUS_POLAR=P.WGS_84_RADIUS_POLAR,it.FrameBufferObject=F.Z,it.FrameStamp=O.Z,it.Geometry=L.Z,it.GLObject=k.Z,it.Image=Z.Z,it.ImageStream=G,it.KdTree=X,it.KdTreeBuilder=te,it.Light=ie.Z,it.LightSource=ne.Z,it.LineWidth=ae,it.Lod=oe.Z,it.Material=se.Z,r.Z.objectMix(it,le.Z),it.MatrixTransform=ue.Z,it.PooledResource=he.Z,it.PooledArray=ce.Z,it.PooledMap=Ae.Z,it.Node=de.Z,it.NodeVisitor=$.Z,r.Z.objectMix(it,W.Z),it.Object=ge.Z,it.Options=fe.Z,it.PagedLOD=pe.Z,it.Plane=ye.Z,it.PointSizeAttribute=Ce,it.Polytope=me.Z,it.primitiveSet=z.Z,it.primitiveFunctor=Te,it.primitiveIndexFunctor=H.Z,it.Program=we.Z,it.Projection=Me.Z,it.RenderBin=Re.Z,it.RenderLeaf=Be.Z,it.RenderStage=Ne.Z,it.Shader=De.Z,r.Z.objectMix(it,Pe.Z),it.StackObjectPairPool=Fe.Z,it.State=Oe.Z,it.StateAttribute=a.Z,it.StateGraph=Le.Z,it.StateSet=ke.Z,it.Scissor=Ye.Z,it.Switch=Ze.Z,it.Texture=Ue.Z,it.TextureCubeMap=Qe,it.Transform=Ge.Z,it.TriangleIndexFunctor=je,it.Uniform=_e.Z,it.UpdateVisitor=qe.Z,r.Z.objectMix(it,r.Z),it.Viewport=Je.Z,it.VertexArrayObject=et.Z,it.vec2=l.sh.vec2,it.vec3=l.sh.vec3,it.vec4=l.sh.vec4,it.quat=l.sh.quat,it.mat3=l.sh.mat3,it.mat4=l.sh.mat4,it.Transform.RELATIVE_RF=Ke.Z.RELATIVE_RF,it.Transform.ABSOLUTE_RF=Ke.Z.ABSOLUTE_RF,it.Timer=Xe.Z,it.TimerGPU=$e.Z,it.WebGLCaps=tt.Z;const nt=it},"/RWI":()=>{if(window.Set&&window.Map&&window.Uint8ClampedArray){if(Math.sign||(Math.sign=function(e){return e>0?1:e<0?-1:0}),Math.log2||(Math.log2=function(e){return Math.log(e)*Math.LOG2E}),Math.log10||(Math.log10=function(e){return Math.log(e)*Math.LOG10E}),String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.slice(-e.length)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),!Float32Array.prototype.slice){var e=function(e,t){return new this.constructor(this.subarray(e,t))};Int8Array.prototype.slice=e,Uint8Array.prototype.slice=e,Uint8ClampedArray.prototype.slice=e,Int16Array.prototype.slice=e,Uint16Array.prototype.slice=e,Int32Array.prototype.slice=e,Uint32Array.prototype.slice=e,Float32Array.prototype.slice=e,Float64Array.prototype.slice=e}if(!new window.Set(["test"]).has("test")){var t=window.Set;window.Set=function(e){var i=new t;if(e)for(var n=0;n<e.length;++n)i.add(e[n]);return i}}if("object"==typeof window.Event){function i(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}i.prototype=window.Event.prototype,window.Event=i}}},Pd7s:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("nMbz"),r=i("TYv3"),a=i("epKp"),o=[],s=[];o[n.Z.TRIANGLES]=function(e,t,i,n){for(var r=e+t,a=e;a<r;a+=3)n.operatorTriangle(i[a],i[a+1],i[a+2])},o[n.Z.TRIANGLE_STRIP]=function(e,t,i,n){for(var r=2,a=e;r<t;++r,++a)r%2?n.operatorTriangle(i[a],i[a+2],i[a+1]):n.operatorTriangle(i[a],i[a+1],i[a+2])},o[n.Z.TRIANGLE_FAN]=function(e,t,i,n){for(var r=i[e],a=2,o=e+1;a<t;++a,++o)n.operatorTriangle(r,i[o],i[o+1])},o[n.Z.POINTS]=function(e,t,i,n){for(var r=e+t,a=e;a<r;++a)n.operatorPoint(i[a])},o[n.Z.LINES]=function(e,t,i,n){for(var r=e+t,a=e;a<r;a+=2)n.operatorLine(i[a],i[a+1])},o[n.Z.LINE_STRIP]=function(e,t,i,n){for(var r=e+t,a=e;a<r;++a)n.operatorLine(i[a],i[a+1])},o[n.Z.LINE_LOOP]=function(e,t,i,n){for(var r=e+t,a=e;a<r;++a)n.operatorLine(i[a],i[a+1]);n.operatorLine(i[i.length-1],i[0])},s[n.Z.TRIANGLES]=function(e,t,i){for(var n=2,r=e;n<t;n+=3,r+=3)i.operatorTriangle(r,r+1,r+2)},s[n.Z.TRIANGLE_STRIP]=function(e,t,i){for(var n=2,r=e;n<t;++n,++r)n%2?i.operatorTriangle(r,r+2,r+1):i.operatorTriangle(r,r+1,r+2)},s[n.Z.TRIANGLE_FAN]=function(e,t,i){for(var n=2,r=e+1;n<t;++n,++r)i.operatorTriangle(e,r,r+1)},s[n.Z.POINTS]=function(e,t,i){for(var n=0,r=e;n<t;++n,++r)i.operatorPoint(r)},s[n.Z.LINES]=function(e,t,i){for(var n=1,r=e;n<t;n+=2,r+=2)i.operatorLine(r,r+1)},s[n.Z.LINE_STRIP]=function(e,t,i){for(var n=1,r=e;n<t;++n,++r)i.operatorLine(r,r+1)},s[n.Z.LINE_LOOP]=function(e,t,i){for(var n=1,r=e;n<t;++n,++r)i.operatorLine(r,r+1);i.operatorLine(e+t-1,e)};const l=function(e,t){var i=e.getPrimitiveSetList();if(i)for(var n,l=i.length,u=0;u<l;u++){var h=i[u];if(h instanceof r.Z){if(n=o[h.getMode()]){var c=h.indices.getElements();n(h.getFirst()/c.BYTES_PER_ELEMENT,h.getCount(),c,t)}}else h instanceof a.Z&&(n=s[h.getMode()])&&n(h.getFirst(),h.getCount(),t)}}},nMbz:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};const r=n},EZIT:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var n=i("Xbee"),r=i("LERn"),a=i("EUBb"),o=i("nMbz"),s=i("epKp"),l=i("TYv3"),u=i("Axet"),h=i("4igZ"),c=i("0rAA"),A=function(){var e=new a.Z,t=new c.Z.Float32Array([4,-1,-1,4,-1,-1]),i=new r.Z(r.Z.ARRAY_BUFFER,t,2);e.getAttributes().Vertex=i,e.getAttributes().TexCoord0=i;var n=new s.Z(o.Z.TRIANGLES,0,3);return e.getPrimitives().push(n),function(){return e}}(),d=function(e){void 0===e&&(e=1),void 0===d.getShader&&(d.getShader=function(){if(void 0===d.getShader.program){var e=["attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),t=["varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),i=new u.Z(new h.Z("VERTEX_SHADER",e),new h.Z("FRAGMENT_SHADER",t));d.getShader.program=i}return d.getShader.program});var t=new a.Z,i=new c.Z.Float32Array(18);i[3]=e,i[10]=e,i[17]=e;var n=new c.Z.Float32Array(24);n[0]=n[3]=1,n[4]=n[7]=1,n[9]=n[11]=1,n[13]=n[15]=1,n[18]=n[19]=1,n[22]=n[23]=1,t.getAttributes().Vertex=new r.Z(r.Z.ARRAY_BUFFER,i,3),t.getAttributes().Color=new r.Z(r.Z.ARRAY_BUFFER,n,4);var l=new s.Z(o.Z.LINES,0,6);return t.getPrimitives().push(l),t.getOrCreateStateSet().setAttributeAndModes(d.getShader()),t},g=function(e,t,i,u,h,A,d){e=e||1,u=void 0!==u?u:0,h=void 0!==h?h:2*Math.PI,A=void 0!==A?A:0,d=void 0!==d?d:Math.PI;for(var g=Math.max(3,Math.floor(t)||8),f=Math.max(2,Math.floor(i)||6),p=g*f/3>=65536,m=p?g*f*6:g*f*4,_=new c.Z.Float32Array(3*m),v=new c.Z.Float32Array(3*m),C=new c.Z.Float32Array(2*m),b=p?void 0:new c.Z.Uint16Array(g*f*6),S=0,E=0,y=new c.Z.Float32Array(3),I=new c.Z.Float32Array(3),x=new c.Z.Float32Array(3),T=new c.Z.Float32Array(3),w=new c.Z.Float32Array(3),M=new c.Z.Float32Array(3),R=new c.Z.Float32Array(3),B=new c.Z.Float32Array(3),N=new c.Z.Float32Array(2),D=new c.Z.Float32Array(2),P=new c.Z.Float32Array(2),F=new c.Z.Float32Array(2),O=function(t,i,r,a,o){r[0]=-e*Math.cos(u+t*h)*Math.sin(A+i*d),r[1]=e*Math.cos(A+i*d),r[2]=e*Math.sin(u+t*h)*Math.sin(A+i*d),n.R3.normalize(a,r),o[0]=t,o[1]=1-i},L=0;L<f;L++)for(var k=0;k<g;k++){O((k+1)/g,L/f,y,w,N),O(k/g,L/f,I,M,D),O(k/g,(L+1)/f,x,R,P),O((k+1)/g,(L+1)/f,T,B,F);var Z=3*S;_[Z]=y[0],_[Z+1]=y[1],_[Z+2]=y[2],_[Z+3]=I[0],_[Z+4]=I[1],_[Z+5]=I[2],_[Z+6]=x[0],_[Z+7]=x[1],_[Z+8]=x[2],v[Z]=w[0],v[Z+1]=w[1],v[Z+2]=w[2],v[Z+3]=M[0],v[Z+4]=M[1],v[Z+5]=M[2],v[Z+6]=R[0],v[Z+7]=R[1],v[Z+8]=R[2];var U=2*S;if(C[U]=N[0],C[U+1]=N[1],C[U+2]=D[0],C[U+3]=D[1],C[U+4]=P[0],C[U+5]=P[1],S+=3,p)_[Z=3*S]=y[0],_[Z+1]=y[1],_[Z+2]=y[2],_[Z+3]=x[0],_[Z+4]=x[1],_[Z+5]=x[2],_[Z+6]=T[0],_[Z+7]=T[1],_[Z+8]=T[2],v[Z]=w[0],v[Z+1]=w[1],v[Z+2]=w[2],v[Z+3]=R[0],v[Z+4]=R[1],v[Z+5]=R[2],v[Z+6]=B[0],v[Z+7]=B[1],v[Z+8]=B[2],C[U=2*S]=N[0],C[U+1]=N[1],C[U+2]=P[0],C[U+3]=P[1],C[U+4]=F[0],C[U+5]=F[1],S+=3;else{_[Z=3*S]=T[0],_[Z+1]=T[1],_[Z+2]=T[2],v[Z]=B[0],v[Z+1]=B[1],v[Z+2]=B[2],C[U=2*S]=F[0],C[U+1]=F[1];var V=3*E,Q=S-3;b[V]=Q,b[V+1]=Q+1,b[V+2]=Q+2,b[V+3]=Q,b[V+4]=Q+2,b[V+5]=Q+3,E+=2,S+=1}}var G=new a.Z;return G.getAttributes().Vertex=new r.Z("ARRAY_BUFFER",_,3),G.getAttributes().Normal=new r.Z("ARRAY_BUFFER",v,3),G.getAttributes().TexCoord0=new r.Z("ARRAY_BUFFER",C,2),p?G.getPrimitives().push(new s.Z(o.Z.TRIANGLES,0,_.length/3)):G.getPrimitives().push(new l.Z(o.Z.TRIANGLES,new r.Z("ELEMENT_ARRAY_BUFFER",b,1))),G};const f={createTexturedBoxGeometry:function(e,t,i,n,s,u){var h,A,d,g=void 0!==e?e:0,f=void 0!==t?t:0,p=void 0!==i?i:0,m=void 0!==n?n:1,_=void 0!==s?s:1,v=void 0!==u?u:1,C=new a.Z;h=m/2,A=_/2,d=v/2;var b=new c.Z.Float32Array(72),S=new c.Z.Float32Array(48),E=new c.Z.Float32Array(72);b[0]=g-h,b[1]=f-A,b[2]=p+d,E[0]=0,E[1]=-1,E[2]=0,S[0]=0,S[1]=1,b[3]=g-h,b[4]=f-A,b[5]=p-d,E[3]=0,E[4]=-1,E[5]=0,S[2]=0,S[3]=0,b[6]=g+h,b[7]=f-A,b[8]=p-d,E[6]=0,E[7]=-1,E[8]=0,S[4]=1,S[5]=0,b[9]=g+h,b[10]=f-A,b[11]=p+d,E[9]=0,E[10]=-1,E[11]=0,S[6]=1,S[7]=1,b[12]=g+h,b[13]=f+A,b[14]=p+d,E[12]=0,E[13]=1,E[14]=0,S[8]=0,S[9]=1,b[15]=g+h,b[16]=f+A,b[17]=p-d,E[15]=0,E[16]=1,E[17]=0,S[10]=0,S[11]=0,b[18]=g-h,b[19]=f+A,b[20]=p-d,E[18]=0,E[19]=1,E[20]=0,S[12]=1,S[13]=0,b[21]=g-h,b[22]=f+A,b[23]=p+d,E[21]=0,E[22]=1,E[23]=0,S[14]=1,S[15]=1,b[24]=g+h,b[25]=f-A,b[26]=p+d,E[24]=1,E[25]=0,E[26]=0,S[16]=0,S[17]=1,b[27]=g+h,b[28]=f-A,b[29]=p-d,E[27]=1,E[28]=0,E[29]=0,S[18]=0,S[19]=0,b[30]=g+h,b[31]=f+A,b[32]=p-d,E[30]=1,E[31]=0,E[32]=0,S[20]=1,S[21]=0,b[33]=g+h,b[34]=f+A,b[35]=p+d,E[33]=1,E[34]=0,E[35]=0,S[22]=1,S[23]=1,b[36]=g-h,b[37]=f+A,b[38]=p+d,E[36]=-1,E[37]=0,E[38]=0,S[24]=0,S[25]=1,b[39]=g-h,b[40]=f+A,b[41]=p-d,E[39]=-1,E[40]=0,E[41]=0,S[26]=0,S[27]=0,b[42]=g-h,b[43]=f-A,b[44]=p-d,E[42]=-1,E[43]=0,E[44]=0,S[28]=1,S[29]=0,b[45]=g-h,b[46]=f-A,b[47]=p+d,E[45]=-1,E[46]=0,E[47]=0,S[30]=1,S[31]=1,b[48]=g-h,b[49]=f+A,b[50]=p+d,E[48]=0,E[49]=0,E[50]=1,S[32]=0,S[33]=1,b[51]=g-h,b[52]=f-A,b[53]=p+d,E[51]=0,E[52]=0,E[53]=1,S[34]=0,S[35]=0,b[54]=g+h,b[55]=f-A,b[56]=p+d,E[54]=0,E[55]=0,E[56]=1,S[36]=1,S[37]=0,b[57]=g+h,b[58]=f+A,b[59]=p+d,E[57]=0,E[58]=0,E[59]=1,S[38]=1,S[39]=1,b[60]=g+h,b[61]=f+A,b[62]=p-d,E[60]=0,E[61]=0,E[62]=-1,S[40]=0,S[41]=1,b[63]=g+h,b[64]=f-A,b[65]=p-d,E[63]=0,E[64]=0,E[65]=-1,S[42]=0,S[43]=0,b[66]=g-h,b[67]=f-A,b[68]=p-d,E[66]=0,E[67]=0,E[68]=-1,S[44]=1,S[45]=0,b[69]=g-h,b[70]=f+A,b[71]=p-d,E[69]=0,E[70]=0,E[71]=-1,S[46]=1,S[47]=1;var y=new c.Z.Uint16Array(36);y[0]=0,y[1]=1,y[2]=2,y[3]=0,y[4]=2,y[5]=3,y[6]=4,y[7]=5,y[8]=6,y[9]=4,y[10]=6,y[11]=7,y[12]=8,y[13]=9,y[14]=10,y[15]=8,y[16]=10,y[17]=11,y[18]=12,y[19]=13,y[20]=14,y[21]=12,y[22]=14,y[23]=15,y[24]=16,y[25]=17,y[26]=18,y[27]=16,y[28]=18,y[29]=19,y[30]=20,y[31]=21,y[32]=22,y[33]=20,y[34]=22,y[35]=23,C.getAttributes().Vertex=new r.Z(r.Z.ARRAY_BUFFER,b,3),C.getAttributes().Normal=new r.Z(r.Z.ARRAY_BUFFER,E,3),C.getAttributes().TexCoord0=new r.Z(r.Z.ARRAY_BUFFER,S,2);var I=new l.Z(o.Z.TRIANGLES,new r.Z(r.Z.ELEMENT_ARRAY_BUFFER,y,1));return C.getPrimitives().push(I),C},createTexturedQuadGeometry:function(e,t,i,s,u,h,A,d,g,f,p,m,_){void 0===m&&void 0===_&&(m=f,_=p,f=0,p=0);var v=new a.Z,C=new c.Z.Float32Array(12);C[0]=e+A,C[1]=t+d,C[2]=i+g,C[3]=e,C[4]=t,C[5]=i,C[6]=e+s,C[7]=t+u,C[8]=i+h,C[9]=e+s+A,C[10]=t+u+d,C[11]=i+h+g,void 0===m&&(m=1),void 0===_&&(_=1);var b=new c.Z.Float32Array(8);b[0]=f,b[1]=_,b[2]=f,b[3]=p,b[4]=m,b[5]=p,b[6]=m,b[7]=_;var S=n.R3.fromValues(s,u,h);n.R3.cross(S,S,n.R3.fromValues(A,d,g)),n.R3.normalize(S,S);var E=new c.Z.Float32Array(12);E[0]=S[0],E[1]=S[1],E[2]=S[2],E[3]=S[0],E[4]=S[1],E[5]=S[2],E[6]=S[0],E[7]=S[1],E[8]=S[2],E[9]=S[0],E[10]=S[1],E[11]=S[2];var y=new c.Z.Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=0,y[4]=2,y[5]=3,v.getAttributes().Vertex=new r.Z(r.Z.ARRAY_BUFFER,C,3),v.getAttributes().Normal=new r.Z(r.Z.ARRAY_BUFFER,E,3),v.getAttributes().TexCoord0=new r.Z(r.Z.ARRAY_BUFFER,b,2);var I=new l.Z(o.Z.TRIANGLES,new r.Z(r.Z.ELEMENT_ARRAY_BUFFER,y,1));return v.getPrimitives().push(I),v},createTexturedSphereGeometry:g,createTexturedFullScreenFakeQuadGeometry:A,createAxisGeometry:d,createTexturedSphere:g,createGridGeometry:function(e,t,i,n,l,u,h,c,A,d,g){e=void 0!==e?e:-.5,t=void 0!==t?t:-.5,i=void 0!==i?i:0,n=void 0!==n?n:1,l=void 0!==l?l:0,u=void 0!==u?u:0,h=void 0!==h?h:0,c=void 0!==c?c:1,A=void 0!==A?A:0,d=void 0!==d?d:5,g=void 0!==g?g:d,d+=2,g+=2;var f=new a.Z,p=new Float32Array(2*(d+g)*3),m=0,_=0,v=n/(d-1),C=l/(d-1),b=u/(d-1),S=e+n+h,E=t+l+c,y=i+u+A;for(m=0;m<d;++m)p[_=6*m]=e+v*m,p[_+1]=t+C*m,p[_+2]=i+b*m,p[_+3]=S-v*(d-m-1),p[_+4]=E-C*(d-m-1),p[_+5]=y-b*(d-m-1);for(v=h/(g-1),C=c/(g-1),b=A/(g-1),m=0;m<g;++m)p[_=6*(d+m)]=e+v*m,p[_+1]=t+C*m,p[_+2]=i+b*m,p[_+3]=S-v*(g-m-1),p[_+4]=E-C*(g-m-1),p[_+5]=y-b*(g-m-1);f.getAttributes().Vertex=new r.Z(r.Z.ARRAY_BUFFER,p,3);var I=new s.Z(o.Z.LINES,0,2*(d+g));return f.getPrimitives().push(I),f},createBoundingBoxGeometry:function(e){var t=new a.Z,i=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);t.getAttributes().Vertex=new r.Z(r.Z.ARRAY_BUFFER,i,3),e||(e=[1,0,0,1]);for(var n=new c.Z.Float32Array(32),s=0;s<8;s++)for(var u=0;u<4;u++)n[3*s+u]=e[u];t.getAttributes().Color=new r.Z(r.Z.ARRAY_BUFFER,n,4);var h=new c.Z.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return t.getPrimitives().push(new l.Z(o.Z.LINES,new r.Z("ELEMENT_ARRAY_BUFFER",h,1))),t}}},a72h:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={RELATIVE_RF:0,ABSOLUTE_RF:1}},"0rAA":(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var n=i("lZH+"),r=i.n(n),a=i("83E6"),o=i("Hfbx"),s={extend:function(){var e,t,i,n,r=window.Object.prototype.toString,a=window.Object.prototype.hasOwnProperty,o=function(e){return"[object Function]"===r.call(e)},l=s.isArray,u=function(e){if(!e||"[object Object]"!==r.call(e)||e.nodeType||e.setInterval)return!1;if(e.constructor&&!a.call(e,"constructor")&&!a.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||a.call(e,t)},h=arguments[0]||{},c=1,A=arguments.length,d=!1;for("boolean"==typeof h&&(d=h,h=arguments[1]||{},c=2),"object"==typeof h||o(h)||(h={}),A===c&&(h=this,--c);c<A;c++)if(null!==(e=arguments[c]))for(t in e)if(i=h[t],h!==(n=e[t]))if(d&&n&&(u(n)||l(n))){var g=i&&(u(i)||l(i))?i:l(n)?[]:{};h[t]=s.extend(d,g,n)}else void 0!==n&&(h[t]=n);return h},objectInherit:function(e){function t(){}t.prototype=e;for(var i=new t,n=1;n<arguments.length;n++)s.objectMix(i,arguments[n],!1);return i},objectMix:function(e,t,i){for(var n in t)i&&e[n]||(e[n]=t[n]);return e},objectType:{}};s.objectType.type=0,s.arrayDense=function(e,t,i){var n=t.length;if(e>=n)for(var r=n;r<=e;r++)t.push(i?i():null)},s.objectLibraryClass=function(e,t,i){e.className=function(){return i},e.libraryName=function(){return t};var n=t+"::"+i;return e.libraryClassName=function(){return n},e},s.setTypeID=function(e){var t=e.prototype.libraryClassName(),i=s.generateId(s.objectType,t);e.typeID=e.prototype.typeID=i,e.getTypeID=e.prototype.getTypeID=function(){return i}},s.createPrototypeObject=function(e,t,i,n){t.hasOwnProperty("getTypeID")&&(t=s.objectInherit(t,{})),e.prototype=t,t.constructor=e,i&&n&&(s.objectLibraryClass(t,i,n),s.setTypeID(e))},s.generateId=function(e,t){if(void 0!==e[t])return o.Z.error(t+" is already defined, change class name or library name"),-1;var i=e.type;return e[i]=t,e[t]=i,e.type+=1,i},s.objectNodeType={},s.objectNodeType.type=0,s.setNodeTypeID=function(e){var t=e.prototype.libraryClassName(),i=s.generateId(s.objectNodeType,t);e.nodeTypeID=e.prototype.nodeTypeID=i,e.getNodeTypeID=e.prototype.getNodeTypeID=function(){return i}},s.createPrototypeNode=function(e,t,n,r){var a=i("q8o9").Z,o=t.nodeTypeID;if(s.createPrototypeObject(e,t,n,r),n&&r){s.setNodeTypeID(e);var l=e.nodeTypeID;s.arrayDense(l,a.applyFunctionArray),a.registerApplyFunction(l,a.getApplyFunction(o))}};var l=0,u=0,h={},c={},A=0,d={};s.getStateAttributeTypeNameToTypeId=function(){return d},s.createPrototypeStateAttribute=function(e,t,i,n){s.createPrototypeObject(e,t,i,n);var r=s.getOrCreateStateAttributeTypeId(e);e.prototype.attributeTypeId=r},s.getMaxStateAttributeTypeID=function(){return A},s.getOrCreateStateAttributeTypeId=function(e){var t=e.prototype.getType();if(d[t])return d[t];var i=A++;return d[t]=i,i},s.getOrCreateStateAttributeTypeMemberIndex=function(e){if(void 0!==e._attributeTypeIndex)return e._attributeTypeIndex;var t=e.getTypeMember();return e._attributeTypeIndex=s.getOrCreateStateAttributeTypeMemberIndexFromName(t),e._attributeTypeIndex},s.getOrCreateStateAttributeTypeMemberIndexFromName=function(e){var t=h[e];return void 0!==t||(t=l++,h[e]=t),t},s.getOrCreateTextureStateAttributeTypeMemberIndex=function(e){if(void 0!==e._attributeTypeIndex)return e._attributeTypeIndex;var t=e.getTypeMember();return e._attributeTypeIndex=s.getOrCreateTextureStateAttributeTypeMemberIndexFromName(t),e._attributeTypeIndex},s.getOrCreateTextureStateAttributeTypeMemberIndexFromName=function(e){var t=c[e];return void 0!==t||(t=u++,c[e]=t),t},s.getIdFromTypeMember=function(e){return h[e]},s.getTextureIdFromTypeMember=function(e){return c[e]},s.Int8Array=window.Int8Array,s.Uint8Array=window.Uint8Array,s.Uint8ClampedArray=window.Uint8ClampedArray,s.Int16Array=window.Int16Array,s.Uint16Array=window.Uint16Array,s.Int32Array=window.Int32Array,s.Uint32Array=window.Uint32Array,s.Float32Array=window.Float32Array,s.Float64Array=window.Float64Array;var g={},f={};s.logTime=(o.Z.console.time||function(e){g[e]=a.Z.instance().tick()}).bind(o.Z.console),s.logTimeEnd=(o.Z.console.timeEnd||function(e){if(void 0!==g[e]){var t=a.Z.instance().deltaM(g[e],a.Z.instance().tick());o.Z.log(e+": "+t+"ms"),g[e]=void 0}}).bind(o.Z.console),s.time=function(e,t){var i=t;void 0===i&&(i=o.Z.NOTICE),i>o.Z.getNotifyLevel()||(f[e]=1,s.logTime(e))},s.timeEnd=function(e){void 0!==f[e]&&s.logTimeEnd(e)},s.profile=(o.Z.console.profile||function(){}).bind(o.Z.console),s.profileEnd=(o.Z.console.profileEnd||function(){}).bind(o.Z.console),s.arrayUniq=function(e){for(var t=e.length,i={},n=[],r=0,a=0;a<t;a++){var o=e[a];1!==i[o]&&(i[o]=1,n[r++]=o)}return n},s.rejectObject=function(e,t){return t&&(e="Invalid json "+e+" "+Object.keys(t)),o.Z.warn(e),r().reject(e)},s.setStateAttributeConfig=function(e,t){e.stateAttributeConfig=t,t.attribute.forEach(s.getOrCreateStateAttributeTypeMemberIndexFromName),t.textureAttribute.forEach(s.getOrCreateTextureStateAttributeTypeMemberIndexFromName),e.validAttributeTypeMember=t.attribute,e.validTextureAttributeTypeMember=t.textureAttribute};const p=s},mVLc:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("vrBm"),a=i("aS0i"),o=function(){r.Z.call(this)};o.checkPathIsAnimated=function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t];if(n instanceof a.Z)for(var r=n.getUpdateCallbackList(),s=0,l=r.length;s<l;++s)if(r[s]instanceof o)return!0}return!1},n.Z.createPrototypeObject(o,n.Z.objectInherit(r.Z.prototype,{computeChannels:function(){},reset:function(){}}),"osgAnimation","AnimationUpdateCallback");const s=o},KiRa:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i("0rAA"),r=i("Xbee"),a=i("Ko9s"),o=i("aS0i"),s=i("tt4o"),l=function(e){void 0!==e&&this.setName(e),o.Z.call(this),this._invBindInSkeletonSpace=r._E.create(),this._boneInSkeletonSpace=r._E.create(),this._boneBoundingBox=new a.Z};n.Z.createPrototypeNode(l,n.Z.objectInherit(o.Z.prototype,{getOrCreateDebugColor:function(){return this._boneColor||(this.isSkinning()?this._boneColor=r.R3.fromValues(Math.random(),Math.random(),Math.random()):this._boneColor=r.R3.fromValues(.8,.8,.8)),this._boneColor},isSkinning:function(){return void 0!==this.userDataMap.rigIndex},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(e){this._boneBoundingBox=e},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(e){r._E.copy(this._boneInSkeletonSpace,e)},setInvBindMatrixInSkeletonSpace:function(e){r._E.copy(this._invBindInSkeletonSpace,e)},getBoneParent:function(){for(var e=this.getParents(),t=0,i=e.length;t<i;t++){if(e[t].getTypeID()===l.getTypeID())return e[t]}},setDefaultUpdateCallback:function(e){this.addUpdateCallback(new s.Z(void 0!==e?e:this.getName()))}}),"osgAnimation","Bone");const u=l},"55Qt":(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("QrwD"),a=i("LZhK"),o=function(e,t){r.Z.call(this),this._nbTarget=e,this._enable=!t,this._targetNames={},this._hashNames="",this._hash="",this._dirtyHash=!0};o.uniforms={},n.Z.createPrototypeStateAttribute(o,n.Z.objectInherit(r.Z.prototype,{attributeType:"Morph",cloneType:function(){return new o(void 0,!0)},hasTarget:function(e){return!!this._targetNames[e]},copyTargetNames:function(e){for(var t=this._targetNames,i="",n=t.length=e.length,r=0;r<n;++r){var a=e[r];t[a]=!0,i+=a}this._hashNames=i,this._dirtyHash=!0},getOrCreateUniforms:function(){var e=o,t=this.getNumTargets();return e.uniforms[t]||(e.uniforms[t]={uTargetWeights:a.Z.createFloat4("uTargetWeights")}),e.uniforms[t]},setNumTargets:function(e){this._nbTarget=e,this._dirtyHash=!0},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(e){this._targetWeights=e},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uTargetWeights.setFloat4(this._targetWeights)}}),"osgAnimation","MorphAttribute");const s=o},Zodj:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var n,r=i("0rAA"),a=i("JWq/"),o=i("Hfbx"),s=i("Xbee"),l=i("EUBb"),u=i("0/zD"),h=i("55Qt"),c=i("QrwD"),A=i("Ko9s"),d=function(){l.Z.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new u.Z,this._targetWeights=new Float32Array(d.MAX_MORPH_GPU),this._morphAttribute=void 0,this._morphTargetNames=void 0,this._maxMorphGPU=d.MAX_MORPH_GPU,this._isInitialized=!1};d.MAX_MORPH_GPU=4,r.Z.createPrototypeNode(d,r.Z.objectInherit(l.Z.prototype,{init:function(){return this._morphAttribute?(this._isInitialized=!0,!1):(this._morphAttribute=new h.Z(Math.min(this._maxMorphGPU,this.getMorphTargets().length)),this.getStateSetAnimation().setAttributeAndModes(this._morphAttribute,c.Z.ON),this._morphAttribute.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),this._morphAttribute.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],o.Z.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0)},getMaximumPossibleMorphGPU:function(){return this._maxMorphGPU},setMaximumPossibleMorphGPU:function(e){this._maxMorphGPU=e,this._isInitialized=!1,this._morphAttribute&&this._morphAttribute.setNumTargets(e)},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:(n=new A.Z,function(e){l.Z.prototype.computeBoundingBox.call(this,e);for(var t=0,i=this._targets.length;t<i;t++)e.expandByBoundingBox(this._targets[t].computeBoundingBox(n));return e}),mergeChildrenVertexAttributeList:function(){for(var e=0,t=this._targets.length;e<t;e++){var i=this._targets[e],n=i.getVertexAttributeList();for(var r in n){var o=n[r];o&&!o.getBufferArray&&(n[r]=new a.Z(o))}l.Z.appendVertexAttributeToList(i.getVertexAttributeList(),this.getVertexAttributeList(),e)}},_computeEffectiveSumWeights:function(){for(var e=0,t=this._targetWeights,i=0,n=t.length;i<n;++i){var r=t[i];Math.abs(r)<=d.EFFECTIVE_EPS||(e+=r)}var a=1e-5;return Math.abs(e)>a?e:e<0?-a:a},computeTransformedVertex:function(e,t){t=t||s.R3.create();var i=3*e,n=this._targetWeights,r=this.getVertexAttributeList(),a=r.Vertex.getElements(),o=1-this._computeEffectiveSumWeights();t[0]=o*a[i],t[1]=o*a[i+1],t[2]=o*a[i+2];for(var l=0,u=n.length;l<u;++l){var h=n[l];if(!(Math.abs(h)<=d.EFFECTIVE_EPS)){var c=r["Vertex_"+l].getElements();t[0]+=h*c[i],t[1]+=h*c[i+1],t[2]+=h*c[i+2]}}return t},computeTransformedVertices:function(){for(var e=this._targetWeights,t=this.getVertexAttributeList(),i=t.Vertex.getElements(),n=i.length,r=this._morphedVerts=this._morphedVerts||new Float32Array(n),a=1-this._computeEffectiveSumWeights(),o=0;o<n;++o)r[o]=a*i[o];for(var s=0,l=e.length;s<l;++s){var u=e[s];if(!(Math.abs(u)<=d.EFFECTIVE_EPS))for(var h=t["Vertex_"+s].getElements(),c=0;c<n;++c)r[c]+=u*h[c]}return r}}),"osgAnimation","MorphGeometry");const g=d},eyVe:(e,t,i)=>{"use strict";i.d(t,{Z:()=>R});var n=i("0rAA"),r=i("Xbee"),a=i("EUBb"),o=i("Hfbx"),s=i("EZIT"),l=i("0/zD"),u=i("Zodj"),h=i("vrBm"),c=i("2bAw"),A=i("M6jq"),d=function(){c.Z.call(this,c.Z.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};n.Z.createPrototypeObject(d,n.Z.objectInherit(c.Z.prototype,{apply:function(e){if(!this._root)return e.typeID===A.Z.typeID?(this._root=e,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(e)}}),"osgAnimation","FindNearestParentSkeleton");const g=d;var f=function(){h.Z.call(this)};n.Z.createPrototypeObject(f,n.Z.objectInherit(h.Z.prototype,{init:function(e){var t=new g;e.getParents().length>1&&o.Z.warn("A RigGeometry should not have multi parent ( "+e.getName()+" )"),e.getParents()[0].accept(t),t._root?(e.setSkeleton(t._root),e.setPathToSkeleton(t._pathToRoot)):o.Z.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+e.getName()+" )")},update:function(e){if(e&&"RigGeometry"!==e.className())return!0;var t=e;return t.getSkeleton()||0===t.getParents().length||this.init(t),!t.getSkeleton()||(t.getNeedToComputeMatrix()&&t.computeMatrixFromRootSkeleton(),t.update(),!0)}}),"osgAnimation","UpdateRigGeometry");const p=f;var m=i("QrwD"),_=i("q/dS"),v=i("KiRa"),C=function(){c.Z.call(this,c.Z.TRAVERSE_ALL_CHILDREN),this._boneMap={}};n.Z.createPrototypeObject(C,n.Z.objectInherit(c.Z.prototype,{apply:function(e){if(e.typeID===v.Z.typeID){var t=e.getName();t?this._boneMap[t]=e:o.Z.warn("found Bone without name")}this.traverse(e)},getBoneMap:function(){return this._boneMap}}),"osgAnimation","CollectBoneVisitor");const b=C;var S,E=function(){this._isInitialized=!1,this._bones=[]};E.prototype={computeBonePalette:function(e,t){var i=this._bones;for(var n in e){var r=t[n],a=e[n];void 0!==r&&(i[r]=a)}return i},init:function(e){var t=new b;e.getSkeleton().accept(t);var i=t.getBoneMap();this.computeBonePalette(i,e._boneNameID);var n=3*this._bones.length,r=this._skinningAttribute=new _.Z;return r.setMatrixPalette(new Float32Array(4*n)),e.getStateSetAnimation().setAttributeAndModes(r,m.Z.ON),this._isInitialized=!0,!0},computeMatrixPalette:(S=r._E.create(),function(e,t){for(var i=this._bones,n=this._skinningAttribute.getMatrixPalette(),a=0,o=0,s=i.length;o<s;o++){var l=i[o],u=l.getInvBindMatrixInSkeletonSpace(),h=l.getMatrixInSkeletonSpace();r._E.mul(S,h,u),r._E.mul(S,t,S),r._E.mul(S,S,e),n[a++]=S[0],n[a++]=S[4],n[a++]=S[8],n[a++]=S[12],n[a++]=S[1],n[a++]=S[5],n[a++]=S[9],n[a++]=S[13],n[a++]=S[2],n[a++]=S[6],n[a++]=S[10],n[a++]=S[14]}}),update:function(e){this._isInitialized||this.init(e),this.computeMatrixPalette(e.getMatrixFromSkeletonToGeometry(),e.getInvMatrixFromSkeletonToGeometry())}};const y=E;var I=i("mVLc"),x=i("z6Oe"),T=function(){a.Z.call(this),this._shape=null,this.addUpdateCallback(new p),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=r._E.create(),this._invMatrixFromSkeletonToGeometry=r._E.create(),this._rigTransformImplementation=new y,this._geometry=void 0,this._stateSetAnimation=new l.Z,this._needToComputeMatrix=!0},w=r.R3.create(),M=r.R3.create();n.Z.createPrototypeNode(T,n.Z.objectInherit(a.Z.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(e){this._root=e},setPathToSkeleton:function(e){this._pathToRoot=e,this._isAnimatedPath=I.Z.checkPathIsAnimated(e)},setNeedToComputeMatrix:function(e){this._needToComputeMatrix=e},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},separateStaticBoxInGeometry:function(e,t){var i=this.getBoundingBox();if(i.valid()&&!this._staticGeomAdded){this._staticGeomAdded=!0,i.center(w),r.R3.sub(M,i.getMax(),i.getMin());var n=s.Z.createTexturedBoxGeometry(w[0],w[1],w[2],M[0],M[1],M[2]);n.setName("BoneBox"),n.setName("staticBoxOf:"+this.getName());for(var a=this.getParents(),o=0;o<a.length;++o)a[o].addChild(n);n.setCullCallback(e),n.setNodeMask(t),i.init(),this.getBoundingSphere().init()}},computeBoundingBox:function(e){e.init();var t=this.getVertexAttributeList().Vertex,i=this.getVertexAttributeList().Weights;if(t&&i&&t.getElements()&&t.getItemSize()>2){for(var n=i.getElements(),r=t.getElements(),a=t.getItemSize(),o=e.getMin(),s=e.getMax(),l=o[0],u=o[1],h=o[2],c=s[0],A=s[1],d=s[2],g=0,f=0,p=r.length;g<p;g+=a,f+=4)if(0===n[g]&&0===n[g+1]&&0===n[g+2]&&0===n[g+3]){var m=r[g],_=r[g+1],v=r[g+2];m<l&&(l=m),m>c&&(c=m),_<u&&(u=_),_>A&&(A=_),v<h&&(h=v),v>d&&(d=v)}o[0]=l,o[1]=u,o[2]=h,s[0]=c,s[1]=A,s[2]=d}return e},computeMatrixFromRootSkeleton:function(){this._root?(r._E.identity(this._matrixFromSkeletonToGeometry),x.Z.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),r._E.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),this._isAnimatedPath||(this._needToComputeMatrix=!1)):o.Z.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph")},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(e){this._geometry=e},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(e){this._boneNameID=e},mergeChildrenVertexAttributeList:function(){this._geometry instanceof u.Z&&this._geometry.mergeChildrenVertexAttributeList();var e=this._geometry.getVertexAttributeList();a.Z.appendVertexAttributeToList(e,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var e=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var t=0,i=e.length;t<i;t++)this.getPrimitiveSetList()[t]=e[t];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(e,t){t=t||r.R3.create();var i=this.getVertexAttributeList(),n=i.Weights.getElements(),a=i.Bones.getElements(),o=0,s=0,l=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(e,t),o=t[0],s=t[1],l=t[2];else{var u=i.Vertex.getElements();o=u[3*e],s=u[3*e+1],l=u[3*e+2]}for(var h=4*e,c=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),A=0,d=0,g=0,f=0,p=0,m=0,_=0,v=0,C=0,b=0,S=0,E=0,y=0,I=!1,x=0;x<4;++x){var T=n[h+x];if(0!==T){var w=12*a[h+x];A+=c[w+0]*T,f+=c[w+1]*T,_+=c[w+2]*T,b+=c[w+3]*T,d+=c[w+4]*T,p+=c[w+5]*T,v+=c[w+6]*T,S+=c[w+7]*T,g+=c[w+8]*T,m+=c[w+9]*T,C+=c[w+10]*T,E+=c[w+11]*T,y+=T,I=!0}}I||(t[0]=o,t[1]=s,t[2]=l);var M=1/y;return t[0]=(A*o+f*s+_*l+b)*M,t[1]=(d*o+p*s+v*l+S)*M,t[2]=(g*o+m*s+C*l+E)*M,t},computeTransformedVertices:function(){for(var e=this.getVertexAttributeList(),t=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():e.Vertex.getElements(),i=e.Weights.getElements(),n=e.Bones.getElements(),r=this._riggedVerts||new Float32Array(t.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),o=0,s=0,l=t.length;o<l;o+=3,s+=4){var u,h=0,c=0,A=0,d=0,g=0,f=0,p=0,m=0,_=0,v=0,C=0,b=0,S=0,E=!1,y=i[s];0!==y&&(h+=a[(u=12*n[s])+0]*y,d+=a[u+1]*y,p+=a[u+2]*y,v+=a[u+3]*y,c+=a[u+4]*y,g+=a[u+5]*y,m+=a[u+6]*y,C+=a[u+7]*y,A+=a[u+8]*y,f+=a[u+9]*y,_+=a[u+10]*y,b+=a[u+11]*y,S+=y,E=!0),0!==(y=i[s+1])&&(h+=a[(u=12*n[s+1])+0]*y,d+=a[u+1]*y,p+=a[u+2]*y,v+=a[u+3]*y,c+=a[u+4]*y,g+=a[u+5]*y,m+=a[u+6]*y,C+=a[u+7]*y,A+=a[u+8]*y,f+=a[u+9]*y,_+=a[u+10]*y,b+=a[u+11]*y,S+=y,E=!0),0!==(y=i[s+2])&&(h+=a[(u=12*n[s+2])+0]*y,d+=a[u+1]*y,p+=a[u+2]*y,v+=a[u+3]*y,c+=a[u+4]*y,g+=a[u+5]*y,m+=a[u+6]*y,C+=a[u+7]*y,A+=a[u+8]*y,f+=a[u+9]*y,_+=a[u+10]*y,b+=a[u+11]*y,S+=y,E=!0),0!==(y=i[s+3])&&(h+=a[(u=12*n[s+3])+0]*y,d+=a[u+1]*y,p+=a[u+2]*y,v+=a[u+3]*y,c+=a[u+4]*y,g+=a[u+5]*y,m+=a[u+6]*y,C+=a[u+7]*y,A+=a[u+8]*y,f+=a[u+9]*y,_+=a[u+10]*y,b+=a[u+11]*y,S+=y,E=!0);var I=t[o],x=t[o+1],T=t[o+2];if(E){var w=1/S;r[o]=(h*I+d*x+p*T+v)*w,r[o+1]=(c*I+g*x+m*T+C)*w,r[o+2]=(A*I+f*x+_*T+b)*w}else r[o]=I,r[o+1]=x,r[o+2]=T}return r}}),"osgAnimation","RigGeometry");const R=T},M6jq:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A});var n=i("0rAA"),r=i("aS0i"),a=i("LAkO"),o=i("2bAw"),s=i("Fyvm"),l=i("KiRa"),u=function(){o.Z.call(this,o.Z.TRAVERSE_ALL_CHILDREN)};n.Z.createPrototypeObject(u,n.Z.objectInherit(o.Z.prototype,{apply:function(e){if(e.getTypeID()===l.Z.getTypeID()){var t=e.getUpdateCallback();if(t instanceof s.Z){for(var i=t._stackedTransforms,n=0,r=i.length;n<r;n++){i[n].resetToDefaultValue()}t.computeChannels()}}this.traverse(e)}}),"osgAnimation","ResetRestPoseVisitor");var h=new u,c=function(){r.Z.call(this)};n.Z.createPrototypeNode(c,n.Z.objectInherit(r.Z.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new a.Z)},setRestPose:function(){this.accept(h)}}),"osgAnimation","Skeleton");const A=c},"q/dS":(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("QrwD"),a=i("LZhK"),o=function(e,t){r.Z.call(this),this._enable=!e,this._boneUniformSize=t,this._dirtyHash=!0,this._hash=""};o.uniforms={},o.maxBoneUniformSize=1,o.maxBoneUniformAllowed=1/0,n.Z.createPrototypeStateAttribute(o,n.Z.objectInherit(r.Z.prototype,{attributeType:"Skinning",cloneType:function(){return new o(!0)},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:o.maxBoneUniformSize},getOrCreateUniforms:function(){var e=o,t=this.getBoneUniformSize();return e.uniforms[t]||(e.uniforms[t]={uBones:a.Z.createFloat4Array("uBones",t)}),e.uniforms[t]},setMatrixPalette:function(e){this._matrixPalette=e,void 0===this._boneUniformSize&&(o.maxBoneUniformSize=Math.max(o.maxBoneUniformSize,e.length/4),o.maxBoneUniformSize=Math.min(o.maxBoneUniformAllowed,o.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!0,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.getInternalArray().set(this._matrixPalette)}}),"osgAnimation","SkinningAttribute");const s=o},tt4o:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i("0rAA"),r=i("Hfbx"),a=i("Fyvm"),o=i("Xbee"),s=i("2bAw"),l=function(){a.Z.call(this)};n.Z.createPrototypeObject(l,n.Z.objectInherit(a.Z.prototype,{update:function(e,t){if(t.getVisitorType()===s.Z.UPDATE_VISITOR){if(e.className&&"Bone"!==e.className())return r.Z.warn("Warning: UpdateBone set on non-Bone object."),!1;var i=e;a.Z.prototype.update.call(this,e),i.setMatrix(i.getMatrix());var n=i.getMatrix(),l=i.getBoneParent();l?o._E.mul(i.getMatrixInSkeletonSpace(),l.getMatrixInSkeletonSpace(),n):i.setMatrixInSkeletonSpace(n)}return!0}}),"osgAnimation","UpdateBone");const u=l},Fyvm:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("Xbee"),a=i("mVLc"),o=function(){a.Z.call(this),this._stackedTransforms=[],this._matrix=r._E.create(),this._dirty=!1};n.Z.createPrototypeObject(o,n.Z.objectInherit(a.Z.prototype,{getStackedTransforms:function(){return this._stackedTransforms},setMatrix:function(e){r._E.copy(this._matrix,e),this._dirty=!0},getMatrix:function(){return this._matrix},computeChannels:function(){this._dirty=!0;var e=this._matrix;r._E.identity(e);for(var t=this._stackedTransforms,i=0,n=t.length;i<n;i++){t[i].applyToMatrix(e)}},reset:function(){for(var e=this._stackedTransforms,t=0,i=e.length;t<i;t++)e[t].resetToDefaultValue();this.computeChannels()},update:function(e){return r._E.copy(e.getMatrix(),this._matrix),this._dirty&&(e.dirtyBound(),this._dirty=!1),!0}}),"osgAnimation","UpdateMatrixTransform");const s=o},LAkO:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("0rAA"),r=i("KiRa"),a=i("2bAw"),o=i("Hfbx"),s=i("vrBm"),l=function(){a.Z.call(this)};n.Z.createPrototypeObject(l,n.Z.objectInherit(a.Z.prototype,{apply:function(e){if(e.getTypeID()===r.Z.getTypeID()){for(var t=!1,i=e.getChildren(),n=0,a=e.getChildren().length;n<a;n++){if(i[n].getTypeID()===r.Z.getTypeID()){if(t)return void o.Z.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else t=!0}this.traverse(e)}}}),"osgAnimation","ValidateSkeletonVisitor");var u=function(e,t){return(e instanceof r.Z?0:1)-(t instanceof r.Z?0:1)},h=function(){this._needValidate=!0};n.Z.createPrototypeObject(h,n.Z.objectInherit(s.Z.prototype,{needToValidate:function(){return this._needValidate},update:function(e,t){if(this._needValidate&&t.getVisitorType()===a.Z.UPDATE_VISITOR&&e.className&&"Skeleton"===e.className()){for(var i=new l,n=e.getChildren(),r=0,o=n.length;r<o;r++){n[r].accept(i)}n.sort(u),this._needValidate=!1}return!0}}),"osgAnimation","UpdateSkeleton");const c=h},WClw:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var n=i("lZH+"),r=i.n(n),a=i("0rAA"),o=i("2bAw"),s=i("Rqdv"),l=i("83E6"),u=function(){o.Z.call(this,o.Z.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=void 0,this._frameNumber=0};a.Z.createPrototypeObject(u,a.Z.objectInherit(o.Z.prototype,{apply:function(e){e.getTypeID()===s.Z.getTypeID()&&(e.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(e)),this.traverse(e)},set:function(e,t){this._activePagedLODList=e,this._frameNumber=t}}),"osgDB","FindPagedLODsVisitor");var h=function(){o.Z.call(this,o.Z.TRAVERSE_ALL_CHILDREN)};a.Z.createPrototypeObject(h,a.Z.objectInherit(o.Z.prototype,{apply:function(e){e.releaseGLObjects(),this.traverse(e)}}),"osgDB","ReleaseVisitor");var c=function(){o.Z.call(this,o.Z.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};a.Z.createPrototypeObject(c,a.Z.objectInherit(o.Z.prototype,{apply:function(e){e.getTypeID()===s.Z.getTypeID()&&(this._childrenList.push(e),this._markRequestsExpired(e)),this.traverse(e)},removeExpiredChildrenAndFindPagedLODs:function(e,t,i,n){if(!e.children.length)return!1;var r=n.length;e.removeExpiredChildren(t,i,n);for(var a=r;a<n.length;a++)n[a].accept(this);return r!==n.length},_markRequestsExpired:function(e){for(var t,i=e._perRangeDataList.length,n=0;n<i;n++)void 0!==(t=e.getDatabaseRequest(n))&&(t._groupExpired=!0,t._loadedModel=null)},reset:function(){this._childrenList.length=0}}),"osgDB","ExpiredPagedLODVisitor");var A=function(e,t){return t._timeStamp-e._timeStamp},d=function(e,t){var i=e._timeStamp-t._timeStamp;return 0===i&&(i=e._priority-t._priority),i},g=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._releaseVisitor=new h,this._expiredPagedLODVisitor=new c,this._findPagedLODsVisitor=new u,this._targetMaximumNumberOfPagedLOD=75,this._elapsedTime=0,this._beginTime=0,this._availableTime=0},f=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0};a.Z.createPrototypeObject(g,{setTargetMaximumNumberOfPageLOD:function(e){this._targetMaximumNumberOfPagedLOD=e},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(e){this._acceptNewRequests=e},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(e){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(e,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(e,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(e){this._maxRequestsPerFrame=e},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(e){this._progressCallback=e},addLoadedDataToSceneGraph:function(e,t){if(!this._pendingNodes.length||t<=0)return 0;var i=0,n=l.Z.instance().tick();this._pendingNodes.sort(A);for(var r=0;r<this._pendingNodes.length;r++){if(i>t)return 0;var a=this._pendingNodes.shift(),o=e.getFrameNumber(),s=e.getSimulationTime();if(!1===a._groupExpired){var u=a._group;u.setTimeStamp(u.children.length,s),u.setFrameNumber(u.children.length,o),u.addChildNode(a._loadedModel),this._activePagedLODList.has(u)?this.registerPagedLODs(a._loadedModel,o):this.registerPagedLODs(u,o)}else a._loadedModel=void 0,a=void 0;i=l.Z.instance().deltaS(n,l.Z.instance().tick())}return t-=i},isLoading:function(){return this._loading},registerPagedLODs:function(e,t){e&&(this._findPagedLODsVisitor.set(this._activePagedLODList,t),e.accept(this._findPagedLODsVisitor))},requestNodeFile:function(e,t,i,n,r){if(this._acceptNewRequests){var a=new f;return a._group=i,a._function=e,a._url=t,a._timeStamp=n,a._priority=r,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var e=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(d);for(var t=0;t<e;t++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(e){this._loading=!0;var t=this;if(e._groupExpired)return t._downloadingRequestsNumber--,void(this._loading=!1);void 0!==e._function?this.loadNodeFromFunction(e._function,e._group).then((function(i){t._downloadingRequestsNumber--,e._loadedModel=i,t._pendingNodes.push(e),t._loading=!1})):""!==e._url&&this.loadNodeFromURL(e._url).then((function(i){t._downloadingRequestsNumber--,e._loadedModel=i,t._pendingNodes.push(e),t._loading=!1}))},loadNodeFromFunction:function(e,t){var i=e(t);return i?i&&i.then?i:r().resolve(i):r().reject()},loadNodeFromURL:function(e){return i("B3Qy").Z.readNodeURL(e)},releaseGLExpiredSubgraphs:function(e){return this._availableTime=e,!this._childrenToRemoveList.size||e<=0?0:(this._elapsedTime=0,this._beginTime=l.Z.instance().tick(),this._childrenToRemoveList.forEach(this._releaseExpiredSubgraphs,this),this._availableTime-=this._elapsedTime,this._availableTime)},_releaseExpiredSubgraphs:function(e){this._elapsedTime>this._availableTime||(this._childrenToRemoveList.delete(e),e.accept(this._releaseVisitor),e.removeChildren(),e=null,this._elapsedTime=l.Z.instance().deltaS(this._beginTime,l.Z.instance().tick()))},removeExpiredSubgraphs:function(e,t){if(0===e.getFrameNumber())return 0;var i=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,n=e.getSimulationTime()-.1,r=e.getFrameNumber()-1;return i>0&&(t=this.removeExpiredChildren(i,n,r,t)),t},removeExpiredChildren:function(e,t,i,n){var r=0,a=l.Z.instance().tick(),o=this,s=[],u=this._expiredPagedLODVisitor;return u.reset(),this._activePagedLODList.forEach((function(h){if(r>n)return 0;if(e<0)return n;if(i<h.getFrameNumberOfLastTraversal())return n;u.removeExpiredChildrenAndFindPagedLODs(h,t,i,s);for(var c=0;c<u._childrenList.length;c++)o._activePagedLODList.delete(u._childrenList[c]),e--;for(c=0;c<s.length;c++)o._childrenToRemoveList.add(s[c]);u._childrenList.length=0,s.length=0,r=l.Z.instance().deltaS(a,l.Z.instance().tick())})),n-=r}},"osgDB","DatabasePager");const p=g},QJj4:(e,t,i)=>{"use strict";i.d(t,{Z:()=>C});var n=i("lZH+"),r=i.n(n),a=i("0rAA"),o=i("+qlm"),s=i("pSCg");const l={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};var u,h=i("kn/7"),c=i("Hfbx"),A=i("BfDR"),d=i("LERn"),g=i("epKp"),f=i("NzKe"),p=i("TYv3"),m=i("nMbz"),_=a.Z.rejectObject,v=function(e,t){this._json=e;var i=t;void 0===i&&(i={}),this._identifierMap=i,this._objectRegistry={},this._cacheReadObject={},this.setOptions(a.Z.objectMix({},l))};v.imageFallback||(v.imageFallback=((u=new window.Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",u)),v.prototype={clone:function(){var e=new v;return e._objectRegistry=this._objectRegistry,e._cacheReadObject=this._cacheReadObject,e},setOptions:function(e){this._defaultOptions=e},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(e){this._defaultOptions.progressXHRCallback=e},setReadNodeURLCallback:function(e){this._defaultOptions.readNodeURL=e},registerObject:function(e,t){this._objectRegistry[e]=t},getJSON:function(){return this._json},setJSON:function(e){return this._json=e,this},setPrefixURL:function(e){this._defaultOptions.prefixURL=e},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(e){this._defaultOptions.databasePath=e},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(e){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+e:e},requestFile:function(e,t){return s.Z.requestURI(e,t)},getObjectWrapper:function(e){if(this._objectRegistry[e])return new this._objectRegistry[e];for(var t=o.Z,i=e.split("."),n=0,r=i.length;n<r;n++){var a=t[i[n]];if(void 0===a)return;t=a}return this._objectRegistry[e]=t,new t},fetchImage:function(e,t,i){var n="data:image/",a=t.substring(0,n.length)===n,o=new window.Image;return!a&&i.imageCrossOrigin&&(o.crossOrigin=i.imageCrossOrigin),e.setURL(t),e.setImage(o),o.src=t,new(r())((function(n){o.onerror=function(){c.Z.warn("warning use white texture as fallback instead of "+t),e.setImage(v.imageFallback),n(e)},o.onload=function(){i.imageOnload&&i.imageOnload.call(e),n(e)}}))},readImageURL:function(e,t){if(void 0===t&&(t=this._defaultOptions),t.readImageURL)return t.readImageURL.call(this,e,t);"data:image"!==e.substr(0,10)&&(e=this.computeURL(e));var i=new A.Z;return this.fetchImage(i,e,t)},readNodeURL:function(e,t){var n=t;if(void 0===n&&(n=this._defaultOptions),n.readNodeURL)return n.readNodeURL.call(this,e,n);e=this.computeURL(e);var r=this;if(!(n=a.Z.objectMix({},n)).prefixURL){var o=r.getPrefixURL(),s=e.lastIndexOf("/");-1!==s&&(o=e.substring(0,s+1)),n.prefixURL=o}var l=i("B3Qy").Z,u=function(t){return l.parseSceneGraph(t,n).then((function(t){return c.Z.log("loaded "+e),t}))};return a.Z.time("osgjs.metric:Input.readNodeURL",c.Z.INFO),r.requestFile(e).then((function(t){var i;try{i=JSON.parse(t)}catch(t){c.Z.error("cant parse url "+e+" try to gunzip")}return i?u(i):r.requestFile(e,{responseType:"arraybuffer"}).then((function(e){var t,n,r=(n=t=e,h.Z.isGunzipBuffer(t)&&(n=h.Z.gunzip(t)),function(e){for(var t,i="",n=0,r=e.length;n<r;++n)i+="%"+((t=e[n].toString(16)).length<2?"0"+t:t);return decodeURIComponent(i)}(new Uint8Array(n)));return i=JSON.parse(r),u(i)})).catch((function(t){var i="cant read file "+e+" status "+t;return c.Z.error(i),i}))})).catch((function(t){var i="cant get file "+e+" status "+t;return c.Z.error(i),i})).finally((function(){a.Z.timeEnd("osgjs.metric:Input.readNodeURL")}))},_unzipTypedArray:function(e){var t=new Uint8Array(e);if(31===t[0]&&139===t[1]){var n=i("zpE6");return n||c.Z.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server"),new n.Gunzip(t).decompress().buffer}return e},readBinaryArrayURL:function(e,t){if(void 0===t&&(t=this._defaultOptions),t.readBinaryArrayURL)return t.readBinaryArrayURL.call(this,e,t);if(e=this.computeURL(e),void 0!==this._identifierMap[e])return this._identifierMap[e];var i=this.requestFile(e,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback}),n=this;return this._identifierMap[e]=i.then((function(e){return n._unzipTypedArray(e)})),this._identifierMap[e]},initializeBufferArray:function(e,t,i,n){if(void 0===n&&(n=this.getOptions()),n.initializeBufferArray)return n.initializeBufferArray.call(this,e,t,i);var r=e.File;return this.readBinaryArrayURL(r).then((function(n){var r,o,s,l;s=new Uint8Array([18,52]),l=new Uint16Array(s.buffer),o="1234"===l[0].toString(16);var u=0;void 0!==e.Offset&&(u=e.Offset);var h=a.Z[t].BYTES_PER_ELEMENT,A=e.Size,d=i.getItemSize(),g=A*h*d;if(o){c.Z.log("big endian detected");var f=new(0,a.Z[t])(A*d),p=new DataView(n,u,g),m=0,_=f.length;if("Uint16Array"===t)for(;m<_;m++)f[m]=p.getUint16(m*h,!0);else if("Float32Array"===t)for(;m<_;m++)f[m]=p.getFloat32(m*h,!0);r=f,p=null}else r=new a.Z[t](n,u,d*A);return i.setElements(r),i}))},readBufferArray:function(e){var t,i,n=this.getJSON(),o=n.UniqueID;if(void 0!==o&&void 0!==(t=this._identifierMap[o]))return t;if(void 0===e&&(e=this.getOptions()),e.readBufferArray)return e.readBufferArray.call(this);if(!n.Elements&&!n.Array||!n.ItemSize||!n.Type)return _("BufferArray",n);if(n.Elements)i=r().resolve(new d.Z(d.Z[n.Type],n.Elements,n.ItemSize));else if(n.Array){var s,l,u=new d.Z(d.Z[n.Type]);if(u.setItemSize(n.ItemSize),n.Array.Float32Array?(s=n.Array.Float32Array,l="Float32Array"):n.Array.Uint16Array?(s=n.Array.Uint16Array,l="Uint16Array"):n.Array.Uint8Array&&(s=n.Array.Uint8Array,l="Uint8Array"),void 0===s)return _("Typed Array "+window.Object.keys(n.Array)[0]);s.File?i=this.initializeBufferArray(s,l,u):s.Elements&&(u.setElements(new a.Z[l](s.Elements)),i=r().resolve(u))}return void 0!==o&&(this._identifierMap[o]=i),i},readUserDataContainer:function(){var e,t=this.getJSON(),i=t.UniqueID;return void 0!==i&&void 0!==(e=this._identifierMap[i])?e.Values:(this._identifierMap[i]=t,t.Values)},readPrimitiveSet:function(){var e,t,i,n,a,o,s,l=this.getJSON(),u=l.DrawElementUShort||l.DrawElementUByte||l.DrawElementUInt||l.DrawElementsUShort||l.DrawElementsUByte||l.DrawElementsUInt,h=l.DrawArray||l.DrawArrays,c=l.DrawArrayLengths;if(u){if(void 0!==(e=u.UniqueID)&&void 0!==(t=this._identifierMap[e]))return t;a=u.Mode?m.Z[u.Mode]:m.Z.TRIANGLES,n=new p.Z(a),this.setJSON(u.Indices),i=this.readBufferArray().then((function(e){return n.setIndices(e),n})),this.setJSON(l)}else if(h){if(void 0!==(e=h.UniqueID)&&void 0!==(t=this._identifierMap[e]))return t;a=h.Mode||h.mode,o=void 0!==h.First?h.First:h.first,s=void 0!==h.Count?h.Count:h.count,n=new g.Z(m.Z[a],o,s),i=r().resolve(n)}else if(c){if(void 0!==(e=c.UniqueID)&&void 0!==(t=this._identifierMap[e]))return t;a=c.Mode,o=c.First;var A=c.ArrayLengths;n=new f.Z(m.Z[a],o,A),i=r().resolve(n)}else i=_("PrimitiveSet",l);return void 0!==e&&(this._identifierMap[e]=i),i},readObject:function(){var e=this.getJSON(),t=window.Object.keys(e),n=t[0];if(!n)return _("can't find property for object "+t);var r,a=e[n].UniqueID;if(void 0!==a&&void 0!==(r=this._identifierMap[a]))return r;var o=this.getObjectWrapper(n);if(!o)return _("can't instanciate object "+n);var s=i("B3Qy").Z.ObjectWrapper.serializers;if(this._cacheReadObject[n])s=this._cacheReadObject[n];else{for(var l=n.split("."),u=0,h=l.length;u<h;u++){var c=l[u],A=s[c];if(!A)return _("Unknown scope "+n+"("+c+")");s=A}this._cacheReadObject[n]=s}var d=s(this.setJSON(e[n]),o);return void 0!==a&&(this._identifierMap[a]=d,o._uniqueID=a),d}};const C=v},B2Ws:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("Hfbx"),r={instance:function(){return r._instance||(r._instance=r,r._instance.plugins=new window.Map),r._instance},addReaderWriter:function(e,t){void 0!==r.instance().plugins.get(e)&&n.Z.warn("the '"+e+"' plugin already exists"),r.instance().plugins.set(e,t)},getReaderWriterForExtension:function(e){return r.instance().plugins.get(e)}};const a=r},pSCg:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var n=i("lZH+"),r=i.n(n),a=i("B3Qy"),o=i("B2Ws"),s=i("8bNm"),l=i("Hfbx"),u=function(e){return"string"==typeof e||e instanceof String},h=window.zip,c=new window.Map,A=function(e){return new(r())((function(t,i){var n=new window.Image;n.onerror=function(){i(n)},n.onload=function(){t(n)},n.src=e}))},d=function(e){var t=window.URL.createObjectURL(e),i=A(t);return i.finally((function(){window.URL.revokeObjectURL(t)})),i},g=function(e){return new(r())((function(t,i){var n=new window.FileReader;n.onerror=function(){i(n)},n.onload=function(){t(this.result)},n.readAsArrayBuffer(e)}))},f=function(e){return(0,s.Z)(e,{responseType:"arraybuffer"})},p=function(e){return(0,s.Z)(e).then((function(e){return JSON.parse(e)}))},m=function(e){var t=JSON.parse(e);return r().resolve(t)},_={createJSONFromURL:p,createArrayBufferFromURL:f,createArrayBufferFromBlob:g,createImageFromBlob:d,createImageFromURL:A,requestURI:s.Z,requestResource:function(e,t){var i=_.getExtension(e),n=_.getMimeType(i);if(t&&t.responseType?t.responseType.toLowerCase():void 0)return(0,s.Z)(e,t);if(n){if(n.match("image"))return A(e);if(n.match("binary"))return f(e);if(n.match("json"))return p(e);if(n.match("text"))return(0,s.Z)(e)}return(0,s.Z)(e)},resolveData:function(e,t){var i,n,a=_.getExtension(e),o=_.getMimeType(a);return o&&(o.match("image")?u(t)?i=A:t instanceof window.Blob&&(i=d):o.match("json")?i=u(n=t)&&(function(e){return"blob:http"===e.substr(0,9)}(n)||function(e){return"http://"===e.substr(0,7)||"https://"===e.substr(0,8)}(n))?p:m:o.match("binary")&&(u(t)?i=f:t instanceof window.Blob&&(i=g))),i?i(t):r().resolve(t)},resolveFilesMap:function(e){var t=[];for(var i in e){var n=e[i],a=_.resolveData(i,n).then(function(e,t){this[e]=t}.bind(e,i));t.push(a)}return r().all(t).then((function(){return e}))},_unzipEntry:function(e){return new(r())((function(t){var i=e.filename,n=_.getExtension(i),r=_.getMimeType(n),a=h.BlobWriter;null===r.match("text")&&null===r.match("json")||(a=h.TextWriter),e.getData(new a(r),(function(e){t({filename:i,data:e})}))}))},unzipBlob:function(e){return new(r())((function(t,i){var n={},a=[];h.createReader(new h.BlobReader(e),(function(e){e.getEntries((function(i){for(var o=0;o<i.length;o++)if(!i[o].directory){var s=_._unzipEntry(i[o]);s.then((function(e){n[e.filename]=e.data})),a.push(s)}r().all(a).then((function(){e.close(),_.resolveFilesMap(n).then((function(e){t(e)}))}))}))}),(function(){i(this)}))}))},unzip:function(e){if(!window.zip)return r().reject("missing deps to unzip, require https://github.com/gildas-lormeau/zip.js");if(u(e))return _.requestResource(e).then((function(e){var t=new window.Blob([e],{type:c.get("zip")});return _.unzipBlob(t)}));if(e instanceof window.Blob)return _.unzipBlob(e);if(e instanceof window.ArrayBuffer){var t=new window.Blob([e],{type:c.get("zip")});return _.unzipBlob(t)}return r().reject("cant unzip input")},readFileList:function(e){var t,i,n={},l=[];for(i=0;i<e.length;++i){var u=_.getExtension(e[i].name);void 0===o.Z.instance().getReaderWriterForExtension(u)&&"osgjs"!==u||(t=e[i].name);var h,c=_.getMimeType(u);h=c.match("image")?"blob":c.match("json")||c.match("text")?"string":"arraybuffer",l.push((0,s.Z)(e[i],{responseType:h}))}return r().all(l).then((function(r){for(i=0;i<r.length;++i)n[e[i].name]=r[i];return _.resolveFilesMap(n).then((function(e){return a.Z.readNodeURL(t,{filesMap:e})}))}))},getMimeType:function(e){return c.get(e)},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1)},addMimeTypeForExtension:function(e,t){void 0!==c.has(e)&&l.Z.warn("the '"+e+"' already has a mimetype: "+c.get(e)),c.set(e,t)}};c.set("bin","application/octet-binary"),c.set("b3dm","application/octet-binary"),c.set("glb","application/octet-binary"),c.set("zip","application/octet-binary"),c.set("gz","application/octet-binary"),c.set("png","image/png"),c.set("jpg","image/jpeg"),c.set("jpeg","image/jpeg"),c.set("gif","image/gif"),c.set("json","application/json"),c.set("gltf","application/json"),c.set("osgjs","application/json"),c.set("txt","text/plain"),c.set("glsl","text/plain");const v=_},B3Qy:(e,t,i)=>{"use strict";i.d(t,{Z:()=>v});var n=i("Hfbx"),r=i("0rAA"),a=i("LZhK"),o=i("zI6W"),s=i("EUBb"),l=i("LERn"),u=i("nMbz"),h=i("epKp"),c=i("TYv3"),A=i("0/zD"),d=i("FJW6"),g=i("Xbee"),f=i("aS0i"),p=i("KOpT"),m=i("B2Ws"),_={ObjectWrapper:{}};_.ObjectWrapper.serializers={},_.readImage=function(e,t){return _.registry().readImageURL(e,t)},_.readImageURL=_.readImage,_.readBinaryArrayURL=function(e,t){return _.registry().readBinaryArrayURL(e,t)},_.readNodeURL=function(e,t){var i=e.substr(e.lastIndexOf(".")+1),n=m.Z.instance().getReaderWriterForExtension(i);return void 0!==n?n.readNodeURL(e,t):_.registry().readNodeURL(e,t)},_.registry=function(){var e=i("QJj4").Z;return void 0===_.registry._input&&(_.registry._input=new e),_.registry._input},_.parseSceneGraph=function(e,t){if(!(void 0!==e.Version&&e.Version>0)){r.Z.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated",n.Z.INFO);var i=_.parseSceneGraphDeprecated(e);return r.Z.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated",n.Z.INFO),i}var a;for(var o in r.Z.time("osgjs.metric:ReaderParser.parseSceneGraph",n.Z.INFO),e)if("Generator"!==o&&"Version"!==o){a=o;break}if(a){var s={};s[a]=e[a];var l=_.registry().clone();l.setJSON(s);var u=r.Z.objectMix(r.Z.objectMix({},_.registry().getOptions()),t||{});l.setOptions(u);var h=l.readObject();return r.Z.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph",n.Z.INFO),h}n.Z.log("can't parse scenegraph "+e,n.Z.INFO)},_.parseSceneGraphDeprecated=function(e){var t,m=function(e,t){var i=t[e];return void 0===i&&(i=t[e.toLowerCase()]),i},v=function(e,t){var i=m("Name",t);i&&void 0!==e.setName&&e.setName(i)},C=function(e,t){var i=t.MagFilter||t.mag_filter||void 0;i&&e.setMagFilter(i);var r=t.MinFilter||t.min_filter||void 0;r&&e.setMinFilter(r);var a=t.WrapT||t.wrap_t||void 0;a&&e.setWrapT(a);var o=t.WrapS||t.wrap_s||void 0;o&&e.setWrapS(o);var s=m("File",t);_.readImage(s).then((function(t){e.setImage(t)})).catch((function(){n.Z.log("Can't read image")}))},b=e.children,S=e._primitives||e.primitives||e.Primitives||void 0,E=e._attributes||e.attributes||e.Attributes||void 0;if(S||E){var y=new s.Z;v(y,e),y.stateset=e.stateset,e=y;for(var I=0,x=S.length;I<x;I++){var T=S[I].mode;if(S[I].indices){var w=S[I].indices;w=new l.Z(l.Z[w.type],w.elements,w.itemSize),T=T?u.Z[T]:"TRIANGLES",y.getPrimitiveSetList().push(new c.Z(T,w))}else{T=u.Z[T];var M=S[I].first,R=S[I].count;y.getPrimitiveSetList().push(new h.Z(T,M,R))}}for(var B in E){var N=E[B];y.getVertexAttributeList()[B]=new l.Z(N.type,N.elements,N.itemSize)}}var D=m("StateSet",e);if(D){var P=new A.Z;!function(e,t){v(e,t);var r=m("Textures",t)||m("TextureAttributeList",t)||void 0;if(r)for(var s=0,l=r.length;s<l;s++)if(m("File",r[s])){var u=new(0,i("FCEq").Z);C(u,r[s]),e.setTextureAttributeAndModes(s,u),e.addUniform(a.Z.createInt1(s,"Texture"+s))}else n.Z.log("no texture on unit "+s+" skip it");var h=m("BlendFunc",t);if(h){var c=new o.Z;!function(e,t){v(e,t),e.setSourceRGB(t.SourceRGB),e.setSourceAlpha(t.SourceAlpha),e.setDestinationRGB(t.DestinationRGB),e.setDestinationAlpha(t.DestinationAlpha)}(c,h),e.setAttributeAndModes(c)}var A=m("Material",t);if(A){var d=new(0,i("YPi5").Z);!function(e,t){v(e,t),e.setAmbient(m("Ambient",t)),e.setDiffuse(m("Diffuse",t)),e.setEmission(m("Emission",t)),e.setSpecular(m("Specular",t)),e.setShininess(m("Shininess",t))}(d,A),e.setAttributeAndModes(d)}}(P,D),e.stateset=P}var F=e.matrix||e.Matrix||void 0;F&&(t=new f.Z,v(t,e),r.Z.extend(t,e),g._E.copy(t.getMatrix(),F),e=t);var O=e.projection||e.Projection||void 0;if(O&&(t=new p.Z,v(t,e),r.Z.extend(t,e),g._E.copy(t.setProjectionMatrix(),O),e=t),void 0===e.typeID&&(t=new d.Z,v(t,e),r.Z.extend(t,e),e=t),b){e.children=[];for(var L=0,k=b.length;L<k;L++)e.addChild(_.parseSceneGraphDeprecated(b[L]))}return e};const v=_},"8bNm":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("lZH+"),r=i.n(n);const a=function(e,t){return"string"==typeof e?function(e,t){return new(r())((function(i,n){var r=new XMLHttpRequest;r.open("GET",e,!0);var a=t&&t.responseType?t.responseType.toLowerCase():void 0;a&&(r.responseType=a),t&&t.progress&&r.addEventListener("progress",t.progress,!1),r.addEventListener("error",n,!1),r.addEventListener("load",(function(){"arraybuffer"===r.responseType||"blob"===r.responseType?i(r.response):i(r.responseText)})),r.send(null)}))}(e,t):function(e,t){return new(r())((function(i){var n=t&&t.responseType?t.responseType.toLowerCase():void 0,r=new window.FileReader;r.onload=function(e){i(e.target.result)},n?"arraybuffer"===n?r.readAsArrayBuffer(e):"blob"===n?i(e):"string"===n?r.readAsText(e):r.readAsDataURL(e):r.readAsText(e)}))}(e,t)}},"kn/7":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("Hfbx");const r={isGunzipBuffer:function(e){var t=new Uint8Array(e);return 31===t[0]&&139===t[1]},gunzip:function(e){var t=new Uint8Array(e),r=i("zpE6");return r||n.Z.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js"),new r.Gunzip(t).decompress().buffer}}},"+qlm":(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={name:"OpenSceneGraph",version:"0.2.9",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)"}},a3OJ:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=function(e,t){return"core_"+t},r=function(e,t){return"#define "+t},a="(GL_EXT_shader_texture_lod|GL_OES_standard_derivatives|GL_EXT_draw_buffers|GL_EXT_frag_depth;)",o=new RegExp("#\\s*extension\\s+"+a+".*","g"),s=new RegExp(a,"g"),l=[],u=function(e,t){var i="glFragData_"+t;return l[t]="layout(location = "+t+") out vec4 "+i+";",i};const h=function(e,t){return e=function(e){return(e=e.replace(o,r)).replace(s,n)}(e=(e=(e=(e=e.replace(/attribute\s+/g,"in ")).replace(/varying\s+/g,t?"in ":"out ")).replace(/(texture2D|textureCube)\s*\(/g,"texture(")).replace(/(textureCubeLodEXT)\s*\(/g,"textureLod(")),t&&(l.length=0,e=e.replace(/gl_FragData\s*\[\s*(\d+)\s*\]/g,u),l.length||l.push("out vec4 glFragColor_0;"),e=(e=e.replace(/gl_FragColor/g,"glFragColor_0")).replace(/void\s+main\s*\(/g,l.join("\n")+"\nvoid main(")),e}},OKjT:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var n,r,a=i("0rAA"),o=i("Hfbx"),s=i("Axet"),l=i("4igZ"),u=function(){this._cache={},this._ShaderCompiler=void 0};u.prototype={setShaderCompiler:function(e){this._ShaderCompiler=e,e._validAttributeTypeMemberCache||this._computeStateAttributeCache(e)},getShaderCompiler:function(){return this._ShaderCompiler},filterAttributeTypes:function(e){return!(!e.isEnabled||e.isEnabled())},getActiveAttributeList:function(e,t){for(var i="",n=e._attributeArray,r=this._ShaderCompiler._validAttributeTypeMemberCache,a=0,o=r.length;a<o;a++){var s=r[a],l=s<n.length?n[s]:void 0;if(l){var u=l._lastApplied;u&&!this.filterAttributeTypes(u)&&(i+=u.getHash(),t.push(u))}}return i},getActiveAttributeListCache:function(e){for(var t="",i=this._ShaderCompiler._validAttributeTypeMemberCache,n=0,r=i.length;n<r;n++){var a=i[n],o=a<e._attributeArray.length?e._attributeArray[a]:void 0;if(o){var s=o._lastApplied;if(!s||this.filterAttributeTypes(s))continue;t+=o._lastApplied.getHash()}}return t},getActiveTextureAttributeListCache:function(e){for(var t="",i=this._ShaderCompiler._validTextureAttributeTypeMemberCache,n=e._textureAttributeArrayList,r=0;r<n.length;r++){var a=n[r];if(a)for(var o=a.length,s=0;s<i.length;s++){var l=i[s],u=l<o?a[l]:void 0;if(u){var h=u._lastApplied;if(!h||this.filterAttributeTypes(h)||h.isTextureNull())continue;t+=h.getHash()}}}return t},getActiveTextureAttributeList:function(e,t){var i,n,r="",a=e._textureAttributeArrayList,o=this._ShaderCompiler._validTextureAttributeTypeMemberCache;for(i=0,n=a.length;i<n;i++){var s=a[i];if(s){t[i]=[];for(var l=0,u=o.length;l<u;l++){var h=o[l],c=h<s.length?s[h]:void 0;if(c){var A=c._lastApplied;!A||this.filterAttributeTypes(A)||A.isTextureNull()||(r+=A.getHash(),t[i].push(A))}}}}return r},getActiveUniforms:function(e,t,i){for(var n={},r=0,a=t.length;r<a;r++){var o=t[r];if(o.getOrCreateUniforms){var s=o.getOrCreateUniforms();if(void 0!==s)for(var l in s){var u=s[l];n[u.getName()]=u}}}for(var h=0,c=i.length;h<c;h++){var A=i[h];if(A)for(var d=0,g=A.length;d<g;d++){var f=A[d].getOrCreateUniforms(h);for(var p in f){var m=f[p];n[m.getName()]=m}}}return n},_computeStateAttributeCache:function(e){var t,i,n,r,s,l=e.stateAttributeConfig.attribute||[],u=[];for(i=0,n=l.length;i<n;i++)t=l[i],void 0!==(s=a.Z.getIdFromTypeMember(t))&&(-1!==u.indexOf(s)?o.Z.warn("Compiler "+e.name+" contains duplicate attribute entry "+t+", check the Compiler configuration"):u.push(s));for(r=new Uint8Array(u),e._validAttributeTypeMemberCache=r,u=[],i=0,n=(l=e.stateAttributeConfig.textureAttribute||[]).length;i<n;i++)t=l[i],s=a.Z.getTextureIdFromTypeMember(t),-1!==u.indexOf(s)?o.Z.warn("Compiler "+e.name+" contains duplicate texture attribute entry "+t+", check the Compiler configuration"):u.push(s);r=new Uint8Array(u),e._validTextureAttributeTypeMemberCache=r},_createWaitingProgram:function(e,t,i){var n=new s.Z(new l.Z(l.Z.VERTEX_SHADER,"attribute vec3 Vertex;void main(void) {gl_Position = vec4(10.0,10.0,10.0,1.0);}\n"),new l.Z(l.Z.FRAGMENT_SHADER,"#define SHADER_NAME WaitSafe\nprecision lowp float; void main(void) { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);}\n"));return this.getActiveAttributeList(e,t),n.setActiveUniforms(this.getActiveUniforms(e,t,i)),n.generated=!0,n._asyncLinkingExt=void 0,n.apply(e),n},getOrCreateProgram:(n=[],r=[],function(e){var t=this.getActiveAttributeListCache(e)+this.getActiveTextureAttributeListCache(e),i=this._getProgram(t,e,r,n);return void 0!==i?i:this._createProgram(t,e,r,n)}),_getProgram:function(e){return this._cache[e]},_createProgram:function(e,t,i,n){i.length=0,n.length=0,this.getActiveAttributeList(t,i),this.getActiveTextureAttributeList(t,n);var r=new(0,this._ShaderCompiler)(i,n),a=r.createFragmentShader(),o=r.createVertexShader(),u=new s.Z(new l.Z(l.Z.VERTEX_SHADER,o),new l.Z(l.Z.FRAGMENT_SHADER,a));return u.hash=e,u.setActiveUniforms(this.getActiveUniforms(t,i,n)),u.generated=!0,this._cache[e]=u,u.apply(t),u},resetCache:function(){this._cache={}}};const h=u;var c=function(){return this._generators={},this.addShaderGenerator("default",new h),this};c.prototype={getShaderGenerator:function(e){if(!e)return this._generators.default;var t=this._generators[e];return t||(o.Z.error("ShaderGenerator "+e+" does not exist in ShaderGeneratorProxy"),this._generators.default)},addShaderGenerator:function(e,t){this._generators[e]=t}};const A=c;var d=i("UuwK"),g={};g.ShaderGenerator=h,g.ShaderGeneratorProxy=A,g.shaderProcessor=d.Z;const f=g},UuwK:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var osg_notify__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("Hfbx"),osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("EMUO"),viewer_getOptions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("5Cxy"),osgShader_gl2convert__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a3OJ"),shaderProcessor={},cbFilterDuplicate=function(e,t,i){return!t||e!==i[t-1]};shaderProcessor.getSortedUnique=function(e){return e.sort().filter(cbFilterDuplicate)};var isStringInteger=function(e){return/^[\+|\-]?\d+$/.test(e)},getFinalDefinedValue=function(e,t){for(;e[t]&&t!==e[t];)t=e[t];return t},testIf=function(defines,line){if(line.startsWith("#ifdef"))return void 0!==defines[line.substr(7-line.length)];if(line.startsWith("#ifndef"))return void 0===defines[line.substr(8-line.length)];if(line.startsWith("#else"))return!0;for(var txt=line.match(/[#elif|#if]\s+(.*)/)[1],tokens=txt.split(/\b\d+\b|\W+|defined+/g),i=0;i<tokens.length;++i){var tok=tokens[i];if(tok){var value=getFinalDefinedValue(defines,defines[tok]);void 0===value||isStringInteger(value)||(value=!0),txt=txt.replace(tok,value)}}return eval("var defined = function(x) { return x !== undefined | 0; };\n"+txt)},processBranch=function(e,t,i,n){for(var r=[1],a=t;a<e.length;++a){var o=e[a].trim();if(o.startsWith("#endif"))r.length--;else if(o.startsWith("#el")){var s=r.length-1;0===r[s]?r[s]=testIf(i,o)?1:0:1===r[s]&&(r[s]=2)}else if(o.startsWith("#if"))r.push(testIf(i,o)?1:0);else{for(var l=!0,u=r.length;u--;)l=l&&1===r[u];if(l)if(o.startsWith("#"))if(o.startsWith("#extension"))n.push(o);else if(o.startsWith("#undef"))i[o.match(/#undef\s+(\w+)/)[1]]=void 0,n.push(o);else if(o.startsWith("#define")){var h=o.match(/#define\s+(\w+)\s*(.*)/);-1!==o.indexOf(h[1]+"(")?i[h[1]]={args:o.match(/\(.*?\)/)[0].match(/\w+/g),body:o.match(/\)(.*)/)[1]}:i[h[1]]=h[2]}else console.error("unknown preprocessor line: "+o);else n.push(o)}}},fixIndent=function(e){for(var t=(e=e.replace(/(\n\s*\n)+/g,"\n\n")).split("\n"),i="",n=0;n<t.length;++n){var r=t[n].trim(),a=-1!==r.indexOf("{"),o=-1!==r.indexOf("}");!a&&o&&(i=i.substr(4)),t[n]=i+r,a&&!o&&(i+="    ")}return t.join("\n")},cleanDeclarations=function(e,t){for(var i=0;i<t.length;++i)e=e.replace(t[i],""),t[i]=t[i].replace(/\s+/g," ").replace(/\s+;/,";");return e},handleVaryings=function(e){var t=e.match(/varying\s.*?;/g);if(!t)return e;e=cleanDeclarations(e,t),t=shaderProcessor.getSortedUnique(t);for(var i=0;i<t.length;++i)if(-1!==t[i].indexOf("vViewNormal;")){var n=t[0];t[0]=t[i],t[i]=n;break}return"\n"+t.join("\n")+"\n"+e},handleUniforms=function(e){var t=e.match(/uniform\s.*?;/g);return t?(e=cleanDeclarations(e,t),"\n"+(t=shaderProcessor.getSortedUnique(t)).join("\n")+"\n"+e):e},handleAttributes=function(e){var t=e.match(/attribute\s.*?;/g);if(!t)return e;e=cleanDeclarations(e,t),t=shaderProcessor.getSortedUnique(t);for(var i=0;i<t.length;++i)if(-1!==t[i].indexOf(" Vertex;")){t.unshift(t[i]),t.splice(i+1,1);break}return"\n"+t.join("\n")+"\n"+e},handlePrecision=function(e){var t=e.match(/precision\s+(high|low|medium)p\s+float\s*;/);return t?t[0]+"\n"+e.replace(t[0],""):"precision "+osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance().getShaderMaxPrecisionFloat()+"p float;\n"+e},addExtensions=function(e){var t=e.match(/#extension\s(\w+)\s:\s(\w+)/g);if(!t)return e;t=shaderProcessor.getSortedUnique(t);for(var i=0;i<t.length;++i)e=e.replace(t[i],"");return t.join("\n")+"\n"+e},addVersion=function(e){return(osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance().isWebGL2()?"#version 300 es\n":"#version 100\n")+e},hasVersion=function(e){return e.match(/^#\s*version/m)},cbUnroll=function(e,t,i){t=parseInt(t);for(var n="",r=0;r<t;++r)n+=i.replace(/%ID%/g,r);return n},unrollReplace=function(e){return e.replace(/%UNROLL ([0-9]+)%([\s\S]+?)%%/g,cbUnroll)},glslPreprocessShader=function(e){return window.glslesPreprocessor(e,{debugExperimental:!1,defines:[],doStats:!1,extensions:[],pruneComments:!0,logCounts:!1,minify:!1,output:0,preprocess:!0,profileTimeEach:!1,profileTimeGlobal:!1,pruneUnused:!0,pruneDefines:!0,replaceDefine:!0,optimize:!0,tabs:4,whitespace:!0})},extractArguments=function(e,t){for(var i=[""],n=0,r=t;r<e.length;++r){if("("===e[r])n++;else if(")"===e[r]){if(0===n)return[i,r+1];if(0===--n){i[i.length-1]+=e[r];continue}}","!==e[r]||0!==n?i[i.length-1]+=e[r]:i.push("")}},replaceRange=function(e,t,i,n){return e.substring(0,t)+n+e.substring(i)},resolveDefineFunction=function(e,t,i){var n=new RegExp("\\b"+t+"\\b\\s*\\(","g"),r=e.match(n);if(!r)return e;for(var a=i.args,o=i.body,s=0;s<r.length;++s){var l=r[s],u=e.indexOf(l),h=u+l.length,c=extractArguments(e,h),A=c[0],d=o.replace(/\w+/g,(function(e){var t=a.indexOf(e);return-1!==t?A[t]:e}));e=replaceRange(e,u,c[1],d)}return e},resolveDefines=function(e,t){for(var i=Object.keys(t),n=0;n<i.length;++n){for(var r=i[n],a=t[r],o="object"==typeof a,s=!o&&new RegExp("\\b"+r+"\\b","g"),l=n+1;l<i.length;++l){var u=i[l],h=t[u];void 0!==h&&("object"==typeof h?h.body=o?resolveDefineFunction(h.body,r,a):h.body.replace(s,a):t[u]=o?resolveDefineFunction(h,r,a):h.replace(s,a))}e=o?resolveDefineFunction(e,r,a):e.replace(s,a)}return e},extensions=["EXT_shader_texture_lod","EXT_draw_buffers","EXT_frag_depth","OES_standard_derivatives"],getDefaultDefines=function(){for(var e={},t=osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance(),i=t.getWebGLExtensions(),n=0;n<extensions.length;++n){var r=extensions[n];i[r]&&(e["GL_"+r]="GL_"+r)}return"high"===t.getShaderMaxPrecisionFloat()&&(e.GL_FRAGMENT_PRECISION_HIGH="GL_FRAGMENT_PRECISION_HIGH"),e},fastPreprocess=function(e){e=e.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"");var t=getDefaultDefines(),i=[];return processBranch(e.split("\n"),0,t,i,!0),resolveDefines(i.join("\n"),t)},preprocess=function(e){var t=e.match("#define SHADER_NAME .*");return e=(0,viewer_getOptions__WEBPACK_IMPORTED_MODULE_2__.Z)().cleanShader&&window.glslesPreprocessor?glslPreprocessShader(e):fastPreprocess(e),t?t[0]+"\n"+e:e};shaderProcessor.processIncludes=function(e,t){return e.replace(/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,(function(e,i){var n=i.split(" ")[0].replace(/"/g,"");return-1!==t.indexOf(n)?"":(t.push(n),shaderProcessor.processIncludes(shaderProcessor.getShaderTextPure(n),t))}))},shaderProcessor.processShader=function(e){if(hasVersion(e))return e;var t=shaderProcessor.processIncludes(e,[]),i=-1===t.indexOf("gl_Position");return t=t.replace(/\\\n/g,""),t=unrollReplace(t),t=preprocess(t),t=handleVaryings(t),t=handleUniforms(t),t=handleAttributes(t),t=fixIndent(t),osg_WebGLCaps__WEBPACK_IMPORTED_MODULE_1__.Z.instance().isWebGL2()&&(t=(0,osgShader_gl2convert__WEBPACK_IMPORTED_MODULE_3__.Z)(t,i)),t=handlePrecision(t),t=addExtensions(t),t=addVersion(t)};var shadersText={};shaderProcessor.addShaders=function(e){for(var t in e)shadersText[t]&&console.warn("Shader already added : "+t),shadersText[t]=e[t]},shaderProcessor.hasShader=function(e){return void 0!==shadersText[e]},shaderProcessor.getShaderTextPure=function(e){var t=shadersText[e];return t||osg_notify__WEBPACK_IMPORTED_MODULE_0__.Z.error("shader file/text: "+e+" not registered"),t},shaderProcessor.getShader=function(e){var t=shaderProcessor.getShaderTextPure(e);return shaderProcessor.processShader(t)};const __WEBPACK_DEFAULT_EXPORT__=shaderProcessor},zTfe:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var n=i("0rAA"),r=i("2bAw"),a=i("Zodj"),o=function(e){r.Z.call(this,r.Z.TRAVERSE_ALL_CHILDREN),this._selectables=e,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};n.Z.createPrototypeObject(o,n.Z.objectInherit(r.Z.prototype,{getColorFromClassName:function(e){switch(e){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(e){this.reset(),e.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(e){if(!e._isNormalDebug){if(this._uniqueNodes.has(e.getInstanceID())||(this._uniqueNodes.add(e.getInstanceID()),this._nodeList.push(e)),this.nodePath.length>=2){var t=this.nodePath[this.nodePath.length-2].getInstanceID(),i=e.getInstanceID(),n=t+"+"+i;this._uniqueEdges.has(n)||(this._linkList.push({parentNode:t,childrenNode:i}),this._uniqueEdges.add(n))}this.traverse(e)}},createMatrixGrid:function(e,t){var i="";return i+="<table><tr><td>"+t[0]+"</td>",i+="<td>"+t[4]+"</td>",i+="<td>"+t[8]+"</td>",i+="<td>"+t[12]+"</td></tr>",i+="<tr><td>"+t[1]+"</td>",i+="<td>"+t[5]+"</td>",i+="<td>"+t[9]+"</td>",i+="<td>"+t[13]+"</td></tr>",i+="<tr><td>"+t[2]+"</td>",i+="<td>"+t[6]+"</td>",i+="<td>"+t[10]+"</td>",i+="<td>"+t[14]+"</td></tr>",i+="<tr><td>"+t[3]+"</td>",i+="<td>"+t[7]+"</td>",i+="<td>"+t[11]+"</td>",i+="<td>"+t[15]+"</td></tr></table>"},getLabel:function(e){var t=e.className()+" ("+e.getInstanceID()+")";return e.getName&&e.getName()&&(t+="\n"+e.getName()),t},generateNode:function(e,t){var i="";t.getMatrix&&t.getMatrix()&&(i+="<br /><br />"+this.createMatrixGrid(t,t.getMatrix())),this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:this.getLabel(t),description:i,style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},generateStateSet:function(e,t){var i=t.getStateSet(),n=i.getInstanceID(),r=this.getLabel(i);r+="\nNbTexture : "+i.getNumTextureAttributeLists(),e.hasNode(n)||(this._selectables.set(n.toString(),i),e.addNode(n,{label:r,style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})),e.addEdge(null,t.getInstanceID(),n,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateSourceGeometry:function(e,t){var i=t.getSourceGeometry(),n=i.getInstanceID();this._selectables.set(n.toString(),i),e.addNode(n,{label:this.getLabel(i),style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"}),e.addEdge(null,t.getInstanceID(),n,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateNodeAndLink:function(e){for(var t=0,i=this._nodeList.length;t<i;t++){var n=this._nodeList[t];this.generateNode(e,n),n.getStateSet()&&this.generateStateSet(e,n),n.getSourceGeometry&&n.getSourceGeometry()instanceof a.Z&&this.generateSourceGeometry(e,n)}for(var r=0,o=this._linkList.length;r<o;r++)e.addEdge(null,this._linkList[r].parentNode,this._linkList[r].childrenNode)}}),"osgUtil","DisplayGraphNode");const s=o;var l=i("UvG5"),u=function(e){this._selectables=e,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};u.prototype={getColorFromClassName:s.prototype.getColorFromClassName,createGraph:function(e){this.reset(),this.apply(e)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(e){var t=e.getInstanceID();if(this._renderBinMap.has(t)||this._renderBinMap.set(t,e),this._renderBinStack.push(e),e.getPreRenderStageList)for(var i=e.getPreRenderStageList(),n=0,r=i.length;n<r;++n)this.apply(i[n].renderStage);if(this.registerNode(e),e.getPostRenderStageList)for(var a=e.getPostRenderStageList(),o=0,s=a.length;o<s;++o)this.apply(a[o].renderStage);this._renderBinStack.pop()},registerNode:function(e){var t=e.getInstanceID();if(this._nodeList.push(e),e._bins.forEach(function(e,t){this.apply(t)}.bind(this)),e._leafs.length)for(var i=0,n=e._leafs.length;i<n;i++)this.createNodeAndSetID(t,e._leafs[i]);var r=this,a={},o=function(e){r.createNodeAndSetID(this.stateGraphID,e)}.bind(a);if(e.getStateGraphList().forEach((function(e){r.createNodeAndSetID(t,e);var i=e._instanceID,n=e.getLeafs();a.stateGraphID=i,n.forEach(o)})),!(this._renderBinStack.length<2)){var s=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(s,t)}},createLink:function(e,t){var i=e+"+"+t;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:e,childrenNode:t}),this._uniqueEdges.add(i))},createNodeAndSetID:function(e,t){this._nodeList.push(t),(void 0===t._instanceID||t._instanceID<0&&t._refID!==this._refID)&&(t._instanceID=-1-this._generatorID++,t._refID=this._refID),this.createLink(e,t._instanceID)},generateRenderLeaf:function(e,t){var i=t._instanceID,n="RenderLeaf",r=t._geometry&&t._geometry.getName()?"\n"+t._geometry.getName():"Geometry",a="RenderLeaf ( "+t._instanceID+" )";a+="\n"+r+" ( "+t._geometry.getInstanceID()+" )",this._selectables.set(i.toString(),t),e.addNode(i,{label:a,description:"",style:"fill: "+this.getColorFromClassName(n)+";stroke-width: 0px;"})},generateStateGraph:function(e,t){var i=t._instanceID,n="StateGraph",r="StateGraph ( "+t._instanceID+" )";r+="\n"+t._leafs._length+" leafs",this._selectables.set(i.toString(),t),e.addNode(i,{label:r,description:"",style:"fill: "+this.getColorFromClassName(n)+";stroke-width: 0px;"})},generateRenderStage:function(e,t){var i=t.className()+" ( "+t._instanceID+" )";t.getName()&&(i+="\n"+t.getName()),i+="\nViewport ( "+t.getViewport().width()+" x "+t.getViewport().height()+" )",this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},generateRenderBin:function(e,t){var i=t.className()+" ( "+t.getInstanceID()+" )";t.getName()&&(i+="\n"+t.getName());var n="";t.getSortMode()===l.Z.SORT_BACK_TO_FRONT&&(n="SortMode: BackToFront");var r="BinNumber: "+t.getBinNumber()+"\n"+n;this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:i,description:r,style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(e){for(var t=0,i=this._nodeList.length;t<i;t++){var n=this._nodeList[t];n._geometry&&void 0!==n._depth?this.generateRenderLeaf(e,n):"StateGraph"===n.className()?this.generateStateGraph(e,n):"RenderStage"===n.className()?this.generateRenderStage(e,n):this.generateRenderBin(e,n)}for(var r=0,a=this._linkList.length;r<a;r++)e.addEdge(null,this._linkList[r].parentNode,this._linkList[r].childrenNode)}};const h=u;var c,A=i("Hfbx"),d=function(e){this.options=e;var t=document.createElement("style");t.type="text/css",t.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(t),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var i=document.querySelectorAll(this.options.selector),n=0;n<i.length;n++)i[n].addEventListener("mouseover",this.showTooltip.bind(this),!1),i[n].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};d.prototype={showTooltip:function(e){if(c){var t=e.currentTarget;this.el.innerHTML=t.getAttribute("title"),this.el.style.display="block",this.el.style.left=c(t).position().left+c(t).get(0).getBoundingClientRect().width+"px",this.el.style.top=c(t).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var g=function(){!function(){try{c=i("Hjnd")}catch(e){A.Z.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}}(),c&&(this._selectables=new window.Map,this._graphNode=new s(this._selectables),this._graphRender=new h(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=c("<svg width=100% height=100%></svg>"),c("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};g.instance=function(){return g._instance||(g._instance=new g),g._instance},g.prototype={getColorFromClassName:s.prototype.getColorFromClassName,setCallbackSelect:function(e){this._cbSelect=e},reset:function(){c&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",c(".osgDebugButton").hide())},setDisplayGraphRenderer:function(e){this._displayRenderer=e},createRenderGraph:function(e){this._graphRender.createGraph(e),this.displayGraph()},createGraph:function(e){c&&(this.reset(),this._displayNode=!!e,e&&this._graphNode.createGraph(e),this._displayRenderer?i("ljhH").Z.debugGraph=!0:this.displayGraph())},displayGraph:function(){if(c)if(window.d3&&window.dagreD3)this._createGraphApply();else{var e=this._createGraphApply.bind(this);c.getScript("//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js").done((function(){c.getScript("//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js").done(e)}))}},_createGraphApply:function(){var e=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(e),this._displayRenderer&&this._graphRender.generateNodeAndLink(e),this.injectStyleElement(),c(".osgDebugButton").show();var t=this.renderer=new window.dagreD3.Renderer,i=window.d3.select(this._$svg.get(0)).append("g"),n=t.zoom();t.zoom((function(e,t){var i=n(e,t);return i.scale(.75).event(t),i}));var r=this._idToDomElement,a=t.drawNodes();t.drawNodes((function(e,t){var i=a(e,t);return i.attr("title",(function(t){return r.set(t,this),i=t,n=e.node(t).description||"",'<p class="osgDebugName">'+i+'</p><pre class="osgDebugDescription">'+n+"</pre>";var i,n})),i})),t.run(e,i),this.tooltip=new d({selector:".node"}),c(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(e){var t=e.getInstanceID(),i=this._idToDomElement.get(t);i&&c(i).click()},onNodeSelect:function(e){var t=e.currentTarget,i=c(t.getAttribute("title"))[0].innerHTML,n=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var r=n.get(i);r&&(this.lastNode=t.childNodes[0],this.lastColor=this.lastNode.style.fill,t.childNodes[0].style.fill="#f00",window.activeNode=r,A.Z.info("window.activeNode is set with the node below !"),A.Z.log(window.activeNode),A.Z.log("\n"),this._cbSelect&&this._cbSelect(r))},focusOnScene:function(){c(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){c(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),c(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,c("body").append('<button class="osgDebugButton">Access to the scene</button>'),c(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var e=document.createElement("style");e.type="text/css",e.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(e)}}};const f=g},a3uD:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n,r=i("Xbee"),a=i("Pd7s"),o=i("2gPm"),s=function(){this._hit=!1,this._primitiveIndex=0,this._vertices=void 0,this._geometry=void 0,this._intersectionVisitor=void 0,this._intersector=void 0,this._limitOneIntersection=!1,this._primitiveMask=o.Z.ALL_PRIMITIVES};s.Intersection=function(){this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._primitiveIndex=void 0,this._ratio=0,this._backface=!1,this._localIntersectionPoint=r.R3.create()},s.prototype={reset:function(){this._hit=!1,this._vertices=void 0,this._primitiveIndex=0},setPrimitiveIndex:function(e){this._primitiveIndex=e},setGeometry:function(e){this._geometry=e,this._primitiveIndex=0,this._vertices=e.getAttributes().Vertex.getElements()},setVertices:function(e){this._vertices=e},setIntersectionVisitor:function(e){this._intersectionVisitor=e},setIntersector:function(e){this._intersector=e,this._primitiveMask=e.getPrimitiveMask();var t=e.getIntersectionLimit();this._limitOneIntersection=t===o.Z.LIMIT_ONE_PER_DRAWABLE||t===o.Z.LIMIT_ONE},setLimitOneIntersection:function(e){this._limitOneIntersection=e},leave:function(){},enter:function(){},initIntersection:function(e){return e._matrix=r._E.clone(this._intersectionVisitor.getModelMatrix()),e._nodePath=this._intersectionVisitor.getNodePath().slice(),e._primitiveIndex=this._primitiveIndex,e._drawable=this._geometry,this._intersector.getIntersections().push(e),this._hit=!0,e},intersectPoint:function(){},intersectLine:function(){},intersectTriangle:function(){},operatorPoint:(n=r.R3.create(),function(e){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&o.Z.POINT_PRIMITIVES))){var t=this._vertices;r.R3.set(n,t[3*e],t[3*e+1],t[3*e+2]),this.intersectPoint(n,e),this._primitiveIndex++}}),operatorLine:function(){var e=r.R3.create(),t=r.R3.create();return function(i,n){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&o.Z.LINE_PRIMITIVES))){var a=this._vertices;r.R3.set(e,a[3*i],a[3*i+1],a[3*i+2]),r.R3.set(t,a[3*n],a[3*n+1],a[3*n+2]),this.intersectLine(e,t,i,n),this._primitiveIndex++}}}(),operatorTriangle:function(){var e=r.R3.create(),t=r.R3.create(),i=r.R3.create();return function(n,a,s){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&o.Z.TRIANGLE_PRIMITIVES))){var l=this._vertices;r.R3.set(e,l[3*n],l[3*n+1],l[3*n+2]),r.R3.set(t,l[3*a],l[3*a+1],l[3*a+2]),r.R3.set(i,l[3*s],l[3*s+1],l[3*s+2]),this.intersectTriangle(e,t,i,n,a,s),this._primitiveIndex++}}}(),apply:function(e){e.getAttributes().Vertex&&(0,a.Z)(e,this)}};const l=s},MbzV:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n,r=i("0rAA"),a=i("2bAw"),o=i("Xbee"),s=i("U7nq"),l=i("BW96"),u=i("a72h"),h=function(){a.Z.call(this),this._intersector=void 0,this._projectionStack=new l.Z,this._modelStack=new l.Z,this._viewStack=new l.Z,this._windowStack=new l.Z,this._pooledMatrix=new s.Z(o._E.create),this.reset()};r.Z.createPrototypeObject(h,r.Z.objectInherit(a.Z.prototype,{reset:function(){this._pooledMatrix.reset(),this._viewStack.reset(),this._modelStack.reset(),this._projectionStack.reset(),this._windowStack.reset(),this._viewStack.push(o._E.IDENTITY),this._modelStack.push(o._E.IDENTITY),this._projectionStack.push(o._E.IDENTITY),this._windowStack.push(o._E.IDENTITY)},setIntersector:function(e){this._intersector=e},getIntersector:function(){return this._intersector},pushModelMatrix:function(e){this._modelStack.push(e)},getModelMatrix:function(){return this._modelStack.back()},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(e){this._viewStack.push(e)},getViewMatrix:function(){return this._viewStack.back()},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(e){this._projectionStack.push(e)},getProjectionMatrix:function(){return this._projectionStack.back()},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(e){this._windowStack.push(e)},pushWindowMatrixUsingViewport:function(e){this._windowStack.push(e.computeWindowMatrix(this._pooledMatrix.getOrCreateObject()))},getWindowMatrix:function(){return this._windowStack.back()},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:(n=o._E.create64(),function(){return o._E.copy(n,this.getWindowMatrix()),o._E.mul(n,n,this.getProjectionMatrix()),o._E.mul(n,n,this.getViewMatrix()),o._E.mul(n,n,this.getModelMatrix()),n}),enter:function(e){return this._intersector.enter(e)},apply:function(e){e.getViewMatrix?this.applyCamera(e):e.getMatrix?this.applyTransform(e):this.applyNode(e)},applyCamera:function(e){var t,i,n,r=e.getViewport();void 0!==r&&this.pushWindowMatrixUsingViewport(r),e.getReferenceFrame()===u.Z.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(t=o._E.mul(this._pooledMatrix.getOrCreateObject(),this.getProjectionMatrix(),e.getProjectionMatrix()),i=this.getViewMatrix(),n=o._E.mul(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix(),e.getViewMatrix())):(t=e.getProjectionMatrix(),i=e.getViewMatrix(),n=o._E.identity(this._pooledMatrix.getOrCreateObject())),this.pushProjectionMatrix(t),this.pushViewMatrix(i),this.pushModelMatrix(n),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(e),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==r&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(e){this.enter(e)&&(e.getPrimitiveSetList?this._intersector.intersect(this,e):e.traverse&&this.traverse(e))},applyTransform:function(e){if(this.enter(e)){if(e.getReferenceFrame()===u.Z.ABSOLUTE_RF){var t=this._pooledMatrix.getOrCreateObject();this.pushViewMatrix(o._E.identity(t)),this.pushModelMatrix(e.getMatrix())}else if(this._modelStack.getLength()>0){var i=o._E.copy(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix());o._E.mul(i,i,e.getMatrix()),this.pushModelMatrix(i)}else this.pushModelMatrix(e.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(e),this.popModelMatrix(),e.getReferenceFrame()===u.Z.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),"osgUtil","IntersectionVisitor");const c=h},"/Ud6":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("2gPm"),r=function(){this._intersections=[],this._primitiveMask=n.Z.ALL_PRIMITIVES,this._intersectionLimit=n.Z.NO_LIMIT};r.prototype={reset:function(){this._intersections.length=0},enter:function(e){return!this.reachedLimit()&&(!e.isCullingActive()||this.intersectNode(e))},intersectNode:function(e){return this.intersectBoundingSphere(e.getBoundingSphere())||this.intersectBoundingBox(e.getBoundingBox())},intersectBoundingSphere:function(){return!1},intersectBoundingBox:function(){return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(e){this._intersectionLimit=e},getIntersectionLimit:function(){return this._intersectionLimit},setPrimitiveMask:function(e){this._primitiveMask=e},getPrimitiveMask:function(){return this._primitiveMask},reachedLimit:function(){return this._intersectionLimit===n.Z.LIMIT_ONE&&this._intersections.length>0},setCurrentTransformation:function(){},intersect:function(){}};const a=r},sI9o:(e,t,i)=>{"use strict";i.d(t,{Z:()=>S});var n,r,a,o,s,l,u,h,c,A,d,g,f,p,m=i("0rAA"),_=i("Xbee"),v=i("a3uD"),C=function(){v.Z.Intersection.call(this),this._localIntersectionNormal=_.R3.clone(_.R3.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},b=function(){v.Z.call(this),this._threshold=0,this._d=_.R3.create(),this._length=0,this._invLength=0,this._start=_.R3.create(),this._end=_.R3.create(),this._dInvX=_.R3.create(),this._dInvY=_.R3.create(),this._dInvZ=_.R3.create(),this._hit=!1};m.Z.createPrototypeObject(b,m.Z.objectInherit(v.Z.prototype,{set:function(e,t,i){this._start=e,this._end=t,_.R3.sub(this._d,t,e),this._length=_.R3.length(this._d),this._invLength=0!==this._length?1/this._length:0,_.R3.scale(this._d,this._d,this._invLength),0!==this._d[0]&&_.R3.scale(this._dInvX,this._d,1/this._d[0]),0!==this._d[1]&&_.R3.scale(this._dInvY,this._d,1/this._d[1]),0!==this._d[2]&&_.R3.scale(this._dInvZ,this._d,1/this._d[2]),void 0!==i&&(this._threshold=i)},enter:function(e,t,i){var n=e._min,r=n[0],a=n[1],o=n[2],s=e._max,l=s[0],u=s[1],h=s[2],c=this._dInvX,A=this._dInvY,d=this._dInvZ;if(t[0]<=i[0]){if(i[0]<r)return!1;if(t[0]>l)return!1;t[0]<r&&_.R3.scaleAndAdd(t,t,c,r-t[0]),i[0]>l&&_.R3.scaleAndAdd(i,t,c,l-t[0])}else{if(t[0]<r)return!1;if(i[0]>l)return!1;i[0]<r&&_.R3.scaleAndAdd(i,t,c,r-t[0]),t[0]>l&&_.R3.scaleAndAdd(t,t,c,l-t[0])}if(t[1]<=i[1]){if(i[1]<a)return!1;if(t[1]>u)return!1;t[1]<a&&_.R3.scaleAndAdd(t,t,A,a-t[1]),i[1]>u&&_.R3.scaleAndAdd(i,t,A,u-t[1])}else{if(t[1]<a)return!1;if(i[1]>u)return!1;i[1]<a&&_.R3.scaleAndAdd(i,t,A,a-t[1]),t[1]>u&&_.R3.scaleAndAdd(t,t,A,u-t[1])}if(t[2]<=i[2]){if(i[2]<o)return!1;if(t[2]>h)return!1;t[2]<o&&_.R3.scaleAndAdd(t,t,d,o-t[2]),i[2]>h&&_.R3.scaleAndAdd(i,t,d,h-t[2])}else{if(t[2]<o)return!1;if(i[2]>h)return!1;i[2]<o&&_.R3.scaleAndAdd(i,t,d,o-t[2]),t[2]>h&&_.R3.scaleAndAdd(t,t,d,h-t[2])}return!0},intersectPoint:(f=_.R3.create(),p=_.R3.create(),function(e,t){var i=this._start;_.R3.sub(f,e,i),_.R3.sub(p,this._end,i);var n=_.R3.dot(f,p)*this._invLength*this._invLength;if(!((n<0?_.R3.sqrLen(f):n>1?_.R3.sqrDist(e,this._end):_.R3.sqrLen(_.R3.scaleAndAdd(f,f,p,-n)))>this._threshold*this._threshold)){var r=this.initIntersection(new C);r._i1=t,r._r1=1,_.R3.scaleAndAdd(r._localIntersectionPoint,i,p,n),r._ratio=n}}),intersectLine:(h=_.R3.create(),c=_.R3.create(),A=_.R3.create(),d=_.R3.create(),g=_.R3.create(),function(e,t,i,n){var r=1e-8;_.R3.sub(h,t,e),_.R3.sub(c,this._end,this._start),_.R3.sub(A,e,this._start);var a,o,s=_.R3.dot(h,h),l=_.R3.dot(h,c),u=_.R3.dot(c,c),f=_.R3.dot(h,A),p=_.R3.dot(c,A),m=s*u-l*l,v=m,b=m;m<r?(a=0,v=1,o=p,b=u):(o=s*p-l*f,(a=l*p-u*f)<0?(a=0,o=p,b=u):a>v&&(a=v,o=p+l,b=u)),o<0?(o=0,-f<0?a=0:-f>s?a=v:(a=-f,v=s)):o>b&&(o=b,-f+l<0?a=0:-f+l>s?a=v:(a=-f+l,v=s));var S=Math.abs(a)<r?0:a/v,E=Math.abs(o)<r?0:o/b;if(_.R3.scaleAndAdd(d,e,h,S),_.R3.scaleAndAdd(g,this._start,c,E),!(_.R3.sqrDist(d,g)>this._threshold*this._threshold)){var y=this.initIntersection(new C);y._i1=i,y._i2=n,y._r1=1-E,y._r2=E,_.R3.copy(y._localIntersectionPoint,g),y._ratio=E}}),intersectTriangle:(n=_.R3.create(),r=_.R3.create(),a=_.R3.create(),o=_.R3.create(),s=_.R3.create(),l=_.R3.create(),u=1e-20,function(e,t,i,h,c,A){var d=this._d;_.R3.sub(r,i,e),_.R3.sub(a,t,e),_.R3.cross(s,d,r);var g=_.R3.dot(s,a);if(!(g>-1e-20&&g<u)){var f=1/g;_.R3.sub(o,this._start,e);var p=_.R3.dot(s,o)*f;if(!(p<0||p>1)){_.R3.cross(l,o,a);var m=_.R3.dot(l,d)*f;if(!(m<0||p+m>1)){var v=_.R3.dot(l,r)*f;if(!(v<u||v>this._length)){var b=1-p-m,S=p,E=m,y=v*this._invLength,I=e[0]*b+t[0]*S+i[0]*E,x=e[1]*b+t[1]*S+i[1]*E,T=e[2]*b+t[2]*S+i[2]*E;_.R3.cross(n,a,r),_.R3.normalize(n,n);var w=this.initIntersection(new C);w._i1=h,w._i2=c,w._i3=A,w._r1=b,w._r2=S,w._r3=E,_.R3.set(w._localIntersectionPoint,I,x,T),_.R3.copy(w._localIntersectionNormal,n),w._ratio=y,w._backface=_._E.determinant(w._matrix)*g<0}}}}}),operatorPoint:function(e){this._threshold<=0||v.Z.prototype.operatorPoint.call(this,e)},operatorLine:function(e,t){this._threshold<=0||v.Z.prototype.operatorLine.call(this,e,t)}}),"osgUtil","LineSegmentIntersectFunctor");const S=b},kjMK:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n,r,a,o=i("0rAA"),s=i("Xbee"),l=i("/Ud6"),u=i("sI9o"),h=function(){l.Z.call(this),this._start=s.R3.create(),this._iStart=s.R3.create(),this._end=s.R3.create(),this._iEnd=s.R3.create(),this._threshold=0,this._iThreshold=0};o.Z.createPrototypeObject(h,o.Z.objectInherit(l.Z.prototype,{set:function(e,t,i){s.R3.copy(this._start,e),s.R3.copy(this._iStart,e),s.R3.copy(this._end,t),s.R3.copy(this._iEnd,t),void 0!==i&&(this._threshold=this._iThreshold=i)},setStart:function(e){s.R3.copy(this._start,e),s.R3.copy(this._iStart,e)},setEnd:function(e){s.R3.copy(this._end,e),s.R3.copy(this._iEnd,e)},intersectNode:function(e){return this.intersectBoundingSphere(e.getBoundingSphere())},intersectBoundingSphere:(r=s.R3.create(),a=s.R3.create(),function(e){if(!e.valid())return!1;s.R3.sub(r,this._iStart,e.center());var t=s.R3.sqrLen(r)-e.radius2();if(t<=0)return!0;s.R3.sub(a,this._iEnd,this._iStart);var i=s.R3.sqrLen(a),n=2*s.R3.dot(r,a),o=n*n-4*i*t;if(o<0)return!1;var l=.5/i,u=(-n-(o=Math.sqrt(o)))*l,h=(-n+o)*l;return!(u<=0&&h<=0||u>1&&h>1)}),intersect:(n=new u.Z,function(e,t){n.setGeometry(t),n.setIntersectionVisitor(e),n.setIntersector(this),n.set(this._iStart,this._iEnd,this._iThreshold);var i=t.getShape();i?i.intersectLineSegment(n,i.getNodes()[0],this._iStart,this._iEnd,this._iThreshold):(t.computeTransformedVertices&&n.setVertices(t.computeTransformedVertices()),n.apply(t),n.reset())}),setCurrentTransformation:function(e){if(s._E.invert(e,e),this._threshold>0){var t=this._iStart;s._E.getScale(t,e);var i=t[0],n=t[1],r=t[2];this._iThreshold=this._threshold*(i>n?i>r?i:r:n>r?n:r)}s.R3.transformMat4(this._iStart,this._start,e),s.R3.transformMat4(this._iEnd,this._end,e)}}),"osgUtil","LineSegmentIntersector");const c=h},"2gPm":(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={NO_LIMIT:0,LIMIT_ONE_PER_DRAWABLE:1,LIMIT_ONE:2,POINT_PRIMITIVES:1,LINE_PRIMITIVES:2,TRIANGLE_PRIMITIVES:4,ALL_PRIMITIVES:7}},ljhH:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var n=i("0rAA"),r=i("Z54E"),a=i("Uf0x"),o=i("vrBm"),s=i("DynT"),l=i("Fdmx"),u=i("FFaL"),h=i("Xbee"),c=i("OKjT"),A=i("zTfe"),d=function(e){o.Z.call(this),this._state=void 0,this._camera=e,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new r.Z,this.setDefaults()};d.debugGraph=!1,n.Z.createPrototypeObject(d,n.Z.objectInherit(o.Z.prototype,{setDefaults:function(){this._state=new l.Z(new c.Z.ShaderGeneratorProxy),this._cullVisitor=new a.Z,this._cullVisitor.setRenderer(this),this._stateGraph=new u.Z,this.getCamera().setClearColor(h.vh.create()),this.setRenderStage(new s.Z);var e=i("zyQd").Z,t=this.getCamera().getOrCreateStateSet();t.setAttributeAndModes(new e.Material),t.setAttributeAndModes(new e.Depth),t.setAttributeAndModes(new e.BlendFunc),t.setAttributeAndModes(new e.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(e){e&&!e.getRenderer()&&e.setRenderer(this),this._cullVisitor=e},setRenderStage:function(e){this._renderStage=e},getCamera:function(){return this._camera},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(e){this._state=e},setGraphicContext:function(e){this._state.setGraphicContext(e)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var e=this.getCamera(),t=e.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),u.Z.reset(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(e.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(e),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(e,e.getViewMatrix(),e.getProjectionMatrix()),e.getBound();var n=t.getLight(),r=i("PAIz").Z;if(n)switch(t.getLightingMode()){case r.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,n);break;case r.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(e.getViewMatrix(),n)}var a=e.getViewport(),o=e.getScissor();this._cullVisitor.pushViewport(a),this._renderStage.setClearDepth(e.getClearDepth()),this._renderStage.setClearColor(e.getClearColor()),this._renderStage.setClearMask(e.getClearMask()),this._renderStage.setViewport(a),this._renderStage.setScissor(o),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(e),this._cullVisitor.popCameraModelViewProjectionMatrix(e),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var e=this.getState();e.resetCacheFrame(),e.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(e),d.debugGraph&&(A.Z.instance().createRenderGraph(this._renderStage),d.debugGraph=!1),this._renderStage.setCamera(void 0),e.applyDefault()}}),"osgViewer","Renderer");const g=d},tUi5:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("0rAA"),r=i("vrBm"),a=i("WClw"),o=function(){r.Z.call(this),this._databasePager=new a.Z,this._sceneData=void 0};n.Z.createPrototypeObject(o,n.Z.objectInherit(r.Z.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(e){this._sceneData=e},setDatabasePager:function(e){this._databasePager=e},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(e){this._databasePager&&this._databasePager.updateSceneGraph(e.getFrameStamp()),this._sceneData&&this._sceneData.accept(e)}}),"osgViewer","Scene");const s=o},PAIz:(e,t,i)=>{"use strict";i.d(t,{Z:()=>x});var n,r,a,o=i("LERn"),s=i("OYOS"),l=i("wh5T"),u=i("WzzD"),h=i("vHSS"),c=i("Xbee"),A=i("FCEq"),d=i("Axet"),g=i("4igZ"),f=i("9YK+"),p=i("2Uq9"),m=i("8dss"),_=i("EMUO"),v=i("MbzV"),C=i("kjMK"),b=i("ljhH"),S=i("tUi5"),E=i("zTfe"),y=i("Hfbx"),I=function(){this._camera=new s.Z,this._camera.setName("OSGJS camera"),this._scene=new S.Z,this._camera.setName("OSGJS Scene"),this._frameStamp=new l.Z,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(I.LightingMode.HEADLIGHT);var e=this.createRenderer(this.getCamera());e.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(e),this.getCamera().setView(this)};I.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},I.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(e){this._requestContinousUpdate=e},createRenderer:function(e){return new b.Z(e)},setGraphicContext:function(e){this.getCamera().getRenderer().getState().setGraphicContext(e)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(e,t){_.Z.instance(e,t)},computeCanvasSize:function(e){a||(window.ResizeObserver?((a=new ResizeObserver((function(){n=e.clientWidth,r=e.clientHeight}))).observe(e),n=e.clientWidth,r=e.clientHeight):(n=e.clientWidth,r=e.clientHeight)),n<1&&(n=1),r<1&&(r=1);var t=this._devicePixelRatio,i=Math.floor(n*t),o=Math.floor(r*t),s=!1;return this._canvasWidth!==i&&(e.width=i,this._canvasWidth=i,s=!0),this._canvasHeight!==o&&(e.height=o,this._canvasHeight=o,s=!0),s},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(e,t){var i=window.devicePixelRatio||1,n=t.getNumber("overrideDevicePixelRatio"),r=t.getNumber("maxDevicePixelRatio")||-1;"number"==typeof n?i=n:-1!==r&&(i=Math.min(i,r)),this._devicePixelRatio=i,this.computeCanvasSize(e);var a=e.width,o=e.height,s=a/o;if(this._camera.setViewport(new p.Z(0,0,a,o)),this._camera.setScissor(new f.Z),this._camera.setGraphicContext(this.getGraphicContext()),c._E.lookAt(this._camera.getViewMatrix(),c.R3.fromValues(0,0,-10),c.R3.create(),c.R3.fromValues(0,1,0)),c._E.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,s,1,1e3),t&&t.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),t&&t.debugGraph){var l=this.getCamera();E.Z.instance().refreshGraph=function(){var e=E.Z.instance();e.setDisplayGraphRenderer(!0),e.createGraph(l)},y.Z.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(e,t,i){return void 0===i&&(i=-1),this._lsi?this._lsi.reset():this._lsi=new C.Z,this._origIntersect||(this._origIntersect=c.R3.create(),this._dstIntersect=c.R3.create()),this._lsi.set(c.R3.set(this._origIntersect,e,t,0),c.R3.set(this._dstIntersect,e,t,1)),this._iv?this._iv.reset():(this._iv=new v.Z,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(i),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},setCamera:function(e){this._camera=e},getCamera:function(){return this._camera},setSceneData:function(e){if(e!==this._scene.getSceneData()){this._scene.setSceneData(e);for(var t=this._camera.getChildren(),i=void 0,n=0,r=t.length;n<r;n++)if("osgStats"===t[n].getName()){i=t[n];break}this._camera.removeChildren(),this._camera.addChild(e),i&&this._camera.addChild(i)}},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(e){this._scene.setDatabasePager(e)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(e){this._manipulator=e},getLight:function(){return this._light},setLight:function(e){this._light=e,this._lightingMode!==I.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(e){this._lightingMode!==e&&(this._lightingMode=e,this._lightingMode!==I.LightingMode.NO_LIGHT?this._light||(this._light=new h.Z):this._light=void 0)},flushDeletedGLObjects:function(e){var t=this.getGraphicContext(),i=e;i=o.Z.flushDeletedGLBufferArrays(t,i),i=m.Z.flushDeletedGLVertexArrayObjects(t,i),i=A.Z.getTextureManager(t).flushDeletedTextureObjects(t,i),i=d.Z.flushDeletedGLPrograms(t,i),i=g.Z.flushDeletedGLShaders(t,i),i=u.Z.flushDeletedGLFrameBuffers(t,i),u.Z.flushDeletedGLRenderBuffers(t,i)},flushAllDeletedGLObjects:function(){var e=this.getGraphicContext();m.Z.flushAllDeletedGLVertexArrayObjects(e),o.Z.flushAllDeletedGLBufferArrays(e),A.Z.getTextureManager(e).flushAllDeletedTextureObjects(e),d.Z.flushAllDeletedGLPrograms(e),g.Z.flushAllDeletedGLShaders(e),u.Z.flushAllDeletedGLFrameBuffers(e),u.Z.flushAllDeletedGLRenderBuffers(e)}};const x=I},"2oON":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n={SCENE:"scene",MANIPULATORS:"scene.manipulators",ORBIT_MANIPULATOR:"scene.manipulators.orbit",ORBIT_MANIPULATOR_MOUSEKEYBOARD:"scene.manipulators.orbit.mousekeyboard",ORBIT_MANIPULATOR_RESETTOHOME:"scene.manipulators.orbit.mousekeyboard.home",ORBIT_MANIPULATOR_TOUCH:"scene.manipulators.orbit.touch",ORBIT_MANIPULATOR_WEBVR:"scene.manipulators.orbit.webvr",ORBIT_MANIPULATOR_DEVICEORIENTATION:"scene.manipulators.orbit.deviceorientation",ORBIT_MANIPULATOR_GAMEPAD:"scene.manipulators.orbit.gamepad",FPS_MANIPULATOR:"scene.manipulators.fps",FPS_MANIPULATOR_MOUSEKEYBOARD:"scene.manipulators.fps.mousekeyboard",FPS_MANIPULATOR_RESETTOHOME:"scene.manipulators.fps.mousekeyboard.home",FPS_MANIPULATOR_TOUCH:"scene.manipulators.fps.touch",FPS_MANIPULATOR_WEBVR:"scene.manipulators.fps.webvr",FPS_MANIPULATOR_DEVICEORIENTATION:"scene.manipulators.fps.deviceorientation",FPS_MANIPULATOR_GAMEPAD:"scene.manipulators.fps.gamepad",CAD_MANIPULATOR:"scene.manipulators.cad",CAD_MANIPULATOR_MOUSEKEYBOARD:"scene.manipulators.cad.mousekeyboard",CAD_MANIPULATOR_RESETTOHOME:"scene.manipulators.cad.mousekeyboard.home",CAD_MANIPULATOR_TOUCH:"scene.manipulators.cad.touch",NODE_GIZMO:"scene.nodegizmo",UI:"ui",STATS:"ui.stats"};const r=n},pZnz:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n,r,a,o=(n=!0,r=function(e,t,i){for(var n=null,r=0;r<i.length;++r){try{n=e.getContext(i[r],t)}catch(e){}if(n)break}return n},{create3DContext:a=function(e,t){var i;if(t&&t.webgl2){if(n=!1,i=r(e,t,["webgl2","experimental-webgl2"]))return i;n=!0}return r(e,t,["webgl","experimental-webgl","webkit-3d","moz-webgl"])},setupWebGL:function(e,t,i){i=i||function(e){if(n){var t=document.getElementsByTagName("body")[0];if(t){var i=window.WebGLRenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';e&&(i+="<br/><br/>Status: "+e),t.innerHTML=function(e){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+e+"</div>"}(i)}}},e.addEventListener&&e.addEventListener("webglcontextcreationerror",(function(e){i(e.statusMessage)}),!1);var r=a(e,t);return r||i(""),r}});window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}),window.cancelRequestAnimFrame||(window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout),Date.now||(Date.now=function(){return(new Date).getTime()});const s=o},S1Ss:(e,t,i)=>{"use strict";i.d(t,{c:()=>l,I:()=>s});var n=i("C+0K"),r=i("cgbd"),a=!0,o=0,s=function(e){a=e},l=function(e){var t,s,l,u,h,c,A,d,g;e.osg.Program.registerErrorCallback((function(f,p,m){if(a&&(!(!m||0===m.length)&&-1===m.indexOf("Internal linking error"))){t||(t=e.osg.WebGLCaps.instance(),s=t.getWebGLParameter("UNMASKED_RENDERER_WEBGL"),l=t.getWebGLParameter("UNMASKED_VENDOR_WEBGL"),u=t.getWebGLParameter("MAX_VARYING_VECTORS"),h=t.getWebGLParameter("MAX_VERTEX_ATTRIBS"),c=t.getWebGLParameter("MAX_FRAGMENT_UNIFORM_VECTORS"),A=t.getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS"),d=i("pcq+"),g=d&&d.apple&&d.apple.device);var _="Shader Error: ";if(_+=m,!g)if(s&&(_+="\n"+s),l&&(_+="\n"+l),30!==u&&(_+="\nVarying: "+u),f&&(16!==h&&(_+="\nAttributes:"+h),4096!==A&&(_+="\nVertUnif:"+A)),1024!==c&&(_+="\nFragUnif:"+c),t.isWebGL2())_+="\nWebGL2";else{var v,C=t.getWebGLExtensions(),b=["EXT_shader_texture_lod","OES_standard_derivatives","OES_vertex_array_object","EXT_texture_filter_anisotropic"];for(v=0;v<b.length;v++){var S=b[v];C[S]&&(_+="\n"+S.substring(S.indexOf("_")+1))}for(var E=["hasLinearFloatRTT","hasLinearHalfFloatRTT","hasHalfFloatRTT","hasFloatRTT"];v<E.length;v++){var y=E[v];t[y]()&&(_+="\n"+y.substring(3))}}f&&(_+="\nVS\n"+f),p&&(_+="\nFS\n "+p);var I="errorLogs ";c<64&&(I="ultraLowGPU");var x={tags:{shaderErrors:I}};if(n.Z.client.captureMessage(_,x),++o>2&&(a=!1),o>1){var T=new r.Z({title:"3D/WebGL context error",text:"An error occurred while rendering the model. It might not look as expected.",safe:!0,buttons:{continue:!0,continueLabel:"OK",cancel:!1}});T.open().then(function(){T.close()}.bind(this))}}}))}},uuWb:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Qo});i("/RWI");var n=i("+qlm"),r=i("zyQd"),a=i("0rAA"),o=i("Xbee");const s={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7};var l={InvalidTargetID:-1},u=function(e,t,i){return{type:e,id:l.InvalidTargetID,channels:[],value:t,defaultValue:i}};l.createQuatTarget=function(e){return u(s.Quat,o.gf.copy(o.gf.create(),e),o.gf.copy(o.gf.create(),e))},l.createVec3Target=function(e){return u(s.Vec3,o.R3.copy(o.R3.create(),e),o.R3.copy(o.R3.create(),e))},l.createFloatTarget=function(e){return u(s.Float,e,e)},l.createMatrixTarget=function(e){return u(s.Matrix,o._E.copy(o._E.create(),e),o._E.copy(o._E.create(),e))};const h=l;var c={},A=function(e,t,i,n,r,a){var o=i[0],s=i[i.length-1];return a.start=o,a.keys=t,a.end=s,a.times=i,a.type=e,a.duration=s-o,a.target=n,a.name=r,a},d={create:function(){return 0}},g={create:function(){return o.R3.create32()}},f={create:function(){return o.gf.create32()}},p=function(e,t){return{channel:t,value:e.create(),targetID:h.InvalidTargetID,weight:1,key:0,start:0,end:0}},m=function(e){return p(g,e)},_=function(e){return p(f,e)},v=function(e){return p(d,e)},C=function(e){return p(d,e)},b=function(e){return p(g,e)};c.createInstanceChannel=function(e){return c[e.type](e)},c.createInstanceVec3Channel=m,c.createInstanceQuatChannel=_,c.createInstanceQuatSlerpChannel=_,c.createInstanceFloatChannel=v,c.createInstanceFloatCubicBezierChannel=C,c.createInstanceVec3CubicBezierChannel=b,c.createVec3Channel=function(e,t,i,n,r){return A(s.Vec3,e,t,i,n,r||{})},c.createQuatChannel=function(e,t,i,n,r){return A(s.Quat,e,t,i,n,r||{})},c.createQuatSlerpChannel=function(e,t,i,n,r){return A(s.QuatSlerp,e,t,i,n,r||{})},c.createFloatChannel=function(e,t,i,n,r){return A(s.Float,e,t,i,n,r||{})},c.createFloatCubicBezierChannel=function(e,t,i,n,r){return A(s.FloatCubicBezier,e,t,i,n,r||{})},c.createVec3CubicBezierChannel=function(e,t,i,n,r){return A(s.Vec3CubicBezier,e,t,i,n,r||{})},c[s.Vec3]=m,c[s.Quat]=_,c[s.QuatSlerp]=_,c[s.Float]=v,c[s.FloatCubicBezier]=C,c[s.Vec3CubicBezier]=b,c.ChannelType=s;const S=c;var E=0,y=function(){};y.createAnimation=function(e,t){for(var i=1/0,n=-1/0,r=0;r<e.length;r++)i=Math.min(i,e[r].start),n=Math.max(n,e[r].end);var a=n-i,o=t||"animation"+E.toString();return E++,{channels:e,duration:a,name:o,start:i}},y.createInstanceAnimation=function(e){for(var t=[],i=0;i<e.channels.length;i++){var n=S.createInstanceChannel(e.channels[i]);t.push(n)}return{channels:t,duration:e.duration,start:0,name:e.name,firstKeyTime:e.start}};const I=y;var x,T,w,M,R,B,N=i("q/dS"),D=i("mVLc"),P=i("Hfbx"),F=i("vrBm"),O=function(e,t,i){i[0]=t[e++],i[1]=t[e++],i[2]=t[e++]},L=function(e,t,i){i[0]=t[e++],i[1]=t[e++],i[2]=t[e++],i[3]=t[e++]},k=function(e,t){var i=t.channel,n=t.value,r=i.keys,a=i.times;if(e>=a[a.length-1])return t.key=0,void O(r.length-3,r,n);if(e<=a[0])return t.key=0,void O(0,r,n);var o=t.key;if(e>a[o])for(;a[o+1]<e;)o++;else if(e<a[o])for(;a[o]>e;)o--;var s=a[o],l=a[o+1],u=3*o,h=r[u++],c=r[u++],A=r[u++],d=r[u++],g=r[u++],f=r[u++],p=(e-s)/(l-s);n[0]=h+(d-h)*p,n[1]=c+(g-c)*p,n[2]=A+(f-A)*p,t.key=o},Z=(x=o.gf.create32(),T=o.gf.create32(),function(e,t){var i=t.channel,n=t.value,r=i.keys,a=i.times;if(e>=a[a.length-1])return t.key=0,void L(r.length-4,r,n);if(e<=a[0])return t.key=0,void L(0,r,n);var s=t.key;if(e>a[s])for(;a[s+1]<e;)s++;else if(e<a[s])for(;a[s]>e;)s--;var l=a[s],u=a[s+1],h=4*s;x[0]=r[h++],x[1]=r[h++],x[2]=r[h++],x[3]=r[h++],T[0]=r[h++],T[1]=r[h++],T[2]=r[h++],T[3]=r[h++];var c=(e-l)/(u-l);o.gf.nlerp(n,x,T,c),t.key=s}),U=function(){var e=o.gf.create32(),t=o.gf.create32();return function(i,n){var r=n.channel,a=n.value,s=r.keys,l=r.times;if(i>=l[l.length-1])return n.key=0,void L(s.length-4,s,a);if(i<=l[0])return n.key=0,void L(0,s,a);var u=n.key;if(i>l[u])for(;l[u+1]<i;)u++;else if(i<l[u])for(;l[u]>i;)u--;var h=l[u],c=l[u+1],A=4*u;e[0]=s[A++],e[1]=s[A++],e[2]=s[A++],e[3]=s[A++],t[0]=s[A++],t[1]=s[A++],t[2]=s[A++],t[3]=s[A++];var d=(i-h)/(c-h);o.gf.slerp(a,e,t,d),n.key=u}}(),V=function(e,t){var i=t.channel,n=t.value,r=i.keys,a=i.times;if(e>=a[a.length-1])return t.key=0,void(t.value=r[r.length-1]);if(e<=a[0])return t.key=0,void(t.value=r[0]);var o=t.key;if(e>a[o])for(;a[o+1]<e;)o++;else if(e<a[o])for(;a[o]>e;)o--;var s=a[o],l=a[o+1],u=o,h=r[u++];n=h+(r[u++]-h)*((e-s)/(l-s)),t.key=o,t.value=n},Q=function(e,t){var i=t.channel,n=t.value,r=i.keys,a=i.times;if(e>=a[a.length-1])return t.key=0,void(t.value=r[r.length-3]);if(e<=a[0])return t.key=0,void(t.value=r[0]);var o=t.key;if(e>a[o])for(;a[o+1]<e;)o++;else if(e<a[o])for(;a[o]>e;)o--;var s=(e-a[o])/(a[o+1]-a[o]),l=1-s,u=l*l,h=u*l,c=s*s,A=3*o;n=r[A]*h+r[A+1]*(3*s*u)+r[A+2]*(3*c*l)+r[A+3]*(c*s),t.key=o,t.value=n},G=(w=o.R3.create(),M=o.R3.create(),R=o.R3.create(),B=o.R3.create(),function(e,t){var i=t.channel,n=t.value,r=i.keys,a=i.times;if(e>=a[a.length-1])return t.key=0,void O(r.length-9,r,n);if(e<=a[0])return t.key=0,void O(0,r,n);var s=t.key;if(e>a[s])for(;a[s+1]<e;)s++;else if(e<a[s])for(;a[s]>e;)s--;var l=(e-a[s])/(a[s+1]-a[s]),u=1-l,h=u*u,c=h*u,A=l*l,d=9*s;o.R3.scale(w,o.R3.set(w,r[d++],r[d++],r[d++]),c),o.R3.scale(M,o.R3.set(M,r[d++],r[d++],r[d++]),3*l*h),o.R3.scale(R,o.R3.set(R,r[d++],r[d++],r[d++]),3*A*u),o.R3.scale(B,o.R3.set(B,r[d++],r[d++],r[d++]),A*l),n[0]=w[0]+M[0]+R[0]+B[0],n[1]=w[1]+M[1]+R[1]+B[1],n[2]=w[2]+M[2]+R[2]+B[2],t.key=s}),H=S.ChannelType,z={};z[H.Vec3]=k,z[H.Quat]=Z,z[H.QuatSlerp]=U,z[H.Float]=V,z[H.FloatCubicBezier]=Q,z[H.Vec3CubicBezier]=G,z.Vec3LerpInterpolator=k,z.QuatLerpInterpolator=Z,z.QuatSlerpInterpolator=U,z.FloatLerpInterpolator=V,z.FloatCubicBezierInterpolator=Q,z.Vec3CubicBezierInterpolator=G;const W=z;var j=i("2bAw"),q=function(){j.Z.call(this),this._animationUpdateCallback={}};a.Z.createPrototypeObject(q,a.Z.objectInherit(j.Z.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(e){for(var t=e.getUpdateCallbackList(),i=0,n=t.length;i<n;i++){var r=t[i];r instanceof D.Z&&(this._animationUpdateCallback[r.getInstanceID()]=r)}this.traverse(e)}}),"osgAnimation","CollectAnimationUpdateCallbackVisitor");const J=q;var Y=i("LERn"),K=i("eyVe"),X=i("Zodj"),$=function(){D.Z.call(this),this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(X.Z.MAX_MORPH_GPU),this._indexMap=new Uint32Array(X.Z.MAX_MORPH_GPU),this._gpuMorphed=[],this._maxMorphGPU=-1},ee=function(e,t){return Math.abs(t.value)-Math.abs(e.value)};a.Z.createPrototypeObject($,a.Z.objectInherit(D.Z.prototype,{_initNode:function(e){var t;e instanceof X.Z?t=e:e instanceof K.Z&&e.getSourceGeometry()instanceof X.Z&&(t=e.getSourceGeometry()),t&&t.getName()===this.getName()&&(t.isInitialized()||t.init(),this._morphs.push(t),this._maxMorphGPU=Math.min(this._maxMorphGPU,t.getMaximumPossibleMorphGPU()))},init:function(e){this._maxMorphGPU=X.Z.MAX_MORPH_GPU,this._morphs.length=0;var t=e.getChildren();if(t.length)for(var i=0,n=t.length;i<n;i++)this._initNode(t[i]);else this._initNode(e)},isInitialized:function(){var e=this._morphs,t=e.length;if(!t)return!1;for(var i=0;i<t;++i)if(!e[i].isInitialized())return!1;return!0},getNumTarget:function(){return this._targets.length},getTarget:function(e){return this._targets[e]},getTargetName:function(e){return this._targetNames[e]},addTarget:function(e,t){this._targets[t]=h.createFloatTarget(0),this._targetNames[t]=e},_remapBufferArrays:function(){for(var e=this._indexMap,t=this._morphs,i=0;i<this._maxMorphGPU;++i)for(var n="_"+i,r="_"+e[i],a=0,o=t.length;a<o;++a)for(var s=t[a],l=s.getVertexAttributeList(),u=s.getMorphTargetNames(),h=0,c=u.length;h<c;++h){var A=u[h];l[A+n].setBufferArray(l[A+r].getInitialBufferArray())}},_mergeExtraMorphTarget:function(e,t,i){var n=0,r=this._gpuMorphed,a=e[t],o=a.getElements().length,s=o/a.getItemSize(),l=a.getItemSize();a._cpuMorph=a._cpuMorph||new Y.Z(Y.Z.ARRAY_BUFFER,new Float32Array(o),l);var u=a._cpuMorph.getElements();for(n=0;n<o;++n)u[n]=0;for(var h=this._targets,c=0,A=h.length;c<A;++c)if(!0!==r[c]){var d=h[c].value;if(!(Math.abs(d)<=X.Z.EFFECTIVE_EPS)){d/=i;var g=e[t+"_"+c].getInitialBufferArray().getElements();for(n=0;n<s;++n){var f=n*l;u[f]+=d*g[f],u[f+1]+=d*g[f+1],u[f+2]+=d*g[f+2]}}}e[t+"_"+(this._maxMorphGPU-1)].setBufferArray(a._cpuMorph),a._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var e=this._gpuMorphed,t=0,i=this._targets,n=0,r=i.length;n<r;++n)if(!0!==e[n]){var a=i[n].value;Math.abs(a)<=X.Z.EFFECTIVE_EPS||(t+=a)}var o=1e-5;return Math.abs(t)>o?t:t<0?-o:o},_morphBufferArrayCPU:function(){for(var e=this._weights[this._maxMorphGPU-1]=this._computeExtraWeightsSum(),t={},i=this._morphs,n=0,r=i.length;n<r;++n)for(var a=i[n],o=a.getVertexAttributeList(),s=a.getMorphTargetNames(),l=0,u=s.length;l<u;++l){var h=s[l],c=o[h];c&&!t[c.getInstanceID()]&&(t[c.getInstanceID()]=!0,this._mergeExtraMorphTarget(o,h,e))}},updateWeights:function(){if(0!==this._maxMorphGPU){var e=0,t=this._targets,i=t.length,n=this._weights;if(n[0]=n[1]=n[2]=n[3]=0,i<=this._maxMorphGPU)for(e=0;e<i;++e)n[e]=t[e].value;else{var r=this._indexMap;r[0]=r[1]=r[2]=r[3]=0;var a=this._gpuMorphed;for(a.length=i,e=0;e<i;++e)a[e]=!1;var o=t.slice(0).sort(ee);for(e=0;e<this._maxMorphGPU;++e){var s=t.indexOf(o[e]);a[s]=!0,r[e]=s,n[e]=o[e].value}var l=Math.abs(o[this._maxMorphGPU].value)>X.Z.EFFECTIVE_EPS;a[r[this._maxMorphGPU-1]]=!l,this._remapBufferArrays(),l&&this._morphBufferArrayCPU()}}},reset:function(){for(var e=this._targets,t=0,i=e.length;t<i;++t)e[t].value=e[t].defaultValue},update:function(e){this.isInitialized()||this.init(e),this.updateWeights();for(var t=this._weights,i=Math.min(this._maxMorphGPU,this._targets.length),n=this._morphs,r=0,a=n.length;r<a;++r)for(var o=n[r].getTargetsWeight(),s=0;s<i;s++)o[s]=t[s];return!0}}),"osgAnimation","UpdateMorph");const te=$;var ie=i("tt4o"),ne=i("Fyvm"),re={lerp:function(e,t,i){return e+(t-e)*i},init:function(){return 0},copy:function(e,t){return t},create:function(){return 0}},ae=[];ae[S.ChannelType.Float]=1,ae[S.ChannelType.FloatCubicBezier]=1,ae[S.ChannelType.Vec3]=3,ae[S.ChannelType.Vec3CubicBezier]=3,ae[S.ChannelType.Quat]=4,ae[S.ChannelType.QuatSlerp]=4,ae[S.ChannelType.Matrix]=16;var oe=[];oe.length=S.ChannelType.Count,oe[S.ChannelType.Vec3]=o.R3,oe[S.ChannelType.Quat]=o.gf,oe[S.ChannelType.QuatSlerp]=o.gf,oe[S.ChannelType.Float]=re,oe[S.ChannelType.FloatCubicBezier]=re,oe[S.ChannelType.Vec3CubicBezier]=o.R3,oe[S.ChannelType.Matrix]=o._E;var se=function(){F.Z.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=S.ChannelType.Count;for(var e=0,t=this._targetsByTypes.length;e<t;e++)this._targetsByTypes[e]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=S.ChannelType.Count;for(var i=0,n=this._activeChannelsByTypes.length;i<n;i++)this._activeChannelsByTypes[i]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};a.Z.createPrototypeObject(se,a.Z.objectInherit(F.Z.prototype,{init:function(e){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var t=0,i=this._activeChannelsByTypes.length;t<i;t++)this._activeChannelsByTypes[t].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(e)},addAnimations:function(e){var t=this._addAnimation(e);Array.prototype.push.apply(this._animationsToRegister,t),this._dirty=!0,this._registerAnimations()},update:function(e,t){this._dirty&&(this._findAnimationUpdateCallback(e),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var i=t.getFrameStamp().getSimulationTime();return-1!==this._seekTime&&(this._pauseTime=-this._seekTime+this._startTime+i),this._seekTime=-1,this._pause?this._pauseTime=i-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(i-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(e){this._processStartAnimation(e);for(var t=S.ChannelType.Count,i=0;i<t;i++){var n=this._activeChannelsByTypes[i];this._updateChannelsType(e,n,W[i])}for(var r=0;r<t;r++){var a=this._targetsByTypes[r];this._updateTargetType(a,oe[r])}for(var o=0,s=this._animationsUpdateCallbackArray.length;o<s;o++){this._animationsUpdateCallbackArray[o].computeChannels()}this._removeFinishedAnimation(e)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(e){this._simulationTime=e},setSeekTime:function(e){this._simulationTime=e,this._seekTime=e},stopAnimation:function(e){for(var t=this._activeAnimationList,i=0,n=t.length;i<n;++i)if(t[i].name===e)return this._removeActiveChannels(this._instanceAnimations[e]),this._activeAnimations[e]=void 0,void t.splice(i,1)},stopAllAnimation:function(){for(var e=this._activeAnimationList,t=0,i=e.length;t<i;++t){var n=e[t].name;this._removeActiveChannels(this._instanceAnimations[n]),this._activeAnimations[n]=void 0}e.length=0},setTimeFactor:function(e){var t=e/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*t)/t,this._timeFactor=e,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*t)/t)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(e){return!!this._activeAnimations[e]},playAnimationObject:function(e){var t=this._instanceAnimations[e.name];t?this.isPlaying(e.name)||(t.priority=void 0===e.priority?0:e.priority,t.weight=void 0===e.weight?1:e.weight,t.loop=void 0===e.loop||e.loop,this._startAnimations[t.name]=t):P.Z.info("no animation "+e.name+" found")},playAnimation:function(e,t,i,n){var r;return r="object"==typeof e?e:{name:e,priority:i,weight:n,loop:t},this.playAnimationObject(r)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var e=0,t=this._animationsToRegister.length;e<t;e++){var i=this._animationsToRegister[e];this._registerInstanceAnimation(i)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(e){for(var t=e.channels,i=0,n=t.length;i<n;i++){var r=t[i],a=r.channel.target+"."+r.channel.name;this._targetMap[a]?r.targetID=this._targetMap[a].id:P.Z.warn("registerInstanceAnimation did not find targetName ("+a+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(e){var t=new J;e.accept(t),this._animationsUpdateCallback=t.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();var e,t,i=0,n=this._targetMap,r=this._targets,a=function(e,t){if(n[e])t!==n[e]&&P.Z.warn("detected differents target instance with the same name ("+e+")");else{n[e]=t,t.id=i++,r.push(t);var a=t.type;this._targetsByTypes[a].push(t)}}.bind(this);for(var o in this._animationsUpdateCallback){var s=this._animationsUpdateCallback[o];if(s instanceof ne.Z||s instanceof ie.Z){var l=s.getStackedTransforms(),u=l.length;if(!u)continue;this._animationsUpdateCallbackArray.push(s);for(var h=0;h<u;h++){var c=l[h];e=c.getTarget(),t=c.getName(),a(s.getName()+"."+t,e,t)}}else if(s instanceof te){var A=s.getNumTarget();if(!A)continue;this._animationsUpdateCallbackArray.push(s);for(var d=0;d<A;d++)a((t=s.getTargetName(d))+"."+d,e=s.getTarget(d),t)}}},_addAnimation:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],a=r.name;if(!this._instanceAnimations[a]){var o=I.createInstanceAnimation(r);this._instanceAnimations[a]=o,t.push(o)}}return t},_addActiveChannels:function(e,t){for(var i=t.channels,n=0,r=i.length;n<r;n++){var a=i[n],o=a.channel.type;a.t=e,a.instanceAnimation=t;var s=a.targetID;s!==h.InvalidTargetID&&(this._activeChannelsByTypes[o].push(a),this._targets[s].channels.push(a))}},_removeActiveChannels:function(e){for(var t=e.channels,i=0,n=t.length;i<n;i++){var r=t[i],a=r.channel.type,o=r.targetID;if(o!==h.InvalidTargetID){var s=this._targets[o].channels,l=s.indexOf(r);s.splice(l,1);var u=this._activeChannelsByTypes[a],c=u.indexOf(r);u.splice(c,1)}}},_updateTargetType:function(e,t){for(var i=0,n=e.length;i<n;i++){var r=e[i],a=r.channels,o=a.length;if(0===o)r.value=t.copy(r.value,r.defaultValue);else if(1===o)r.value=t.copy(r.value,a[0].value);else{r.value=t.init(r.value);for(var s=0,l=0,u=a.length;l<u;l++){var h=a[l],c=h.weight;if(0!==(s+=c)&&0!==c){var A=c/s;r.value=t.lerp(r.value,r.value,h.value,A)}}}}},_updateChannelsType:function(e,t,i){for(var n=0,r=t.length;n<r;n++){var a=t[n],o=a.instanceAnimation,s=o.loop,l=e-a.t;s&&o.duration>0&&(l<0?l=o.duration-Math.abs(l%o.duration):l%=o.duration),i(l+o.firstKeyTime,a)}},_removeFinishedAnimation:function(e){for(var t=this._activeAnimationList,i=0;i<t.length;){var n=t[i],r=n.name;e>n.end&&!1===n.loop?(this._removeActiveChannels(n),this._activeAnimations[r]=void 0,t.splice(i,1)):i++}},_addActiveAnimation:function(e,t){this._activeAnimations[t.name]=t;var i=this._instanceAnimations[t.name];i.start=e,i.end=e+i.duration,this._addActiveChannels(e,i),this._activeAnimationList.push(i)},_processStartAnimation:function(e){if(this._targets.length){var t;for(t in this._startAnimations){var i=this._startAnimations[t],n=i.name;this.isPlaying(n)||this._addActiveAnimation(e,i)}void 0!==t&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var e=0,t=this._targetsByTypes.length;e<t;e++)this._targetsByTypes[e].length=0},resetUpdateCallbacks:function(){for(var e=this._animationsUpdateCallbackArray,t=0,i=e.length;t<i;t++)e[t].reset()},resetAllStackedTransforms:function(){P.Z.warn("Uses resetUpdateCallback instead"),this.resetUpdateCallbacks()},setAnimationLerpEndStart:function(e,t){var i=e.channels;void 0===e.originalDuration&&(e.originalDuration=e.duration),e.duration=e.originalDuration+t;for(var n=e.firstKeyTime,r=e.originalDuration,a=0,o=i.length;a<o;++a){var s=i[a].channel;if(!(Math.abs(s.start-n)>.01||Math.abs(s.duration-r)>.01)){void 0===s.originalEnd&&(s.originalEnd=s.end),s.end=s.originalEnd+t;var l=ae[s.type],u=s.times.buffer.byteLength/4;if(0===t)s.keys=new Float32Array(s.keys.buffer,0,(u-1)*l),s.times=new Float32Array(s.times.buffer,0,u-1);else{s.keys=new Float32Array(s.keys.buffer,0,u*l);for(var h=(u-1)*l,c=0;c<l;++c)s.keys[h+c]=s.keys[c];s.times=new Float32Array(s.times.buffer,0,u),s.times[u-1]=s.times[u-2]+t}}}}}),"osgAnimation","BasicAnimationManager"),se.TypeToSize=ae;const le=se;var ue=i("KiRa");const he={easeLinear:function(e){return e},easeOutQuad:function(e){var t=e-1;return 1-t*t},easeInQuad:function(e){return e*e},easeInOutQuad:function(e){var t=e-1,i=2*e;return i<1?e*i:1-t*t*2},easeOutCubic:function(e){var t=e-1;return 1+t*t*t},easeInCubic:function(e){return e*e*e},easeInOutCubic:function(e){var t=e-1,i=2*e;return i<1?e*i*i:1+t*t*t*4},easeOutQuart:function(e){var t=e-1;return 1-t*t*t*t},easeInQuart:function(e){return e*e*e*e},easeInOutQuart:function(e){var t=e-1,i=2*e;return i<1?e*i*i*i:1-t*t*t*t*8},easeOutQuintic:function(e){var t=e-1;return 1+t*t*t*t*t},easeInQuintic:function(e){return e*e*e*e*e},easeInOutQuintic:function(e){var t=e-1,i=2*e;return i<1?e*i*i*i*i:1+t*t*t*t*t*16},easeOutSextic:function(e){var t=e-1;return 1-t*t*t*t*t*t},easeInSextic:function(e){return e*e*e*e*e*e},easeInOutSextic:function(e){var t=e-1,i=2*e;return i<1?e*i*i*i*i*i:1-t*t*t*t*t*t*32},easeOutSeptic:function(e){var t=e-1;return 1+t*t*t*t*t*t*t},easeInSeptic:function(e){return e*e*e*e*e*e*e},easeInOutSeptic:function(e){var t=e-1,i=2*e;return i<1?e*i*i*i*i*i*i:1+t*t*t*t*t*t*t*64},easeOutOctic:function(e){var t=e-1;return 1-t*t*t*t*t*t*t*t},easeInOctic:function(e){return e*e*e*e*e*e*e*e},easeInOutOctic:function(e){var t=e-1,i=2*e;return i<1?e*i*i*i*i*i*i*i:1-t*t*t*t*t*t*t*t*128},easeOutBack:function(e){var t=e-1,i=1.70158;return 1+t*t*(t*(i+1)+i)},easeInBack:function(e){var t=1.70158;return e*e*(e*(t+1)-t)},easeInOutBack:function(e){var t=e-1,i=2*e,n=2.5949095;return e<.5?e*i*(i*(n+1)-n):1+2*t*t*(2*t*(n+1)+n)},easeOutCircle:function(e){var t=e-1;return Math.sqrt(1-t*t)},easeInCircle:function(e){return 1-Math.sqrt(1-e*e)},easeInOutCircle:function(e){var t=e-1,i=2*e;return i<1?.5*(1-Math.sqrt(1-i*i)):.5*(Math.sqrt(1-4*t*t)+1)},easeOutElastic:function(e){return Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1},easeInElastic:function(e){return-1*Math.pow(2,10*e)*Math.sin(2*(e-1-.075)*Math.PI/.3)},easeInOutElastic:function(e){return(e*=2)<1?1*Math.pow(2,10*e)*-.5*Math.sin(2*(e-1-.45)*Math.PI/.45):1*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-.45)*Math.PI/.45)*.5+1},easeOutBounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBounce:function(e){return(e=1-e)<1/2.75?1-7.5625*e*e:e<2/2.75?1-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?1-(7.5625*(e-=2.25/2.75)*e+.9375):1-(7.5625*(e-=2.625/2.75)*e+.984375)},easeInOutBounce:function(e){var t;return e<.5?(t=!0,e=1-2*e):e=2*e-1,e<1/2.75?e*=7.5625*e:e=e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5}};var ce=i("55Qt"),Ae=i("M6jq"),de=function(e,t){F.Z.call(this),this._target=h.createMatrixTarget(t||o._E.IDENTITY),e&&this.setName(e)};a.Z.createPrototypeObject(de,a.Z.objectInherit(F.Z.prototype,{init:function(e){this.setMatrix(e),o._E.copy(this._target.defaultValue,e)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(e){o._E.copy(this._target.value,e)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(e){o._E.mul(e,e,this._target.value)}}),"osgAnimation","StackedMatrix");const ge=de;var fe,pe=o.gf.create(),me=function(e,t){F.Z.call(this),this._target=h.createQuatTarget(t||pe),e&&this.setName(e)};a.Z.createPrototypeObject(me,a.Z.objectInherit(F.Z.prototype,{init:function(e){this.setQuaternion(e),o.gf.copy(this._target.defaultValue,e)},setQuaternion:function(e){o.gf.copy(this._target.value,e)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:(fe=o._E.create(),function(e){var t=fe;o._E.fromQuat(t,this._target.value),o._E.mul(e,e,t)})}),"osgAnimation","StackedQuaternion");const _e=me;var ve=function(e,t,i){F.Z.call(this),this._axis=o.R3.fromValues(0,0,1),t&&o.R3.copy(this._axis,t),this._target=h.createFloatTarget("number"==typeof i?i:0),e&&this.setName(e)};a.Z.createPrototypeObject(ve,a.Z.objectInherit(F.Z.prototype,{init:function(e,t){this.setAxis(e),this.setAngle(t),this._target.defaultValue=t},setAxis:function(e){o.R3.copy(this._axis,e)},setAngle:function(e){this._target.value=e},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var e=o._E.create(),t=o.gf.create();return function(i){var n=this._axis,r=t,a=e,s=this._target.value;o.gf.setAxisAngle(r,n,s),o._E.fromQuat(a,r),o._E.mul(i,i,a)}}()}),"osgAnimation","StackedRotateAxis");const Ce=ve;var be=function(e,t){F.Z.call(this),this._target=h.createVec3Target(t||o.R3.ONE),e&&this.setName(e)};a.Z.createPrototypeObject(be,a.Z.objectInherit(F.Z.prototype,{init:function(e){this.setScale(e),o.R3.copy(this._target.defaultValue,e)},setScale:function(e){o.R3.copy(this._target.value,e)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(e){var t=this._target.value;o._E.scale(e,e,t)}}),"osgAnimation","StackedScale");const Se=be;var Ee=function(e,t){F.Z.call(this),this._target=h.createVec3Target(t||o.R3.ZERO),e&&this.setName(e)};a.Z.createPrototypeObject(Ee,a.Z.objectInherit(F.Z.prototype,{init:function(e){this.setTranslate(e),o.R3.copy(this._target.defaultValue,e)},setTranslate:function(e){o.R3.copy(this._target.value,e)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(e){o._E.translate(e,e,this._target.value)}}),"osgAnimation","StackedTranslate");const ye=Ee;var Ie=i("LAkO"),xe={};a.Z.objectMix(xe,he),a.Z.objectMix(xe,W),xe.Animation=I,xe.SkinningAttribute=N.Z,xe.AnimationUpdateCallback=D.Z,xe.BasicAnimationManager=le,xe.Bone=ue.Z,xe.Channel=S,xe.CollectAnimationUpdateCallbackVisitor=J,xe.MorphAttribute=ce.Z,xe.MorphGeometry=X.Z,xe.RigGeometry=K.Z,xe.Skeleton=Ae.Z,xe.StackedMatrix=ge,xe.StackedQuaternion=_e,xe.StackedRotateAxis=Ce,xe.StackedScale=Se,xe.StackedTranslate=ye,xe.UpdateBone=ie.Z,xe.UpdateMatrixTransform=ne.Z,xe.UpdateMorph=te,xe.UpdateSkeleton=Ie.Z;const Te=xe;var we=i("QJj4"),Me=i("B3Qy"),Re=i("WClw"),Be=i("lZH+"),Ne=i.n(Be),De=i("a72h"),Pe=a.Z.rejectObject,Fe={Object:function(e,t){var i=e.getJSON();if(i.Name&&t.setName(i.Name),i.UserDataContainer){var n=e.setJSON(i.UserDataContainer).readUserDataContainer();void 0!==n&&t.setUserData(n)}return t},Node:function(e,t){var i=e.getJSON();Fe.Object(e,t);var n=[];if(i.UpdateCallbacks)for(var r=t.addUpdateCallback.bind(t),a=0,o=i.UpdateCallbacks.length;a<o;a++){var s=e.setJSON(i.UpdateCallbacks[a]).readObject();n.push(s),s.then(r)}if(i.StateSet){var l=e.setJSON(i.StateSet).readObject();n.push(l),l.then(t.setStateSet.bind(t))}var u=[];if(i.Children)for(var h=0,c=i.Children.length;h<c;h++)u.push(e.setJSON(i.Children[h]).readObject());return Ne().all(n).then((function(){return Ne().all(u).then((function(e){for(var i=e.length,n=0;n<i;n++)t.addChild(e[n]);return t}))}))},StateSet:function(e,t){var i=e.getJSON();Fe.Object(e,t),void 0!==i.RenderingHint&&t.setRenderingHint(i.RenderingHint);var n,r,a=[];if(void 0!==i.AttributeList)for(var o=0,s=i.AttributeList.length;o<s;o++)n=i.AttributeList[o],r=void 0,(r=e.setJSON(n).readObject()).isRejected()||(a.push(r),r.then(t.setAttributeAndModes.bind(t)));var l=function(i,n){var r=e.setJSON(n).readObject();r.isRejected()||(a.push(r),r.then(t.setTextureAttributeAndModes.bind(t,i)))};if(i.TextureAttributeList)for(var u=i.TextureAttributeList,h=0,c=u.length;h<c;h++)for(var A=u[h],d=0,g=A.length;d<g;d++)l(h,A[d]);return Ne().all(a).then((function(){return t}))},Material:function(e,t){var i=e.getJSON();return i.Diffuse&&i.Emission&&i.Specular&&void 0!==i.Shininess?(Fe.Object(e,t),t.setAmbient(i.Ambient),t.setDiffuse(i.Diffuse),t.setEmission(i.Emission),t.setSpecular(i.Specular),t.setShininess(i.Shininess),Ne().resolve(t)):Pe("Material",i)},BlendFunc:function(e,t){var i=e.getJSON();return i.SourceRGB&&i.SourceAlpha&&i.DestinationRGB&&i.DestinationAlpha?(Fe.Object(e,t),t.setSourceRGB(i.SourceRGB),t.setSourceAlpha(i.SourceAlpha),t.setDestinationRGB(i.DestinationRGB),t.setDestinationAlpha(i.DestinationAlpha),Ne().resolve(t)):Pe("BlendFunc",i)},CullFace:function(e,t){var i=e.getJSON();return void 0===i.Mode?Pe("CullFace",i):(Fe.Object(e,t),t.setMode(i.Mode),Ne().resolve(t))},BlendColor:function(e,t){var i=e.getJSON();return i.ConstantColor?(Fe.Object(e,t),t.setConstantColor(i.ConstantColor),Ne().resolve(t)):Pe("BlendColor",i)},Light:function(e,t){var i=e.getJSON();return i.Ambient&&i.Diffuse&&i.Direction&&i.Position&&i.Specular&&void 0!==i.LightNum&&void 0!==i.SpotCutoff&&void 0!==i.LinearAttenuation&&void 0!==i.ConstantAttenuation&&void 0!==i.QuadraticAttenuation?(Fe.Object(e,t),t.setAmbient(i.Ambient),t.setConstantAttenuation(i.ConstantAttenuation),t.setDiffuse(i.Diffuse),t.setDirection(i.Direction),t.setLightNumber(i.LightNum),t.setLinearAttenuation(i.LinearAttenuation),t.setPosition(i.Position),t.setQuadraticAttenuation(i.QuadraticAttenuation),t.setSpecular(i.Specular),t.setSpotCutoff(i.SpotCutoff),t.setSpotBlend(.01),void 0!==i.SpotExponent&&t.setSpotBlend(i.SpotExponent/128),Ne().resolve(t)):Pe("Light",i)},Texture:function(e,t){var i=e.getJSON();Fe.Object(e,t),i.MinFilter&&t.setMinFilter(i.MinFilter),i.MagFilter&&t.setMagFilter(i.MagFilter),i.WrapT&&t.setWrapT(i.WrapT),i.WrapS&&t.setWrapS(i.WrapS);var n=i.File;return void 0===n&&(n="no-image-provided"),e.readImageURL(n).then((function(e){return t.setImage(e),t}))},Projection:function(e,t){var i=e.getJSON();if(!i.Matrix)return Pe("Projection",i);var n=Fe.Node(e,t);return t.setMatrix(i.Matrix),n},MatrixTransform:function(e,t){var i=e.getJSON();if(!i.Matrix)return Pe("MatrixTransform",i);var n=Fe.Node(e,t);return t.setMatrix(i.Matrix),n},LightSource:function(e,t){var i=e.getJSON();if(!i.Light)return Pe("LightSource",i);var n=Fe.Node(e,t);return Ne().all([e.setJSON(i.Light).readObject(),n]).then((function(e){var n=e[0];return t.setLight(n),"ABSOLUTE_RF"===i.ReferenceFrame&&t.setReferenceFrame(De.Z.ABSOLUTE_RF),t}))},functionSortAttributes:function(e,t){return-1!==e.indexOf("TexCoord")&&-1!==t.indexOf("TexCoord")?parseInt(e.substr(8),10)-parseInt(t.substr(8),10):e<t?-1:e>t?1:0},Geometry:function(e,t){var i=e.getJSON();if(!i.VertexAttributeList)return Pe("Geometry",i);i.PrimitiveSetList=i.PrimitiveSetList||[];var n=[];n.push(Fe.Node(e,t));var r=t.getPrimitives(),a=r.push.bind(r),o=0,s=i.PrimitiveSetList.length;for(o=0;o<s;o++){var l=e.setJSON(i.PrimitiveSetList[o]).readPrimitiveSet();n.push(l),l.then(a)}var u=function(e,t){this.getVertexAttributeList()[e]=t},h=i.VertexAttributeList,c=window.Object.keys(h);for(c.sort(Fe.functionSortAttributes),s=c.length,o=0;o<s;o++){var A=c[o],d=e.setJSON(h[A]).readBufferArray();n.push(d),d.then(u.bind(t,A))}return Ne().all(n).then((function(){return t}))},PagedLOD:function(e,t){var i,n=e.getJSON();Fe.Object(e,t),"USE_BOUNDING_SPHERE_CENTER"===n.CenterMode?t.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===n.CenterMode&&t.setCenterMode(2),t.setCenter([n.UserCenter[0],n.UserCenter[1],n.UserCenter[2]]),t.setRadius(n.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===n.RangeMode&&t.setRangeMode(1);for(var r=n.RangeList,a=0;a<window.Object.keys(r).length;a++){var o=r[i="Range "+a];t.setRange(a,o[0],o[1])}for(r=n.RangeDataList,a=0;a<window.Object.keys(r).length;a++)i="File "+a,t.setFileName(a,r[i]);t.setDatabasePath(e.getDatabasePath());var s=[];if(n.Children)for(var l=0,u=n.Children.length;l<u;l++)s.push(e.setJSON(n.Children[l]).readObject());return Ne().all(s).then((function(e){var i=e.length;for(a=0;a<i;a++)t.addChildNode(e[a]);return t}))}};const Oe=Fe;var Le=i("EUBb"),ke=a.Z.rejectObject,Ze={},Ue=function(){},Ve=Me.Z.registry();Ve.registerObject("osgAnimation.Vec3LerpChannel",Ue),Ve.registerObject("osgAnimation.FloatLerpChannel",Ue),Ve.registerObject("osgAnimation.QuatSlerpChannel",Ue),Ve.registerObject("osgAnimation.QuatLerpChannel",Ue),Ve.registerObject("osgAnimation.FloatCubicBezierChannel",Ue),Ve.registerObject("osgAnimation.Vec3CubicBezierChannel",Ue),Ve.registerObject("osgAnimation.StackedMatrixElement",ge),Ve.registerObject("osgAnimation.StackedScaleElement",Se),Ze.Animation=function(e){var t=e.getJSON();if(void 0===t.Name||!t.Channels||0===t.Channels.length)return ke("Animation",t);for(var i=[],n=0,r=t.Channels.length;n<r;n++){var a=e.setJSON(t.Channels[n]).readObject();i.push(a)}return Ne().all(i).then((function(e){return I.createAnimation(e,t.Name)}))},Ze.StandardVec3Channel=function(e,t,i){var n=e.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&3===n.KeyFrames.Key.length))return ke("StandardVec3Channel",n);var r=e.setJSON(n.KeyFrames.Time).readBufferArray(),a=e.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=e.setJSON(n.KeyFrames.Key[1]).readBufferArray(),s=e.setJSON(n.KeyFrames.Key[2]).readBufferArray();return Ne().all([r,a,o,s]).then((function(e){for(var r=e[0].getElements(),a=e[1].getElements(),o=e[2].getElements(),s=e[3].getElements(),l=r.length,u=new Float32Array(new ArrayBuffer(4*(l+1)*3),0,3*l),h=new Float32Array(new ArrayBuffer(4*(l+1)),0,l),c=0;c<l;c++){var A=3*c;h[c]=r[c],u[A++]=a[c],u[A++]=o[c],u[A]=s[c]}return i(u,h,n.TargetName,n.Name,t),t}))},Ze.StandardQuatChannel=function(e,t,i){var n=e.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&4===n.KeyFrames.Key.length))return ke("StandardQuatChannel",n);var r=e.setJSON(n.KeyFrames.Time).readBufferArray(),a=e.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=e.setJSON(n.KeyFrames.Key[1]).readBufferArray(),s=e.setJSON(n.KeyFrames.Key[2]).readBufferArray(),l=e.setJSON(n.KeyFrames.Key[3]).readBufferArray();return Ne().all([r,a,o,s,l]).then((function(e){for(var r=e[0].getElements(),a=e[1].getElements(),o=e[2].getElements(),s=e[3].getElements(),l=e[4].getElements(),u=r.length,h=new Float32Array(new ArrayBuffer(4*(u+1)*4),0,4*u),c=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),A=0;A<u;A++){var d=4*A;c[A]=r[A],h[d++]=a[A],h[d++]=o[A],h[d++]=s[A],h[d]=l[A]}return i(h,c,n.TargetName,n.Name,t),t}))},Ze.StandardFloatChannel=function(e,t,i){var n=e.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key))return ke("StandardFloatChannel",n);var r=e.setJSON(n.KeyFrames.Time).readBufferArray(),a=e.setJSON(n.KeyFrames.Key).readBufferArray();return Ne().all([r,a]).then((function(e){for(var r=e[0].getElements(),a=e[1].getElements(),o=r.length,s=new Float32Array(new ArrayBuffer(4*(o+1)),0,o),l=new Float32Array(new ArrayBuffer(4*(o+1)),0,o),u=0;u<o;u++)l[u]=r[u],s[u]=a[u];return i(s,l,n.TargetName,n.Name,t),t}))},Ze.Vec3LerpChannel=function(e,t){return Ze.StandardVec3Channel(e,t,S.createVec3Channel)},Ze.QuatLerpChannel=function(e,t){return Ze.StandardQuatChannel(e,t,S.createQuatChannel)},Ze.QuatSlerpChannel=function(e,t){return Ze.StandardQuatChannel(e,t,S.createQuatChannel)},Ze.FloatLerpChannel=function(e,t){return Ze.StandardFloatChannel(e,t,S.createFloatChannel)},Ze.FloatCubicBezierChannel=function(e,t){var i=e.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn))return ke("FloatCubicBezierChannel",i);var n,r=[],a=window.Object.keys(i.KeyFrames);for(n=0;n<a.length;n++)r.push(e.setJSON(i.KeyFrames[a[n]]).readBufferArray());return Ne().all(r).then((function(e){var r=e[0].getElements(),a=e[1].getElements(),o=e[2].getElements(),s=e[3].getElements(),l=s.length,u=new Float32Array(new ArrayBuffer(4*(l+1)*3),0,3*l),h=new Float32Array(new ArrayBuffer(4*(l+1)),0,l);for(n=0;n<l;n++){var c=3*n;h[n]=s[n],u[c++]=o[n],u[c++]=r[n],u[c]=a[n]}return S.createFloatCubicBezierChannel(u,h,i.TargetName,i.Name,t),t}))},Ze.Vec3CubicBezierChannel=function(e,t){var i=e.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn&&3===i.KeyFrames.Position.length&&3===i.KeyFrames.ControlPointIn.length&&3===i.KeyFrames.ControlPointOut.length))return ke("Vec3CubicBezierChannel",i);var n,r=[],a=window.Object.keys(i.KeyFrames);for(n=0;n<a.length;n++){var o=a[n],s=i.KeyFrames[o];"Time"!==o?(r.push(e.setJSON(s[0]).readBufferArray()),r.push(e.setJSON(s[1]).readBufferArray()),r.push(e.setJSON(s[2]).readBufferArray())):r.push(e.setJSON(s).readBufferArray())}return Ne().all(r).then((function(e){var r=e[0].getElements(),a=e[1].getElements(),o=e[2].getElements(),s=e[3].getElements(),l=e[4].getElements(),u=e[5].getElements(),h=e[6].getElements(),c=e[7].getElements(),A=e[8].getElements(),d=e[9].getElements(),g=d.length,f=new Float32Array(new ArrayBuffer(4*(g+1)*9),0,9*g),p=new Float32Array(new ArrayBuffer(4*(g+1)),0,g);for(n=0;n<g;n++){var m=9*n;p[n]=d[n],f[m++]=h[n],f[m++]=c[n],f[m++]=A[n],f[m++]=r[n],f[m++]=a[n],f[m++]=o[n],f[m++]=s[n],f[m++]=l[n],f[m]=u[n]}return S.createVec3CubicBezierChannel(f,p,i.TargetName,i.Name,t),t}))},Ze.BasicAnimationManager=function(e,t){var i=e.getJSON();if(!i.Animations)return ke("BasicAnimationManager",i);Oe.Object(e,t);for(var n=[],r=0,a=i.Animations.length;r<a;r++){var o=e.setJSON(i.Animations[r]).readObject();o.isRejected()?P.Z.warn("An Animation failed on the parsing!"):n.push(o)}return Ne().all(n).then((function(e){return t.init(e),t}))},Ze.UpdateMatrixTransform=function(e,t){var i=e.getJSON();if(!i.StackedTransforms)return ke("UpdateMatrixTransform",i);Oe.Object(e,t);var n,r,a=[];for(n=0,r=i.StackedTransforms.length;n<r;n++){var o=e.setJSON(i.StackedTransforms[n]).readObject();o.isRejected()?P.Z.warn("A stacked transforms failed on the parsing!"):a.push(o)}return Ne().all(a).then((function(e){var i=t.getStackedTransforms();for(n=0,r=e.length;n<r;n++)i.push(e[n]);return t.computeChannels(),t}))},Ze.StackedTranslate=function(e,t){var i=e.getJSON();return i.Name&&i.Translate?(Oe.Object(e,t),t.init(i.Translate),Ne().resolve(t)):ke("StackedTranslate",i)},Ze.StackedQuaternion=function(e,t){var i=e.getJSON();return i.Name&&i.Quaternion?(Oe.Object(e,t),t.init(i.Quaternion),Ne().resolve(t)):ke("StackedQuaternion",i)},Ze.StackedRotateAxis=function(e,t){var i=e.getJSON();return i.Axis&&void 0!==i.Angle?(Oe.Object(e,t),t.init(i.Axis,i.Angle),Ne().resolve(t)):ke("StackedRotateAxis",i)},Ze.StackedMatrix=function(e,t){var i=e.getJSON();return i.Name&&i.Matrix?(Oe.Object(e,t),t.init(i.Matrix),Ne().resolve(t)):ke("StackedMatrix",i)},Ze.StackedScale=function(e,t){var i=e.getJSON();return i.Name&&i.Scale?(Oe.Object(e,t),t.init(i.Scale),Ne().resolve(t)):ke("StackedScale",i)},Ze.Bone=function(e,t){var i=e.getJSON();if(!i.InvBindMatrixInSkeletonSpace)return ke("Bone",i);var n=Oe.MatrixTransform(e,t);if(t.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),i.BoundingBox){var r=t.getBoneBoundingBox();r.setMax(i.BoundingBox.max),r.setMin(i.BoundingBox.min)}return n},Ze.UpdateBone=Ze.UpdateMatrixTransform,Ze.UpdateSkeleton=function(e,t){return Oe.Object(e,t),Ne().resolve(t)},Ze.Skeleton=Oe.MatrixTransform,Ze.RigGeometry=function(e,t){var i=e.getJSON();if(!i.SourceGeometry)return ke("RigGeometry",i);i.BoneMap||P.Z.warn("No boneMap found in a RigGeometry !");var n=Oe.Geometry(e,t);t._boneNameID=i.BoneMap;var r,a=i.SourceGeometry["osg.Geometry"];return a?(e.setJSON(a),t.setSourceGeometry(new Le.Z),r=Oe.Geometry(e,t.getSourceGeometry())):(a=i.SourceGeometry["osgAnimation.MorphGeometry"])?(e.setJSON(a),t.setSourceGeometry(new X.Z),r=Ze.MorphGeometry(e,t.getSourceGeometry())):P.Z.warn("SourceGeometry type no recognized"),void 0===t._uniqueID&&(t._uniqueID=a.UniqueID),Ne().all([n,r]).then((function(){return t.mergeChildrenData(),t}))},Ze.MorphGeometry=function(e,t){var i=e.getJSON();if(!i.MorphTargets)return ke("MorphGeometry",i);var n=i.MorphTargets,r=[];r.push(Oe.Geometry(e,t));for(var a=0,o=n.length;a<o;a++)r.push(e.setJSON(n[a]).readObject());return Ne().all(r).then((function(e){for(var t=e[0],i=t.getMorphTargets(),n=1,r=e.length;n<r;n++)i.push(e[n]);return t.mergeChildrenVertexAttributeList(),t}))},Ze.UpdateMorph=function(e,t){var i=e.getJSON();if(!i.TargetMap)return ke("UpdateMorph",i);Oe.Object(e,t);for(var n=window.Object.keys(i.TargetMap),r=0,a=n.length;r<a;r++){var o=n[r];t.addTarget(i.TargetMap[o],parseInt(o,10))}return Ne().resolve(t)},Ze.StackedMatrixElement=Ze.StackedMatrix,Ze.StackedScaleElement=Ze.StackedScale;const Qe=Ze;var Ge=i("Uf0x"),He=i("/fpc"),ze=i("aS0i"),We=i("EZIT"),je=i("FCEq"),qe=i("zI6W"),Je=i("FJW6"),Ye=function(e){He.Z.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new ze.Z,this.addChild(this._matrixTransform),this._text="",void 0!==e&&(this._text=e),this._font="monospace",this._color=o.vh.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=Ye.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=o.R3.create(),this._layout=Ye.LEFT_TO_RIGHT,this._alignment=Ye.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new je.Z,this.drawText(),this._dirty=!1,this._previousModelView=o._E.create()};Ye.OBJECT_COORDS=0,Ye.SCREEN_COORDS=1,Ye.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,Ye.LEFT_TO_RIGHT="ltr",Ye.RIGHT_TO_LEFT="rtl",Ye.LEFT_TOP=0,Ye.LEFT_CENTER=1,Ye.LEFT_BOTTOM=2,Ye.CENTER_TOP=3,Ye.CENTER_CENTER=4,Ye.CENTER_BOTTOM=5,Ye.RIGHT_TOP=6,Ye.RIGHT_CENTER=7,Ye.RIGHT_BOTTOM=8,a.Z.createPrototypeNode(Ye,a.Z.objectInherit(He.Z.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var e=this._canvas.width/this._canvas.height,t=this._characterSize*e;this._geometry=We.Z.createTexturedQuadGeometry(-t/2,-this._characterSize/2,0,t,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,this._texture),i.setRenderingHint("TRANSPARENT_BIN"),i.setAttributeAndModes(new qe.Z(qe.Z.ONE,qe.Z.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(e){this._text=e,this._dirty=!0},getText:function(){return this._text},setFont:function(e){this._font=e,this._dirty=!0},setColor:function(e){this._color=e,this._fillStyle="rgba("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+","+e[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(e){this._characterSize=e,this._characterSizeMode!==Ye.OBJECT_COORDS&&(o._E.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===Ye.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(e){this._characterSizeMode=e,this._characterSizeMode!==Ye.OBJECT_COORDS?(o._E.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===Ye.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(o._E.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(e){this._fontSize=e,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(e){this._position=e,o._E.fromTranslation(this.getMatrix(),e)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(e){He.Z.prototype.setAutoRotateToScreen.call(this,e),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(e){this._layout="string"==typeof e?Ye[e]:e,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(e){this._alignment="string"==typeof e?Ye[e]:e,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(e){if(this._dirty&&(this.drawText(),this._dirty=!1),e.getVisitorType()===j.Z.CULL_VISITOR){var t=e.getViewport().width(),i=e.getViewport().height(),n=e.getCurrentProjectionMatrix(),r=e.getCurrentModelViewMatrix(),a=this._position,s=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(o._E.exactEquals(r,this._previousModelView)?t!==this._previousWidth||i!==this._previousHeight?s=!0:o._E.exactEquals(n,this._previousProjection)&&o.R3.exactEquals(a,this._previousPosition)||(s=!0):s=!0),this._firstTimeToInitEyePoint=!1,s){if(this._autoScaleToScreen){var l=e.getViewport(),u=this.computePixelSizeVector(l,n,r),h=o.vh.fromValues(this._position[0],this._position[1],this._position[2],1),c=o.vh.dot(h,u),A=1/(c=.48/c);if(this._autoScaleTransitionWidthRatio>0){var d,g,f;if(this._minimumScale>0){var p=this._minimumScale,m=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);f=p+(g=1-2*(d=1/(4*(m-p)))*m)*g/(4*d),A<-g/(2*d)?A=this._minimumScale:A<m&&(A=f+g*A+d*(A*A))}if(this._maximumScale<Number.MAX_VALUE){var _=this._maximumScale,v=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);f=_+(g=1-2*(d=1/(4*(v-_)))*v)*g/(4*d),A>-g/(2*d)?A=this._maximumScale:A>v&&(A=f+g*A+d*(A*A))}}this.setScale(A)}if(this._autoRotateToScreen){var C=o.gf.create(),b=e.getCurrentModelViewMatrix();o._E.getRotation(C,b),this.setRotation(o.gf.invert(C,C))}this._previousWidth=t,this._previousHeight=i,o.R3.copy(this._previousPosition,a),o._E.copy(this._previousProjection,n),o._E.copy(this._previousModelView,r)}}Je.Z.prototype.accept.call(this,e)},_setAlignmentValues:function(e){switch(e){case Ye.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case Ye.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case Ye.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case Ye.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case Ye.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case Ye.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case Ye.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case Ye.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case Ye.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(e){this._forcePowerOfTwo=e},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(e){var t=e;return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}}),"osgText","Text"),Ge.Z.registerApplyFunction(Ye.nodeTypeID,Ge.Z.getApplyFunction(He.Z.nodeTypeID));const Ke=Ye;var Xe={Text:function(e,t){var i=e.getJSON();if(!i.Text)return Ne().reject();var n=Oe.Node(e,t);if(t.setColor(i.Color),t.setText(i.Text),t.setAutoRotateToScreen(i.AutoRotateToScreen),t.setPosition(i.Position),t.setCharacterSize(i.CharacterSize),"VERTICAL"===i.Layout)return P.Z.error("Vertical Alignment not supported"),Ne().reject();var r=i.Alignment;return i.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===i.Alignment?r=Ke.LEFT_CENTER:"CENTER_BASE_LINE"===i.Alignment?r=Ke.CENTER_CENTER:"RIGHT_BASE_LINE"===i.Alignment?r=Ke.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===i.Alignment?r=Ke.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===i.Alignment?r=Ke.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===i.Alignment&&(r=Ke.RIGHT_BOTTOM)),t.setAlignment(r),t.setLayout(i.Layout),n}};const $e=Xe;var et=i("B2Ws"),tt=i("pSCg"),it=i("8bNm"),nt=i("kn/7"),rt={};rt.Input=we.Z,a.Z.objectMix(rt,Me.Z),rt.DatabasePager=Re.Z,rt.ObjectWrapper.serializers.osg=Oe,rt.ObjectWrapper.serializers.osgAnimation=Qe,rt.ObjectWrapper.serializers.osgText=$e,rt.Registry=et.Z,rt.fileHelper=tt.Z,rt.requestFile=it.Z,a.Z.objectMix(rt,nt.Z);const at=rt;var ot=i("8SXq"),st=i.n(ot),lt=i("EGrC"),ut=function(e){e&&(this._boundStrategy=e.boundStrategy,this.setInputManager(e.inputManager)),void 0===this._boundStrategy&&(this._boundStrategy=ut.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=o._E.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1,this._tmpSphere=new lt.Z};ut.prototype={setCamera:function(e){this._camera=e},getCamera:function(){return this._camera},setNode:function(e){this._node=e},setComputeBoundNodeMaskOverride:function(e){this._computeBoundNodeMaskOverride=e},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},setInputManager:function(e){this._inputManager=e},getInputManager:function(){return this._inputManager},getHomeBoundingSphere:function(e){var t=this._node;if(t){var n=void 0!==e?e:this._boundStrategy;if(n&ut.COMPUTE_HOME_USING_BBOX){var r;if(-1===this._computeBoundNodeMaskOverride)r=t.getBoundingBox();else{var a=new(0,i("10ce").Z);a.setNodeMaskOverride(this._computeBoundNodeMaskOverride),a.reset(),a.apply(t),r=a.getBoundingBox()}if(!r.valid())return t.getBoundingSphere();if(n&ut.COMPUTE_HOME_USING_SPHERE){var o=t.getBoundingSphere();if(o.valid()&&o.volume()<r.volume())return o}return this._tmpSphere.copyBoundingBox(r),this._tmpSphere}return t.getBoundingSphere()}},getHomeBound:function(e){return P.Z.warn("Please use getHomeBoundingSphere instead"),this.getHomeBoundingSphere(e)},getHomeDistance:function(e){var t=this._frustum,i=e.radius();if(this._camera&&o._E.getFrustum(t,this._camera.getProjectionMatrix())){var n=Math.abs(t.right-t.left)/t.zNear/2,r=Math.abs(t.top-t.bottom)/t.zNear/2;i/=Math.sin(Math.atan2(r<n?r:n,1))}else i*=1.5;return i},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},ut.COMPUTE_HOME_USING_SPHERE=1,ut.COMPUTE_HOME_USING_BBOX=2;const ht=ut;var ct=i("MbzV"),At=i("kjMK"),dt=i("klI+"),gt=i("XOVK"),ft=i("/Ud6"),pt=i("a3uD"),mt=function(){pt.Z.Intersection.call(this),this._intersectionPoints=[],this._distance=0,this._maxDistance=0,this._numIntersectionPoints=0},_t=function(){pt.Z.call(this),this._src=[],this._dest=[],this._maxNumIntersectionsPoints=6};a.Z.createPrototypeObject(_t,a.Z.objectInherit(pt.Z.prototype,{reset:function(){pt.Z.prototype.reset.call(this),this._src=[],this._dest=[]},enter:function(e){return!!this._intersector.getPolytope().containsBoundingBox(e)&&(this._intersector.getPolytope().pushCurrentMask(),!0)},leave:function(){this._intersector.getPolytope().popCurrentMask()},addIntersection:function(){this._src=a.Z.arrayUniq(this._src);for(var e=this._src,t=o.R3.create(),i=-Number.MAX_VALUE,n=this._intersector._iReferencePlane,r=0;r<e.length;++r){o.R3.add(t,t,e[r]);var s=gt.Z.distanceToPlane(n,e[r]);s>i&&(i=s)}o.R3.scale(t,t,1/e.length);var l=this.initIntersection(new mt);l._distance=gt.Z.distanceToPlane(n,t),l._maxDistance=i,o.R3.copy(l._localIntersectionPoint,t);var u=this._maxNumIntersectionsPoints;for(l._numIntersectionPoints=e.length<u?e.length:u,r=0;r<l._numIntersectionPoints;++r)l._intersectionPoints.push(o.R3.clone(this._src[r]))},contains:function(){var e=this._intersector.getPolytope(),t=e.getPlanes(),i=e.getCurrentMask();if(!i)return!0;for(var n=1,r=0;r<t.length;++r)if(i&0===n)n<<=1;else{this._dest=[];for(var a=t[r],s=this._src[0],l=gt.Z.distanceToPlane(a,s),u=1;u<this._src.length;++u){var h=this._src[u],c=gt.Z.distanceToPlane(a,h);if(l>=0&&this._dest.push(o.R3.clone(s)),l*c<0){var A=l/(l-c),d=o.R3.add(o.R3.create(),o.R3.scale(o.R3.create(),s,1-A),o.R3.scale(o.R3.create(),h,A));this._dest.push(d)}l=c,s=h}if(l>=0&&this._dest.push(o.R3.clone(s)),this._dest.length<=1)return!1;var g=this._src.slice();this._src=this._dest.slice(),this._dest=g}return!0},containsPoint:function(e){return!!this._intersector.getPolytope().containsVertex(e)&&(this._src=[],this._src[0]=e,!0)},containsLine:function(e,t){return this._src=[],this._src[0]=e,this._src[1]=t,this._src[2]=e,this.contains()},containsTriangle:function(e,t,i){return this._src=[],this._src[0]=e,this._src[1]=t,this._src[2]=i,this._src[3]=e,this.contains()},intersectPoint:function(e){this.containsPoint(e)&&this.addIntersection()},intersectLine:function(e,t){this.containsLine(e,t)&&this.addIntersection()},intersectTriangle:function(e,t,i){this.containsTriangle(e,t,i)&&this.addIntersection()}}),"osgUtil","PolytopeIntersectFunctor");const vt=_t;var Ct,bt=function(){ft.Z.call(this),this._index=0,this._polytope=new dt.Z,this._iPolytope=new dt.Z,this._referencePlane=o.vh.create(),this._iReferencePlane=o.vh.create()},St=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3];e[0]=i[0]*n+i[1]*r+i[2]*a+i[3]*o,e[1]=i[4]*n+i[5]*r+i[6]*a+i[7]*o,e[2]=i[8]*n+i[9]*r+i[10]*a+i[11]*o,e[3]=i[12]*n+i[13]*r+i[14]*a+i[15]*o};a.Z.createPrototypeObject(bt,a.Z.objectInherit(ft.Z.prototype,{setPolytope:function(e){this._polytope.setPlanes(e);for(var t=[],i=0;i<e.length;++i){var n=e[i];t[i]=o.vh.copy(this._iPolytope.getPlanes()[i]||gt.Z.create(),n)}this._iPolytope.setPlanes(t),o.vh.copy(this._referencePlane,e[e.length-1]),o.vh.copy(this._iReferencePlane,this._referencePlane)},getPolytope:function(){return this._iPolytope},setPolytopeFromWindowCoordinates:function(e,t,i,n){this.setPolytope([o.vh.fromValues(1,0,0,-e),o.vh.fromValues(-1,0,0,i),o.vh.fromValues(0,1,0,-t),o.vh.fromValues(0,-1,0,n),o.vh.fromValues(0,0,1,0)])},intersectBoundingBox:function(e){return this._iPolytope.containsBoundingBox(e)},intersectBoundingSphere:function(e){return this._iPolytope.containsBoundingSphere(e)},intersect:(Ct=new vt,function(e,t){Ct.setGeometry(t),Ct.setIntersectionVisitor(e),Ct.setIntersector(this);var i=t.getShape();i?i.intersect(Ct,i.getNodes()[0]):(t.computeTransformedVertices&&Ct.setVertices(t.computeTransformedVertices()),Ct.apply(t)),Ct.reset()}),setCurrentTransformation:function(e){for(var t=this._polytope.getPlanes(),i=this._iPolytope.getPlanes(),n=0,r=t.length;n<r;n++){var a=i[n]=i[n]||o.vh.create();St(a,t[n],e),o.vh.scale(a,a,1/o.R3.len(a))}St(this._iReferencePlane,this._referencePlane,e),o.vh.scale(this._iReferencePlane,this._iReferencePlane,1/o.R3.len(this._iReferencePlane))}}),"osgUtil","PolytopeIntersector");const Et=bt;var yt=i("z6Oe"),It=function(e){this._manipulator=e,this._enable=!0};It.prototype={isEnabled:function(){return this._enable},setEnable:function(e){this._enable=e}};const xt=It;var Tt=i("OEJe");const wt=0,Mt=1,Rt=2;var Bt=i("2oON"),Nt=function(e){xt.call(this,e),this._zoomFactor=1,this.init()};a.Z.createPrototypeObject(Nt,a.Z.objectInherit(xt.prototype,{init:function(){this._mode=void 0,this._inMotion=!1,this._initInputs(Bt.Z.ORBIT_MANIPULATOR_MOUSEKEYBOARD,Bt.Z.ORBIT_MANIPULATOR_RESETTOHOME)},_initInputs:function(e,t){var i=this._manipulator.getInputManager(),n=this.setMode.bind(this,wt,this._manipulator.getRotateInterpolator()),r=this.setMode.bind(this,Mt,this._manipulator.getPanInterpolator()),a=this.setMode.bind(this,Rt,this._manipulator.getZoomInterpolator());i.group(e).addMappings({move:"mousemove",startPan:["mousedown shift 0","mousedown 1","mousedown 2"],startZoom:["mousedown ctrl 0","mousedown ctrl 2"],startRotate:"mousedown 0 !shift !ctrl",stopMotion:["mouseup","mouseout","keyup a","keyup s","keyup d"],zoom:"wheel"},this),i.group(t).addMappings({reset:"keydown space"},this),i.group(e).addMappings({setRotationMode:"keydown a"},n),i.group(e).addMappings({setPanMode:"keydown d"},r),i.group(e).addMappings({setZoomMode:"keydown s"},a)},getMode:function(){return this._mode},setMode:function(e,t){this.getMode()!==e&&(this._mode=e,t.reset(),this._inMotion=!0)},setManipulator:function(e){this._manipulator=e},getZoomFactor:function(){return this._zoomFactor},setZoomFactor:function(e){this._zoomFactor=e},move:function(e){if(!1!==this._inMotion){var t=e.canvasX,i=-e.canvasY,n=this._manipulator;if(!1===Tt.Z.isNaN(t)&&!1===Tt.Z.isNaN(i)){var r=this.getMode();if(r===wt)n.getRotateInterpolator().setTarget(t,i);else if(r===Mt)n.getPanInterpolator().setTarget(t,i);else if(r===Rt){var a=n.getZoomInterpolator();a.isReset()&&(a.setStart(i),a.set(0));var o=i-a.getStart();a.setStart(i);var s=a.getTarget()[0];a.setTarget(s-o/20)}}}},startPan:function(e){var t=this._manipulator.getPanInterpolator();this.setMode(Mt,t),t.reset(),t.set(e.canvasX,-e.canvasY)},startRotate:function(e){var t=this._manipulator.getRotateInterpolator();this.setMode(wt,t),t.reset(),t.set(e.canvasX,-e.canvasY)},startZoom:function(e){var t=this._manipulator.getZoomInterpolator();this.setMode(Rt,t),t.setStart(-e.canvasY),t.set(0)},stopMotion:function(){this._inMotion=!1,this._mode=void 0},zoom:function(e){var t=e.deltaY/this._zoomFactor,i=this._manipulator,n=i.getZoomInterpolator().getTarget()[0]-t;i.getZoomInterpolator().setTarget(n)},reset:function(){this._manipulator.computeHomePosition()}}));const Dt=Nt;var Pt=function(e){Dt.call(this,e),this._timer=!1};a.Z.createPrototypeObject(Pt,a.Z.objectInherit(Dt.prototype,{_initInputs:function(){Dt.prototype._initInputs.call(this,Bt.Z.CAD_MANIPULATOR_MOUSEKEYBOARD,Bt.Z.CAD_MANIPULATOR_RESETTOHOME),this._manipulator.getInputManager().group(Bt.Z.CAD_MANIPULATOR_MOUSEKEYBOARD).addMappings({savePosition:"mousemove"},this)},zoom:function(e){var t=-e.deltaY/this._zoomFactor,i=this._manipulator,n=i.getZoomInterpolator().getTarget()[0]-t;if(i.getZoomInterpolator().setTarget(n),!1===this._timer){this._timer=!0;var r=this;this._timerRef&&clearTimeout(this._timerRef),this._timerRef=setTimeout((function(){r._timer=!1}),200),i.computeIntersections(e.glX,e.glY)}},savePosition:function(e){this._lastX=e.glX,this._lastY=e.glY},setMode:function(e,t,i){this._inMotion||this._manipulator.computeIntersections(this._lastX,this._lastY),Dt.prototype.setMode.call(this,e,t,i)},center:function(e){var t=this._manipulator;t.getZoomInterpolator().set(0);var i=t.getZoomInterpolator().getTarget()[0]-10;t.getZoomInterpolator().setTarget(i),t.computeIntersections(e.glX,e.glY)}}));const Ft=Pt;var Ot=function(e){xt.call(this,e),this.init()};a.Z.createPrototypeObject(Ot,a.Z.objectInherit(xt.prototype,{init:function(){this._panFactor=[],this._panFactor[0]=1,this._panFactor[1]=-this._panFactor[0],this._rotateFactor=[],this._rotateFactor[0]=.6,this._rotateFactor[1]=-this._rotateFactor[0],this._zoomFactor=5,this._lastScale=0,this._zooming=!1,this._dragStarted=!1,this._initInputs(Bt.Z.ORBIT_MANIPULATOR_TOUCH)},_initInputs:function(e){this._manipulator.getInputManager().group(e).addMappings({pinchEnd:"pinchend",pinchStart:"pinchstart",pinchInOut:["pinchin","pinchout"],startPan:["panstart 2"],startRotate:["panstart 1"],pan:["panmove 2"],rotate:["panmove 1"],endMotion:["touchend 2","touchcancel 2","touchend 1","touchcancel 1"]},this)},startPan:function(e){this._panning=!0,this.startMotion(this._manipulator.getPanInterpolator(),this._panFactor,e)},startRotate:function(e){this._rotating=!0,this.startMotion(this._manipulator.getRotateInterpolator(),this._rotateFactor,e)},pan:function(e){this._panning||(this.endMotion(),this.startPan(e)),this.move(this._manipulator.getPanInterpolator(),this._panFactor,e)},rotate:function(e){this._rotating||(this.endMotion(),this.startPan(e)),this.move(this._manipulator.getRotateInterpolator(),this._rotateFactor,e)},startMotion:function(e,t,i){if(!this._zooming){e.reset();var n=i.canvasX*t[0],r=i.canvasY*t[1];e.set(n,r)}},move:function(e,t,i){var n=i.canvasX*t[0],r=i.canvasY*t[1];e.setTarget(n,r)},endMotion:function(){(this._panning||this._rotating)&&(this._panning=!1,this._rotating=!1)},pinchStart:function(e){this._zooming=!0,this._lastScale=e.scale;var t=this._manipulator.getZoomInterpolator();t.reset(),t.set(this._lastScale)},pinchEnd:function(){this._zooming=!1},pinchInOut:function(e){if(this._zooming){var t=e.scale>this._lastScale?this._zoomFactor:3*this._zoomFactor,i=.5-Math.abs(e.velocity);t*=Tt.Z.smoothStep(0,.5,i);var n=(e.scale-this._lastScale)*t;this._lastScale=e.scale;var r=this._manipulator.getZoomInterpolator();r.setTarget(r.getTarget()[0]-n)}},setManipulator:function(e){this._manipulator=e}}));const Lt=Ot;var kt=function(e){Lt.call(this,e),this._timer=!1};a.Z.createPrototypeObject(kt,a.Z.objectInherit(Lt.prototype,{_initInputs:function(){Lt.prototype._initInputs.call(this,Bt.Z.CAD_MANIPULATOR_TOUCH)},startMotion:function(e,t,i){Lt.prototype.startMotion.call(this,e,t,i),this._manipulator.computeIntersections(i.glX,i.glY)}}));const Zt=kt;var Ut=function(e,t){this._current=new Float32Array(e),this._target=new Float32Array(e),this._delta=new Float32Array(e),this._delay=void 0!==t?t:.15,this._reset=!1,this._start=0,this.reset()};Ut.prototype={setDelay:function(e){this._delay=e},reset:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=0;this._reset=!0},update:function(e){for(var t=Math.min(1,this._delay*e*60),i=0,n=this._current.length;i<n;i++){var r=(this._target[i]-this._current[i])*t;this._delta[i]=r,this._current[i]+=r}return this._delta},set:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=arguments[e];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var e=0,t=this._target.length;e<t;e++)this._reset?this._target[e]=this._current[e]=arguments[e]:this._target[e]=arguments[e];this._reset=!1},addTarget:function(){for(var e=0;e<arguments.length;e++)this._target[e]+=arguments[e]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(e){this._start=e}};const Vt=Ut;var Qt,Gt,Ht,zt,Wt,jt,qt,Jt,Yt,Kt,Xt,$t,ei,ti,ii,ni,ri,ai,oi,si,li,ui,hi,ci,Ai,di=i("2gPm"),gi=function(e){ht.call(this,e),this._tmpHomePosition=o.R3.create(),this._intersectionVisitor=new ct.Z,this._lineSegmentIntersector=new At.Z,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._primitiveMask=di.Z.ALL_PRIMITIVES,this.init()};(gi.Interpolator=function(){this._current=o.K4.create(),this._target=o.K4.create(),this._delta=o.K4.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0}).prototype={setWidth:function(e){this._width=e},setHeight:function(e){this._height=e},reset:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=0;this._reset=!0},update:function(){var e,t;return e=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=e,this._current[0]=this._target[0],t=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=t,this._current[1]=this._target[1],this._delta},set:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=arguments[e];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var e=0,t=this._target.length;e<t;e++)this._reset?this._target[e]=this._current[e]=arguments[e]:this._target[e]=arguments[e];this._reset=!1},addTarget:function(){for(var e=0;e<arguments.length;e++)this._target[e]+=arguments[e]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},gi.AvailableControllerList=["StandardMouseKeyboard","Hammer"],gi.ControllerList=["StandardMouseKeyboard","Hammer"],a.Z.createPrototypeObject(gi,a.Z.objectInherit(ht.prototype,{init:function(){this._distance=25,this._target=o.R3.create(),this._upz=o.R3.fromValues(0,0,1),this._right=o.R3.fromValues(1,0,0),o.R3.init(this._target);var e=o._E.fromRotation(o._E.create(),-Math.PI,this._upz),t=o._E.fromRotation(o._E.create(),Math.PI/10,this._right);this._rotation=o._E.create(),o._E.mul(this._rotation,e,t),this._time=0,this._rotate=new gi.Interpolator,this._pan=new gi.Interpolator,this._zoom=new Vt(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=o._E.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=o.R3.fromValues(0,0,1),this._orientation=o.gf.create(),this._pivotPoint=o.R3.create(),this._eye=void 0,this._zoomDir=o.R3.create();var i=this;gi.ControllerList.forEach((function(e){void 0!==gi[e]&&(i._controllerList[e]?i._controllerList[e].init():i._controllerList[e]=new gi[e](i))}))},setViewer:function(e){this._viewer=e},reset:function(){this.init()},setEnable:function(e){this.getInputManager().setEnable(Bt.Z.CAD_MANIPULATOR,e)},setNode:function(e){this._node=e},setPivotPoint:function(e){o.R3.copy(this._pivotPoint,e)},setTarget:(Ai=o.R3.create(),function(e){o.R3.copy(this._target,e),this.getEyePosition(Ai),this._distance=o.R3.distance(e,Ai)}),setEyePosition:function(e){o.R3.copy(this._eye,e),this._distance=o.R3.distance(this._target,e)},setHomePosition:function(e,t,i){this._homeEye=e,this._homeCenter=t,this._homeUp=i},computeHomePosition:(li=o.R3.create(),ui=o.R3.create(),hi=o.R3.create(),ci=o._E.create(),function(e){var t=this.getHomeBoundingSphere(e);if(t){this.setDistance(this.getHomeDistance(t)),this.setTarget(t.center()),this.setPivotPoint(t.center()),void 0===this._homeEye&&(this._homeEye=o.R3.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=o.R3.create(),o.R3.copy(this._homeCenter,t.center())),void 0===this._eye&&(this._eye=o.R3.create()),o.R3.copy(this._eye,this._homeEye),o.R3.copy(this._target,this._homeCenter),o.R3.copy(this._upz,this._homeUp),o._E.copy(ci,this._rotation);var i=this._target,n=this._eye;o.R3.sub(li,i,n),o.R3.normalize(li,li),o.R3.cross(ui,li,this._upz),o.R3.normalize(ui,ui),o.R3.cross(hi,ui,li),o.R3.normalize(hi,hi),ci[0]=ui[0],ci[1]=hi[0],ci[2]=-li[0],ci[3]=0,ci[4]=ui[1],ci[5]=hi[1],ci[6]=-li[1],ci[7]=0,ci[8]=ui[2],ci[9]=hi[2],ci[10]=-li[2],ci[11]=0,ci[12]=0,ci[13]=0,ci[14]=0,ci[15]=1,o._E.getRotation(this._orientation,ci),o.gf.invert(this._orientation,this._orientation)}}),setZoomFactor:function(e){this._zoomFactor=e},setRotateFactor:function(e){this._rotateFactor=e},setPanFactor:function(e){this._panFactor=e},setDistance:function(e){this._distance=e},setUsePolytopeIntersector:function(e){this._usePolytopeIntersector=e},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(e){this._distance=e},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new Et,this._polytopeIntersector.setIntersectionLimit(di.Z.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setPrimitiveMask(di.Z.POINT_PRIMITIVES|di.Z.LINE_PRIMITIVES)),this._polytopeIntersector},getTarget:function(e){return o.R3.copy(e,this._target),e},getEyePosition:function(e){void 0===this._eye?this.computeEyePosition(this._target,this._distance,e):o.R3.copy(e,this._eye)},computeEyePosition:(oi=o.R3.create(),si=o._E.create(),function(e,t,i){o._E.invert(si,this._rotation),oi[1]=t,o.R3.transformMat4(i,oi,si),o.R3.add(i,e,i)}),computePan:(ni=o.R3.create(),ri=o.R3.create(),ai=o.R3.create(),function(e,t,i){var n=o.R3.length(o.R3.sub(ai,this._eye,this._pivotPoint))/this._panFactor;n<10&&(n=10),ni[0]=e*n/2,ni[1]=t*n/2,ni[2]=0,o.R3.transformMat4(ri,ni,i),o.R3.add(this._eye,this._eye,ri)}),computeZoom:(ti=o.R3.create(),ii=o.R3.create(),function(e){var t=e*this._zoomFactor;o.R3.sub(ti,this._pivotPoint,this._eye),o.R3.add(this._eye,this._eye,o.R3.scale(ii,ti,t))}),computeRotation:(Wt=o.R3.create(),jt=o.R3.create(),qt=o.R3.create(),Jt=o.R3.create(),Yt=o.gf.create(),Kt=o.gf.create(),Xt=o.gf.create(),$t=o.R3.create(),ei=o.R3.create(),function(e,t){o.R3.transformQuat(jt,this._right,this._orientation),o.R3.normalize(Wt,jt),o.R3.sub(qt,this._eye,this._pivotPoint);var i=o.R3.dot(Wt,qt);o.R3.sub(Jt,qt,o.R3.scale(ei,Wt,i));var n=o.R3.fromValues(-Jt[0],-Jt[1],0),r=Math.atan2(-Jt[2],o.R3.length(n));t=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,r+t))-r,o.gf.setAxisAngle(Yt,jt,t*this._rotateFactor),o.gf.setAxisAngle(Kt,this._upz,e*this._rotateFactor),o.gf.mul(Xt,Kt,Yt),o.R3.transformQuat($t,qt,Xt),o.R3.add(this._eye,$t,this._pivotPoint),o.gf.mul(this._orientation,Kt,this._orientation),o.R3.transformQuat(jt,this._right,this._orientation),o.gf.setAxisAngle(Yt,jt,t*this._rotateFactor),o.gf.mul(this._orientation,Yt,this._orientation)}),update:(Ht=o._E.create(),zt=o._E.create(),function(e){var t=e.getFrameStamp().getDeltaTime(),i=this._rotate.update();this.computeRotation(10*-i[0],10*i[1]),o._E.fromQuat(Ht,this._orientation);var n=this._pan.update();this.computePan(10*-n[0],10*-n[1],Ht),i=this._zoom.update(t),this.computeZoom(-i[0]/10),o._E.fromTranslation(zt,this._eye),o._E.mul(this._inverseMatrix,zt,Ht),o._E.invert(this._inverseMatrix,this._inverseMatrix)}),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:(Qt=[],Gt=o.R3.create(),function(e,t){var i,n,r=this._camera.getView(),a=this._camera,s=a.getViewport().width(),l=a.getViewport().height();if(this._rotate.setWidth(s),this._rotate.setHeight(l),this._pan.setWidth(s),this._pan.setHeight(l),0!=(this._primitiveMask&di.Z.TRIANGLE_PRIMITIVES)&&(Qt=r.computeIntersections(e,t)).length>0&&(i=Qt[0]._localIntersectionPoint,Qt[0]._nodePath.shift(),n=yt.Z.computeLocalToWorld(Qt[0]._nodePath),o.R3.transformMat4(Gt,i,n),this.setPivotPoint(Gt)),0===Qt.length&&this._usePolytopeIntersector){var u=this.getOrCreatePolytopeIntersector();u.reset(),u.setPolytopeFromWindowCoordinates(e-5,t-5,e+5,t+5);var h=this._intersectionVisitor;h.setIntersector(u),r.getCamera().accept(h),(Qt=u.getIntersections()).sort((function(e,t){return e._distance-t._distance})),Qt.length>0&&(i=Qt[0]._localIntersectionPoint,Qt[0]._nodePath.shift(),n=yt.Z.computeLocalToWorld(Qt[0]._nodePath),o.R3.transformMat4(Gt,i,n),this.setPivotPoint(Gt))}}),getPositionRelativeToCanvas:function(){var e=o.K4.create(),t=o.K4.create();return function(i,n){var r=this._camera._graphicContext.canvas;this.getOffsetRect(r,e);var a=r.width/r.clientWidth,o=r.height/r.clientHeight;return t[0]=(i-e[1])*a,t[1]=(r.clientHeight-(n-e[0]))*o,t}}(),getCanvasCenter:function(){var e=o.K4.create(),t=o.K4.create();return function(){var i=this._camera.getGraphicContext().canvas;this.getOffsetRect(i,e);var n=i.width/i.clientWidth,r=i.height/i.clientHeight;return t[0]=i.clientWidth/2*n,t[1]=i.clientHeight/2*r,t}}(),getOffsetRect:function(e,t){var i=e.getBoundingClientRect(),n=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||n.scrollTop,o=window.pageXOffset||r.scrollLeft||n.scrollLeft,s=r.clientTop||n.clientTop||0,l=r.clientLeft||n.clientLeft||0,u=i.top+a-s,h=i.left+o-l;return t[0]=Math.round(u),t[1]=Math.round(h),t}}),"osgGA","CADManipulator"),gi.StandardMouseKeyboard=Ft,gi.Hammer=Zt;const fi=gi;var pi,mi,_i=Math.PI/180,vi=function(e){xt.call(this,e),this.init()};vi.computeQuaternion=(pi=o.gf.create(),mi=o.gf.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,i){var n=t.alpha*_i,r=t.beta*_i,a=t.gamma*_i,s=i*_i;!function(e,t,i,n,r){var a=Math.cos(t/2),o=Math.cos(i/2),s=Math.cos(n/2),l=Math.sin(t/2),u=Math.sin(i/2),h=Math.sin(n/2);"XYZ"===r?(e[0]=l*o*s+a*u*h,e[1]=a*u*s-l*o*h,e[2]=a*o*h+l*u*s,e[3]=a*o*s-l*u*h):"YXZ"===r?(e[0]=l*o*s+a*u*h,e[1]=a*u*s-l*o*h,e[2]=a*o*h-l*u*s,e[3]=a*o*s+l*u*h):"ZXY"===r?(e[0]=l*o*s-a*u*h,e[1]=a*u*s+l*o*h,e[2]=a*o*h+l*u*s,e[3]=a*o*s-l*u*h):"ZYX"===r?(e[0]=l*o*s-a*u*h,e[1]=a*u*s+l*o*h,e[2]=a*o*h-l*u*s,e[3]=a*o*s+l*u*h):"YZX"===r?(e[0]=l*o*s+a*u*h,e[1]=a*u*s+l*o*h,e[2]=a*o*h-l*u*s,e[3]=a*o*s-l*u*h):"XZY"===r&&(e[0]=l*o*s-a*u*h,e[1]=a*u*s-l*o*h,e[2]=a*o*h+l*u*s,e[3]=a*o*s+l*u*h)}(e,r,n,-a,"YXZ");var l=-s/2;pi[1]=Math.sin(l),pi[3]=Math.cos(l),o.gf.mul(e,e,pi),o.gf.mul(e,e,mi);var u=e[1];return e[1]=-e[2],e[2]=u,e}),a.Z.createPrototypeObject(vi,a.Z.objectInherit(xt.prototype,{init:function(){this._quat=o.gf.create(),this._pos=o.R3.create(),this._deviceOrientation=void 0,this._screenOrientation=void 0;var e=this._manipulator.getInputManager();e.group(Bt.Z.FPS_MANIPULATOR_DEVICEORIENTATION).addMappings({setDeviceOrientation:"deviceorientation",setScreenOrientation:"orientationchange"},this),e.setEnable(Bt.Z.FPS_MANIPULATOR_DEVICEORIENTATION,!1)},setDeviceOrientation:function(e){this._deviceOrientation||(this._deviceOrientation={}),this._deviceOrientation.alpha=e.alpha,this._deviceOrientation.beta=e.beta,this._deviceOrientation.gamma=e.gamma,e.screenOrientation?this.setScreenOrientation(e):this._update()},setScreenOrientation:function(e){this._screenOrientation=e.screenOrientation,this._update()},_update:function(){this._deviceOrientation&&this._screenOrientation&&(vi.computeQuaternion(this._quat,this._deviceOrientation,this._screenOrientation),this._manipulator.setPoseVR(this._quat,this._pos))}}));const Ci=vi;var bi=function(e){Lt.call(this,e),this._timer=!1};a.Z.createPrototypeObject(bi,a.Z.objectInherit(Lt.prototype,{_initInputs:function(){Lt.prototype._initInputs.call(this,Bt.Z.FPS_MANIPULATOR_TOUCH)}}));const Si=bi;o.gf.create(),o.R3.create();var Ei=function(e){xt.call(this,e),this.init()};a.Z.createPrototypeObject(Ei,a.Z.objectInherit(xt.prototype,{init:function(){this._pos=o.R3.create(),this._quat=o.gf.create();var e=this._manipulator.getInputManager();e.group(Bt.Z.FPS_MANIPULATOR_WEBVR).addMappings({update:"vrdisplayposechanged"},this),e.setEnable(Bt.Z.FPS_MANIPULATOR_WEBVR,!1)},update:function(e){var t=e.pose.transform.orientation;t&&(this._quat[0]=t.x,this._quat[1]=-t.z,this._quat[2]=t.y,this._quat[3]=t.w);var i=e.pose.transform.position;i&&(this._pos[0]=i.x*e.worldFactor,this._pos[1]=-i.z*e.worldFactor,this._pos[2]=i.y*e.worldFactor),this._manipulator.setPoseVR(this._quat,this._pos)}}));const yi=Ei;var Ii=function(e){xt.call(this,e),this.init()};a.Z.createPrototypeObject(Ii,a.Z.objectInherit(xt.prototype,{init:function(){this._delay=.15,this._stepFactor=1,this._looking=!1;var e=this._manipulator.getInputManager();e.group(Bt.Z.FPS_MANIPULATOR_MOUSEKEYBOARD).addMappings({startLookAt:"mousedown",lookAt:"mousemove",stopLookAt:["mouseup","mouseout"],goForward:["keydown w","keydown z","keydown ArrowUp"],goBackward:["keydown s","keydown ArrowDown"],goLeft:["keydown a","keydown q","keydown ArrowLeft"],goRight:["keydown d","keydown ArrowRight"],stopMoving:["keyup w","keyup z","keyup ArrowUp","keyup s","keyup ArrowDown"],stopStrafing:["keyup a","keyup q","keyup ArrowLeft","keyup d","keyup ArrowRight"],changeStepFactor:"wheel"},this),e.group(Bt.Z.FPS_MANIPULATOR_RESETTOHOME).addMappings({reset:"keydown space"},this)},setEnable:function(e){e||(this._buttonup=!0),xt.prototype.setEnable.call(this,e)},setManipulator:function(e){this._manipulator=e,this._manipulator.setStepFactor(this._stepFactor)},stopLookAt:function(){this._looking=!1},startLookAt:function(e){this._manipulator.getLookPositionInterpolator().set(e.canvasX,-e.canvasY),this._looking=!0},lookAt:function(e){this._looking&&(this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(e.canvasX,-e.canvasY))},changeStepFactor:function(e){this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*e.deltaY),4),this._manipulator.setStepFactor(this._stepFactor)},reset:function(){this._manipulator.computeHomePosition()},goForward:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(1)},goBackward:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(-1)},goLeft:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(-1)},goRight:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(1)},stopMoving:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(0)},stopStrafing:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(0)}}));const xi=Ii;var Ti,wi,Mi=function(e){ht.call(this,e),this.init()};Mi.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],Mi.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],a.Z.createPrototypeObject(Mi,a.Z.objectInherit(ht.prototype,{computeHomePosition:function(e){var t=this.getHomeBoundingSphere(e);if(t&&t.valid()){this._distance=this.getHomeDistance(t);var i=t.center();o.R3.scale(this._eye,this._direction,-this._distance),o.R3.add(this._eye,i,this._eye),this.setTarget(i)}},init:function(){this._direction=o.R3.fromValues(0,1,0),this._eye=o.R3.fromValues(0,25,10),this._up=o.R3.fromValues(0,0,1),this._distance=1,this._forward=new Vt(1),this._side=new Vt(1),this._lookPosition=new Vt(2),this._pan=new Vt(2),this._zoom=new Vt(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=o.R3.create(),this._vrEnable=!1,this._vrRot=o.gf.create(),this._vrPos=o.R3.create(),this._vrTrans=o.R3.create();var e=this;this._controllerList={},Mi.ControllerList.forEach((function(t){void 0!==Mi[t]&&(e._controllerList[t]?e._controllerList[t].init():e._controllerList[t]=new Mi[t](e))}))},setDelay:function(e){this._forward.setDelay(e),this._side.setDelay(e),this._lookPosition.setDelay(e),this._pan.setDelay(e),this._zoom.setDelay(e)},getEyePosition:function(e){return e[0]=this._eye[0],e[1]=this._eye[1],e[2]=this._eye[2],e},setEyePosition:function(e){return this._eye[0]=e[0],this._eye[1]=e[1],this._eye[2]=e[2],this},getTarget:function(e){var t=o.R3.scale(this._tmpGetTargetDir,this._direction,this._distance);return o.R3.add(e,this._eye,t),e},setEnable:function(e){this.getInputManager().setEnable(Bt.Z.FPS_MANIPULATOR,e)},setTarget:function(e){var t=this._tmpGetTargetDir;o.R3.sub(t,e,this._eye),t[2]=0,o.R3.normalize(t,t),this._angleHorizontal=Math.acos(t[1]),t[0]<0&&(this._angleHorizontal=-this._angleHorizontal),o.R3.sub(t,e,this._eye),o.R3.normalize(t,t),this._angleVertical=-Math.asin(t[2]),o.R3.copy(this._direction,t)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var e=o._E.create(),t=o._E.create(),i=o.R3.fromValues(1,0,0),n=o.R3.fromValues(0,1,0),r=o.R3.fromValues(0,0,1),a=.5*Math.PI;return function(s,l){this._angleVertical+=.01*l,this._angleHorizontal-=.01*s,this._angleVertical>a?this._angleVertical=a:this._angleVertical<-a&&(this._angleVertical=-a),this._vrEnable?(o.R3.transformQuat(this._direction,n,this._vrRot),o.R3.normalize(this._direction,this._direction),o.R3.transformQuat(this._up,r,this._vrRot)):(o._E.fromRotation(e,-this._angleVertical,i),o._E.fromRotation(t,-this._angleHorizontal,r),o._E.mul(t,t,e),o.R3.transformMat4(this._direction,n,t),o.R3.normalize(this._direction,this._direction),o.R3.transformMat4(this._up,r,t))}}(),reset:function(){this.init()},setDistance:function(e){this._distance=e},getDistance:function(){return this._distance},setStepFactor:function(e){this._stepFactor=e},computePosition:(wi=o.K4.create(),function(e){this._forward.update(e),this._side.update(e);var t=this._distance<.001?.001:this._distance,i=this._camera.getProjectionMatrix(),n=1===i[15]?1:2/i[5];wi[0]=this._forward.getCurrent()[0],wi[1]=this._side.getCurrent()[0];var r=o.K4.sqrLen(wi);r>1&&o.K4.scale(wi,wi,1/Math.sqrt(r));var a=this._pan.update(e),s=this._zoom.update(e),l=this._stepFactor*t*n*e,u=this._stepFactor*t*n*.005;this.moveForward(wi[0]*l-s[0]*u*20),this.strafe(wi[1]*l-a[0]*u),this.strafeVertical(-a[1]*u),this._vrEnable&&(o.R3.add(this._eye,this._eye,this._vrTrans),o.R3.init(this._vrTrans))}),update:(Ti=o.R3.create(),function(e){var t=e.getFrameStamp().getDeltaTime(),i=this._lookPosition.update(t);this.computeRotation(.5*-i[0],.5*-i[1]),this.computePosition(t),o.R3.add(Ti,this._eye,this._direction),o._E.lookAt(this._inverseMatrix,this._eye,Ti,this._up),this._vrEnable=!1}),setPoseVR:function(e,t){this._vrEnable=!0,o.gf.copy(this._vrRot,e),o.R3.sub(this._vrTrans,t,this._vrPos),o.R3.copy(this._vrPos,t)},moveForward:function(){var e=o.R3.create();return function(t){o.R3.normalize(e,this._direction),o.R3.scale(e,e,t),o.R3.add(this._eye,this._eye,e)}}(),strafe:function(){var e=o.R3.create();return function(t){o.R3.cross(e,this._direction,this._up),o.R3.normalize(e,e),o.R3.scale(e,e,t),o.R3.add(this._eye,this._eye,e)}}(),strafeVertical:function(){var e=o.R3.create();return function(t){o.R3.normalize(e,this._up),o.R3.scale(e,e,t),o.R3.add(this._eye,this._eye,e)}}()}),"osgGA","FirstPersonManipulator"),Mi.DeviceOrientation=Ci,Mi.Hammer=Si,Mi.WebVR=yi,Mi.StandardMouseKeyboard=xi;const Ri=Mi;var Bi=function(e){xt.call(this,e),this.init()};a.Z.createPrototypeObject(Bi,a.Z.objectInherit(xt.prototype,{init:function(){this._quat=o.gf.create(),this._pos=o.R3.create(),this._deviceOrientation=void 0,this._screenOrientation=void 0;var e=this._manipulator.getInputManager();e.group(Bt.Z.ORBIT_MANIPULATOR_DEVICEORIENTATION).addMappings({setDeviceOrientation:"deviceorientation",setScreenOrientation:"orientationchange"},this),e.setEnable(Bt.Z.ORBIT_MANIPULATOR_DEVICEORIENTATION,!1)},setDeviceOrientation:function(e){this._deviceOrientation||(this._deviceOrientation={}),this._deviceOrientation.alpha=e.alpha,this._deviceOrientation.beta=e.beta,this._deviceOrientation.gamma=e.gamma,e.screenOrientation?this.setScreenOrientation(e):this._update()},setScreenOrientation:function(e){this._screenOrientation=e.screenOrientation,this._update()},_update:function(){this._deviceOrientation&&this._screenOrientation&&(Ci.computeQuaternion(this._quat,this._deviceOrientation,this._screenOrientation),this._manipulator.setPoseVR(this._quat,this._pos))}}));const Ni=Bi;var Di=function(e){xt.call(this,e),this.init()};a.Z.createPrototypeObject(Di,a.Z.objectInherit(xt.prototype,{init:function(){this._delay=.15,this._zoomFactor=.5,this._rotateFactor=5,this._panFactor=10,this._rotate=this._manipulator.getRotateInterpolator(),this._zoom=this._manipulator.getZoomInterpolator(),this._pan=this._manipulator.getPanInterpolator(),this._rotate.setDelay(this._delay),this._zoom.setDelay(this._delay),this._pan.setDelay(this._delay);var e=this._manipulator.getInputManager();e.group(Bt.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({addZoom:"axis 3",addRotateX:"axis 0",addRotateY:"axis 1"},this),e.group(Bt.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panUp:"buttonvalue 12"},this.pan.bind(this,o.K4.fromValues(0,1))),e.group(Bt.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panDown:"buttonvalue 13"},this.pan.bind(this,o.K4.fromValues(0,-1))),e.group(Bt.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panLeft:"buttonvalue 14"},this.pan.bind(this,o.K4.fromValues(1,0))),e.group(Bt.Z.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panRight:"buttonvalue 15"},this.pan.bind(this,o.K4.fromValues(-1,0)))},pan:function(e){var t=this._pan.getTarget();this._pan.setTarget(t[0]-e[0]*this._panFactor,t[1]+e[1]*this._panFactor)},addZoom:function(e){this._zoom.addTarget(-e.value*this._zoomFactor)},addRotateX:function(e){this._rotate.addTarget(-e.value*this._rotateFactor)},addRotateY:function(e){this._rotate.addTarget(0,e.value*this._rotateFactor)}}));const Pi=Di;var Fi=o.gf.create(),Oi=o.R3.create(),Li=function(e){xt.call(this,e),this.init()};a.Z.createPrototypeObject(Li,a.Z.objectInherit(xt.prototype,{init:function(){this._pos=o.R3.create(),this._quat=o.gf.create();var e=this._manipulator.getInputManager();e.group(Bt.Z.ORBIT_MANIPULATOR_WEBVR).addMappings({update:"vrdisplayposechanged"},this),e.setEnable(Bt.Z.ORBIT_MANIPULATOR_WEBVR,!1)},update:function(e){var t=e.pose.orientation;t&&(e.sitToStandMatrix&&(t=o._E.getRotation(Fi,e.sitToStandMatrix),o.gf.mul(t,t,e.pose.orientation)),this._quat[0]=t[0],this._quat[1]=-t[2],this._quat[2]=t[1],this._quat[3]=t[3]);var i=e.pose.position;i&&(e.sitToStandMatrix&&(i=o.R3.transformMat4(Oi,i,e.sitToStandMatrix)),this._pos[0]=i[0]*e.worldFactor,this._pos[1]=-i[2]*e.worldFactor,this._pos[2]=i[1]*e.worldFactor),this._manipulator.setPoseVR(this._quat,this._pos)}}));const ki=Li;var Zi=function(e){ht.call(this,e),this._homePosition=o.R3.create(),this._frustum={},this.init()};Zi.AvailableControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],Zi.ControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"];var Ui,Vi,Qi,Gi,Hi,zi=2*Math.PI,Wi=function(e,t){return e<t+1e-5},ji=1e-4,qi=1/0;a.Z.createPrototypeObject(Zi,a.Z.objectInherit(ht.prototype,{init:function(){this._distance=25,this._target=o.R3.create(),this._upz=o.R3.fromValues(0,0,1),o.R3.init(this._target);var e=o._E.fromRotation(o._E.create(),-Math.PI,this._upz),t=o._E.fromRotation(o._E.create(),Math.PI/10,o.R3.fromValues(1,0,0));this._rotation=o._E.create(),o._E.mul(this._rotation,e,t),this._time=0,this._vrMatrix=o._E.create(),this._rotate=new Vt(2),this._pan=new Vt(2),this._zoom=new Vt(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=o._E.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=ji,this._limitZoomOut=qi,this._constrainYaw=!1,this._constrainPitch=!1,this._constrainYaw=!1,this._constrainZoom=!1,this._panFactor=.002,this._rotationFactor=.1,this._zoomFactor=.1;var i=this;Zi.ControllerList.forEach((function(e){void 0!==Zi[e]&&(i._controllerList[e]?i._controllerList[e].init():i._controllerList[e]=new Zi[e](i))}))},setZoomFactor:function(e){this._zoomFactor=.1*e},setRotationFactor:function(e){this._rotationFactor=.1*e},setPanFactor:function(e){this._panFactor=.002*e},setLimitPitchUp:function(e){this._limitPitchUp=e},setLimitPitchDown:function(e){this._limitPitchDown=e},setLimitYawLeft:function(e){this._limitYawLeft=e,this._constrainYaw=!0},setLimitYawRight:function(e){this._limitYawRight=e,this._constrainYaw=!0},setLimitZoomOut:function(e){this._limitZoomOut=e,this._constrainZoom=!0},setLimitZoomIn:function(e){this._limitZoomIn=e,this._constrainZoom=!0},setConstrainPitch:function(e){this._constrainPitch=e,this._previousPitch=void 0},isConstrainPitch:function(){return this._constrainPitch},setConstrainYaw:function(e){this._constrainYaw=e,this._previousYaw=void 0},isConstrainYaw:function(){return this._constrainYaw},setConstrainZoom:function(e){this._constrainZoom=e},isConstrainZoom:function(){return this._constrainZoom},setDelay:function(e){this._rotate.setDelay(e),this._pan.setDelay(e),this._zoom.setDelay(e)},reset:function(){this.init()},setTarget:function(e){o.R3.copy(this._target,e);var t=o.R3.create();this.getEyePosition(t),this._distance=o.R3.distance(e,t)},setEyePosition:function(){var e=o.R3.create(),t=o.R3.create(),i=o.R3.create();return function(n){var r=this._rotation,a=this._target;o.R3.sub(e,n,a),o.R3.normalize(e,e),o.R3.cross(t,e,this._upz),o.R3.normalize(t,t),o.R3.cross(i,t,e),o.R3.normalize(i,i),r[0]=t[0],r[1]=e[0],r[2]=i[0],r[3]=0,r[4]=t[1],r[5]=e[1],r[6]=i[1],r[7]=0,r[8]=t[2],r[9]=e[2],r[10]=i[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this._distance=o.R3.distance(a,n)}}(),setEnable:function(e){this.getInputManager().setEnable(Bt.Z.ORBIT_MANIPULATOR,e)},computeHomePosition:function(e){var t=this.getHomeBoundingSphere(e);t&&t.valid()&&(this.setDistance(this.getHomeDistance(t)),this.setTarget(t.center()))},getHomePosition:function(){if(void 0!==this._node){var e=this._target,t=this.getDistance();this.computeEyePosition(e,t,this._homePosition)}return this._homePosition},setMinSpeed:function(e){this._minSpeed=e},getMinSpeed:function(){return this._minSpeed},setDistance:function(e){this._distance=e},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:(Qi=o._E.create(),Gi=o.R3.create(),Hi=o.R3.create(),function(e,t){var i=this._camera.getProjectionMatrix(),n=1===i[15]?1:2/i[5],r=this.getSpeedFactor()*n;t*=r,e*=r,o._E.invert(Qi,this._rotation),Gi[0]=Qi[0],Gi[1]=Qi[1],Gi[2]=Qi[2],o.R3.normalize(Gi,Gi),Hi[0]=Qi[8],Hi[1]=Qi[9],Hi[2]=Qi[10],o.R3.normalize(Hi,Hi),o.R3.scale(Gi,Gi,-e),o.R3.scale(Hi,Hi,t),o.R3.add(this._target,this._target,Gi),o.R3.add(this._target,this._target,Hi)}),computeRotation:(Vi=o.R3.fromValues(1,0,0),function(e,t){var i=Math.atan(-this._rotation[6]/this._rotation[5]);isNaN(i)&&(i=0);var n=this._computePitch(i,t),r=e/10,a=Math.atan2(this._rotation[4],this._rotation[0]),s=this._computeYaw(a,r);o._E.fromRotation(this._rotation,-n,Vi),o._E.rotate(this._rotation,this._rotation,-s,this._upz)}),_computePitch:function(e,t){var i=e+t/10;return Math.min(Math.max(i,this._limitPitchDown),this._limitPitchUp)},_computeYaw:function(e,t){var i=e+t,n=this._limitYawLeft,r=this._limitYawRight;if(this._constrainYaw){if(r<n&&(i>Math.PI&&(e-=zi,i-=zi),i<-Math.PI&&(e+=zi,i+=zi)),0===t){(n>r?i<n&&i>r:i<n||i>r)&&(i=Math.abs(i-n)>Math.abs(i-r)?r:n)}t>0&&Wi(e,r)&&i>r?i=r:t<0&&Wi(n,e)&&i<n&&(i=n)}return i},computeZoom:function(e){this.zoom(e)},setAutoPushTarget:function(e){this._autoPushTarget=e},zoom:function(){var e=o.R3.create();return function(t){var i=this._distance+this.getSpeedFactor()*(t-1);this._autoPushTarget&&i<this._limitZoomIn&&(o.R3.sub(e,this._target,this.getEyePosition(e)),o.R3.normalize(e,e),o.R3.scale(e,e,this._limitZoomIn-i),o.R3.add(this._target,this._target,e));var n=this._constrainZoom?this._limitZoomIn:ji,r=this._constrainZoom?this._limitZoomOut:qi;this._distance=Math.max(n,Math.min(r,i))}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(e){return o.R3.copy(e,this._target)},getEyePosition:function(e){return this.computeEyePosition(this._target,this._distance,e),e},computeEyePosition:function(){var e=o.R3.create(),t=o._E.create();return function(i,n,r){o._E.invert(t,this._rotation),e[1]=n,o.R3.transformMat4(r,e,t),o.R3.add(r,i,r)}}(),update:(Ui=o.R3.create(),function(e){var t,i=e.getFrameStamp().getDeltaTime();t=this._rotate.update(i),this.computeRotation(-t[0]*this._rotationFactor*this._scaleMouseMotion,-t[1]*this._rotationFactor*this._scaleMouseMotion),t=this._pan.update(i),this.computePan(-t[0]*this._panFactor,-t[1]*this._panFactor),t=this._zoom.update(i),this.computeZoom(1+t[0]*this._zoomFactor);var n=this._target,r=this._distance;o._E.invert(this._inverseMatrix,this._rotation),o._E.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),o.R3.set(Ui,0,r,0),o.R3.transformMat4(Ui,Ui,this._inverseMatrix),o._E.lookAt(this._inverseMatrix,o.R3.add(Ui,n,Ui),n,this._upz)}),setPoseVR:function(e){o._E.fromQuat(this._vrMatrix,e)}}),"osgGA","OrbitManipulator"),Zi.DeviceOrientation=Ni,Zi.GamePad=Pi,Zi.Hammer=Lt,Zi.WebVR=ki,Zi.StandardMouseKeyboard=Dt;const Ji=Zi;var Yi=function(e){this._manipulatorList=[],this._currentManipulator=void 0,this._inputManager=e};Yi.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(e){for(var t=this.getManipulatorList(),i=0,n=t.length;i<n;++i)t[i].setCamera(e)},update:function(e){var t=this.getCurrentManipulator();if(void 0!==t)return t.update(e)},getInputManager:function(){return this._inputManager},setEnable:function(e){this.getCurrentManipulator().setEnable(e)},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(e){for(var t=this.getManipulatorList(),i=0,n=t.length;i<n;++i)t[i].setNode(e)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(e){this._manipulatorList.push(e),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(e){this._currentManipulator=e},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(e){var t=this.getCurrentManipulator();void 0!==t&&t.computeHomePosition(e)},getInverseMatrix:function(){var e=this.getCurrentManipulator();if(void 0!==e)return e.getInverseMatrix()},getHomeBound:function(e){return P.Z.warn("Please use getHomeBoundingSphere instead"),this.getHomeBoundingSphere(e)},getHomeBoundingSphere:function(e){return this.getCurrentManipulator().getHomeBoundingSphere(e)},getHomeDistance:function(e){return this.getCurrentManipulator().getHomeDistance(e)}};const Ki=Yi;var Xi={};st().NO_MOUSEEVENTS=!0,Xi.CADManipulator=fi,Xi.getCADManipulatorStandardMouseKeyboardController=function(){return Ft},Xi.getCADManipulatorHammerController=function(){return Zt},Xi.FirstPersonManipulator=Ri,Xi.getFirstPersonDeviceOrientationController=function(){return Ci},Xi.getFirstPersonManipulatorHammerController=function(){return Si},Xi.getFirstPersonStandardMouseKeyboardControllerClass=function(){return xi},Xi.getFirstPersonWebVRControllerClass=function(){return yi},Xi.Manipulator=ht,Xi.OrbitManipulator=Ji,Xi.getOrbitManipulatorDeviceOrientationController=function(){return Ni},Xi.getOrbitManipulatorGamePadController=function(){return Pi},Xi.getOrbitManipulatorHammerController=function(){return Lt},Xi.getOrbitManipulatorStandardMouseKeyboardController=function(){return Dt},Xi.getOrbitManipulatorWebVRController=function(){return ki},Xi.SwitchManipulator=Ki,Xi.OrbitManipulator.Rotate=wt,Xi.OrbitManipulator.Pan=Mt,Xi.OrbitManipulator.Zoom=Rt,Xi.Controller=xt;const $i=Xi;var en=i("TKk8"),tn=i("eR0f"),nn=i("LZhK"),rn=i("0/zD"),an=i("OYOS"),on=i("WzzD"),sn=i("2Uq9"),ln=i("Axet"),un=i("4igZ"),hn=i("UuwK"),cn=function(){Je.Z.call(this),this._feedbackSwapped=!1,this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!1,this._lastXratio=1,this._lastYratio=1,this._xViewportRatio=1,this._yViewportRatio=1,this._xTextureRatio=1,this._yTextureRatio=1,this._finalPassUpScaleToScreen=!0,this._methodWrapUV=0,this._thresholdWrapUV=1,this._texInfos=void 0,this._screenWidth=this._screenHeight=0,this._feedbackData={},this._cameras=[],this._stateSets=[],this._textureUniforms=[],this._programs={},this._externalTextures={},this._internalPasses=[],this._textures={},this._userTextures={},this._currentPoolIndex=0,this._texturePool={},this._firstTexture="",this._offScreen=!1;var e=this.getOrCreateStateSet();e.setAttributeAndModes(new tn.Z(tn.Z.DISABLE)),e.setAttributeAndModes(new en.Z(en.Z.BACK)),this.setCullCallback(this)};cn.VertexShader=["attribute vec3 Vertex;","void main(void) {","    gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","}","","#define SHADER_NAME %name%",""].join("\n"),cn.FragmentShader=["uniform float uRGBMRange;","vec2 gTexCoord;","%uniforms%","",'#pragma include "utils/functions.glsl"',"","%header%","","%texturesColorSpace%","","%functionBodies%","","void main(void) {","    gTexCoord = gl_FragCoord.xy / uTextureOutputSize.xy;","    vec4 color = %firstFunc%(%firstArg%);","    %optionalFuncs%","    %colorSpaces%","    gl_FragColor = color;","}","","#define SHADER_NAME %name%",""].join("\n"),a.Z.createPrototypeObject(cn,a.Z.objectInherit(Je.Z.prototype,{setOffscreen:function(e){this._offScreen=e},clear:function(){for(var e in this._textures={},this._internalPasses.length=0,this._firstTexture="",this._texturePool)this._texturePool[e].usage=-1;this._feedbackData={},this._cameras.length=0,this._stateSets.length=0,this._textureUniforms.length=0,this.removeChildren()},clearShaderCache:function(){this._programs={}},getGlobalXRatio:function(){return this._xViewportRatio*this._xTextureRatio},getGlobalYRatio:function(){return this._yViewportRatio*this._yTextureRatio},setFinalPassUpScaleToScreen:function(e){this._finalPassUpScaleToScreen=e},_enforceFromInputParameter:function(e,t){var i=t.name,n=this._textures[i],r=this._textures[i+"FeedbackTexture"],a=t[e];void 0!==a&&(void 0!==n[e]&&n[e]!==a&&console.error("Mismatch on parameter "+e+" : "+i),n[e]=a,r&&(r[e]=a))},_updatePassInfoFromInputs:function(e,t,i){var n=this._textures[t],r=i.srgb;i.srgb=void 0;for(var a=0;a<e.textures.length;a++){var o=e.textures[a];this._renameTextureAlias(o,t,i.name);var s=o.name;if(!this._externalTextures[s]){this._usages[s]=(this._usages[s]||0)+1;var l=o.srgb;this._enforceFromInputParameter("filter",o),this._enforceFromInputParameter("rgbm",o),this._enforceFromInputParameter("srgb",o);var u=this._textures[s];if(!u){var h=s.substring(0,s.indexOf("FeedbackTexture"));u=this._textures[h]}void 0!==r&&void 0!==l&&r!==l&&(u.encodeSRGB=!0),this._setInferredParameter("rgbmInferred","rgbm",n,u),this._setInferredParameter("srgbInferred","srgb",n,u)}}void 0===i.srgb&&(i.srgb=void 0===n.srgb?n.srgbInferred:n.srgb)},_setInferredParameter:function(e,t,i,n){void 0===i[e]&&(i[e]=void 0===n[t]?n[e]:n[t])},_createTextureOut:function(e,t,i){var n={srgb:e.out.srgb,rgbm:e.out.rgbm,filter:e.out.filter,type:e.out.type},r=e.out.type!==je.Z.UNSIGNED_BYTE;return void 0===n.rgbm&&(i||r)&&(n.rgbm=!1),void 0===n.srgb&&(i?n.srgb=!0:(n.rgbm||r)&&(n.srgb=!1)),n},_processUserPasses:function(e){e=this._internalPasses.concat(e);for(var t=this._preprocessUserPasses(e),i=t.length,n=[],r={name:this._firstTexture,srgb:void 0},a={},o=0;o<i;o++){var s=t[o],l=o===i-1;if(l||!this._collapsePasses(s,t[o+1])){var u=s.out.name,h="%next"===u;h&&(a[u=s.funcs.join("_")]?u+=a[u]++:a[u]=1);var c=this._createTextureOut(s,u,l);this._textures[u]=c,this._updatePassInfoFromInputs(s,u,r),s.feedbackLoop&&(this._textures[u+"FeedbackTexture"]={srgb:c.srgb,rgbm:c.rgbm,srgbInferred:c.srgbInferred,rgbmInferred:c.rgbmInferred,filter:c.filter}),h&&(r.name=u,s.out.name=u),n.push(s)}else t.splice(o+1,1),i--,o--}return n},_hasFreeTexture:function(e,t,i){if(e===i.name&&this._texturePool[e])return e;if(!i.immuable)for(var n in this._texturePool){var r=this._texturePool[n];if(r.reusable&&(!(r.usage>0)&&r.texture.divisor===i.divisor&&r.texture.getInternalFormatType()===i.type)){if(-1===r.usage)return r.texture.getMinFilter()!==t&&(r.texture.setMinFilter(t),r.texture.setMagFilter(t)),n;if(r.texture.getMinFilter()===t)return n}}},_setOrCreateTextureKey:function(e,t,i){var n="linear"===this._textures[t].filter?je.Z.LINEAR:je.Z.NEAREST,r=this._hasFreeTexture(t,n,i);if(r)return this._texturePool[r].usage=e,void(this._textures[t].key=r);r=i.immuable?t:"key"+this._currentPoolIndex++,this._texturePool[r]={usage:e,texture:this._createTexture(t,i.divisor,i.type,n),immuable:i.immuable,reusable:i.reusable},-1===i.divisor&&(this._texturePool[r].width=i.width,this._texturePool[r].height=i.height),this._textures[t].key=r},_addStateSet:function(e,t){for(var i=0;i<e.funcs.length;i++){var n=e.funcs[i].name;this._stateSets[n]=t}},_addTextureToStateSet:function(e,t,i,n,r){t.addUniform(nn.Z.createInt1(i,e.uniformName));var a,o=e.name;if(void 0!==this._textures[o]){var s=this._textures[o].key;a=this._texturePool[s].texture}else a=this._externalTextures[o];if(this._addTextureUniforms(e.uniformName,a,t,n,r),"TexturePrevious"===e.uniformName)return i;t.setTextureAttributeAndModes(i,a)},_getUniformName:function(e){return"u"+e[0].toUpperCase()+e.slice(1)},_addTextureUniforms:function(e,t,i,n,r){var a=this._getUniformName(e),o=nn.Z.createFloat2(a+"Size"),s=nn.Z.createFloat2(a+"Ratio");i.addUniform(o),i.addUniform(s),n.push(o),n.push(s),this._textureUniforms.push({size:o,ratio:s,texture:t,isFeedback:!!r})},_checkInferredParameters:function(){for(var e in this._textures){var t=this._textures[e];void 0===t.srgb&&(t.srgb=t.srgbInferred),void 0===t.rgbm&&(t.rgbm=t.rgbmInferred)}},_buildPass:function(e,t){var i=t[e],n=i.out.name;this._setOrCreateTextureKey(this._usages[n],n,i.out);var r=i.out.name+"FeedbackTexture";if(i.feedbackLoop&&this._setOrCreateTextureKey(this._usages[r],r,i.out),i.funcs.length){var a,o=new rn.Z;for(this._addStateSet(i,o),a=0;a<i.uniforms.length;a++)o.addUniform(i.uniforms[a]);var s=[],l=void 0;for(a=0;a<i.textures.length;a++){var u=i.textures[a],h=u.name===r;if(!h&&!this._externalTextures[u.name]){var c=this._textures[u.name].key;this._texturePool[c].usage--}var A=this._addTextureToStateSet(u,o,a,s,h);if(void 0!==A&&(l=A),void 0!==this._feedbackData[u.name]){var d={stateSet:o,textureUnit:a};this._feedbackData[u.name].nextPasses.push(d)}}var g=void 0;if(e!==t.length-1||this._offScreen){var f=this._textures[n].key;g=this._texturePool[f].texture}this._addTextureUniforms("TextureOutput",g,o,s),o.setAttributeAndModes(this._createProgram(i,s)),i.feedbackLoop?this._feedbackData[n]=this._createFeedbackLoopCameras(n,o,g,l):this.addChild(this._createCamera(n,o,g))}else{var p=this._textures[n].key;this._userTextures[n]=this._texturePool[p].texture}},_buildGraphFromPasses:function(e){for(var t=0;t<e.length;t++)this._buildPass(t,e)},build:function(e){this._usages={};var t=this._processUserPasses(e);this._checkInferredParameters(t),this._buildGraphFromPasses(t),this.resize(this._screenWidth,this._screenHeight)},_createFeedbackLoopCameras:function(e,t,i,n){var r=this._textures[e+"FeedbackTexture"].key,a=this._texturePool[r].texture,o=new Je.Z;o.setStateSet(t);var s=this._createFeedbackLoopCamera(e,i,a,n),l=this._createFeedbackLoopCamera(e+"FeedbackTexture",a,i,n);l.setNodeMask(0),o.addChild(s),o.addChild(l),this.addChild(o);var u={};return u.camera1=s,u.camera2=l,u.texture1=i,u.texture2=a,u.nextPasses=[],u},_createFeedbackLoopCamera:function(e,t,i,n){var r=new rn.Z;r.setTextureAttributeAndModes(n,i);var a=this._createCamera(e,r,t);return a.setStateSet(r),a},_createCamera:function(e,t,i){var n=new an.Z;n.setName(e),n.setStateSet(t),n.setClearMask(0),n.setReferenceFrame(De.Z.ABSOLUTE_RF),i&&(n.setRenderOrder(an.Z.PRE_RENDER,0),n.attachTexture(on.Z.COLOR_ATTACHMENT0,i)),n.setViewport(new sn.Z);var r=We.Z.createTexturedFullScreenFakeQuadGeometry();return r.setName("composer layer"),n.addChild(r),this._cameras.push(n),n},swapFeedbackLoopTextures:function(e){for(var t in this._feedbackData){var i=this._feedbackData[t];i.camera1.setNodeMask(e?-1:0),i.camera2.setNodeMask(e?0:-1);for(var n=e?i.texture1:i.texture2,r=0;r<i.nextPasses.length;r++){var a=i.nextPasses[r];a.stateSet.setTextureAttributeAndModes(a.textureUnit,n)}}this._feedbackSwapped=!0},_createFuncFromUserData:function(e){var t="string"==typeof e?{name:e,file:e+".glsl"}:e;return t.toString=function(){return this.name},t},_createTextureInfoFromUserData:function(e){var t={name:"",uniformName:"",rgbm:void 0,srgb:void 0,filter:void 0};return"string"==typeof e?t.name=e:(t.name=e.name,e.uniformName&&(t.uniformName=e.uniformName),void 0!==e.rgbm&&(t.rgbm=e.rgbm),void 0!==e.srgb&&(t.srgb=e.srgb),void 0!==e.filter&&(t.filter=e.filter)),t},_preprocessUserPasses:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],r={funcs:[]};if(n.func&&r.funcs.push(this._createFuncFromUserData(n.func)),r.textures=[],r.feedbackLoop=!1,void 0!==n.textures){Array.isArray(n.textures)||(n.textures=[n.textures]);for(var a=0;a<n.textures.length;a++){var o=this._createTextureInfoFromUserData(n.textures[a]);"%previous"===o.name&&(r.feedbackLoop=!0),r.textures.push(o)}}"string"==typeof n.header?r.header=[n.header]:r.header=n.header||[],void 0!==n.uniforms?Array.isArray(n.uniforms)?r.uniforms=n.uniforms:r.uniforms=[n.uniforms]:r.uniforms=[],r.out=n.out,r.out.divisor=r.out.divisor||1,r.out.type=r.out.type||je.Z.UNSIGNED_BYTE,void 0===r.out.immuable&&(r.out.immuable=!1),void 0===r.out.reusable&&(r.out.reusable=!0),(r.feedbackLoop||-1===r.out.divisor)&&(r.out.immuable=!0,r.out.reusable=!1),r.collapsible=n.collapsible||!1,t.push(r)}return t},_canBeCollapsed:function(e,t){return e.funcs.length&&t.collapsible&&"%next"===e.out.name&&e.out.divisor===t.out.divisor&&e.out.width==e.out.width&&e.out.height==e.out.height},_collapsePasses:function(e,t){return!!this._canBeCollapsed(e,t)&&(e.funcs=e.funcs.concat(t.funcs),e.header=e.header.concat(t.header),e.textures=this._mergeWithoutDuplicates(e.textures,t.textures,(function(e,t){return e.name===t.name})),e.uniforms=this._mergeWithoutDuplicates(e.uniforms,t.uniforms,(function(e,t){return e.getName()===t.getName()})),!0)},_renameTextureAlias:function(e,t,i){"%last"===e.name?(e.name=i,e.uniformName=e.uniformName||"TextureInput"):"%previous"===e.name?(e.name=t+"FeedbackTexture",e.uniformName=e.uniformName||"TexturePrevious"):e.uniformName||(e.uniformName=e.name)},_createTexture:function(e,t,i,n){var r=new je.Z;return r.setTextureSize(1,1),r.setInternalFormatType(i),r.setInternalFormat(je.Z.RGBA),r.setMinFilter(n),r.setMagFilter(n),r.divisor=t,r.setName(e),r},_computeHashFromPass:function(e){for(var t="",i=0;i<e.funcs.length;i++)t+=e.funcs[i].name+"_"+e.funcs[i].file+"_";for(e.header&&(t+=e.header.join("_")),i=0;i<e.textures.length;i++)t+=!!e.textures[i].rgbm+"_"+!!e.textures[i].srgb+"_";return t+=!!e.out.encodeSRGB+"_",t+=!!this._textures[e.out.name].rgbm+"_"},_writeDeclarations:function(e,t,i,n){var r,a="uniform sampler2D TextureInput;\n";for(r=0;r<i.length;r++){a+="uniform sampler2D "+(i[r].uniformName||i[r].name)+";\n"}for(r=0;r<t.length;r++){var o=t[r];a+="uniform "+o.getType()+" "+o.getName()+";\n"}return e=e.replace("%uniforms%",a),n&&(e=e.replace("%header%",n.join("\n"))),e},setMethodWrapUV:function(e,t){void 0!==e&&(this._methodWrapUV=e),void 0!==t&&(this._thresholdWrapUV=t),this._texInfos=void 0},_getInfos:function(){if(this._texInfos)return this._texInfos;var e="texture2D(%tex, (uv) * %ratio)",t="texture2D(%tex, (floor((uv) * %size) + 0.5) * %ratio / %size, -99999.0)",i="texture2D(%tex, (uv) * %ratio)",n=this._thresholdWrapUV.toExponential();if(1===this._methodWrapUV){var r="min(uv, 1.0 - "+n+" / %size.xy)";e=e.replace(/(uv)/g,r),t=t.replace(/(uv)/g,r),i=i.replace(/(uv)/g,r)}else if(2===this._methodWrapUV){var a="step((uv).x, 1.0 - "+n+" / %size.x) *";e=(a+="step((uv).y, 1.0 - "+n+" / %size.y) * ")+e,t=a+t,i=a+i}return this._texInfos={TEXTURE_2D:{signature:"TEXTURE_2D_%tex(uv)",body:e},TEXTURE_2D_NEAREST:{signature:"TEXTURE_2D_NEAREST_%tex(uv)",body:t},TEXTURE_2D_BIAS:{signature:"TEXTURE_2D_BIAS_%tex(uv, bias)",body:i}},this._texInfos},_extractTextures:function(e){var t=this._getInfos(),i=e.match(/TEXTURE_2D(?:_BIAS|_NEAREST)?_\w+\(/g);if(!i)return{};for(var n={},r=0;r<i.length;r++){var a=i[r].match(/((TEXTURE_2D(?:_BIAS|_NEAREST)?)_(\w+))\(/),o=t[a[2]];n[a[1]]={name:a[3],signature:o.signature,body:o.body}}return n},_writeFunctionBodies:function(e,t,i,n){for(var r=[],a="",o={},s=0;s<t.length;s++){a+=hn.Z.getShaderTextPure(t[s].file)+"\n"}a=hn.Z.processIncludes(a,["utils/functions.glsl"]);var l=this._extractTextures(a);if(n){var u=this._getInfos().TEXTURE_2D;l.TEXTURE_2D_TextureInput={name:"TextureInput",signature:u.signature,body:u.body}}for(var h in l)if(!o[h]){o[h]=!0;for(var c=l[h],A=c.name,d=!1,g=0;g<i.length;g++){var f=i[g];if(f.uniformName===A){var p=this._textures[f.name];if(p&&p.rgbm){d=p.rgbm;break}}}var m=c.body;d&&(m="vec4(decodeRGBM("+m+", uRGBMRange), 1.0)"),m="#define "+c.signature+" ("+m+")";var _=this._getUniformName(A);m=(m=(m=m.replace(/%size/g,_+"Size")).replace(/%ratio/g,_+"Ratio")).replace(/%tex/g,A),r.push(m)}return(e=e.replace("%texturesColorSpace%",r.join("\n"))).replace("%functionBodies%",a.replace(/\\\n/g,""))},_writeMainFunction:function(e,t,i,n){var r=i?"TEXTURE_2D_TextureInput(gTexCoord)":"";e=(e=e.replace("%firstFunc%",t[0].name)).replace("%firstArg%",r);for(var a="",o=1;o<t.length;o++)a+="\tcolor = "+t[o].name+"(color);\n";(e=e.replace("%optionalFuncs%",a),!0===this._textures[n].encodeSRGB)?a="\tcolor.rgb = "+(this._textures[n].srgb?"linearTosRGB":"sRGBToLinear")+"(color.rgb);\n":a="";return this._textures[n].rgbm?a+="\tcolor = encodeRGBM(color.rgb, uRGBMRange);":a+="",e.replace("%colorSpaces%",a)},_removeDuplicatedUniforms:function(e){for(var t=e.split("\n"),i={},n=t.length,r=0;r<n;r++){var a=t[r].match(/uniform(?:\s+){1,}\w+(?:\s+){1,}(\w+)/);if(null!==a){var o=a[1];void 0!==i[o]?(t.splice(r,1),n--,r--):i[o]=!0}}return t.join("\n")},_createProgram:function(e,t){var i=this._computeHashFromPass(e);if(void 0!==this._programs[i])return this._programs[i];var n=this._writeDeclarations(cn.FragmentShader,t,e.textures,e.header);n=this._writeFunctionBodies(n,e.funcs,e.textures,e.collapsible),n=(n=this._writeMainFunction(n,e.funcs,e.collapsible,e.out.name)).replace("%name%",e.out.name),n=this._removeDuplicatedUniforms(n);var r=cn.VertexShader.replace("%name%",e.out.name),a=new ln.Z(new un.Z(un.Z.VERTEX_SHADER,r),new un.Z(un.Z.FRAGMENT_SHADER,n));return a._asyncLinkingExt=void 0,this._programs[i]=a,a},resize:function(e,t){for(var i in this.setScreenSize(e,t),this._texturePool){var n=this._texturePool[i].texture;void 0===this._texturePool[i].width?n.setTextureSize(this._getTextureSize(e,n.divisor),this._getTextureSize(t,n.divisor)):n.setTextureSize(this._texturePool[i].width,this._texturePool[i].height)}this.resizeRatio()},resizeRatio:function(e,t,i,n){void 0!==e&&(this._xViewportRatio=e),void 0!==t&&(this._yViewportRatio=t),void 0!==i&&(this._xTextureRatio=i),void 0!==n&&(this._yTextureRatio=n),this._resizeViewports(),this._resizeTextureUniforms()},_resizeViewports:function(){for(var e=this.getGlobalXRatio(),t=this.getGlobalYRatio(),i=this._cameras,n=0;n<i.length;++n){var r=i[n],a=1;if(r.isRenderToTextureCamera())a=r.getAttachments()[on.Z.COLOR_ATTACHMENT0].texture.divisor;if(n===i.length-1&&this._finalPassUpScaleToScreen&&(e=this._xViewportRatio,t=this._yViewportRatio),-1!==a){var o=this._getTextureSize(this._screenWidth,a/e),s=this._getTextureSize(this._screenHeight,a/t);r.getViewport().setViewport(0,0,o,s)}}},_resizeTextureUniforms:function(){var e=this.getGlobalXRatio(),t=this.getGlobalYRatio(),i=this._finalPassUpScaleToScreen?this._xViewportRatio:e,n=this._finalPassUpScaleToScreen?this._yViewportRatio:t;this._syncFeedbackUniforms=!0;for(var r=this._textureUniforms,a=0;a<r.length;++a){var o=r[a],s=o.size.getInternalArray(),l=o.ratio.getInternalArray();if(!o.isFeedback||!s[0]){l[0]=e,l[1]=t;var u=o.texture;u?!u.divisor||u.divisor<0?(s[0]=u.getWidth(),s[1]=u.getHeight(),l[0]=l[1]=1):(s[0]=e*u.getWidth(),s[1]=t*u.getHeight()):(s[0]=this._screenWidth*i,s[1]=this._screenHeight*n)}}},_resizeFeedbackTextureUniforms:function(){for(var e=this._lastXratio,t=this._lastYratio,i=this._textureUniforms,n=0;n<i.length;++n){var r=i[n];if(r.isFeedback){var a=r.size.getInternalArray(),o=r.ratio.getInternalArray(),s=r.texture;o[0]=e,o[1]=t,a[0]=e*s.getWidth(),a[1]=t*s.getHeight()}}},cull:function(){return this._syncOnNextFrame&&(this._resizeFeedbackTextureUniforms(),this._syncOnNextFrame=!1),this._syncFeedbackUniforms&&this._feedbackSwapped&&(this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!0,this._lastXratio=this.getGlobalXRatio(),this._lastYratio=this.getGlobalYRatio()),this._feedbackSwapped=!1,!0},_mergeWithoutDuplicates:function(e,t,i){for(var n=0;n<t.length;n++){for(var r=t[n],a=!0,o=0;o<e.length;o++)if(i(e[o],r)){a=!1;break}a&&e.push(r)}return e},_getTextureSize:function(e,t){return Math.max(1,Math.round(e/t))},setScreenSize:function(e,t){this._screenWidth=e,this._screenHeight=t},addInternalTexture:function(e){this._internalPasses.push({out:{name:e.name,divisor:e.divisor,type:e.type,filter:e.filter,srgb:e.srgb,rgbm:e.rgbm,immuable:e.immuable,reusable:e.reusable}})},addExternalTexture:function(e,t){this._externalTextures[e]=t},setInputTexture:function(e){this._firstTexture=e},getCameras:function(){return this._cameras},getStateSetPass:function(e){return this._stateSets[e]},getInternalTexture:function(e){return this._userTextures[e]}}),"osgUtil","ComposerPostProcess");const An=cn;var dn=function(e,t){var i,n;t?(i=t[0],n=t[1]):(i=e[14]/(e[10]-1),n=e[14]/(1+e[10]));var r=i*(e[8]-1)/e[0],a=i*(1+e[8])/e[0],o=i*(1+e[9])/e[5],s=i*(e[9]-1)/e[5],l=n*(e[8]-1)/e[0],u=n*(1+e[8])/e[0],h=n*(1+e[9])/e[5],c=n*(e[9]-1)/e[5],A=this.getAttributes().Vertex,d=A.getElements();d[0]=r,d[1]=s,d[2]=-i,d[3]=a,d[4]=s,d[5]=-i,d[6]=a,d[7]=o,d[8]=-i,d[9]=r,d[10]=o,d[11]=-i,d[12]=l,d[13]=c,d[14]=-n,d[15]=u,d[16]=c,d[17]=-n,d[18]=u,d[19]=h,d[20]=-n,d[21]=l,d[22]=h,d[23]=-n,A.dirty()};const gn={createDebugFrustumGeometry:function(){var e=We.Z.createBoundingBoxGeometry();return e.updateGeometry=dn,e}};var fn=i("epKp"),pn=i("nMbz"),mn=i("jO+y"),_n=function(){j.Z.call(this),this._unifScale=nn.Z.createFloat(1,"uScale");var e=this._normalStateSet=new rn.Z;e.addUniform(nn.Z.createFloat3(o.R3.fromValues(1,0,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new tn.Z(tn.Z.NEVER)),e.setShaderGeneratorName("debugNormal"),e.setRenderBinDetails(mn.Z.DEBUG,"RenderBin");var t=this._tangentStateSet=new rn.Z;t.addUniform(nn.Z.createFloat3(o.R3.fromValues(0,1,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new tn.Z(tn.Z.NEVER)),t.setShaderGeneratorName("debugTangent"),t.setRenderBinDetails(mn.Z.DEBUG,"RenderBin")};a.Z.createPrototypeObject(_n,a.Z.objectInherit(j.Z.prototype,{setScale:function(e){this._unifScale.setFloat(e)},testCreateNormalVisitor:function(e){this._alreadyRun||(this._alreadyRun=!0,this.apply(e))},setTangentVisibility:function(e,t){this._tangentStateSet.setAttributeAndModes(new tn.Z(e?tn.Z.LESS:tn.Z.NEVER)),this.testCreateNormalVisitor(t)},setNormalVisibility:function(e,t){this._normalStateSet.setAttributeAndModes(new tn.Z(e?tn.Z.LESS:tn.Z.NEVER)),this.testCreateNormalVisitor(t)},apply:function(e){if(!(e instanceof Le.Z&&e.getCullCallback()||e._isVisitedNormalDebug)){if(e._isVisitedNormalDebug=!0,e instanceof Le.Z)return this._createDebugGeom(e,"Normal",this._normalStateSet),void this._createDebugGeom(e,"Tangent",this._tangentStateSet);this.traverse(e);for(var t=e.getUpdateCallbackList(),i=0,n=t.length;i<n;++i)t[i]instanceof te&&t[i].init(e)}},_createDoubleOffsetArray:function(e){for(var t=new Float32Array(2*e),i=0;i<e;++i)t[2*i]=1;return new Y.Z(Y.Z.ARRAY_BUFFER,t,1)},_createDoubledBufferArray:function(e){e.getInitialBufferArray&&(e=e.getInitialBufferArray());for(var t=e.getItemSize(),i=e.getElements(),n=i.length/t,r=new(0,i.constructor)(2*i.length),a=0;a<n;++a)for(var o=a*t,s=2*o,l=0;l<t;++l)r[s+l]=r[s+l+t]=i[o+l];return new Y.Z(Y.Z.ARRAY_BUFFER,r,t)},_addMorphTargets:function(e,t,i){var n=t.getMorphTargets();t.setName(e.getName());for(var r=e.getMorphTargets(),a=0,o=r.length;a<o;++a){var s=r[a],l=s.getVertexAttributeList(),u=new Le.Z;u.setName(s.getName());var h=u.getVertexAttributeList();h.Vertex=this._createDoubledBufferArray(l.Vertex),l[i]&&(h[i]=this._createDoubledBufferArray(l[i])),n.push(u)}return t.mergeChildrenVertexAttributeList(),t},_createDebugGeom:function(e,t,i){var n=e.getAttributes(),r=n[t];if(r){var a=n.Vertex;if(a){var o;e instanceof X.Z?o=e:e.getSourceGeometry&&e.getSourceGeometry()instanceof X.Z&&(o=e.getSourceGeometry());var s,l=a.getElements().length/a.getItemSize(),u=o?new X.Z:new Le.Z;if(u.getAttributes().Vertex=this._createDoubledBufferArray(a),u.getAttributes().Offset=this._createDoubleOffsetArray(l),u.getAttributes()[t]=this._createDoubledBufferArray(r),u.getPrimitives().push(new fn.Z(pn.Z.LINES,0,2*l)),o&&this._addMorphTargets(o,u,t),e instanceof K.Z){var h=new K.Z;h.setSourceGeometry(u),h.getVertexAttributeList().Bones=this._createDoubledBufferArray(n.Bones),h.getVertexAttributeList().Weights=this._createDoubledBufferArray(n.Weights),h._rigTransformImplementation=e._rigTransformImplementation,h._stateSetAnimation=e._stateSetAnimation,h.mergeChildrenData(),s=h}else s=u;var c=e.getParents(),A=c.length;s._isVisitedNormalDebug=!0,s._isNormalDebug=!0,s.setStateSet(i),s.nodeMask=-49;for(var d=0;d<A;++d)c[d].addChild(s);return s}}}}),"osgUtil","DisplayNormalVisitor");const vn=_n;var Cn=i("C+0K"),bn=function(){j.Z.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new rn.Z,this._stCenter.setShaderGeneratorName("debugGeometry")};a.Z.createPrototypeObject(bn,a.Z.objectInherit(j.Z.prototype,{setGeometryDebug:function(e){this._stCenter.setAttributeAndModes(new tn.Z(tn.Z.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(e)},setSkinningDebug:function(e){this._stCenter.setAttributeAndModes(new tn.Z(tn.Z.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this._boneIndexErrors=[],this.apply(e),this._boneIndexErrors.length&&this._warnBonesIndex()},disableDebug:function(e){(this._debugColor||this._debugSkinning)&&(this._stCenter.setAttributeAndModes(new tn.Z(tn.Z.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(e))},_debugCenterGeometry:function(e,t){var i=e.getBound(),n=new Float32Array(18),r=.1*i.radius();n[0]=r,n[3]=-r,n[7]=r,n[10]=-r,n[14]=r,n[17]=-r;var a=new Le.Z;a.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,n,3);var s=new fn.Z(pn.Z.LINES,0,6);a.getPrimitives().push(s);var l=new ze.Z,u=i.center();l.getMatrix()[12]=u[0],l.getMatrix()[13]=u[1],l.getMatrix()[14]=u[2],l.addChild(a),this.nodePath[this.nodePath.length-2].addChild(l),t=o.R3.fromValues(.8*t[0],.8*t[1],.8*t[2]),a.getOrCreateStateSet().addUniform(nn.Z.createFloat3(t,"uColorDebug")),l.setStateSet(this._stCenter),l._isCenterDebug=!0},_warnBonesIndex:function(){for(var e="Couldn't find bones. Indices: ",t="",i=0;i<this._boneIndexErrors.length&&i<10;i++){var n=this._boneIndexErrors[i];e+=n.index+", ",t+=n.boneNum+", "}Cn.Z.client.captureMessage(e+" respectively reference bone nums: "+t)},_debugRigGeometry:function(e){var t=e.getVertexAttributeList();if(!t.BonesColor){for(var i=t.Bones.getElements(),n=t.Weights.getElements(),r=e._rigTransformImplementation._bones,a=i.length/4,o=new Float32Array(3*a),s=0;s<a;++s){for(var l=4*s,u=!1,h=l;h<l+4;h++)i[h]>r.length&&(this._boneIndexErrors.push({index:h,boneNum:i[h]}),u=!0);if(!u){var c=r[i[l]].getOrCreateDebugColor(),A=r[i[l+1]].getOrCreateDebugColor(),d=r[i[l+2]].getOrCreateDebugColor(),g=r[i[l+3]].getOrCreateDebugColor(),f=n[l],p=n[l+1],m=n[l+2],_=n[l+3],v=3*s;o[v]=f*c[0]+p*A[0]+m*d[0]+_*g[0],o[v+1]=f*c[1]+p*A[1]+m*d[1]+_*g[1],o[v+2]=f*c[2]+p*A[2]+m*d[2]+_*g[2]}}t.BonesColor=new Y.Z(Y.Z.ARRAY_BUFFER,o,3)}},_debugGeometry:function(e){var t=this._debugColor,i=this._debugSkinning&&e instanceof K.Z;if(t||i){void 0===e._originalStateSet&&(e._originalStateSet=e.getStateSet()||null);var n=new rn.Z;if(n.setRenderBinDetails(mn.Z.DEBUG,"RenderBin"),e.setStateSet(n),i)return n.setShaderGeneratorName("debugSkinning"),void this._debugRigGeometry(e);var r=o.R3.fromValues(Math.random(),Math.random(),Math.random());n.addUniform(nn.Z.createFloat3(r,"uColorDebug")),n.setShaderGeneratorName("debugGeometry"),this._debugCenterGeometry(e,r)}else void 0!==e._originalStateSet&&e.setStateSet(e._originalStateSet||void 0)},apply:function(e){e._isBoneBox||e._isSkeleton||e._isNormalDebug||e._isCenterDebug||(e instanceof Le.Z&&this._debugGeometry(e),this.traverse(e))}}),"osgUtil","GeometryColorDebugVisitor");const Sn=bn;var En,yn,In,xn=i("zTfe"),Tn=i("sI9o"),wn=i("TYv3"),Mn=function(){if(En)return En;var e="#define SHADER_NAME GizmoLine3D",t=["attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",e,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=["uniform vec4 uColor;",e,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return En=new ln.Z(new un.Z(un.Z.VERTEX_SHADER,t),new un.Z(un.Z.FRAGMENT_SHADER,i))},Rn=function(e,t){var i=e?.5*e:.5,n=t?.5*t:.5,r=new Le.Z,a=new Float32Array(12);a[0]=-i,a[1]=-n,a[3]=i,a[4]=-n,a[6]=-i,a[7]=n,a[9]=i,a[10]=n,r.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,a,3);var o=new fn.Z(pn.Z.TRIANGLE_STRIP,0,4);return r.getOrCreateStateSet().setAttributeAndModes(Mn()),r.getPrimitives().push(o),r},Bn={createCircleGeometry:function(e,t,i){for(var n=new Le.Z,r=new Float32Array(3*e),a=i||2*Math.PI,o=0;o<e;++o){var s=3*o,l=a*o/e;r[s]=Math.cos(l)*t,r[s+1]=Math.sin(l)*t}n.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,r,3);var u=new fn.Z(pn.Z.LINE_STRIP,0,e);return n.getOrCreateStateSet().setAttributeAndModes(Mn()),n.getPrimitives().push(u),n},createCylinderGeometry:function(e,t,i,n,r,a,o){var s=void 0!==e?e:1,l=void 0!==t?t:1,u=void 0!==i?i:5,h=void 0!==n?n:32,c=void 0!==r?r:1,A=void 0===a||a,d=void 0===o||o,g=.5*u,f=(c+1)*(h+1),p=c*h*2;(A=A&&s>0)&&(f+=1,p+=h),(d=d&&l>0)&&(f+=1,p+=h);var m,_=new Le.Z,v=new Float32Array(3*f),C=new Uint16Array(3*p),b=0,S=0,E=0,y=0;for(E=0;E<=c;E++){var I=E/c,x=I*(l-s)+s;for(y=0;y<=h;y++){var T=y/h;v[S=3*b]=x*Math.sin(T*Math.PI*2),v[S+1]=x*Math.cos(T*Math.PI*2),v[S+2]=-I*u+g,b++}}for(b=0,y=0;y<h;y++)for(E=0;E<c;E++)C[S=6*b]=(h+1)*E+y,C[S+1]=C[S+3]=(h+1)*(E+1)+y,C[S+2]=C[S+5]=(h+1)*E+y+1,C[S+4]=(h+1)*(E+1)+y+1,b++;if(b*=2,A)for(v[3*(m=(d?v.length-6:v.length-3)/3)+2]=g,y=0;y<h;y++)C[S=3*b]=y,C[S+1]=y+1,C[S+2]=m,b++;if(d){v[3*(m=(v.length-3)/3)+2]=-g;var w=(h+1)*E;for(y=0;y<h;y++)C[S=3*b]=w+y+1,C[S+1]=w+y,C[S+2]=m,b++}return _.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,v,3),_.getOrCreateStateSet().setAttributeAndModes(Mn()),_.getPrimitives().push(new wn.Z(pn.Z.TRIANGLES,new Y.Z(Y.Z.ELEMENT_ARRAY_BUFFER,C,1))),_},createTorusGeometry:function(e,t,i,n,r){var a=void 0!==e?e:1,o=void 0!==t?t:.2,s=void 0!==i?i:6,l=void 0!==n?n:64,u=void 0!==r?r:2*Math.PI,h=(s+1)*(l+1),c=s*l*2,A=new Le.Z,d=new Float32Array(3*h),g=new Uint16Array(3*c);u=u||2*Math.PI;var f=0,p=0,m=0,_=0;for(_=0;_<=s;++_)for(m=0;m<=l;++m){var v=m/l*u,C=_/s*Math.PI*2;d[p=3*f]=(a+o*Math.cos(C))*Math.cos(v),d[p+1]=(a+o*Math.cos(C))*Math.sin(v),d[p+2]=o*Math.sin(C),f++}for(f=0,_=1;_<=s;++_)for(m=1;m<=l;++m)g[p=6*f]=(l+1)*_+m-1,g[p+1]=g[p+3]=(l+1)*(_-1)+m-1,g[p+2]=g[p+5]=(l+1)*_+m,g[p+4]=(l+1)*(_-1)+m,f++;return A.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,d,3),A.getOrCreateStateSet().setAttributeAndModes(Mn()),A.getPrimitives().push(new wn.Z(pn.Z.TRIANGLES,new Y.Z(Y.Z.ELEMENT_ARRAY_BUFFER,g,1))),A}};Bn.createDebugLineGeometry=function(){var e=new Le.Z;e.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,new Float32Array(4),2);var t=new fn.Z(pn.Z.LINES,0,2);return e.getPrimitives().push(t),e.getOrCreateStateSet().setAttributeAndModes(function(){if(yn)return yn;var e="#define SHADER_NAME GizmoLine2D",t=["attribute vec2 Vertex;",e,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),i=[e,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return yn=new ln.Z(new un.Z(un.Z.VERTEX_SHADER,t),new un.Z(un.Z.FRAGMENT_SHADER,i))}()),e},Bn.createPlaneGeometry=Rn,Bn.createQuadCircleGeometry=function(){var e=Rn();return e.getOrCreateStateSet().setAttributeAndModes(function(){if(In)return In;var e="#define SHADER_NAME GizmoQuadCircle",t=["attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",e,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=["uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",e,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return In=new ln.Z(new un.Z(un.Z.VERTEX_SHADER,t),new un.Z(un.Z.FRAGMENT_SHADER,i))}()),e},Bn.resetPrograms=function(){En=void 0,yn=void 0,In=void 0},Bn.getOrCreateShader=Mn;const Nn=Bn;var Dn=function(){};Dn.prototype={cull:function(){return!1}};var Pn=new qe.Z(qe.Z.SRC_ALPHA,qe.Z.ONE_MINUS_SRC_ALPHA),Fn=function(e){this._testPlane=e,this._inter=o.R3.create(),At.Z.call(this)};a.Z.createPrototypeObject(Fn,a.Z.objectInherit(At.Z.prototype,{setTestPlane:function(e){this._testPlane=e},getTranslateDistance:function(){return this._inter},enter:function(){var e=o.R3.create(),t=o.R3.create();return function(i){if(void 0===i._nbAxis)return!0;if(o.R3.init(e),e[i._nbAxis]=1,this._testPlane){var n=o.R3.dot(this._iStart,e),r=o.R3.dot(this._iEnd,e);if(n===r)return!1;var a=-n/(r-n);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{o.R3.normalize(t,o.R3.sub(t,this._iEnd,this._iStart));var s=-o.R3.dot(t,e),l=o.R3.dot(this._iStart,t),u=Math.abs(1-s*s),h=-o.R3.dot(this._iStart,e);o.R3.init(this._inter),this._inter[i._nbAxis]=(s*l-h)/u}return!1}}(),intersectTriangle:function(){},intersectLine:function(){},intersectPoint:function(){}}),"osgUtil","LineCustomIntersector");var On=o._E.create(),Ln=function(e){ze.Z.call(this),this._tmask=1,this._autoInsertMT=!1,this._correctPivotOnAutoInsert=!1,this._viewer=e,this._canvas=e.getGraphicContext().canvas,this._rotateNode=new ze.Z,this._translateNode=new ze.Z,this._planeNode=new ze.Z,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new ze.Z,this._downCanvasCoord=o.K4.create(),this._hoverNode=null,this._keepHoverColor=o.vh.create(),this._isEditing=!1,this._editLineOrigin=o.R3.create(),this._editLineDirection=o.R3.create(),this._editOffset=o.R3.create(),this._editLocal=o._E.create(),this._editWorldTrans=o._E.create(),this._editWorldScaleRot=o._E.create(),this._editInvWorldScaleRot=o._E.create(),this._debugNode=new Je.Z,this._lastDistToEye=0,this._attachedNode=null,this._pivotOffset=o.R3.create(),this.attachToNode(null),this._lsi=new Fn,this._origIntersect=o.R3.create(),this._dstIntersect=o.R3.create(),this._iv=new ct.Z,this._iv.setIntersector(this._lsi),this.init()};Ln.NO_PICK=1,Ln.PICK_ARC_X=2,Ln.PICK_ARC_Y=4,Ln.PICK_ARC_Z=8,Ln.PICK_ARROW_X=16,Ln.PICK_ARROW_Y=32,Ln.PICK_ARROW_Z=64,Ln.PICK_PLANE_X=128,Ln.PICK_PLANE_Y=256,Ln.PICK_PLANE_Z=512,Ln.NO_FULL_CIRCLE=1024,Ln.CORRECT_PIVOT=2048,Ln.PICK_GIZMO=(Ln.PICK_ARC=Ln.PICK_ARC_X|Ln.PICK_ARC_Y|Ln.PICK_ARC_Z)|(Ln.PICK_ARROW=Ln.PICK_ARROW_X|Ln.PICK_ARROW_Y|Ln.PICK_ARROW_Z)|(Ln.PICK_PLANE=Ln.PICK_PLANE_X|Ln.PICK_PLANE_Y|Ln.PICK_PLANE_Z);var kn,Zn,Un,Vn,Qn,Gn,Hn=function(){j.Z.call(this,j.Z.TRAVERSE_PARENTS),this._editableNode=null};a.Z.createPrototypeObject(Hn,a.Z.objectInherit(j.Z.prototype,{reset:function(){j.Z.prototype.reset.call(this),this._editableNode=null},getEditableNode:function(){return this._editableNode},apply:function(e){if(!this._editableNode){var t=e.editMask;t&&t&Ln.PICK_GIZMO?this._editableNode=e:this.traverse(e)}}})),a.Z.createPrototypeNode(Ln,a.Z.objectInherit(ze.Z.prototype,{setRotateInLocal:function(e){this._rotateInLocal=e},setTranslateInLocal:function(e){this._translateInLocal=e},setTraversalMask:function(e){this._tmask=e},setAutoMatrixTransformInsertion:function(e){this._autoInsertMT=e},setCorrectPivotOnAutoInsert:function(e){this._correctPivotOnAutoInsert=e},isEditing:function(){return this._isEditing},getAttachedNode:function(){return this._attachedNode},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new tn.Z(tn.Z.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new en.Z(en.Z.DISABLE)),this.addUpdateCallback(this),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(Nn.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var e=this._viewer.getInputManager();e.group(Bt.Z.NODE_GIZMO).addMappings({onMouseMove:"mousemove",onMouseDown:"mousedown",onMouseUp:["mouseup","mouseout"]},this),e.setPriority(Bt.Z.NODE_GIZMO,e.getHigherPriority(Bt.Z.MANIPULATORS))},_insertEditNode:function(e,t){var i=new ze.Z;return i.editMask=Ln.PICK_GIZMO,this._correctPivotOnAutoInsert&&(i.editMask|=Ln.CORRECT_PIVOT),e.addChild(i),e.removeChild(t),i.addChild(t),i._isInserted=!0,i},_findEditNodeFromNodePath:function(e){if(!e)return null;var t=e[e.length-1];if(t.editMask)return t;if(!this._autoInsertMT){for(var i=e.length-1;i>=0;--i){var n=e[i].editMask;if(n&&n&Ln.PICK_GIZMO)return e[i]}return null}var r=e[e.length-2];return r.editMask?r:this._insertEditNode(r,t)},_findEditNodeFromNode:function(e){if(!e)return null;if(e.editMask)return e;if(this._autoInsertMT){for(var t=e.getParents(),i=0;i<t.length;++i){var n=t[i].editMask;if(n&&n&Ln.PICK_GIZMO)return t[i]}return this._insertEditNode(t[0],e)}return this._getEditNodeVisitor?this._getEditNodeVisitor.reset():this._getEditNodeVisitor=new Hn,e.accept(this._getEditNodeVisitor),this._getEditNodeVisitor.getEditableNode()},attachToNodePath:function(e){var t=this._findEditNodeFromNodePath(e);this._attachEditNode(t,e&&e[e.length-1])},attachToNode:function(e){var t=this._findEditNodeFromNode(e);this._attachEditNode(t,e)},_attachEditNode:function(e,t){this._attachedNode=e,e&&t&&t!==e&&e.editMask&Ln.CORRECT_PIVOT&&o.R3.copy(this._pivotOffset,t.getBoundingSphere().center()),this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return o.R3.init(this._pivotOffset),void this.setNodeMask(0);var e=this._attachedNode.editMask;this.setNodeMask(e&Ln.PICK_GIZMO?Ln.NO_PICK:0),this._translateNode.setNodeMask(e&Ln.PICK_ARROW?Ln.PICK_ARROW:0),this._rotateNode.setNodeMask(e&Ln.PICK_ARC?Ln.PICK_ARC:0),this._planeNode.setNodeMask(e&Ln.PICK_PLANE?Ln.PICK_PLANE:0);var t=this._translateNode.getChildren();t[0].setNodeMask(e&Ln.PICK_ARROW_X?Ln.PICK_ARROW_X:0),t[1].setNodeMask(e&Ln.PICK_ARROW_Y?Ln.PICK_ARROW_Y:0),t[2].setNodeMask(e&Ln.PICK_ARROW_Z?Ln.PICK_ARROW_Z:0);var i=this._rotateNode.getChildren();i[0].setNodeMask(e&Ln.NO_FULL_CIRCLE?0:Ln.NO_PICK),i[1].setNodeMask(e&Ln.PICK_ARC_X?Ln.PICK_ARC_X:0),i[2].setNodeMask(e&Ln.PICK_ARC_Y?Ln.PICK_ARC_Y:0),i[3].setNodeMask(e&Ln.PICK_ARC_Z?Ln.PICK_ARC_Z:0);var n=this._planeNode.getChildren();n[0].setNodeMask(e&Ln.PICK_PLANE_X?Ln.PICK_PLANE_X:0),n[1].setNodeMask(e&Ln.PICK_PLANE_Y?Ln.PICK_PLANE_Y:0),n[2].setNodeMask(e&Ln.PICK_PLANE_Z?Ln.PICK_PLANE_Z:0)},onNodeHovered:(Gn=o.vh.fromValues(1,1,0,1),function(e){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),e){for(var t=e._nodePath,i=t.length-1,n=t[i];void 0===n._nbAxis;){if(0===i)return;n=t[--i]}var r=n.getStateSet().getUniform("uColor");this._hoverNode=n,o.vh.copy(this._keepHoverColor,r.getInternalArray()),r.setFloat4(Gn)}else this._hoverNode=null}),initNodeRotate:function(){var e=Nn.createTorusGeometry(1,.01,6,64,2*Math.PI),t=Nn.createTorusGeometry(1,.01,6,64,Math.PI),i=Nn.createTorusGeometry(1,.1,6,64,Math.PI),n=new ze.Z,r=new ze.Z,a=new ze.Z,s=new ze.Z;r._nbAxis=0,a._nbAxis=1,s._nbAxis=2;var l=new Je.Z;l.setCullCallback(new Dn),l.addChild(i),e.setNodeMask(Ln.NO_PICK),t.setNodeMask(Ln.NO_PICK),r.setNodeMask(Ln.PICK_ARC_X),a.setNodeMask(Ln.PICK_ARC_Y),s.setNodeMask(Ln.PICK_ARC_Z),n.addChild(e),r.addChild(t),a.addChild(t),s.addChild(t),r.addChild(l),a.addChild(l),s.addChild(l),n.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(.2,.2,.2,1),"uColor")),r.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(1,0,0,1),"uColor")),a.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(0,1,0,1),"uColor")),s.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(0,0,1,1),"uColor"));var u=this._showAngle;u.getOrCreateStateSet().setAttributeAndModes(Pn),u.setNodeMask(0),u.getOrCreateStateSet().addUniform(nn.Z.createFloat3(o.R3.fromValues(1,0,0),"uBase")),u.getOrCreateStateSet().addUniform(nn.Z.createFloat(0,"uAngle")),u.addChild(Nn.createQuadCircleGeometry());var h=this._rotateNode;return h.setNodeMask(Ln.PICK_ARC),h.addChild(n),h.addChild(r),h.addChild(a),h.addChild(s),h.addChild(u),h},initNodeTranslate:function(){var e=1.5,t=1.3*1.1,i=new ze.Z;o._E.fromTranslation(i.getMatrix(),o.R3.fromValues(0,0,1.65)),i.addChild(Nn.createCylinderGeometry(0,.07,.3,32,1,!0,!0));var n=new ze.Z;o._E.fromTranslation(n.getMatrix(),o.R3.fromValues(0,0,.75)),n.addChild(Nn.createCylinderGeometry(.01,.01,e,32,1,!0,!0));var r=new Je.Z;r.addChild(n),r.addChild(i);var a=Nn.createCylinderGeometry(.1,.1,t,32,1,!0,!0),s=new ze.Z,l=new ze.Z,u=new ze.Z;s._nbAxis=0,l._nbAxis=1,u._nbAxis=2,o._E.fromRotation(s.getMatrix(),.5*Math.PI,o.R3.fromValues(0,1,0)),o._E.fromRotation(l.getMatrix(),.5*-Math.PI,o.R3.fromValues(1,0,0));var h=new ze.Z;h.setCullCallback(new Dn),o._E.fromTranslation(h.getMatrix(),o.R3.fromValues(0,0,1.215)),h.addChild(a),r.setNodeMask(Ln.NO_PICK),s.setNodeMask(Ln.PICK_ARROW_X),l.setNodeMask(Ln.PICK_ARROW_Y),u.setNodeMask(Ln.PICK_ARROW_Z),s.addChild(r),l.addChild(r),u.addChild(r),s.addChild(h),l.addChild(h),u.addChild(h),s.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(1,0,0,1),"uColor")),l.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(0,1,0,1),"uColor")),u.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(0,0,1,1),"uColor"));var c=this._translateNode;return c.setNodeMask(Ln.PICK_ARROW),c.addChild(s),c.addChild(l),c.addChild(u),c},initNodeTranslatePlane:function(){var e=new ze.Z;o._E.fromTranslation(e.getMatrix(),o.R3.fromValues(.5,.5,0)),o._E.mul(e.getMatrix(),o._E.fromScaling(o._E.create(),o.R3.fromValues(.5,.5,1)),e.getMatrix()),e.addChild(Nn.createPlaneGeometry());var t=new ze.Z,i=new ze.Z,n=new ze.Z;t._nbAxis=0,i._nbAxis=1,n._nbAxis=2,o._E.fromRotation(t.getMatrix(),.5*-Math.PI,o.R3.fromValues(0,1,0)),o._E.fromRotation(i.getMatrix(),.5*Math.PI,o.R3.fromValues(1,0,0)),t.setNodeMask(Ln.PICK_PLANE_X),i.setNodeMask(Ln.PICK_PLANE_Y),n.setNodeMask(Ln.PICK_PLANE_Z),t.addChild(e),i.addChild(e),n.addChild(e),t.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(1,0,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(0,1,0,.3),"uColor")),n.getOrCreateStateSet().addUniform(nn.Z.createFloat4(o.vh.fromValues(0,0,1,.3),"uColor"));var r=this._planeNode;return r.setNodeMask(Ln.PICK_PLANE),r.getOrCreateStateSet().setAttributeAndModes(Pn),r.addChild(t),r.addChild(i),r.addChild(n),r},updateArcRotation:(Un=o.gf.create(),Vn=o.gf.setAxisAngle(o.gf.create(),[0,1,0],.5*-Math.PI),Qn=o.gf.setAxisAngle(o.gf.create(),[1,0,0],.5*-Math.PI),function(e){var t=this._rotateNode.getChildren();Un[0]=-e[1],Un[1]=e[0],Un[2]=0,Un[3]=1+e[2],o.gf.normalize(Un,Un),o._E.fromQuat(t[0].getMatrix(),Un),o.gf.setAxisAngle(Un,[1,0,0],Math.atan2(e[2],e[1])),o.gf.mul(Un,Un,Vn),o._E.fromQuat(t[1].getMatrix(),Un),o.gf.setAxisAngle(Un,[0,1,0],Math.atan2(-e[0],-e[2])),o.gf.mul(Un,Un,Qn),o._E.fromQuat(t[2].getMatrix(),Un),o.gf.setAxisAngle(Un,[0,0,1],Math.atan2(-e[0],e[1])),o._E.fromQuat(t[3].getMatrix(),Un),t[1].dirtyBound(),t[2].dirtyBound(),t[3].dirtyBound()}),getTransformType:function(e){for(var t=e;t.getParents().length>0;){var i=t.referenceFrame;if(void 0!==i&&i===De.Z.ABSOLUTE_RF)return De.Z.ABSOLUTE_RF;t=t.getParents()[0]}return De.Z.RELATIVE_RF},getAttachedNodeWorldMatrix:function(){var e=this._attachedNode.getWorldMatrix(void 0,On);return o._E.translate(e,e,this._pivotOffset)},update:function(){var e=o.R3.create(),t=o.R3.create(),i=o.R3.create(),n=o._E.create();return function(){if(this._attachedNode){var r=this.getTransformType(this._attachedNode);this.setReferenceFrame(r),this.setCullingActive(r===De.Z.RELATIVE_RF);var a=this.getAttachedNodeWorldMatrix();o._E.getTranslation(t,a);var s=3;if(r===De.Z.ABSOLUTE_RF)e[0]=e[1]=e[2]=0;else{var l=this._viewer.getCamera().getProjectionMatrix(),u=.023*this._canvas.clientWidth*l[0];this._viewer.getManipulator().getEyePosition(e),this._lastDistToEye=this._isEditing?this._lastDistToEye:o.R3.distance(t,e),s*=this._lastDistToEye/u}var h=this.getMatrix();if(o._E.fromTranslation(h,t),o.R3.set(i,s,s,s),o._E.mul(h,h,o._E.fromScaling(n,i)),o.R3.sub(e,e,t),o.R3.normalize(e,e),this._rotateInLocal||this._translateInLocal){o._E.getScale(i,a);var c=o._E.fromScaling(n,i);o._E.invert(c,c);var A=o._E.mul(a,a,c);A[12]=A[13]=A[14]=0,this._translateInLocal&&(o._E.copy(this._translateNode.getMatrix(),A),o._E.copy(this._planeNode.getMatrix(),A)),this._rotateInLocal&&(o._E.copy(this._rotateNode.getMatrix(),A),o._E.invert(A,A),o.R3.transformMat4(e,e,A))}else o._E.identity(this._rotateNode.getMatrix());this.updateArcRotation(e),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&o._E.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}}(),computeNearestIntersection:(Zn=function(e,t){return e._ratio-t._ratio},function(e,t){var i=this._viewer,n=this._canvas,r=e.canvasX*(i._canvasWidth/n.clientWidth),a=(n.clientHeight-e.canvasY)*(i._canvasHeight/n.clientHeight),o=this._viewer.computeIntersections(r,a,t);if(0!==o.length)return o.sort(Zn),o[0]}),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(Ln.NO_PICK)},pickGizmo:function(e,t){this.setOnlyGizmoPicking();var i=this.computeNearestIntersection(e,t);return this.setOnlyScenePicking(),i},getCanvasPositionFromWorldPoint:(kn=o._E.create(),function(e,t){var i=this._viewer.getCamera(),n=t;i.getViewport()?i.getViewport().computeWindowMatrix(kn):o._E.identity(kn),o._E.mul(kn,kn,i.getProjectionMatrix()),this.getReferenceFrame()===De.Z.RELATIVE_RF&&o._E.mul(kn,kn,i.getViewMatrix()),o.R3.transformMat4(n,e,kn);var r=this._viewer,a=this._canvas;return n[0]=n[0]/(r._canvasWidth/a.clientWidth),n[1]=a.clientHeight-n[1]/(r._canvasHeight/a.clientHeight),n}),onMouseDown:function(e){if(o.K4.set(this._downCanvasCoord,e.canvasX,e.canvasY),this._hoverNode&&this._attachedNode){this._viewer.setEnableManipulator(!1),this.saveEditMatrices();var t=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,t&Ln.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(e)):t&Ln.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(e)):t&Ln.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(e))}},saveEditMatrices:function(){o._E.copy(this._editLocal,this._attachedNode.getMatrix());var e=this.getAttachedNodeWorldMatrix();o._E.fromTranslation(this._editWorldTrans,o.R3.fromValues(e[12],e[13],e[14])),o._E.copy(this._editWorldScaleRot,e),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,o._E.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(e){var t=this._rotateNode.getWorldMatrix(void 0,On),i=o.R3.create();o.R3.transformMat4(i,i,t),this.getCanvasPositionFromWorldPoint(i,i);var n=this.pickGizmo(e,this._hoverNode.getNodeMask()|Ln.PICK_ARC);if(n){var r=0===this._hoverNode._nbAxis?-1:1,a=o.R3.create();a[0]=r*n._localIntersectionPoint[1],a[1]=-r*n._localIntersectionPoint[0],a[2]=n._localIntersectionPoint[2];var s=o.R3.create();o.R3.transformMat4(s,a,this._hoverNode.getMatrix()),o.R3.transformMat4(s,s,t),this.getCanvasPositionFromWorldPoint(s,s);var l=this._editLineDirection;o.K4.sub(l,s,i),o.K4.normalize(l,l),this._showAngle.setNodeMask(Ln.NO_PICK),n._localIntersectionPoint[2]=0;var u=this._showAngle.getStateSet();u.getUniform("uAngle").setFloat(0),u.getUniform("uBase").setVec3(o.R3.normalize(n._localIntersectionPoint,n._localIntersectionPoint)),this._editLineOrigin[0]=e.canvasX,this._editLineOrigin[1]=e.canvasY}},startTranslateEdit:function(e){var t=this._editLineOrigin,i=this._editLineDirection,n=this._translateNode.getWorldMatrix(void 0,On);o._E.getTranslation(t,n),o.R3.init(i),i[this._hoverNode._nbAxis]=1,this._translateInLocal&&(o.R3.transformMat4(i,i,this._editWorldScaleRot),o.R3.normalize(i,i)),o.R3.add(i,t,i),this.getCanvasPositionFromWorldPoint(t,t),this.getCanvasPositionFromWorldPoint(i,i),o.K4.sub(i,i,t),o.K4.normalize(i,i);var r=this._editOffset;o.K4.set(r,e.canvasX,e.canvasY),o.K4.sub(r,r,t)},startPlaneEdit:function(e){var t=this._editLineOrigin,i=this._planeNode.getWorldMatrix(void 0,On);o._E.getTranslation(t,i),this.getCanvasPositionFromWorldPoint(t,t);var n=this._editOffset;o.K4.set(n,e.canvasX,e.canvasY),o.K4.sub(n,n,t)},drawLineCanvasDebug:function(e,t,i,n){this._debugNode.setNodeMask(Ln.NO_PICK);var r=this._debugNode.getChildren()[0].getAttributes().Vertex;r.getElements()[0]=e/this._canvas.clientWidth*2-1,r.getElements()[1]=(this._canvas.clientHeight-t)/this._canvas.clientHeight*2-1,r.getElements()[2]=i/this._canvas.clientWidth*2-1,r.getElements()[3]=(this._canvas.clientHeight-n)/this._canvas.clientHeight*2-1,r.dirty()},pickAndSelect:function(e){this.setNodeMask(0);var t=this.computeNearestIntersection(e,this._tmask);this.attachToNodePath(t?t._nodePath:t)},onMouseUp:function(e){this._viewer.setEnableManipulator(!0),this._debugNode&&this._debugNode.setNodeMask(0);var t=o.K4.fromValues(e.canvasX,e.canvasY);0===o.K4.distance(t,this._downCanvasCoord)&&this.pickAndSelect(e),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(e){if(this._attachedNode){var t;if(!1===this._isEditing)return t=this.pickGizmo(e,Ln.PICK_GIZMO),void this.onNodeHovered(t);if(this._hoverNode){var i=this._hoverNode.getParents()[0];i===this._rotateNode?this.updateRotateEdit(e):i===this._translateNode?this.updateTranslateEdit(e):i===this._planeNode&&this.updatePlaneEdit(e)}}},updateRotateEdit:function(){var e=o._E.create(),t=o.K4.create(),i=o.R3.fromValues(1,0,0),n=o.R3.fromValues(0,1,0),r=o.R3.fromValues(0,0,1),a=o.R3.create();return function(s){var l=this._editLineOrigin,u=this._editLineDirection;o.K4.set(t,s.canvasX,s.canvasY),o.K4.sub(t,t,l);var h=o.K4.dot(t,u);if(this._debugNode){var c=l[0],A=l[1];this.drawLineCanvasDebug(c,A,c+u[0]*h,A+u[1]*h)}var d=7*h/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);d%=2*Math.PI;var g=this._hoverNode._nbAxis;0===g?o._E.fromRotation(e,-d,i):1===g?o._E.fromRotation(e,-d,n):2===g&&o._E.fromRotation(e,-d,r),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===g?-d:d),this._rotateInLocal||(o._E.mul(e,this._editInvWorldScaleRot,e),o._E.mul(e,e,this._editWorldScaleRot));var f=this._attachedNode.getMatrix();o._E.translate(f,this._editLocal,this._pivotOffset),o._E.mul(f,f,e),o._E.translate(f,f,o.R3.negate(a,this._pivotOffset)),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var e=o.K4.create(),t=o.R3.create();return function(i){var n=this._editLineOrigin,r=this._editLineDirection;o.K4.set(e,i.canvasX,i.canvasY),o.K4.sub(e,e,n),o.K4.sub(e,e,this._editOffset);var a=o.K4.dot(e,r);e[0]=n[0]+r[0]*a,e[1]=n[1]+r[1]*a,this._debugNode&&this.drawLineCanvasDebug(n[0],n[1],e[0],e[1]);var s=this._viewer,l=this._canvas,u=e[0]*(s._canvasWidth/l.clientWidth),h=(l.clientHeight-e[1])*(s._canvasHeight/l.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(o.R3.set(this._origIntersect,u,h,0),o.R3.set(this._dstIntersect,u,h,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),o._E.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){o._E.getScale(t,this._editInvWorldScaleRot);var c=this._lsi.getTranslateDistance();o.R3.mul(t,t,c)}else o.R3.transformMat4(t,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);o._E.translate(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var e=o.K4.create(),t=o.R3.create();return function(i){o.K4.set(e,i.canvasX,i.canvasY),o.K4.sub(e,e,this._editOffset);var n=this._viewer,r=this._canvas,a=e[0]*(n._canvasWidth/r.clientWidth),s=(r.clientHeight-e[1])*(n._canvasHeight/r.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(o.R3.set(this._origIntersect,a,s,0),o.R3.set(this._dstIntersect,a,s,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),o._E.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){o._E.getScale(t,this._editInvWorldScaleRot);var l=this._lsi.getTranslateDistance();o.R3.mul(t,t,l)}else o.R3.transformMat4(t,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);o._E.translate(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}()}),"osgUtil","NodeGizmo");const zn=Ln;var Wn,jn,qn,Jn=function(){pt.Z.Intersection.call(this),this._localIntersectionNormal=o.R3.clone(o.R3.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},Yn=function(){pt.Z.apply(this),this._center=void 0,this._radius=0};a.Z.createPrototypeObject(Yn,a.Z.objectInherit(pt.Z.prototype,{set:function(e,t){this._center=e,this._radius=t},enter:function(e){for(var t=this._radius*this._radius,i=0,n=e.getMin(),r=e.getMax(),a=0,o=0;o<3;o++)this._center[o]<n[o]?i+=(a=this._center[o]-n[o])*a:this._center[o]>r[o]&&(i+=(a=this._center[o]-r[o])*a);return i<=t},intersectPoint:function(e,t){var i=o.R3.sqrDist(e,this._center);if(!(i>this._radius*this._radius)){var n=this.initIntersection(new Jn);n._i1=t,n._r1=1,o.R3.copy(n._localIntersectionPoint,e),n._ratio=Math.sqrt(i)/this._radius}},intersectLine:function(){var e=o.R3.create(),t=o.R3.create();return function(i,n,r,a){o.R3.sub(e,this._center,i),o.R3.sub(t,n,i);var s=o.R3.dot(e,t)/o.R3.sqrLen(t),l=1;if(!((l=s<0?o.R3.sqrLen(e):s>1?o.R3.sqrDist(this._center,n):o.R3.sqrLen(o.R3.scaleAndAdd(e,e,t,-s)))>this._radius*this._radius)){var u=this.initIntersection(new Jn);u._i1=r,u._i2=a,u._r1=1-s,u._r2=s,o.R3.scaleAndAdd(u._localIntersectionPoint,i,t,s),u._ratio=Math.sqrt(l)/this._radius}}}(),intersectTriangle:(Wn=o.R3.create(),jn=o.R3.create(),qn=o.R3.create(),function(e,t,i,n,r,a){if(!this._limitOneIntersection||!this._hit){o.R3.sub(Wn,t,e),o.R3.sub(jn,i,e);var s=o.R3.sqrLen(Wn),l=o.R3.dot(Wn,jn),u=o.R3.sqrLen(jn);o.R3.sub(qn,e,this._center);var h=o.R3.dot(qn,Wn),c=o.R3.dot(qn,jn),A=o.R3.sqrLen(qn),d=Math.abs(s*u-l*l);if(!(d<1e-10)){var g,f,p,m,_,v=l*c-u*h,C=l*h-s*c,b=4;if(v+C<=d)if(v<0)C<0?(b=4,h<0?(C=0,-h>=s?(v=1,g=s+2*h+A):g=h*(v=-h/s)+A):(v=0,c>=0?(C=0,g=A):-c>=u?(C=1,g=u+2*c+A):g=c*(C=-c/u)+A)):(b=3,v=0,c>=0?(C=0,g=A):-c>=u?(C=1,g=u+2*c+A):g=c*(C=-c/u)+A);else if(C<0)b=5,C=0,h>=0?(v=0,g=A):-h>=s?(v=1,g=s+2*h+A):g=h*(v=-h/s)+A;else{b=0;var S=1/d;g=(v*=S)*(s*v+l*(C*=S)+2*h)+C*(l*v+u*C+2*c)+A}else v<0?(b=2,(p=u+c)>(f=l+h)?(m=p-f)>=(_=s-2*l+u)?(v=1,C=0,g=s+2*h+A):g=(v=m/_)*(s*v+l*(C=1-v)+2*h)+C*(l*v+u*C+2*c)+A:(v=0,p<=0?(C=1,g=u+2*c+A):c>=0?(C=0,g=A):g=c*(C=-c/u)+A)):C<0?(b=6,(p=s+h)>(f=l+c)?(m=p-f)>=(_=s-2*l+u)?(C=1,v=0,g=u+2*c+A):g=(v=1-(C=m/_))*(s*v+l*C+2*h)+C*(l*v+u*C+2*c)+A:(C=0,p<=0?(v=1,g=s+2*h+A):h>=0?(v=0,g=A):g=h*(v=-h/s)+A)):(b=1,(m=u+c-l-h)<=0?(v=0,C=1,g=u+2*c+A):m>=(_=s-2*l+u)?(v=1,C=0,g=s+2*h+A):g=(v=m/_)*(s*v+l*(C=1-v)+2*h)+C*(l*v+u*C+2*c)+A);if(!(g>this._radius*this._radius)){var E=o.R3.create(),y=this.initIntersection(new Jn);y._i1=n,y._i2=r,y._i3=a,y._r1=1-v-C,y._r2=v,y._r3=C;var I=y._localIntersectionPoint;o.R3.scaleAndAdd(I,o.R3.scaleAndAdd(I,e,Wn,v),jn,C),o.R3.cross(y._localIntersectionNormal,Wn,jn),o.R3.normalize(E,y._localIntersectionNormal),y._ratio=Math.sqrt(g)/this._radius,y._zone=b}}}})}),"osgUtil","SphereIntersectFunctor");const Kn=Yn;var Xn=function(){ft.Z.call(this),this._center=o.R3.create(),this._iCenter=o.R3.create(),this._radius=1,this._iRadius=1};a.Z.createPrototypeObject(Xn,a.Z.objectInherit(ft.Z.prototype,{set:function(e,t){o.R3.copy(this._center,e),o.R3.copy(this._iCenter,e),this._radius=this._iRadius=t,this.reset()},setCenter:function(e){o.R3.copy(this._center,e),o.R3.copy(this._iCenter,e)},setRadius:function(e){this._radius=this._iRadius=e},intersectNode:function(e){return this.intersectBoundingSphere(e.getBoundingSphere())},intersectBoundingSphere:function(e){if(!e.valid())return!1;var t=this._iRadius+e.radius();return o.R3.sqrDist(e.center(),this._iCenter)<=t*t},intersect:function(){var e=new Kn;return function(t,i){e.setGeometry(i),e.setIntersectionVisitor(t),e.setIntersector(this),e.set(this._iCenter,this._iRadius);var n=i.getShape();n?n.intersect(e,n.getNodes()[0]):(i.computeTransformedVertices&&e.setVertices(i.computeTransformedVertices()),e.apply(i)),e.reset()}}(),setCurrentTransformation:function(){var e=o.R3.create();return function(t){o._E.invert(t,t),o.R3.transformMat4(this._iCenter,this._center,t),o._E.getScale(e,t);var i=e[0],n=e[1],r=e[2],a=i>n?i>r?i:r:n>r?n:r;this._iRadius=this._radius*a}}()}),"osgUtil","SphereIntersector");const $n=Xn;var er=function(){j.Z.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};a.Z.createPrototypeObject(er,a.Z.objectInherit(j.Z.prototype,{apply:function(e){e.getTypeID()===Le.Z.getTypeID()?this.generate(e,this._texCoordUnit):this.traverse(e)},setTexCoordUnit:function(e){this._texCoordUnit=e},computePrimitiveSet:function(e,t){if(t.getIndices){var i,n=t.getNumIndices(),r=e.getAttributes().Vertex,a=e.getAttributes().Normal,o=e.getAttributes()["TexCoord"+this._texCoordUnit];if(t.getMode()===pn.Z.TRIANGLES)for(i=0;i<n;i+=3)this.compute(t,r,a,o,i,i+1,i+2);else if(t.getMode()===pn.Z.TRIANGLE_STRIP)for(i=0;i<n-2;++i)i%2==0?this.compute(t,r,a,o,i,i+1,i+2):this.compute(t,r,a,o,i+1,i,i+2)}},generate:function(e,t){if(this._texCoordUnit=t,void 0===this._texCoordUnit&&(this._texCoordUnit=0),e.getAttributes()["TexCoord"+this._texCoordUnit]){var i=e.getAttributes().Vertex.getElements().length;this._T=new a.Z.Float32Array(i),this._B=new a.Z.Float32Array(i),this._N=new a.Z.Float32Array(i),e.getPrimitiveSetList().forEach((function(t){this.computePrimitiveSet(e,t)}),this);for(var n=i/3,r=new a.Z.Float32Array(4*n),s=o.R3.create(),l=o.R3.create(),u=o.R3.create(),h=0;h<n;h++){var c=this._T.subarray(3*h,3*h+3),A=this._N.subarray(3*h,3*h+3),d=this._B.subarray(3*h,3*h+3);o.R3.normalize(A,A);var g=o.R3.dot(A,c);o.R3.scale(l,A,g),o.R3.sub(s,c,l),o.R3.normalize(u,s),o.R3.cross(s,A,c);var f=o.R3.dot(s,d);f=f<0?-1:0,r[4*h]=u[0],r[4*h+1]=u[1],r[4*h+2]=u[2],r[4*h+3]=f}e.getAttributes().Normal.setElements(this._N),e.getAttributes().Tangent=new Y.Z("ARRAY_BUFFER",r,4)}},compute:function(e,t,i,n,r,a,s){var l,u,h=e.index(r),c=e.index(a),A=e.index(s),d=t.getElements().subarray(3*h,3*h+3),g=t.getElements().subarray(3*c,3*c+3),f=t.getElements().subarray(3*A,3*A+3),p=i.getElements().subarray(3*h,3*h+3),m=i.getElements().subarray(3*c,3*c+3),_=i.getElements().subarray(3*A,3*A+3),v=n.getElements().subarray(2*h,2*h+2),C=n.getElements().subarray(2*c,2*c+2),b=n.getElements().subarray(2*A,2*A+2),S=o.R3.create(),E=o.R3.create(),y=o.R3.create(),I=o.R3.create(),x=o.R3.create(),T=o.R3.create(),w=o.R3.create(),M=o.R3.create(),R=o.R3.create();o.R3.set(M,g[0]-d[0],C[0]-v[0],C[1]-v[1]),o.R3.set(R,f[0]-d[0],b[0]-v[0],b[1]-v[1]),o.R3.cross(S,M,R),0!==S[0]&&(o.R3.normalize(S,S),u=-S[1]/S[0],l=-S[2]/S[0],x[0]+=u,E[0]+=l,T[0]+=u,y[0]+=l,w[0]+=u,I[0]+=l),o.R3.set(M,g[1]-d[1],C[0]-v[0],C[1]-v[1]),o.R3.set(R,f[1]-d[1],b[0]-v[0],b[1]-v[1]),o.R3.cross(S,M,R),0!==S[0]&&(o.R3.normalize(S,S),u=-S[1]/S[0],l=-S[2]/S[0],x[1]+=u,E[1]+=l,T[1]+=u,y[1]+=l,w[1]+=u,I[1]+=l),o.R3.set(M,g[2]-d[2],C[0]-v[0],C[1]-v[1]),o.R3.set(R,f[2]-d[2],b[0]-v[0],b[1]-v[1]),o.R3.cross(S,M,R),0!==S[0]&&(o.R3.normalize(S,S),u=-S[1]/S[0],l=-S[2]/S[0],x[2]+=u,E[2]+=l,T[2]+=u,y[2]+=l,w[2]+=u,I[2]+=l);var B,N,D,P=o.R3.create(),F=o.R3.create();o.R3.cross(P,p,x),o.R3.cross(F,P,p),B=this._T.subarray(3*h,3*h+3),o.R3.add(B,F,B),o.R3.cross(P,E,p),o.R3.cross(F,p,P),N=this._B.subarray(3*h,3*h+3),o.R3.add(N,F,N),o.R3.cross(P,m,T),o.R3.cross(F,P,m),B=this._T.subarray(3*c,3*c+3),o.R3.add(B,F,B),o.R3.cross(P,y,m),o.R3.cross(F,m,P),N=this._B.subarray(3*c,3*c+3),o.R3.add(N,F,N),o.R3.cross(P,_,w),o.R3.cross(F,P,_),B=this._T.subarray(3*A,3*A+3),o.R3.add(B,F,B),o.R3.cross(P,I,_),o.R3.cross(F,_,P),N=this._B.subarray(3*A,3*A+3),o.R3.add(N,F,N),D=this._N.subarray(3*h,3*h+3),o.R3.add(D,p,D),D=this._N.subarray(3*c,3*c+3),o.R3.add(D,m,D),D=this._N.subarray(3*A,3*A+3),o.R3.add(D,_,D)}}),"osgUtil","TangentSpaceGenerator");const tr=er;var ir=i("Heae"),nr={},rr=function(e,t,i,n,r){this._viewer=e,this._rttScene=t,this._hmdConfig=i,this._root=n,this._canvas=r,this._width=r.width,this._height=r.height};rr.prototype={update:function(){var e=this._canvas,t=e.width,i=e.height;if(t!==this._width||i!==this._height){this._root.removeChildren();var n=this._hmdConfig;n&&n.isCardboard&&(n.hResolution=t,n.vResolution=i),this._width=t,this._height=i,nr.createScene(this._viewer,this._rttScene,n,this._root)}return!0}};var ar=function(e,t){this._rootView=e,this._offsetView=t};ar.prototype={update:function(e){var t=e.getViewMatrix();return o._E.mul(t,this._offsetView,this._rootView),!0}};var or=function(e){var t=new je.Z;return t.setTextureSize(e[0],e[1]),t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR"),t},sr=function(e,t,i,n,r,a){var s=new an.Z,l=t[0],u=t[1],h=i[0],c=i[1];!0===n?e?s.setViewport(new sn.Z(0,0,h/2,c)):s.setViewport(new sn.Z(h/2,0,h/2,c)):e?s.setViewport(new sn.Z(.5*h-l,.5*(c-u),l,u)):s.setViewport(new sn.Z(.5*h,.5*(c-u),l,u)),o._E.ortho(s.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),s.setRenderOrder(an.Z.NESTED_RENDER,0),s.setReferenceFrame(ir.Z.ABSOLUTE_RF);var A,d=s.getOrCreateStateSet();return d.setTextureAttributeAndModes(0,r),d.setAttributeAndModes((A=["uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n"),new ln.Z(new un.Z(un.Z.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new un.Z(un.Z.FRAGMENT_SHADER,A)))),d.addUniform(nn.Z.createFloat2(a.scale,"uScale")),d.addUniform(nn.Z.createFloat2(a.scaleIn,"uScaleIn")),d.addUniform(nn.Z.createFloat2(e?a.lensCenterLeft:a.lensCenterRight,"uLensCenter")),d.addUniform(nn.Z.createFloat4(a.hmdWarpParam,"uHmdWarpParam")),d.addUniform(nn.Z.createFloat4(a.chromAbParam,"uChromAbParam")),s},lr=function(e,t){var i=new an.Z;return i.setName("rtt camera"),i.setViewport(new sn.Z(0,0,e.getWidth(),e.getHeight())),i.setProjectionMatrix(t),i.setClearColor(o.vh.fromValues(.3,.3,.3,0)),i.setRenderOrder(an.Z.POST_RENDER,0),i.attachTexture(on.Z.COLOR_ATTACHMENT0,e),i.attachRenderBuffer(on.Z.DEPTH_ATTACHMENT,on.Z.DEPTH_COMPONENT16),i.setReferenceFrame(ir.Z.ABSOLUTE_RF),i};nr.createScene=function(e,t,i,n,r){var a=nr.getDefaultConfig(i),s=o.K4.fromValues(.5*a.hResolution,a.vResolution),l=o.K4.fromValues(.5*a.hResolution,a.vResolution),u=e.getCamera().getViewport(),h=o.K4.fromValues(u.width(),u.height()),c=e.getGraphicContext().canvas;a.isCardboard&&(h[0]=c.width,h[1]=c.height);var A={},d={};!function(e,t,i,n){var r=t.hResolution/(2*t.vResolution),a=-1-4*(.25*t.hScreenSize-.5*t.lensSeparationDistance)/t.hScreenSize,s=t.distortionK[0]+t.distortionK[1]*Math.pow(a,2)+t.distortionK[2]*Math.pow(a,4)+t.distortionK[3]*Math.pow(a,6),l=180/Math.PI*2*Math.atan2(t.vScreenSize*s,2*t.eyeToScreenDistance),u=o._E.perspective(o._E.create(),Math.PI/180*l,r,.3,1e4),h=4*(.25*t.hScreenSize-.5*t.interpupillaryDistance)/t.hScreenSize,c=4*(.25*t.hScreenSize-.5*t.lensSeparationDistance)/t.hScreenSize,A=o._E.create(),d=o._E.create();n.projectionLeft=o._E.mul(A,o._E.fromTranslation(A,o.R3.fromValues(h,0,0)),u),n.projectionRight=o._E.mul(d,o._E.fromTranslation(d,o.R3.fromValues(-h,0,0)),u),n.viewLeft=o._E.fromTranslation(o._E.create(),o.R3.fromValues(e*t.interpupillaryDistance*.5,0,0)),n.viewRight=o._E.fromTranslation(o._E.create(),o.R3.fromValues(-e*t.interpupillaryDistance*.5,0,0)),i.lensCenterLeft=o.K4.fromValues(c,0),i.lensCenterRight=o.K4.fromValues(-c,0),i.hmdWarpParam=t.distortionK,i.chromAbParam=t.chromaAbParameter,i.scaleIn=o.K4.fromValues(1,1/r),i.scale=o.K4.fromValues(1/s,1*r/s)}(void 0!==r?r:1,a,A,d);var g=e.getCamera().getViewMatrix(),f=n||new Je.Z;f.addUpdateCallback(new rr(e,t,i,f,c));var p=or(s),m=lr(p,d.projectionLeft),_=sr(!0,l,h,a.isCardboard,p,A);m.addUpdateCallback(new ar(g,d.viewLeft));var v=or(s),C=lr(v,d.projectionRight),b=sr(!1,l,h,a.isCardboard,v,A);return C.addUpdateCallback(new ar(g,d.viewRight)),m.addChild(t),C.addChild(t),_.addChild(We.Z.createTexturedFullScreenFakeQuadGeometry()),b.addChild(We.Z.createTexturedFullScreenFakeQuadGeometry()),f.addChild(m),f.addChild(C),f.addChild(_),f.addChild(b),f},nr.getDefaultConfig=function(e){var t={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:o.vh.fromValues(1,.22,.13,.02),chromaAbParameter:o.vh.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===e||void 0===e?t:1===e?(t.hResolution=1280,t.vResolution=800,t.hScreenSize=.14976,t.vScreenSize=.0936,t.lensSeparationDistance=.064,t.eyeToScreenDistance=.041,t.distortionK=o.vh.fromValues(1,.22,.24,0),t):(void 0!==e.hResolution&&(t.hResolution=e.hResolution),void 0!==e.vResolution&&(t.vResolution=e.vResolution),void 0!==e.hScreenSize&&(t.hScreenSize=e.hScreenSize),void 0!==e.vScreenSize&&(t.vScreenSize=e.vScreenSize),void 0!==e.interpupillaryDistance&&(t.interpupillaryDistance=e.interpupillaryDistance),void 0!==e.lensSeparationDistance&&(t.lensSeparationDistance=e.lensSeparationDistance),void 0!==e.eyeToScreenDistance&&(t.eyeToScreenDistance=e.eyeToScreenDistance),void 0!==e.distortionK&&(t.distortionK=e.distortionK),void 0!==e.chromaAbParameter&&(t.chromaAbParameter=e.chromaAbParameter),void 0!==e.isCardboard&&(t.isCardboard=e.isCardboard),t)};const ur=nr;var hr=function(e,t){this._rootView=e,this._offsetView=t};hr.prototype={update:function(e){var t=e.getViewMatrix();return o._E.mul(t,this._offsetView,this._rootView),!0}};var cr=function(e){var t=new je.Z;return t.setTextureSize(e.width,e.height),t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR"),t},Ar=function(e,t,i){var n=new an.Z;n.setViewport(i),n.setRenderOrder(an.Z.NESTED_RENDER,0),n.setReferenceFrame(ir.Z.ABSOLUTE_RF),o._E.ortho(n.getProjectionMatrix(),0,1,0,1,-5,5);var r,a=n.getOrCreateStateSet();return a.addUniform(nn.Z.createInt(0,"TextureLeft")),a.addUniform(nn.Z.createInt(1,"TextureRight")),a.setTextureAttributeAndModes(0,e),a.setTextureAttributeAndModes(1,t),a.setAttributeAndModes((r=["varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n"),new ln.Z(new un.Z(un.Z.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new un.Z(un.Z.FRAGMENT_SHADER,r)))),n.addChild(We.Z.createTexturedFullScreenFakeQuadGeometry()),n},dr=function(e,t){var i=new an.Z;return i.setName("rtt camera"),i.setViewport(new sn.Z(0,0,e.getWidth(),e.getHeight())),i.setProjectionMatrix(t),i.setClearColor(o.vh.fromValues(.3,.3,.3,0)),i.setRenderOrder(an.Z.POST_RENDER,0),i.attachTexture(on.Z.COLOR_ATTACHMENT0,e),i.attachRenderBuffer(on.Z.DEPTH_ATTACHMENT,on.Z.DEPTH_COMPONENT16),i.setReferenceFrame(ir.Z.ABSOLUTE_RF),i},gr={createScene:function(e,t,i,n,r){var a=n||new Je.Z;return i.requestAnimationFrame((function(){var n=void 0!==r?r:1,s=i.getEyeParameters("left"),l=i.getEyeParameters("right"),u=new window.VRFrameData;i.getFrameData(u);var h=o._E.fromTranslation(o._E.create(),o.R3.fromValues(-n*s.offset[0],s.offset[1],s.offset[2])),c=o._E.fromTranslation(o._E.create(),o.R3.fromValues(-n*l.offset[0],l.offset[1],l.offset[2])),A={width:Math.max(s.renderWidth,l.renderWidth),height:Math.max(s.renderHeight,l.renderHeight)},d=cr(A),g=cr(A),f=dr(d,u.leftProjectionMatrix),p=dr(g,u.rightProjectionMatrix),m=e.getCamera().getViewMatrix();f.addUpdateCallback(new hr(m,h)),p.addUpdateCallback(new hr(m,c));var _=Ar(d,g,e.getCamera().getViewport());f.addChild(t),p.addChild(t),a.addChild(f),a.addChild(p),a.addChild(_)})),a}};const fr=gr;var pr={};pr.ComposerPostProcess=An,a.Z.objectMix(pr,gn),pr.DelayInterpolator=Vt,pr.DisplayNormalVisitor=vn,pr.DisplayGeometryVisitor=Sn,pr.DisplayGraph=xn.Z,pr.IntersectFunctor=pt.Z,pr.Intersector=ft.Z,pr.IntersectionVisitor=ct.Z,pr.LineSegmentIntersector=At.Z,pr.LineSegmentIntersectFunctor=Tn.Z,pr.NodeGizmo=zn,pr.GizmoGeometry=Nn,pr.WebVRCustom=ur,pr.PolytopeIntersector=Et,pr.PolytopeIntersectFunctor=vt,pr.SphereIntersector=$n,pr.TangentSpaceGenerator=tr,pr.WebVR=fr,pr.NO_LIMIT=di.Z.NO_LIMIT,pr.LIMIT_ONE_PER_DRAWABLE=di.Z.LIMIT_ONE_PER_DRAWABLE,pr.LIMIT_ONE=di.Z.LIMIT_ONE,pr.POINT_PRIMITIVES=di.Z.POINT_PRIMITIVES,pr.LINE_PRIMITIVES=di.Z.LINE_PRIMITIVES,pr.TRIANGLE_PRIMITIVES=di.Z.TRIANGLE_PRIMITIVES,pr.ALL_PRIMITIVES=di.Z.ALL_PRIMITIVES;const mr=pr;var _r=i("ljhH"),vr=i("PAIz"),Cr=i("wm32"),br=i("83E6"),Sr=i("sh3Z"),Er=i("nRps"),yr=i("QuvP"),Ir=i("8dss"),xr=i("pZnz");const Tr=function(){var e=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},i=null,n=null;function r(e){if(null==i)for(var t in i={},n={},e)"number"==typeof e[t]&&(i[e[t]]=t,n[t]=e[t])}function a(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function o(e){a();var t=i[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function s(e,i,r,a){var s;if(void 0!==(s=t[e])&&(void 0!==(s=s[i])&&s[r])){if("object"==typeof s[r]&&void 0!==s[r].enumBitwiseOr){for(var l=s[r].enumBitwiseOr,u=0,h=[],c=0;c<l.length;++c){var A=n[l[c]];0!=(a&A)&&(u|=A,h.push(o(A)))}return u===a?h.join(" | "):o(a)}return o(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function l(e,t,i){e.__defineGetter__(i,(function(){return t[i]})),e.__defineSetter__(i,(function(e){t[i]=e}))}function u(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var r=0;r<i;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0),t&&e.vertexAttribDivisor(r,0);e.deleteBuffer(n);var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<a;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(r,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var o=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(r=0;r<o;++r)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,null);var s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(r=0;r<s;++r)e.bindBufferBase(e.UNIFORM_BUFFER,r,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}return{init:r,mightBeEnum:function(e){return a(),void 0!==i[e]},glEnumToString:o,glFunctionArgToString:s,glFunctionArgsToString:function(e,t){for(var i="",n=t.length,r=0;r<n;++r)i+=(0==r?"":", ")+s(e,n,r,t[r]);return i},makeDebugContext:function t(i,n,a,u){u=u||i,r(i),n=n||function(t,i,n){for(var r="",a=n.length,l=0;l<a;++l)r+=(0==l?"":", ")+s(i,a,l,n[l]);e("WebGL error "+o(t)+" in "+i+"("+r+")")};var h={};function c(e,t){return function(){a&&a(t,arguments);var i=e[t].apply(e,arguments),r=u.getError();return 0!=r&&(h[r]=!0,n(r,t,arguments)),i}}var A={};for(var d in i)if("function"==typeof i[d])if("getExtension"!=d)A[d]=c(i,d);else{var g=c(i,d);A[d]=function(){var e=g.apply(i,arguments);return e?t(e,n,a,u):null}}else l(A,i,d);return A.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return i.NO_ERROR},A},makeLostContextSimulatingCanvas:function(e){var t,i,n=[],r=[],a={},o=1,s=!1,h=[],c=0,A=0,d=!1,g=0,f={};function p(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=function(n){return function(){var r=n.apply(e,arguments);if(r instanceof WebGLRenderingContext||window.WebGL2RenderingContext&&r instanceof WebGL2RenderingContext){if(r!=t){if(t)throw"got different context";i=window.WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,a=S(t=r)}return a}return r}}(e.getContext);var m=function(e){n.push(p(e))},_=function(e){r.push(p(e))};function v(){++A,s||c==A&&e.loseContext()}function C(e,t){var i=e[t];return function(){if(v(),!s){var t=i.apply(e,arguments);return t}}}function b(e){return{statusMessage:e,preventDefault:function(){d=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(i,n,r){switch(i){case"webglcontextlost":m(n);break;case"webglcontextrestored":_(n);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!s){for(s=!0,c=0,++o;t.getError(););!function(){for(var e=Object.keys(f),t=0;t<e.length;++t)delete f[e[t]]}(),f[t.CONTEXT_LOST_WEBGL]=!0;var i=b("context lost"),r=n.slice();setTimeout((function(){for(var t=0;t<r.length;++t)r[t](i);g>=0&&setTimeout((function(){e.restoreContext()}),g)}),0)}},e.restoreContext=function(){s&&r.length&&setTimeout((function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<h.length;++e){var n=h[e];n instanceof WebGLBuffer?t.deleteBuffer(n):n instanceof WebGLFramebuffer?t.deleteFramebuffer(n):n instanceof WebGLProgram?t.deleteProgram(n):n instanceof WebGLRenderbuffer?t.deleteRenderbuffer(n):n instanceof WebGLShader?t.deleteShader(n):n instanceof WebGLTexture?t.deleteTexture(n):i&&(n instanceof WebGLQuery?t.deleteQuery(n):n instanceof WebGLSampler?t.deleteSampler(n):n instanceof WebGLSync?t.deleteSync(n):n instanceof WebGLTransformFeedback?t.deleteTransformFeedback(n):n instanceof WebGLVertexArrayObject&&t.deleteVertexArray(n))}}(),u(t),s=!1,A=0,d=!1;for(var e=r.slice(),n=b("context restored"),a=0;a<e.length;++a)e[a](n)}),0)},e.loseContextInNCalls=function(e){if(s)throw"You can not ask a lost contet to be lost";c=A+e},e.getNumCalls=function(){return A},e.setRestoreTimeout=function(e){g=e},e;function S(e){for(var n in e)"function"==typeof e[n]?a[n]=C(e,n):l(a,e,n);a.getError=function(){if(v(),!s)for(;e=t.getError();)f[e]=!0;for(var e in f)if(f[e])return delete f[e],e;return a.NO_ERROR};var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];i&&r.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var u=0;u<r.length;++u){var c=r[u];a[c]=function(t){return function(){if(v(),s)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=o,h.push(i),i}}(e[c])}var A=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];i&&A.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(u=0;u<A.length;++u){c=A[u];a[c]=function(t){return function(){return v(),s?null:t.apply(e,arguments)}}(a[c])}var d=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];i&&d.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(u=0;u<d.length;++u){c=d[u];a[c]=function(t){return function(){return v(),!s&&t.apply(e,arguments)}}(a[c])}return a.checkFramebufferStatus=function(t){return function(){return v(),s?a.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(a.checkFramebufferStatus),a.getAttribLocation=function(t){return function(){return v(),s?-1:t.apply(e,arguments)}}(a.getAttribLocation),a.getVertexAttribOffset=function(t){return function(){return v(),s?0:t.apply(e,arguments)}}(a.getVertexAttribOffset),a.isContextLost=function(){return s},i&&(a.getFragDataLocation=function(t){return function(){return v(),s?-1:t.apply(e,arguments)}}(a.getFragDataLocation),a.clientWaitSync=function(t){return function(){return v(),s?a.WAIT_FAILED:t.apply(e,arguments)}}(a.clientWaitSync),a.getUniformBlockIndex=function(t){return function(){return v(),s?a.INVALID_INDEX:t.apply(e,arguments)}}(a.getUniformBlockIndex)),a}},resetToInitialState:u}}();var wr=function(){this._values=new Float32Array(wr.maxGraphValue),this._index=0,this._maxValue=0,this._x=0,this._y=0};wr.maxGraphValue=120,wr.prototype={getIndex:function(){return this._index},getValues:function(){return this._values},setDisplayPosition:function(e,t){this._x=e,this._y=t},getX:function(){return this._x},getY:function(){return this._y},addValue:function(e,t){var i=this._index;this._maxValue=e>this._maxValue?e:this._maxValue,this._maxValue*=.99,this._values[i]=e/(1.1*this._maxValue),t&&(this._values[i]+=t),this._index=(this._index+1)%wr.maxGraphValue}};const Mr=wr;var Rr=function(){this._usageHint=Y.Z.DYNAMIC_DRAW;this._nbVertexes=0,this._maxNbVertexes=0,this._captionNbVertexes=0,this._valuesNbVertexes=0,this._graphsNbVertexes=0,this.resize(6560)};Rr.backgroundColor=10,Rr.redColor=7,Rr.greyColor=4,Rr.whiteColor=1,a.Z.createPrototypeObject(Rr,{getGeometry:function(){return this._geometry},generateBackground:function(e,t,i,n){var r=this._vertexes;this._nbVertexes+=4,r[0]=e,r[1]=t,r[2]=0,r[3]=Rr.backgroundColor;var a=e+i,o=t+n;r[4]=e,r[5]=o,r[6]=0,r[7]=Rr.backgroundColor,r[8]=a,r[9]=o,r[10]=0,r[11]=Rr.backgroundColor,r[12]=a,r[13]=t,r[14]=0,r[15]=Rr.backgroundColor},generateCharacter:function(e,t,i,n,r,a,o){var s=this._vertexes,l=this._nbVertexes;this._nbVertexes+=4;var u=4*l;s[u++]=e,s[u++]=t,s[u++]=r,s[u++]=-(0+o);var h=e+i,c=t+n;s[u++]=e,s[u++]=c,s[u++]=r,s[u++]=-(1+o),s[u++]=h,s[u++]=c,s[u++]=a,s[u++]=-(1+o),s[u++]=h,s[u++]=t,s[u++]=a,s[u++]=-(0+o)},generateText:function(e,t,i,n,r){var a=i.length;this._nbVertexes+4*a>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);for(var o=n._characterSizeUV,s=n._characterWidth,l=n._characterHeight,u=0;u<a;u++){var h=i.charCodeAt(u),c=n.getCharacterUV(h);this.generateCharacter(e,t,s,l,c,c+o,r),e+=s}return a*s},generateGraph:function(e,t){this._nbVertexes+2*Mr.maxGraphValue>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);var i=this._vertexes,n=this._nbVertexes,r=e.getValues(),a=r.length,o=e.getIndex(),s=e.getX(),l=e.getY();this._nbVertexes+=2*a;for(var u=0;u<a;u++){var h=4*(n+2*u),c=r[(o+u)%a],A=Rr.greyColor;c>=Rr.redColor&&(A=Rr.redColor,c-=Rr.redColor),c>1&&(c=1),(c*=t)<1&&(c=1),i[h]=s+2*u,i[h+1]=l,i[h+2]=0,i[h+3]=A,i[h+4]=s+2*u,i[h+5]=l+c,i[h+6]=0,i[h+7]=A}},resize:function(e){P.Z.log("resize buffer to "+e),this._maxNbVertexes=e;var t=new Float32Array(4*e);this._vertexes&&t.set(this._vertexes),this._vertexes=t;var i=Math.ceil(e/4);this._indexes=new Uint16Array(6*i);for(var n=0,r=0;n<i;n++)this._indexes[r++]=4*n+0,this._indexes[r++]=4*n+1,this._indexes[r++]=4*n+3,this._indexes[r++]=4*n+3,this._indexes[r++]=4*n+1,this._indexes[r++]=4*n+2;if(this._geometry)return this._geometry.getAttributes().Vertex.setElements(this._vertexes),void this._characterPrimitive.getIndices().setElements(this._indexes);this._geometry=new Le.Z,this._geometry.setName("osgStats-Stats"),this._geometry.getAttributes().Vertex=new Y.Z(Y.Z.ARRAY_BUFFER,this._vertexes,4,!0);var a=new Y.Z(Y.Z.ELEMENT_ARRAY_BUFFER,this._indexes,1);this._geometry.getAttributes().Vertex.setUsage(this._usageHint);var o=new wn.Z(pn.Z.TRIANGLES,a);this._characterPrimitive=o,this._geometry.getPrimitives().push(this._characterPrimitive);var s=new fn.Z(pn.Z.LINES,0,0);this._graphPrimitive=s,this._geometry.getPrimitives().push(this._graphPrimitive)},update:function(){var e=this._captionNbVertexes+this._valuesNbVertexes;this._characterPrimitive.setCount(e/4*6),this._graphPrimitive.setCount(this._graphsNbVertexes),this._graphPrimitive.setFirst(e),this._geometry.getAttributes().Vertex.dirty()},resetCaptions:function(){this._nbVertexes=0,this._captionNbVertexes=0},resetValues:function(){this._nbVertexes=this._captionNbVertexes,this._valuesNbVertexes=0,this._graphsNbVertexes=0},captionsEnd:function(){this._captionNbVertexes=this._nbVertexes},valuesEnd:function(){this._valuesNbVertexes=this._nbVertexes-this._captionNbVertexes},graphsEnd:function(){this._graphsNbVertexes=this._nbVertexes-(this._valuesNbVertexes+this._captionNbVertexes)},getCharacterPrimitive:function(){return this._characterPrimitive},getGraphPrimitive:function(){return this._graphPrimitive},getNbVertexes:function(){return this._nbVertexes}});const Br=Rr;var Nr=window.performance,Dr=function(e){this._caption=e.caption,this._accumValue=0,this._accumSamples=0,this._accumStart=0,this._value=0,this._averageValue=0,this._time=0,this._avgMs=0,this._over=e.over>0?e.over:0,this._below=e.below>0?e.below:0,this._graph=!!e.graph,e.average&&(this._avgMs=e.avgMs?e.avgMs:1e3),this._display=!1};a.Z.createPrototypeObject(Dr,{isDisplayable:function(){return this._display},setDisplayable:function(e){this._display=e},getOver:function(){return this._over},getBelow:function(){return this._below},getGraph:function(){return this._graph},getAverageMs:function(){return this._avgMs},getAverageValue:function(){return this._averageValue},getValue:function(){return this._value},average:function(e){if(this._avgMs){this._accumValue+=e,this._accumSamples++;var t=Nr.now();t-this._accumStart>this._avgMs&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=t,this._accumSamples=0)}},start:function(){this._display=!0,this._time=Nr.now()},end:function(){this._value=Nr.now()-this._time,this.average(this._value)},set:function(e){this._display=!0,this._value=e,this.average(e)},tick:function(){this.end(),this.start()},frame:function(){var e=Nr.now()-this._time;this.set(1e3/e),this.start()}});const Pr=Dr;var Fr=function(){this._canvas=void 0,this._characterHeight=0,this._characterWidth=0,this._fontSize=16,this._fontFamily="Source Code Pro",this._characterFirstCode=" ".charCodeAt(),this._characterLastCode="z".charCodeAt(),this._characterSizeUV=0,this._backgroundColor="rgba(0,0,0,0.0)",this._createCanvas()};a.Z.createPrototypeObject(Fr,{setFontSize:function(e){this._fontSize=e},getCharacterWidth:function(){return this._characterWidth},getCharacterHeight:function(){return this._characterHeight},getCanvas:function(){return this._promise},getCharacterUV:function(e){return(e-this._characterFirstCode)*this._characterSizeUV},_fillCanvas:function(e,t){var i=t+"px",n=function(e){var t=document.getElementsByTagName("body")[0],i=document.createElement("div"),n=document.createTextNode("M");i.appendChild(n),i.setAttribute("style",e),t.appendChild(i);var r=i.offsetHeight;return t.removeChild(i),r}("font-family: "+e+"; font-size: "+i+";");P.Z.debug(e+" "+i+" ==> "+n+" pixels high."),this._characterHeight=Math.ceil(n);var r=t+"px '"+e+"'",a=document.createElement("canvas"),o=a.getContext("2d");this._canvas=a,o.font=r,o.textBaseline="middle",this._characterWidth=o.measureText(" ").width,this._characterWidth=Math.ceil(this._characterWidth);var s=this._characterLastCode-this._characterFirstCode+1;P.Z.info("Stats character size "+this._characterWidth+" x "+this._characterHeight+" texture width "+this._characterWidth*s),a.width=Math.ceil(this._characterWidth*s),a.height=this._characterHeight,this._characterSizeUV=this._characterWidth/a.width,o.font=r,o.textBaseline="middle",o.fillStyle="rgb(255,255,255)";for(var l=this._characterFirstCode,u=0;l<=this._characterLastCode;l++,u++){var h=String.fromCharCode(l),c=u*this._characterWidth,A=this._characterHeight/2;o.fillText(h,c,A)}return a},_createCanvas:function(){var e;this._promise=(e=this._fontFamily,new(Ne())((function(t,i){window.WebFontConfig={google:{families:[e+":200"]},active:function(){t(e)},inactive:function(e){i("loadFont error:"+e)}};var n=document.createElement("script"),r=document.scripts[0];n.src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js",n.async=!0,n.onerror=function(){i()},r.parentNode.insertBefore(n,r)}))).then(function(e){return this._fillCanvas(e,this._fontSize)}.bind(this)).catch(function(){return this._fillCanvas("Courier New",this._fontSize)}.bind(this))}});const Or=Fr;var Lr,kr,Zr,Ur,Vr,Qr=i("Ko9s"),Gr=32768,Hr=function(e,t){this._captionsBuffer=void 0,this._valuesBuffer=void 0,this._dirtyCaptions=!0,this._dirtyValues=!0,this._viewer=e,this._labelMaxWidth=0,this._viewport=e.getCamera().getViewport(),this._node=void 0,this._text=void 0,this._offsetGroup=void 0,this._counters={},this._groups={},this._updates=[],this._displayableCounters={},this._x=0,this._y=0,this._width=0,this._height=0,this._maxCaptionTextLength=32,this._lineFactor=1.1,this._displayFilter=[],this._backgroundWidth=0,this._backgroundHeight=0,this._bufferStats=new Br,this._historyGraph={},this._graphToDisplay=[],this._valuesMaxWidth=72,this._showGraph=!1,this._backgroundPicking=We.Z.createTexturedQuadGeometry(0,0,0,10,0,0,0,10,0),this._backgroundPicking.setName("osgStats-Background-picking"),this._dragStop=o.K4.create(),this._dragStart=o.K4.create(),this._startTransformation=o._E.create(),this._init(t)};a.Z.createPrototypeObject(Hr,{getCounter:function(e){return this._counters[e]||(this._counters[e]=new Pr({caption:e,average:!0})),this._counters[e]},getBufferStats:function(){return this._bufferStats},addConfig:function(e){if(!e.init||e.init()){for(var t in e.values){var i=e.values[t],n=new Pr(i);this._counters[t]=n}if(e.groups)for(var r=0;r<e.groups.length;r++){var a=e.groups[r],o={caption:a.caption,values:a.values,textCursorY:new Float32Array(a.values.length)},s=a.name?a.name:a.caption;this._groups[s]=o}e.update&&this._updates.push(e.update)}},reset:function(){this._bufferStats.resetCaptions(),this._bufferStats.resetValues(),this._dirtyCaptions=!0,this._dirtyValue=!0,this._bufferStats.resize(this._bufferStats._maxNbVertexes)},update:function(){for(var e=0;e<this._updates.length;e++)this._updates[e](this);this._dirtyValues=!0,(this._checkViewportChanged()||this._checkCounterDisplayableChanged())&&(this._dirtyCaptions=!0),this._dirtyCaptions&&(this._bufferStats.resetCaptions(),this._generateCaptions(),this._dirtyCaptions=!1),this._dirtyValues&&(this._bufferStats.resetValues(),this._generateValues(),this._dirtyValues=!1)},getNode:function(){return this._node},setShowFilter:function(e){this._dirtyCaptions=!0,e?this._displayFilter=e.slice():this._displayFilter.length=0},_init:function(e){var t=new an.Z;t.setRenderOrder(an.Z.POST_RENDER,0),t.setReferenceFrame(ir.Z.ABSOLUTE_RF),t.setClearMask(0);var i=new ze.Z;i.setName("StatsNode"),i.addChild(this._backgroundPicking),this._nodeTransform=i,this._backgroundPicking.setNodeMask(0),t.addChild(i),t.setName("osgStats"),t.setViewport(this._viewport),this._node=t,this._text=new Or;var n=12;if(e){var r=e.getString("statsFilter");if(r){var a=r.split(";");this.setShowFilter(a)}var o=e.getNumber("statsFontSize");void 0!==o&&(n=o),this._showGraph=e.getBoolean("statsShowGraph")}var s,l,u=new je.Z;u.setMinFilter(je.Z.NEAREST),u.setMagFilter(je.Z.NEAREST),this._text.setFontSize(n*this._viewer.getCanvasPixelRatio()),this._text.getCanvas().then(function(e){this._dirtyCaptions=!0;var t=this._bufferStats.getGeometry();t.setNodeMask(-32769),i.addChild(t),u.setImage(e),t.setBound(new Qr.Z)}.bind(this)),i.getOrCreateStateSet().setAttributeAndModes((s=["attribute vec4 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec2 vTexCoord0;","","void main(void) {","  vTexCoord0 = Vertex.zw;","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xy,0.0, 1.0));","}"].join("\n"),l=["#define SHADER_NAME STATS","varying vec2 vTexCoord0;","uniform sampler2D Texture0;","void main(void) {","  vec4 color = vec4(1.0);","  vec2 uv =  vTexCoord0;","  int isText = 0;","  if ( uv.y < 0.0 ) {","     isText = 1;","     uv.y = -uv.y;","  }","  if ( uv.y >= "+(Br.backgroundColor-1).toFixed(1)+" ) {","     color = vec4(0.0,0.0,0.0,0.5);","     uv.y -= "+Br.backgroundColor.toFixed(1)+";","  } else if ( uv.y >= "+(Br.redColor-1).toFixed(1)+" ) {","     color = vec4(1.0,0.0,0.0,1.0);","     uv.y -= "+Br.redColor.toFixed(1)+";","  } else if ( uv.y == "+(Br.greyColor-1).toFixed(1)+" ) {","     color = vec4(0.5,0.5,0.5,1.0);","     uv.y -= "+Br.greyColor.toFixed(1)+";","  } else {","     uv.y -= "+Br.whiteColor.toFixed(1)+";","  }","  if ( isText == 1 ) {","     color *= texture2D( Texture0, uv.xy);","  }","  gl_FragColor = color;","}"].join("\n"),new ln.Z(new un.Z("VERTEX_SHADER",s),new un.Z("FRAGMENT_SHADER",l)))),i.getOrCreateStateSet().setAttributeAndModes(new en.Z(en.Z.DISABLE));var h=new qe.Z("SRC_ALPHA","ONE_MINUS_SRC_ALPHA");i.getOrCreateStateSet().setAttributeAndModes(h),i.getOrCreateStateSet().setAttributeAndModes(new tn.Z(tn.Z.DISABLE)),i.getOrCreateStateSet().setTextureAttributeAndModes(0,u);var c=this._viewer.getGraphicContext().canvas;this._canvas=c;var A=this._viewer.getInputManager();A.group(Bt.Z.STATS).addMappings({onMouseMove:["mousemove","touchmove"],onMouseDown:["mousedown","touchstart"],onMouseUp:["mouseup","mouseout","touchend","touchcancel"]},this),A.setPriority(Bt.Z.STATS,A.getHigherPriority(Bt.Z.SCENE))},onMouseDown:function(e){var t=this.computeNearestIntersection(e);this._onStats=!!t.length,this._onStats&&(this._viewer.getInputManager().setEnable(Bt.Z.SCENE,!1),o._E.copy(this._startTransformation,this._nodeTransform.getMatrix()),o.K4.set(this._dragStart,e.canvasX,e.canvasY),this._dragStop[1]=this._dragStart[1])},onMouseMove:(Vr=o.R3.create(),function(e){if(this._onStats){o.K4.set(this._dragStop,e.canvasX,e.canvasY);var t=this._dragStop[1]-this._dragStart[1];o._E.translate(this._nodeTransform.getMatrix(),this._startTransformation,o.R3.set(Vr,0,-t,0))}}),onMouseUp:function(){this._viewer.getInputManager().setEnable(Bt.Z.SCENE,!0),this._onStats=!1},computeNearestIntersection:(Lr=new At.Z,kr=o.R3.create(),Zr=o.R3.create(),Ur=new ct.Z,Ur.setIntersector(Lr),function(e){var t=e.glX,i=e.glY;Lr.reset(),Lr.set(o.R3.set(kr,t,i,0),o.R3.set(Zr,t,i,1)),Ur.reset(),this._backgroundPicking.setNodeMask(Gr),Ur.setTraversalMask(Gr),this._node.accept(Ur);var n=Lr.getIntersections();return this._backgroundPicking.setNodeMask(0),n}),_updateBackgroundPicking:function(e,t,i,n){var r=this._backgroundPicking.getVertexAttributeList().Vertex.getElements();r[0]=e,r[1]=t+n,r[3]=e,r[4]=t,r[6]=e+i,r[7]=t,r[9]=e+i,r[10]=t+n,this._backgroundPicking.getVertexAttributeList().Vertex.dirty(),this._backgroundPicking.dirtyBound()},_generateCaptions:function(){var e=this._text.getCharacterHeight(),t=0,i=this._viewport.height()-e;this._labelMaxWidth=0,this._bufferStats.generateBackground(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight),this._updateBackgroundPicking(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight);var n=this._displayFilter;for(var r in this._groups)if(!r||!n.length||-1!==n.indexOf(r)){var a=this._groups[r],o="--- "+a.caption+" ---",s=this._bufferStats.generateText(t,i,o,this._text,Br.whiteColor);this._labelMaxWidth=Math.max(s,this._labelMaxWidth),t=0,i-=this._lineFactor*e;for(var l=0;l<a.values.length;l++){var u=a.values[l],h=this._counters[u];if(h&&h.isDisplayable()){a.textCursorY[l]=i;for(var c=h._caption,A=c.length/this._maxCaptionTextLength,d=0;d<A;d++){var g=d*this._maxCaptionTextLength,f=c.substr(g,this._maxCaptionTextLength);s=this._bufferStats.generateText(t,i,f,this._text,Br.whiteColor),this._labelMaxWidth=Math.max(s,this._labelMaxWidth),i-=e,t=0}}}i-=e}this._bufferStats.captionsEnd()},_generateValues:function(){var e,t=this._text.getCharacterWidth(),i=this._labelMaxWidth+2*t,n=this._valuesMaxWidth+2*t,r=this._text.getCharacterHeight(),a=i,o=this._displayFilter,s=0;for(var l in this._groups)if(!l||!o.length||-1!==o.indexOf(l)){var u=this._groups[l];a=i;for(var h=0;h<u.values.length;h++){var c=u.values[h],A=this._counters[c];if(A&&A.isDisplayable()){var d,g=A.getAverageMs()?A.getAverageValue():A.getValue();d=Number.isInteger(g)?g.toString():g.toFixed(2),e=u.textCursorY[h];var f=Br.whiteColor,p=A.getOver(),m=A.getBelow();0!==p?f=g>p?Br.redColor:f:0!==m&&(f=g<m?Br.redColor:f);var _=this._bufferStats.generateText(a,e,d,this._text,f);s=Math.max(_,s),this._showGraph&&A._graph&&(this._historyGraph[c]||(this._historyGraph[c]=new Mr),this._graphToDisplay.push(this._historyGraph[c]),this._historyGraph[c].setDisplayPosition(i+n,e),this._historyGraph[c].addValue(g,f)),a=i}}}this._bufferStats.valuesEnd(),this._valuesMaxWidth=s;for(var v=0;v<this._graphToDisplay.length;v++){var C=this._graphToDisplay[v];this._bufferStats.generateGraph(C,r-2)}var b=i+n;this._graphToDisplay.length&&(b+=2*Mr.maxGraphValue+1);var S=this._viewport.height()-e;this._backgroundWidth===b&&this._backgroundHeight===S||(this._backgroundWidth=b,this._backgroundHeight=S,this._dirtyCaptions=!0),this._graphToDisplay.length=0,this._bufferStats.graphsEnd(),this._bufferStats.update()},_checkCounterDisplayableChanged:function(){var e=!1;for(var t in this._counters){var i=this._counters[t];this._displayableCounters[t]!==i.isDisplayable()&&(this._displayableCounters[t]=i.isDisplayable(),e=!0)}return e},_checkViewportChanged:function(){var e=this._viewport.x(),t=this._viewport.y(),i=this._viewport.width(),n=this._viewport.height();if(e!==this._x||t!==this._y||i!==this._width||n!==this._height){this._x=e,this._y=t,this._width=i,this._height=n;var r=this._node;return o._E.ortho(r.getProjectionMatrix(),this._x,this._width,this._y,this._height,-5,5),!0}return!1}});const zr=Hr;const Wr={values:{frame:{caption:"Total frame time",over:16,average:!0,graph:!0,max:4},stats:{caption:"stats",over:1,graph:!0},fps:{caption:"Framerate (FPS)",below:30,average:!0},raf:{caption:"Time since last rAF",average:!0,avgMs:500},update:{caption:"update",average:!0,graph:!0},cull:{caption:"cull",average:!0,graph:!0,max:16},render:{caption:"render",average:!0,graph:!0},readPixels:{caption:"readPixels",average:!0,graph:!0},glframe:{caption:"glframe",average:!0,graph:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},applyStateSet:{caption:"num applyStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},groups:[{name:"framerate",caption:"Framerate",values:["fps","raf"]},{name:"frameBudget",caption:"Frame Budget",base:"frame",values:["frame","update","cull","render","glframe","stats"]},{name:"sceneGraph",caption:"Scene Graph ",values:["pushstateset","updatecallback","applyStateSet"]},{name:"cullVisitor",caption:"Cull",values:["cullnode","cullmatrixtransform","cullcamera","culllighsource","cullprojection","cullgeometry"]},{name:"texture",caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]},{name:"readback",caption:"gpu read back",values:["readpixels"]}]};var jr=[window.WebGLRenderingContext,window.WebGL2RenderingContext],qr=function(e,t){return function(){t.apply(this,arguments),e.apply(this,arguments)}},Jr=0,Yr=0,Kr=0,Xr=0,$r=0,ea=0,ta=0,ia=0,na=0,ra=0;const aa={values:{glDrawCalls:{caption:"drawCalls"},glDrawElements:{caption:"drawElements"},glDrawArrays:{caption:"drawArrays"},glBindTexture:{caption:"bindTexture"},glUseProgram:{caption:"useProgram"},glFaces:{caption:"totalFaces"},glVertices:{caption:"totalVertices"},glPoints:{caption:"totalPoints"},statsFaces:{caption:"statsFaces"},statsVertices:{caption:"statsVertices"},statsLines:{caption:"statsLines"}},groups:[{name:"webgl",caption:"WebGL",values:["glDrawCalls","glDrawElements","glDrawArrays","glUseProgram","glBindTexture","glFaces","glVertices","glPoints","statsVertices","statsFaces","statsLines"]}],update:function(e){var t=e.getBufferStats(),i=t.getNbVertexes(),n=t.getCharacterPrimitive(),r=t.getGraphPrimitive();Yr-=1,r.getCount()&&(Jr-=1),ta-=2,Kr-=1,$r-=n.getCount()+r.getCount(),Xr-=n.getCount()/3,ia=i,na=n.getCount()/3,ra=r.getCount()/2,e.getCounter("glDrawCalls").set(Yr+Jr),e.getCounter("glDrawElements").set(Yr),e.getCounter("glDrawArrays").set(Jr),e.getCounter("glBindTexture").set(ta),e.getCounter("glUseProgram").set(Kr),e.getCounter("glFaces").set(Xr),e.getCounter("glVertices").set($r),e.getCounter("glPoints").set(ea),e.getCounter("statsVertices").set(ia),e.getCounter("statsFaces").set(na),e.getCounter("statsLines").set(ra),ia=0,na=0,ra=0,Jr=0,Yr=0,Kr=0,Xr=0,$r=0,ea=0,ta=0}.bind(void 0),init:function(){for(var e=!1,t=0;t<jr.length;t++){var i=jr[t];i&&(e=!0,i.prototype.drawArrays=qr(i.prototype.drawArrays,(function(){Jr++,arguments[0]===this.POINTS?ea+=arguments[2]:$r+=arguments[2]})),i.prototype.drawElements=qr(i.prototype.drawElements,(function(){Yr++,Xr+=arguments[1]/3,$r+=arguments[1]})),i.prototype.useProgram=qr(i.prototype.useProgram,(function(){Kr++})),i.prototype.bindTexture=qr(i.prototype.bindTexture,(function(){ta++})))}return e}};var oa=void 0,sa=Math.log(1024),la=function(e){var t=Math.floor(Math.log(e)/sa);return 0===e&&(t=1),Math.round(100*e/Math.pow(1024,t))/100};const ua={values:{browserMemory:{caption:"Used Memory",average:!0,avgMs:1e3},browserMemoryTotal:{caption:"Total Memory"}},groups:[{name:"browser",caption:"Browser",values:["browserMemory","browserMemoryTotal"]}],update:function(e){var t=0,i=0;oa&&(t=la(oa.usedJSHeapSize),i=la(oa.totalJSHeapSize)),e.getCounter("browserMemory").set(t),e.getCounter("browserMemoryTotal").set(i)},init:function(){return window.performance&&window.performance.memory&&(oa=window.performance.memory),oa&&0!==oa.totalJSHeapSize||P.Z.warn("Stats will not report memory, not supported by your browse"),!!oa}};var ha=["shift","alt","ctrl","meta"],ca=function(e,t){this._enabled=!0,this._name=t,this._mask=[],this._events={},this._mappings={},this._inputManager=e,this._boundCallback=this._collectNativeEvents.bind(this),this._priority=10,this._hasSources=!1};ca.prototype={addMappings:function(e,t){for(var i in e)e[this._name+":"+i]=e[i],delete e[i];this._inputManager.addMappings(e,t)},_collectNativeEvents:function(e){if(this._enabled&&!this._mask.length){var t=this._mappings[e.type];if(t)for(var i=0;i<t.length;i++){var n=t[i];if(!n._source.isEventRegistered||n._source.isEventRegistered(e,n._parsedEvent)){if(n._source.populateEvent(e,n),n._nativeEvents||(n._nativeEvents=[]),!n._nativeEvents.length){var r=this._inputManager._queues[n._priority];r||(r=[],this._inputManager._queues[n._priority]=r),r.push(n)}n._nativeEvents.push(e)}}}},_addEvent:function(e,t){var i,n=this._name+":"+t,r=!1,a=this._mappings[e.name];a?i=this._findEvent(a,n,e.raw):(a=[],this._mappings[e.name]=a,r=!0);var o=this._events[t];o||(o=[],this._events[t]=o),i||(i=new Event(n),a.push(i),o.push(i)),i._parsedEvent=e,i._priority=10;var s=this._inputManager._getSource(e.name);s&&(this._enabled&&r&&s.setEnable(e.name,this._boundCallback,!0),this._hasSources=!0,i._source=s)},_findEvent:function(e,t,i){for(var n=0;n<e.length;n++){var r=e[n];if(r.type===t&&r._parsedEvent.raw===i)return r}},_setEnable:function(e){for(var t in this._enabled=e,this._mappings){var i=this._mappings[t][0];i._source&&i._source.setEnable(t,this._boundCallback,e)}}};var Aa=function(){this._groups={},this._sources=[],this._queues=[],this._queues[10]=[],this._callbacks={},this._params={},this._maskedGroups=[],window.dumpInputGroups=this._dumpInputGroups.bind(this),window.dumpEventSequence=this._dumpEventSequence.bind(this)};Aa.prototype={registerInputSource:function(e){if(!e.setEnable||!e.supportsEvent||!e.getName)throw"Invalid input target "+JSON.stringify(e);this._sources.push(e),e.setInputManager(this)},getInputSource:function(e){for(var t=0;t<this._sources.length;t++){var i=this._sources[t];if(i.getName()===e)return i}},addMappings:function(e,t){for(var i in e){var n=e[i],r=i.split(":");if(2!==r.length)throw"Mapping should be of the form 'group:methodName': ['nativeevent1’, 'nativeevent2',...] ";var a,o,s=this._getOrCreateGroup(r[0]),l=r[1];if(t)if("object"==typeof t){if(!(a=t[l])||"function"!=typeof a)throw"Cannot find method "+l+" on "+t;a=a.bind(t)}else{if("function"!=typeof t)throw"Invalid listener "+t;a=t}if("string"==typeof n)o=this._parseNativeEvent(n),s._addEvent(o,l);else for(var u=0;u<n.length;u++){var h=n[u];o=this._parseNativeEvent(h),s._addEvent(o,l)}this._callbacks[s._name+":"+l]=a}},group:function(e){return this._getOrCreateGroup(e)},setEnable:function(e,t){var i,n=this._groups[e];for(var r in n&&n._setEnable(t),this._groups)if(n=this._groups[r],t){if((i=n._mask.indexOf(e))>=0){for(;i>=0;)n._mask.splice(i,1),i=n._mask.indexOf(e);for(i=this._maskedGroups.indexOf(e);i>=0;)this._maskedGroups.splice(i,1),i=this._maskedGroups.indexOf(e)}}else 0===(i=n._name.indexOf(e))&&"."===n._name[i+e.length]&&(n._mask.push(e),this._maskedGroups.push(e));if(!t)for(var a=0;a<this._queues.length;a++){var o=this._queues[a];if(o)for(var s=o.length-1;s>=0;s--){var l=o[s];l.type.indexOf(e)>=0&&(o.splice(s,1),l._nativeEvents.length=0)}}},setPriority:function(e,t){var i=e.split(":");if(t<0)throw"priority must be a positive number";var n,r,a=this._groups[i[0]];if(a&&i[1]){for(n=a._events[i[1]],r=0;r<n.length;r++)n[r]._priority=t;a._priority>t&&(a._priority=t)}else for(var o in this._groups)if((a=this._groups[o])._name.indexOf(e)>=0)for(var s in a._events)for(n=a._events[s],r=0;r<n.length;r++)n[r]._priority=t},getHigherPriority:function(e){var t=10;for(var i in this._groups){var n=this._groups[i];n._name.indexOf(e)>=0&&n._priority<t&&(t=n._priority)}return t>0?t-1:0},getParam:function(e){return this._params[e]},setParam:function(e,t){this._params[e]=t},cleanup:function(){for(var e in this._groups){this._groups[e]._setEnable(!1)}},_parseNativeEvent:function(e){var t,i=e.split(" "),n={};for(n.name=i[0],t=1;t<i.length;t++){var r=i[t],a=!0;0===r.indexOf("!")&&(a=!1,r=r.substring(1,r.length)),ha.indexOf(r)>=0?n[r]=a:n.action=r.toLowerCase()}if(n.action)for(t=0;t<ha.length;t++){var o=ha[t];0===n.action.indexOf(o)&&(n[o]=!0)}return 0===n.name.indexOf("key")&&!n.action&&i.length>1&&(n.action=i[i.length-1]),n.raw=e,n},_getOrCreateGroup:function(e){var t=this._groups[e];if(!t){t=new ca(this,e),this._groups[e]=t;for(var i=0;i<this._maskedGroups.length;i++){var n=this._maskedGroups[i];0===e.indexOf(n)&&t._mask.push(n)}}return t},update:function(e){var t;for(t=0;t<this._sources.length;t++){var i=this._sources[t];i.poll&&i.poll(e)}for(t=0;t<this._queues.length;t++){var n=this._queues[t];if(n){for(var r=0;r<n.length;r++){var a=n[r];this._callbacks[a.type](a),a._nativeEvents.length=0}n.length=0}}},_getSource:function(e){for(var t=0;t<this._sources.length;t++){var i=this._sources[t];if(i.supportsEvent(e))return i}},_dumpInputGroups:function(e,t){for(var i in!0===e&&(t=e,e=void 0),this._groups)if(!(e&&i.indexOf(e)<0)){var n=this._groups[i],r=n._enabled&&!n._mask.length&&n._hasSources;if(!t||r){for(var a in P.Z.groupCollapsed("%c"+i+(r?" (enabled)":" (disabled)"),r?"":"color: #888888"),P.Z.log("enabled:",n._enabled),P.Z.log("masks:",n._mask),P.Z.log("input sources:",n._hasSources),P.Z.group("events"),n._events){P.Z.groupCollapsed(a);for(var o=n._events[a],s=0;s<o.length;s++){var l=o[s],u="%c"+l._parsedEvent.raw+" ("+(l._source?l._source.getName():"unknown source")+")",h=l._source?"":"color: #888888";P.Z.log(u,h)}P.Z.groupCollapsed("function"),P.Z.log(this._callbacks[n._name+":"+a]),P.Z.groupEnd(),P.Z.groupEnd()}P.Z.groupEnd(),P.Z.groupEnd()}}},_dumpEventSequence:function(e,t){var i,n=[];for(var r in!0===e&&(t=e,e=void 0),this._groups){var a=this._groups[r];if(i=a._enabled&&!a._mask.length&&a._hasSources,!t||i)for(var o in a._events){var s=a._events[o],l=n[s[0]._priority];l||(l=[],n[s[0]._priority]=l);for(var u=0;u<s.length;u++){var h=s[u];(!e||e&&h._parsedEvent.raw.indexOf(e)>=0)&&l.push({name:h.type,group:a._name,on:h._parsedEvent.raw,enabled:a._enabled&&!a._mask.length&&!!h._source,source:h._source?"("+h._source.getName()+")":"(unknown source)"})}}}for(var c=0;c<n.length;c++){var A=n[c];if(A){var d;P.Z.group("priority "+c);for(var g=0;g<A.length;g++){var f=A[g];if(0!==g&&d!==f.name&&P.Z.groupEnd(),d!==f.name){var p=this._groups[f.group];i=p._enabled&&!p._mask.length&&p._hasSources,P.Z.groupCollapsed("%c"+f.name,i?"":"color:#888888")}d=f.name,P.Z.groupCollapsed("%c"+f.on+" "+f.source,f.enabled?"":"color:#888888"),P.Z.log(this._callbacks[f.name]),P.Z.groupEnd()}P.Z.groupEnd(),P.Z.groupEnd()}}}};const da=Aa;var ga=function(e){this._target=e,this._supportedEvents=[]};ga.prototype={supportsEvent:function(e){for(var t=0;t<this._supportedEvents.length;t++){var i=this._supportedEvents[t];if(0===e.indexOf(i))return!0}return!1},setInputManager:function(e){this._inputManager=e}};const fa=ga;var pa=0===navigator.platform.indexOf("Mac")?-1:-3,ma=function(e,t){fa.call(this,e),this._defaultRatio=o.K4.fromValues(1,1),this._supportedEvents=["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup"],t&&!1===t.scrollwheel||this._supportedEvents.push("wheel")};a.Z.createPrototypeObject(ma,a.Z.objectInherit(fa.prototype,{getName:function(){return"Mouse"},setEnable:function(e,t,i){i?this._target.addEventListener(e,t):this._target.removeEventListener(e,t)},populateEvent:function(e,t){t.canvasX=void 0===e.offsetX?e.layerX:e.offsetX,t.canvasY=void 0===e.offsetY?e.layerY:e.offsetY;var i=this._inputManager.getParam("pixelRatio");i||(i=this._defaultRatio),t.glX=t.canvasX*i[0],t.glY=(this._target.clientHeight-t.canvasY)*i[1],t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenX=e.screenX,t.pageX=e.pageX,t.pageY=e.pageY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.altKey=e.altKey,t.metaKey=e.metaKey,t.button=e.button,t.buttons=e.buttons,"wheel"===e.type&&(void 0!==e.wheelDelta?t.deltaY=e.wheelDelta/120:1===e.deltaMode?t.deltaY=e.deltaY/pa:t.deltaY=e.deltaY/(10*pa),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaZ=e.deltaZ)},isEventRegistered:function(e,t){return(!t.action||e.button===parseInt(t.action))&&((void 0===t.ctrl||e.ctrlKey===t.ctrl)&&((void 0===t.shift||e.shiftKey===t.shift)&&((void 0===t.alt||e.altKey===t.alt)&&((void 0===t.meta||e.metaKey===t.meta)&&(e.preventDefault(),!0)))))}}),"osgViewer","InputSourceMouse");const _a=ma;var va=function(e){fa.call(this,e),this._supportedEvents=["keydown","keyup","keypress"]};a.Z.createPrototypeObject(va,a.Z.objectInherit(fa.prototype,{getName:function(){return"Keyboard"},setEnable:function(e,t,i){i?this._target.addEventListener(e,t):this._target.removeEventListener(e,t)},populateEvent:function(e,t){t.key=e.key,t.keyCode=e.keyCode,t.code=e.code,t.location=e.location,t.repeat=e.repeat,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.altKey=e.altKey,t.metaKey=e.metaKey},isEventRegistered:function(e,t){return!t.action||(e.key?e.key.toLowerCase()===t.action&&((void 0===t.ctrl||e.ctrlKey===t.ctrl)&&((void 0===t.shift||e.shiftKey===t.shift)&&((void 0===t.alt||e.altKey===t.alt)&&((void 0===t.meta||e.metaKey===t.meta)&&(e.preventDefault(),!0))))):void 0)}}),"osgViewer","InputSourceKeyboard");const Ca=va;var ba=i("pcq+"),Sa=function(e,t){fa.call(this),this._supportedEvents=["vrsupported","vrpolyfilled","vrdisplayposechanged","vrdisplayconnected","vrdisplaynotfound","vrdisplaydisconnected"],this._callbacks={},this._events={};for(var i=0;i<this._supportedEvents.length;i++){var n=this._supportedEvents[i],r=new Event(n);this._events[n]=r}this._nbCallbacks=0,this._pollInterval=t&&void 0!==t.pollInterval?t.pollInterval:3e3};a.Z.createPrototypeObject(Sa,a.Z.objectInherit(fa.prototype,{getName:function(){return"WebVR"},setEnable:function(e,t,i){var n=this._callbacks[e];n||(n=[],this._callbacks[e]=n);var r=n.indexOf(t);i?r<0&&(n.push(t),this._nbCallbacks++,this._schedulePolling()):r>=0&&(n.splice(r,1),this._nbCallbacks--,this._nbCallbacks||this._cancelPolling())},populateEvent:function(e,t){t.pose=e.pose,t.worldFactor=this._inputManager.getParam("worldFactor"),t.worldFactor||(t.worldFactor=1)},_schedulePolling:function(){this._pollInterval>0&&void 0===this._pollingTimeout&&(this._pollingTimeout=setInterval(this.pollHeadset.bind(this),this._pollInterval))},_cancelPolling:function(){void 0!==this._pollingTimeout&&clearInterval(this._pollingTimeout)},pollHeadset:function(){if(!navigator.xr||!navigator.xr.isSessionSupported){if(navigator.getVRDisplays||ba.default.any){if(this._vrPolyfillLoaded)return Ne().reject("VR not supported");var e=this._events.vrsupported;this._dispatchEvent(e,this._callbacks.vrsupported);var t=this._events.vrpolyfilled;this._dispatchEvent(t,this._callbacks.vrpolyfilled)}return Ne().resolve()}var i=this._events.vrsupported;this._dispatchEvent(i,this._callbacks.vrsupported);var n=this;return navigator.xr.isSessionSupported("immersive-vr").then(function(e){if(!e){if(this._vrReady){var t=n._events.vrdisplaydisconnected;this._dispatchEvent(t,n._callbacks.vrdisplaydisconnected)}return this._vrReady=!1,this.triggerNotFoundEvent(),Ne().reject("Immersive-vr session not supported")}if(!n._vrReady)return P.Z.log("Found a VR display"),n._vrReady=!0,i=n._events.vrdisplayconnected,this._dispatchEvent(i,n._callbacks.vrdisplayconnected),Ne().resolve()}.bind(this)).catch(function(e){return this._vrReady=!1,this.triggerNotFoundEvent(),P.Z.warn(e),Ne().reject(e)}.bind(this))},triggerNotFoundEvent:function(){if(!(this._pollInterval>0)){var e=this._events.vrdisplaynotfound;this._dispatchEvent(e,this._callbacks.vrdisplaynotfound)}},setPollInterval:function(e){this._pollInterval=e},_dispatchEvent:function(e,t){if(t)for(var i=0;i<t.length;i++){(0,t[i])(e)}},poll:function(e){if(this._vrReady&&e.frame){var t=this._callbacks.vrdisplayposechanged;if(t&&t.length){var i=e.frame.getViewerPose(e.xrReferenceSpace);if(i){var n=this._events.vrdisplayposechanged;n.pose=i,this._dispatchEvent(n,t)}}}}}),"osgViewer","InputSourceVR");const Ea=Sa;var ya=function(){fa.call(this),this._target=window,this._supportedEvents=["buttondown","buttonup","buttonvalue","axis","gamepadconnected","gamepaddisconnected"],this._callbacks={},this._nbCallbacks=0,this._gamePadState=[],this._valueThreshold=.05,window.addEventListener("gamepadconnected",function(e){this._newGamePad(e.gamepad),this._onConnectionStateChange(e,"gamepadconnected")}.bind(this)),window.addEventListener("gamepaddisconnected",function(e){this._previousState[e.gamepad.index]=void 0,this._onConnectionStateChange(e,"gamepaddisconnected")}.bind(this))};a.Z.createPrototypeObject(ya,a.Z.objectInherit(fa.prototype,{getName:function(){return"GamePad"},setEnable:function(e,t,i){var n=this._callbacks[e];n||(n=[],this._callbacks[e]=n);var r=n.indexOf(t);i?r<0&&(n.push(t),this._nbCallbacks++):r>=0&&(n.splice(r,1),this._nbCallbacks--)},_onConnectionStateChange:function(e,t){var i=this._callbacks[t];i&&i(e)},_newGamePad:function(e){var t,i={buttons:[]};for(i._buttonEvents=[],i._axisEvents=[],t=0;t<e.buttons.length;t++)i._buttonEvents[t]={buttondown:this._initEvent("buttondown",t,e.index,"button"),buttonup:this._initEvent("buttonup",t,e.index,"button"),buttonvalue:this._initEvent("buttonvalue",t,e.index,"button")};for(t=0;t<e.axes.length;t++)i._axisEvents[t]={axis:this._initEvent("axis",t,e.index,"axis")};this._gamePadState[e.index]=i},setValueThreshold:function(e){this._valueThreshold=e},_initEvent:function(e,t,i,n){var r=new Event(e);return r[n]=t,r.gamepadIndex=i,r},populateEvent:function(e,t){t.gamepadIndex=e.gamepadIndex,void 0!==e.button&&(t.button=e.button,t.value=e.value),void 0!==e.axis&&(t.axis=e.axis,t.value=e.value)},isEventRegistered:function(e,t){if(!t.action)return!0;var i=parseInt(t.action);return(void 0===e.button||e.button===i)&&(void 0===e.axis||e.axis===i)},_fireCallbacks:function(e,t){for(var i=0;i<e.length;i++)e[i](t)},poll:function(){if(this._nbCallbacks){var e=navigator.getGamepads();if(e)for(var t=0;t<e.length;t++){var i=e[t];if(i){var n=this._gamePadState[t];if(n){var r=this._callbacks.buttondown,a=this._callbacks.buttonup,o=this._callbacks.buttonvalue;if(r||a||o)for(var s=0;s<i.buttons.length;s++){var l=i.buttons[s],u=n._buttonEvents[s].buttondown;u.value=l.value;var h=n._buttonEvents[s].buttonup;if(h.value=l.value,l.pressed&&!n.buttons[s]&&(r&&r.length&&this._fireCallbacks(r,u),n.buttons[s]=l.pressed),!l.pressed&&n.buttons[s]&&(a&&a.length&&this._fireCallbacks(a,h),n.buttons[s]=!1),l.pressed&&o&&o.length){var c=n._buttonEvents[s].buttonvalue;c.value=l.value,Math.abs(l.value)>=this._valueThreshold&&this._fireCallbacks(o,c)}}var A=this._callbacks.axis;if(A)for(s=0;s<i.axes.length;s++){var d=i.axes[s],g=n._axisEvents[s].axis;g.value=d,Math.abs(d)>=this._valueThreshold&&this._fireCallbacks(A,g)}}}}}}}),"osgViewer","InputSourceGamePad");const Ia=ya;var xa=function(){fa.call(this),this._target=window,this._callbacks=[],this._nbCallbacks=0,this._event=new Event("deviceorientation"),this._supportedEvents=["deviceorientation","orientationchange"],this._update=this.onDeviceOrientation.bind(this)};a.Z.createPrototypeObject(xa,a.Z.objectInherit(fa.prototype,{getName:function(){return"DeviceOrientation"},setEnable:function(e,t,i){if("orientationchange"!==e){var n=this._callbacks,r=n.indexOf(t);i?r<0&&(n.push(t),this._nbCallbacks++):r>=0&&(n.splice(r,1),this._nbCallbacks--),1===this._nbCallbacks&&window.addEventListener(e,this._update),0===this._nbCallbacks&&window.removeEventListener(e,this._update)}else i?this._target.addEventListener(e,t):this._target.removeEventListener(e,t)},onDeviceOrientation:function(e){this.populateEvent(e,this._event)},populateEvent:function(e,t){t.absolute=e.absolute,t.alpha=e.alpha,t.beta=e.beta,t.gamma=e.gamma,t.screenOrientation=window.orientation},isEventRegistered:function(e){if("deviceorientation"===e.type){if(null===e.alpha||void 0===e.alpha)return!1}else if(null===window.orientation||void 0===window.orientation)return!1;return!0},poll:function(){if(this._nbCallbacks)for(var e=0;e<this._callbacks.length;e++)this._callbacks[e](this._event)}}),"osgViewer","InputSourceDeviceOrientation");const Ta=xa;var wa=function(e){fa.call(this,e),this._defaultRatio=o.K4.fromValues(1,1),this._hammerEvents=["pan","pinch","press","rotate","swipe","doubletap","doubletap2fingers","singletap"],this._supportedEvents=["touchstart","touchend","touchcancel","touchmove"],this._hammer=new(st().Manager)(e),this._hammer.add(new(st().Pan)),this._hammer.add(new(st().Pinch)),this._hammer.get("pan").set({threshold:0,pointers:0});var t=this._hammer.get("pinch");t.set({threshold:.1,enable:!1}),t.recognizeWith(this._hammer.get("pan")),this._hammer.add(new(st().Tap)({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),this._hammer.add(new(st().Tap)({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),this._hammer.add(new(st().Tap)({event:"singletap",pointers:1,taps:1,time:250,interval:450,threshold:5,posThreshold:20}))};a.Z.createPrototypeObject(wa,a.Z.objectInherit(fa.prototype,{getName:function(){return"TouchScreen"},setEnable:function(e,t,i){this._isNativeEvent(e)?i?this._target.addEventListener(e,t,{passive:!0}):this._target.removeEventListener(e,t,{passive:!0}):(e.indexOf("pinch")>=0&&i&&this._hammer.get("pinch").set({enable:!0}),i?this._hammer.on(e,t):this._hammer.off(e,t))},populateEvent:function(e,t){if(this._isNativeEvent(e.type)){t.canvasX=t.canvasY=0;for(var i=e.touches.length?e.touches:e.changedTouches,n=i.length,r=0;r<n;++r)t.canvasX+=i[r].clientX/n,t.canvasY+=i[r].clientY/n;t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.altKey=e.altKey,t.metaKey=e.metaKey,t.pointers=e.touches}else t.canvasX=e.center.x,t.canvasY=e.center.y,t.scale=e.scale,t.rotation=e.rotation,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaTime=e.deltaTime,t.direction=e.direction,t.offsetDirection=e.offsetDirection,t.pointers=e.pointers,t.velocity=e.velocity;var a=this._target.getBoundingClientRect();t.canvasX+=-a.left,t.canvasY+=-a.top;var o=this._inputManager.getParam("pixelRatio");o||(o=this._defaultRatio),t.glX=t.canvasX*o[0],t.glY=(this._target.clientHeight-t.canvasY)*o[1]},_isNativeEvent:function(e){return this._supportedEvents.indexOf(e)>=0},isEventRegistered:function(e,t){if(e.pointerType&&"touch"!==e.pointerType)return!1;if(!t.action)return!0;if(isNaN(t.action))throw"touch action should be a number representing the number of touches";var i=e.pointers;i||(i=e.touches);var n=parseInt(t.action);if("touchend"===e.type||"touchcancel"===e.type){if(i.length>=n)return!1}else if(i.length!==n)return!1;return!0},supportsEvent:function(e){var t=fa.prototype.supportsEvent.call(this,e);if(t)return t;for(var i=0;i<this._hammerEvents.length;i++){var n=this._hammerEvents[i];if(0===e.indexOf(n))return!0}return!1},getHammer:function(){return this._hammer}}),"osgViewer","InputSourceTouchScreen");const Ma=wa;var Ra=i("UvG5"),Ba=i("DynT"),Na=i("FFaL"),Da=i("5Cxy"),Pa=i("b5Bu"),Fa="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,Oa=function(e,t,i){vr.Z.call(this),this._startTick=br.Z.instance().tick(),this._stats=void 0,this._running=!1,this._canvas=e;var n=this.initOptions(t),r=this.initWebGLContext(e,n,i);if(!r)throw"No WebGL implementation found";this._updateVisitor=new Er.Z,this.setUpView(r.canvas,n),this.initInputManager(n,e),this.initStats(n,e),this._vrSession=null,this._vrSupported=!1,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._options=n,this._contextLost=!1,this._forceRestoreContext=!0,this.renderBinded=this.render.bind(this)};a.Z.createPrototypeObject(Oa,a.Z.objectInherit(vr.Z.prototype,{initInputManager:function(e,t){var i=new da;this._inputManager=i,this._initInputSource(_a,"Mouse",t,e),this._initInputSource(Ca,"Keyboard",document,e),Fa&&this._initInputSource(Ma,"TouchScreen",t,e),this._initInputSource(Ea,"WebVR",void 0,e),this._initInputSource(Ta,"DeviceOrientation",void 0,e),navigator.getGamepads&&this._initInputSource(Ia,"GamePad",void 0,e),i.addMappings({"viewer.internals:vrSupported":"vrsupported"},function(){this.setVRSupported(!0)}.bind(this)),i.addMappings({"viewer.internals:hmdConnect":"vrdisplayconnected"},function(){this.setVRReady(!0)}.bind(this)),i.addMappings({"viewer.internals:hmdConnectPolyfill":"vrpolyfilled"},function(){this.setVRPolyfilled(!0)}.bind(this)),i.setParam("pixelRatio",[this._devicePixelRatio,this._devicePixelRatio])},_initInputSource:function(e,t,i,n){var r=n.InputSources?n.InputSources[t]:void 0;if(r){if(!1!==r.enable){var a=r.sourceElement||i;this._inputManager.registerInputSource(new e(a,r))}}else this._inputManager.registerInputSource(new e(i))},getInputManager:function(){return this._inputManager},initOptions:function(e){var t=new Cr.Z;return e&&t.extend(e),t.extendWithOptionsURL(),!0===t.getBoolean("traceLogCall")&&(P.Z.traceLogCall=!0),!0===t.getBoolean("enableFrustumCulling")&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),t.xrCompatible=!Pa.d,t},initWebGLContext:function(e,t,i){t.get("SimulateWebGLLostContext")&&((e=Tr.makeLostContextSimulatingCanvas(e)).loseContextInNCalls(t.get("SimulateWebGLLostContext")),this._canvas=e);var n=xr.Z.setupWebGL(e,t,i);return e.addEventListener("webglcontextlost",function(e){this.contextLost(),!1!==this._forceRestoreContext&&e.preventDefault()}.bind(this),!1),e.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(P.Z.reportWebGLError||t.get("reportWebGLError"))&&(n=Tr.makeDebugContext(n)),this.initWebGLCaps(n),this.setGraphicContext(n),n},setContextLostCallback:function(e){this._contextLostCallback=e,this._contextLost&&(this._forceRestoreContext=e())},setContextRestoreCallback:function(e){this._contextRestoreCallback=e},contextLost:function(){P.Z.log("webgl context lost"),this._contextLostCallback&&(this._forceRestoreContext=this._contextLostCallback()),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){!1!==this._forceRestoreContext?(this.restoreContext(),P.Z.log("webgl context restored")):P.Z.log("webgl context restore not supported - please reload the page - ")},restoreContext:function(){var e=this.getGraphicContext();un.Z.onLostContext(e),ln.Z.onLostContext(e),Y.Z.onLostContext(e),Ir.Z.onLostContext(e),on.Z.onLostContext(e),je.Z.getTextureManager(e).onLostContext(e),yr.Z.onLostContext(e),this.getCamera().getRenderer().getState().resetCaches(),this.initWebGLCaps(e,!0),this.setGraphicContext(e),Sr.Z.instance(this.getGraphicContext(),!0),this._stats&&this._stats.reset(),this._contextLost=!1,this._requestRedraw=!0,this._contextRestoreCallback&&this._contextRestoreCallback(e),this._runImplementation()},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(e){var t=Sr.Z.instance(this.getGraphicContext());e.getBoolean("stats")?(this._stats=new zr(this,e),this._stats.addConfig(Wr),this._stats.addConfig(aa),this._stats.addConfig(ua),this.getCamera().addChild(this._stats.getNode()),t.setCallback(this.callbackTimerGPU.bind(this))):t.disable()},callbackTimerGPU:function(e,t){this._stats&&this._stats.getCounter(t).set(e/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getState()._frameStamp=this._frameStamp,this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var e=this._stats,t=Sr.Z.instance(this.getGraphicContext()),i=this.getCamera().getRenderer();if(e&&e.getCounter("cull").start(),i.cull(),e&&e.getCounter("cull").end(),t.pollQueries(),t.start("glframe"),e&&e.getCounter("render").start(),i.draw(),e&&e.getCounter("render").end(),t.end("glframe"),e){var n=i.getCullVisitor();e.getCounter("cullcamera").set(n._numCamera),e.getCounter("cullmatrixtransform").set(n._numMatrixTransform),e.getCounter("cullprojection").set(n._numProjection),e.getCounter("cullnode").set(n._numNode),e.getCounter("culllightsource").set(n._numLightSource),e.getCounter("cullgeometry").set(n._numGeometry),e.getCounter("pushstateset").set(i.getState()._numPushStateSet),e.getCounter("applyStateSet").set(i.getState()._numApply)}}},updateTraversal:function(){var e=this._stats;e&&e.getCounter("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),e&&e.getCounter("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),e&&e.getCounter("update").end()},advance:function(e){var t=e;void 0===t&&(t=Number.MAX_VALUE);var i=this._frameStamp,n=i.getFrameNumber();i.setFrameNumber(n+1);var r=br.Z.instance().deltaS(this._startTick,br.Z.instance().tick());i.setReferenceTime(r);var a=i.getSimulationTime();i.setSimulationTime(t===Number.MAX_VALUE?r:t),i.setDeltaTime(i.getSimulationTime()-a)},beginFrame:function(){var e=this._stats;e&&(e.getCounter("frame").start(),e.getCounter("raf").tick(),e.getCounter("fps").frame())},endFrame:function(){this._stats&&(je.Z.getTextureManager(this.getGraphicContext()).updateStats(this._stats),this._stats.getCounter("stats").start(),this._stats.update(),this._stats.getCounter("stats").end(),this._stats.getCounter("frame").end())},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(e,t){if(!this._contextLost){this.beginFrame(),this.advance();var i=this.updateViewport(),n={};this._vrSession&&(n.frame=t,n.xrReferenceSpace=this._xrReferenceSpace,this._xrFrame=t),this._inputManager.update(n),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),o._E.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||i)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame()}},stop:function(){this._running=!1},isRunning:function(){return this._running},render:function(e,t){this.isRunning()&&(this._requestID=this._requestAnimationFrame(this.renderBinded),this.frame(e,t))},_runImplementation:function(){this.render()},run:function(){this.isRunning()||(this._running=!0,this._runImplementation())},setVRSupported:function(e){e&&console.log("Webxr, is supported!"),this._vrSupported=!!e},setVRReady:function(e){e&&console.log("Found the VR DISPLAY"),this._vRReady=!!e},isVRSupported:function(){return this._vrSupported},setVRPolyfilled:function(e){console.log("Webxr supported through polyfill"),this._vrPolyfilled=!!e},getVRSession:function(){return this._vrSession},getXRPose:function(e){if(this._xrFrame)return this._xrFrame.getPose(e,this._xrReferenceSpace)},needsVRPolyFill:function(){return!!this._vrPolyfilled&&!this._vrPolyfillLoaded},loadWebxrPolyFill:function(){return i.e(5332).then(function(){window.WebXRPolyfill=i("YwCn")}.bind(null,i)).catch(i.oe).then(function(){return new window.WebXRPolyfill.default,this._vrPolyfillLoaded=!0,this.getInputManager().getInputSource("WebVR").pollHeadset().then(function(){this.setVRSupported(!0),this.setVRReady(!0)}.bind(this)).catch(function(e){return this.setVRSupported(!1),this.setVRReady(!1),Ne().reject(e)}.bind(this))}.bind(this))},_getVRPixelRatio:function(e){return(0,Da.Z)().vrScaleRtt>0?(0,Da.Z)().maxDevicePixelRatio:window.XRWebGLLayer.getNativeFramebufferScaleFactor(e)},setPresentVR:function(e){if(!this.isVRSupported())return P.Z.warn("VR not supported by the browser!"),Ne().reject("VR not supported by the browser!");if(!this._vRReady)return P.Z.log("VR headset not plugged in or immersive session not supported!"),Ne().reject("VR headset not plugged in or immersive session not supported!");var t,i=function(e){return this._xrReferenceSpace=e,window.cancelAnimationFrame(this._requestID),this._requestAnimationFrame=this._vrSession.requestAnimationFrame.bind(this._vrSession),this._requestID=this._requestAnimationFrame(this.renderBinded),this.getCamera().frameBufferObject=new on.Z,this.getCamera().frameBufferObject.setFrameBufferObject(this,t.framebuffer),this._vrSession}.bind(this),n=function(e){this._vrSession=e;var n=1/this._getVRPixelRatio(e);return t=new window.XRWebGLLayer(this._vrSession,this.getGraphicContext(),{framebufferScaleFactor:n}),this._vrSession.updateRenderState({baseLayer:t}),e.requestReferenceSpace("local").then(i).catch((function(e){return e}))}.bind(this);if(e)return this._vrSession?Ne().resolve(this._vrSession):navigator.xr.requestSession("immersive-vr").then(n).catch((function(e){return console.log(e),e}));if(this._vrSession){this._vrSession.cancelAnimationFrame(this._requestID),this.getCamera().frameBufferObject=new on.Z,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._requestID=this._requestAnimationFrame(this.renderBinded);var r=this._vrSession.end();return this._vrSession=void 0,r}},setupManipulator:function(e){void 0===e&&(e=new Ji({inputManager:this._inputManager})),void 0!==e.setNode?e.setNode(this.getSceneData()):e.view=this,e.setCamera(this.getCamera()),this.setManipulator(e)},updateViewport:function(){var e=this.getGraphicContext().canvas;if(!this.computeCanvasSize(e))return!1;var t=this.getCamera(),i=t.getViewport(),n=i.width(),r=i.height(),a=e.width/n,s=e.height/r,l=a/s;return i.setViewport(Math.round(i.x()*a),Math.round(i.y()*s),Math.round(i.width()*a),Math.round(i.height()*s)),1!==l&&o._E.mul(t.getProjectionMatrix(),t.getProjectionMatrix(),o._E.fromScaling(o._E.create(),[1/l,1,1])),!0},setManipulator:function(e){this.setEnableManipulator(!1),e.getCamera()||e.setCamera(this.getCamera()),e.setEnable(!0),vr.Z.prototype.setManipulator.call(this,e)},setEnableManipulator:function(e){this._manipulator&&this._manipulator.setEnable(e)},dispose:function(){Ra.Z.clean(),Ba.Z.clean(),Na.Z.pooledStateGraph.clean()}}),"osgViewer","Viewer");const La=Oa;var ka=i("tUi5"),Za={};Za.Renderer=_r.Z,Za.View=vr.Z,Za.Viewer=La,Za.Scene=ka.Z,Za.InputGroups=Bt.Z;const Ua=Za;var Va=i("OKjT"),Qa=i("QrwD"),Ga=function(e,t){Qa.Z.call(this),this._enable=!e,this._shadowReceiveAttribute=t,this._dirtyHash=!0,this._hash=""};a.Z.createPrototypeStateAttribute(Ga,a.Z.objectInherit(Qa.Z.prototype,{attributeType:"ShadowCast",cloneType:function(){return new Ga(!0)},setReceiveAttribute:function(e){this._shadowReceiveAttribute=e},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){return this._shadowReceiveAttribute.getDefines()},_computeInternalHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getPrecision()},getHash:function(){return this._shadowReceiveAttribute&&this._shadowReceiveAttribute._dirtyHash&&(this._receiveAttributeDirty=!0),this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute");const Ha=Ga;var za=i("vHSS"),Wa=i("1lj/"),ja=function(e){j.Z.call(this),this._noCastMask=e,this._nodeList=[]};a.Z.createPrototypeObject(ja,a.Z.objectInherit(j.Z.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(e){var t=e.getNodeMask();-1===t?(t=this._noCastMask,e.setNodeMask(t),this._nodeList.push(e)):0!=(t&~this._noCastMask)&&(e.setNodeMask(t|this._noCastMask),this._nodeList.push(e))},apply:function(e){var t=e.getStateSet();if(t){var i=t.getAttribute("BlendFunc");if(void 0!==i&&i.getSource()!==qe.Z.DISABLE){var n=t.getAttribute("Depth");if(n&&(n.getFunc()===tn.Z.DISABLE||!1===n.getWriteMask()))return void this.removeNodeFromCasting(e)}}e.getTypeID()!==za.Z.typeID&&e.getTypeID()!==Wa.Z.typeID?e.getTypeID()===an.Z.typeID&&e.isRenderToTextureCamera()?this.removeNodeFromCasting(e):this.traverse(e):this.removeNodeFromCasting(e)},setNoCastMask:function(e){this._noCastMask=e},restore:function(){for(var e=0,t=this._nodeList.length;e<t;e++){var i=this._nodeList[e],n=i.getNodeMask();n===this._noCastMask?i.setNodeMask(-1):i.setNodeMask(n&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor");const qa=ja;var Ja,Ya=i("U7nq"),Ka=i("BW96"),Xa=function(){j.Z.call(this,j.Z.TRAVERSE_ALL_CHILDREN),this._pooledMatrix=new Ya.Z(o._E.create),this._matrixStack=new Ka.Z,this._matrixStack.push(o._E.IDENTITY),this._bb=new Qr.Z,this._bs=new lt.Z};a.Z.createPrototypeObject(Xa,a.Z.objectInherit(j.Z.prototype,{reset:function(e,t,i,n,r){this.setTraversalMask(e),this._cameraFrustum=i,this._lightFrustum=r,this.getCameraPlaneMaskForLightNear(t,i,n?6:4),this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(o._E.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(e,t,i){var n,r=1,a=15;for(n=0;n<i;++n)a=a<<1|1;var o=t.getPlanes();for(n=0;n<i;++n)gt.Z.distanceToPlane(o[n],e)<0&&(a^=r),r<<=1;return this._cameraPlaneMaskedByLightNear=a,t.setResultMask(a),t.pushCurrentMask(a),a},applyTransform:function(e){var t=this._pooledMatrix.getOrCreateObject();o._E.copy(t,this._matrixStack.back()),e.computeLocalToWorldMatrix(t,this);var i=this._bs;e.getBound().transformMat4(this._bs,t),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(i))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(i))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(t),this.traverse(e),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:(Ja=new Qr.Z,function(e){var t=this._matrixStack.back();o._E.exactEquals(t,o._E.IDENTITY)?this._bb.expandByBoundingBox(e):e.valid()&&(e.transformMat4(Ja,t),this._bb.expandByBoundingBox(Ja))}),apply:function(e){var t=e.getTypeID();if(e instanceof ze.Z)this.applyTransform(e);else if(t!==Le.Z.getTypeID())t===an.Z.getTypeID()||za.Z.getTypeID(),this.traverse(e);else{var i=this._bs;if(e.getBound().transformMat4(i,this._matrixStack.back()),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(i))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(i))return;this.applyBoundingBox(e.getBoundingBox())}},pushMatrix:function(e){this._matrixStack.push(e)},popMatrix:function(){this._matrixStack.pop()}}),"osgShadow","ComputeMultiFrustumBoundsVisitor");const $a=Xa;var eo=i("EMUO"),to=function(e,t){Qa.Z.call(this),this._lightNumber=e,this._bias=.001,this._normalBias=void 0,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._jitterOffset="none",this._enable=!t,this._isAtlasTexture=!1,this._dirtyHash=!0,this._hash=""};to.uniforms={},a.Z.createPrototypeStateAttribute(to,a.Z.objectInherit(Qa.Z.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new to(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(e){return"u"+(this.getType()+this.getLightNumber().toString())+"_"+e},getAtlas:function(){return this._isAtlasTexture},setAtlas:function(e){this._isAtlasTexture=e},setBias:function(e){this._bias=e},getBias:function(){return this._bias},setNormalBias:function(e){this._normalBias=e},getNormalBias:function(){return this._normalBias},setJitterOffset:function(e){this._jitterOffset=e},getJitterOffset:function(){return this._jitterOffset},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(e){this._kernelSizePCF=e,this._dirtyHash=!0},setPrecision:function(e){this._precision=e,this._dirtyHash=!0},getPrecision:function(){return this._precision},setLightNumber:function(e){this._lightNumber=e,this._dirtyHash=!0},getOrCreateUniforms:function(){var e=to,t=this.getTypeMember();return e.uniforms[t]||(e.uniforms[t]={bias:nn.Z.createFloat(this.getUniformName("bias")),normalBias:nn.Z.createFloat(this.getUniformName("normalBias"))}),e.uniforms[t]},getDefines:function(){var e=[];switch(this.getKernelSizePCF()){case"4Tap(16texFetch)":e.push("#define _PCFx4");break;case"9Tap(36texFetch)":e.push("#define _PCFx9");break;case"16Tap(64texFetch)":e.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":e.push("#define _PCFx1")}return"UNSIGNED_BYTE"!==this.getPrecision()&&e.push("#define _FLOATTEX"),this.getAtlas()&&e.push("#define _ATLAS_SHADOW"),this.getNormalBias()&&e.push("#define _NORMAL_OFFSET"),"none"!==this.getJitterOffset()&&e.push("#define _JITTER_OFFSET"),e},apply:function(){if(this._enable){var e=this.getOrCreateUniforms();e.normalBias.setFloat(this._normalBias),e.bias.setFloat(this._bias)}},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this.getKernelSizePCF()}}),"osgShadow","ShadowReceiveAttribute");const io=to;var no=function(){F.Z.call(this),this._shadowedScene=void 0,this._dirty=!1,this._continuousUpdate=!0,this._needRedraw=!0};a.Z.createPrototypeObject(no,a.Z.objectInherit(F.Z.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setContinuousUpdate:function(e){this._continuousUpdate=e},isContinuousUpdate:function(){return this._continuousUpdate},needRedraw:function(){return this._needRedraw},requestRedraw:function(){this._needRedraw=!0},setShadowedScene:function(e){this._shadowedScene=e},init:function(){P.Z.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){P.Z.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique");const ro=no;var ao=function(){je.Z.call(this),this._uniforms={},this._mapSize=o.vh.create(),this._renderSize=o.K4.create(),this._lightNumber=-1,this._dirtyHash=!0,this._hash=""};ao.uniforms={},a.Z.createPrototypeStateAttribute(ao,a.Z.objectInherit(je.Z.prototype,{cloneType:function(){return new ao},invalidate:function(){je.Z.prototype.invalidate.call(this),this.dirty()},hasLightNumber:function(e){return this._lightNumber===e},setLightNumber:function(e){this._lightNumber=e,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},getUniformName:function(e){return"u"+("Shadow_"+this.getType()+this._lightNumber.toString())+"_"+e},setInternalFormatType:function(e){je.Z.prototype.setInternalFormatType.call(this,e),this._dirtyHash=!0},getOrCreateUniforms:function(e){var t=ao;if(P.Z.assert(void 0!==e),P.Z.assert(-1!==this._lightNumber),void 0!==t.uniforms[e])return t.uniforms[e];var i=t.uniforms[e]={ViewRight:nn.Z.createFloat4(this.getUniformName("viewRight")),ViewUp:nn.Z.createFloat4(this.getUniformName("viewUp")),ViewLook:nn.Z.createFloat4(this.getUniformName("viewLook")),Projection:nn.Z.createFloat3(this.getUniformName("projection")),DepthRange:nn.Z.createFloat2(this.getUniformName("depthRange")),MapSize:nn.Z.createFloat4(this.getUniformName("mapSize")),RenderSize:nn.Z.createFloat2(this.getUniformName("renderSize"))},n="Texture"+e,r=nn.Z.createInt1(e,n);return i[n]=r,t.uniforms[e]},setViewMatrix:function(e){this._viewMatrix=e},setProjection:function(e){this._projection=e},setDepthRange:function(e){this._depthRange=e},setTextureSize:function(e,t){je.Z.prototype.setTextureSize.call(this,e,t),this.dirty(),this._mapSize[0]=e,this._mapSize[1]=t,this._mapSize[2]=1/e,this._mapSize[3]=1/t,this._renderSize[0]=1/e,this._renderSize[1]=1/t},_updateViewMatrixUniforms:function(e,t,i,n){var r,a=e;(r=t.getInternalArray())[0]=a[0],r[1]=a[4],r[2]=a[8],r[3]=a[12],(r=i.getInternalArray())[0]=a[1],r[1]=a[5],r[2]=a[9],r[3]=a[13],(r=n.getInternalArray())[0]=a[2],r[1]=a[6],r[2]=a[10],r[3]=a[14]},apply:function(e,t){if(je.Z.prototype.apply.call(this,e,t),-1!==this._lightNumber){var i=this.getOrCreateUniforms(t);this._updateViewMatrixUniforms(this._viewMatrix,i.ViewRight,i.ViewUp,i.ViewLook),i.Projection.setFloat3(this._projection),i.DepthRange.setFloat2(this._depthRange),i.MapSize.setFloat4(this._mapSize),i.RenderSize.setFloat2(this._renderSize)}},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this._lightNumber+"_"+this._type}}),"osgShadow","ShadowTexture");const oo=ao;var so=i("9YK+"),lo=function(e){this._shadowTechnique=e};a.Z.createPrototypeObject(lo,{cull:function(e,t){this._shadowTechnique.getShadowedScene().nodeTraverse(t);var i=t.getCurrentCullingSet(),n=t.getCurrentProjectionMatrix(),r=t.getComputedNear(),a=t.getComputedFar();return r===1/0&&a===-1/0?(this._shadowTechnique.markSceneAsNoShadow(),!1):(o._E.getFrustumPlanes(i.getFrustum().getPlanes(),n,t.getCurrentModelViewMatrix(),!1),i.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(i.getFrustum(),r,a),!1)}},"osgShadow","CameraCullCallback");var uo=function(e,t){ro.call(this),this._projectionMatrix=o._E.create(),this._projection=o.R3.create(),this._viewMatrix=o._E.create(),this._lightNumberArrayIndex=-1,this._lightUp=o.R3.fromValues(0,0,1),this._light=e.light,this._cameraShadow=new an.Z,this._cameraShadow.setCullCallback(new lo(this)),this._cameraShadow.setRenderOrder(an.Z.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(ir.Z.ABSOLUTE_RF),this._cameraShadow.setClearColor(o.vh.fromValues(1,1,1,1)),t?this._texture=t:(this._texture=new oo,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0),this._textureSize=256;var i=nn.Z.createFloat2("RenderSize");this._texelSizeUniform=nn.Z.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._receivingStateset=void 0,this._casterStateSet=new rn.Z,this._casterStateSet.addUniform(nn.Z.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(nn.Z.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(nn.Z.createFloat1(.005,"bias")),this._casterStateSet.addUniform(this._texelSizeUniform),this._casterStateSet.addUniform(i),this._casterStateSet.setAttributeAndModes(new tn.Z(tn.Z.LESS),Qa.Z.ON|Qa.Z.OVERRIDE),this._casterStateSet.setAttributeAndModes(new qe.Z,Qa.Z.ON|Qa.Z.OVERRIDE),this._shadowReceiveAttribute=new io(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,Qa.Z.ON|Qa.Z.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var n=nn.Z.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(n),this._depthRange=n.getInternalArray(),this._depthRange[0]=.001,this._depthRange[1]=1e3,this._worldLightPos=o.vh.create(),this._worldLightPos[3]=0,this._worldLightDir=o.vh.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._tmpVec=o.R3.create(),this._tmpVecBis=o.R3.create(),this._tmpVecTercio=o.R3.create(),this._tmpMatrix=o._E.create(),e&&this.setShadowSettings(e),this._infiniteFrustum=!0;var r=new Ha(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(r,Qa.Z.ON|Qa.Z.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,Qa.Z.OVERRIDE|Qa.Z.ON),this._debug=!1};a.Z.createPrototypeObject(uo,a.Z.objectInherit(ro.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(e,t,i){this._lightFrustum=e,this._depthRange[0]=t,this._depthRange[1]=i,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),o._E.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(e){this._textureUnitBase=e,this._textureUnit=e},setShadowSettings:function(e){e&&(this._light=e.light,this._shadowCastShaderGeneratorName=e.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(e.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(e.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(e.textureSize),this.setTexturePrecision(e.textureType),this.setKernelSizePCF(e.kernelSizePCF),this.setBias(e.bias),this.setNormalBias(e.normalBias))},setCastsShadowDrawTraversalMask:function(e){this._castsShadowDrawTraversalMask=e},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(e){this._castsShadowBoundsTraversalMask=e},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getNormalBias:function(){return this._shadowReceiveAttribute.getNormalBias()},setNormalBias:function(e){this._shadowReceiveAttribute.setNormalBias(e)},getJitterOffset:function(){return this._shadowReceiveAttribute.getJitterOffset()},setJitterOffset:function(e){this._shadowReceiveAttribute.setJitterOffset(e)},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(e){this._shadowReceiveAttribute.setBias(e),this._casterStateSet.getUniformList().bias.getUniform().setFloat(e)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(e){this._shadowReceiveAttribute.setKernelSizePCF(e)},setShadowedScene:function(e){ro.prototype.setShadowedScene.call(this,e),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var e=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==e&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),this._texture&&!this._texture.hasLightNumber(e)&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},_rebindFbo:function(){this._cameraShadow.detachAll(),this._cameraShadow.attachTexture(on.Z.COLOR_ATTACHMENT0,this._texture),this._cameraShadow.attachRenderBuffer(on.Z.DEPTH_ATTACHMENT,on.Z.DEPTH_COMPONENT16)},init:function(e,t,i){if(this._shadowedScene){this._needRedraw=!0,this.checkLightNumber();var n=this._light.getLightNumber();e?(this._texture=e,this._lightNumberArrayIndex=t,this._textureUnit=i,this._shadowReceiveAttribute.setAtlas(!0)):(this.initTexture(),this._rebindFbo(),this._textureUnit=this._textureUnitBase+n,this._texture.setLightNumber(n),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setAtlas(!1)),this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._shadowReceiveAttribute.setLightNumber(n);var r=Qa.Z.OVERRIDE|Qa.Z.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,r),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,je.Z.textureNull,Qa.Z.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,r),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var e=eo.Z.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),t=0;t<e;t++)this._casterStateSet.setTextureAttributeAndModes(t,je.Z.textureNull,Qa.Z.OVERRIDE|Qa.Z.ON)},valid:function(){return!0},updateShadowTechnique:function(e,t,i){var n=this._cameraShadow,r=this._texture;if(n&&r){var a=n.getViewport();if(a||(a=new sn.Z,n.setViewport(a)),t){var o=n.getScissor();o||(o=new so.Z(t[0],t[1],t[2],t[3]),n.setScissor(o)),a.x()===t[0]&&a.y()===t[1]&&a.width()===t[2]&&a.height()===t[3]||(n.setFrameBufferObject(i),a.setViewport(t[0],t[1],t[2],t[3]),o.setScissor(t[0],t[1],t[2],t[3]))}else a.width()===r.getWidth()&&a.height()===r.getHeight()||(this._rebindFbo(),a.setViewport(0,0,r.getWidth(),r.getHeight()))}},updateShadowTechnic:function(){P.Z.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),this.updateShadowTechnique()},setTextureFiltering:function(){var e;switch(this.getTexturePrecision()){case"HALF_FLOAT":e=je.Z.HALF_FLOAT;break;case"FLOAT":e=je.Z.FLOAT;break;default:case"UNSIGNED_BYTE":e=je.Z.UNSIGNED_BYTE}this._texture.setInternalFormatType(e),this._texture.setMinFilter(je.Z.NEAREST),this._texture.setMagFilter(je.Z.NEAREST),this._textureMagFilter=je.Z.NEAREST,this._textureMinFilter=je.Z.NEAREST},initTexture:function(){var e;this._dirty&&(this._texture||(this._texture=new oo,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize,e=je.Z.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(e),this._texture.setWrapS(je.Z.CLAMP_TO_EDGE),this._texture.setWrapT(je.Z.CLAMP_TO_EDGE),this._texture.dirty())},setTexturePrecision:function(e){e!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(e),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(e){e!==this._textureSize&&(this._textureSize=e,this.dirty())},getCasterStateSet:function(){return this._casterStateSet},setLight:function(e){e&&e!==this._light&&(this._light=e,this.dirty())},getUp:function(e){return Math.abs(o.R3.dot(this._lightUp,e))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var e=this._depthRange[0],t=this._depthRange[1],i=uo.EPSILON;t<e-i?(this._emptyCasterScene=!0,t=1,e=i):e<i&&(e=i),this._depthRange[0]=e,this._depthRange[1]=t},makePerspectiveFromBoundingBox:function(e,t,i,n,r,a){var s=e.center(this._tmpVec),l=e.radius(),u=uo.EPSILON,h=u,c=1;this._radius=l;var A=o.R3.distance(s,i);A<=l?(h=u,c=A+l):(h=A-l,c=A+l),this._depthRange[0]=h,this._depthRange[1]=c,this.nearFarBounding();var d=this._depthRange[0]*Math.tan(t*Math.PI/180),g=d=d>l?l:d,f=-g,p=d,m=-p,_=this.getUp(n);this._infiniteFrustum?o._E.infiniteFrustum(a,m,p,f,g,this._depthRange[0]):o._E.frustum(a,m,p,f,g,this._depthRange[0],this._depthRange[1]),this._projection[0]=this._projectionMatrix[0],this._projection[1]=this._projectionMatrix[5],this._projection[2]=0,o._E.lookAtDirection(r,i,n,_)},makeOrthoFromBoundingBox:function(e,t,i,n){var r=e.center(this._tmpVecTercio),a=e.radius(),s=a+a,l=1e-4,u=s+1e-4,h=this._tmpVec;o.R3.scaleAndAdd(h,r,t,-s);(l=a)<.001*(u+=a)&&(l=.001*u);var c,A,d=this.getUp(t);o._E.lookAtDirection(i,h,t,d),c=A=a,o._E.ortho(n,-c,c,-A,A,l,u),this._projection[0]=c,this._projection[1]=A,this._projection[2]=1,this._depthRange[0]=l,this._depthRange[1]=u},aimShadowCastingCamera:function(e,t){var i=this._light;if(i){var n=this._cameraShadow,r=this._worldLightPos,a=this._worldLightDir;o._E.copy(this._projectionMatrix,n.getProjectionMatrix()),o._E.copy(this._viewMatrix,n.getViewMatrix());for(var s,l=this._projectionMatrix,u=this._viewMatrix,h=e.getCurrentRenderBin().getPositionedAttribute(),c=h.getArray(),A=0;A<h.getLength();A++){var d=c[A],g=d[1],f=d[0];if(g===i){s=f;break}}if(void 0===s)return P.Z.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var p=this._tmpMatrix;if(o._E.invert(p,e.getCurrentModelViewMatrix()),this._light.isDirectionLight())o.vh.transformMat4(r,i.getPosition(),s),o.vh.transformMat4(r,r,p),o.R3.scale(r,r,-1),o.R3.normalize(r,r),this.makeOrthoFromBoundingBox(t,r,u,l),this._debug&&o._E.invert(this._debugNodeFrustum.getMatrix(),u);else{o._E.mul(this._tmpMatrix,p,s);var m=this._tmpMatrix;o.R3.transformMat4(r,i.getPosition(),m),m[12]=0,m[13]=0,m[14]=0,o._E.invert(m,m),o._E.transpose(m,m),o.R3.copy(a,i.getDirection()),o.vh.transformMat4(a,a,m),o.R3.normalize(a,a),this.makePerspectiveFromBoundingBox(t,i.getSpotCutoff(),r,a,u,l)}o._E.copy(n.getProjectionMatrix(),this._projectionMatrix),o._E.copy(n.getViewMatrix(),this._viewMatrix)}else this._emptyCasterScene=!0},frameShadowCastingFrustum:function(e){this._infiniteFrustum||Ge.Z.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],e.getNearFarRatio(),this._depthRange);var t=this._cameraShadow;o._E.copy(t.getProjectionMatrix(),this._projectionMatrix),o._E.copy(t.getViewMatrix(),this._viewMatrix),this.setShadowUniformsReceive(!1)},setShadowUniformsReceive:function(e){if(e&&o.K4.set(this._depthRange,0,0),-1!==this._lightNumberArrayIndex){var t=this._light.getLightNumber();this._texture.setViewMatrix(t,this._viewMatrix),this._texture.setProjection(t,this._projection),this._texture.setDepthRange(t,this._depthRange)}else this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjection(this._projection),this._texture.setDepthRange(this._depthRange)},markSceneAsNoShadow:function(){this.setShadowUniformsReceive(!0),this._needRedraw=!1},cullShadowCasting:function(e,t){if(this._debug){var i=t.getMin(),n=t.getMax();t.center(this._tmpVec);var r=this._debugNodeSceneCast.getMatrix();o._E.fromScaling(r,[n[0]-i[0],n[1]-i[1],n[2]-i[2],1]),o._E.setTranslation(r,this._tmpVec)}if(this._emptyCasterScene=!1,this.aimShadowCastingCamera(e,t),this._emptyCasterScene)this.markSceneAsNoShadow();else{var a=e.getTraversalMask();e.setTraversalMask(this._castsShadowDrawTraversalMask),e.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(e),this._cameraShadow.accept(e),this.nearFarBounding(),this.frameShadowCastingFrustum(e),this._cameraShadow.setComputeNearFar(!1),e.popStateSet(),e.setTraversalMask(a),this._needRedraw=!1}},cleanReceivingStateSet:function(e){if(this._receivingStateset){if(this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),e)return;this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())}},cleanSceneGraph:function(e){this._needRedraw=!0,this.cleanReceivingStateSet(e),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(e){e&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=gn.createDebugFrustumGeometry(),this._debugGeomSceneCast=We.Z.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=pn.Z.LINES,this._debugNode=new ze.Z,this._debugNodeFrustum=new ze.Z,this._debugNodeSceneCast=new ze.Z,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=e},getDebug:function(){return this._debug},getLightNumber:function(){return this._light.getLightNumber()},getLight:function(){return this._light}}),"osgShadow","ShadowMap"),uo.EPSILON=.005;const ho=uo;var co=function(){je.Z.call(this),this._uniforms={},this._lightNumberArray=[],this._viewMatrices=[],this._projection=[],this._depthRanges=[],this._mapSizes=[],this._renderSize=o.K4.create(),this._dirtyHash=!0,this._hash=""};co.uniforms={},a.Z.createPrototypeStateAttribute(co,a.Z.objectInherit(je.Z.prototype,{cloneType:function(){return new co},getLightNumberArray:function(){return this._lightNumberArray},hasLightNumber:function(e){return-1!==this._lightNumberArray.indexOf(e)},setLightNumberArray:function(e){this._lightNumberArray=e,this._dirtyHash=!0},getUniformName:function(e,t){return"u"+("Shadow_"+this.getType()+e.toString())+"_"+t},setInternalFormatType:function(e){je.Z.prototype.setInternalFormatType.call(this,e),this._dirtyHash=!0},createUniforms:function(e,t){t["ViewRight_"+e]=nn.Z.createFloat4(this.getUniformName(e,"viewRight")),t["ViewUp_"+e]=nn.Z.createFloat4(this.getUniformName(e,"viewUp")),t["ViewLook_"+e]=nn.Z.createFloat4(this.getUniformName(e,"viewLook")),t["Projection_"+e]=nn.Z.createFloat3(this.getUniformName(e,"projection")),t["DepthRange_"+e]=nn.Z.createFloat2(this.getUniformName(e,"depthRange")),t["MapSize_"+e]=nn.Z.createFloat4(this.getUniformName(e,"mapSize")),t["RenderSize_"+e]=t.RenderSize},getOrCreateUniforms:function(e){var t=co;if(P.Z.assert(void 0!==e||0!==this._lightNumberArray.length),void 0!==t.uniforms[e])return t.uniforms[e];var i=t.uniforms[e]={},n=nn.Z.createFloat2(this.getUniformName(0,"renderSize"));i.RenderSize=n;for(var r=0,a=this._lightNumberArray.length;r<a;r++)this.createUniforms(this._lightNumberArray[r],i);var o="Texture"+e,s=nn.Z.createInt1(e,o);return i[o]=s,t.uniforms[e]},setViewMatrix:function(e,t){this._viewMatrices[e]=t},setProjection:function(e,t){this._projection[e]=t},setDepthRange:function(e,t){this._depthRanges[e]=t},setLightShadowMapSize:function(e,t){this._mapSizes[e]=t},apply:function(e,t){if(je.Z.prototype.apply.call(this,e,t),0!==this._lightNumberArray.length){for(var i=this.getOrCreateUniforms(t),n=0,r=this._lightNumberArray.length;n<r;n++){var a=this._lightNumberArray[n];i["ViewRight_"+a]||this.createUniforms(a,i),oo.prototype._updateViewMatrixUniforms.call(this,this._viewMatrices[a],i["ViewRight_"+a],i["ViewUp_"+a],i["ViewLook_"+a]),i["Projection_"+a].setFloat3(this._projection[a]),i["DepthRange_"+a].setFloat2(this._depthRanges[a]),i["MapSize_"+a].setFloat4(this._mapSizes[a])}i.RenderSize.setFloat2(this._renderSize)}},setTextureSize:function(e,t){this._renderSize[0]=1/e,this._renderSize[1]=1/t,je.Z.prototype.setTextureSize.call(this,e,t),this.dirty()},_computeInternalHash:function(){for(var e=this.getTypeMember(),t=0,i=this._lightNumberArray.length;t<i;t++)e+="_"+this._lightNumberArray[t];return e+="_"+this._type},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash}}),"osgShadow","ShadowTextureAtlas");const Ao=co;var go=function(e){this._lights=[],this._shadowMaps=[],this._viewportDimension=[],ro.apply(this,arguments),this._shadowSettings=e,this._texture=new Ao,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=1024,this._shadowMapSize=256,this._receivingStateset=void 0,e&&(this.setShadowSettings(e),e.atlasSize&&(this._textureSize=e.atlasSize),e.textureSize&&(this._shadowMapSize=e.textureSize)),this._texelSizeUniform=nn.Z.createFloat1(1/this._textureSize,"texelSize");var t=nn.Z.createFloat2("RenderSize");this._renderSize=t.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this._cameraClear=new an.Z,this._cameraClear.setName("shadowAtlasCameraClear"),this._cameraClear.setRenderOrder(an.Z.PRE_RENDER,0),this._cameraClear.setClearColor(o.vh.fromValues(1,1,1,1)),this._cameraClear.setFrameBufferObject(new on.Z),this._cameraClear.setClearMask(0)};a.Z.createPrototypeObject(go,a.Z.objectInherit(ro.prototype,{getTexture:function(){return this._texture},isDirty:function(e){if(void 0!==e)return this._shadowMaps[e].isDirty();for(var t=0,i=this._shadowMaps.length;t<i;t++)if(this._shadowMaps[t].isDirty())return!0;return!1},setTextureUnitBase:function(e){this._textureUnitBase=e,this._textureUnit=e;for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setTextureUnitBase(e)},setShadowSettings:function(e){if(e){this._shadowSettings=e;for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setShadowSettings(e);this.setTextureSize(e.textureSize),this.setTexturePrecision(e.textureType)}},setCastsShadowDrawTraversalMask:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setCastsShadowDrawTraversalMask(e)},getCastsShadowDrawTraversalMask:function(e){return void 0!==e?this._shadowMaps[e].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},setCastsShadowBoundsTraversalMask:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setCastsShadowBoundsTraversalMask(e)},getCastsShadowBoundsTraversalMask:function(e){return void 0!==e?this._shadowMaps[e].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},getNormalBias:function(e){return void 0!==e?this._shadowMaps[e].getNormalBias():0!==this._shadowMaps.length?this._shadowMaps[0].getNormalBias():void 0},setNormalBias:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setNormalBias(e)},getBias:function(e){return void 0!==e?this._shadowMaps[e].getBias():0!==this._shadowMaps.length?this._shadowMaps[0].getBias():void 0},setBias:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setBias(e)},getKernelSizePCF:function(e){return void 0!==e?this._shadowMaps[e].getKernelSizePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getKernelSizePCF():void 0},setKernelSizePCF:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setKernelSizePCF(e)},setShadowedScene:function(e){ro.prototype.setShadowedScene.call(this,e),this._receivingStateset=this._shadowedScene.getReceivingStateSet();for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setShadowedScene(e)},setTexturePrecision:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setTexturePrecision(e)},getTexturePrecision:function(e){return void 0!==e?this._shadowMaps[e].getTexturePrecision():1!==this._shadowMaps.length?this._shadowMaps[0].getTexturePrecision():void 0},setTextureSize:function(e){e!==this._textureSize&&(this._shadowMapSize=e,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this.dirty())},getShadowMap:function(e){return this._shadowMaps[e]},addLight:function(e){if(!e||-1!==this._lights.indexOf(e))return P.Z.warn("no light or light already added"),-1;if(this._lights.length!==this._numShadowWidth*this._numShadowHeight){this._lights.push(e),this._shadowSettings.setLight(e);var t=new ho(this._shadowSettings,this._texture);return this._shadowMaps.push(t),this._shadowedScene&&t.setShadowedScene(this._shadowedScene),this.recomputeViewports(),t}P.Z.warn("can't allocate shadow for light "+e.getLightNumber()+" ShadowAtlas already full ")},init:function(){if(this._shadowedScene){this.initTexture();for(var e=[],t=0;t<this._lights.length;t++)e.push(this._lights[t].getLightNumber());this._texture.setLightNumberArray(e),this._textureUnit=this._textureUnitBase,this._texture.setName("ShadowTexture"+this._textureUnit);var i=nn.Z.createFloat2("RenderSize");this._texelSizeUniform=nn.Z.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this.recomputeViewports();for(var n=0,r=this._shadowMaps.length;n<r;n++){var a=this._shadowMaps[n];this._shadowedScene||(this._shadowedScene=a.getShadowedScene(this._shadowedScene)),this._shadowedScene&&a.setShadowedScene(this._shadowedScene),a.init(this._texture,n,this._textureUnitBase)}}},recomputeViewports:function(){for(var e=this._shadowMaps.length,t=e>2?Math.sqrt(2*Math.ceil(e/2)):e,i=t,n=this._textureSize/i,r=this._textureSize/t,a=this._textureSize/n,s=this._textureSize/r,l=0;l<e;l++){var u=this._shadowMaps[l],h=n*(l%a),c=r*Math.floor(l/s);this._viewportDimension.length<=l?this._viewportDimension.push(o.vh.fromValues(h,c,n,r)):o.vh.set(this._viewportDimension[l],h,c,n,r),this._texture.setLightShadowMapSize(this._lights[l].getLightNumber(),this._viewportDimension[l]),u.dirty()}},valid:function(){return!0},updateCameraClear:function(){var e=this._cameraClear,t=this._texture;if(e&&t){var i=e.getViewport();i||(i=new sn.Z,e.setViewport(i)),i.width()===t.getWidth()&&i.height()===t.getHeight()||(e.detachAll(),e.attachTexture(on.Z.COLOR_ATTACHMENT0,t),e.attachRenderBuffer(on.Z.DEPTH_ATTACHMENT,on.Z.DEPTH_COMPONENT16),e.getViewport().setViewport(0,0,t.getWidth(),t.getHeight()))}},updateShadowTechnique:function(e){this.updateCameraClear();for(var t=this._cameraClear.getFrameBufferObject(),i=0,n=this._shadowMaps.length;i<n;i++)this._shadowMaps[i].updateShadowTechnique(e,this._viewportDimension[i],t)},initTexture:function(){var e;this._dirty&&(this._texture||(this._texture=new Ao,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize,e=je.Z.RGBA,ho.prototype.setTextureFiltering.call(this),this._texture.setInternalFormat(e),this._texture.setWrapS(je.Z.CLAMP_TO_EDGE),this._texture.setWrapT(je.Z.CLAMP_TO_EDGE),this._texture.dirty())},cullShadowCasting:function(e,t){this._cameraClear.accept(e);for(var i=0,n=this._shadowMaps.length;i<n;i++){var r=this._shadowMaps[i];(r.isContinuousUpdate()||r.needRedraw())&&r.cullShadowCasting(e,t)}},isContinuousUpdate:function(){for(var e=0,t=this._shadowMaps.length;e<t;e++)if(this._shadowMaps[e].isContinuousUpdate())return!0;return!1},needRedraw:function(){for(var e=0,t=this._shadowMaps.length;e<t;e++)if(this._shadowMaps[e].needRedraw())return!0;return!1},removeShadowMap:function(e){if(this._shadowMaps.length>0){var t=this._shadowMaps.indexOf(e);if(-1!==t){this._shadowMaps[t].valid()&&this._shadowMaps[t].cleanSceneGraph(!0),this._shadowMaps.splice(t,1);var i=this._texture.getLightNumberArray();-1!==(t=i.indexOf(e.getLightNumber()))&&i.splice(t,1);var n=e.getLight();-1!==(t=this._lights.indexOf(n))&&this._lights.splice(t,1),this._viewportDimension.length>t&&this._viewportDimension.splice(t,1),this.recomputeViewports()}}},addShadowMap:function(e){if(!(this._shadowMaps.length>0&&-1!==this._shadowMaps.indexOf(e))){this._shadowMaps.push(e);var t=e.getLight();-1===this._lights.indexOf(t)&&this._lights.push(t),this._shadowedScene&&e.setShadowedScene(this._shadowedScene);var i=this._texture.getLightNumberArray();-1===i.indexOf(e.getLightNumber())&&i.push(t.getLightNumber()),this.recomputeViewports()}},cleanReceivingStateSet:function(){if(this._receivingStateset){this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember());for(var e=0,t=this._shadowMaps.length;e<t;e++)this._shadowMaps[e].cleanReceivingStateSet()}},cleanSceneGraph:function(){this._texture=void 0,this._shadowedScene=void 0},setDebug:function(e,t){if(t)this._shadowMaps[t].setDebug(e);else for(var i=0,n=this._shadowMaps.length;i<n;i++)this._shadowMaps[i].setDebug(e)},markSceneAsNoShadow:function(){for(var e=0,t=this._shadowMaps.length;e<t;e++)this._shadowMaps[e].markSceneAsNoShadow()}}),"osgShadow","ShadowMapAtlas");const fo=go;var po=function(e){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=je.Z.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Tap(4texFetch)",this.bias=.005,this.normalBias=void 0,this.shadowCastShaderGeneratorName="ShadowCast",a.Z.objectMix(this,e)};po.kernelSizeList=["1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)"],po.prototype={setCastsShadowDrawTraversalMask:function(e){this.castsShadowDrawTraversalMask=e},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(e){this.castsShadowBoundsTraversalMask=e},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(e){this.light=e},getLight:function(){return this.light},setTextureSize:function(e){this.textureSize=e},getTextureSize:function(){return this.textureSize},setTextureType:function(e){this.textureType=e},getTextureType:function(){return this.textureType},setTextureFormat:function(e){this.textureFormat=e},getTextureFormat:function(){return this.textureFormat},setShadowCastShaderGeneratorName:function(e){this.shadowCastShaderGeneratorName=e},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}};const mo=po;var _o=i("10ce"),vo=function(e){Je.Z.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[o.vh.create(),o.vh.create(),o.vh.create(),o.vh.create(),o.vh.create(),o.vh.create()],this._tmpMat=o._E.create(),this._receivingStateset=new rn.Z,this._computeBoundsVisitor=new _o.Z,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,e&&this.setShadowSettings(e)};a.Z.createPrototypeNode(vo,a.Z.objectInherit(Je.Z.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(e){this._shadowTechniques.length>0&&-1!==this._shadowTechniques.indexOf(e)||(this._shadowTechniques.push(e),e.valid()&&(e.setShadowedScene(this),e.dirty()))},removeShadowTechnique:function(e){if(this._shadowTechniques.length>0){var t=this._shadowTechniques.indexOf(e);-1!==t&&(this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph(),this._shadowTechniques.splice(t,1))}},cleanSceneGraph:function(){for(var e=0,t=this._shadowTechniques.length;e<t;e++)this._shadowTechniques[e]&&this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph()},dirty:function(){for(var e=0;e<this._shadowTechniques.length;e++)this._shadowTechniques[e].dirty()},nodeTraverse:function(e){Je.Z.prototype.traverse.call(this,e)},setShadowSettings:function(e){this._settings=e,this.setCastsShadowDrawTraversalMask(e.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(e.castsShadowBoundsTraversalMask),!1!==e.userShadowCasterVisitor&&(this._removeNodesNeverCastingVisitor=e.userShadowCasterVisitor||new qa(this._castsShadowTraversalMask))},setCastsShadowDrawTraversalMask:function(e){this._castsShadowDrawTraversalMask=e},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(e){this._castsShadowBoundsTraversalMask=e},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},computeShadowedSceneBounds:function(){return this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.accept(this._computeBoundsVisitor),!!this._computeBoundsVisitor.getBoundingBox().valid()||(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),!1)},traverse:function(e){if(e.getVisitorType()===j.Z.CULL_VISITOR){var t,i,n=this._shadowTechniques.length;n&&e.pushStateSet(this._receivingStateset),this.nodeTraverse(e),n&&e.popStateSet();var r=!1;for(t=0;t<n;t++)(i=this._shadowTechniques[t])&&i.valid()&&(i.isDirty()&&(r=!0,i.init()),(i.isContinuousUpdate()||i.needRedraw())&&(r=!0));if(!r)return;if(!this.computeShadowedSceneBounds(e)){for(t=0;t<n;t++)(i=this._shadowTechniques[t]).markSceneAsNoShadow();return}var a=this._computeBoundsVisitor.getBoundingBox(),o=e.getCurrentModelMatrix();for(a.transformMat4(a,o),t=0;t<n;t++)((i=this._shadowTechniques[t]).isContinuousUpdate()||i.needRedraw())&&(i.updateShadowTechnique(e),i.cullShadowCasting(e,a));this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore()}else this.nodeTraverse(e)}}),"osgShadow","ShadowedScene"),Ge.Z.registerApplyFunction(vo.nodeTypeID,Ge.Z.getApplyFunction(Je.Z.nodeTypeID));const Co=vo;var bo={};bo.ShadowCastAttribute=Ha,bo.ShadowReceiveAttribute=io,bo.ShadowCasterVisitor=qa,bo.ShadowFrustumIntersection=$a,bo.ShadowMap=ho,bo.ShadowMapAtlas=fo,bo.ShadowedScene=Co,bo.ShadowSettings=mo,bo.ShadowTechnique=ro,bo.ShadowTexture=oo,bo.ShadowTextureAtlas=Ao;const So=bo;const Eo={Stats:zr,BufferStats:Br,Graph:Mr,TextGenerator:Or,Counter:Pr,defaultStats:Wr,browserStats:ua,glStats:aa};var yo={};yo.Text=Ke;const Io=yo;var xo={};xo.osg=Oe,xo.osgAnimation=Qe,xo.osgText=$e;const To=xo;var wo=i("BfDR"),Mo=S.createQuatChannel,Ro=S.createVec3Channel,Bo=S.createFloatChannel,No=function(){this._filesMap=void 0,this._loadedFiles=void 0,this._bufferViewCache=void 0,this._basicAnimationManager=void 0,this._visitedNodes=void 0,this._animatedNodes=void 0,this._bones=void 0,this._skeletonToInfluenceMap=void 0,this._inputImgReader=void 0,this._localPath="",this._extensions=[],this._nodeAnimationTypes=void 0,this.init()};No.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},No.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},No.ATTRIBUTE_OSGJS_TABLE={POSITION:"Vertex",NORMAL:"Normal",TANGENT:"Tangent",TEXCOORD_0:"TexCoord0",TEXCOORD_1:"TexCoord1",TEXCOORD_2:"TexCoord2",TEXCOORD_3:"TexCoord3",TEXCOORD_4:"TexCoord4",TEXCOORD_5:"TexCoord5",TEXCOORD_6:"TexCoord6",TEXCOORD_7:"TexCoord7",TEXCOORD_8:"TexCoord8",TEXCOORD_9:"TexCoord9",TEXCOORD_10:"TexCoord10",TEXCOORD_11:"TexCoord11",TEXCOORD_12:"TexCoord12",TEXCOORD_13:"TexCoord13",TEXCOORD_14:"TexCoord14",TEXCOORD_15:"TexCoord15",COLOR_0:"Color",JOINTS_0:"Bones",WEIGHTS_0:"Weights"},No.TEXTURE_FORMAT={6406:je.Z.ALPHA,6407:je.Z.RGB,6408:je.Z.RGBA,6409:je.Z.LUMINANCE,6410:je.Z.LUMINANCE_ALPHA},No.TYPE_CHANNEL_PATH={translation:{VEC3:Ro},scale:{VEC3:Ro},rotation:{VEC4:Mo},weights:{SCALAR:Bo}},No.TYPE_STACKED_TRANSFORMS={translation:ye,scale:Se,rotation:_e},No.PBR_SPEC_EXT="KHR_materials_pbrSpecularGlossiness",No.PBR_SPEC_MODE="PBR_specular_glossiness",No.PBR_METAL_MODE="PBR_metal_roughness",No.ALBEDO_TEXTURE_UNIT=2,No.DIFFUSE_TEXTURE_UNIT=2,No.SPECULAR_GLOSSINESS_TEXTURE_UNIT=3,No.METALLIC_ROUGHNESS_TEXTURE_UNIT=3,No.SPECULAR_TEXTURE_UNIT=4,No.NORMAL_TEXTURE_UNIT=5,No.AO_TEXTURE_UNIT=6,No.EMISSIVE_TEXTURE_UNIT=7,No.ALBEDO_UNIFORM="albedoMap",No.METALLIC_ROUGHNESS_UNIFORM="metallicRoughnessMap",No.SPECULAR_UNIFORM="specularMap",No.NORMAL_UNIFORM="normalMap",No.AO_UNIFORM="aoMap",No.EMISSIVE_UNIFORM="emissiveMap",No.prototype={init:function(){this._glTFJSON=void 0,this._nodeAnimationTypes=[],this._bufferViewCache={},this._basicAnimationManager=void 0,this._localPath="",this._visitedNodes={},this._animatedNodes={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._filesMap={},this._inputReader=new we.Z,this._rootStateSet=new rn.Z,this._defaultBlendFunc=new qe.Z,this._transparentBlendFunc=new qe.Z("SRC_ALPHA","ONE_MINUS_SRC_ALPHA"),this._defaultCullFace=new en.Z,this._doubleSideCullFace=new en.Z(en.Z.DISABLE)},_preProcessNodes:function(){for(var e,t=this._gltfJSON.nodes,i=this._gltfJSON.meshes,n=0;n<t.length;n++){var r=t[n];e=r.name||"",e+="_"+n.toString(),r.osgjsNodeName=e;var a=r.children;if(a)for(var o=0;o<a.length;o++){t[a[o]].parent=n}}for(var s=0;s<i.length;s++){var l=i[s];e=l.name||"",e+="_"+s.toString(),l.osgjsNodeName=e}},loadBuffers:Ne().method((function(){for(var e=[],t=this._gltfJSON.buffers,i=0;i<t.length;i++){var n=t[i];e.push(this.loadURI(n.uri,{responseType:"arraybuffer"}).then((function(e){n.data=e})))}return Ne().all(e)})),loadBufferViews:function(){for(var e=this._gltfJSON.buffers,t=this._gltfJSON.bufferViews,i=0;i<t.length;i++){var n=t[i],r=e[n.buffer],a=n.byteLength||0,o=n.byteOffset||0;n.data=r.data.slice(o,o+a)}},loadAccessors:function(){for(var e=this._gltfJSON.bufferViews,t=this._gltfJSON.accessors,i=0;i<t.length;i++){var n,r=t[i],a=e[r.bufferView],o=No.TYPE_TABLE[r.type],s=No.WEBGL_COMPONENT_TYPES[r.componentType],l=s.BYTES_PER_ELEMENT*o,u=a.byteStride,h=!0===r.normalized;if(u&&u!==l)P.Z.warn("GLTF interleaved accessors not supported");else{var c=new s(a.data,r.byteOffset,r.count*o);(n=new Y.Z(void 0,c,o)).setNormalize(h)}r.data=n}},_computeNodeMatrix:function(e){var t;if(e.matrix)t=o._E.clone(e.matrix);else if(e.translation||e.rotation||e.scale){var i=o._E.IDENTITY,n=o._E.IDENTITY,r=o._E.IDENTITY;e.translation&&(i=o._E.fromTranslation(o._E.create(),e.translation)),e.rotation&&(n=o._E.fromQuat(o._E.create(),e.rotation)),e.scale&&(r=o._E.fromScaling(o._E.create(),e.scale)),t=o._E.create(),o._E.multiply(t,n,r),o._E.multiply(t,i,t)}return t},loadNodes:function(){for(var e=this._gltfJSON.nodes,t=this._gltfJSON.skins,i=this._gltfJSON.meshes,n=0;n<e.length;n++){var r=e[n];if(!r.usedAsBone){if(void 0!==r.skin){var a=t[r.skin],o=a.osgjsNode;a.osgjsNodeAttached||(r.osgjsNode=o,a.osgjsNodeAttached=n);var s=i[r.mesh];s.osgjsGeometry.setBoneNameID(a.osgjsBoneMapID),o.addChild(s.osgjsGeometry)}else(r.matrix||r.translation||r.rotation||r.scale)&&(r.osgjsNode=this._createMatrixTransform(n)),void 0!==r.mesh&&(r.osgjsNode?r.osgjsNode.addChild(i[r.mesh].osgjsGeometry):r.osgjsNode=i[r.mesh].osgjsGeometry),r.osgjsNode||(r.osgjsNode=new Je.Z);r.name&&r.osgjsNode.setName(r.name)}}},_linkNodes:function(e){var t=this._gltfJSON.nodes,i=e.children;if(i)for(var n=0;n<i.length;n++){var r=t[i[n]];if(!r.usedAsBone){var a=r.osgjsNode;a&&!e.osgjsNode.hasChild(a)&&(e.osgjsNode.addChild(a),this._linkNodes(r))}}},loadSkins:function(){var e=this._gltfJSON.skins;if(e)for(var t=0;t<e.length;t++)this._processSkin(t)},loadScenes:function(){var e=this._gltfJSON.nodes,t=this._gltfJSON.scenes;this._osgjsScene=[];for(var i=0;i<t.length;i++){for(var n=t[i].nodes,r=[],a=0;a<n.length;a++){var o=e[n[a]];this._linkNodes(o),r.push(o.osgjsNode)}var s=r[0];if(r.length>1){s=new Je.Z;for(var l=0;l<r.length;l++)s.addChild(r[l])}this._osgjsScene.push(s)}},_assignGeometryAttributes:function(e,t,i){var n=this._gltfJSON.accessors;for(var r in t){var a=n[t[r]],o=No.ATTRIBUTE_OSGJS_TABLE[r];void 0!==i&&(o+="_"+i.toString()),e.getVertexAttributeList()[o]=a.data,a.data._target=Y.Z.ARRAY_BUFFER}},_assignGeometryPrimitives:function(e,t){var i=this._gltfJSON.accessors[t.indices];i.data._target=Y.Z.ELEMENT_ARRAY_BUFFER;var n=void 0!==t.mode?t.mode:pn.Z.TRIANGLES,r=new wn.Z(n,i.data);e.getPrimitiveSetList().push(r)},_getMorphTargetName:function(e,t){return e.osgjsNodeName+"_target_"+t.toString()},_computeAbsoluteMorphData:function(e,t){var i=this._gltfJSON.accessors;for(var n in t){var r=i[t[n]];if(!r.morphAbsoluteComputed){r.morphAbsoluteComputed=!0;for(var a=i[e[n]].data.getElements(),o=r.data.getElements(),s=a.length,l=0;l<s;l++)o[l]+=a[l]}}},_processMorphGeometry:function(e,t){var i=e.primitives[t],n=new X.Z,r=new te;r.setName(e.osgjsNodeName),n.setName(e.osgjsNodeName);for(var a=0;a<i.targets.length;a++){this._computeAbsoluteMorphData(i.attributes,i.targets[a]);var o=this._getMorphTargetName(e,a),s=new Le.Z;s.setName(o),r.addTarget(o,a),this._assignGeometryAttributes(s,i.targets[a]),n.getMorphTargets().push(s)}this._assignGeometryAttributes(n,i.attributes),this._assignGeometryPrimitives(n,i),n.mergeChildrenVertexAttributeList(),e.osgjsMorphGeometry=n,e.osgjsUpdateMorph=r},loadMeshes:function(){for(var e=this._gltfJSON.meshes,t=this._gltfJSON.materials,i=0;i<e.length;i++){for(var n=e[i],r=n.name,a=[],o=0;o<n.primitives.length;o++){var s=void 0,l=n.primitives[o],u=void 0;if(l.targets&&l.targets.length&&(this._processMorphGeometry(n,o),s=n.osgjsMorphGeometry,u=n.osgjsUpdateMorph),l.attributes.JOINTS_0){var h=new K.Z;s||(s=new Le.Z,this._assignGeometryAttributes(s,l.attributes),this._assignGeometryPrimitives(s,l));var c=new Qr.Z;s.computeBoundingBox(c),h.setBound(c),h.setSourceGeometry(s),h.mergeChildrenData(),s=h}s||(s=new Le.Z,this._assignGeometryAttributes(s,l.attributes),this._assignGeometryPrimitives(s,l)),r&&s.setName(r),u&&s.addUpdateCallback(u);var A=t[l.material].osgjsStateSet;s.setStateSet(A),s.setUserData(A.getUserData()),a.push(s)}if(a.length>1){for(var d=new Je.Z,g=0;g<a.length;g++)d.addChild(a[g]);s=d}n.osgjsGeometry=s}},loadImages:function(){var e=this._gltfJSON.images;if(!e)return Ne().resolve();for(var t=[],i=0;i<e.length;i++){var n=e[i],r=window.decodeURI(n.uri),a=this.loadURI(r).then(function(e){var t=new wo.Z;t.setImage(e),this.osgjsImage=t}.bind(n));t.push(a)}return Ne().all(t)},_texture:function(e){var t=this._gltfJSON.textures,i=this._gltfJSON.images,n=t[e.index],r=i[n.source];if(n.osgjsTexture)return n.osgjsTexture;var a=new je.Z;if(n.osgjsTexture=a,a.setFlipY(!1),a.setWrapS("REPEAT"),a.setWrapT("REPEAT"),r.osgjsImage){var o=No.TEXTURE_FORMAT[n.format];a.setImage(r.osgjsImage,o)}return a},_pbrMetallicRoughnessTextureUniforms:function(){var e=this._rootStateSet;if(!e.getUniformList()[No.ALBEDO_UNIFORM]){var t=nn.Z.createInt(No.ALBEDO_TEXTURE_UNIT,No.ALBEDO_UNIFORM),i=nn.Z.createInt(No.METALLIC_ROUGHNESS_TEXTURE_UNIT,No.METALLIC_ROUGHNESS_UNIFORM);e.addUniform(t),e.addUniform(i)}},_pbrMetallicRoughness:function(e,t){var i;if(t.setUserData({pbrWorklow:No.PBR_METAL_MODE}),this._pbrMetallicRoughnessTextureUniforms(),e.baseColorTexture)i=this._texture(e.baseColorTexture),t.setTextureAttributeAndModes(No.ALBEDO_TEXTURE_UNIT,i);else if(e.baseColorFactor){var n=nn.Z.createFloat4(e.baseColorFactor,"uBaseColorFactor");t.addUniform(n)}if(void 0!==e.metallicFactor){var r=nn.Z.createFloat1(e.metallicFactor,"uMetallicFactor");t.addUniform(r)}if(void 0!==e.roughnessFactor){var a=nn.Z.createFloat1(e.roughnessFactor,"uRoughnessFactor");t.addUniform(a)}e.metallicRoughnessTexture&&(i=this._texture(e.metallicRoughnessTexture),t.setTextureAttributeAndModes(No.METALLIC_ROUGHNESS_TEXTURE_UNIT,i))},_KHR_materials_pbrSpecularGlossinessTextureUniforms:function(){if(!this._extensions.KHR_materials_pbrSpecularGlossinessTextureUniforms){this._extensions.KHR_materials_pbrSpecularGlossinessTextureUniforms=!0;var e=this._rootStateSet,t=nn.Z.createInt(No.DIFFUSE_TEXTURE_UNIT,No.ALBEDO_UNIFORM),i=nn.Z.createInt(No.SPECULAR_GLOSSINESS_TEXTURE_UNIT,No.METALLIC_ROUGHNESS_UNIFORM),n=nn.Z.createInt(No.SPECULAR_TEXTURE_UNIT,No.SPECULAR_UNIFORM);e.addUniform(t),e.addUniform(i),e.addUniform(n)}},_KHR_materials_pbrSpecularGlossiness:function(e,t){var i,n;if(t.setUserData({pbrWorklow:No.PBR_SPEC_MODE}),this._KHR_materials_pbrSpecularGlossinessTextureUniforms(),e.diffuseTexture?(i=this._texture(e.diffuseTexture),t.setTextureAttributeAndModes(No.DIFFUSE_TEXTURE_UNIT,i)):e.diffuseFactor&&(n=nn.Z.createFloat4(e.diffuseFactor,"uBaseColorFactor"),t.addUniform(n)),e.specularFactor&&(n=nn.Z.createFloat3(e.specularFactor,"uSpecularFactor"),t.addUniform(n)),void 0!==e.glossinessFactor){var r=nn.Z.createFloat(e.glossinessFactor,"uGlossinessFactor");t.addUniform(r)}e.specularGlossinessTexture&&(i=this._texture(e.specularGlossinessTexture),t.setTextureAttributeAndModes(No.SPECULAR_GLOSSINESS_TEXTURE_UNIT,i))},loadMaterials:function(){var e=this._gltfJSON.materials,t=!1,i=!1,n=this._rootStateSet;n.addUniform(nn.Z.createInt(No.EMISSIVE_TEXTURE_UNIT,No.EMISSIVE_UNIFORM)),n.addUniform(nn.Z.createInt(No.AO_TEXTURE_UNIT,No.AO_UNIFORM)),n.addUniform(nn.Z.createInt(No.NORMAL_TEXTURE_UNIT,No.NORMAL_UNIFORM)),n.addUniform(nn.Z.createFloat3(o.R3.ZERO,"uEmissiveFactor"));for(var r=0;r<e.length;r++){var a,s=e[r],l=new rn.Z;s.osgjsStateSet=l,s.pbrMetallicRoughness?this._pbrMetallicRoughness(s.pbrMetallicRoughness,l):s.extensions.KHR_materials_pbrSpecularGlossiness&&this._KHR_materials_pbrSpecularGlossiness(s.extensions.KHR_materials_pbrSpecularGlossiness,l),s.normalTexture&&(a=this._texture(s.normalTexture),l.setTextureAttributeAndModes(No.NORMAL_TEXTURE_UNIT,a)),s.occlusionTexture&&(a=this._texture(s.occlusionTexture),l.setTextureAttributeAndModes(No.AO_TEXTURE_UNIT,a)),s.emissiveTexture&&(a=this._texture(s.emissiveTexture),l.setTextureAttributeAndModes(No.EMISSIVE_TEXTURE_UNIT,a)),s.emissiveFactor&&l.addUniform(nn.Z.createFloat3(s.emissiveFactor,"uEmissiveFactor")),"BLEND"===s.alphaMode&&(t=!0,l.setAttributeAndModes(this._transparentBlendFunc),l.setRenderingHint("TRANSPARENT_BIN")),s.doubleSided&&(i=!0,l.setAttributeAndModes(this._doubleSideCullFace))}t&&n.setAttributeAndModes(this._defaultBlendFunc),i&&n.setAttributeAndModes(this._defaultCullFace)},_createBone:function(e){var t=this._gltfJSON.nodes[e];t.usedAsBone=!0;var i=this._nodeAnimationTypes,n=new ue.Z,r=t.osgjsNodeName;n.setName(r);var a=this._computeNodeMatrix(t)||o._E.IDENTITY;n.setMatrix(a);var s=new ie.Z;if(s.setName(n.getName()),n.addUpdateCallback(s),i[e]){var l=s.getStackedTransforms();for(var u in i[e]){var h=new(0,No.TYPE_STACKED_TRANSFORMS[u])(u);l.push(h)}}return s.setMatrix(a),n},_createMatrixTransform:function(e){var t=this._gltfJSON.nodes[e],i=this._nodeAnimationTypes,n=new ze.Z,r=t.osgjsNodeName;n.setName(r);var a=this._computeNodeMatrix(t)||o._E.IDENTITY;if(n.setMatrix(a),i[e]){var s=new ne.Z;s.setName(n.getName()),n.addUpdateCallback(s),s.setMatrix(a);var l=s.getStackedTransforms();for(var u in i[e]){var h=new(0,No.TYPE_STACKED_TRANSFORMS[u])(u);l.push(h)}}return n},_processSkin:function(e){var t,i=this._gltfJSON.skins,n=this._gltfJSON.nodes,r=i[e],a=r.joints;void 0!==r.inverseBindMatrices&&(t=this._gltfJSON.accessors[r.inverseBindMatrices].data.getElements().buffer);var o,s=new Ae.Z;r.osgjsNode=s,s.setName("skin ID "+e);for(var l,u={},h={},c=0;c<a.length;c++){if(o=a[c],l=this._createBone(o),void 0!==r.inverseBindMatrices){var A=new Float32Array(t,16*c*4,16);l.setInvBindMatrixInSkeletonSpace(A)}u[o]=l,h[l.getName()]=c}for(var d in r.osgjsBoneMapID=h,u){var g=n[d].parent;if(l=u[d],void 0===g||-1===a.indexOf(g))s.addChild(l);else u[g].addChild(l)}},loadAnimations:function(){var e=this._gltfJSON.animations;if(e){for(var t=this._gltfJSON.accessors,i=this._nodeAnimationTypes,n=this._gltfJSON.nodes,r=this._gltfJSON.meshes,a=[],o=0;o<e.length;o++){for(var s=e[o].channels,l=e[o].samplers,u=[],h=0;h<s.length;h++){var c=s[h],A=l[c.sampler],d=t[A.input].data.getElements(),g=t[A.output],f=g.data.getElements(),p=c.target,m=No.TYPE_CHANNEL_PATH[p.path][g.type],_=void 0!==p.node?p.node:p.id,v=n[_],C=p.path,b=n[_].osgjsNodeName;if("weights"===C)for(var S=r[v.mesh],E=S.primitives[0].targets.length,y=d.length,x=0;x<E;x++){for(var T=new Float32Array(y),w=0;w<y;w++)T[w]=f[w*E+x];b=this._getMorphTargetName(S,x),u.push(m(T,d,b,x))}else u.push(m(f,d,b,C));i[_]||(i[_]={}),i[_][C]=!0}var M="animation-"+o.toString();a.push(I.createAnimation(u,M))}var R=new le;R.init(a),this._animationManager=R}},loadURI:Ne().method((function(e,t){if("data:"===e.substr(0,5))return function(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),r=0;r<i;r++)n[r]=t.charCodeAt(r);return n.buffer}(e);var i=this._filesMap[e];return void 0!==i?i:tt.Z.requestURI(e,t)})),readNodeURL:function(e,t){var i=this;if(this.init(),t&&void 0!==t.filesMap&&Object.keys(t.filesMap).length>0){this._filesMap=t.filesMap;var n=this._filesMap[e];return this.readJSON(n,e)}var r=e.lastIndexOf("/");return this._localPath=-1===r?"":e.substr(0,r+1),tt.Z.requestURI(e).then((function(e){return i.readJSON(e)}))},readJSON:Ne().method((function(e,t){return this._gltfJSON=e,Ne().all([this.loadBuffers(),this.loadImages()]).then(function(){this.loadBufferViews(),this.loadAccessors(),this._preProcessNodes(),this.loadMaterials(),this.loadMeshes(),this.loadAnimations(),this.loadSkins(),this.loadNodes(),this.loadScenes();var e=new ze.Z;return e.addChild(this._osgjsScene[0]),e.setName(t),this._animationManager&&e.addUpdateCallback(this._animationManager),e.setStateSet(this._rootStateSet),e}.bind(this))}))},et.Z.instance().addReaderWriter("gltf",new No);const Do=No;var Po=window.JSZip,Fo=function(){this._options=void 0,this._filesMap={},this._fileName=""};Fo.prototype={readNodeURL:function(e,t){if(void 0===Po)return P.Z.error("You need to add JSZip as a dependency"),Ne().reject(this);P.Z.log("starting to read: "+e);var i=this;if(t&&void 0!==t.filesMap&&void 0!==t.filesMap[e]){var n=t.filesMap[e];return this.readZipFile(n).then((function(){return i._fileName?Me.Z.readNodeURL(i._fileName,{filesMap:i._filesMap}):Ne().reject(i)}))}return tt.Z.requestURI(e,{responseType:"blob"}).then((function(e){i.readZipFile(e).then((function(){return Me.Z.readNodeURL(i._fileName,{filesMap:i._filesMap})}))}))},readZipFile:function(e){tt.Z.unzip(e).then(function(e){for(var t in e){var i=tt.Z.getExtension(t);if(void 0!==et.Z.instance().getReaderWriterForExtension(i)||"osgjs"===i){this._fileName=t;break}}}.bind(this))}},et.Z.instance().addReaderWriter("zip",new Fo);const Oo=Fo;var Lo={};Lo.ReaderWriterGLTF=Do,Lo.ReaderWriterZIP=Oo;const ko=Lo;var Zo=i("S1Ss"),Uo=n.Z;Uo.osg=r.Z,Uo.osgAnimation=Te,Uo.osgDB=at,Uo.osgGA=$i,Uo.osgUtil=mr,Uo.osgViewer=Ua,Uo.osgShader=Va.Z,Uo.osgShadow=So,Uo.osgStats=Eo,Uo.osgText=Io,Uo.osgWrappers=To,Uo.osgPlugins=ko,Uo.InputGroups=Ua.InputGroups,Uo.globalify=function(){window.osg=Uo.osg,window.osgAnimation=Uo.osgAnimation,window.osgDB=Uo.osgDB,window.osgGA=Uo.osgGA,window.osgUtil=Uo.osgUtil,window.osgViewer=Uo.osgViewer,window.osgShader=Uo.osgShader,window.osgShadow=Uo.osgShadow,window.osgStats=Uo.osgStats,window.osgText=Uo.osgText,window.osgWrappers=Uo.osgWrappers,window.osgPlugins=Uo.osgPlugins,window.InputGroups=Uo.InputGroups},(0,Zo.c)(Uo);const Vo=Uo;(0,i("+wA4").Z)(),X.Z.EFFECTIVE_EPS=(0,Da.Z)().morphEpsilon;const Qo=Vo},N96t:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i("uuWb"),r=n.Z.osg,a=function(){r.ComputeBoundsVisitor.call(this),this._minBox=new r.BoundingBox,this._visitedBuffers={}};r.createPrototypeObject(a,r.objectInherit(r.ComputeBoundsVisitor.prototype,{getPreciseBox:function(){return this._minBox},apply:function(e){if(e instanceof r.Transform)this.applyTransform(e);else{if(e instanceof r.Geometry){var t=this._matrixStack.getLength()>0?this._matrixStack.back():r.mat4.IDENTITY,i=e.getVertexAttributeList().Vertex,n=this._visitedBuffers[i.getInstanceID()];if(n&&r.mat4.exactEquals(n.matrix,t))return;var a=e.computeTransformedVertices?e.computeTransformedVertices():i.getElements();this._visitedBuffers[i.getInstanceID()]={buffer:a,matrix:r.mat4.copy(r.mat4.create(),t)};for(var o=t[0],s=t[1],l=t[2],u=t[3],h=t[4],c=t[5],A=t[6],d=t[7],g=t[8],f=t[9],p=t[10],m=t[11],_=t[12],v=t[13],C=t[14],b=t[15],S=this._minBox.getMin(),E=this._minBox.getMax(),y=S[0],I=S[1],x=S[2],T=E[0],w=E[1],M=E[2],R=0,B=a.length;R<B;R+=3){var N=a[R],D=a[R+1],P=a[R+2],F=u*N+d*D+m*P+b||1,O=(o*N+h*D+g*P+_)/F,L=(s*N+c*D+f*P+v)/F,k=(l*N+A*D+p*P+C)/F;O<y&&(y=O),L<I&&(I=L),k<x&&(x=k),O>T&&(T=O),L>w&&(w=L),k>M&&(M=k)}return S[0]=y,S[1]=I,S[2]=x,E[0]=T,E[1]=w,void(E[2]=M)}this.traverse(e)}}}));const o=a;var s,l,u=i("lVmk"),h=n.Z.osg,c=0,A=new u.Z;const d={BIAS_MIN:.9,BIAS_MAX:1.1,getBoxReady:function(){return A.promise},updateMaxWorldDisplacement:function(e){e<=c||(c=e,this._updateModelBoxes())},getModelBoxWithDisplacement:function(){return s},getModelBoxWithoutDisplacement:function(){return l},_updateModelBoxes:function(){if(s&&0!==c){var e=s.getMin(),t=s.getMax(),i=h.vec3.fromValues(c,c,c);h.vec3.add(t,t,i),h.vec3.sub(e,e,i)}},computePreciseBox:function(e){var t=new o;e.accept(t),l=t.getPreciseBox(),(s=new h.BoundingBox).copy(l),this._updateModelBoxes(),A.resolve()},getMaxDistanceFromOrigin:function(){var e=h.vec3.length(l.getMin()),t=h.vec3.length(l.getMax());return Math.max(e,t)}}},jJ0f:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("N6Kc"),r=i("5sFf"),a=i("uuWb").Z.osg,o=function(e){this._model=void 0!==e?e.model:void 0,this._viewer=void 0!==e?e.viewer:void 0,this._scene=void 0!==e?e.scene:void 0,this._widgetAPI=void 0!==e?e.widgetAPI:void 0,this._features={}};o.prototype={getModel:function(){return this._model},getFeatures:function(){return this._features},getViewer:function(){return this._viewer},getScene:function(){return this._scene},getWidgetAPI:function(){return this._widgetAPI},addFeature:function(e){if(e){var t=e.getName();this._features[t]?a.error("Feature already added"+t):this._features[t]=e}return this._features},getModelByName:function(e){if(e){var t=(0,n.Z)(this._features,(function(t){var i=t.getModel();return!(!i||!i.getName)&&i.getName()===e}));return t?t.getModel():void 0}},getViewsByName:function(e){if(e){var t=[];return(0,r.Z)(this._features,(function(i){if(i){var n=i._views.filter((function(t){return!!t.getName&&t.getName()===e}));Array.prototype.push.apply(t,n)}})),t}}};const s=o},"+HSU":(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("uuWb"),r=i("+eNq"),a=i("MaYM"),o=i("N96t"),s=i("5Cxy"),l=n.Z.osg,u=function(){l.CullVisitor.call(this),this._separateVR=!1,this._isEnv=!1,this._isRootModel=!1},h=u.vrConfig={doVR:!1,framebufferWidth:0,framebufferHeight:0,leftRenderWidth:0,rightRenderWidth:0,leftRenderHeight:0,rightRenderHeight:0,rightProjection:l.mat4.create(),leftProjection:l.mat4.create(),leftOffsetView:l.mat4.create(),rightOffsetView:l.mat4.create()};u.cameraMain=void 0,u.cameraEnvironment=void 0,u.nodePostProcessOut=void 0,u.nodeRootModel=void 0,l.createPrototypeObject(u,l.objectInherit(l.CullVisitor.prototype,{popCameraModelViewProjectionMatrix:function(e){this.popModelViewMatrix(),this.popProjectionMatrix(e)},reset:function(){l.CullVisitor.prototype.reset.call(this),this._minNear=this._computedNear,this._maxFar=this._computedFar},updateNearFar:function(){this._minNear=Math.min(this._minNear,this._computedNear),this._maxFar=Math.max(this._maxFar,this._computedFar)},_handleMainCamera:function(e){var t=this.getCurrentProjectionMatrix(),i=this._computedNear,n=this._computedFar,r=this._nearFarRatio,o=this._projectionMatrixStack.getArray()[0];l.mat4.copy(o,t),this.clampProjectionMatrix(o,this._minNear,this._maxFar,1e-5),h.doVR&&(this.clampProjectionMatrix(h.leftProjection,i,n,r),this.clampProjectionMatrix(h.rightProjection,i,n,r));var s=a.Z.uNearFar.getInternalArray(),u=a.Z.uPreviousNearFar.getInternalArray();u[0]=s[0],u[1]=s[1],this.clampProjectionMatrix(t,i,n,r,s),e.clampedProjectionMatrix?l.mat4.copy(e.clampedProjectionMatrix,t):e.clampedProjectionMatrix=l.mat4.clone(t)},popProjectionMatrix:function(e){if(!0===this._computeNearFar&&this._computedFar>=this._computedNear){var t=e===u.cameraMain;(t||e.getReferenceFrame()===l.Transform.RELATIVE_RF&&!e.isRenderToTextureCamera())&&this.updateNearFar(),t?this._handleMainCamera(e):this.clampProjectionMatrix(this.getCurrentProjectionMatrix(),this._computedNear,this._computedFar,this._nearFarRatio)}l.CullStack.prototype.popProjectionMatrix.call(this)},handleCullCallbacksAndTraverse:function(e){e===u.nodePostProcessOut?this._separateVR=h.doVR:e===u.cameraEnvironment?this._isEnv=!0:e===u.nodeRootModel&&(this._isRootModel=!0);var t=e.getCullCallback();t&&!t.cull(e,this)||this.traverse(e),e===u.nodePostProcessOut?this._separateVR=!1:e===u.cameraEnvironment?this._isEnv=!1:e===u.nodeRootModel&&(this._isRootModel=!1)},pushLeaf:function(e,t){var i=this._currentStateGraph._leafs;0===i.getLength()&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var n=this._separateVR&&this.traversalMask!==r.Z.SHADOW,a=this.createOrReuseRenderLeaf();if(a.isVR=n,n){var o=this._isEnv,s=this.getCurrentModelViewMatrix(),u=this.getCurrentViewMatrix();a.leftProjection=h.leftProjection,a.rightProjection=h.rightProjection;var c=a.leftModelView||l.mat4.create(),A=a.rightModelView||l.mat4.create();a.leftModelView=o?l.mat4.copy(c,s):l.mat4.multiply(c,h.leftOffsetView,s),a.rightModelView=o?l.mat4.copy(A,s):l.mat4.multiply(A,h.rightOffsetView,s);var d=a.leftView||l.mat4.create(),g=a.rightView||l.mat4.create();a.leftView=o?l.mat4.copy(d,u):l.mat4.multiply(d,h.leftOffsetView,u),a.rightView=o?l.mat4.copy(g,u):l.mat4.multiply(g,h.rightOffsetView,u)}a.init(this._currentStateGraph,e,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),t),i.push(a)},updateCalculatedNearFar:function(e,t){var i=o.Z.getModelBoxWithoutDisplacement();if(i&&this._isRootModel){var n=(0,s.Z)().scaleEpsilon*i.radius()/t.getBound().radius();n*=n;var r=e[0],a=e[4],u=e[8];if(r*r+a*a+u*u<n&&(r=e[1])*r+(a=e[5])*a+(u=e[9])*u<n&&(r=e[2])*r+(a=e[6])*a+(u=e[10])*u<n)return!1}return l.CullVisitor.prototype.updateCalculatedNearFar.call(this,e,t)}}),"osgSketchfab","CullVisitor");const c=u},JAIH:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("57NU"),r=function(e){this._views=[],e&&(this._name=e.FeatureName,this._modelName=e.ModelName,this._modelType=e.ModelType,this._viewListType=e.ViewListType.slice(0))};r.prototype={getName:function(){return this._name},getModel:function(){return this._model},addView:function(e){e&&this._views.push(e)},init:function(e){if(this._model||(this._model=e.getModelByName(this._modelName)),!this._model){var t=this._modelType;this._model=new t,this._model.init&&this._model.init(e)}var i=function(t){var i=new t({model:this._model,context:e});this.addView(i)};this._viewListType.forEach((function(e){i.call(this,e)}),this),e.addFeature(this)},prepareForScreenShot:function(){var e=this.getWidgetNode();return!(!e||!e.getNodeMask())&&(this._oldMaskEditorWidget=e.getNodeMask(),e.setNodeMask(0),!0)},resetAfterScreenShot:function(){var e=this.getWidgetNode();e&&e.setNodeMask(this._oldMaskEditorWidget)},getWidgetNode:function(){}},r.create=function(e){var t=function(){r.call(this,t)};return t.prototype=(0,n.Z)({},r.prototype),(0,n.Z)(t,e),t.getName=function(){return e.FeatureName},t};const a=r},k2rr:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var n=i("R4My"),r=i.n(n),a=i("uuWb");const o=JSON.parse('{"$schema":"http://json-schema.org/draft-04/schema#","id":"http://sketchfab.com/schema/modeloptions","title":"Camera settings","description":"Camera position and direction","type":"object","definitions":{"vec2":{"type":"array","minItems":2,"maxItems":2,"items":{"type":"number"}},"vec3":{"type":"array","minItems":3,"maxItems":3,"items":{"type":"number"}},"intVec3":{"type":"array","minItems":3,"maxItems":3,"items":{"type":"integer"}},"vec4":{"type":"array","minItems":4,"maxItems":4,"items":{"type":"number"}},"matrix":{"type":"array","minItems":16,"maxItems":16,"items":{"type":"number"}},"quaternion":{"type":"array","minItems":4,"maxItems":4,"items":{"type":"number"}},"unitVec3":{"type":"array","minItems":3,"maxItems":3,"items":{"$ref":"#/definitions/unitNumber"}},"unitVec3Neg":{"type":"array","minItems":3,"maxItems":3,"items":{"$ref":"#/definitions/unitNumberNeg"}},"unitVec2Neg":{"type":"array","minItems":2,"maxItems":2,"items":{"$ref":"#/definitions/unitNumberNeg"}},"unitVec4":{"type":"array","minItems":4,"maxItems":4,"items":{"$ref":"#/definitions/unitNumber"}},"unitNumber":{"type":"number","minimum":0,"maximum":1},"unitNumberNeg":{"type":"number","minimum":-1,"maximum":1},"uid":{"type":"string","pattern":"^[A-Fa-f0-9]{32}$"},"uuid":{"type":"string","pattern":"^[A-Fa-f0-9]{8}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{12}$"},"hotspotData":{"type":"object","properties":{"geometryUid":{"type":"integer"},"uid":{"$ref":"#/definitions/uid"},"indices":{"$ref":"#/definitions/intVec3"},"barycentricWeights":{"$ref":"#/definitions/vec3"},"localPosition":{"$ref":"#/definitions/vec3"}},"additionalProperties":false,"required":["uid","geometryUid","indices","barycentricWeights","localPosition"]},"soundtrack":{"type":"object","properties":{"uid":{"$ref":"#/definitions/uid"},"name":{"type":"string","default":""},"enable":{"type":"boolean","default":true},"position":{"$ref":"#/definitions/vec3","default":[0,0,0]},"distance":{"type":"number","minimum":0,"default":-1},"distanceMax":{"type":"number","minimum":0,"default":-1},"distanceModel":{"type":"string","default":"exponential"},"startTime":{"type":"number","minimum":0,"default":0},"volume":{"type":"number","minimum":0,"default":1},"ambient":{"type":"boolean","default":true},"loop":{"type":"boolean","default":false},"snap":{"type":"boolean","default":false},"sync":{"type":"boolean","default":false},"geometryUid":{"type":"integer","default":-1},"indices":{"$ref":"#/definitions/intVec3","default":[-1,-1,-1]},"barycentricWeights":{"$ref":"#/definitions/vec3","default":[0,0,0]},"localPosition":{"$ref":"#/definitions/vec3","default":[0,0,0]}},"required":["uid","name","enable","position","distance","distanceMax","distanceModel","startTime","volume","ambient","loop","snap","sync","geometryUid","indices","barycentricWeights","localPosition"],"additionalProperties":false},"light":{"type":"object","properties":{"type":{"type":"string","enum":["NONE","DIRECTION","POINT","SPOT","HEMI"],"default":"NONE"},"enable":{"type":"boolean","default":true},"color":{"$ref":"#/definitions/unitVec3","default":[1,1,1]},"intensity":{"type":"number","minimum":0,"default":1},"ground":{"$ref":"#/definitions/unitVec3","default":[0.3,0.2,0.2]},"intensityGround":{"type":"number","minimum":0,"default":1},"matrix":{"$ref":"#/definitions/matrix"},"falloff":{"type":"number","minimum":0,"default":-1},"attachedToCamera":{"type":"boolean","default":false},"angle":{"type":"number","minimum":0,"maximum":90,"default":45},"hardness":{"$ref":"#/definitions/unitNumber","default":0.5},"castShadows":{"type":"boolean","default":true},"shadowBias":{"$ref":"#/definitions/unitNumber","default":0.005}},"required":["type","enable","color","intensity","ground","intensityGround","matrix","falloff","attachedToCamera","angle","hardness","castShadows","shadowBias"],"additionalProperties":false},"texture":{"type":"object","properties":{"internalFormat":{"type":"string","enum":["RGB","ALPHA","LUMINANCE"]},"magFilter":{"type":"string","enum":["LINEAR","NEAREST"]},"minFilter":{"type":"string","enum":["LINEAR","NEAREST","LINEAR_MIPMAP_LINEAR","NEAREST_MIPMAP_LINEAR"]},"textureTarget":{"type":"string","enum":["TEXTURE_2D"]},"uid":{"$ref":"#/definitions/uid"},"wrapS":{"type":"string","enum":["CLAMP_TO_EDGE","REPEAT","MIRRORED_REPEAT"]},"wrapT":{"type":"string","enum":["CLAMP_TO_EDGE","REPEAT","MIRRORED_REPEAT"]},"texCoordUnit":{"type":"integer","minimum":0}},"required":["internalFormat","magFilter","minFilter","texCoordUnit","textureTarget","uid","wrapS","wrapT"],"additionalProperties":false},"materialChannel":{"type":"object","properties":{"enable":{"type":"boolean"},"factor":{"$ref":"#/definitions/unitNumber"},"color":{"$ref":"#/definitions/unitVec3"},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"oneOf":[{"required":["color"]},{"required":["texture"]}],"required":["enable","factor"],"additionalProperties":false},"materialChannelGrayScale":{"type":"object","properties":{"enable":{"type":"boolean"},"factor":{"$ref":"#/definitions/unitNumber"},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor"],"additionalProperties":false},"cullFace":{"type":"string","enum":["DISABLE","BACK"]},"uvTransforms":{"type":"object","properties":{"scale":{"$ref":"#/definitions/vec2","default":[1,1]},"rotation":{"type":"number","minimum":-6.28318530718,"maximum":6.28318530718,"default":0},"offset":{"$ref":"#/definitions/unitVec2Neg","default":[0,0]}},"required":["scale","rotation","offset"],"additionalProperties":false}},"properties":{"version":{"type":"integer","minimum":0},"background":{"type":"object","properties":{"enable":{"type":"string","enum":["fixed","environment","color","ambient","none"],"default":"color"},"uid":{"$ref":"#/definitions/uid","default":"51af6a870cce449eb75b0345feebaebb"},"color":{"$ref":"#/definitions/unitVec3","default":[0.86667,0.86667,0.86667]}},"additionalProperties":false,"required":["enable","uid","color"]},"lighting":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"lights":{"type":"array","minItems":3,"maxItems":3,"items":{"$ref":"#/definitions/light"},"additionalItems":false}},"additionalProperties":false,"required":["lights","enable"]},"camera":{"type":"object","properties":{"position":{"$ref":"#/definitions/vec3"},"target":{"$ref":"#/definitions/vec3"},"fov":{"type":"number","minimum":0,"maximum":180,"default":45},"nearFarRatio":{"type":"number","minimum":0.0001,"maximum":0.005,"default":0.005},"useCameraConstraints":{"type":"boolean","default":false},"usePanConstraints":{"type":"boolean","default":true},"useZoomConstraints":{"type":"boolean","default":false},"usePitchConstraints":{"type":"boolean","default":false},"useYawConstraints":{"type":"boolean","default":false},"zoomIn":{"type":"number","minimum":0,"default":0},"zoomOut":{"type":"number","minimum":0,"default":-1},"left":{"type":"number","minimum":-3.141593,"maximum":3.141593,"default":-3.141593},"right":{"type":"number","minimum":-3.141593,"maximum":3.141593,"default":3.141593},"up":{"type":"number","minimum":-1.570797,"maximum":1.570797,"default":1.555089},"down":{"type":"number","minimum":-1.570797,"maximum":1.570797,"default":-1.555089}},"additionalProperties":false,"required":["position","target","fov","nearFarRatio","useCameraConstraints","usePanConstraints","useZoomConstraints","usePitchConstraints","useYawConstraints","zoomIn","zoomOut","left","right","up","down"]},"environment":{"type":"object","properties":{"enable":{"type":"boolean"},"backgroundExposure":{"type":"number","minimum":0,"maximum":2,"default":1},"exposure":{"type":"number","minimum":0,"maximum":35},"rotation":{"type":"number","minimum":0,"maximum":6.2831853072,"default":0},"uid":{"$ref":"#/definitions/uid"},"blur":{"type":"number","minimum":0,"maximum":1,"default":0.1},"shadowEnable":{"type":"boolean"},"lightIntensity":{"type":"number","minimum":0,"default":1},"shadowBias":{"type":"number","minimum":0,"default":0.005}},"additionalProperties":false,"required":["enable","backgroundExposure","exposure","rotation","uid","blur","shadowEnable","lightIntensity","shadowBias"]},"materials":{"type":"object","patternProperties":{"^[A-Fa-f0-9]{8}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{12}$":{"type":"object","properties":{"channels":{"type":"object","properties":{"AlphaMask":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"texture":{"$ref":"#/definitions/texture"},"invert":{"type":"boolean","default":false},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor","invert"],"additionalProperties":false},"Opacity":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"type":{"type":"string","enum":["alphaBlend","additive","dithering","refraction"],"default":"alphaBlend"},"invert":{"type":"boolean","default":false},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"ior":{"type":"number","minimum":1,"maximum":2,"default":1.05},"roughnessFactor":{"$ref":"#/definitions/unitNumber","default":0},"useMicrosurfaceTexture":{"type":"boolean","default":true},"useNormalOffset":{"type":"boolean","default":false},"useAlbedoTint":{"type":"boolean"},"thinLayer":{"type":"boolean","default":false},"refractionColor":{"$ref":"#/definitions/unitVec3","default":[1,1,1]}},"required":["enable","factor","type","invert","ior","roughnessFactor","useMicrosurfaceTexture","useAlbedoTint","useNormalOffset","refractionColor","thinLayer"],"additionalProperties":false},"SpecularHardness":{"type":"object","properties":{"enable":{"type":"boolean","default":true},"factor":{"type":"number","minimum":0,"maximum":10000,"default":12.5},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor"],"additionalProperties":false},"BumpMap":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"maximum":10,"default":1},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor"],"additionalProperties":false},"Displacement":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"default":0},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor"],"additionalProperties":false},"SubsurfaceTranslucency":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"thicknessFactor":{"type":"number","minimum":0,"default":-1},"color":{"$ref":"#/definitions/unitVec3","default":[1,0.37,0.3]},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor","thicknessFactor","color"],"additionalProperties":false},"EmitColor":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"maximum":10,"default":0},"color":{"$ref":"#/definitions/unitVec3","default":[1,1,1]},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"type":{"type":"string","enum":["additive","multiplicative"],"default":"additive"}},"oneOf":[{"required":["color"]},{"required":["texture"]}],"required":["enable","factor","type"],"additionalProperties":false},"SubsurfaceScattering":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"default":-1},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"profile":{"type":"integer","minimum":1,"maximum":3,"default":1}},"required":["enable","factor","profile"],"additionalProperties":false},"NormalMap":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"flipY":{"type":"boolean","default":true}},"required":["enable","factor","flipY"],"additionalProperties":false},"AOPBR":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"occludeSpecular":{"type":"boolean","default":false}},"required":["enable","factor","occludeSpecular"],"additionalProperties":false},"Matcap":{"type":"object","properties":{"enable":{"type":"boolean","default":true},"factor":{"$ref":"#/definitions/unitNumber","default":1},"curvature":{"type":"number","minimum":0,"default":0},"color":{"$ref":"#/definitions/unitVec3","default":[1,1,1]},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["texture","color","curvature","enable","factor"],"additionalProperties":false},"ClearCoat":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"tint":{"$ref":"#/definitions/unitVec3","default":[0.914,0.914,0.914]},"thickness":{"type":"number","minimum":0,"maximum":20,"default":5},"reflectivity":{"$ref":"#/definitions/unitNumber","default":0},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"required":["enable","factor","tint","thickness","reflectivity"],"additionalProperties":false},"ClearCoatNormalMap":{"type":"object","properties":{"enable":{"type":"boolean","default":true},"factor":{"$ref":"#/definitions/unitNumber","default":1},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"flipY":{"type":"boolean","default":true}},"required":["enable","factor","flipY"],"additionalProperties":false},"ClearCoatRoughness":{"$ref":"#/definitions/materialChannelGrayScale","default":{"factor":0.04,"enable":true}},"DiffuseColor":{"$ref":"#/definitions/materialChannel","default":{"color":[1,1,1],"factor":1,"enable":true}},"DiffuseIntensity":{"$ref":"#/definitions/materialChannel","default":{"color":[1,1,1],"factor":1,"enable":true}},"SpecularColor":{"$ref":"#/definitions/materialChannel","default":{"color":[0.5,0.5,0.5],"factor":0,"enable":true}},"DiffusePBR":{"$ref":"#/definitions/materialChannel","default":{"color":[1,1,1],"factor":1,"enable":false}},"AlbedoPBR":{"$ref":"#/definitions/materialChannel","default":{"color":[1,1,1],"factor":1,"enable":true}},"SpecularPBR":{"$ref":"#/definitions/materialChannel","default":{"color":[1,1,1],"factor":0.05,"enable":false}},"GlossinessPBR":{"$ref":"#/definitions/materialChannelGrayScale","default":{"factor":0.4,"enable":false}},"RoughnessPBR":{"$ref":"#/definitions/materialChannelGrayScale","default":{"factor":0.6,"enable":true}},"MetalnessPBR":{"$ref":"#/definitions/materialChannelGrayScale","default":{"factor":0,"enable":true}},"Sheen":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"colorFactor":{"$ref":"#/definitions/unitVec3","default":[1,1,1]},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"additionalProperties":false,"required":["enable","factor","colorFactor"]},"SheenRoughness":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"}},"additionalProperties":false,"required":["enable","factor"]},"SpecularF0":{"$ref":"#/definitions/materialChannelGrayScale","default":{"factor":0.5,"enable":true}},"CavityPBR":{"$ref":"#/definitions/materialChannelGrayScale","default":{"factor":1,"enable":false}},"Anisotropy":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1},"direction":{"$ref":"#/definitions/unitNumberNeg","default":0},"texture":{"$ref":"#/definitions/texture"},"UVTransforms":{"$ref":"#/definitions/uvTransforms"},"flipXY":{"type":"boolean","default":true}},"additionalProperties":false,"required":["enable","factor","direction","flipXY"]}},"required":["DiffuseColor","DiffuseIntensity","EmitColor","NormalMap","BumpMap","Displacement","Opacity","SpecularColor","SpecularHardness","DiffusePBR","AlbedoPBR","SpecularPBR","GlossinessPBR","RoughnessPBR","MetalnessPBR","Sheen","SheenRoughness","SpecularF0","AOPBR","CavityPBR","Matcap","SubsurfaceScattering","SubsurfaceTranslucency","ClearCoat","ClearCoatRoughness","ClearCoatNormalMap","Anisotropy","AlphaMask"],"additionalProperties":false},"cullFace":{"$ref":"#/definitions/cullFace","default":"DISABLE"},"id":{"$ref":"#/definitions/uuid","default":"0"},"name":{"type":"string","default":"noname"},"reflection":{"$ref":"#/definitions/unitNumber","default":0.3},"shadeless":{"type":"boolean","default":false},"stateSetID":{"type":"integer","default":0},"version":{"type":"integer","minimum":2}},"required":["channels","cullFace","id","name","reflection","shadeless","stateSetID","version"],"additionalProperties":false}},"properties":{"updatedAt":{"type":"integer"}},"additionalProperties":false},"orientation":{"type":"object","properties":{"matrix":{"$ref":"#/definitions/matrix","default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},"additionalProperties":false,"required":["matrix"]},"scene":{"type":"object","properties":{"sssProfiles":{"type":"array","minItems":3,"maxItems":3,"additionalItems":false,"items":[{"type":"object","properties":{"strength":{"$ref":"#/definitions/unitVec3","default":[0.48,0.41,0.28]},"falloff":{"$ref":"#/definitions/unitVec3","default":[1,0.37,0.3]}},"additionalProperties":false,"required":["strength","falloff"]},{"type":"object","properties":{"strength":{"$ref":"#/definitions/unitVec3","default":[0.38,0.61,0.68]},"falloff":{"$ref":"#/definitions/unitVec3","default":[0.5,0.67,0.6]}},"additionalProperties":false,"required":["strength","falloff"]},{"type":"object","properties":{"strength":{"$ref":"#/definitions/unitVec3","default":[0.88,0.61,0.28]},"falloff":{"$ref":"#/definitions/unitVec3","default":[0.7,0.77,0.3]}},"additionalProperties":false,"required":["strength","falloff"]}]},"postProcess":{"type":"object","properties":{"enable":{"type":"boolean","default":true},"grain":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"animated":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"maximum":0.5,"default":0.15}},"additionalProperties":false,"required":["enable","animated","factor"]},"sharpen":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"maximum":5,"default":0.2}},"additionalProperties":false,"required":["enable","factor"]},"chromaticAberration":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"maximum":0.1,"default":0.05}},"additionalProperties":false,"required":["enable","factor"]},"vignette":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"amount":{"$ref":"#/definitions/unitNumber","default":0.475},"hardness":{"$ref":"#/definitions/unitNumber","default":0.725}},"additionalProperties":false,"required":["enable","amount","hardness"]},"bloom":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"type":"number","minimum":0,"maximum":2,"default":0.5},"threshold":{"$ref":"#/definitions/unitNumber","default":0},"radius":{"$ref":"#/definitions/unitNumber","default":0.7}},"additionalProperties":false,"required":["enable","factor","threshold","radius"]},"toneMapping":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"method":{"type":"string","enum":["default","reinhard","filmic"],"default":"default"},"exposure":{"type":"number","minimum":0,"maximum":2,"default":1},"brightness":{"type":"number","minimum":-1,"maximum":1,"default":0},"contrast":{"type":"number","minimum":-1,"maximum":1,"default":0},"saturation":{"type":"number","minimum":0,"maximum":2,"default":1}},"additionalProperties":false,"required":["enable","method","exposure","brightness","contrast","saturation"]},"colorBalance":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"low":{"$ref":"#/definitions/unitVec3Neg"},"mid":{"$ref":"#/definitions/unitVec3Neg"},"high":{"$ref":"#/definitions/unitVec3Neg"}},"additionalProperties":false,"required":["enable","low","mid","high"]},"dof":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"blurNear":{"$ref":"#/definitions/unitNumber","default":0.5},"blurFar":{"$ref":"#/definitions/unitNumber","default":0.5},"focusPoint":{"$ref":"#/definitions/vec3"}},"additionalProperties":false,"required":["enable","blurNear","blurFar","focusPoint"]},"ssr":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"factor":{"$ref":"#/definitions/unitNumber","default":1}},"additionalProperties":false,"required":["enable","factor"]},"ssao":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"radius":{"type":"number","minimum":0,"default":-1},"intensity":{"type":"number","minimum":0,"maximum":1,"default":0.5},"bias":{"type":"number","minimum":0,"default":-1}},"additionalProperties":false,"required":["enable","radius","intensity","bias"]},"taa":{"type":"object","properties":{"enable":{"type":"boolean","default":true},"transparent":{"type":"boolean","default":true}},"additionalProperties":false,"required":["enable","transparent"]}},"additionalProperties":false,"required":["enable","grain","sharpen","chromaticAberration","vignette","bloom","toneMapping","colorBalance","dof","ssr","ssao","taa"]}},"additionalProperties":false,"required":["sssProfiles","postProcess"]},"shading":{"type":"object","properties":{"renderer":{"type":"string","enum":["classic","pbr"],"default":"classic"},"type":{"type":"string","enum":["lit","shadeless","matcap"],"default":"lit"},"vertexColor":{"type":"object","properties":{"enable":{"type":"boolean","default":true},"useAlpha":{"type":"boolean","default":true},"colorSpace":{"type":"string","enum":["linear","srgb"],"defaul":"srgb"}},"additionalProperties":false,"required":["enable","useAlpha","colorSpace"]},"pointSize":{"type":"number","minimum":0,"maximum":50,"default":0}},"additionalProperties":false,"required":["renderer","type","vertexColor","pointSize"]},"wireframe":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"color":{"type":"string","pattern":"^[A-Fa-f0-9]{8}$","default":"000000FF"}},"additionalProperties":false,"required":["enable","color"]},"animation":{"type":"object","properties":{"order":{"type":"array","items":{"type":"string"}},"speed":{"type":"number","default":1},"cycleMode":{"type":"string","enum":["one","all","none"],"default":"one"},"initializeWithRestPose":{"type":"boolean","default":false}},"additionalProperties":false,"required":["order","speed","cycleMode","initializeWithRestPose"]},"hotspot":{"type":"object","properties":{"hotspots":{"type":"array","items":{"$ref":"#/definitions/hotspotData"}},"visible":{"type":"boolean"}},"additionalProperties":false,"required":["hotspots","visible"]},"vr":{"type":"object","properties":{"worldFactor":{"type":"number","minimum":0,"default":-1},"floorHeight":{"type":"number","default":0},"displayFloor":{"type":"boolean","default":true},"initialCamera":{"type":"object","properties":{"position":{"$ref":"#/definitions/vec3","default":[0,0,0]},"rotation":{"$ref":"#/definitions/vec4","default":[0,0,0,1]}},"additionalProperties":false,"required":["position","rotation"]}},"additionalProperties":false,"required":["worldFactor","initialCamera","floorHeight","displayFloor"]},"sound":{"type":"object","properties":{"soundtracks":{"type":"array","minItems":0,"maxItems":32,"items":{"$ref":"#/definitions/soundtrack"},"additionalItems":false}},"additionalProperties":false,"required":["soundtracks"]},"ground":{"type":"object","properties":{"enable":{"type":"boolean","default":false},"opacity":{"type":"number","default":1},"fade":{"type":"number","default":0.25},"position":{"$ref":"#/definitions/vec3"},"scale":{"type":"number","default":-1,"minimum":0},"shadowMode":{"type":"string","enum":["ShadowCatcher","BakedAO"],"default":"ShadowCatcher"},"samplingRange":{"type":"number","default":0.6},"aoTextureUid":{"$ref":"#/definitions/uid"}},"additionalProperties":false,"required":["enable","opacity","fade","position","scale","shadowMode","samplingRange"]}}}');var s=i("h4+f"),l=i.n(s),u=i("VwWu"),h=i("pUXo"),c=a.Z.osg,A=(0,u.Z)(a.Z.osg.CullFace),d=r().Model;const g=d.extend({initialize:function(){if(d.prototype.initialize.apply(this,arguments),this._featureSchema=this.getSubSchema(this.getModelOptionPath()),this._featureSchema){this._typeMap={},this._buildTypeMap(this._featureSchema,this._typeMap);var e=this.getInstance();this.initDefaults(e)}},getModelOptionPath:function(){return""},getSubSchema:function(e,t){for(void 0===t&&(t=!0),e=e?0===e.indexOf("#")?e.substring(2).replace(/\//g,"."):"properties."+e.replace(/\./g,".properties."):"properties";e.indexOf(":")>0;){var i=e.split(":"),n=this._getAttribute(o,i[0]);if(n.patternProperties){var r=i[1].indexOf(".");r<0&&(r=i[1].length);var a=i[1].substring(0,r),s=Object.keys(n.patternProperties)[a];e=e.replace(":"+a,".patternProperties."+s)}}var l=this._getAttribute(o,e);if(l&&t)if(0===e.indexOf("definition")){l.definitions=(0,h.Z)({},o.definitions);var u=e.split(".");u=u[u.length-1],delete l.definitions[u]}else l.definitions=o.definitions;return l},_getAttribute:function(e,t){for(var i=t.split(".");i.length&&(e=e[i.shift()]););return e},getInstance:function(e){return e||(e=this._featureSchema),this._instantiateFromSchema(e)},_getRequiredFields:function(e){var t=e.required?e.required.slice():void 0;return e.oneOf&&e.oneOf.length&&e.oneOf[0].required&&e.oneOf[0].required.length&&t.push(e.oneOf[0].required[0]),t},_instantiateFromSchema:function(e){if("object"===e.type){var t={},i=this._getRequiredFields(e);for(var n in e=e.properties?e.properties:e)if(!(i&&i.indexOf(n)<0)){var r=e[n];t[n]=this._instantiateAttribute(r)}return t}return this._instantiateAttribute(e)},_instantiateAttribute:function(e){var t=e.default;if(e.$ref){var i=e.$ref,n=this.getSubSchema(i,!1),r=this._instantiateFromSchema(n);return t&&("object"==typeof t?(0,h.Z)(r,t):r=t),r}if(e.type){if(t&&"array"!==e.type)return t;switch(e.type){case"object":return this._instantiateFromSchema(e);case"array":var a;if(a=e.minItems?new Array(e.minItems):[],e.items)for(var o=e.items,s=0;s<a.length;s++)Array.isArray(e.items)&&(o=e.items[Object.keys(e.items)[s]]),a[s]=this._instantiateFromSchema(o);return a;case"number":case"integer":return 0;case"boolean":return!1;case"string":return e.enum?e.enum[0]:""}}},validate:function(e,t){var i=this._validator,n=t&&t.schema||this._featureSchema;i||(i=new(l())({allErrors:!0,removeAdditional:!0}).compile(n),this._validator=i);var r,a=[];if(i(e))return a;for(var o=0;o<i.errors.length;o++){var s,u=i.errors[o],h=u.instancePath.substring(1);if(h.indexOf("]")>=0&&(h=h.replace(/]/g,"")),"type"===u.keyword){if(null==(s=this._getAttribute(e,h)))continue;if(r=s,Array.isArray(r)||r instanceof Int8Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)continue}"pattern"===u.keyword&&(s=this._getAttribute(e,h),-1!==h.indexOf("texture.uid")&&-1!==s.indexOf("tmp_"))||"required"!==u.keyword&&a.push(this._formatErrorMessage(u,h,t))}return a},_formatErrorMessage:function(e,t,i){var n;i&&i.context&&(n=i.context);var r=n?n+": ":"";if(r+=t.length?'"'+t+'" ':"",r+=e.message,"enum"===e.keyword){r+=": ";for(var a=0;a<e.params.allowedValues.length;a++){r+=e.params.allowedValues[a]+", "}}else"additionalProperties"===e.keyword&&(r+=" ("+e.params.additionalProperty+")");return r},setJSON:function(e,t){if(!this._featureSchema)return["Json Schema not initialized"];this._adaptJSON&&this._adaptJSON(e);var i,n=t||{};if(n.schema?(i={},this._buildTypeMap(n.schema,i)):(n.schema=this._featureSchema,i=this._typeMap),n.validate){var r=this.validate(e,n);if(r.length){if(!n.warnOnError)return console.error("Failed to validate json",e,r),r.join("\n");console.warn("Failed to validate json",e),console.warn(r.join("\n"))}}var a=this._flattenObject(e,i,n);return this.set(a),[]},_buildTypeMap:function(e,t){if(e.properties){var i=e.properties;for(var n in i){var r=i[n];"object"===r.type?(t[n]={},this._buildTypeMap(r,t[n])):r.type?t[n]=r.type:r.$ref&&(t[n]=r.$ref)}}else e.$ref&&this._buildTypeMap(this.getSubSchema(e.$ref,!1),t)},initDefaults:function(e){if(e){var t=this._flattenObject(e,this._typeMap);this.set(t)}},getJSON:function(e){if(!this._featureSchema)return["Json Schema not initialized"];var t=this.getInstance();if(e&&e.ignore)for(var i=0;i<e.ignore.length;i++){delete t[e.ignore[i]]}return this._populate(t,this._typeMap,"",e),t},_flattenObject:function(e,t,i){var n={},r=i&&i.ignore?i.ignore:void 0;for(var a in t)if(Object.prototype.hasOwnProperty.call(e,a)&&!(r&&r.indexOf(a)>=0))if("object"==typeof t[a]){var o=this._flattenObject(e[a],t[a],i);for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[a+s.charAt(0).toUpperCase()+s.slice(1)]=o[s])}else void 0!==e[a]&&(n[a]=this._toModelType(e[a],t[a]));return n},_toModelType:function(e,t){return void 0===e?e:t.indexOf("vec2")>0||t.indexOf("unitVec2")>0?c.vec2.clone(e):t.indexOf("vec3")>0||t.indexOf("unitVec3")>0?c.vec3.clone(e):t.indexOf("vec4")>0||t.indexOf("unitVec4")>0?c.vec4.clone(e):t.indexOf("quaternion")>0?c.quat.clone(e):t.indexOf("matrix")>0?c.mat4.clone(e):t.indexOf("cullFace")>0?c.CullFace[e]:e},_toJsonType:function(e,t){return t.indexOf("vec2")>0||t.indexOf("unitVec2")>0||t.indexOf("vec3")>0||t.indexOf("unitVec3")>0||t.indexOf("vec4")>0||t.indexOf("unitVec4")>0||t.indexOf("quaternion")>0||t.indexOf("matrix")>0?Array.prototype.slice.call(e):t.indexOf("cullFace")>0?A[e]:e},_populate:function(e,t,i,n){for(var r in t)if(!(n&&n.ignore&&n.ignore.indexOf(r)>=0)){var a=i?i+r.charAt(0).toUpperCase()+r.slice(1):r;if("object"==typeof t[r])this._populate(e[r],t[r],a);else{var o=this.get(a);void 0!==o&&(e[r]=this._toJsonType(o,t[r]))}}}})},xWkn:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("uuWb"),r=i("ELsZ"),a=i("5Cxy"),o=i("8SXq"),s=i.n(o);const l={initGestures:function(e){var t=e.getInputSource("TouchScreen");if(t){var i=t.getHammer();i.get("pan").set({enable:!1});var n=new(s().Pinch)({enable:!0,threshold:.1}),r=new(s().Pan)({event:"panh",direction:s().DIRECTION_HORIZONTAL}),a=new(s().Pan)({event:"panv",direction:s().DIRECTION_VERTICAL});a.requireFailure(r),r.requireFailure(n),i.add(r),i.add(a),i.add(n)}}};var u=n.Z.InputGroups;u.GLOBAL_ACTIONS=u.SCENE+".globalactions",u.GLOBAL_FOCUS="focuscanvas",u.SCENE_VIEWERAPI=u.SCENE+".viewerapi",u.SCENE_VIEWERAPI_1_4=u.SCENE+".viewerapi_1_4",u.FOCUS_INSPECTOR="focus.inspector",u.SCENE_INSPECTOR=u.SCENE+".inspector",u.UI_INSPECTOR=u.UI+".inspector",u.SCENE_INSPECTOR_ZOOM=u.SCENE_INSPECTOR+".zoom",u.UI_INSPECTOR_ZOOM=u.UI_INSPECTOR+".zoom",u.ENVIRONMENT=u.SCENE+".environment",u.DEBUG="debug",u.DEBUG_TRIPICK="debug.tripick",u.DEBUG_GEOMPICK="debug.geompick",u.AUTOSPIN=u.SCENE+".autospin",u.HOTSPOT=u.SCENE+".hotspot",u.HOTSPOT_VIEWER=u.HOTSPOT+".viewer",u.HOTSPOT_EDITOR=u.HOTSPOT+".editor",u.CAMERA=u.SCENE+".camera",u.CAMERA_GIZMO=u.CAMERA+".gizmo",u.SOUND=u.SCENE+".sound",u.SOUND_GIZMO=u.SOUND+".gizmo",u.WEBVR=u.SCENE+".webvr",u.WEBVREDITOR=u.SCENE+"webvreditor",u.WEBVR_NAVIGATION=u.WEBVR+".navigation",u.WEBVR_DISPLAY=u.WEBVR+".display",u.AR="ar",u.AR_DEBUG=u.AR+".debug",u.DECALS_DEBUG="decals.debug";const h={init:function(e){this._manager=e},initGlobalClickEvents:function(e,t){var i=0,n=0,r=0;this._manager.group(u.GLOBAL_ACTIONS).addMappings({onDoubleClick:["doubletap","doubletap2fingers","dblclick"],onSingleClick:"singletap"},e),this._manager.group(u.GLOBAL_ACTIONS).addMappings({preventclick:"mousedown"},(function(e){r=0,i=e.clientX,n=e.clientY})),this._manager.group(u.GLOBAL_ACTIONS).addMappings({preventmousemove:"mousemove"},(function(e){var t=Math.abs(i-e.clientX)+Math.abs(n-e.clientY);r=Math.max(r,t)})),this._manager.group(u.GLOBAL_ACTIONS).addMappings({fallbacksingleclick:"mouseup"},(function(t){r<2&&e.onSingleClick(t)})),this._manager.group("focuscanvas").addMappings({focus:"mousedown"},(function(){t.focus({preventScroll:!0})})),this._manager.setPriority("focuscanvas",0)},initViewerAPI:function(e){this._manager.group(u.SCENE_VIEWERAPI).addMappings({onMouseMove:"mousemove",onCursorUp:["mouseup","singletap"]},e)},initViewerAPI_1_4:function(e){this._manager.group(u.SCENE_VIEWERAPI_1_4).addMappings({onMouseMove:"mousemove",onCursorUp:["mouseup","singletap"],onCursorDown:["mousedown"]},e)},initInspector:function(e){this._manager.group(u.FOCUS_INSPECTOR).addMappings({focusCheck:["mousedown","touchstart","wheel","mousemove","touchend","mouseup"],onCursorDown:["mousedown","touchstart"],onCursorUp:["touchend","touchcancel","mouseout","mouseup"]},e),this._manager.group(u.SCENE_INSPECTOR).addMappings({onMouseMove:"mousemove"},e),this._manager.group(u.SCENE_INSPECTOR_ZOOM).addMappings({onMouseWheel:"wheel"},e),this._manager.setPriority(u.FOCUS_INSPECTOR,this._manager.getHigherPriority(u.SCENE_INSPECTOR)),this._manager.setPriority(u.FOCUS_INSPECTOR+":onCursorUp",this._manager.getHigherPriority(u.FOCUS_INSPECTOR))},initInspectorCamera2D:function(e){this._manager.group(u.UI_INSPECTOR).addMappings({onEventStart:["pinchstart","panstart","mousedown"],onEventEnd:["pinchend","panend","mouseup","mouseout"],onEventUpdate:["pinch","pan","mousemove"]},e),this._manager.group(u.UI_INSPECTOR_ZOOM).addMappings({onMouseWheel:"wheel"},e),this._manager.setPriority(u.UI_INSPECTOR+":onEventEnd",this._manager.getHigherPriority(u.FOCUS_INSPECTOR))},setInspectorInputsEnable:function(e){this._manager.setEnable(u.SCENE_INSPECTOR,e),this._manager.setEnable(u.SCENE_INSPECTOR_ZOOM,e)},initEnvironment:function(e){this._manager.group(u.ENVIRONMENT).addMappings({startRotate:["mousedown alt","touchstart 3"],rotateLight:["mousemove alt ctrl !shift"],rotateEnv:["mousemove alt shift !ctrl"],rotateEnvAndLight:["mousemove alt !shift !ctrl","panmove 3"],endRotate:["mouseup","mouseout","touchend","touchcancel"]},e),this._manager.setPriority(u.ENVIRONMENT,this._manager.getHigherPriority(u.MANIPULATORS))},initDebug3D:function(e){this._manager.group(u.DEBUG_TRIPICK).addMappings({onTrianglePick:"dblclick"},e),this._manager.group(u.DEBUG_GEOMPICK).addMappings({onPickSelect:"dblclick"},e),this._manager.setPriority(u.DEBUG,1)},initAutospin:function(e,t){this._manager.group(u.AUTOSPIN).addMappings({pause:["mousedown","touchstart"],resume:["mouseup","mouseout","touchend","touchcancel"]},e),this._manager.setPriority(u.AUTOSPIN,this._manager.getHigherPriority(u.MANIPULATORS)),this._manager.setEnable(u.AUTOSPIN,t)},initHotspot:function(e){this._manager.group(u.HOTSPOT).addMappings({hoverHotspot:"mousemove"},e),(0,r.Z)()?(this._manager.group(u.HOTSPOT_EDITOR).addMappings({createHotspot:"dblclick",startDrag:["mousedown","touchstart"],dragHotspot:["mousemove","touchmove"],stopDrag:["touchend","mouseup"],cancelDrag:["touchcancel","mouseout"]},e),this._manager.setPriority(u.HOTSPOT,this._manager.getHigherPriority(u.MANIPULATORS))):this._manager.group(u.HOTSPOT_VIEWER).addMappings({selectHotspot:["mousedown","singletap"]},e)},initCamera:function(e){this._manager.group(u.CAMERA_GIZMO).addMappings({motion:"mousemove",startDrag:"mousedown",endDrag:["mouseleave","mouseup"]},e),this._manager.setPriority(u.CAMERA_GIZMO,this._manager.getHigherPriority(u.MANIPULATORS))},initSound:function(e){this._manager.group(u.SOUND_GIZMO).addMappings({onDragMove:"mousemove",onDragStart:"mousedown",onDragEnd:["mouseleave","mouseup"],onDoubleClick:"dblclick"},e),this._manager.setEnable(u.SOUND_GIZMO,!1),this._manager.setPriority(u.SOUND_GIZMO,this._manager.getHigherPriority(u.MANIPULATORS))},initWebVR:function(e){this._manager.group(u.WEBVR).addMappings({scaleUp:"keydown o",scaleDown:"keydown p"},e),this._manager.group(u.WEBVR_DISPLAY).addMappings({onPoseChange:["vrdisplayposechanged"]},e),this._manager.setEnable(u.WEBVR,!1),(0,r.Z)()&&this._manager.group(u.WEBVREDITOR).addMappings({savePosition:"mousemove"},e)},initWebVRNavigation:function(e){this._manager.group(u.WEBVR_NAVIGATION).addMappings({onPointerDown:"touchstart 1",onPointerUp:["touchend 1","mouseup 0","mouseup 1"],displayMenu:["mouseup 2"],onMouseDown:"mousedown"},e),this._manager.setEnable(u.WEBVR_NAVIGATION,!1)},initAR:function(e){(0,a.Z)().arkitDebug&&(this._manager.group(u.AR_DEBUG).addMappings({startMotion:["mousedown 1","mousedown 2"],startRotate:"mousedown 1 !ctrl",startElevate:"mousedown ctrl 1",startScale:"mousedown 2",motion:"mousemove",endMotion:["mouseup","mouseout"]},e),this._manager.setPriority(u.AR_DEBUG,this._manager.getHigherPriority(u.MANIPULATORS))),l.initGestures(this._manager),this._manager.group(u.AR).addMappings({startScale:"pinchstart",endScale:"pinchend",scale:"pinch",endRotate:"panhend",endElevate:"panvend",rotate:"panh",elevate:"panv"},e)},initDecals:function(e){this._manager.group(u.DECALS_DEBUG).addMappings({onClick:["mousedown 1"]},e),this._manager.setPriority(u.DECALS_DEBUG,this._manager.getHigherPriority(u.MANIPULATORS))}}},"8AWZ":(e,t,i)=>{"use strict";i.d(t,{Z:()=>S});var n,r,a,o,s,l,u,h,c=i("uuWb"),A=i("+eNq"),d=i("N96t"),g=i("HF+a"),f=i("SZYu"),p=i("MaYM"),m=i("iO85"),_=i("5Cxy"),v=c.Z.osg,C=c.Z.osgUtil,b=function(){v.NodeVisitor.call(this),this.setNodeMaskOverride(-1)};b.prototype=v.objectInherit(v.NodeVisitor.prototype,{apply:function(e){e.setShape&&e.setShape(null),this.traverse(e)}});const S={init:function(e,t){this._context=e,this._viewer=e.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._features=this._context.getFeatures(),this._rootModel=t,v.time("compute KdTree"),this.computeKdTree(t),v.timeEnd("compute KdTree"),this._initialized=!0},isInitialized:function(){return this._initialized},getViewport3d:function(){return this._features.postProcess.getCamera().getViewport()},getMaterialFromHit:function(e){return this._features.material.getModel().findFirstMaterial(e._nodePath)},decodeDepth:function(e){if(255===e[0])return 1;var t=e[0]+e[1]/255;return 3&e&&(t+=e[2]/65025),t/255},pickDepth:(h=new Uint8Array(4),function(e,t,i){return e.readPixels(t,i,1,1,e.RGBA,e.UNSIGNED_BYTE,h),this.decodeDepth(h)}),getWorldPositionFromDepthXY:(l=v.vec4.create(),u=v.mat4.create(),function(e,t,i,n){var r=this._viewerOSGJS.getCamera(),a=this._viewer.getFeaturesManager().getViewport3d(),o=p.Z.uNearFar.getInternalArray(),s=o[0]+(o[1]-o[0])*e;return l[0]=(t/a.width()*2-1)*s,l[1]=(i/a.height()*2-1)*s,l[2]=1,l[3]=s,v.mat4.invert(u,r.getProjectionMatrix()),v.vec4.transformMat4(l,l,u),v.mat4.invert(u,r.getViewMatrix()),v.vec3.transformMat4(n||v.vec3.create(),l,u)}),getPixelDepth:function(e,t,i){m.Z.draw();var n=this._features.quality.getModel(),r=n.get("dynamicResolutionScaling")[0],a=(0,_.Z)().stats&&this._viewerOSGJS.getViewerStats();f.Z.setCallbackDepth(function(o){f.Z.setCallbackDepth(void 0),a&&a.getCounter("readpixels").start();var s=o.getGraphicContext();if(s.checkFramebufferStatus(s.FRAMEBUFFER)!==s.FRAMEBUFFER_COMPLETE)return i(-1);s.flush(),s.finish();var l=n.get("dynamicResolutionScaling")[0];r!==l&&(e=e*l/r,t=t*l/r);var u=this.pickDepth(s,e,t,i);a&&a.getCounter("readpixels").end(),i(u,e,t,s)}.bind(this))},_computeIntersections3D:(o=new C.IntersectionVisitor,s=new C.LineSegmentIntersector,function(e,t,i,n){n||(n=this._features.webVR.getNode()),void 0===i&&(i=A.Z.PICK_GEOMETRY_SLOW),o.reset(),s.reset();var r=this._features.shadingStyle,a=r&&r.getModel().get("hasLines"),l=r&&r.getModel().get("hasPoints"),u=.005*d.Z.getModelBoxWithoutDisplacement().radius(),h=l||a?u:0;return o.setTraversalMask(i),o.setIntersector(s),s.set(e,t,h),n.accept(o),s.getIntersections()}),computeNearestIntersection3D:function(e,t,i,n){var r=this._computeIntersections3D(e,t,i,n);return this._sortIntersections(r)},computeNearestIntersection3DHotspotFirst:function(e,t,i,n){var r=this._computeIntersections3D(e,t,i,n);if(0!==r.length){r.sort((function(e,t){return e._ratio-t._ratio}));var a=0,o=r.length,s=this._features.hotspot.getWidgetNode();for(a=0;a<o;++a)if(-1!==r[a]._nodePath.indexOf(s))return r[a];return this._getFirstVisibleHit(r)}},pickNearestSurface:function(e){return this.computeNearestIntersection2D(e.canvasX,e.canvasY,A.Z.PICK_GEOMETRY_SLOW,this._rootModel)},_computeIntersections2D:(n=v.vec3.create(),r=v.vec3.create(),a=v.mat4.create(),function(e,t,i,o){return o||(o=this._features.webVR.getNode()),g.Z.canvasCoordToGL(e,t,n),g.Z.canvasCoordToGL(e,t,r),n[2]=0,r[2]=1,this.getWorldPositionFromScreenPoint(n,n),this.getWorldPositionFromScreenPoint(r,r),o.getWorldMatrix(void 0,a),v.mat4.invert(a,a),v.vec3.transformMat4(n,n,a),v.vec3.transformMat4(r,r,a),this._computeIntersections3D(n,r,i,o)}),computeNearestIntersection2D:function(e,t,i,n){var r=this._computeIntersections2D(e,t,i,n);return this._sortIntersections(r)},_sortIntersections:function(e){if(0!==e.length)return e.sort((function(e,t){return e._ratio-t._ratio})),this._getFirstVisibleHit(e)},_getFirstVisibleHit:function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t];if(!n._backface)return n;for(var r=n._nodePath,a=r.length-1;a>=0;--a){var o=r[a].getStateSet(),s=o&&o.getAttribute("CullFace");if(void 0!==s){if(s.getMode()===v.CullFace.DISABLE)return n;break}}}},getRelativePositionFromHit:function(){var e=v.mat4.create(),t=v.mat3.create();return function(i,n,r,a){for(var o=i._nodePath,s=!1,l=0,u=o.length;l<u;++l)if(o[l]===a){o=o.slice(l),s=!0;break}return v.mat4.identity(e),!1===s&&o[0].getWorldMatrix(a,e),v.computeLocalToWorld(o,!0,e),v.vec3.transformMat4(n,i._localIntersectionPoint,e),r&&(v.mat3.normalFromMat4(t,e),v.vec3.transformMat3(r,i._localIntersectionNormal,t),v.vec3.normalize(r,r)),n}}(),getWorldPositionFromHit:function(e,t,i){return this.getRelativePositionFromHit(e,t,i,this._viewerOSGJS.getSceneData())},getScenePositionFromHit:function(e,t,i){return this.getRelativePositionFromHit(e,t,i,this._rootModel)},getWorldPositionFromScenePoint:function(e,t){var i=t||v.vec3.create(),n=this._features.orientation,r=this._features.autospin;return n&&v.vec3.transformMat4(i,e,n.getNode().getMatrix()),r&&v.vec3.transformMat4(i,i,r.getNode().getMatrix()),i},getScenePositionFromWorldPoint:function(){var e=v.mat4.create();return function(t,i){var n=i||v.vec3.create(),r=this._features.orientation,a=this._features.autospin;return v.mat4.identity(e),r&&v.mat4.multiply(e,e,r.getNode().getMatrix()),a&&v.mat4.multiply(e,e,a.getNode().getMatrix()),v.mat4.invert(e,e),v.vec3.transformMat4(n,t,e)}}(),getScreenPositionFromScenePoint:function(e,t){var i=this.getWorldPositionFromScenePoint(e,t);return this.getScreenPositionFromWorldPoint(i,i)},getScreenPositionFromWorldPoint:function(){var e=v.mat4.create();return function(t,i){if(this._viewerOSGJS){var n=this._viewerOSGJS.getCamera();v.mat4.identity(e),this.getViewport3d().computeWindowMatrix(e),v.mat4.multiply(e,e,n.getProjectionMatrix()),v.mat4.multiply(e,e,n.getViewMatrix());var r=i||v.vec3.create();return v.vec3.transformMat4(r,t,e)}}}(),getWorldPositionFromScreenPoint:function(){var e=v.mat4.create();return function(t,i){var n=this._viewerOSGJS.getCamera();v.mat4.identity(e),this.getViewport3d().computeWindowMatrix(e),v.mat4.multiply(e,e,n.getProjectionMatrix()),v.mat4.multiply(e,e,n.getViewMatrix()),v.mat4.invert(e,e);var r=i||v.vec3.create();return v.vec3.transformMat4(r,t,e)}}(),getScenePositionFromScreenPoint:function(e,t){var i=this.getWorldPositionFromScreenPoint(e,t);return this.getScenePositionFromWorldPoint(i,i)},computeKdTree:function(e){for(var t=this._context.getScene().getWireframeNodes(),i=new b,n=t.length,r=0;r<n;++r)t[r].accept(i);new v.KdTreeBuilder({_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:50}).apply(e)}}},"WIA/":(e,t,i)=>{"use strict";i.d(t,{Z:()=>Pe});var n=i("lZH+"),r=i.n(n),a=i("uuWb"),o=i("57NU"),s=i("N6Kc"),l=i("lVmk"),u=i("iO85"),h=i("30e2"),c=i.n(h),A=i("Wquf"),d=i("7NZM"),g=i.n(d),f=["length",'/*! For license information please see a3930fcd3ebd3dde5fa3538534f33393-v2.worker.js.LICENSE.txt */\n(()=>{var t={qK9l:(t,r,e)=>{var n=e("Oyie");function o(t,r,e,o,i,a,u){try{var s=t[a](u),c=s.value}catch(t){return void e(t)}s.done?r(c):n.resolve(c).then(o,i)}t.exports=function(t){return function(){var r=this,e=arguments;return new n((function(n,i){var a=t.apply(r,e);function u(t){o(a,n,i,u,s,"next",t)}function s(t){o(a,n,i,u,s,"throw",t)}u(void 0)}))}}},eLCO:(t,r,e)=>{t.exports=e("mqXb")},Oyie:(t,r,e)=>{t.exports=e("8Vqr").Promise},"8Vqr":function(t,r,e){var n;n=function(){"use strict";function t(t){return"function"==typeof t}var r=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,o=void 0,i=void 0,a=function(t,r){p[n]=t,p[n+1]=r,2===(n+=2)&&(i?i(v):b())},u="undefined"!=typeof window?window:void 0,s=u||{},c=s.MutationObserver||s.WebKitMutationObserver,f="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var t=setTimeout;return function(){return t(v,1)}}var p=new Array(1e3);function v(){for(var t=0;t<n;t+=2)(0,p[t])(p[t+1]),p[t]=void 0,p[t+1]=void 0;n=0}var y,d,g,m,b=void 0;function w(t,r){var e=arguments,n=this,o=new this.constructor(E);void 0===o[x]&&U(o);var i,u=n._state;return u?(i=e[u-1],a((function(){return P(u,o,i,n._result)}))):I(n,o,t,r),o}function _(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var r=new this(E);return S(r,t),r}f?b=function(){return process.nextTick(v)}:c?(d=0,g=new c(v),m=document.createTextNode(""),g.observe(m,{characterData:!0}),b=function(){m.data=d=++d%2}):l?((y=new MessageChannel).port1.onmessage=v,b=function(){return y.port2.postMessage(0)}):b=void 0===u?function(){try{var t=e("PEqM");return o=t.runOnLoop||t.runOnContext,function(){o(v)}}catch(t){return h()}}():h();var x=Math.random().toString(36).substring(16);function E(){}var A=void 0,L=new Z;function k(t){try{return t.then}catch(t){return L.error=t,L}}function O(r,e,n){e.constructor===r.constructor&&n===w&&e.constructor.resolve===_?function(t,r){1===r._state?C(t,r._result):2===r._state?T(t,r._result):I(r,void 0,(function(r){return S(t,r)}),(function(r){return T(t,r)}))}(r,e):n===L?T(r,L.error):void 0===n?C(r,e):t(n)?function(t,r,e){a((function(t){var n=!1,o=function(t,r,e,n){try{t.call(r,e,n)}catch(t){return t}}(e,r,(function(e){n||(n=!0,r!==e?S(t,e):C(t,e))}),(function(r){n||(n=!0,T(t,r))}),t._label);!n&&o&&(n=!0,T(t,o))}),t)}(r,e,n):C(r,e)}function S(t,r){var e;t===r?T(t,new TypeError("You cannot resolve a promise with itself")):"function"==typeof(e=r)||"object"==typeof e&&null!==e?O(t,r,k(r)):C(t,r)}function j(t){t._onerror&&t._onerror(t._result),G(t)}function C(t,r){t._state===A&&(t._result=r,t._state=1,0!==t._subscribers.length&&a(G,t))}function T(t,r){t._state===A&&(t._state=2,t._result=r,a(j,t))}function I(t,r,e,n){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=r,o[i+1]=e,o[i+2]=n,0===i&&t._state&&a(G,t)}function G(t){var r=t._subscribers,e=t._state;if(0!==r.length){for(var n=void 0,o=void 0,i=t._result,a=0;a<r.length;a+=3)n=r[a],o=r[a+e],n?P(e,n,o,i):o(i);t._subscribers.length=0}}function Z(){this.error=null}var M=new Z;function P(r,e,n,o){var i=t(n),a=void 0,u=void 0,s=void 0,c=void 0;if(i){if((a=function(t,r){try{return t(r)}catch(t){return M.error=t,M}}(n,o))===M?(c=!0,u=a.error,a=null):s=!0,e===a)return void T(e,new TypeError("A promises callback cannot return that same promise."))}else a=o,s=!0;e._state!==A||(i&&s?S(e,a):c?T(e,u):1===r?C(e,a):2===r&&T(e,a))}var V=0;function U(t){t[x]=V++,t._state=void 0,t._result=void 0,t._subscribers=[]}function B(t,e){this._instanceConstructor=t,this.promise=new t(E),this.promise[x]||U(this.promise),r(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&C(this.promise,this._result))):T(this.promise,new Error("Array Methods must be provided an Array"))}function N(t){this[x]=V++,this._result=this._state=void 0,this._subscribers=[],E!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof N?function(t,r){try{r((function(r){S(t,r)}),(function(r){T(t,r)}))}catch(r){T(t,r)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}function W(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var r=t.Promise;if(r){var e=null;try{e=Object.prototype.toString.call(r.resolve())}catch(t){}if("[object Promise]"===e&&!r.cast)return}t.Promise=N}return B.prototype._enumerate=function(){for(var t=this.length,r=this._input,e=0;this._state===A&&e<t;e++)this._eachEntry(r[e],e)},B.prototype._eachEntry=function(t,r){var e=this._instanceConstructor,n=e.resolve;if(n===_){var o=k(t);if(o===w&&t._state!==A)this._settledAt(t._state,r,t._result);else if("function"!=typeof o)this._remaining--,this._result[r]=t;else if(e===N){var i=new e(E);O(i,t,o),this._willSettleAt(i,r)}else this._willSettleAt(new e((function(r){return r(t)})),r)}else this._willSettleAt(n(t),r)},B.prototype._settledAt=function(t,r,e){var n=this.promise;n._state===A&&(this._remaining--,2===t?T(n,e):this._result[r]=e),0===this._remaining&&C(n,this._result)},B.prototype._willSettleAt=function(t,r){var e=this;I(t,void 0,(function(t){return e._settledAt(1,r,t)}),(function(t){return e._settledAt(2,r,t)}))},N.all=function(t){return new B(this,t).promise},N.race=function(t){var e=this;return r(t)?new e((function(r,n){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(r,n)})):new e((function(t,r){return r(new TypeError("You must pass an array to race."))}))},N.resolve=_,N.reject=function(t){var r=new this(E);return T(r,t),r},N._setScheduler=function(t){i=t},N._setAsap=function(t){a=t},N._asap=a,N.prototype={constructor:N,then:w,catch:function(t){return this.then(null,t)}},W(),N.polyfill=W,N.Promise=N,N},t.exports=n()},mqXb:(t,r,e)=>{var n=e("Oyie"),o=function(t){"use strict";var r,e=Object.prototype,o=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{c({},"")}catch(t){c=function(t,r,e){return t[r]=e}}function f(t,r,e,n){var o=r&&r.prototype instanceof g?r:g,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n=h;return function(o,i){if(n===v)throw new Error("Generator is already running");if(n===y){if("throw"===o)throw i;return T()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=k(a,e);if(u){if(u===d)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(n===h)throw n=y,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n=v;var s=l(t,r,e);if("normal"===s.type){if(n=e.done?y:p,s.arg===d)continue;return{value:s.arg,done:e.done}}"throw"===s.type&&(n=y,e.method="throw",e.arg=s.arg)}}}(t,e,a),i}function l(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h="suspendedStart",p="suspendedYield",v="executing",y="completed",d={};function g(){}function m(){}function b(){}var w={};w[a]=function(){return this};var _=Object.getPrototypeOf,x=_&&_(_(C([])));x&&x!==e&&o.call(x,a)&&(w=x);var E=b.prototype=g.prototype=Object.create(w);function A(t){["next","throw","return"].forEach((function(r){c(t,r,(function(t){return this._invoke(r,t)}))}))}function L(t,r){function e(n,i,a,u){var s=l(t[n],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){e("next",t,a,u)}),(function(t){e("throw",t,a,u)})):r.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return e("throw",t,a,u)}))}u(s.arg)}var n;this._invoke=function(t,o){function i(){return new r((function(r,n){e(t,o,r,n)}))}return n=n?n.then(i,i):i()}}function k(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,k(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a \'throw\' method")}return d}var o=l(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,d;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function O(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function S(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function C(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return i.next=i}}return{next:T}}function T(){return{value:r,done:!0}}return m.prototype=E.constructor=b,b.constructor=m,m.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===m||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,s,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},A(L.prototype),L.prototype[u]=function(){return this},t.AsyncIterator=L,t.async=function(r,e,o,i,a){void 0===a&&(a=n);var u=new L(f(r,e,o,i),a);return t.isGeneratorFunction(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},A(E),c(E,s,"Generator"),E[a]=function(){return this},E.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return u.type="throw",u.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),d},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),S(e),d}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;S(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}},t}(t.exports);try{regeneratorRuntime=o}catch(t){Function("r","regeneratorRuntime = r")(o)}},PEqM:()=>{}},r={};function e(n){var o=r[n];if(void 0!==o)return o.exports;var i=r[n]={exports:{}};return t[n].call(i.exports,i,i.exports,e),i.exports}e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";var t,r=e("eLCO"),n=e.n(r),o=e("qK9l"),i=e.n(o),a=[];function u(t){return s.apply(this,arguments)}function s(){return(s=i()(n().mark((function t(r){var e,o,i,a,u,s,c,f,l,h,p,v,y,d,g,m,b;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f=function(){var t=a.buffer;o=new Uint8Array(t),i=new Uint32Array(t)},function(t,r){if(0===r||!t)return"";for(var e,n=0,i=0;(!r||i!==r)&&(0!==(e=o[t+i>>0])||r);i++)n|=e;if(r||(r=i),128&n)for(var a,u,s,c,f,l=o,h=t,p=t+r,v=String.fromCharCode,y=i,d="";;){if(h===p||!(a=l[h++]))return d;128&a?(u=63&l[h++],192!=(224&a)?(y=63&l[h++],224==(240&a)?a=(15&a)<<12|u<<6|y:(s=63&l[h++],240==(248&a)?a=(7&a)<<18|u<<12|y<<6|s:(c=63&l[h++],248==(252&a)?a=(3&a)<<24|u<<18|y<<12|s<<6|c:a=(1&a)<<30|u<<24|y<<18|s<<12|c<<6|63&l[h++])),65536>a?d+=v(a):d+=v(55296|(f=a-65536)>>10,56320|1023&f)):d+=v((31&a)<<6|u)):d+=v(a)}for(var g="";r>0;t+=1024,r-=1024)g+=String.fromCharCode.apply(String,o.subarray(t,t+Math.min(r,1024)));return g},c=function(t,r){postMessage([-1,1])},e={},r=new Uint8Array(r),s=536870912,e.H=function(){return o},(l={sbrk:function(t){var r=u,e=r+t,n=e-a.buffer.byteLength;return n>0&&(a.grow(n+65535>>16),f()),u=e,0|r},time:function(t){var r=Date.now()/1e3|0;return t&&(i[t>>2]=r),r},gettimeofday:function(t){var r=Date.now();i[t>>2]=r/1e3|0,i[t+4>>2]=r%1e3*1e3|0},abort:function(){c()}}).setjmp=l.__cxa_atexit=l.__lock=l.__unlock=function(){},64,4096,h=65536,p=function(t,e,n,o){function i(){return v=t,y=e,d=n,g=o,r[t++]}function a(){for(var i=t,a=0,u=128;128&u;t++)a|=(127&(u=r[t]))<<7*(t-i);return v=t,y=e,d=n,g=o,a}if(n=a(),o=a(),e=t+o,n<0||n>11||o<=0||e>r.length)return g=o,d=n,y=e,v=t,"break";if(6===n){a(),i(),i(),a();var u=a();a(),h=u}if(11===n)for(var s=a(),c=0;c!==s&&t<e;c++){i(),a();var f=a();a();var l=a();f+l+15>>4<<4,t+=l}v=t,y=e,d=n,g=o},v=8;case 12:if(!(v<r.length)){t.next=19;break}if("break"!==p(v,y,d,g)){t.next=16;break}return t.abrupt("break",19);case 16:v=y,t.next=12;break;case 19:return m=262144+(h+65535>>16<<16),u=h,a=l.memory=new WebAssembly.Memory({initial:m>>16,maximum:s>>16,shared:!1}),f(),(b=WebAssembly.instantiate(r,{env:l})).catch((function(t){postMessage([-1,2])})),t.next=27,b;case 27:return b=t.sent,e.a=b.instance.exports,e.a.__wasm_call_ctors&&e.a.__wasm_call_ctors(),t.abrupt("return",e);case 31:case"end":return t.stop()}}),t)})))).apply(this,arguments)}self.onmessage=function(){var r=i()(n().mark((function r(e){var o,i,s,c,f,l,h,p,v,y,d;return n().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=e.data[0],i=function(t){for(var r=self.atob(t),e=r.length,n=new Uint8Array(e),o=0;o<e;o++)n[o]=r.charCodeAt(o);return n},1!==o){r.next=5;break}return t=u(i(e.data[1])),r.abrupt("return");case 5:if(3===o&&(s=e.data[1],c=e.data[2],a.push(parseInt(c,16)),20===a.length)){for(f=a[19],l=0;l<10;++l)f^=a[2*l];for(h=new Array(10),p=0;p<10;++p)h[p]=a[2*p]^f;a=[],t.then((function(t){for(var r=t.a.Umlja1JvbGxlZDRV(s,40),e=t.H(),n=0;n<10;++n){var o=h[n].toString(16);o="0".repeat(4-o.length)+o;for(var i=0;i<o.length;++i)e[r+i+4*n]=o.charCodeAt(i)}}))}2===o&&(v=e.data[1],y=e.data[2],d=i(e.data[3]),t.then((function(t){t.a.mV2ZXIgZ29ubmEgbGV0IHlvdSBkb3duCk5l();for(var r=new Uint8Array(d),e=t.a.dmVyIGdvbm5hIHJ1biBhcm91bmQgYW5kI(r.length),n=t.H(),o=0;o<r.length;++o)n[e+o]=r[o];t.a.GRlc2VydCB5b3UKTmV2ZXIgZ29ubmEgbW(0);for(var i=new Uint8Array(y),a=0;a<i.length;a+=10240){for(var u=Math.min(10240,i.length-a),s=t.a.heSBnb29kYnllCk5ldmVyIGdvbm5hIHRl(u),c=t.H(),f=0;f<u;++f)c[s+f]=i[a+f];for(var l=t.a.GRlc2VydCB5b3UKTmV2ZXIgZ29ubmEgbW(1);l;){var h=t.H().subarray(t.a.TmV2ZXIgZ29ubmEgZ2l2ZSB5b3UgdXAKT(),t.a.TmV2ZXIgZ29ubmEgZ2l2ZSB5b3UgdXAKT()+t.a.bGwgYSBsaWUgYW5kIGh1cnQgeW91Cg()).slice(0);postMessage([v,h],[h.buffer]),t.a.FrZSB5b3UgY3J5Ck5ldmVyIGdvbm5hIHN(),l=t.a.GRlc2VydCB5b3UKTmV2ZXIgZ29ubmEgbW(0)}}postMessage([v,0])})));case 7:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()})()})();',"22164NojJJx","exception","6523JUPksS","151aoJwan","593844NRScXl","bind","apply","458556sZPHvT","return (function() ","test","trace","__proto__","293749zJPuqD","toString","error","constructor","info","console","Worker","10964QnnYnS","749453oyBeMH","^([^ ]+( +[^ ]+)+)+[^ ]}","1EEgsUg","7XrgiJx","warn","91iYeuZm"];function p(e,t){return f[e-=490]}!function(e,t){for(var i=p;;)try{if(896201===-parseInt(i(514))+parseInt(i(498))*parseInt(i(510))-parseInt(i(511))+parseInt(i(509))*parseInt(i(504))+parseInt(i(491))+parseInt(i(502))*parseInt(i(507))+parseInt(i(499))*-parseInt(i(501)))break;e.push(e.shift())}catch(t){e.push(e.shift())}}(f);var m,_=(m=!0,function(e,t){var i=m?function(){if(t){var i=t.apply(e,arguments);return t=null,i}}:function(){};return m=!1,i})(void 0,(function(){var e=function(){var t=p;return!e[t(494)]('return /" + this + "/')()[t(494)](t(500))[t(516)](_)};return e()}));_();var v,C=(v=!0,function(e,t){var i=v?function(){var i=p;if(t){var n=t[i(513)](e,arguments);return t=null,n}}:function(){};return v=!1,i});function b(){var e=p;return g()(e(506),e(497),void 0,void 0)}C(void 0,(function(){var e,t=p;try{e=Function(t(515)+'{}.constructor("return this")( ));')()}catch(t){e=window}for(var i=e.console=e[t(496)]||{},n=["log",t(503),t(495),t(493),t(508),"table",t(517)],r=0;r<n[t(505)];r++){var a=C.constructor.prototype[t(512)](C),o=n[r],s=i[o]||a;a[t(490)]=C.bind(C),a[t(492)]=s.toString[t(512)](s),i[o]=a}}))();var S=i("iVji"),E=["postMessage","slice",'{}.constructor("return this")( )',"forEach","2411141mRgVoC","1hDsNuN","set","bind","DITER-I","push","test","7bCEgOp","trace","info","apply","log","length","error","1GrUsxC","data","return (function() ","840051ZLzZKO","function","DITER-R","^([^ ]+( +[^ ]+)+)+[^ ]}","19487qiZDsm","table","object","338484GObBTz","toString","toLowerCase","onmessage","524211QQocrj","console","instantiate","constructor","DITER-U","1hdFdws",'return /" + this + "/',"undefined","__proto__","warn","139036zuewPQ","199819yEpdyI","floor"];!function(e,t){for(var i=w;;)try{if(511203===parseInt(i(301))*-parseInt(i(276))+-parseInt(i(269))*parseInt(i(283))+-parseInt(i(295))*parseInt(i(290))-parseInt(i(286))+parseInt(i(300))*parseInt(i(263))-parseInt(i(279))+parseInt(i(307)))break;e.push(e.shift())}catch(t){e.push(e.shift())}}(E);var y,I=(y=!0,function(e,t){var i=y?function(){var i=w;if(t){var n=t[i(272)](e,arguments);return t=null,n}}:function(){};return y=!1,i})(void 0,(function(){var e=function(){var t=w;return!e[t(293)](t(296))()[t(293)](t(282))[t(268)](I)};return e()}));I();var x,T=(x=!0,function(e,t){var i=x?function(){if(t){var i=t.apply(e,arguments);return t=null,i}}:function(){};return x=!1,i});function w(e,t){return E[e-=263]}T(void 0,(function(){var e,t=w;try{e=Function(t(278)+t(305)+");")()}catch(t){e=window}for(var i=e[t(291)]=e.console||{},n=[t(273),t(299),t(271),t(275),"exception",t(284),t(270)],r=0;r<n[t(274)];r++){var a=T[t(293)].prototype[t(265)](T),o=n[r],s=i[o]||a;a[t(298)]=T[t(265)](T),a[t(287)]=s[t(287)].bind(s),i[o]=a}}))();var M=!1,R={},B=0;const N=function(e,t,i,n,r){var a=w,o=B++,s=function(){var e=w;if(!M){if((typeof WebAssembly===e(297)?e(297):c()(WebAssembly))!==e(285)||typeof WebAssembly[e(292)]!==e(280))throw new Error("DITER-W");(M=new b)[e(289)]=function(t){var i=e,n=t[i(277)][0],r=t[i(277)][1];if(-1===n)switch(r){case 1:throw new Error(i(281));case 2:throw new Error(i(266));default:throw new Error(i(294))}var a=R[n][1];if(r)a[i(267)](r);else{var o=0;a[i(306)]((function(e){o+=e[i(274)]}));var s=new Uint8Array(o),l=0;a[i(306)]((function(e){s[i(264)](e,l),l+=e.length})),R[n][0](s),delete R[n]}},M[e(303)]([1,A])}return M}();if(R[o]=[r,[]],n)for(var l=S.k[a(304)](0,40)[a(288)](),u=parseInt(1314+Math[a(302)](9999*Math.random())),h=u,d=0;d<10;++d){var g=parseInt(l[a(304)](4*d,4*d+4),16);h^=g,s[a(303)]([3,o,(g^u)[a(287)](16)]),s.postMessage([3,o,h.toString(16)])}s[a(303)]([2,o,e,t])};var D=function(e,t,i){this._url=e,this._defer=new l.Z,this._responseType=t,this._options=i};D.prototype={getPromise:function(){return this._defer},getURL:function(){return this._url},start:function(){this._xhr=new XMLHttpRequest,this._xhr.addEventListener("error",this.error.bind(this),!1),this._xhr.addEventListener("abort",this.abort.bind(this),!1),this._xhr.addEventListener("progress",this.progress.bind(this),!1),this._xhr.responseType=this._options&&this._options.diter&&this._options.diter.b?"arraybuffer":this._responseType,this._xhr.addEventListener("load",function(e){var t=function(){this._xhr.response||(this._xhr.response=this._xhr.responseText),this.load.call(this),u.Z.draw()}.bind(this);if(200!==this._xhr.status)return console.log("Error not loaded "+this._url),void this.error(e);this._options&&this._options.diter?N(this._xhr.response,this._options.diter.b,this._options.diter.v,this._options.diter.d,function(e){var i=e.buffer;if("text"===this._responseType){i="";for(var n=new Uint8Array(e),r=0;r<e.length;r+=65535)i+=String.fromCharCode.apply(null,n.slice(r,r+65535))}this._xhr={response:i,responseText:i},t()}.bind(this)):t()}.bind(this),!1),this._xhr.open("GET",this._url,!0),this._xhr.send(null)},error:function(){console.error("Error when downloading url : "+this._url),this._defer.reject(new Error("Error when downloading url : "+this._url))},abort:function(){this._defer.cancel("Cancelling download of url : "+this._url)},progress:function(e){var t=this._options;if(t&&t.progress&&t.size){var i=e.loaded/t.size;t.progress(i,t.secondary,t.progressKey)}},load:function(){this._defer.resolve(this)},getXHR:function(){return this._xhr}};const P=D;var F=function(){P.apply(this,arguments)};F.prototype=(0,o.Z)({},P.prototype,{load:function(){this._model=this._xhr.response,this._defer.resolve(this._model)},getModel:function(){return this._model}});const O=F;var L=i("BW0+"),k=i("5Cxy"),Z=i("zlfu"),U=i("Y09f"),V=a.Z.osg,Q={},G={},H=parseInt((/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[0,0])[1],10),z=(0,k.Z)().asyncImage;z&&(z=window.Worker&&window.fetch&&window.createImageBitmap&&H>=52);var W=[];window.closeBitmaps=function(){W.forEach((function(e){e.close()}))};var j=function(e){var t=0,i=Math.max(2,Math.min(4,navigator.hardwareConcurrency||2)),n=[],r=URL.createObjectURL(new Blob([e],{type:"text/javascript"}));return function(){var e=n[t];return e||((e=n[t]=new Worker(r)).onmessage=function(e){var t=e.data,i=t.uid,n=G[i];t.bitmap?(n.setImage(t.bitmap),W.push(t.bitmap)):(n.setImage(t.img),n.setWidth(t.width),n.setHeight(t.height)),Q[i]()}),t=(t+1)%i,e}},q=j(Z),J=j(U),Y=function(e,t){P.call(this,e,"blob",t),this._responseType="arraybuffer"};Y.prototype=(0,o.Z)({},P.prototype,{isVideo:function(e){return L.Z.isVideoURL(e)},createVideo:function(){var e=document.createElement("video");return document.body.appendChild(e),e.style.display="none",e},start:function(){var e=this.getURL();if(this.isVideo(e)){var t=this.createVideo();return this._osgjsImage=new V.ImageStream(t),window.video=this._osgjsImage,t.preload="auto",t.crossOrigin="anonymous",(this._options.mute||this._options.muted)&&(t.muted=!0),this._options.loop&&(t.loop=this._options.loop),t.src=e,void this._osgjsImage.whenReady().then(function(e){e.play(),this._defer.resolve(this._osgjsImage)}.bind(this))}this._osgjsImage=new V.Image;var i=this._options;if(!(i.panoramaLUV||i.integrateBRDFLUV||i.cubemapLUV))return u.Z.draw(),this._url.endsWith(".astc.gz")?(i.astc=!0,void P.prototype.start.call(this)):this._url.endsWith(".svg")?(i.svg=!0,void this.loadImage()):void(i.decodeAsync&&z?this.loadImageAsync():this.loadImage());P.prototype.start.call(this)},load:function(){var e=this._options;e.panoramaLUV||e.integrateBRDFLUV?this.loadLUV():e.cubemapLUV?this.loadCubemapLUV():e.astc&&this.loadAstc()},loadImageAsync:function(){Q[this._url]=this._defer.resolve.bind(this._defer,this._osgjsImage),G[this._url]=this._osgjsImage,J().postMessage({uid:this._url,url:this._url})},loadAstc:function(){var e=this._xhr.response;Q[this._url]=this._defer.resolve.bind(this._defer,this._osgjsImage),G[this._url]=this._osgjsImage,q().postMessage({uid:this._url,buffer:e,swizzle:!0,nbComponents:3},[e])},svgToCanvas:function(){var e=document.createElement("canvas"),t=(0,k.Z)().svgSize;e.width=t,e.height=t;var i=e.getContext("2d");this._htmlImage.width=t,this._htmlImage.height=t,i.drawImage(this._htmlImage,0,0,t,t),this._osgjsImage.setImage(e)},loadImage:function(){this._htmlImage=new Image,this._options.crossOrigin&&(this._htmlImage.crossOrigin=this._options.crossOrigin),this._htmlImage.addEventListener("load",function(){this._options.svg&&this.svgToCanvas(),this._defer.resolve(this._osgjsImage)}.bind(this)),this._htmlImage.onerror=function(){this._htmlImage._aborted?this._defer.cancel(this._osgjsImage):this._defer.reject(this._osgjsImage)}.bind(this),this._htmlImage.src=this._url,this._osgjsImage.setImage(this._htmlImage)},abort:function(){this._htmlImage?(this._htmlImage.src="",this._htmlImage._aborted=!0):P.prototype.abort.call(this)},loadLUV:function(){var e,t=this._xhr.response,i=Math.sqrt(t.byteLength/4);e=this._options.integrateBRDFLUV?new Uint8Array(t):this.deinterleaveImage4(i,new Uint8Array(t),new Uint8Array(t.byteLength));var n=this._osgjsImage;n.setImage(e),n.setWidth(i),n.setHeight(i),this._defer.resolve(this._osgjsImage)},loadCubemapLUV:function(){for(var e=this._xhr.response,t=Math.log(this._options.size)/Math.LN2,i=0,n={},r=0;r<=t&&!(i>=e.byteLength);r++)for(var a=Math.pow(2,t-r),o=0;o<6;o++){n[V.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o]||(n[V.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o]=[]);var s=a*a*4,l=new Uint8Array(s);this.deinterleaveImage4(a,new Uint8Array(e,i,s),l);var u=new V.Image;u.setImage(l),u.setWidth(a),u.setHeight(a),n[V.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o].push(u),i+=s}this._defer.resolve(n)},deinterleaveImage4:function(e,t,i){for(var n=e*e,r=2*e*e,a=3*e*e,o=0,s=0;s<n;s++)i[o++]=t[s],i[o++]=t[s+n],i[o++]=t[s+r],i[o++]=t[s+a];return i},getImage:function(){return this._osgjsImage}});const K=Y;var X=function(e,t){P.call(this,e,"arraybuffer",t)};X.prototype=(0,o.Z)({},P.prototype,{load:function(){var e=this.getXHR().response;this._defer.resolve(e)}});const $=X;var ee=a.Z.osg,te=function(e,t,i){i?ee.error("ResourceLoader: "+e+" failed "+t+" error "+i):ee.error("ResourceLoader: "+e+" failed "+t)},ie=function(){this._nbThreads=5,this._processing=[],this._queue=[],this._finished=[],this._running=!1};ie.prototype={checkResource:function(e){var t;return[this._processing,this._queue,this._finished].forEach((function(i){t||(t=(0,s.Z)(i,(function(t){return t._url===e})))})),t},run:function(){this._running=!0,this.runPendingProcess()},runPendingProcess:function(){for(;this._processing.length<this._nbThreads&&this._queue.length>0;){var e=this._queue.shift();this._processing.push(e),e.start()}},queue:function(e){e.start||(console.log(e.url),e=new P(e.url,e.response)),this._queue.push(e);var t=e.getPromise();return t.finally(function(){t.isFulfilled()&&this._finished.push(e),this._processing.splice(this._processing.indexOf(e),1),this.runPendingProcess()}.bind(this)),this._running&&this.runPendingProcess(),e},getModel:function(e,t){var i=this.checkResource(e);return i||((i=this.queue(new O(e,"text",t))).getPromise().catch((function(t){te(e,"model",t)})),i)},getImage:function(e,t){var i=this.checkResource(e);if(i)return i;var n=t||{};return"data:image"===e.substr(0,"data:image".length)||(n.crossOrigin="anonymous"),(i=this.queue(new K(e,n))).getPromise().catch((function(){te(e,"image")})),i},getBinaryArray:function(e,t){var i=this.checkResource(e);return i||((i=this.queue(new $(e,t))).getPromise().catch((function(t){te(e,"binary array",t)})),i)}};const ne=ie;var re=i("u5VM"),ae=i("qGIA"),oe=i("0RVg"),se=i("/VXM"),le=i("W8Jb");const ue=oe.Z.extend({optionTypes:{modelUid:se.Z.string},model:ae.Z,url:function(){return(0,le.Z)("environments",this.options.modelUid,this.options.checkPrefetch)}});var he=i("BTkA");const ce=oe.Z.extend({optionTypes:{modelUid:se.Z.string},model:he.Z,url:function(){return(0,le.Z)("backgrounds",this.options.modelUid,this.options.checkPrefetch)}});var Ae=i("r4hN"),de=i("ofNU"),ge=i("7olf");const fe=oe.Z.extend((0,o.Z)({optionTypes:{modelUid:se.Z.string},model:de.Z,url:function(){return(0,le.Z)("matcaps",this.options.modelUid,this.options.checkPrefetch)}},ge.Z));var pe=i("BTJo");const me=oe.Z.extend({optionTypes:{modelUid:se.Z.string},comparator:"order",model:pe.Z,url:function(){return(0,le.Z)("hotspots",this.options.modelUid,this.options.checkPrefetch)}});var _e=i("ydx7"),ve=i("UNIa"),Ce=i("Oyie");const be=_e.Z.extend({defaults:{name:"",uid:"",duration:0,isLoop:!1,isEnabled:!0},endpoint:function(){return"/animations/".concat(this.get("uid"))},registerOptions:function(){this._lastOptions={name:this.get("name"),isLoop:this.get("isLoop"),isEnabled:this.get("isEnabled")}},hasChangedOptions:function(){if(!this._lastOptions)return!0;var e=this._lastOptions;for(var t in e)if(e[t]!==this.get(t))return!0;return!1},save:function(){return this.hasChangedOptions()?(this.registerOptions(),ve.Z.patchAnimation(this.get("uid"),{name:this.get("name"),isLoop:this.get("isLoop"),isEnabled:this.get("isEnabled")})):Ce.resolve()}}),Se=oe.Z.extend({optionTypes:{modelUid:se.Z.string},comparator:"order",model:be,_trashbin:[],url:function(){return(0,le.Z)("animations",this.options.modelUid,this.options.checkPrefetch)}});var Ee=i("W+BB");const ye=oe.Z.extend({optionTypes:{modelUid:se.Z.string},comparator:"order",model:Ee.Z,url:function(){return(0,le.Z)("sounds",this.options.modelUid,this.options.checkPrefetch)},modelId:function(e){return e.cid},triggerEditTrack:function(e){this.trigger("editTrack",e)},triggerDeleteTrack:function(e){this.trigger("removeTrack",e)},triggerDuplicateTrack:function(e){this.trigger("duplicateTrack",e)},triggerSelectTrack:function(e){this.trigger("select",e)}});var Ie=i("iI+4"),xe=i("0Iaf"),Te=i("jH3f"),we=a.Z.osg,Me=function(e){e=this.computeURL(e);var t=new we.Image;return t.setURL(e),r().resolve(t)},Re=[],Be={},Ne=function(e,t){this.resource=e,this.promise=t},De=function(e){if(!e){if(De.instance)return De.instance;De.instance=this}return this._optPrefetch={modelUid:void 0,checkPrefetch:!0},this._maps={},this._collections={},this._resourceLoader=new ne,this};De.Entry=Ne,De.prototype={setModelUid:function(e){this._optPrefetch.modelUid=e},setStateContextOSG:function(e){this._state=e},getInstance:function(){return De.instance},register:function(e,t){this._maps[e]=t},exist:function(e){return this._maps[e]},hashTextureOptions:function(e){for(var t="",i=re.Z.getValidOptions(),n=i.length,r=0;r<n;++r)t+=e[i[r]];return t},_getCollection:function(e,t){var i=this._collections[t];return i||(this._collections[t]=new e([],this._optPrefetch),window.RunningTests||this._collections[t].fetch(),this._collections[t])},getEnvironmentCollection:function(){return this._getCollection(ue,"environment")},getBackgroundCollection:function(){return this._getCollection(ce,"background")},getSoundCollection:function(){return this._getCollection(ye,"sound")},getHotspotCollection:function(){return this._getCollection(me,"hotspot")},getMatcapCollection:function(){return this._getCollection(fe,"matcap")},getAnimationCollection:function(){return this._getCollection(Se,"animation")},getTextureCollection:function(){if(this._collections.texture)return this._collections.texture;var e=this._getCollection(Ae.Z,"texture");return e.forEach((function(t){0===t.getImages().length&&e.remove(t)})),e.isValid(),e},getOrCreateMultiresTexture:function(e,t){var i=[e,this.hashTextureOptions(t)].join(""),n=this.exist(i);if(n)return n;var a=this.getTextureCollection().get(e)||this.getMatcapCollection().get(e);if(a){var o=new Ie.Z;return re.Z.setOptions(t,o),o.setImageModel(a),n=new Ne(o,r().resolve(o)),this.register(i,n),n}},getOrCreateImage:function(e,t){var i="image"+e;t&&t.widget&&(i+="widget");var n=this.exist(i);if(n)return n;var r=this._resourceLoader.getImage(e,t).getPromise();return(n=new Ne).promise=r.then((function(e){return t&&t.pk&&(e.pk=t.pk),n.image=e,n.resource=e,e})),this.register(i,n),n},getOrCreateTexture:function(e,t){var i=function(e){!this._state||e._textureObject&&!e.isDirty()||this._state.applyTextureAttribute(0,e)}.bind(this),n=re.Z.createValidOptions(t),r=[e,this.hashTextureOptions(n)].join(""),a=this.exist(r),o=!!(t&&t.transferToGPU&&this._state);if(a)return o&&(a.promise.isFulfilled()?i(a.texture):a._bindToGPU=!0),a;n.cubemap=t&&t.cubemap;var s=n.cubemap?new xe.Z:new Ie.Z;s.setTextureSize(1,1),re.Z.setOptions(n,s),t&&void 0!==t.convertNPOT&&(s._convertNPOT=t.convertNPOT);var l=this._resourceLoader.getImage(e,t).getPromise();(a=new Ne(s)).texture=s,a._bindToGPU=o;var u=this;return a.promise=l.then((function(e){if(n.cubemap)for(var t=0;t<6;t++){var r=we.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+t;s.setImage(r,e[r],"RGBA")}else s.setImage(e);return s.dirty(),a._bindToGPU&&i(s),s})).finally((function(){return l.isFulfilled()||u.register(r,void 0),s})),this.register(r,a),a},getOrCreateModel:function(e,t){var i=e,n=this.exist(i);if(n)return n;var a,s=t&&t.node?t.node:new we.Node,l={};l.readImageURL=Me,l.readBinaryArrayURL=(a=this._resourceLoader,function(e,t){return e=t.currentAnimationUID?t.currentAnimationUID:this.computeURL(e),a.getBinaryArray(e,t).getPromise()}),l.bufferMap=Be,l.readBufferArray=function(){var e=this.getJSON(),t=e.UniqueID,i=new we.BufferArray(we.BufferArray[e.Type]);i.setItemSize(e.ItemSize),i.setElements(Re);var n=i.getInstanceID();if(Be[n]={},e.Array){var a=Object.keys(e.Array)[0],o=e.Array[a];o.Elements?Be[n].inlined=o.Elements:(Be[n].vb=o,Be[n].type=a)}else Be[n].inlined=e.Elements;var s=r().resolve(i);return void 0!==t&&(this._identifierMap[t]=s),s};var u=(0,o.Z)({},l,t),h=this._resourceLoader.getModel(e,u),c=e.split("/");c.length=c.length-1,c.length<=0&&we.error("getOrCreateModel: can't find prefix to load subdata");var A=c.join("/")+"/";u.prefixURL=A;var d=(0,Te.Z)(h.getPromise(),e,u,s,this._resourceLoader);return(n=new Ne(s,d)).node=s,this.register(i,n),n},run:function(){this._resourceLoader.run()}},new De;const Pe=De},R6lU:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("uuWb"),r=i("5Cxy"),a=n.Z.osg,o=n.Z.osgShader.shaderProcessor,s={"utils/common.glsl":i("K0P0"),"utils/functions.glsl":i("ceKg"),"shadowing/shadowReceive.glsl":i("j6Sw"),"shadowing/shadowLinearSoft.glsl":i("HMIp"),"shadowing/tapPCF.glsl":i("4don"),"utils/lightCommon.glsl":i("QCSq"),"utils/lights.glsl":i("Bkbh"),"utils/lightsPBR.glsl":i("cXxc"),"utils/lightsSSS.glsl":i("MCB2"),"utils/skinning.glsl":i("F2PT"),"utils/morphing.glsl":i("P40d"),"utils/environment.glsl":i("FiKZ"),"utils/panoramaLod.glsl":i("orCE"),"utils/cubemapLod.glsl":i("SyQS"),"utils/cubemap.glsl":i("HNW4"),"utils/rand.glsl":i("aabx"),"utils/curvature.glsl":i("g8iT"),"utils/refraction.glsl":i("7VuN"),"utils/clearCoat.glsl":i("9D4N"),"utils/ssr.glsl":i("TObL"),"utils/material.glsl":i("ndRg"),"utils/normalBump.glsl":i("2rs+"),"utils/checkerboard.glsl":i("vKVh"),"utils/decodeDepth.glsl":i("I6qS"),"utils/encodeDepth.glsl":i("M+L8"),"utils/encodeDecode.glsl":i("mSVJ"),"utils/getLuminance.glsl":i("cRML"),"base.vert":i("cVj4"),"earlyz.vert":i("hZRv"),"earlyz.frag":i("5isI"),"pbr.vert":i("EjV6"),"pbr.frag":i("xcv8"),"outline.vert":i("OVPj"),"outline.frag":i("m5qG"),"matcap.vert":i("CR0n"),"matcap.frag":i("DVv7"),"shadeless.vert":i("LB4S"),"shadeless.frag":i("BzYw"),"wireframe.vert":i("cvIH"),"wireframe.frag":i("m/Zu"),"inspector/inspector.vert":i("gBF6"),"inspector/inspector.frag":i("WJzN"),"shadowing/shadowCast.vert":i("1bMp"),"shadowing/shadowCast.frag":i("mAxk"),"ARKit/shadowAr.vert":i("PxxW"),"ARKit/shadowAr.frag":i("Og9V"),"webVR/controller.vert":i("Ws5y"),"webVR/controller.frag":i("I9Ql"),"debug/boneBox.vert":i("EVpl"),"debug/boneBox.frag":i("611C"),"debug/normal.vert":i("yYum"),"debug/normal.frag":i("W3fT"),"debug/tangent.vert":i("alNo"),"debug/tangent.frag":i("BuKJ"),"debug/skinning.vert":i("N68w"),"debug/skinning.frag":i("QwJF"),"debug/geometry.vert":i("wMJb"),"debug/geometry.frag":i("JPvX"),"ground/ground.vert":i("PJYv"),"ground/ground.frag":i("mN8o"),"ground/bakeShadowMap.vert":i("DRy3"),"ground/bakeShadowMap.frag":i("PhaV")};if(o.addShaders(s),!(0,r.Z)().rgbm){var l=o.getShaderTextPure("utils/functions.glsl");l=(l=l.replace(/encodeRGBM.*\{/,"$&\nreturn vec4(color, 1.0);")).replace(/decodeRGBM.*\{/,"$&\nreturn color.rgb;"),o.addShaders({"utils/functions.glsl":l})}var u=function(){this._shaderCache={}};u.prototype={getOrCreateShader:function(e,t,i,n,r){var a="";r&&(a=r.toString());var o=i+a,s=this._shaderCache[o];return s||(s=this._createShader(e,t,i,n,r),this._shaderCache[o]=s),s},_createShader:function(e,t,i,n,r){var s="#define SHADER_NAME "+n+"\n";if(r)if(Array.isArray(r))for(var l=0;l<r.length;l++)s+="#define "+r[l]+"\n";else s+="#define "+r+"\n";var u={};return u[i+"-vert"]=s+e,u[i+"-frag"]=s+t,o.addShaders(u),new a.Program(new a.Shader(a.Shader.VERTEX_SHADER,o.getShader(i+"-vert")),new a.Shader(a.Shader.FRAGMENT_SHADER,o.getShader(i+"-frag")))}};const h=new u},"3o3Y":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=new(i("ydx7").Z);n.PBR_LIT=1,n.CLASSIC_LIT=2,n.PBR_SHADELESS=4,n.CLASSIC_SHADELESS=8,n.MATCAP=16,n.INSPECTOR=32,n.nameMatch={"shadeless-pbr":n.PBR_SHADELESS,"shadeless-classic":n.CLASSIC_SHADELESS,"lit-pbr":n.PBR_LIT,"lit-classic":n.CLASSIC_LIT,"shading-ar":n.PBR_LIT,"shading-vr":n.PBR_LIT,ground:n.INSPECTOR,inspector:n.INSPECTOR},n.LIT=n.PBR_LIT|n.CLASSIC_LIT,n.SHADELESS=n.PBR_SHADELESS|n.CLASSIC_SHADELESS,n.PBR=n.PBR_LIT|n.PBR_SHADELESS,n.CLASSIC=n.CLASSIC_LIT|n.CLASSIC_SHADELESS,n.set("mask",n.PBR_LIT),n.set("hasSsr",!1),n.on("change:mask",(function(){var e=n.get("mask");switch(e){case n.PBR_LIT:case n.CLASSIC_LIT:case n.PBR_SHADELESS:case n.CLASSIC_SHADELESS:case n.INSPECTOR:case n.MATCAP:break;default:console.error("Invalid ShadingGlobal mask value !"+e)}}));const r=n},"o/tF":(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("VwWu"),r=i("uuWb"),a=i("ydx7"),o=i("u5VM"),s=i("WIA/"),l=r.Z.osg,u=(0,n.Z)(l.Texture),h=["magFilter","minFilter","wrapS","wrapT","textureTarget","internalFormat"];const c=a.Z.extend({initialize:function(){if(a.Z.prototype.initialize.apply(this,arguments),this.attributes.image){var e=o.Z.createValidOptionsForMaterial(this.attributes);this.set(e),this.setMultiresTextureFromValidOptions(e),void 0===this.get("texCoordUnit")&&this.set("texCoordUnit",0),this.bind("change:image",this.updateMultiresTexture,this)}else l.error("no image found in attributes, TextureModel invalid")},getImageModel:function(){return this.get("image")},setImageModel:function(e){this.set("image",e)},getResourceManager:function(){return this._resourceManager||s.Z.instance},getMultiresTexture:function(){return this.get("multiresTexture")},getURL:function(){console.trace("dont call TextureModel.getURL")},setMultiresTextureFromValidOptions:function(e){var t=this.get("image").getUID(),i=this.getResourceManager().getOrCreateMultiresTexture(t,e);i&&this.set("multiresTexture",i.resource)},updateMultiresTexture:function(){this.setMultiresTextureFromValidOptions(o.Z.createValidOptionsForMaterial(this.attributes))},isLuminance:function(){return this.get("internalFormat")===l.Texture.LUMINANCE},isAlpha:function(){return this.get("internalFormat")===l.Texture.ALPHA},getUID:function(){return this.getImageModel().getUID()},getJSON:function(){for(var e={},t=0,i=h.length;t<i;++t){var n=h[t];e[n]=u[this.get(n)]}return e.texCoordUnit=this.get("texCoordUnit"),e.uid=this.getUID(),e}})},EZMu:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("uuWb"),r=i("iO85"),a=function(e){this._duration=void 0===e?1:e,this.reset()};n.Z.osg.createPrototypeObject(a,{getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},reset:function(){this._startTime=-1,this._finished=!1,this._ratio=0,r.Z.draw()},finished:function(){},interpolate:function(e,t,i){if(this._finished)return 1;this._startTime<0&&(this._startTime=e);var n=Math.min(this._duration,e-this._startTime),r=0===this._duration?1:n/this._duration;return this._ratio=r,(r>=1||0===this._duration)&&(this._finished=!0,this.finished(t,i)),r},update:function(e,t){return this.interpolate(t.getFrameStamp().getSimulationTime(),e,t),!0}});const o=a},vRpy:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("uuWb"),r=n.Z.osg,a=n.Z.osgAnimation,o={wireframe:!0,epsilon:!0,nphi:!0,attributes:!0,vertex_mode:!0,triangle_mode:!0,rigIndex:!0,framerate:!0,bx:!0,by:!0,bz:!0,hx:!0,hy:!0,hz:!0,ox:!0,oy:!0,oz:!0,ow:!0,ot:!0,channel_mode:!0},s=function(){r.NodeVisitor.call(this)};s.convertUserDataToObject=function(e,t){var i=t||{};if(!e)return i;for(var n=0,r=e.length;n<r;++n){var a=e[n],s=a.Name;o[s]||-1!==s.indexOf("_bbl_")||-1!==s.indexOf("_h_")||-1!==s.indexOf("_mode")?i[s]=JSON.parse(a.Value):i[s]=a.Value}return i},s.instanceIDGeometryMap={},s.uidGeometryMap={},s.hasPoints=!1,s.hasTriangles=!1,s.hasLines=!1,s.hasVertexNormals=!1,s.hasBones=!1,s.hasMorphs=!1,s.hasRigsOrMorphs=!1,r.createPrototypeObject(s,r.objectInherit(r.NodeVisitor.prototype,{apply:function(e){var t=e instanceof r.Geometry;if(t){void 0!==e._uniqueID&&(s.uidGeometryMap[e._uniqueID]=e),s.instanceIDGeometryMap[e.getInstanceID()]=e;var i=s.hasMorphs||e instanceof a.MorphGeometry;if(s.hasMorphs=i,!s.hasRigsOrMorphs){var n=e instanceof a.RigGeometry;s.hasRigsOrMorphs=n||i}}var o=e instanceof a.Bone;if(s.hasBones=s.hasBones||o,t||o){e.userDataMap=s.convertUserDataToObject(e.getUserData());var l=e;if(e.getSourceGeometry&&(l=e.getSourceGeometry(),s.convertUserDataToObject(l.getUserData(),e.userDataMap)),l instanceof a.MorphGeometry){s.hasMorphs=!0;for(var u=l.getMorphTargets(),h=0,c=u.length;h<c;++h){var A=e.userDataMap["morph_"+h]={};s.convertUserDataToObject(u[h].getUserData(),A)}}}return this.traverse(e)}}));const l=s},"O/gg":(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("lZH+"),r=i.n(n),a=i("5Cxy"),o={OSG_VERSION:-1},s=function(e){var t={},i=new(r())((function(e,i){t.resolve=e,t.reject=i}));i.resolve=t.resolve,i.reject=t.reject,o["get"+e]=function(){return i},o["resolve"+e]=function(){!1===i.isFulfilled()&&i.resolve.apply(i,arguments)}};o.getInitialTextureBoundPromise=function(){return(0,a.Z)().preload?o.getHighResBound():o.getLowResBound()},s("Polygon"),s("Wireframe"),s("WireframeOptimized"),s("WireframeOptimizedSplit"),s("WireframeOptimizedSplitCompressed"),s("ModelDisplayed"),s("FirstAnimation"),s("AllAnimations"),s("HasAnimation"),s("FirstCameraAnimation"),s("Material"),s("HasSound"),s("SoundsCanPlayTrough"),s("VrDisplayReady"),s("LowResLoaded"),s("HighResLoaded"),s("LowResBound"),s("HighResBound"),s("AsyncShaderCompilation"),s("DataSizeOSGJS"),s("DataSizePolygon"),s("DataSizeTextures"),s("DataSizeSound"),s("DataSizeEnvironment"),s("DataSizeWireframe"),s("DataSizeAllModel"),r().all([o.getDataSizeOSGJS(),o.getDataSizePolygon(),o.getDataSizeSound(),o.getDataSizeTextures(),o.getDataSizeEnvironment(),o.getDataSizeWireframe()]).then((function(e){for(var t=0,i=0,n=e.length;i<n;i++)t+=e[i];o.resolveDataSizeAllModel(t)})),o.allLoadingDone=window.sketchfabViewerLoaded=r().all([o.getHighResBound(),o.getAllAnimations(),o.getWireframeOptimizedSplitCompressed()]),document.createEvent&&window.dispatchEvent&&window.sketchfabViewerLoaded.then((function(){var e=document.createEvent("Event");e.initEvent("sketchfaballloadingdone",!0,!0),window.dispatchEvent(e)}));const l=o},"4Pmp":(e,t,i)=>{"use strict";i.d(t,{Z:()=>gi});var n=i("sFNe"),r=i("lZH+"),a=i.n(r),o=i("Vpaz"),s=i("5Eyw"),l=i.n(s),u=i("uuWb"),h=i("EMUO"),c=i("qKlK"),A=i("yfOW"),d=i("ELsZ"),g=!1;window&&window.navigator&&(g=-1!==window.navigator.userAgent.indexOf("Edge"));const f=function(){return g};var p=i("TrH+"),m=i("rMHa"),_=i("+HSU"),v=i("5Cxy"),C=i("iO85"),b=i("MaYM"),S=u.Z.osg,E=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],y=function(e){return y.instance?y.instance:(this._canBeEnabled=(0,v.Z)().supersample,this._viewer=e,this._sampleCount=15,this._isFakeSupersampling=!1,this._isSupersampling=!1,this._frameNum=1,this._frameNumTaa=0,this._switch=!0,this._jitter=b.Z.uHalton.getInternalArray(),this._jitter[2]=1,y.instance=this,this)};S.createPrototypeObject(y,{getSampleCount:function(){return this._sampleCount},canBeEnabled:function(){return this._canBeEnabled},getSortedJitterTable:function(){return E},getBackgroundModel:function(){return this._viewer.getFeatures().background.getModel()},getAnimationModel:function(){return this._viewer.getFeatures().animation.getModel()},getWireframeAttenuation:function(){var e=this._viewer.getOrCreateScene().getWireframeNodes();if(!e.length||0===e[0].getNodeMask())return 1;var t=e[0].getStateSet().getUniform("uColor").getInternalArray()[3];return 1-t+.05*t},updateUniforms:function(e,t){var i=e%this._sampleCount,n=this.getSortedJitterTable()[i],r=t?.05:this.getWireframeAttenuation();this._jitter[0]=n[0]*r,this._jitter[1]=n[1]*r,this._jitter[3]=i},setSwitch:function(e){this._switch=e},isTaaJitter:function(){var e=this._postProcess.getModel(),t=e.get("taaEnable"),i="none"!==this.getBackgroundModel().get("enable"),n=void 0!==(0,v.Z)().taaJitter?(0,v.Z)().taaJitter:i,r=e.get("webVR"),a=this.getAnimationModel().canActivateTAA(),o=0===(0,v.Z)().autospin||(0,v.Z)().taaAnimation;return a&&t&&n&&!r&&o},updateFrame:function(){if(this._jitter[2]=-this._jitter[2],this._postProcess.getModel().trigger("pingPongTexture0",this._jitter[2]>0),!this._isSupersampling)return this._jitter[2]=Math.sign(this._jitter[2]),C.Z._doJitter&&this.isTaaJitter()?(this.updateUniforms(this._frameNumTaa,!0),this._frameNumTaa++):(this._jitter[0]=0,this._jitter[1]=0,this._frameNum=1,this._frameNumTaa=0),C.Z._doJitter=!0,!1;C.Z._doJitter=!0;var e=this._frameNum%this._sampleCount;return this.updateUniforms(e),this._frameNum++,this.isSupersampled()&&(this._isSupersampling=!1),this._isFakeSupersampling=!1,this._isSupersampling},getFrameNumber:function(){return this._frameNum%this._sampleCount},update:function(e,t){if(!this._switch)return!0;var i=t.getFrameStamp().getFrameNumber();return this._lastUpdateFrame===i||(this._lastUpdateFrame=i,!this._postProcess&&(this._postProcess=this._viewer.getFeatures().postProcess,!this._postProcess)||(this.updateFrame()&&C.Z.drawSameFrame(),!0))},isSupersampled:function(){return this._frameNum>=this._sampleCount},isEnabled:function(){return this._isSupersampling},isFakeEnabled:function(){return this._isFakeSupersampling},forceEnable:function(){this._isSupersampling=!0,this._jitter[0]=0,this._jitter[1]=0,this._jitter[2]=2*Math.sign(this._jitter[2]),this._jitter[3]=0,this._frameNum=1,C.Z.drawSameFrame()},enable:function(){if(!this.canBeEnabled())return this._isFakeSupersampling||C.Z.drawSameFrame(),void(this._isFakeSupersampling=!0);1===this._frameNum&&this.forceEnable()},reset:function(){this._jitter[2]=Math.sign(this._jitter[2]),this._frameNum=1,this._isSupersampling=!1,this._isFakeSupersampling=!1},setRoot:function(e){var t=new S.Node;e.addChild(t),t.addUpdateCallback(y.instance)}});const I=y;var x=i("WIA/"),T=i("jJ0f"),w=i("VwWu"),M=i("OBBi"),R=u.Z.osg,B=(0,w.Z)(R.Texture),N=["magFilter","minFilter","wrapS","wrapT","textureTarget","internalFormat"],D=["NormalMap","SubsurfaceScattering","Opacity","Displacement","BumpMap","AOPBR","CavityPBR","MetalnessPBR","GlossinessPBR","RoughnessPBR","SpecularF0","SpecularHardness"],P=function(e){return Math.max(0,Math.min(1,e))},F=function(e,t,i){if(void 0!==e.factor){var n=0,r=1;i<=2&&("Opacity"===t?"alphaMask"===e.type?n=.01:"alphaBlend"===e.type&&e.factor>=.99&&(e.factor=1):e.factor<.01&&(e.factor=0)),"BumpMap"===t||"EmitColor"===t?r=10:"SpecularHardness"===t?r=1e4:"Displacement"!==t&&"SubsurfaceScattering"!==t||(r=1e15),e.factor=Math.max(n,Math.min(r,e.factor))}if(e.color)if(D.indexOf(t)>=0)delete e.color;else{var a=e.color;e.color=R.vec3.fromValues(P(a[0]),P(a[1]),P(a[2]))}void 0===e.enable&&(e.enable=!0);var o=e.texture;if(o){!function(e){e.image&&(e.url=e.image,delete e.image);for(var t=0,i=N.length;t<i;++t){var n=N[t];"number"==typeof e[n]&&(e[n]=B[e[n]])}void 0===e.texCoordUnit?e.texCoordUnit=0:"string"==typeof e.texCoordUnit&&(e.texCoordUnit=parseInt(e.texCoordUnit,10)),e.format&&delete e.format}(o);var s=M.Z.getPossibleFormat(t);o.internalFormat&&1!==Object.keys(s).length?s[o.internalFormat]||(s.ALPHA?o.internalFormat="ALPHA":s.RGB?o.internalFormat="RGB":o.internalFormat="LUMINANCE"):o.internalFormat=M.Z.getDefaultFormatString(t)}};const O=function(e){var t=e.channels;t.Geometry&&(t.NormalMap=t.Geometry,delete t.Geometry),t.Reflection&&(void 0===e.reflection&&(e.reflection=t.Reflection.factor),delete t.Reflection),e.cullFace||e.cullFaceMode&&(e.cullFace=e.cullFaceMode,delete e.cullFaceMode),e.depthCheckMode&&(t.Opacity&&!t.Opacity.type&&(t.Opacity.type="alphaBlend"),delete e.depthCheckMode);var i=e.version||0;if(t)for(var n in t)F(t[n],n,i)};var L=i("C+0K"),k=u.Z.osg,Z=function(e,t,i){return Math.max(t,Math.min(i,e))},U=function(e,t){if("object"==typeof e){for(var i in t.textLog+=" { ",e){t.textLog+=i+": ";var n=e[i];void 0!==n?(U(n,t),t.textLog+=", "):t.textError+="\n "+i+"=> "+t.textLog.substring(Math.max(0,t.textLog.length-125),t.textLog.length)+" <= err"}t.textLog+=" } "}else t.textLog+=JSON.stringify(e)},V=function(e,t){return function(e){if(e.animation){var t=e.animation.autoplay;void 0!==e.animation.autoplay&&(e.animation.initializeWithRestPose=!t,delete e.animation.autoplay)}}(e),function(e){var t=e.camera,i=e.scene;t&&i&&(i.fov&&(t.fov=i.fov,delete i.fov),i.nearFarRatio&&(t.nearFarRatio=i.nearFarRatio,delete i.nearFarRatio))}(e),function(e){if(e.orientation.axis){var t=e.orientation.axis;t=k.vec3.fromValues(Z(t[0],0,3),Z(t[1],0,3),Z(t[2],0,3)),delete e.orientation.axis,t[0]=(4-t[0])%4,t[1]=(4-t[1])%4,t[2]=(4-t[2])%4,e.orientation.matrix=k.mat4.fromRotation(k.mat4.create(),.5*Math.PI*(t[0]+t[1]+t[2]),t)}}(e),function(e){switch(e.shading.type){case"lit":case"matcap":case"shadeless":break;case"blending":case"default":case"default-shading":case"predefined-shading":case"shading":case void 0:e.shading.type="lit";break;default:case"no-shading":e.shading.type="shadeless"}e.shading.vertexColor||"pbr"!==e.shading.renderer||(e.shading.vertexColor={enable:!1,colorSpace:"linear"})}(e),function(e){var t=e.environment;void 0!==t.exposure&&(t.exposure*=void 0!==t.light&&t.light>0?t.light:1);var i=t.backgroundEnable;void 0!==i&&!0===t.enable?e.background.enable=!0===i?"environment":!0===e.background.enable?"fixed":"none":void 0!==e.background.enable&&(!0===e.background.enable?e.background.enable="fixed":!1===e.background.enable&&(e.background.enable="none"))}(e),function(e){var t=e.materials;for(var i in t){var n=t[i];"object"==typeof n?void 0===n.stateSetID?delete t[n.id]:O(n):delete t[i]}}(e),function(e){if(e.lighting.lights)for(var t=e.lighting.lights,i=e.version,n=0,r=t.length;n<r;++n){var a=t[n];a.hardness=Math.max(Math.min(a.hardness,1),0),(void 0===a.castShadows||i<1&&a.attachedToCamera)&&(a.castShadows=!1)}else e.lighting={}}(e),function(e){var t=e.scene&&e.scene.postProcess;if(t){var i=t.ssao;2===e.version&&t.enable&&i&&i.enable&&0===i.bias&&0===i.radius&&(i.ssaoBias=-1,i.ssaoRadius=-1,e.vr.scale=-1);var n=t.vignette;if(n&&n.lens){var r=n.lens;n.amount=1-.5*(r[0]+r[1]),n.hardness=1-.5*(r[0]-r[1]),delete n.lens}}}(e),function(e){var t=e.vr;t&&t.scale&&(t.worldFactor=t.scale)}(e),t?e:(0,o.Z)(e,(function(t){return void 0===t?(U(e,i={textLog:"",textError:""}),0!==i.textError.length&&L.Z.client.captureMessage("Invalid CloneDeepWith: "+i.textError),[]):t.byteLength?Array.prototype.slice.call(t):void 0;var i}))},Q=function(e){var t=e.toJSON();return void 0===e.get("vertexCount")&&e.set("vertexCount",t.nbVertexes),void 0===e.get("faceCount")&&e.set("faceCount",t.nbTriangles),void 0===t.options&&(t.options={}),e.set("options",V(t.options,!0)),e.set("files",t.files),e};Q.readOptions=V;const G=Q;var H=i("dQQ3"),z=i("1416"),W=i("Lf1L"),j=i("O/gg"),q=i("IcDE"),J=u.Z.osg,Y=u.Z.osgUtil.NodeGizmo,K=function(){Y.apply(this,arguments),this._forcePicking=!1};J.createPrototypeNode(K,J.objectInherit(Y.prototype,{setForcePicking:function(e){this._forcePicking=e},onMouseUp:function(e){this.isEditing()&&C.Z.draw();var t=this._attachedNode;Y.prototype.onMouseUp.call(this,e),t!==this._attachedNode&&C.Z.draw(),this._forcePicking&&!this._attachedNode&&(this._attachedNode=t)},onMouseMove:function(e){var t=this._hoverNode;Y.prototype.onMouseMove.call(this,e),this.isEditing()&&C.Z.redrawShadow(),(this.isEditing()||t!==this._hoverNode)&&C.Z.draw()}}),"osgSketchfab","NodeGizmo");const X=K;var $=i("Hjnd"),ee=i.n($),te=i("jO+y"),ie=i("Xhvc"),ne=i("8AWZ"),re=i("HWoV"),ae=i("xWkn"),oe=i("2oON"),se=u.Z.osg,le=u.Z.osgAnimation,ue=u.Z.osgUtil,he=function(){se.NodeVisitor.call(this,se.NodeVisitor.TRAVERSE_PARENTS),this._paths=[],this._halt=void 0};se.createPrototypeObject(he,se.objectInherit(se.NodeVisitor.prototype,{reset:function(){se.NodeVisitor.prototype.reset.call(this),this._paths.length=0},setHalt:function(e){this._halt=e},apply:function(e){e===this._halt&&this._paths.push(this.nodePath.slice(1)),this.traverse(e)}}));var ce=function(e){se.NodeVisitor.call(this),this._cullCallback=e?void 0:ie.Z.hideCullCallback};se.createPrototypeObject(ce,se.objectInherit(se.NodeVisitor.prototype,{apply:function(e){e instanceof se.Geometry&&e._isBoneBox&&e.setCullCallback(this._cullCallback),this.traverse(e)}}));var Ae=function(e,t){var i,n;this._fManager=e,this._viewerWebGL=e.getViewerWebGL(),this._rootModel=this._viewerWebGL.getRootModel(),this._rootFeature=t,this._debugNormal=!1,this._debugTangent=!1,this._debugScale=.5,this._baseScale=.07*this._rootModel.getMinimumBound().radius(),this._normalVisitor=new ue.DisplayNormalVisitor,this._normalVisitor.setScale(this._baseScale*this._debugScale),this._geoColorVisitor=new ue.DisplayGeometryVisitor,this._geoColorVisitor._stCenter.setRenderBinDetails(te.Z.DEBUG_2,"RenderBin"),this._geoColorVisitor._stCenter.setAttribute(new re.Z(!0)),this._debugGeometry=!1,this._debugShadow=!1,this._useGizmo=!1,this._useSync=!1,this._protoUpdateWeights=le.UpdateMorph.prototype.updateWeights,this._protoComputeChannels=le.UpdateMatrixTransform.prototype.computeChannels,this._enableRig=!0,this._collectPathVisitor=new he,this._collectPathVisitor.setHalt(this._fManager.getWorldNode()),this._showBoneBoxes=!1,this._graphVisitor=ue.DisplayGraph.instance(),i=this._graphVisitor,n=(0,w.Z)(te.Z),i._graphRender.generateRenderBin=function(e,t){var i=t.className()+" ( "+t.getInstanceID()+" )";t.getName()&&(i+="\n"+t.getName());var r=t.getBinNumber();i+="\n"+n[r]||0,this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},this._debugGraphNode="Model",this._debugGraphRenderer=!1,this._displayGraph=!1;var r=this._fManager.getFeatures().camera.getModel();this._enabledConstraints=r.get("enableCameraConstraints"),this._showConstraintsWidget=!1,ae.Z.initDebug3D(this)};Ae.prototype={_getSaveAElement:function(){return this._aSave||(this._aSave=document.createElement("a"),document.body.appendChild(this._aSave),this._aSave.style.display="none"),this._aSave},_download:function(e,t){var i=this._fManager._context.getModel("uid").get("uid")+"_";i+=(new Date).toString().split(" ").splice(1,4).join("_").replace(/:/g,"_"),i+=".";var n=this._getSaveAElement();n.href=e,n.download=i+t,n.click()},_getCameraModel:function(){return this._fManager.getFeatures().camera.getModel()},onTakeScreenShot:function(){(0,m.Z)(2048,2048,this._viewerWebGL).toBlob(function(e){this._download(URL.createObjectURL(e),"png")}.bind(this),"png",1)},onStartMovieRecord:function(){var e=document.getElementsByClassName("canvas")[0].captureStream(25);this._recorder=new window.MediaRecorder(e,{mimeType:"video/webm; codecs=vp9"});var t=[],i=function(e){var t=window.URL.createObjectURL(e);this._download(t,"webm")}.bind(this);this._recorder.ondataavailable=function(e){e.data&&e.data.size>0&&t.push(e.data)},this._recorder.onstop=function(){i(new Blob(t,{type:"video/webm"}))}.bind(this),this._recorder.start()},onEndMovieRecord:function(){this._recorder&&this._recorder.stop()},onTrianglePick:function(e){if(!this._displayGraph){var t=ne.Z.computeNearestIntersection2D(e.canvasX,e.canvasY);if(t){window.hit=t;var i=t._nodePath[t._nodePath.length-1];console.log("Active hit : window.hit"),console.log("Name geometry : "+i.getName()),console.log("Vertex indices : "+t._i1+", "+t._i2+", "+t._i3),console.log("Unique id : "+i._uniqueID);var n={};n[t._i1]={},n[t._i2]={},n[t._i3]={};var r=i.getVertexAttributeList();for(var a in n){var o=n[a];for(var s in a=parseInt(a),r)for(var l=r[s],u=l.getItemSize(),h=l.getElements(),c=o[s]=[],A=0;A<u;++A)c[A]=h[a*u+A]}t.verts=n,console.log("\n")}}},onDebugScale:function(e){this._normalVisitor.setScale(this._baseScale*e),C.Z.draw()},onDebugNormal:function(e){this._normalVisitor.setNormalVisibility(e,this._rootModel),C.Z.draw()},onDebugTangent:function(e){this._normalVisitor.setTangentVisibility(e,this._rootModel),C.Z.draw()},onDebugGeometry:function(){this._debugGeometry?this._geoColorVisitor.setGeometryDebug(this._rootModel):this._geoColorVisitor.disableDebug(this._rootModel),C.Z.draw()},onEnableCamConstraints:function(){var e=this._getCameraModel();e.set("enableCameraConstraints",!e.get("enableCameraConstraints"))},onShowConstraintsWidget:function(){var e=this._getCameraModel();e.set("displayGizmo",!e.get("displayGizmo")),e.trigger("refreshConstraints"),C.Z.draw()},resetGraph:function(){this._viewerWebGL.getInputManager().setEnable(oe.Z.DEBUG_GEOMPICK,!1),this._graphVisitor.reset()},onDisplayGraph:function(){this.resetGraph(),this._displayGraph&&(this._viewerWebGL.getInputManager().setEnable(oe.Z.DEBUG_GEOMPICK,!0),j.Z.getModelDisplayed().then(this.createDebugGraph.bind(this)))},createDebugGraph:function(){var e;"Model"===this._debugGraphNode?e=this._rootModel:"Feature"===this._debugGraphNode&&(e=this._rootFeature),this._graphVisitor.setDisplayGraphRenderer(this._debugGraphRenderer),this._graphVisitor.createGraph(e),this._graphVisitor.setCallbackSelect(this.onNodeSelect.bind(this)),C.Z.draw()},onDebugShadow:function(e){var t=this._fManager.getFeatures().lighting;if(t){t.getModel().set("forceShadowRedraw",e);for(var i=t.getModel().get("lights"),n=0,r=i.length;n<r;++n){var a=i[n];a.getShadowMap()&&(a.getShadowMap().setDebug(e),a.dirty())}C.Z.draw()}},onPickSelect:function(e){var t=this._fManager.getWorldNode(),i=ne.Z.computeNearestIntersection2D(e.glX,e.glY,void 0,t);i&&(this._graphVisitor.selectNode(i._nodePath[i._nodePath.length-1]),this._graphVisitor.focusOnGraph())},onNodeSelect:function(e){if(e instanceof se.StateSet){var t=this._fManager.getFeatures().outline.getModel();return t.set("durationOutline",5),t.set("durationHighlight",2.5),void t.trigger("displayOutlineFocus",e,5,2.5)}for(var i=e.getBoundingBox(),n=e.getWorldMatrices(this._fManager.getWorldNode()),r=new se.BoundingBox,a=0;a<n.length;++a){var o=new se.BoundingBox;i.transformMat4(o,n[a]),r.expandByBoundingBox(o)}this._fManager.focusOnBound(r,1),this._collectPathVisitor.reset(),e.accept(this._collectPathVisitor);var s=this._collectPathVisitor._paths,l=this._fManager.getFeatures().outline.getNode();l.clearOutlineScene(),l.addPaths(s),l.showOutline()},_getCameraUrl:function(){var e=se.vec3.create(),t=se.vec3.create();this._fManager.getCameraWithoutAutospin(e,t);var i=window.location.href;return i+="&camera_eye="+e.join(",")+"&camera_target="+t.join(",")},cameraClipboard:function(){var e=this._getCameraUrl(),t=document.createTextNode(e);document.body.appendChild(t);var i=document.createRange();i.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(i),document.execCommand("copy"),document.body.removeChild(t)},cameraOpen:function(){window.open(this._getCameraUrl())},onEnableRig:function(e){le.UpdateMatrixTransform.prototype.computeChannels=e?this._protoComputeChannels:function(){this._dirty=!0;var e=this._matrix;se.mat4.identity(e);for(var t=this._stackedTransforms,i=0,n=t.length;i<n;i++){var r=t[i];r.resetToDefaultValue(),r.applyToMatrix(e)}},C.Z.draw()},onShowBoneBoxes:function(e){this._rootModel.accept(new ce(e)),C.Z.draw()},onUseGizmo:function(e){this._gizmo||(this._gizmo=new X(this._fManager.getViewerOSGJS()),this._rootFeature.addChild(this._gizmo)),this._gizmo.attachToNode(null),this._gizmo.setAutoMatrixTransformInsertion(e),this._gizmo.setCorrectPivotOnAutoInsert(e),this._gizmo.setTraversalMask(e?1:0),C.Z.draw()}};var de=function(e,t,i){var n,r=e.addFolder("Animation");return i._useRig=r.add(t,"_enableRig").name("Use rig"),i._useRig.onChange(t.onEnableRig.bind(t)),n=le.UpdateMorph.prototype.updateWeights,le.UpdateMorph.prototype.updateWeights=function(){if(void 0!==this._debugActiveTarget){var e=parseInt(this._debugActiveTarget,0);if(-2===e){var t=this._weights;return void(t[0]=t[1]=t[2]=t[3]=0)}if(-1!==e)for(var i=this._targets,r=0,a=i.length;r<a;++r)i[r].value=r===e?1:0}return n.call(this)},function(e,t){var i=function(){se.NodeVisitor.call(this,se.NodeVisitor.TRAVERSE_ALL_CHILDREN)};se.createPrototypeObject(i,se.objectInherit(se.NodeVisitor.prototype,{apply:function(t){for(var i=t.getUpdateCallbackList(),n=0,r=i.length;n<r;++n){var a=i[n];if(a instanceof le.UpdateMorph){for(var o={___DEFAULT:-1,"___NO MORPH":-2},s=a._targetNames,l=0,u=s.length;l<u;++l)o[s[l]]=l;a._debugActiveTarget=-1,e.add(a,"_debugActiveTarget",o).name("Name "+a.getName()).onChange(C.Z.draw)}}this.traverse(t)}}));var n=new i;t._rootModel.accept(n)}(r,t),i._showBoxes=r.add(t,"_showBoneBoxes").name("Show boxes"),i._showBoxes.onChange(t.onShowBoneBoxes.bind(t)),r.open(),r},ge=function(e){var t=new window.dat.GUI;t.domElement.style.paddingTop="50px";var i=new Ae(this,e),n={};!function(e,t,i){var n=e.addFolder("Debug graph");i._graphNode=n.add(t,"_debugGraphNode",{Model:"Model",Feature:"Feature",None:"None"}).name("Root"),i._graphNode.onChange(t.onDisplayGraph.bind(t)),i._graphRenderer=n.add(t,"_debugGraphRenderer").name("Renderer"),i._graphRenderer.onChange(t.onDisplayGraph.bind(t)),i._displayGraph=n.add(t,"_displayGraph").name("Display graph"),i._displayGraph.onChange(t.onDisplayGraph.bind(t)),n.open()}(t,i,n),function(e,t,i){var n=e.addFolder("Display vectors");i._showNormal=n.add(t,"_debugNormal").name("Display normal"),i._showNormal.onChange(t.onDebugNormal.bind(t)),i._showTangent=n.add(t,"_debugTangent").name("Display tangent"),i._showTangent.onChange(t.onDebugTangent.bind(t)),i._vectorScale=n.add(t,"_debugScale").min(0).max(2).name("Scale vectors"),i._vectorScale.onChange(t.onDebugScale.bind(t)),n.open()}(t,i,n),de(t,i,n),function(e,t,i){var n=e.addFolder("Camera");i._enableConstraints=n.add(t,"_enabledConstraints").name("Constraints"),i._enableConstraints.onChange(t.onEnableCamConstraints.bind(t)),i._showConstraintsWidget=n.add(t,"_showConstraintsWidget").name("Show widget"),i._showConstraintsWidget.onChange(t.onShowConstraintsWidget.bind(t)),i._cameraClipboard=n.add(t,"cameraClipboard").name("Copy clipboard"),i._cameraOpen=n.add(t,"cameraOpen").name("Open new tab"),n.open()}(t,i,n),function(e,t,i){var n=e.addFolder("Misc");i._showGeometry=n.add(t,"_debugGeometry").name("Display geometry"),i._showGeometry.onChange(t.onDebugGeometry.bind(t)),i._gizmo=n.add(t,"_useGizmo").name("Use gizmo"),i._gizmo.onChange(t.onUseGizmo.bind(t)),n.add(t,"_debugShadow").name("Debug Shadow").onChange(t.onDebugShadow.bind(t)),n.add({ScreenShot:t.onTakeScreenShot.bind(t)},"ScreenShot"),n.add({StartRec:t.onStartMovieRecord.bind(t)},"StartRec"),n.add({StopRec:t.onEndMovieRecord.bind(t)},"StopRec"),n.open()}(t,i,n)};const fe=function(e,t){var i=ge.bind(e,t);ee().getScript("https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js").done(i)};var pe,me,_e,ve,Ce,be,Se,Ee=i("+eNq"),ye=i("LzEI"),Ie=i("UFcT"),xe=i("wVsd"),Te=i("AhvN"),we=i("HF+a"),Me=i("BTJo"),Re=i("N96t"),Be=i("Thrf"),Ne=i("MDIC"),De=i("jQgr"),Pe=u.Z.osg,Fe=function(e,t){this._viewerWebGL=e,this._viewerOSGJS=e.getViewerOSGJS(),this._urlOptions=e.options,this._features=e.getFeatures(),this._context=t,this._canvas=e.getCanvas(),this._nodeGizmo=null,(0,Ne.gN)(this)};Fe.prototype={getFeatures:function(){return this._features},getCanvas:function(){return this._canvas},getViewerWebGL:function(){return this._viewerWebGL},getViewerOSGJS:function(){return this._viewerOSGJS},getRootModel:function(){return this._viewerWebGL.getRootModel()},getWorldNode:function(){return this._features.autospin.getNode()},getTextureDepth:function(){return this._features.postProcess.getCamera()._textureDepth},getViewport3d:function(){return this._features.postProcess.getCamera().getViewport()},getIconScaleFov:function(e){e||(e=this._viewerOSGJS.getCamera().getProjectionMatrix());var t=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]);return.02*this.getViewport3d().width()*t/we.Z.getPixelRatio()[0]},getResourceManager:function(){return this._resourceManager||x.Z.instance},getCurrentTabName:function(){if(this._urlOptions.widgetAPI)return this._urlOptions.widgetAPI.getTabbedWidget().get()},getTargetAndEyeFocusFromBound:function(e,t,i){if(!e.valid())return!1;var n=this._viewerOSGJS.getManipulator(),r=n.getCurrentManipulator().getHomeBoundingSphere();r.volume()<e.volume()&&(e=r),Pe.vec3.copy(t,e.center(t));var a=n.getHomeDistance(e);return n.getEyePosition(i),Pe.vec3.sub(i,t,i),i[2]=0,Pe.vec3.normalize(i,i),Pe.vec3.scale(i,i,a),Pe.vec3.sub(i,t,i),!0},focusOnBound:(be=Pe.vec3.create(),Se=Pe.vec3.create(),function(e,t,i){return!!this.getTargetAndEyeFocusFromBound(e,be,Se)&&this.focusOnTargetAndEye(be,Se,t,i)}),focusOnTargetAndEye:(Ce=Pe.vec3.create(),function(e,t,i,n){var r=this._features.camera;if(!r)return!1;var a=this._viewerOSGJS.getManipulator();if(!i||i<0)return a.setTargetAndEye(e,t),!0;var o=r.getModel();return e||(e=a.getTarget(Ce)),t||(t=a.getEyePosition(Ce)),o.setTargetAndEye(e,t,n),o.set("animationDuration",i),!0}),focusOnHomePosition:function(e){var t=this._features.camera;if(t&&t.getModel()){var i=t.getManipulator().getCurrentManipulator(),n=i.getHomeBoundingSphere(),r=n.center(),a=i.getEyePosition(Pe.vec3.create());Pe.vec3.sub(a,r,a),Pe.vec3.normalize(a,a),Pe.vec3.scale(a,a,i.getHomeDistance(n)),Pe.vec3.sub(a,r,a),this.focusOnTargetAndEye(r,a,e)}},focusOnSavedCamera:function(e){var t=this._context.getModel().get("options"),i=(0,v.Z)(),n=this._viewerOSGJS.getManipulator(),r=i.cameraTarget||t.camera.target,a=i.cameraEye||t.camera.position,o=a&&null!==a[0];return o?o&&!this._features.camera.getModel().validateEyeTarget(a,r)?n.computeHomePosition():void this.focusOnTargetAndEye(r,a,e):n.computeHomePosition()},updateFocusOnAutoHit:function(){if(!this._autoHit.get("focus"))return!0;var e=(0,Ne.kR)(this._autoHit),t=this._features.camera.getManipulator().getCurrentManipulator(),i=t.getEyePosition(Pe.vec3.create()),n=t.getTarget(Pe.vec3.create()),r=Pe.vec3.create(),a=Pe.vec3.create();return 1===(0,v.Z)().cameraFollowBones?(Pe.vec3.sub(a,e,n),Pe.vec3.add(r,i,a),Pe.vec3.copy(a,e)):(Pe.vec3.sub(r,e,i),Pe.vec3.normalize(r,r),Pe.vec3.scale(r,r,Pe.vec3.dist(i,n)),Pe.vec3.sub(r,e,r),Pe.vec3.copy(a,e)),Pe.vec3.lerp(a,n,a,.25),Pe.vec3.lerp(r,i,r,.25),this.focusOnTargetAndEye(a,r,0),!0},setInitialAnimation:function(){if(this._features.camera.getModel().shouldPlayFirstCameraAnimation()){var e=Pe.vec3.create(),t=Pe.vec3.create(),i=this._viewerOSGJS.getManipulator();i.getEyePosition(t),i.getTarget(e);var n=[e[0]-t[0],e[1]-t[1],0],r=n[0]>n[1]?0:1,a=0===r?1:0,o=Pe.vec3.create();o[a]=1;var s=n[r]<0?-1:1;o[2]=.2*s;var l=1.5*Re.Z.getModelBoxWithDisplacement().radius();Pe.vec3.scale(o,o,10*l*s);var u=Pe.vec3.add(Pe.vec3.create(),t,o);i.setEyePosition(u),this.focusOnTargetAndEye(e,t,2.5);var h=this._features.autospin.getModel();h.set("speed",-h.get("speed")*s)}else j.Z.resolveFirstCameraAnimation()},focusOnHit:function(e,t,i){var n=Pe.vec3.create();ne.Z.getWorldPositionFromHit(e,n);var r=this._features.camera.getManipulator().getCurrentManipulator(),a=r.getEyePosition(Pe.vec3.create()),o=i*r.getHomeDistance(r.getHomeBoundingSphere());Pe.vec3.dist(n,a)>o&&(Pe.vec3.sub(a,n,a),Pe.vec3.normalize(a,a),Pe.vec3.scale(a,a,o),Pe.vec3.sub(a,n,a)),this.focusOnTargetAndEye(n,a,t,!0)},_focusDof:function(e,t){var i=this._features.postProcess.getModel();ne.Z.getPixelDepth(e,t,(function(e,t,n){if(!(e<0||e>=1)){var r=i.get("dofFocusPoint");ne.Z.getWorldPositionFromDepthXY(e,t,n,r),i.trigger("change:dofFocusPoint",r)}}))},onSingleClick:(me=Pe.vec3.create(),_e=Pe.vec3.create(),ve=Pe.vec2.create(),function(e){var t=e.canvasX,i=e.canvasY,n=this._features.postProcess.getModel();n.get("enable")&&n.get("dofEnable")&&this._focusDof(e.glX,e.glY);var r="materials"===this.getCurrentTabName(),a="split"===this._features.inspector.getModel().get("splitType")||r,o=this._viewerWebGL.getViewerAPI(),s=o&&o.intersectPoint||a,l=this._features.ARKit.getModel();if(l.get("enable")&&l.trigger("pick",Pe.vec2.fromValues(t,i)),s){var u=ne.Z.computeNearestIntersection2D(t,i);if(a&&this._singleClickOnInspector(u),u){var h=_e,c=o&&o.intersectPoint?me:void 0;ne.Z.getWorldPositionFromHit(u,h,c),o&&o.intersectPoint&&(ve[0]=t,ve[1]=i,o.intersectPoint(u,h,ve,c))}}}),_singleClickOnInspector:function(e){var t=e&&ne.Z.getMaterialFromHit(e);if(t){var i=this._features.inspector.getModel(),n=t.get("id");i.get("material")===n?i.trigger("change:material",i,n):i.set("material",n)}else this._features.outline.getModel().trigger("hideOutline")},onDoubleClick:function(e){if((0,v.Z)().doubleClick){var t=this._features.camera;if(!t.getModel().get("webVR")&&t.canMoveTarget())if(this._autoHit&&this._autoHit.get("focus")&&this._autoHit.set("focus",!1),e.pointers&&e.pointers.length>1)this.focusOnHomePosition(1);else{var i=ne.Z.computeNearestIntersection2D(e.canvasX,e.canvasY);if(i){var n=this.getCurrentTabName();"virtual reality and augmented reality"!==n?"annotations"!==n&&"sound"!==n&&((0,v.Z)().cameraFollowBones&&(0,q.Z)(i._nodePath)?((0,Ne.hP)(this._autoHit,i),this._autoHit.set("focus",!0)):(this._features.outline.getModel().trigger("clearFocusTimeout"),this.focusOnHit(i,1,.2))):this._features.webVR.getModel().trigger("doubleTap",i)}else this.focusOnHomePosition(1)}}},preloadMaxBackground:function(){var e=this._features.background;if(e){var t=e.getModel();if(t&&"fixed"===t.get("enable")){var i=t.getBackground();if(i){var n=i.findImageNearestUpToResolution(window.screen.width,window.screen.height);n&&this.getResourceManager().getOrCreateTexture(n.url,{minFilter:Pe.Texture.LINEAR,magFilter:Pe.Texture.LINEAR,transferToGPU:!1,convertNPOT:!1,internalFormat:Pe.Texture.RGB})}}}},applyAutospinToCamera:function(e,t){var i=this._features.autospin;if(i){var n=i.getNode().getMatrix();Pe.vec3.transformMat4(e,e,n),Pe.vec3.transformMat4(t,t,n)}},getCameraWithoutAutospin:(pe=Pe.mat4.create(),function(e,t){var i=this._features.autospin;if(i){var n=this._viewerOSGJS.getManipulator();n.getEyePosition(e),n.getTarget(t),Pe.mat4.invert(pe,i.getNode().getMatrix()),Pe.vec3.transformMat4(e,e,pe),Pe.vec3.transformMat4(t,t,pe)}}),createGizmoNode:function(){var e=new Pe.Camera;e.getOrCreateStateSet().setRenderBinDetails(te.Z.EDITOR_GIZMO,"RenderBin");var t=this._nodeGizmo=new X(this._viewerOSGJS);t.setTraversalMask(Ee.Z.PICK_GIZMO_LIGHT),e.addChild(t);var i=this._urlOptions.widgetAPI;if(i){var n=this._features.orientation;i.getTabbedWidget().model.on("change:value",(function(){t.attachToNode(null),n&&n.getModel().set("showGizmo",!1)}))}return e},setManipulatorNode:function(e){this._features.camera?this._features.camera.getModel().set("node",e):this._viewerOSGJS.getManipulator().setNode(e)},getNodeGizmo:function(){return this._nodeGizmo},initializePreciseBoundManager:function(){var e=this._features.orientation.getNode();Re.Z.computePreciseBox(e);var t=Re.Z.getModelBoxWithDisplacement();e.getBoundingBox().copy(t);var i=e.getBoundingSphere();i.set(t.center(i.center()),t.radius()),ne.Z.init(this._context,this.getRootModel())},initGraph:function(e){var t=this._features,i=new Pe.Node;i.getOrCreateStateSet().setAttributeAndModes(De.Z.CULL_DISABLE),i.setName("FeatureManager - Root"),i.addChild(Te.Z),Te.Z.initReadyForHighResBound();var n=t.orientation,r=t.autospin,a=t.outline,o=t.ground,s=t.environment,l=t.lighting,u=t.camera,h=t.sound,c=t.hotspot,A=t.postProcess,d=t.webVR,g=t.ARKit,f=t.inspector,p=l.getNodeShadow(),m=i;A&&(i.addChild(A.getNodeIn()),m=A.getNodeOut()),m.addChild(this.createGizmoNode(m)),m.addChild(p),m=p;for(var _=[u,s,l,h,d,c,f,a,r,g,o,n],v=0,C=_.length;v<C;++v){var b=_[v];if(b){var S=b.getNodeIn?b.getNodeIn():b.getNode(),E=b.getNodeOut?b.getNodeOut():b.getNode();m.addChild(S),m=E}}return m.addChild(e),i},addGlobalUniforms:function(){var e=this._features.postProcess.getNodeIn().getOrCreateStateSet();for(var t in b.Z)e.addUniform(b.Z[t])},finished:function(e){var t=this._features,i=this.getRootModel();i.setNodeMask(Ee.Z.PICK_GEOMETRY_SHADOW),i.setName("Scene - RootModel"),_.Z.nodeRootModel=i;var n=this._viewerOSGJS.getCamera();Be.Z.setCamera(n),i.addUpdateCallback(Be.Z);var r=this.initGraph(i);e.addChild(r),this.setManipulatorNode(this._features.orientation.getNode()),this.preloadMaxBackground();var a=t.lighting;a&&a.getModel().initLights(t.material.getSceneLights());var o=t.environment;o&&o.getNode().init(n,a.getNodeShadow());if(window.sketchfabViewerStats.shadows>1&&Pe.WebGLCaps.instance().getWebGLParameter("MAX_FRAGMENT_UNIFORM_VECTORS")<65)for(var s=a.getModel().get("lights"),l=window.sketchfabViewerStats.shadows-1,u=0;u<3&&0!==l;u++){var h=s[u];h.get("enable")&&h.isCastingShadows()&&(h._enableShadow=!1,l--)}return we.Z.init(this._canvas,this._features.quality.getModel(),this._viewerOSGJS.getCanvasPixelRatio()),this.focusOnSavedCamera(),this._features.camera&&this._features.camera.getModel().saveCameraPosition(),ae.Z.initGlobalClickEvents(this,this._canvas),this._viewerOSGJS.getInputManager().setEnable("global_click_events",!0),i.getOrCreateStateSet().setAttribute(new re.Z),(0,v.Z)().zz?(i.accept(new xe.Z),j.Z.getWireframeOptimizedSplit().then((function(){i.accept(new xe.Z),j.Z.resolveWireframeOptimizedSplitCompressed()}))):j.Z.getWireframeOptimizedSplit().then(j.Z.resolveWireframeOptimizedSplitCompressed),this.addGlobalUniforms(),Pe.time("drawFirstFrame"),this._viewerWebGL.drawFrame(),Pe.timeEnd("drawFirstFrame"),this.initializePreciseBoundManager(),t.webVR&&t.webVR.getModel().initAfterFirstFrame(),t.postProcess&&t.postProcess.getModel().initAfterFirstFrame(),t.camera&&t.camera.getModel().initAfterFirstFrame(),t.lighting&&t.lighting.getModel().set("forceShadowRedraw",!0),Pe.time("drawSecondFrame"),this._viewerWebGL.drawFrame(),Pe.timeEnd("drawSecondFrame"),t.lighting&&t.lighting.getModel().set("forceShadowRedraw",!1),(0,d.Z)()&&(j.Z.getFirstAnimation().then(function(){this.registerOptionsJSON(this._viewerWebGL.getOptionsJSON())}.bind(this)),window.addEventListener("beforeunload",this.onBeforeUnload.bind(this),!1)),!(0,Ie.Z)()&&"onhashchange"in window&&window.addEventListener("hashchange",this._hashChanged.bind(this),!1),(0,v.Z)().debug3D&&fe(this,r),(0,v.Z)().cameraFollowBones&&(this._autoHit=new Me.Z,r.addUpdateCallback({update:this.updateFocusOnAutoHit.bind(this)})),r},_registerCollection:function(e){e.each((function(e){e.registerOptions()}))},registerOptionsJSON:function(e){this._lastOptions=(0,H.Z)(e);var t=this._features;this._registerCollection(t.animation.getModel().get("animations")),this._registerCollection(t.hotspot.getModel().get("hotspots"))},getUnsavedChanges:function(){var e=this._viewerWebGL.getOptionsJSON();return(0,z.Z)(this._lastOptions,(function(t,i,n){return(0,W.Z)(i,e[n])?t:t.concat(n)}),[])},getUnsavedMessage:function(){var e=this.getUnsavedChanges();if(0!==e.length){var t="You have unsaved changes:\n";return t+="- "+e.join("\n- "),t+="\n\nYou might want to save your changes before leaving."}},onBeforeUnload:function(e){var t=this.getUnsavedMessage();return t&&(e.returnValue=t),t},_hashChanged:function(){var e={};e=(0,ye.Z)(e),this._features.material.getModel().overrideMaterialChannels(e);var t=(0,v.Z)();!t.debug3D&&Boolean(e.debug3D)&&(t.debug3D=!0,fe(this,this.getRootModel())),!t.stats&&Boolean(e.stats)&&(t.continuousRender=!0,t.stats=!0,this._viewerOSGJS.initStats({getBoolean:function(e){return"stats"===e}})),this._features.inspector.getModel().set("uiVisible",Boolean(e.inspector))},getShadowForcedUpdate:function(){return!!(0,v.Z)().shadow&&(!!C.Z.getShadowForcedUpdate()||(!!this._viewerWebGL.getSuperSample().isEnabled()||(!!this._features.lighting.getModel().get("forceShadowRedraw")||(!!this._features.autospin.getModel().get("enable")||!!this._features.animation.getModel().isPlaying()))))}};const Oe=Fe;var Le=i("RKWW"),ke=i("0z3s"),Ze=i("3o3Y"),Ue=i("pcq+"),Ve=u.Z.osg,Qe=u.Z.osgShader.shaderProcessor,Ge=Math.random(),He=function(e,t){this._vertDefines=[],this._fragDefines=[],this._vertAssignUV=[],this._envBrdf,this._envSpecular,this._compression,this._material,this._skinning,this._morphing,this._pointSize,this._lights=[],this._shadows=[],this._shadowsTextures=[],this._targetByUnit=[],this.initAttributes(e),this.initTextureAttributes(t);var i=this._material?this._material.getMaterialModel():void 0;this._channels=i?i.getChannels():void 0,Ue.default.apple.device&&this._vertDefines.push("#define IS_IOS"),this.defineShaderName(),this.initDefines()};Ve.setStateAttributeConfig(He,{attribute:["VertexCompression","SketchfabLight0","SketchfabLight1","SketchfabLight2","SketchfabLight3","ShadowReceive0","ShadowReceive1","ShadowReceive2","ShadowReceive3","SketchfabMaterial","Morph","Skinning","PointSize","Decals"],textureAttribute:["Texture"]}),Ve.createPrototypeObject(He,{getCompilerName:function(){return"PBR"},getFragmentMain:function(){return"pbr.frag"},getVertexMain:function(){return"pbr.vert"},initAttributes:function(e){for(var t=this._lights,i=this._shadows,n=0,r=e.length;n<r;n++){var a=e[n].className();"Light"===a?t.push(e[n]):"Material"===a?this._material=e[n]:"ShadowReceiveAttribute"===a?i.push(e[n]):"SkinningAttribute"===a?this._skinning=e[n]:"MorphAttribute"===a?this._morphing=e[n]:"PointSizeAttribute"===a?this._pointSize=e[n]:"VertexCompression"===a?this._compression=e[n]:"DecalsAttribute"===a&&(this._decals=e[n])}},initTextureAttributes:function(e){for(var t=e.length,i=0;i<t;i++){var n=e[i];if(n)for(var r=0,a=n.length;r<a;r++){var o=n[r];this._targetByUnit[i]=o;var s=o.className();if("TextureEnvironment"===s){var l=o.getChannel();"SpecularPBR"===l||"Specular"===l?this._envSpecular=o:"IntegrateBRDF"===l&&(this._envBrdf=o)}"ShadowTexture"!==s&&"ShadowTextureAtlas"!==s||this._shadowsTextures.push(o)}}},defineShaderName:function(){this._vertDefines.push("#define SHADER_NAME "+this.getVertexShaderName()),this._fragDefines.push("#define SHADER_NAME "+this.getFragmentShaderName());var e=(1-(0,v.Z)().epsilonAlpha).toExponential();this._fragDefines.push("#define EPSILON_ALPHA "+e)},getFragmentShaderName:function(){var e=this.getCompilerName(),t=this._material&&this._material.getName();t&&(e+="("+(t=t.replace(/[^a-zA-Z0-9]+/g,"_").slice(0,20))+")");var i,n=this._channels&&this._channels.Opacity,r=n&&n.isEffective()&&n.get("type");if(i="alphaBlend"===r||"additive"===r?"Blend":"refraction"===r?"Refract":"dithering"===r?"Dither":"Opaque",this._channels&&this._channels.AlphaMask&&this._channels.AlphaMask.isEffective()&&(i="AlphaMask"+i),i){var a=this.getCompilerName();e=e.replace(a,a+"_"+i)}return e},getVertexShaderName:function(){return this.getFragmentShaderName()},getDebugIdentifier:function(){var e=this.getVertexShaderName(),t=this.getFragmentShaderName();return e===t?t:e+"|"+t},createShader:function(e){var t=e?this.getFragmentMain():this.getVertexMain(),i=e?this._fragDefines:this._vertDefines;e||i.push("#define ASSIGN_UV "+this._vertAssignUV.join(" ")),i=Qe.getSortedUnique(i);for(var n="",r=0;r<i.length;++r)i[r]&&(n+=i[r]+"\n");return n=(n="#define SHADER_NAME "+this.getFragmentShaderName()+"\n"+n)+'#pragma include "'+t+'"',Qe.processShader(n)},createFragmentShader:function(){return this.createShader(!0)},createVertexShader:function(){return this.createShader(!1)},declareAndAssignTexCoord:function(e,t){var i="TexCoord"+e;if(this._vertDefines.push("attribute vec2 "+i+";"),t&&!this._compression)return i;var n="vTexCoord"+e,r="varying vec2 "+n+";",a="vec2 "+n+";";if(t)-1===this._vertDefines.indexOf(r)&&this._vertDefines.push("vec2 "+n+";");else{this._fragDefines.push(r),this._vertDefines.push(r);var o=this._vertDefines.indexOf(a);-1!==o&&this._vertDefines.splice(o,1)}var s=n+" = ";if(this._compression){var l="uQUV"+e;this._vertDefines.push("uniform vec4 "+l+";"),s+=i+".xy * "+l+".zw + "+l+".xy;"}else s+=i+";";return-1===this._vertAssignUV.indexOf(s)&&this._vertAssignUV.push(s),n},_getTexCoordTransforms:function(e,t){var i="u"+t;return e="vec2( mat2("+i+"UVTransforms) * "+e,e+=" + "+i+"UVOffset)"},getChannelUV:function(e){var t=e.getName();if(!e.getTextureModel()){var i=M.Z.getColorPacking(t);return 0===i?"vec2(0.125, 0.5)":1===i?"vec2(0.375, 0.5)":2===i?"vec2(0.625, 0.5)":"vec2(0.875, 0.5)"}var n="Displacement"===e.get("name"),r=this.declareAndAssignTexCoord(e.getTexCoordUnit(),n);return e.getNonIdentityUvTransform()&&(r=this._getTexCoordTransforms(r,e.get("name"))),r},defineOpacity:function(e){var t=e.get("type");"alphaBlend"!==t&&"additive"!==t?"dithering"!==t?(this._fragDefines.push("#define HAS_OPACITY_REFRACTION"),e.get("useNormalOffset")&&this._fragDefines.push("#define HAS_REFRACTION_NORMAL_OFFSET"),e.get("useAlbedoTint")&&this._fragDefines.push("#define HAS_REFRACTION_ALBEDO_TINT"),e.get("useMicrosurfaceTexture")&&this._fragDefines.push("#define HAS_REFRACTION_MICROSURFACE"),(0,v.Z)().depthMipmap&&this._fragDefines.push("#define DEPTH_MIPMAP")):this._fragDefines.push("#define HAS_OPACITY_DITHER"):this._fragDefines.push("#define HAS_OPACITY_BLEND_OR_ADDITIVE")},defineChannel:function(e){var t=e.getName();if(e.isEnableEffectiveHardware(this._material)){var i="Displacement"===t?this._vertDefines:this._fragDefines,n=t.toUpperCase();if(i.push("#define HAS_"+n),"NormalMap"!==t&&"Inspector"!==t||this._vertDefines.push("#define HAS_"+n),e.isEffective()){"NormalMap"!==t&&"BumpMap"!==t&&"ClearCoatNormalMap"!==t&&"Anisotropy"!==t||(this._decals&&this._decals.isComputeFragmentTangents()?this._fragDefines.push("#define COMPUTE_FRAGMENT_TANGENTS"):(this._fragDefines.push("#define HAS_VIEW_TANGENT"),this._vertDefines.push("#define HAS_VIEW_TANGENT"))),"Opacity"===t&&this.defineOpacity(e),"Displacement"===t&&((0,v.Z)().substanceDisplacement?i.push("#define HAS_SUBSTANCE_DISPLACEMENT"):i.push("#define HAS_SKETCHFAB_DISPLACEMENT")),"AlbedoPBR"===t&&!e.getTextureModel()&&this._decals&&this._decals.isDiscardOutOfTextureBoundPixels()&&this.declareAndAssignTexCoord(0,!1);var r=M.Z.getColorPacking(t);if(e.getTextureModel()||!(r<0)){var a=this._material.getChannelMapping(t);if(!(void 0===a||a<0)){var o=this._targetByUnit[a],s=o.getName(),l=o.getChannelPacking(t),u=e.getSRGB()?"sRGBToLinear":"",h=t.toUpperCase(),c=this.getChannelUV(e);i.push("uniform sampler2D "+s+";"),i.push("uniform vec4 u"+t+"UVTransforms;"),i.push("uniform vec2 u"+t+"UVOffset;"),i.push("#define SAMPLER_"+h+" "+s),i.push("#define PACK_"+h+" "+l),i.push("#define UV_"+h+" "+c),i.push("#define COLOR_CONVERT_"+h+" "+u)}}}}},defineVertexColorAndAlpha:function(){if(this._material&&this._material.getVertexColorEnable()){this._fragDefines.push("#define HAS_VERTEX_COLOR"),this._vertDefines.push("#define HAS_VERTEX_COLOR");var e="srgb"===this._material.getVertexColorColorSpace()?"sRGBToLinear":"";this._fragDefines.push("#define COLOR_CONVERT_VERTEX_COLOR "+e),this._material.getVertexAlphaEnable()&&(this._fragDefines.push("#define HAS_VERTEX_ALPHA"),this._vertDefines.push("#define HAS_VERTEX_ALPHA"))}},defineLights:function(){var e=this._lights;if(e.length){for(var t=0;t<e.length;++t){var i=e[t],n=i.getLightNumber(),r="LIGHT_"+i.getLightType();this._fragDefines.push("#define LIGHT_TYPE_"+n+" "+r)}this._fragDefines.push("#define HAS_LIGHT")}},defineShadows:function(){var e=this._shadows;if(e.length){for(var t=0;t<e.length;++t){var i=e[t];this._fragDefines.push("#define HAS_SHADOW_"+i.getLightNumber()),this._fragDefines.push.apply(this._fragDefines,i.getDefines())}this._fragDefines.push("#define HAS_SHADOW"),this._vertDefines.push("#define HAS_MODEL_VERTEX"),this._vertDefines.push("#define HAS_MODEL_NORMAL")}},defineEnvironment:function(){this._envSpecular&&(this._fragDefines.push("#define HAS_ENVIRONMENT"),this._envSpecular.getIsCubemap()?this._fragDefines.push("#define ENV_CUBEMAP"):this._fragDefines.push("#define ENV_PANORAMA")),this._envBrdf&&this._fragDefines.push("#define HAS_ENVIRONMENT_BRDF")},defineSsr:function(){Ze.Z.get("hasSsr")&&(this._fragDefines.push("#define HAS_SSR"),(0,v.Z)().ssrTransparent&&this._fragDefines.push("#define HAS_SSR_TRANSPARENT"),(0,v.Z)().depthMipmap&&-1===this._fragDefines.indexOf("#define DEPTH_MIPMAP")&&this._fragDefines.push("#define DEPTH_MIPMAP"))},defineSkinning:function(){this._skinning&&(this._vertDefines.push("#define HAS_SKINNING"),this._vertDefines.push("#define NUM_BONES "+this._skinning.getBoneUniformSize()))},defineMorphing:function(){this._morphing&&this._morphing.hasTarget("Vertex")&&(this._vertDefines.push("#define HAS_MORPHING"),this._vertDefines.push("#define NUM_TARGETS "+this._morphing.getNumTargets()),this._morphing.hasTarget("Normal")&&this._vertDefines.push("#define HAS_MORPHING_NORMAL"),this._morphing.hasTarget("Tangent")&&this._vertDefines.push("#define HAS_MORPHING_TANGENT"))},defineChannels:function(){var e=this._channels;for(var t in e)this.defineChannel(e[t])},_randHardcodedScale:function(){var e,t=Ve.BufferArray.randa,i=t[0],n=t[1],r=t[2];Ge>.5?e="* ":(e="/ ",i=1/i,n=1/n,r=1/r),i=i.toExponential(),n=n.toExponential(),r=r.toExponential();var a=Math.random();return a<.33?e+"vec3("+r+","+i+","+n+").yzx":a<.66?e+"vec3("+n+","+r+","+i+").zxy":e+"vec3("+r+","+i+","+n+").yzx"},defineCompression:function(){this._compression&&(0,v.Z)().zz&&(this._vertDefines.push("#define RAND_SCALE "+this._randHardcodedScale()),this._vertDefines.push("#define HAS_COMPRESSION"),(0,v.Z)().zoct&&this._vertDefines.push("#define HAS_OCT_COMPRESSION"),(0,v.Z)().zw&&this._vertDefines.push("#define HAS_ZW_COMPRESSION"))},definePointSize:function(){this._pointSize&&(this._vertDefines.push("#define HAS_POINT_SIZE"),this._pointSize.isCircleShape()&&this._fragDefines.push("#define HAS_POINT_CIRCLE"))},defineDecals:function(){this._decals&&(this._decals.isDiscardOutOfTextureBoundPixels()&&this._fragDefines.push("#define HAS_DISCARD_OOTB_PIXELS"),this._decals.hasPolygonOffset()&&this._vertDefines.push("#define HAS_POLYGON_OFFSET"))},initDefines:function(){this.defineChannels(),this.defineVertexColorAndAlpha(),this.defineLights(),this.defineShadows(),this.defineEnvironment(),this.defineSsr(),this.defineMorphing(),this.defineSkinning(),this.defineCompression(),this.definePointSize(),this.defineDecals(),Ze.Z.get("mask")&Ze.Z.CLASSIC&&(this._fragDefines.push("#define HAS_LEGACY_CLASSIC"),"PBR"===this.getCompilerName()&&(this._fragDefines.push('#pragma include "utils/cubemap.glsl"'),this._fragDefines.push('#pragma include "utils/lights.glsl"')))}},"osgSketchfab","Compiler");const ze=He;var We=u.Z.osg,je=function(){ze.apply(this,arguments)};We.setStateAttributeConfig(je,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","PointSize"],textureAttribute:["Texture"]}),We.createPrototypeObject(je,We.objectInherit(ze.prototype,{getCompilerName:function(){return"Shadeless"},getFragmentMain:function(){return"shadeless.frag"},getVertexMain:function(){return"shadeless.vert"},defineChannels:function(){var e=this._channels;this.defineChannel(e.AlbedoPBR),this.defineChannel(e.DiffusePBR),this.defineChannel(e.AlphaMask),this.defineChannel(e.Opacity),this.defineChannel(e.Displacement),this.defineChannel(e.EmitColor),this.defineChannel(e.CavityPBR),this.defineChannel(e.AOPBR),this.defineChannel(e.DiffuseColor),this.defineChannel(e.DiffuseIntensity),-1!==this._fragDefines.indexOf("#define HAS_OPACITY_REFRACTION")&&(this._vertDefines.push("#define HAS_VIEW_NORMAL"),this._vertDefines.push("#define HAS_VIEW_VERTEX"))}}));const qe=je;var Je=u.Z.osg,Ye=function(){ze.apply(this,arguments)};Je.setStateAttributeConfig(Ye,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","PointSize"],textureAttribute:["Texture"]}),Je.createPrototypeObject(Ye,Je.objectInherit(ze.prototype,{getCompilerName:function(){return"Matcap"},getFragmentMain:function(){return"matcap.frag"},getVertexMain:function(){return"matcap.vert"},getChannelUV:function(e){return"Matcap"===e.getName()?"":ze.prototype.getChannelUV.call(this,e)},defineChannels:function(){var e=this._channels;this.defineChannel(e.AlphaMask),this.defineChannel(e.Opacity),this.defineChannel(e.Displacement),this.defineChannel(e.NormalMap),this.defineChannel(e.BumpMap),this.defineChannel(e.Matcap)}}));const Ke=Ye;var Xe=u.Z.osg,$e=function(){ze.apply(this,arguments)};Xe.setStateAttributeConfig($e,{attribute:["SketchfabLight0","SketchfabLight1","SketchfabLight2","SketchfabLight3","ShadowReceive0","ShadowReceive1","ShadowReceive2","ShadowReceive3","GroundStateAttribute"],textureAttribute:["Texture"]}),Xe.createPrototypeObject($e,Xe.objectInherit(ze.prototype,{getCompilerName:function(){return"Ground"},getFragmentMain:function(){return"ground/ground.frag"},getVertexMain:function(){return"ground/ground.vert"},initAttributes:function(e){for(var t=this._lights,i=this._shadows,n=0,r=e.length;n<r;n++){var a=e[n].className();"Light"===a?t.push(e[n]):"ShadowReceiveAttribute"===a?i.push(e[n]):"GroundStateAttribute"===a&&(this._groundState=e[n])}},initDefines:function(){var e=this._groundState.isUseBakedAo(),t=this._groundState.isDisplayPlane();e?this._fragDefines.push("#define BAKED_AO"):(this.defineLights(),this.defineShadows(),this._shadows.length&&this._lights.length?this._fragDefines.push("#define SHADOW_CATCHER"):this._fragDefines.push("#define PASS_THROUGH")),t&&this._fragDefines.push("#define DISPLAY_PLANE"),this._vertDefines.push("attribute vec2 TexCoord0;"),this._vertDefines.push("varying vec2 vTexCoord0;"),this._vertAssignUV.push("vTexCoord0 = TexCoord0;")}}));const et=$e;var tt=u.Z.osg,it=function(){ze.apply(this,arguments)};tt.setStateAttributeConfig(it,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","PointSize","Decals"],textureAttribute:["Texture"]}),tt.createPrototypeObject(it,tt.objectInherit(ze.prototype,{getCompilerName:function(){return"EarlyZ"},getFragmentMain:function(){return"earlyz.frag"},getVertexMain:function(){return"earlyz.vert"},defineChannels:function(){var e=this._channels;e&&(this.defineChannel(e.AlphaMask),this._decals&&this._decals.isDiscardOutOfTextureBoundPixels()&&this.declareAndAssignTexCoord(0,!1),this.defineChannel(e.Opacity),this.defineChannel(e.Displacement),this.defineChannel(e.SubsurfaceScattering))}}));const nt=it;var rt=u.Z.osg,at=function(){nt.apply(this,arguments)};rt.setStateAttributeConfig(at,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","ShadowCast"],textureAttribute:["Texture"]}),rt.createPrototypeObject(at,rt.objectInherit(nt.prototype,{getCompilerName:function(){return"ShadowBakeAo"},getFragmentMain:function(){return"ground/bakeShadowMap.frag"},getVertexMain:function(){return"ground/bakeShadowMap.vert"},defineChannels:function(){var e=this._channels;e&&(this.defineChannel(e.AlphaMask),this.defineChannel(e.Opacity),this.defineChannel(e.Displacement))}}));const ot=at;var st=u.Z.osg,lt=function(){nt.apply(this,arguments)};st.setStateAttributeConfig(lt,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","ShadowCast"],textureAttribute:["Texture"]}),st.createPrototypeObject(lt,st.objectInherit(nt.prototype,{getCompilerName:function(){return"ShadowCastSkfb"},getFragmentMain:function(){return"shadowing/shadowCast.frag"},getVertexMain:function(){return"shadowing/shadowCast.vert"},defineChannels:function(){var e=this._channels;e&&(this.defineChannel(e.AlphaMask),this.defineChannel(e.Opacity),this.defineChannel(e.Displacement))}}));const ut=lt;var ht=u.Z.osg,ct=function(){ze.apply(this,arguments)};ht.setStateAttributeConfig(ct,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","PointSize"],textureAttribute:["Texture"]}),ht.createPrototypeObject(ct,ht.objectInherit(ze.prototype,{getCompilerName:function(){return"Outline"},getFragmentMain:function(){return"outline.frag"},getVertexMain:function(){return"outline.vert"},defineChannels:function(){var e=this._channels;e&&this.defineChannel(e.Displacement)}}));const At=ct;var dt=u.Z.osg,gt=function(){ze.apply(this,arguments)};dt.setStateAttributeConfig(gt,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning"],textureAttribute:["Texture"]}),dt.createPrototypeObject(gt,dt.objectInherit(ze.prototype,{getCompilerName:function(){return"Wireframe"},getFragmentMain:function(){return"wireframe.frag"},getVertexMain:function(){return"wireframe.vert"},defineChannels:function(){var e=this._channels;e&&this.defineChannel(e.Displacement)}}));const ft=gt;var pt=u.Z.osg,mt=function(){ze.apply(this,arguments)};pt.setStateAttributeConfig(mt,{attribute:["ShadowReceive0"],textureAttribute:["Texture"]}),pt.createPrototypeObject(mt,pt.objectInherit(ze.prototype,{getCompilerName:function(){return"ShadowAr"},getFragmentMain:function(){return"ARKit/shadowAr.frag"},getVertexMain:function(){return"ARKit/shadowAr.vert"},initDefines:function(){this.defineShadows()}}));const _t=mt;var vt=i("PSPx"),Ct=u.Z.osg,bt=function(){ze.apply(this,arguments)};Ct.setStateAttributeConfig(bt,{attribute:["VertexCompression","SketchfabMaterial","Morph","Skinning","PointSize"],textureAttribute:["Texture"]}),Ct.createPrototypeObject(bt,Ct.objectInherit(ze.prototype,{getCompilerName:function(){return"Inspector"},getFragmentMain:function(){return"inspector/inspector.frag"},getVertexMain:function(){return"inspector/inspector.vert"},defineChannels:function(){var e=this._channels;this.defineChannel(e.Opacity),this.defineChannel(e.Displacement),this.defineChannel(e.Inspector);var t=e.Inspector;if(t.getTextureModel()&&(this._fragDefines.push("#define HAS_INSPECTOR_TEXTURE"),this._vertDefines.push("#define HAS_INSPECTOR_TEXTURE"),e.Inspector.getSRGB()||this._fragDefines.push("#define CONVERT_INSPECTOR_TO_LINEAR")),t.isEnableEffectiveHardware(this._material))if(t.getTextureModel())this._fragDefines.push("#define FEEDBACK_UV UV_INSPECTOR");else{var i=t.get("selectUV");this.declareAndAssignTexCoord(i),this._fragDefines.push("#define FEEDBACK_UV vTexCoord"+i)}vt.Z.me().get("features").includes("ff_display_inspector_watermarking")&&this._fragDefines.push("#define DISPLAY_WATERMARK 1")}}));const St=bt;var Et=u.Z.osg,yt=function(){ze.apply(this,arguments)};Et.setStateAttributeConfig(yt,{attribute:[],textureAttribute:[]}),Et.createPrototypeObject(yt,Et.objectInherit(ze.prototype,{getCompilerName:function(){return"Controller"},getFragmentMain:function(){return"webVR/controller.frag"},getVertexMain:function(){return"webVR/controller.vert"},initDefines:function(){}}));const It=yt;var xt=u.Z.osg,Tt=function(){ze.apply(this,arguments)};xt.setStateAttributeConfig(Tt,{attribute:["Morph","Skinning","PointSize"],textureAttribute:[]}),xt.createPrototypeObject(Tt,xt.objectInherit(ze.prototype,{getCompilerName:function(){return"DebugNormal"},getFragmentMain:function(){return"debug/normal.frag"},getVertexMain:function(){return"debug/normal.vert"}}));const wt=Tt;var Mt=u.Z.osg,Rt=function(){ze.apply(this,arguments)};Mt.setStateAttributeConfig(Rt,{attribute:["Morph","Skinning","PointSize"],textureAttribute:[]}),Mt.createPrototypeObject(Rt,Mt.objectInherit(ze.prototype,{getCompilerName:function(){return"DebugTangent"},getFragmentMain:function(){return"debug/tangent.frag"},getVertexMain:function(){return"debug/tangent.vert"}}));const Bt=Rt;var Nt=u.Z.osg,Dt=function(){ze.apply(this,arguments)};Nt.setStateAttributeConfig(Dt,{attribute:["VertexCompression","Morph","Skinning","PointSize"],textureAttribute:[]}),Nt.createPrototypeObject(Dt,Nt.objectInherit(ze.prototype,{getCompilerName:function(){return"DebugGeometry"},getFragmentMain:function(){return"debug/geometry.frag"},getVertexMain:function(){return"debug/geometry.vert"}}));const Pt=Dt;var Ft=u.Z.osg,Ot=function(){ze.apply(this,arguments)};Ft.setStateAttributeConfig(Ot,{attribute:["VertexCompression","Morph","Skinning","PointSize"],textureAttribute:[]}),Ft.createPrototypeObject(Ot,Ft.objectInherit(ze.prototype,{getCompilerName:function(){return"DebugSkinning"},getFragmentMain:function(){return"debug/skinning.frag"},getVertexMain:function(){return"debug/skinning.vert"}}));const Lt=Ot;var kt=u.Z.osg,Zt=function(){ze.apply(this,arguments)};kt.setStateAttributeConfig(Zt,{attribute:["VertexCompression"],textureAttribute:[]}),kt.createPrototypeObject(Zt,kt.objectInherit(ze.prototype,{getCompilerName:function(){return"DebugBoneBox"},getFragmentMain:function(){return"debug/boneBox.frag"},getVertexMain:function(){return"debug/boneBox.vert"}}));const Ut=Zt;var Vt=-1,Qt=u.Z.osg,Gt=u.Z.osgShader.ShaderGenerator,Ht=function(e,t){Gt.call(this),this.setShaderCompiler(e),this._materialHashCompiler=t||ke.Z.SHADING_COMPILER};Qt.createPrototypeObject(Ht,Qt.objectInherit(Gt.prototype,{getOrCreateProgram:function(e){return ke.Z.CURRENT_COMPILER=this._materialHashCompiler,Gt.prototype.getOrCreateProgram.call(this,e)},_getProgram:function(e,t,i,n){var r=this._cache[e];return r&&-1===r.getAsyncCompiling()?r:r?r.getAsyncLinkingStatus()?(r.getLinkResult(t.getGraphicContext()),Vt-=1,i.length=0,n.length=0,this.getActiveAttributeList(t,i),this.getActiveTextureAttributeList(t,n),r.setActiveUniforms(this.getActiveUniforms(t,i,n)),r):(C.Z.draw(),r._placeHolder):void 0},_createProgram:function(e,t,i,n){var r=Gt.prototype._createProgram.call(this,e,t,i,n);return-1!==r.getAsyncCompiling()?(this._waitingProgram||(this._waitingProgram=this._createWaitingProgram(t,i,n),this._waitingProgram._name="placeHolder"),r.enableAsyncCompilation(this._waitingProgram,t._frameStamp._frame),Vt+=1,this._waitingProgram):r}}));var zt=function(e,t,i,n){e.addShaderGenerator(t,new Ht(i,n))},Wt={},jt=!1;Wt.register=function(e){jt||(jt=!0,zt(e,"lit-classic",ze),zt(e,"lit-pbr",ze),zt(e,"shadeless-classic",qe),zt(e,"shadeless-pbr",qe),zt(e,"matcap",Ke),zt(e,"ground",et),zt(e,"shadow-ao-bake",ot),zt(e,"earlyz",nt,ke.Z.EARLYZ_COMPILER),zt(e,"shadowcast",ut,ke.Z.SHADOWCAST_COMPILER),zt(e,"outline",At,ke.Z.SHADOWCAST_COMPILER),zt(e,"wireframe",ft,ke.Z.WIREFRAME_COMPILER),zt(e,"shadow-ar",_t),zt(e,"inspector",St),zt(e,"controller",It),zt(e,"debugNormal",wt),zt(e,"debugTangent",Bt),zt(e,"debugGeometry",Pt),zt(e,"debugSkinning",Lt),zt(e,"debugBoneBox",Ut))};const qt=Wt;var Jt=i("SZYu"),Yt=i("lVmk"),Kt=i("JeqU"),Xt=i("2fWj"),$t=function(e,t){this._key=e,this._progress=0,this._weight=0,this._active=!1,this._progressUpdate=t,this._promises,this._nbPromisesDone=0,this._lastSetPromiseId=0,this._cbFakeUpdate,this._refTime,this._totalBytes=0};$t.prototype={setPromises:function(e){this._progress=0,this._promises=e,this._nbPromisesDone=0,this._totalBytes=0,this._lastSetPromiseId++,this._cbFakeUpdate=this._onPromiseAutoUpdate.bind(this,this._lastSetPromiseId);for(var t=0;t<this._promises.length;++t){var i=this._promises[t];i.finally(this._onPromiseDone.bind(this,this._lastSetPromiseId,i.size||0)),this._totalBytes+=this._promises[t].progressSize||0}window.setTimeout(this._cbFakeUpdate,100),this._updateRefTime()},_updateRefTime:function(){this._refTime=(new Date).getTime()},_onPromiseDone:function(e,t){this._lastSetPromiseId===e&&(this._totalBytes-=t,this._updateRefTime(),this._nbPromisesDone++,this._progress=this._nbPromisesDone/this._promises.length,this._progressUpdate(this))},_onPromiseAutoUpdate:function(e){if(this._lastSetPromiseId===e){var t=this._promises.length;if(this._nbPromisesDone!==t){var i=2e-4*((new Date).getTime()-this._refTime),n=this._nbPromisesDone/t,r=(this._nbPromisesDone+1)/t;this._progress=r-(r-n)/(i*i+1),this._progressUpdate(this),window.setTimeout(this._cbFakeUpdate,100)}}}};var ei=function(e){this._triggerProgress=e,this._primaryChannels=[],this._secondaryChannels=[],this._init()};ei.prototype={_init:function(){var e=this._updateChannelProgress.bind(this,!1),t=this._primaryChannels;t.push(new $t("texture",e)),t.push(new $t("polygon",e)),t.push(new $t("osgjs",e)),t.push(new $t("wireframe",e));var i=this._updateChannelProgress.bind(this,!0),n=this._secondaryChannels;n.push(new $t("texture",i)),n.push(new $t("environment",i)),n.push(new $t("background",i)),n.push(new $t("wireframe",i))},initPrimaryProgress:function(e,t,i){var n=this._getProgressChannel("texture",!1),r=this._getProgressChannel("polygon",!1),a=this._getProgressChannel("osgjs",!1),o=this._getProgressChannel("wireframe",!1);n._totalBytes=this._estimateTexturesSize(),r._totalBytes=t,a._totalBytes=e,o._totalBytes=i,n._active=!0,r._active=!0,a._active=!0,o._active=i>0,this._autoComputeWeights()},_estimateTexturesSize:function(){var e,t=x.Z.instance.getTextureCollection().models,i=t.length;if(!i)return 0;if(!(0,v.Z)().preload)return 5e3*i;var n=0,r=0,a=(0,Kt.Z)();for(e=0;e<i;++e){var o=t[e].findImageNearestPowerOfTwoUpToResolution(a,a);r+=o.width*o.height,n=Math.max(n,o.width,o.height)}var s=(0,v.Z)().pixelBudget;void 0===s&&(s=Ue.default.any?6144:12288),s*=s;var l=Math.min(a,Math.sqrt(s/i));l=Xt.Z.snapToPowerOf2(l,.75),(n<=a||r<=l*l)&&(l=a);var u=0;for(e=0;e<i;++e)u+=t[e].findImageNearestPowerOfTwoUpToResolution(l,l).size;return u},_getProgressChannel:function(e,t){for(var i=t?this._secondaryChannels:this._primaryChannels,n=0;n<i.length;++n)if(i[n]._key===e)return i[n]},_autoComputeWeights:function(e){var t=e?this._secondaryChannels:this._primaryChannels,i=0,n=0,r=0,a=0;for(n=0;n<t.length;++n)t[n]._active&&(i++,r+=t[n]._totalBytes,t[n]._totalBytes||a++);var o=1/i,s=1-o*a;for(n=0;n<t.length;++n)if(t[n]._active){var l=t[n]._totalBytes;t[n]._weight=l?s*l/r:o}else t[n]._weight=0},_updateChannelProgress:function(e,t){var i=e?this._secondaryChannels:this._primaryChannels;e&&!t._active&&(t._active=!0,this._autoComputeWeights(!0));var n=0,r=0;for(r=0;r<i.length;++r)n+=i[r]._progress*i[r]._weight;var a=e?"secondary-progress":"primary-progress";if(this._triggerProgress(a,{progress:n}),1===n)for(r=0;r<i.length;++r)i[r]._active=!1},updateProgress:function(e,t,i){var n=this._getProgressChannel(i,t);n._progress=e,this._updateChannelProgress(t,n)},setFakeProgress:function(e,t,i){var n=this._getProgressChannel(i,t);n?(void 0===e.length&&(e=[e]),n.setPromises(e),t||this._autoComputeWeights()):console.error("Unexpected progress channel key : "+i)}};const ti=ei;var ii=i("6QKU"),ni=i("U4yk"),ri=i("59ul"),ai=i("vasR"),oi=i("dcVb"),si=i("S1Ss"),li=u.Z.osg,ui=u.Z.osgViewer,hi=new(l())({device:"VWR"}),ci=function(e){if(e.byteLength)return Array.prototype.slice.call(e)},Ai=function(e){return(0,o.Z)(e,ci)},di=function(e){this._dataScene=e,this._modelFile=this.selectModelFile(),this._rootModel=new li.Node,this._rootModel.setName("Scene - Root"),this._polygonNode=new li.Node,this._polygonNode.setName("Scene - PolygonNode"),this._wireframeNodes=[],this._resourcePromises=[],this._cleanLegacyAbsoluteUrl()};di.prototype={addResourcePromise:function(e){this._resourcePromises.push(e)},getJSON:function(){return this._dataScene},getPolygonURL:function(){return this._modelFile.osgjsUrl},getWireframeURL:function(){return this._modelFile.wireframeUrl},getOsgjsSize:function(){return this._modelFile.osgjsSize},getPolygonSize:function(){return this._modelFile.modelSize},getWireframeSize:function(){return this._modelFile.wireframeSize},getResourceManager:function(){return this._resourceManager||x.Z.instance},getRootModel:function(){return this._rootModel},getWireframeNodes:function(){return this._wireframeNodes},createOptionDownload:function(e,t,i){return{node:i,progress:t,diter:this._modelFile.p&&this._modelFile.p[0]&&this._modelFile.p[0],binarySize:"polygon"===e?this.getPolygonSize():this.getWireframeSize(),binaryKey:e,osgjsSize:this.getOsgjsSize(),osgjsKey:"osgjs",secondary:!1}},loadPolygon:function(e,t,i,n){var r=this.createOptionDownload("polygon",e,this._polygonNode);if(t){var a=n?e:void 0;r.wireframeOptions=this.createOptionDownload("wireframe",a),r.wireframeOptions.startPromise=i,r.wireframeOptions.deferDownload=new Yt.Z,r.wireframeOptions.nodes=this.getWireframeNodes(),n&&this._resourcePromises.push(r.wireframeOptions.deferDownload);var o=li.Timer.instance().tick();r.wireframeOptions.deferDownload.then((function(){j.Z.resolveWireframe({time:li.Timer.instance().tick()-o})}))}var s=this.getResourceManager().getOrCreateModel(this.getPolygonURL(),r);return this.getRootModel().addChild(this._polygonNode),this.getResourceManager().run(),s.promise},loadWireframeLegacy:function(e){var t=this.createOptionDownload("wireframe",e,new li.Node);t.node.setStateSet(new ni.Z);var i=this.getResourceManager().getOrCreateModel(this.getWireframeURL(),t);return this.getWireframeNodes().push(t.node),this.getRootModel().addChild(t.node),i.promise},selectModelFile:function(){var e=(0,d.Z)()||(0,v.Z)().apiVersion||(0,Ie.Z)()?0:1;void 0!==(0,v.Z)().modelOptimization&&(e=(0,v.Z)().modelOptimization?1:0);for(var t=this._dataScene.files,i=0;i<t.length;++i)if(t[i].flag===e)return t[i];return t[0]},_cleanLegacyAbsoluteUrl:function(){var e=this._dataScene.options&&this._dataScene.options.materials;if(e){var t=this.getPolygonURL(),i=t.substr(0,t.lastIndexOf("/")+1);for(var n in e){var r=e[n].channels;for(var a in r){var o=r[a].texture;o&&(o.image&&(o.image=i.concat(o.image)),o.url&&(o.url=i.concat(o.url)))}}}}};const gi=A.Z.extend({initialize:function(){if(A.Z.prototype.initialize.apply(this,arguments),!this.options.model)throw new Error("no model provided to ViewerWebGL");(0,v.Z)().preferOriginalNormalMap=this.options.model.get("preferOriginalNormalMap"),L.Z.client.configureScope((function(e){e.setTag("frontend","3d")})),this._root=null,this._features=this.options.features,this._widgetAPI=this.options.widgetAPI,this._viewerAPI=this.options.viewerAPI,this._progressManager=new ti(this.trigger.bind(this)),this._widgetAPI&&this._widgetAPI.getTabbedWidget().model.on("change",C.Z.draw),x.Z.instance.setModelUid(this.model.get("uid")),this._featuresInstancied={};var e=this.$(".canvas"),t=e[0];t.oncontextmenu=function(){return!1},this._initOptions(),li.Geometry.enableVAO=(0,v.Z)().useVao,ri.Z&&j.Z.resolveAsyncShaderCompilation();var i=this._viewer=new ui.Viewer(t,{powerPreference:(0,v.Z)().powerPreference,antialias:!1,depth:!1,stencil:!1,alpha:this._requireAlphaContext(),premultipliedAlpha:!0,fullscreen:!1,overrideDevicePixelRatio:(0,v.Z)().pratio,preserveDrawingBuffer:(0,v.Z)().preserveDrawingBuffer,enableFrustumCulling:!1,maxDevicePixelRatio:(0,ai.Z)(),InputSources:{Mouse:{scrollwheel:(0,v.Z)().scrollwheel},Keyboard:{sourceElement:e[0]},WebVR:{pollInterval:-1},GamePad:{enable:!1}}});ae.Z.init(i.getInputManager()),i.getState().getExcludeUniforms().uDrawOpaque=!0,i.getState().getExcludeUniforms().uQVT=!0,i.getState().getExcludeUniforms().uQVS=!0,i.getState().getExcludeUniforms().uQW=!0,i.getViewerStats()&&i.getViewerStats().addConfig(this._createOptionStats());var n=li.TimerGPU.instance();(0,v.Z)().webglTimerGpu&&(n.setFrameAverageCount(20),n.enable()),Jt.Z.setTimerGPU(n);var r=f();this._contextLostCount=r?0:(0,v.Z)().webglRestore,this._restoreContextBinded=this.restoreContext.bind(this),i.setContextRestoreCallback(this.requestRestoreContext.bind(this)),i.setContextLostCallback(function(){return li.warn("Context Lost"),(0,si.I)(!1),this._contextLostCount++,(0,oi.Z)("Embed Lost WebGL Context"),!0}.bind(this)),qt.register(i.getState().getShaderGeneratorProxy());for(var a=(0,Le.Z)(),o=i.getState(),s=0;s<a;s++)o.setGlobalDefaultTextureAttribute(s,li.Texture.textureNull);i.requestContinuousUpdate((0,v.Z)().continuousRender),e[0].setAttribute("tabindex","0"),i.init();var l=this.getCamera();l.getRenderer().setCullVisitor(new _.Z),i.setupManipulator(),this._rootScene=new li.MatrixTransform,this._rootScene.setName("Root scene"),l.setClearColor(li.vec4.fromValues(.25,.3,.3,1)),i.setSceneData(this._rootScene),C.Z.setViewer(i),this._superSample=new I(this),C.Z.setSuperSample(this._superSample),this._superSample.setRoot(this._rootScene),i.getManipulator().computeHomePosition(),(0,v.Z)().forceMs?i._requestAnimationFrame=function(e){window.setTimeout(e,(0,v.Z)().forceMs)}:i._requestAnimationFrame=p.Z.get(),this._setShaderAsyncCompilation(),i.run(),this._currentScene=void 0,L.Z.client.configureScope((function(e){e.setTag("frontend","web")}))},_initOptions:function(){var e=this.options.model;void 0===e.get("options").version&&(e.get("options").version=c.Z.optionsVersion),li.time("processModelJSON"),G(e),li.timeEnd("processModelJSON"),(0,v.Z)().processOptions&&e.set("options",{version:c.Z.optionsVersion,sound:{},orientation:{},ground:{},wireframe:{},scene:{},hotspot:{},materials:{},environment:{},vr:{},camera:{},lighting:{},background:{},shading:{},animation:{}})},updateProgress:function(e,t,i){this._progressManager.updateProgress(e,t,i),this.trigger("modelLoadProgress",e)},setFakeSecondaryProgress:function(e,t){this._progressManager.setFakeProgress(e,!0,t)},setFakePrimaryProgress:function(e,t){this._progressManager.setFakeProgress(e,!1,t)},setFakeProgress:function(e,t,i){this._progressManager.setFakeProgress(e,t,i)},requestRestoreContext:function(){this._contextLostCount<3?this.restoreContext():new(0,i("cgbd").Z)({title:"3D/WebGL context error",text:"Your browser seems to have hit its 3D capability limit. The page needs to be reloaded to fix this. <br/>If the problems persists, you can try to close other tabs with 3D/WebGL or restart your browser entirely.",safe:!0,buttons:{continue:!0,continueLabel:"Reload Current Page",continueClass:"button-error-popup-continue",cancel:!1}}).open().then(function(){window.location.reload()}.bind(this))},restoreContext:function(){if((0,ii.BG)())document.addEventListener((0,ii.X2)(),this._restoreContextBinded);else if(this._featuresManager){var e=this._featuresManager._features;if(e){if(e.postProcess){var t=e.postProcess.getModel();t.set("enable",!1),t.set("enable",!0)}e.quality&&e.material&&(e.quality.getModel().trigger("updateTexelPolicy"),Te.Z.resetCaches(),Te.Z.packAllMaterialsTextures(e.material.getModel().getMaterials())),C.Z.draw(),document.removeEventListener((0,ii.X2)(),this._restoreContextBinded)}}},getModelUID:function(){return this.model.get("uid")},_requireAlphaContext:function(){if((0,d.Z)()||(0,v.Z)().transparent||(0,v.Z)().arkit)return!0;var e=this.options.model.get("options");return"none"===(e&&e.background&&e.background.enable)},_getLower:function(e,t){for(var i=[],n=0,r=e.length;n<r;++n)i.push(e[n]),t[i[n]]={caption:e[n],average:!0};return i},_createOptionStats:function(){var e=["Total GL","Shading","PostProcess","ShadowMap"],t={};return{values:t,groups:[{name:e[0],caption:"GL Total (ms)",values:this._getLower(e,t)},{name:e[1],caption:"GL Shading (ms)",values:this._getLower(["EarlyOpaque","EarlyTransparency","ShadingOpaque","ShadingTransparency","ShadingRefraction","Extra"],t)},{name:e[2],caption:"GL PostProcess (ms)",values:[]},{name:e[3],caption:"GL ShadowMap (ms)",values:this._getLower(["ShadowMap0","ShadowMap1","ShadowMap2","ShadowMap3"],t)}]}},setOptionStatsPostProcess:function(e){var t={},i=[{name:"PostProcess",caption:"GL PostProcess (ms)",values:this._getLower(e,t)}],n=this._viewer.getViewerStats();n.addConfig({values:t,groups:i}),n.update()},getRootUserData:function(){return this._currentScene&&this.getRootModel().userDataMap||{}},getRootScene:function(){return this._rootScene},getRootModel:function(){return this._currentScene.getRootModel()},getWidth:function(){return this._viewer.getCanvasWidth()},getHeight:function(){return this._viewer.getCanvasHeight()},getOptions:function(){return this.options},isViewerReady:function(){return j.Z.getModelDisplayed()},getViewerAPI:function(){return this._viewerAPI},createContext:function(e){return new T.Z({model:e.model,viewer:this,scene:e.scene,widgetAPI:this._widgetAPI})},loadWireframeLegacy:function(e,t){var i=e.loadWireframeLegacy(t),n=li.Timer.instance().tick();return i.then((function(){j.Z.resolveWireframe({time:li.Timer.instance().tick()-n})})),i},_dataSizePromisesResolve:function(e){j.Z.resolveDataSizeOSGJS(e.getOsgjsSize()),j.Z.resolveDataSizePolygon(e.getPolygonSize()),j.Z.getHasSound().then(function(e){var t=0;e&&this.getFeatures().sound.getModel("soundtracks").get("soundtracks").each((function(e){var i=e.get("size");i&&(t+=i)}));j.Z.resolveDataSizeSound(t)}.bind(this))},hasIntegratedWireframe:function(){var e=this._currentScene;return!e._modelFile.wireframeUrl||!e._modelFile.wireframeSize},run:function(){var e=(0,v.Z)(),t=this.options.model,n=this,r=this.getOrCreateScene(t.toJSON()),o=t.get("options"),s=r.getJSON().animationCount>0||(0,d.Z)()&&o.animation&&o.animation.order&&t.get("options").animation.order.length>0;j.Z.resolveHasAnimation(s),this._dataSizePromisesResolve(r);var l=this.createContext({model:t,scene:r}),u=r._resourcePromises,h=e.preload,c=r._modelFile,A=(0,v.Z)().wireframePreload||!(0,ri.Z)()&&(e.uiInspector||!0===o.wireframe.enable)&&void 0!==c.wireframeSize&&c.wireframeSize>0,g=A&&!0===h,f=A&&this.hasIntegratedWireframe();j.Z.resolveDataSizeWireframe(A?c.wireframeSize:0);var p=A&&!g,m=p&&!f,_=p?j.Z.getHighResLoaded():a().resolve(),b=r.loadPolygon(this.updateProgress.bind(this),f,_,g);u.push(b);var S,E=li.Timer.instance().tick();b.then((function(){j.Z.resolvePolygon({time:li.Timer.instance().tick()-E})})),!f&&g&&u.push(this.loadWireframeLegacy(r,this.updateProgress.bind(this))),e.cleanShader&&u.push(i.e(4741).then(i.t.bind(i,"8Qi+",23)).then((function(e){window.glslesPreprocessor=e}))),li.time("createAndInitFeatures"),n._features.forEach((function(e){n.addFeature(e,l)})),li.timeEnd("createAndInitFeatures"),this._progressManager.initPrimaryProgress(r.getOsgjsSize(),r.getPolygonSize(),g?r.getWireframeSize():0),(0,ii.BG)()&&(S=setInterval((function(){C.Z.draw()}),200),j.Z.getInitialTextureBoundPromise().then((function(){clearInterval(S)}))),a().all(u).then(this._launchViewer.bind(this,l,m,E)),this._featuresInstancied=l.getFeatures();var y=this._featuresInstancied.material.getModel().getMaterials();return Te.Z.setMaterials(y),j.Z.getModelDisplayed()},_disableShaderAsyncCompilation:function(){h.Z.instance().getWebGLExtensions().KHR_parallel_shader_compile=void 0},_setShaderAsyncCompilation:function(){(0,v.Z)().asyncShader?j.Z.getMaterial().then(function(){var e=this._viewer.getCamera();e.setFinalDrawCallback(function(){0!==Vt&&this._viewer.requestRedraw(),e.setFinalDrawCallback(void 0),j.Z.resolveAsyncShaderCompilation()}.bind(this))}.bind(this)):this._disableShaderAsyncCompilation()},_launchViewer:function(e,t,i){li.time("featureFinished"),this.featureFinished(e,this._rootScene),li.timeEnd("featureFinished"),t&&j.Z.getHighResLoaded().then(this.loadWireframeLegacy.bind(this,this._currentScene,void 0)),li.time("wait async"),(j.Z.getAsyncShaderCompilation().isFulfilled()?j.Z.getInitialTextureBoundPromise():a().all([j.Z.getAsyncShaderCompilation(),j.Z.getInitialTextureBoundPromise()])).then(function(){this.trigger("primary-progress",{progress:1}),li.timeEnd("wait async"),n.Z.logBound(Re.Z.getModelBoxWithoutDisplacement()),n.Z.showMessage(),this._onViewerLaunched(i),j.Z.getModelDisplayed().then(function(){((0,d.Z)()||(0,v.Z)().apiVersion)&&this._disableShaderAsyncCompilation()}.bind(this))}.bind(this))},_startAnimation:function(){this._featuresInstancied.animation.getModel().trigger("afterFirstVisibleFrame")},_afterTabVisible:function(){var e,t=(0,ii.X2)();e=function(){this._featuresManager.setInitialAnimation(),this._startAnimation(),document.removeEventListener(t,e)}.bind(this),document.addEventListener(t,e)},_hasFocusTab:function(){var e=(0,ii.X2)();return!(0,ii.BG)()||!e},_onViewerLaunched:function(e){var t=this._hasFocusTab();(t&&this._featuresManager.setInitialAnimation(),this.drawFrame(),t?this._startAnimation():this._afterTabVisible(),j.Z.resolveModelDisplayed({time:li.Timer.instance().tick()-e}),this.trigger("success"),this.trigger("viewerready"),(0,v.Z)().messaging)&&hi.createMessage({data:"ready"}).appendToHash()},onFail:function(e,t){li.error(t.stack),e.reject(t),this.trigger("failure")},addFeature:function(e,t){if(!e)return console.warn("Feature undefined!"),!0;var i=new e;if(i.init(t),(0,d.Z)()){var n=i.getModel(),r=i.getName();n.editorSetJSON&&!window.editorModels[r]&&(window.editorModels[r]={setJSON:this._makeCallbackSetJSON(n),getJSON:this._makeCallbackGetJSON(n)})}},_makeCallbackSetJSON:function(e){return function(t){var i=e.editorSetJSON(Ai(t));return i&&i.then?i:i?a().reject(i):a().resolve()}},_makeCallbackGetJSON:function(e){return function(){var t=e.editorGetJSON();return a().resolve(Ai(t))}},drawFrame:function(){this._viewer.requestRedraw(),this._viewer.frame()},getCanvas:function(){return this._viewer.getGraphicContext().canvas},getInputManager:function(){return this._viewer.getInputManager()},setTimeline:function(e){this._timeline=e},getTimeline:function(){return this._timeline},getScreenShot:function(e,t,i){return(0,m.Z)(e,t,this,i)},getCamera:function(){return this._viewer.getCamera()},getFeatures:function(){return this._featuresInstancied},getSuperSample:function(){return this._superSample},getFeaturesManager:function(){return this._featuresManager},getViewerOSGJS:function(){return this._viewer},getOrCreateScene:function(e){if(this._currentScene)return this._currentScene;var t=new di(e);return t.getResourceManager().setStateContextOSG(this._viewer.getState()),this._currentScene=t,t},featureFinished:function(e,t){return this._featuresManager=new Oe(this,e),this._featuresManager.finished(t)},getOptionsJSON:function(){var e=this.getFeatures(),t={};t.version=c.Z.optionsVersion,t.background=e.background.getModel().getJSON(),t.environment=e.environment.getModel().getJSON(),t.lighting=e.lighting.getModel().getJSON(),t.materials=e.material.getModel().getJSON(),t.orientation=e.orientation.getModel().getJSON(),t.camera=e.camera.getModel().getJSON(),t.animation=e.animation.getModel().getJSON(),t.hotspot=e.hotspot.getModel().getJSON(),t.vr=e.webVR.getModel().getJSON(),t.scene=t.scene||{},t.scene.postProcess=e.postProcess.getModel().getJSON(),t.scene.sssProfiles=e.postProcess.getModel().getProfilesJSON(),t.sound=e.sound.getModel().getJSON(),t.ground=e.ground.getModel().getJSON();var i=e.shadingStyle.getModel().getJSON();return t.shading=i.shading,t.wireframe=i.wireframe,G.readOptions(t)}})},Xhvc:(e,t,i)=>{"use strict";i.d(t,{Z:()=>_});var n=i("uuWb"),r=i("O/gg"),a=i("+eNq"),o=i("5Cxy"),s=n.Z.osg,l=n.Z.osgUtil,u=n.Z.osgAnimation,h=a.Z.SHADOW|a.Z.PICK_GEOMETRY_ANIMATED;u.MorphGeometry.MAX_MORPH_GPU=Math.min(4,(0,o.Z)().morphGpu);var c=l.IntersectionVisitor.prototype.enter;l.IntersectionVisitor.prototype.enter=function(e){return!!e._forceEnterIntersection||c.call(this,e)};var A=function(){};s.createPrototypeObject(A,{cull:function(){return!1}},"osgSketchfab","HideCullCallback");var d=new A,g=s.vec3.create(),f=s.vec3.create(),p=function(e,t){s.NodeVisitor.call(this),this._wirePromise=r.Z.getWireframeOptimized(),this._wireNodes=t.getOrCreateScene().getWireframeNodes(),this.nodeMaskOverride=-1,this._visitedNodes={},this._rigIndexed=[],this._boneGeomIndexed=[],this._skls=e;var i=t.getFeatures().material.getModel(),n=s.WebGLCaps.instance();this._maxVA=n.getWebGLParameter("MAX_VERTEX_ATTRIBS");var a=0;a+=1,a+=1,a+=1,a+=3,a+=3,a+=4,a+=4,a+=4,a+=4,a+=1,a+=1,a+=1,a+=1,a+=1,a+=1,a+=1,a+=1,a+=1,a+=1,a+=1*i.getMaxUvCount(),a=Math.ceil(a);var l=n.getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS");l=Math.min(l,(0,o.Z)().maxVertexUniforms),this._maxBones=Math.floor((l-a)/3),u.SkinningAttribute.maxBoneUniformAllowed=3*this._maxBones,this._minUniformsRequired=a+39};s.createPrototypeObject(p,s.objectInherit(s.NodeVisitor.prototype,{createSplitRigGeometry:function(e){var t=new u.RigGeometry;t.setName("Split ("+e.getInstanceID()+")"),t.setStateSet(e.getStateSet()),t.setUserData(e.getUserData()),t.userDataMap=e.userDataMap,t.setSourceGeometry(e.getSourceGeometry()),t._forceEnterIntersection=!0,t.setNodeMask(e.getNodeMask());var i=e.getVertexAttributeList(),n=t.getVertexAttributeList();for(var r in i)n[r]=i[r];var a=i.Bones.getElements(),o=new a.constructor(a.length);n.Bones=new s.BufferArray(s.BufferArray.ARRAY_BUFFER,o,i.Bones.getItemSize(),!0),t.userDataMap.wireframe&&this._wireNodes.push(t);var l=t.userDataMap.rigIndex;return void 0!==l&&(this._rigIndexed[l]=t),t._boundingSphereComputed=!0,t._boundingBoxComputed=!0,t},checkVertex:function(e,t){var i=t.baseBones,n=t.baseWeights,r=t.mappedUsedBones,a=0;return n[e]&&!r[i[e]]&&a++,n[e+1]&&!r[i[e+1]]&&a++,n[e+2]&&!r[i[e+2]]&&a++,n[e+3]&&!r[i[e+3]]&&a++,a},tagBoneVertex:function(e,t){var i=t.baseBones,n=t.baseWeights,r=t.mappedUsedBones,a=t.boneNameID,o=t.boneToName,s=i[e];n[e]&&!r[s]&&(a[o[s]]=t.nbUsedBones,r[s]=++t.nbUsedBones),t.newBones[e]=r[s]-1,s=i[e+1],n[e+1]&&!r[s]&&(a[o[s]]=t.nbUsedBones,r[s]=++t.nbUsedBones),t.newBones[e+1]=r[s]-1,s=i[e+2],n[e+2]&&!r[s]&&(a[o[s]]=t.nbUsedBones,r[s]=++t.nbUsedBones),t.newBones[e+2]=r[s]-1,s=i[e+3],n[e+3]&&!r[s]&&(a[o[s]]=t.nbUsedBones,r[s]=++t.nbUsedBones),t.newBones[e+3]=r[s]-1},splitTriangle:function(e,t,i,n){if(n.currentIdPrimitive++,e===t||e===i||t===i||n.processedPrimitive[n.currentIdPrimitive-1])return!0;var r=n.nbUsedBones,a=this.checkVertex(4*e,n);if(r+a<this._maxBones&&(a+=this.checkVertex(4*t,n)),r+a<this._maxBones&&(a+=this.checkVertex(4*i,n)),r+a>=this._maxBones)n.finished=!1;else{this.tagBoneVertex(4*e,n),this.tagBoneVertex(4*t,n),this.tagBoneVertex(4*i,n);var o=n.first+n.countIdPrimitive;n.countIdPrimitive+=3,n.newIndexesElements[o]=e,n.newIndexesElements[o+1]=t,n.newIndexesElements[o+2]=i,n.processedPrimitive[n.currentIdPrimitive-1]=1}},splitLine:function(e,t,i){if(i.currentIdPrimitive++,e===t||i.processedPrimitive[i.currentIdPrimitive-1])return!0;var n=i.nbUsedBones,r=this.checkVertex(4*e,i);if(n+r<this._maxBones&&(r+=this.checkVertex(4*t,i)),n+r>=this._maxBones)i.finished=!1;else{this.tagBoneVertex(4*e,i),this.tagBoneVertex(4*t,i);var a=i.first+i.countIdPrimitive;i.countIdPrimitive+=2,i.newIndexesElements[a]=e,i.newIndexesElements[a+1]=t,i.processedPrimitive[i.currentIdPrimitive-1]=1}},callbackDrawElementsTriangles:function(e,t,i){for(var n=0;n<e;n+=3)this.splitTriangle(t[n],t[n+1],t[n+2],i)},callbackDrawElementsTriangleStrip:function(e,t,i){for(var n=2,r=0;n<e;++n,++r)n%2?this.splitTriangle(t[r],t[r+2],t[r+1],i):this.splitTriangle(t[r],t[r+1],t[r+2],i)},callbackDrawElementsLines:function(e,t,i){for(var n=0;n<e;n+=2)this.splitLine(t[n],t[n+1],i)},splitPrimitive:function(e,t){e.finished=!0;var i=e.baseRig,n=e.primitive,r=this.createSplitRigGeometry(i);e.boneNameID=r._boneNameID,e.newBones=r.getVertexAttributeList().Bones.getElements(),e.mappedUsedBones=new Uint32Array(t),e.nbUsedBones=0,e.currentIdPrimitive=0,e.countIdPrimitive=0;var a=n.getIndices().getElements(),o=n.getCount(),l=n.getMode();if(l===s.primitiveSet.TRIANGLE_STRIP?this.callbackDrawElementsTriangleStrip(o,a,e):l===s.primitiveSet.TRIANGLES?this.callbackDrawElementsTriangles(o,a,e):this.callbackDrawElementsLines(o,a,e),0===e.countIdPrimitive){var u="Only "+this._maxBones+" bones supported per draw call (min is 13)";return u+="\nMinium uniforms count should be "+this._minUniformsRequired,console.warn(u),!1}var h=new s.DrawElements(l===s.primitiveSet.LINES?s.primitiveSet.LINES:s.primitiveSet.TRIANGLES,e.newIndexesBuffer);h.setFirst(e.first*e.newIndexesElements.BYTES_PER_ELEMENT),h.setCount(e.countIdPrimitive),e.first+=e.countIdPrimitive,r.getPrimitives().push(h);for(var c=i.getParents(),A=c.length,d=0;d<A;++d)c[d].addChild(r);return!e.finished},getBoneToNames:function(e,t){for(var i=t.length,n=new Array(i),r=0;r<i;++r){var a=t[r];n[e[a]]=a}return n},splitRigGeometry:function(e){for(var t=e._boneNameID,i=Object.keys(t),n=i.length,r=e.getPrimitives(),a=r.length,o={baseRig:e,baseWeights:e.getVertexAttributeList().Weights.getElements(),baseBones:e.getVertexAttributeList().Bones.getElements(),boneToName:this.getBoneToNames(e._boneNameID,i)},l=0;l<a;++l){var u=r[l],h=u.getMode();if(0!==u.getCount())if(u instanceof s.DrawElements!=!1)if(h===s.primitiveSet.TRIANGLE_STRIP||h===s.primitiveSet.TRIANGLES||h===s.primitiveSet.LINES){var c=u.getIndices(),A=c.getElements(),d=h===s.primitiveSet.TRIANGLE_STRIP?3:1;for(o.newIndexesElements=new A.constructor(u.getCount()*d),o.newIndexesBuffer=new s.BufferArray(s.BufferArray.ELEMENT_ARRAY_BUFFER,o.newIndexesElements,c.getItemSize(),!0),o.first=u.getFirst(),o.processedPrimitive=new Uint8Array(u.getCount()),o.primitive=u;this.splitPrimitive(o,n););o.newIndexesBuffer.setElements(o.newIndexesElements.subarray(0,o.first))}else s.error("Split rigged primitives mode not yet handled : ",h);else s.error("Split rigged primitives type not yet handled",u)}},handleRigGeometry:function(e){var t=e._boneNameID,i=e.userDataMap.wireframe,n=e.userDataMap.rigIndex;void 0!==n&&(this._rigIndexed[n]=e),this._maxBones<Object.keys(t).length&&(i?(e._boundingBoxComputed=!0,e._boundingSphereComputed=!0,this._wirePromise.then(this.splitRigGeometry.bind(this,e))):this.splitRigGeometry(e),e.setCullCallback(d)),this.tagForceIntersection()},tagForceIntersection:function(){for(var e=this._skls[this._skls.length-1],t=1+this.nodePath.indexOf(e);t<this.nodePath.length;++t)this.nodePath[t]._forceEnterIntersection=!0},popTargetAttribute:function(e,t,i){for(var n=t.getMorphTargets(),r=n.length,a=e.getVertexAttributeList(),o=t.getVertexAttributeList(),s=0;s<r;++s){delete n[s].getVertexAttributeList()[i];var l=i+"_"+s;delete a[l],a!==o&&delete o[l]}},computeUsedVA:function(e,t,i,n){var r=Object.keys(e).length-Object.keys(t).length*(i.length-Math.min(n,i.length));return e.Color||r++,r},handleMorphGeometry:function(e,t){var i=t.getMaximumPossibleMorphGPU(),n=t.getMorphTargets(),r=n[0].getVertexAttributeList(),a=e.getVertexAttributeList(),o=this.computeUsedVA(a,r,n,i),s=this._maxVA;if(!(o<=s||a.Tangent_1&&(this.popTargetAttribute(e,t,"Tangent"),(o=this.computeUsedVA(a,r,n,i))<=s)||a.Normal_1&&(this.popTargetAttribute(e,t,"Normal"),(o=this.computeUsedVA(a,r,n,i))<=s))){for(;i>0;)if(i--,t.setMaximumPossibleMorphGPU(i),(o=this.computeUsedVA(a,r,n,i))<=s)return;console.warn("Too much vertex attributes!")}},apply:function(e){var t=e.getInstanceID();if(!this._visitedNodes[t]){this._visitedNodes[t]=!0;var i,n,r,o=e instanceof u.RigGeometry,l=o?e.getSourceGeometry():e,c=l instanceof u.MorphGeometry;if(o&&e.separateStaticBoxInGeometry(d,a.Z.PICK_GEOMETRY_RIG_BOX|a.Z.SHADOW_BOUNDS),!c&&!o||e.userDataMap.wireframe||e.setNodeMask(h),c&&this.handleMorphGeometry(e,l),o)this.handleRigGeometry(e);else if(e instanceof u.Bone){var A=e.getBoneBoundingBox();if(A.valid()){A.center(g),s.vec3.sub(f,A.getMax(),A.getMin());var p=(i=g,n=f,(r=s.createTexturedBoxGeometry(i[0],i[1],i[2],n[0],n[1],n[2])).setName("BoneBox"),r.getOrCreateStateSet().setShaderGeneratorName("debugBoneBox"),r.setCullCallback(d),r._isBoneBox=!0,r.setNodeMask(a.Z.PICK_GEOMETRY_RIG_BOX|a.Z.SHADOW_BOUNDS),r);e.addChild(p),e.userDataMap.apexes=function(e,t){return[[e[0]+.5*t[0],e[1],e[2]],[e[0]-.5*t[0],e[1],e[2]],[e[0],e[1]+.5*t[1],e[2]],[e[0],e[1]-.5*t[1],e[2]],[e[0],e[1],e[2]+.5*t[2]],[e[0],e[1],e[2]-.5*t[2]]]}(g,f),void 0!==e.userDataMap.rigIndex&&this._boneGeomIndexed.push(p)}}else e instanceof u.Skeleton&&this._skls.push(e);this.traverse(e)}}}),"osgSketchfab","InitVisitor");var m={};m.hideCullCallback=d,m.init=function(e,t){var i=new p(e,t),n=t.getRootModel();s.time("InitGraphAnimation"),n.accept(i),s.timeEnd("InitGraphAnimation");for(var r=i._boneGeomIndexed,a=i._rigIndexed,o=r.length,l=0;l<o;++l){var u=r[l];u._mostInfluencedRig=a[u.getParents()[0].userDataMap.rigIndex]}};const _=m},IcDE:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("uuWb"),r=n.Z.osg,a=n.Z.osgAnimation;const o=function(e){for(var t=0,i=e.length;t<i;++t){var n,o=e[t];if(o instanceof a.Bone)n=a.UpdateBone;else{if(!(o instanceof r.MatrixTransform))continue;n=a.UpdateMatrixTransform}for(var s=o.getUpdateCallbackList(),l=0,u=s.length;l<u;++l)if(s[l]instanceof n)return!0}return!1}},h3Gt:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("uuWb"),r=i("vRpy"),a=i("0z3s"),o=n.Z.osg,s=[o.primitiveSet.TRIANGLES,o.primitiveSet.TRIANGLE_STRIP,o.primitiveSet.TRIANGLE_FAN],l=[o.primitiveSet.LINES,o.primitiveSet.LINE_LOOP,o.primitiveSet.LINE_STRIP],u=function(e,t){var i=t.getItemSize(),n=t.getElements(),r=1;1===n.BYTES_PER_ELEMENT?r=255:2===n.BYTES_PER_ELEMENT&&(r=65535);var o=!1,s=n.length,l=0;if(4===i){var u=!0,h=!0;for(l=3;l<s;l+=4){var c=n[l];if(0!==c&&(u=!1),c!==r&&(h=!1),!u&&!h)break}if(u&&4===i)for(l=3;l<s;l+=4)n[l]=r;o=!u&&!h}var A=!0;if(!o){var d=!0;for(l=0;l<s&&(n[l]!==r&&(d=!1),n[l+1]!==r&&(d=!1),n[l+2]!==r&&(d=!1),d);l+=i);d&&delete e.getVertexAttributeList().Color,A=!d}o&&(a.Z.hasVertexAlpha=e.userDataMap.hasVertexAlpha=!0),A&&(a.Z.hasVertexColor=!0)},h=function(e){for(var t=e.getPrimitiveSetList(),i=t.length,n=!1,a=!1,u=!1,h=void 0!==e.getVertexAttributeList().Normal,c=0;c<i;++c){var A=t[c].getMode();0!==t[c].getCount()&&(n||(n=A===o.primitiveSet.POINTS),u||(u=-1!==s.indexOf(A)),a||(a=-1!==l.indexOf(A)))}r.Z.hasPoints||(r.Z.hasPoints=n),r.Z.hasTriangles||(r.Z.hasTriangles=u),r.Z.hasLines||(r.Z.hasLines=a),r.Z.hasVertexNormals||(r.Z.hasVertexNormals=h),e.userDataMap.hasPoints=n,e.userDataMap.hasTriangles=u,e.userDataMap.hasLines=a};const c=function(){for(var e in r.Z.instanceIDGeometryMap){var t=r.Z.instanceIDGeometryMap[e];if(!t.userDataMap.wireframe){var i=t.getVertexAttributeList().Color;i&&u(t,i),h(t)}}r.Z.instanceIDGeometryMap={}}},SkFG:(e,t,i)=>{"use strict";i.d(t,{Z:()=>dg});var n=i("JAIH"),r=i("VwWu"),a=i("k2rr"),o=i("ELsZ"),s=i("WIA/"),l=i("5Cxy");const u=a.Z.extend({getModelOptionPath:function(){return"animation"},defaults:function(){var e=this.getResourceManager().getAnimationCollection(),t=[];return(0,o.Z)()||(t=e.remove(e.where({isEnabled:!1}))),{animations:e,disabledAnimations:t,currentUID:"-1",playing:!0,fps:-1,progress:0}},getName:function(){return"Animation"},getResourceManager:function(){return this._resourceManager||s.Z.instance},getAnimationByUID:function(e){return this.get("animations").find((function(t){return t.get("uid")===e}))},getCurrentAnimation:function(){return this.getAnimationByUID(this.get("currentUID"))},canActivateTAA:function(){return!this.isPlaying()||(0,l.Z)().taaAnimation},isPlaying:function(){return!!this.get("animations").length&&(!!this.get("playing")&&"-1"!==this.get("currentUID"))},getEnabledAnimationsCount:function(){return this.get("animations").where({isEnabled:!0}).length},getFirstEnabledAnimation:function(){for(var e=this.get("animations"),t=e.length,i=0;i<t;++i){var n=e.at(i);if(n&&n.get("isEnabled"))return n}},init:function(e){this._viewer=e.getViewer();var t=e.getModel().get("options").animation;t&&t.order&&(this.setJSON(t),this.set("playing",(0,l.Z)().animationAutoplay))},setJSON:function(e,t){var i=t||{};i.ignore=["order"],a.Z.prototype.setJSON.call(this,e,i);var n=this.get("animations"),o=(0,r.Z)(e.order);n.forEach((function(e){e.set("order",parseInt(o[e.get("uid")],10))})),n.sort()},getJSON:function(){for(var e=a.Z.prototype.getJSON.call(this),t=this.get("animations").pluck("uid"),i=this.get("disabledAnimations"),n=0;n<i.length;++n)t.push(i[n].get("uid"));return e.order=t,e}});var h=i("lZH+"),c=i.n(h),A=i("uuWb"),d=i("vRpy");const g=function(e,t,i){for(var n=e.length/i,r=0;r<n;++r)for(var a=r*i,o=0;o<i;++o)t[a+o]=e[r+n*o];return t};const f=function(e,t){for(var i=t||1,n=1,r=e.length/i;n<r;++n)for(var a=(n-1)*i,o=n*i,s=0;s<i;++s)e[o+s]+=e[a+s];return e};const p=function(e){for(var t=1,i=e.length/4;t<i;++t){var n=4*(t-1),r=4*t,a=e[n],o=e[n+1],s=e[n+2],l=e[n+3],u=e[r],h=e[r+1],c=e[r+2],A=e[r+3];e[r]=a*A+o*c-s*h+l*u,e[r+1]=-a*c+o*A+s*u+l*h,e[r+2]=a*h-o*u+s*A+l*c,e[r+3]=-a*u-o*h-s*c+l*A}return e};var m=i("PzyL"),_=i("pYHo"),v=i("Ixh+"),C=A.Z.osg,b=A.Z.osgDB,S=A.Z.osgAnimation,E=A.Z.osgWrappers.osgAnimation,y=S.Channel,I=function(){},x=b.registry();x.registerObject("osgAnimation.Vec3LerpChannelCompressedPacked",I),x.registerObject("osgAnimation.Vec3LerpChannelCompressed",I),x.registerObject("osgAnimation.Vec3LerpChannelPacked",I),x.registerObject("osgAnimation.QuatSlerpChannelCompressedPacked",I),x.registerObject("osgAnimation.QuatSlerpChannelCompressed",I),x.registerObject("osgAnimation.QuatSlerpChannelPacked",I),x.registerObject("osgAnimation.FloatLerpChannelCompressedPacked",I),x.registerObject("osgAnimation.FloatLerpChannelCompressed",I),x.registerObject("osgAnimation.FloatLerpChannelPacked",I);var T={},w=(new s.Z)._resourceLoader,M=1,R=4,B=8,N=16,D=function(e,t,i,n,r,a){var o,s=t.ItemSize,l=Object.keys(t.Array)[0],u=t.Array[l],h=u.Offset?u.Offset:0,c=u.Size,A=i.channel_mode||0,d=!!(1===a?A&N:A&R),b=new ArrayBuffer(4*(d?c+2:c+1)*a),S=new Float32Array(b,d?4*a:0,c*a);return o=u.Encoding&&"varint"===u.Encoding?(0,m.Z)(new Uint8Array(e,h),s*c,l):new C[l](e,h,s*c),4===a&&A&B?(r&&(o=g(o,new Float32Array(o.length),s)),(0,v.Z)(o,S,a,i.epsilon,i.nphi,!0),d&&((S=new Float32Array(b,0,(c+1)*a))[0]=i.ox,S[1]=i.oy,S[2]=i.oz,S[3]=i.ow,p(S)),S):(r&&1!==a?g(o,S,s):S.set(o),n?(3===a&&A&M&&(0,_.Z)(S,S,[i.bx,i.by,i.bz],[i.hx,i.hy,i.hz],a),d&&(S=new Float32Array(b,0,(c+1)*a),3===a?(S[0]=i.ox,S[1]=i.oy,S[2]=i.oz):S[0]=i.ot,f(S,s)),S):S)},P=function(e,t,i,n,r,a){var o=e.getJSON();if(!(void 0!==o.TargetName&&o.KeyFrames&&o.Name&&o.KeyFrames.Time&&o.KeyFrames.Key))return c().reject(new Error);var s=o.UserDataContainer,l=s?d.Z.convertUserDataToObject(e.setJSON(s).readUserDataContainer()):T;return w.getBinaryArray(e.getOptions().currentAnimationUID).getPromise().then((function(e){var s=D(e,o.KeyFrames.Time,l,n,!1,1),u=D(e,o.KeyFrames.Key,l,n,r,a);return i(u,s,o.TargetName,o.Name,t),t}))};E.Vec3LerpChannel=function(e,t){return P(e,t,y.createVec3Channel,!1,!1,3)},E.Vec3LerpChannelCompressedPacked=function(e,t){return P(e,t,y.createVec3Channel,!0,!0,3)},E.Vec3LerpChannelCompressed=function(e,t){return P(e,t,y.createVec3Channel,!0,!1,3)},E.Vec3LerpChannelPacked=function(e,t){return P(e,t,y.createVec3Channel,!1,!0,3)},E.QuatSlerpChannel=function(e,t){return P(e,t,y.createQuatChannel,!1,!1,4)},E.QuatSlerpChannelCompressedPacked=function(e,t){return P(e,t,y.createQuatChannel,!0,!0,4)},E.QuatSlerpChannelCompressed=function(e,t){return P(e,t,y.createQuatChannel,!0,!1,4)},E.QuatSlerpChannelPacked=function(e,t){return P(e,t,y.createQuatChannel,!1,!0,4)},E.FloatLerpChannel=function(e,t){return P(e,t,y.createFloatChannel,!1,!1,1)},E.FloatLerpChannelCompressedPacked=function(e,t){return P(e,t,y.createFloatChannel,!0,!0,1)},E.FloatLerpChannelCompressed=function(e,t){return P(e,t,y.createFloatChannel,!0,!1,1)},E.FloatLerpChannelPacked=function(e,t){return P(e,t,y.createFloatChannel,!1,!0,1)};var F=i("O/gg"),O=i("yfOW"),L=i("Xhvc"),k=i("iO85"),Z=A.Z.osg,U=A.Z.osgAnimation,V=A.Z.osgWrappers,Q=V.osg;var G={FeatureName:"animation",ModelType:u,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:playing",this.onPlayingChanged,this),e.bind("change:speed",this.onSpeedChanged,this),e.bind("change:currentUID",this.onCurrentAnimationChanged,this),e.bind("afterFirstVisibleFrame",this.onAfterFirstVisibleFrame,this),e.bind("seek",this.onSeek,this),this._manager=null,this._idLoop=0,this._loopEnded=!1,this._skeletons=[],this._viewer=this.options.context.getViewer(),this._firstAnimationPlayed=!1,this._animationPromises=[],this._hookBasicAnimationManager(F.Z.getPolygon()),F.Z.getMaterial().then(this._initAnimation.bind(this)),F.Z.getModelDisplayed().then(this._resolveAllAnimations.bind(this))},onAfterFirstVisibleFrame:function(){this._manager&&(this.model.set("playing",(0,l.Z)().animationAutoplay),this.onCurrentAnimationChanged())},_resolveAllAnimations:function(){0===this._animationPromises.length?(F.Z.resolveFirstAnimation(),F.Z.resolveAllAnimations()):c().all(this._animationPromises).then(F.Z.resolveAllAnimations.bind(F.Z))},_initAnimation:function(){if(this._manager)this.onSpeedChanged(),L.Z.init(this._skeletons,this._viewer),F.Z.getWireframeOptimized().then(F.Z.resolveWireframeOptimizedSplit.bind(F.Z));else{if(d.Z.hasRigsOrMorphs){if(d.Z.hasMorphs){var e=this.model.get("animations");if(!e||!e.length)d.Z.hasMorphs&&console.warn("Morph without UpdateMorphs tracks! No MorphAttributes in stateset")}L.Z.init(this._skeletons,this._viewer)}F.Z.getWireframeOptimized().then(F.Z.resolveWireframeOptimizedSplit.bind(F.Z))}},_getHookUpdateManager:function(){var e=this,t=U.BasicAnimationManager.prototype.updateManager;return function(i){var n=e.getCurrentInstanceAnimation();return!(n&&!e._loopEnded)||(-1===this._seekTime&&this._pause||k.Z.draw(),i=e._detectAnimationEnd(i,n),i=e._snapTimeOnFrame(i,n),t.call(this,i))}},_snapTimeOnFrame:function(e,t){var i=this.model.get("fps");if(i<=0)return e;var n=1/i,r=(e-t.start)%n;return Math.abs(r)>.5*n?e+(n-r):e-r},_detectAnimationEnd:function(e,t){var i,n,r,a=e<0?-1:1;if(1===a){if(i=e-t.start,n=(i=Math.max(0,i))%t.duration*100/t.duration,(r=Math.floor(i/t.duration))<=this._idLoop)return this._idLoop=r,this.model.set("progress",n),e}else if(i=t.start+t.duration+e,i=Math.min(t.start+t.duration-.01,i),n=100-(n=100*Math.abs(i%t.duration)/t.duration),(r=Math.abs(Math.round(Math.abs((i+.02)/t.duration))))<=this._idLoop)return this._idLoop=r,this.model.set("progress",n),e;return t=this.getCurrentInstanceAnimation(),this._viewer.trigger("animationEnded",t.name),this._onAnimationEnd(),this._loopEnded?(e=1===a?t.duration-.01:0,this.model.set("progress",100)):(this._idLoop=r,(t=this.getCurrentInstanceAnimation())&&(this._viewer.trigger("animationBegan",t.name),e=1===a?t.start:t.start+t.duration-.01),this.model.set("progress",0)),e},_onAnimationEnd:function(){var e=this.model.get("cycleMode");if("oneAndStop"===e)return this.model.set("playing",!1),void(this._loopEnded=!0);if("one"!==e){for(var t,i=this.model.get("animations"),n="-1",r=i.indexOf(this.getCurrentAnimation())+1,a=i.length;r<a;++r)if((t=i.at(r))&&t.get("isEnabled")){n=t.get("uid");break}if("-1"===n&&"all"===e){var o=this.model.getFirstEnabledAnimation();n=o?o.get("uid"):"-1"}"-1"!==n?this.model.set("currentUID",n):(this.model.set("playing",!1),this._loopEnded=!0)}else this.model.trigger("cycleMode")},_debugSnapKeyFrameHook:function(){(0,l.Z)().snapKeyframe&&(U.BasicAnimationManager.prototype._updateChannelsType=function(e,t,i){for(var n=0,r=t.length;n<r;n++){var a=t[n],o=a.instanceAnimation,s=o.loop,l=e-a.t;s&&o.duration>0&&(l%=o.duration),l+=o.firstKeyTime;var u=a.channel;if(l>u.start&&l<u.end){var h=u.times,c=a.key;if(l>h[c])for(;h[c+1]<l;)c++;else if(l<h[c])for(;h[c]>l;)c--;var A=h[c],d=h[c+1];l=Math.abs(l-A)<Math.abs(l-d)?A:d}i(l,a)}})},_hookBasicAnimationManager:function(e){var t=this,i=this._animationPromises,n=this._getHookUpdateManager();this._debugSnapKeyFrameHook(),V.osgAnimation.BasicAnimationManager=function(r,a){var o=r.getJSON();return o.Animations?(Q.Object(r,a),F.Z.OSG_VERSION<8?c().resolve(a):t._manager?(Z.error("More than one basicAnimationManager !"),c().resolve(a)):(t._manager=a,t.model.get("playing")||a.togglePause(),a.updateManager=n,e.then((function(){var e=r.getOptions();e.progress=void 0;for(var n=o.Animations.length,a=0;a<n;++a){var s=o.Animations[a],l=r.setJSON(s["osgAnimation.Animation"].UserDataContainer).readUserDataContainer(),u=d.Z.convertUserDataToObject(l),h=t.model.getAnimationByUID(u.AnimationUID);if(h){e.currentAnimationUID=h.get("url");var c=r.setJSON(s).readObject();c.isRejected()?Z.Notify.warn("An Animation failed on the parsing!"):(c.then(t.onAddAnimation.bind(t,a,u)),i.push(c))}}})),c().resolve(a))):c().reject(new Error)}},onAddAnimation:function(e,t,i){var n=t.AnimationUID;i.name=n,i.duration||(i.duration=2.5,i.still=!0),this._manager.addAnimations([i]),0===i.duration&&(this._manager.getAnimations()[n].duration=2.5);var r=this.model;r.trigger("change:animations");var a=r.getAnimationByUID(n);a.on("change:isLoop",this.onAnimationChangeLoop.bind(this)),a.get("isLoop")&&this.onAnimationChangeLoop(a),this.model.get("currentUID")===n&&this.onCurrentAnimationChanged(),this._firstAnimationPlayed||(this._playFirstAnimation(n)&&(this._firstAnimationPlayed=!0,this.model.set("currentUID",n)),F.Z.getModelDisplayed().then(F.Z.resolveFirstAnimation.bind(F.Z)))},_playFirstAnimation:function(e){if(this.model.get("initializeWithRestPose"))return!1;var t=this.model.getFirstEnabledAnimation();return t&&e===t.get("uid")},onAnimationChangeLoop:function(e){var t=this._manager.getAnimations()[e.get("uid")];this._manager.setAnimationLerpEndStart(t,e.get("isLoop")?1/30:0)},onCurrentAnimationChanged:function(){this._loopEnded=!1,this._idLoop=0;var e=this._manager;if(e.stopAllAnimation(),e.resetUpdateCallbacks(),this.getCurrentAnimation()){var t=this.getCurrentInstanceAnimation();t&&(e.playAnimation(t),e.setSeekTime(t.start))}var i=this.getCurrentAnimation();i?(this._viewer.trigger("animationChange",i.get("uid")),(0,o.Z)()&&this.model.set("initializeWithRestPose",!1)):(0,o.Z)()&&this.model.set("initializeWithRestPose",!0),k.Z.draw()},getCurrentAnimation:function(){return this.model.getCurrentAnimation()},getCurrentInstanceAnimation:function(){var e=this.getCurrentAnimation();return e?this._manager.getAnimations()[e.get("uid")]:void 0},onPlayingChanged:function(){if(this._loopEnded){this._loopEnded=!1;var e=this.model.getFirstEnabledAnimation().get("uid")||"-1";e===this.getCurrentAnimation().get("uid")?this.model.trigger("seek",0):this.model.set("currentUID",e)}this._viewer.trigger(this.model.get("playing")?"animationPlay":"animationStop"),this._manager.togglePause(),k.Z.draw()},onSeek:function(e){var t=this.getCurrentInstanceAnimation();if(t){this._loopEnded=!1;var i=Math.min(t.duration-.01,t.duration*e/100);this._manager.setSeekTime(t.start+i/this._manager.getTimeFactor()),k.Z.draw(),k.Z.redrawShadow()}},onSpeedChanged:function(){this._manager.setTimeFactor(this.model.get("speed"))}})]},H=!1;F.Z.getHasAnimation().then((function(e){e&&(H=e)}));var z=n.Z.create(G);z.prototype.prepareForScreenShot=function(){return!!H&&(this._oldPlayingAnimation=this.getModel().get("playing"),this.getModel().set("playing",!1),!0)},z.prototype.resetAfterScreenShot=function(){this._oldPlayingAnimation&&this.getModel().set("playing",!0)};const W=z;var j=i("N96t"),q=i("pUXo"),J=A.Z.osg,Y=Math.PI/2;const K=a.Z.extend({getModelOptionPath:function(){return"camera"},defaults:{webVR:!1,indexManipulator:"fps"===(0,l.Z)().navigation?1:0,node:void 0,minSpeed:.1,displayGizmo:!1,animationEye:J.vec3.create(),animationTarget:J.vec3.create(),animationDuration:1,enableCameraConstraints:!0,offset:0,angle:2*Math.PI},getName:function(){return"Camera"},setTargetAndEye:function(e,t,i){return this.set("animationTarget",e),this.set("animationEye",t),this.trigger("setTargetAndEye",i)},init:function(e){this._viewer=e.getViewer();var t=e.getModel().get("options").camera;this.set("enableCameraConstraints",(0,l.Z)().cameraConstraints);var i=this._getUrlOptions(),n=(0,q.Z)(t,i);this.setJSON(n),this.yawLeftRightToAngleOffset(),this.on("change:zoomIn",this.checkOverLap.bind(this,"zoomOut","zoomIn","zoomOut")),this.on("change:zoomOut",this.checkOverLap.bind(this,"zoomOut","zoomIn","zoomIn")),this.on("change:up",this.checkOverLap.bind(this,"up","down","down")),this.on("change:down",this.checkOverLap.bind(this,"up","down","up")),this.on("change:offset",this.yawAngleOffsetToLeftRight.bind(this)),this.on("change:angle",this.yawAngleOffsetToLeftRight.bind(this))},shouldPlayFirstCameraAnimation:function(){return!0===(0,l.Z)().camera&&!this.get("useCameraConstraints")},initAfterFirstFrame:function(){var e=Math.floor(j.Z.getModelBoxWithoutDisplacement().radius()*(180-this.get("fov")));-1===this.get("zoomOut")&&this.set("zoomOut",e),-1===this.get("zoomIn")&&this.set("zoomIn",e),this.set("maxZoom",e),this.trigger("uiReady")},_getUrlOptions:function(){var e={usePanConstraints:(0,l.Z)().orbitConstraintPan,zoomIn:(0,l.Z)().orbitConstraintZoomIn,zoomOut:(0,l.Z)().orbitConstraintZoomOut,left:(0,l.Z)().orbitConstraintYawLeft,right:(0,l.Z)().orbitConstraintYawRight,up:(0,l.Z)().orbitConstraintPitchUp,down:(0,l.Z)().orbitConstraintPitchDown};return e.useZoomConstraints=void 0!==e.zoomOut||void 0!==e.zoomIn||void 0,e.useYawConstraints=void 0!==e.left||void 0!==e.right||void 0,e.usePitchConstraints=void 0!==e.up||void 0!==e.down||void 0,e.useCameraConstraints=e.useZoomConstraints||e.useYawConstraints||e.usePitchConstraints||e.usePanConstraints,e},getCameraPosition:function(e,t){var i=this._viewer.getFeaturesManager();if(i&&(i.getCameraWithoutAutospin(e,t),0!==this.get("indexManipulator")&&this.get("node"))){var n=this.get("node").getMinimumBound(),r=J.vec3.dist(e,n.center()),a=Math.max(.1*n.radius(),r);J.vec3.sub(t,t,e),J.vec3.normalize(t,t),J.vec3.scale(t,t,a),J.vec3.add(t,e,t)}},saveCameraPosition:function(){!this.get("useCameraConstraints")||this.get("enableCameraConstraints")?this.getCameraPosition(this.get("position"),this.get("target")):this.getCameraPosition(this.get("position"),J.vec3.create())},validateEyeTarget:function(e,t){var i=J.vec3.dist(e,t);if(i<=1e-8)return!1;var n=this.get("node").getMinimumBound().radius();return i<=.001*n&&(J.vec3.sub(t,t,e),J.vec3.scale(t,t,.01*n/i),J.vec3.add(t,e,t)),!0},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){var t=this.setJSON(e,{validate:!0});return t||c().resolve(!0)},range:function(e){return"["+e.min+", "+e.max+"]"},limits:function(){return{zoomIn:{min:0,max:this.get("maxZoom")},zoomOut:{min:0,max:this.get("maxZoom")},offset:{min:0,max:2*Math.PI},angle:{min:0,max:2*Math.PI},up:{min:-Y,max:Y},down:{min:-Y,max:Y},fov:{min:1,max:179},nearFarRatio:{min:1e-4,max:.005}}},yawAngleOffsetToLeftRight:function(){var e=this.get("offset"),t=this.get("angle"),i=e-t/2,n=0;t===2*Math.PI&&(n=-.001);var r=e+t/2+n;i>=Math.PI&&(i-=2*Math.PI),r>=Math.PI&&(r-=2*Math.PI),this.set("left",i),this.set("right",r)},yawLeftRightToAngleOffset:function(){var e=this._getYawValue(this.get("left")),t=this._getYawValue(this.get("right")),i=this.computeAngleOffset(e,t);this.set("angle",i[0]),this.set("offset",i[1])},_getYawValue:function(e){return e<=-3.14?-Math.PI:e>=3.14?Math.PI:e},computeAngleOffset:function(e,t){var i=t-e;i<0&&(i+=2*Math.PI);var n=e+i/2;return n<0&&(n+=2*Math.PI),[i,n]},checkOverLap:function(e,t,i){var n=this.get(e),r=this.get(t);r>n&&this.set(i,i===e?r:n)}});var X,$,ee,te,ie=A.Z.osg,ne=A.Z.osgGA,re=function(e){ne.FirstPersonManipulator.call(this,e);var t=Math.max(0,Math.min(4,(0,l.Z)().fpsSpeed/25));this._stepFactor=t,this.getControllerList().StandardMouseKeyboard._stepFactor=t,this._postMultRotate=ie.quat.create(),this._resetInitialVR=!1,this._lookPosition._delay=.25};ie.createPrototypeObject(re,ie.objectInherit(ne.FirstPersonManipulator.prototype,{getPostMultRotate:function(){return this._postMultRotate},setResetInitialRotationVR:function(e){this._resetInitialVR=e,e||ie.quat.identity(this._postMultRotate)},setNode:function(e){ne.FirstPersonManipulator.prototype.setNode.call(this,e);var t=this.getHomeBoundingSphere();t&&t.valid()&&(this._distance=this.getHomeDistance(t))},setInitialPoseVR:($=ie.quat.create(),ee=ie.mat4.create(),te=ie.vec3.fromValues(0,0,1),function(e,t){ie.mat4.lookAt(ee,e,t,te),ie.mat4.invert(ee,ee),ie.mat4.getRotation($,ee),$[1]=$[0]=0,ie.quat.normalize($,$),ie.quat.copy(this._postMultRotate,$),this.setEyePosition(e),this.setTarget(t),this.setResetInitialRotationVR(!0)}),setPoseVR:(X=ie.vec3.create(),function(e,t){this._resetInitialVR&&(ie.quat.invert(this._vrRot,e),this._vrRot[0]=this._vrRot[1]=0,ie.quat.normalize(this._vrRot,this._vrRot),ie.quat.multiply(this._postMultRotate,this._vrRot,this._postMultRotate)),ie.quat.multiply(this._vrRot,this._postMultRotate,e),ie.vec3.transformQuat(X,t,this._postMultRotate),this._resetInitialVR?(ie.vec3.set(this._vrTrans,0,0,0),this._resetInitialVR=!1):ie.vec3.sub(this._vrTrans,X,this._vrPos),ie.vec3.copy(this._vrPos,X),this._vrEnable=!0})}),"osgSketchfab","FirstPersonManipulator");const ae=re;var oe,se,le,ue=.99,he=.5*Math.PI*.99,ce=A.Z.osg,Ae=A.Z.osgGA,de=function(e){Ae.OrbitManipulator.call(this,e),this.setLimitPitchUp(he),this.setLimitPitchDown(-he),this._enableRecenter=!0,this._zoomEMA=0,this._pitchEMA=0,this._yawEMA=0,this._panVEMA=0,this._panHEMA=0,this._constrainPan=!1,this._constrainedTarget=ce.vec3.create()};ce.createPrototypeObject(de,ce.objectInherit(Ae.OrbitManipulator.prototype,{setEyePosition:(oe=ce.vec3.create(),se=ce.vec3.create(),le=ce.vec3.create(),function(e,t){var i=this._rotation,n=this._target;if(ce.vec3.sub(oe,e,n),ce.vec3.normalize(oe,oe),t){var r=ce.vec3.dot(oe,this._upz);if(Math.abs(r)>ue){var a=Math.sqrt((1-.9801)/(oe[0]*oe[0]+oe[1]*oe[1]));oe[0]*=a,oe[1]*=a,oe[2]=ue*Math.sign(r)}}ce.vec3.cross(se,oe,this._upz),ce.vec3.normalize(se,se),ce.vec3.cross(le,se,oe),ce.vec3.normalize(le,le),i[0]=se[0],i[1]=oe[0],i[2]=le[0],i[3]=0,i[4]=se[1],i[5]=oe[1],i[6]=le[1],i[7]=0,i[8]=se[2],i[9]=oe[2],i[10]=le[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this._distance=ce.vec3.dist(n,e)}),enableRecenter:function(e){this._enableRecenter=e},computeHomePosition:function(e){this._enableRecenter&&Ae.OrbitManipulator.prototype.computeHomePosition.call(this,e)},_computeEMA:function(e,t){return 0===t?e:.2*e+.8*t},_getLimitReached:function(e,t,i){return Math.abs(e-i)<.001?i:Math.abs(e-t)<.001?t:void 0},computeZoom:function(e){if(Ae.OrbitManipulator.prototype.computeZoom.call(this,e),this._constrainZoom){var t=1;(e-=1)<0&&(e=-e,t=-1);var i=this.getSpeedFactor()*e,n=this._getLimitReached(this.getDistance(),this._limitZoomIn,this._limitZoomOut);void 0!==n&&(void 0===this._prevDistance&&(this._prevDistance=n),i=i/(1+i)*(.1*this.getDistance()),this._zoomEMA=this._computeEMA(i,this._zoomEMA),t<0&&this._prevDistance>n||t>0&&this._prevDistance<n?this._distance=this._prevDistance+this.getSpeedFactor()*e*t:this._distance=n+this._zoomEMA*t),this._prevDistance=this._distance}},_computePitch:function(e,t){var i;if(e=void 0!==this._previousPitch?this._previousPitch:e,i=Ae.OrbitManipulator.prototype._computePitch.call(this,e,t),!this._constrainPitch||0===t)return this._previousPitch=void 0,i;this._previousPitch=i;var n=t/10;n=n/(1+n)*.5;var r=this._getLimitReached(i,this._limitPitchUp,this._limitPitchDown);return void 0!==r&&(this._pitchEMA=this._computeEMA(n,this._pitchEMA),i=r+this._pitchEMA),Math.max(Math.min(i,he),-he)},_computeYaw:function(e,t){var i;if(e=void 0!==this._previousYaw?this._previousYaw:e,i=Ae.OrbitManipulator.prototype._computeYaw.call(this,e,t),!this._constrainYaw||0===t)return this._previousYaw=void 0,i;this._previousYaw=i;var n=t/10;n=n/(1+n)*3;var r=this._getLimitReached(i,this._limitYawLeft,this._limitYawRight);return void 0!==r&&(this._yawEMA=this._computeEMA(n,this._yawEMA),i=r+this._yawEMA),i},computePan:function(e,t){!this._constrainPan||0===e&&0===t||(this._panVEMA=this._computeEMA(e/(1+e)*.5,this._panVEMA),this._panHEMA=this._computeEMA(t/(1+t)*.5,this._panHEMA),e=this._panVEMA,t=this._panHEMA,ce.vec3.copy(this._target,this._constrainedTarget)),Ae.OrbitManipulator.prototype.computePan.call(this,e,t)},setConstrainPan:function(e){this._constrainPan=e},isConstrainPan:function(){return this._constrainPan},setPanConstraintTarget:function(e){ce.vec3.copy(this._constrainedTarget,e)}}),"osgSketchfab","OrbitManipulator");const ge=de;var fe,pe=A.Z.osg,me=A.Z.osgGA,_e=A.Z.osgUtil.DelayInterpolator.prototype,ve=_e.set;_e.set=function(){ve.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&fe(!0)};var Ce=_e.setTarget;_e.setTarget=function(){Ce.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&fe(!0)};var be=_e.addTarget;_e.addTarget=function(){be.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&fe(!0)},_e.isDone=function(e){e=e||1;for(var t=Math.abs(this._epsilon),i=0,n=this._current.length;i<n;++i)if(Math.abs(this._target[i]-this._current[i])>t*e)return!1;return!0};var Se=_e.update;_e.update=function(e){var t=Se.call(this,e);if(this._epsilon>=0)if(this.isDone())for(var i=0,n=this._current.length;i<n;++i)this._current[i]=this._target[i];else fe(),this.isDone(100)?k.Z.draw():k.Z.drawNoJitter();return t};var Ee=function(){for(var e=Math.abs(this._epsilon),t=0,i=this._current.length;t<i;++t)if(1===Math.abs(this._target[t])||Math.abs(this._target[t]-this._current[t])>e)return!1;return!0},ye=function(e){e.isDone=Ee.bind(e)},Ie=function(e,t){fe=t,me.SwitchManipulator.call(this),this._boundStrategy=me.Manipulator.COMPUTE_HOME_USING_SPHERE|me.Manipulator.COMPUTE_HOME_USING_BBOX,this._inputManager=e,this.init()};pe.createPrototypeObject(Ie,pe.objectInherit(me.SwitchManipulator.prototype,{init:function(){me.SwitchManipulator.prototype.setManipulatorIndex.call(this,0);var e=new ge({boundStrategy:this._boundStrategy,inputManager:this._inputManager});e.getRotateInterpolator()._epsilon=.1,e.getPanInterpolator()._epsilon=.1,e.getZoomInterpolator()._epsilon=.001,e.setZoomFactor((0,l.Z)().orbitZoomFactor),e.setRotationFactor((0,l.Z)().orbitRotationFactor),e.setPanFactor((0,l.Z)().orbitPanFactor),e.getPanInterpolator()._isOrbitPan=!0;var t=new ae({boundStrategy:this._boundStrategy,inputManager:this._inputManager});t.getLookPositionInterpolator()._epsilon=.1,t.getSideInterpolator()._epsilon=.001,ye(t.getSideInterpolator()),t.getForwardInterpolator()._epsilon=.001,ye(t.getForwardInterpolator()),t.getPanInterpolator()._epsilon=.001,ye(t.getPanInterpolator()),t.getZoomInterpolator()._epsilon=.001,ye(t.getZoomInterpolator()),this.addManipulator(e,"ORBIT"),this.addManipulator(t,"FPS"),void 0!==(0,l.Z)().cameraEasing&&this.setDelay(1-(0,l.Z)().cameraEasing)},getOrbitManipulator:function(){return this._manipulatorList[Ie.ORBIT]},getFirstPersonManipulator:function(){return this._manipulatorList[Ie.FPS]},_setManipulatorDelay:function(e,t){e.setDelay(t);var i=e._controllerList;for(var n in i){var r=i[n];void 0!==r._delay&&(r._delay=t)}},setDelay:function(e){this._setManipulatorDelay(this._manipulatorList[Ie.ORBIT],e),this._setManipulatorDelay(this._manipulatorList[Ie.FPS],e)},addManipulator:function(e,t){me.SwitchManipulator.prototype.addManipulator.call(this,e),t&&(Ie[t]=this.getManipulatorList().length-1)},setManipulatorIndex:function(){var e=pe.vec3.create(),t=pe.vec3.create();return function(i){if(i!==this.getCurrentManipulatorIndex()){var n=this.getCurrentManipulator();me.SwitchManipulator.prototype.setManipulatorIndex.call(this,i),this.setTargetAndEye(n.getTarget(e),n.getEyePosition(t))}}}(),setTargetAndEye:function(e,t){var i=this.getCurrentManipulator();this.getCurrentManipulatorIndex()===Ie.ORBIT?(e&&i.setTarget(e),t&&i.setEyePosition(t)):(t&&i.setEyePosition(t),e&&i.setTarget(e)),fe(!0)},setEyePosition:function(e,t){this.getCurrentManipulator().setEyePosition(e,t),fe(!0)},getEyePosition:function(e){return this.getCurrentManipulator().getEyePosition(e)},setTarget:function(e){this.getCurrentManipulator().setTarget(e),fe(!0)},getTarget:function(e){return this.getCurrentManipulator().getTarget(e)},setDistance:function(e){this.getCurrentManipulatorIndex()===Ie.ORBIT&&(this.getCurrentManipulator().setDistance(e),fe(!0))},getDistance:function(){return this.getCurrentManipulator().getDistance()},computeHomePosition:function(e){me.SwitchManipulator.prototype.computeHomePosition.call(this,e),fe(!0)}}),"osgSketchfab","SwitchManipulator");const xe=Ie;var Te=i("+eNq"),we=i("R6lU"),Me=i("jO+y");const Re={iconCamCenter:i("l8+D"),iconZoomHint:i("99M6"),iconsLight:{DIRECTION:i("xPCe"),SPOT:i("1kUg"),POINT:i("cAcU"),HEMI:i("u4Ci")},iconSound:i("r5U0"),iconHotspot:i("Ru/i")};var Be,Ne,De,Pe,Fe,Oe,Le=i("HF+a"),ke=i("8AWZ"),Ze=i("jQgr"),Ue=i("xWkn"),Ve=i("3CjY"),Qe=i("IJ4l"),Ge=A.Z.osg,He=A.Z.osgUtil,ze=A.Z.InputGroups,We=Ge.vec4.fromValues(.309375,.8640625,1,1),je=Ge.vec4.fromValues(1,1,0,1),qe=Ge.vec3.fromValues(-1,0,0),Je=.05,Ye=Ge.vec3.fromValues(Je,Je,Je),Ke=.02,Xe=2*Math.PI,$e=Ze.Z.BLEND_SUBSTRACTIVE,et=Ze.Z.DEPTH_DISABLE,tt=Ge.StateAttribute.ON,it=function(e,t){return(e%t+t)%t},nt=function(e,t){Ge.MatrixTransform.call(this),this.setName("Camera - Constraints Gizmo"),this._manipulator=e,this._model=t,this._defaults=this._model.getInstance();var i=this._model.computeAngleOffset(this._defaults.left,this._defaults.right);this._defaults.angle=i[0],this._defaults.offset=i[1],this._circleGeom=He.GizmoGeometry.createCircleGeometry(128,1,2.015*Math.PI),this._arcGeom=He.GizmoGeometry.createCircleGeometry(64,1,1.015*Math.PI),this._pivotNode=new Ge.MatrixTransform,this._arcNode=new Ge.MatrixTransform,this._circleNode=new Ge.MatrixTransform,this._circleNode.setName("Camera - Constraints Gizmo - circleNode"),this._pivotNode.addChild(this._arcNode),this._pivotNode.addChild(this._circleNode),this._arcCenter=this._makeArc(this._arcGeom),this._arcLeft=this._makeArc(this._arcGeom,-Math.PI),this._arcRight=this._makeArc(this._arcGeom,Math.PI),this._arcHalfLeft=this._makeArc(this._arcGeom,.5*-Math.PI),this._arcHalfRight=this._makeArc(this._arcGeom,.5*Math.PI),this._circleCenter=this._makeCircle(),this._circleUp=this._makeCircle(),this._circleDown=this._makeCircle(),this._pivotNode.editMask=He.NodeGizmo.PICK_ARROW|He.NodeGizmo.PICK_PLANE,this.addChild(this._pivotNode),this.setGizmoStateset(We),this._makeCenter(),this._geomHandle=new Ge.createTexturedBoxGeometry(0,0,0,Ke,Ke,Ke),this._handleCenter=this._makeHandle("handleCenter"),this._handleUp=this._makeHandle("handleUp"),this._handleDown=this._makeHandle("handleDown"),this._handleLeft=this._makeHandle("handleLeft"),this._handleRight=this._makeHandle("handleRight"),this._startCoord=Ge.vec2.create(),Ue.Z.initCamera(this),this.setVisible(!1)};nt.prototype=Ge.objectInherit(Ge.MatrixTransform.prototype,{_makeArc:function(e,t){var i=new Ge.MatrixTransform,n=new Ge.MatrixTransform;return n.addChild(e),Ge.mat4.fromRotation(n.getMatrix(),.5*-Math.PI,Ge.vec3.fromValues(0,1,0)),t&&Ge.mat4.fromZRotation(i.getMatrix(),t),i.addChild(n),this._arcNode.addChild(i),i},_makeCircle:function(){var e=new Ge.MatrixTransform;return this._circleNode.addChild(e),e.addChild(this._circleGeom),e},_makeCenter:function(){this._centerNode=new Ge.MatrixTransform,this._pivotNode.addChild(this._centerNode);var e=this._centerNode.getOrCreateStateSet(),t=we.Z.getOrCreateShader(Ve,Qe,"icon","CamConstraintsIcon","ICON");e.setAttributeAndModes(t),this._centerIcon=this._addIcon(this._centerNode,Re.iconCamCenter,"center")},_makeHandle:function(e){var t=new Ge.MatrixTransform;t.setName(e),t.setNodeMask(-1),t.addChild(this._geomHandle),Ge.mat4.fromTranslation(t.getMatrix(),qe);var i=t.getOrCreateStateSet();return this._setupColorAndAlpha(We,1,i),i.addUniform(Ge.Uniform.createFloat(1,"uUp")),i.addUniform(Ge.Uniform.createFloat(-1,"uDown")),this._circleNode.addChild(t),t},_getIconGeom:function(){return this._quadGeom||(this._quadGeom=Ge.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._quadGeom.setNodeMask(-1),this._quadGeom.setName("iconGeom")),this._quadGeom},_addIcon:function(e,t,i){var n=new Ge.MatrixTransform;n.addChild(this._getIconGeom()),n.setName(i+"Icon"),e.addChild(n);var r=s.Z.instance.getOrCreateTexture(t,{internalFormat:Ge.Texture.RGBA}),a=n.getOrCreateStateSet();return a.setTextureAttributeAndModes(0,r.texture,tt),a.addUniform(Ge.Uniform.createInt(0,"uTextureIcon")),this._setupColorAndAlpha(We,1,a),n},_getGizmo:function(){var e=this._model._viewer.getFeaturesManager();return e?e.getNodeGizmo():null},setPivotSelected:function(e){this._getGizmo().attachToNode(e?this._centerNode:void 0)},setGizmoStateset:function(e){this._circleGeom.getOrCreateStateSet().removeAttribute("Program"),this._arcGeom.getOrCreateStateSet().removeAttribute("Program");var t=this._pivotNode.getOrCreateStateSet();t.setRenderBinDetails(Me.Z.EDITOR_GIZMO,"RenderBin"),t.setAttributeAndModes(we.Z.getOrCreateShader(Ve,Qe,"gizmo","CamConstraintsGizmo"),tt),t.setAttributeAndModes($e,tt),t.setAttributeAndModes(et,tt),this._setupColorAndAlpha(e,.4,t),this._setupColorAndAlpha(e,1,this._circleDown.getOrCreateStateSet()),this._setupColorAndAlpha(e,1,this._circleUp.getOrCreateStateSet()),this._setupColorAndAlpha(e,1,this._arcLeft.getOrCreateStateSet()),this._setupColorAndAlpha(e,1,this._arcRight.getOrCreateStateSet());var i=this._arcNode.getOrCreateStateSet();this._uUp=Ge.Uniform.createFloat(1,"uUp"),i.addUniform(this._uUp),this._uDown=Ge.Uniform.createFloat(-1,"uDown"),i.addUniform(this._uDown);var n=this._circleNode.getOrCreateStateSet();this._uHUp=Ge.Uniform.createFloat(1,"uUp"),n.addUniform(this._uHUp),n.addUniform(Ge.Uniform.createFloat(-1,"uDown"))},_setupColorAndAlpha:function(e,t,i){i.addUniform(Ge.Uniform.createFloat4(e,"uColor")),i.addUniform(Ge.Uniform.createFloat(t,"uAlpha"))},setVisible:function(e){this.setNodeMask(e?Te.Z.NO_SHADOW:0),e?this._manipulator.getInputManager().setEnable(ze.CAMERA_GIZMO,!0):this._manipulator.getInputManager().setEnable(ze.CAMERA_GIZMO,!1)},motion:(Oe=Ge.vec2.create(),function(e){if(Ge.vec2.set(Oe,e.canvasX,e.canvasY),this._dragging)this._onDrag(Oe);else if(ke.Z.isInitialized()){var t=ke.Z.computeNearestIntersection2D(Oe[0],Oe[1],Te.Z.PICK,this);if(t){var i=t._nodePath.length,n=t._nodePath[i-1];if(n===this._getIconGeom()||n===this._geomHandle){var r=t._nodePath[i-2];this._onHover(r)}}else this._onHover()}}),_onDrag:function(){var e=Ge.vec3.create(),t=Ge.vec3.create();return function(i){var n=this._model._viewer.getCanvas().height,r=this._model.get("usePitchConstraints"),a=this._model.get("useYawConstraints");if(r){var o=(this._startCoord[1]-i[1])/n*2;if(this._dragging===this._handleUp)return void this._model.set("up",Math.asin(Ge.clamp(this._startModel.up+o,-1,1)));if(this._dragging===this._handleDown)return void this._model.set("down",Math.asin(Ge.clamp(this._startModel.down+o,-1,1)))}if(a){this._getDragPosition(t,i),Ge.vec3.sub(e,t,this._model.get("target")),Ge.vec3.normalize(e,e);var s=this._startModel.a1,l=Math.atan2(e[0],e[1]),u=Math.sign(Ge.vec3.cross(e,this._startModel.baseDir,e)[2]),h=0,c=this._model.get("angle");if(this._dragging===this._handleLeft)return h=this._clampAngle(2*(l-s),-u,c),void this._model.set("angle",h);if(l>0&&(l-=Xe),this._dragging===this._handleRight)return h=this._clampAngle(2*(s-l),u,c),void this._model.set("angle",h);this._dragging===this._handleCenter&&this._model.set("offset",it(this._startModel.offset+(s-l),Xe))}}}(),_getDragPosition:function(){var e=Ge.vec3.create(),t=Ge.vec3.create(),i=Ge.vec3.create(),n=Ge.vec3.create(),r=Ge.vec3.create(),a=Ge.vec3.create();return function(o,s){Le.Z.canvasCoordToGL(s[0],s[1],n),n[2]=0,ke.Z.getWorldPositionFromScreenPoint(n,e),n[2]=1,ke.Z.getWorldPositionFromScreenPoint(n,t),Ge.vec3.sub(a,t,e),Ge.vec3.normalize(a,a),Ge.vec3.set(r,0,0,1);var l=-this._startModel.startPosition[2],u=Ge.vec3.dot(r,a);if(Math.abs(u)<.05){var h=this._startModel.startPosition;Ge.vec3.sub(r,h,this._model.get("target")),r[2]=0,Ge.vec3.normalize(r,r),Ge.vec3.set(i,h[0],h[1],0),i[2]=0,l=-Ge.vec3.dot(r,i),u=Ge.vec3.dot(r,a)}var c=-(Ge.vec3.dot(r,e)+l)/u;return Ge.vec3.scaleAndAdd(o,e,a,c),o}}(),_clampAngle:function(e,t,i){return e=it(e,Xe),t<0?i<Xe-i?0:Xe:e},startDrag:(De=Ge.vec3.create(),Pe=Ge.vec3.create(),Fe=Ge.mat4.create(),function(e){this._hovered&&this._hovered!==this._centerNode&&(this._dragging=this._hovered,Ge.vec2.set(this._startCoord,e.canvasX,e.canvasY),this._handleCenter.getWorldMatrix(this,Fe),Ge.mat4.getTranslation(De,Fe),Ge.vec3.sub(Pe,De,this._model.get("target")),Ge.vec3.normalize(Pe,Pe),this._dragging.getWorldMatrix(this,Fe),Ge.mat4.getTranslation(De,Fe),this._startModel={up:Math.sin(this._model.get("up")),down:Math.sin(this._model.get("down")),offset:this._model.get("offset"),angle:this._model.get("angle"),startPosition:De,baseDir:Pe,a1:Math.atan2(Pe[0],Pe[1])},this._manipulator.getInputManager().setEnable(ze.MANIPULATORS,!1),this._savedEnableState=this._model.get("enableCameraConstraints"),this._model.set("enableCameraConstraints",!1))}),endDrag:function(e){this._dragging&&(this._manipulator.getInputManager().setEnable(ze.MANIPULATORS,!0),this._dragging=void 0,this.motion(e),this._model.set("enableCameraConstraints",this._savedEnableState))},_onHover:function(e){if(e!==this._hovered)if(this._hovered&&(this._changeColor(this._hovered.getStateSet(),We),this._changeColor(this._circleUp.getStateSet(),We),this._changeColor(this._arcLeft.getStateSet(),We),this._changeColor(this._arcRight.getStateSet(),We),this._changeColor(this._circleDown.getStateSet(),We),k.Z.draw()),e){switch(this._hovered=e,this._changeColor(e.getStateSet(),je),e){case this._handleCenter:this._changeColor(this._circleDown.getStateSet(),je),this._changeColor(this._circleUp.getStateSet(),je),this._changeColor(this._arcLeft.getStateSet(),je),this._changeColor(this._arcRight.getStateSet(),je);break;case this._handleUp:this._changeColor(this._circleUp.getStateSet(),je);break;case this._handleDown:this._changeColor(this._circleDown.getStateSet(),je);break;case this._handleLeft:this._changeColor(this._arcLeft.getStateSet(),je);break;case this._handleRight:this._changeColor(this._arcRight.getStateSet(),je)}k.Z.draw()}else this._hovered=void 0},_changeColor:function(e,t){var i=e.getUniform("uColor").getInternalArray();Ge.vec4.copy(i,t)},update:function(){var e=Ge.vec4.create(),t=Ge.vec3.create(),i=Ge.vec3.create();return function(n){var r=n.getViewport(),a=r.width()/r.height(),o=Ge.mat4.getScale(e,n.getProjectionMatrix())[0],s=Math.max(1.2,a*(1.1+.2/o)*o);this._manipulator.getEyePosition(t);var l=this._model.get("target"),u=this._getGizmo();u.isEditing()?(Ge.mat4.getTranslation(l,u.getMatrix()),this._needsCameraUpdate=!0):this._needsCameraUpdate&&(this._needsCameraUpdate=!1,this._model.trigger("targetChanged"));var h=Ge.vec3.dist(t,l)/s,c=this._pivotNode.getMatrix();Ge.vec3.set(i,h,h,h),Ge.mat4.fromTranslation(c,l),Ge.mat4.scale(c,c,i);var A=this._centerNode.getMatrix();Ge.mat4.invert(A,n.getViewMatrix()),Ge.mat4.setTranslation(A,Ge.vec3.ZERO),Ge.mat4.scale(A,A,Ye),this._pivotNode.dirtyBound(),this._centerNode.dirtyBound()}}(),updateConstraints:function(){var e=this._model.get("usePitchConstraints"),t=this._model.get("useYawConstraints"),i=e?this._model.get("up"):this._defaults.up,n=e?this._model.get("down"):this._defaults.down,r=.5*(i+n);this._updatePitchWidget(this._circleUp,i),this._updatePitchWidget(this._circleDown,n),this._updatePitchWidget(this._circleCenter,r);var a=t?this._model.get("offset"):this._defaults.offset,o=t?this._model.get("angle"):this._defaults.angle,s=.5*o;e||t?(this._circleNode.setNodeMask(-1),this._arcNode.setNodeMask(-1),Ge.mat4.fromZRotation(this._circleNode.getMatrix(),a-.5*Math.PI),Ge.mat4.fromZRotation(this._arcCenter.getMatrix(),a),Ge.mat4.fromZRotation(this._arcLeft.getMatrix(),a-s),Ge.mat4.fromZRotation(this._arcRight.getMatrix(),a+s),Ge.mat4.fromZRotation(this._arcHalfLeft.getMatrix(),a-.5*s),Ge.mat4.fromZRotation(this._arcHalfRight.getMatrix(),a+.5*s)):(this._circleNode.setNodeMask(0),this._arcNode.setNodeMask(0)),this._updateHandles(e,t,i,n,r,s),Ge.mat4.fromTranslation(this._pivotNode.getMatrix(),this._model.get("target")),this._uUp.getInternalArray()[0]=Math.sin(i),this._uDown.getInternalArray()[0]=Math.sin(n),this._uHUp.getInternalArray()[0]=-Math.cos(.5*o),this.dirtyBound(),this._pivotNode.dirtyBound(),this._circleNode.dirtyBound(),k.Z.draw()},_updateHandles:function(e,t,i,n,r,a){if(e){this._handleUp.setNodeMask(-1),this._handleDown.setNodeMask(-1);var o=i-n;this._updateHandleWidget(this._handleUp,o<.07?r+.035:i,0),this._updateHandleWidget(this._handleDown,o<.07?r-.035:n,0)}else this._handleUp.setNodeMask(0),this._handleDown.setNodeMask(0);t?(this._handleRight.setNodeMask(-1),this._handleLeft.setNodeMask(-1),this._handleCenter.setNodeMask(-1),a=(a=a<.035?.035:a)>Math.PI-.035?Math.PI-.035:a,this._updateHandleWidget(this._handleRight,r,a),this._updateHandleWidget(this._handleLeft,r,-a),this._updateHandleWidget(this._handleCenter,r,0)):(this._handleRight.setNodeMask(0),this._handleLeft.setNodeMask(0),this._handleCenter.setNodeMask(0))},_updateHandleWidget:function(e,t,i){var n=e.getMatrix();Ge.mat4.fromZRotation(n,i),Ge.mat4.rotateY(n,n,t),Ge.mat4.translate(n,n,qe),e.dirtyBound()},_updatePitchWidget:(Be=Ge.vec3.create(),Ne=Ge.vec3.create(),function(e,t){var i=e.getMatrix(),n=Math.sin(t),r=Math.cos(t);Ge.vec3.set(Be,0,0,n),Ge.vec3.set(Ne,r,r,1),Ge.mat4.fromTranslation(i,Be),Ge.mat4.scale(i,i,Ne)})});const rt=nt;var at,ot=i("59ul"),st=i("EZMu"),lt=A.Z.osg,ut=A.Z.osgAnimation,ht=function(e,t,i){this.cameraUpdateCallback=i,this._fpsDist=-1,this._manipulator=e,this._eyeEnd=lt.vec3.create(),this._eyeDeltaLen=0,this._targetEnd=lt.vec3.create(),this._targetDeltaLen=0,this._lastRatio=0,this._preventFlip=!1,st.Z.call(this,t),this._finished=!0,this._easingFunction=ut.easeOutQuart};lt.createPrototypeObject(ht,lt.objectInherit(st.Z.prototype,{setTargetAndEye:(at=lt.vec3.create(),function(e,t,i){if(this._preventFlip=i,this._finished){var n=this._manipulator.getManipulatorList()[xe.FPS];this._fpsDist=n.getDistance()}lt.vec3.copy(this._eyeEnd,t),this._manipulator.getEyePosition(at),this._eyeDeltaLen=lt.vec3.len(lt.vec3.sub(at,t,at)),lt.vec3.copy(this._targetEnd,e),this._manipulator.getTarget(at),this._targetDeltaLen=lt.vec3.len(lt.vec3.sub(at,e,at)),this._lastRatio=0,this.reset()}),update:function(){var e=lt.vec3.create(),t=lt.vec3.create(),i=lt.vec3.create(),n=lt.vec3.create();return function(r,a){if(!0===this._finished)return!0;var o=this._manipulator,s=o.getCurrentManipulatorIndex();s===xe.FPS&&o.setManipulatorIndex(xe.ORBIT);var l=a.getFrameStamp().getSimulationTime(),u=this.interpolate(l,r,a),h=(u=this._easingFunction(u))-this._lastRatio;this._lastRatio=u;var c=this._manipulator;if(c.getEyePosition(e),c.getTarget(t),lt.vec3.sub(i,this._targetEnd,t),lt.vec3.normalize(i,i),lt.vec3.add(n,t,lt.vec3.scale(n,i,h*this._targetDeltaLen)),c.setTarget(n),lt.vec3.sub(i,this._eyeEnd,e),lt.vec3.normalize(i,i),lt.vec3.add(n,e,lt.vec3.scale(n,i,h*this._eyeDeltaLen)),c.setEyePosition(n,this._preventFlip),s===xe.FPS){var A=o.getDistance();o.setManipulatorIndex(s),o.getCurrentManipulator().setDistance(this._finished?this._fpsDist:A)}return this.cameraUpdateCallback(!0===this._finished),!0}}(),setEasingFunction:function(e){this._easingFunction=ut[e]}}),"osgSketchfab","UpdateCallbackCameraAnimation");const ct=ht;var At=A.Z.osg,dt=A.Z.InputGroups,gt=Math.PI/180,ft=3.14159265;var pt={FeatureName:"camera",ModelType:K,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:indexManipulator",this.onIndexManipulatorChanged,this),e.bind("change:node",this.onNodeChanged,this),e.bind("change:minSpeed",this.onNodeChanged,this),e.bind("change:webVR",this.setVR,this),e.bind("change:fov",this.onFov,this),e.bind("change:nearFarRatio",this.onNearFarRatio,this),e.bind("change:animationDuration",this.onDurationChanged,this),e.bind("change:easingFunction",this.onEasingChanged,this),e.bind("setTargetAndEye",this.onTargetAndEyeChanged,this),e.bind("change:useCameraConstraints",this._onUseCamConstrainsToggle,this),e.bind("change:usePanConstraints",this.refreshConstraints,this),e.bind("change:useZoomConstraints",this.refreshConstraints,this),e.bind("change:zoomIn",this.refreshConstraints,this),e.bind("change:zoomOut",this.refreshConstraints,this),e.bind("change:usePitchConstraints",this.refreshConstraints,this),e.bind("change:right",this.refreshConstraints,this),e.bind("change:useYawConstraints",this.refreshConstraints,this),e.bind("change:up",this.refreshConstraints,this),e.bind("change:down",this.refreshConstraints,this),e.bind("targetChanged",this.onTargetChanged,this),e.bind("refreshConstraints",this.refreshConstraints,this),e.bind("saveZoomIn",this._saveZoom.bind(this,"zoomIn")),e.bind("saveZoomOut",this._saveZoom.bind(this,"zoomOut")),e.bind("change:displayGizmo",this._updateGizmoDisplay.bind(this)),this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._switchManipulator=new xe(this._viewer.getInputManager(),this.cameraMove.bind(this)),this._viewerOSGJS.setupManipulator(this._switchManipulator),this._featureNode=new At.Node("Camera");var t=e.shouldPlayFirstCameraAnimation();if(this._callbackCameraAnimation=new ct(this._switchManipulator,e.get("animationDuration"),function(i){if(i)if(t)F.Z.resolveFirstCameraAnimation(),t=!1;else{var n=e.get("userEndAnimationCallback");n&&(n(),e.set("userEndAnimationCallback",void 0))}this.cameraMove()}.bind(this)),this._featureNode.addUpdateCallback(this._callbackCameraAnimation),this.model.bind("change:enableCameraConstraints",this.focusOnTarget,this),this.onIndexManipulatorChanged(),this._dolly=!1,this.onFov(),this.onNearFarRatio(),this._dolly=!0,F.Z.getFirstCameraAnimation().then(function(){!e.get("webVR")&&this.model.get("useCameraConstraints")&&(this._updateGizmoDisplay(),this.focusOnTarget(),this._switchManipulator.getOrbitManipulator().enableRecenter(!this.model.get("useCameraConstraints")),this.initFeatureBridge())}.bind(this)),!(0,ot.Z)()){this._cameraIdle=!0;var i=k.Z.getFrameTimeAverage();this.cameraIdleNessDetectBinded=this.cameraIdleNessDetect.bind(this),this.timer=window.setTimeout(this.cameraIdleNessDetectBinded,i)}},initFeatureBridge:function(){this.model._viewer.getFeatures().inspector.getModel().bind("change:uiVisible",this._onInspectorVisiblilityChange.bind(this))},_onInspectorVisiblilityChange:function(e){var t=e.get("uiVisible");this.model.set("enableCameraConstraints",!t)},setVR:function(){var e=this._viewerOSGJS.getManipulator(),t=this.model.get("webVR");e.setDelay(t?1:.15);var i=this._viewerOSGJS.getInputManager();if(this._viewerOSGJS.requestContinuousUpdate(!0),t){this.lastMode=this.model.get("indexManipulator");var n=!!this._viewerOSGJS.getVRSession();i.setEnable(dt.FPS_MANIPULATOR_TOUCH,!1),i.setEnable(dt.FPS_MANIPULATOR_WEBVR,n),i.setEnable(dt.FPS_MANIPULATOR_DEVICEORIENTATION,!n),this.model.set("indexManipulator",xe.FPS)}else i.setEnable(dt.FPS_MANIPULATOR_TOUCH,!0),i.setEnable(dt.FPS_MANIPULATOR_WEBVR,!1),i.setEnable(dt.FPS_MANIPULATOR_DEVICEORIENTATION,!1),void 0!==this.lastMode&&this.model.set("indexManipulator",this.lastMode);var r=this._viewer.getFeatures();r&&!r.webVR&&e.computeHomePosition()},onDurationChanged:function(){this._callbackCameraAnimation.setDuration(this.model.get("animationDuration"))},onEasingChanged:function(){this._callbackCameraAnimation.setEasingFunction(this.model.get("easingFunction"))},onTargetAndEyeChanged:function(e){this._callbackCameraAnimation.setTargetAndEye(this.model.get("animationTarget"),this.model.get("animationEye"),e)},canMoveTarget:function(){return this.model.get("indexManipulator")===xe.FPS||!this._switchManipulator.getOrbitManipulator().isConstrainPan()},onFov:function(){var e=this._viewer.getCamera(),t=e.getViewport(),i=t.width()/t.height();if(At.mat4.perspective(e.getProjectionMatrix(),this.model.get("fov")*gt,i,1,1e3),k.Z.draw(),!this.model.get("dollyPrevent")){if(this._dolly){var n=this.options.context.getViewer().getViewerOSGJS().getManipulator(),r=n.getCurrentManipulator();if(r){var a=r.getHomeBoundingSphere();a&&n.setDistance(r.getHomeDistance(a))}}this.model.saveCameraPosition()}},onNearFarRatio:function(){this.model.set("minSpeed",15*this.model.get("nearFarRatio")),k.Z.draw()},getNode:function(){return this._featureNode},getWidgetNode:function(){return this._widgetNode||(this._widgetNode=new At.Node,this._widgetNode.setNodeMask(0)),this._widgetNode},onIndexManipulatorChanged:function(){this._switchManipulator.setManipulatorIndex(this.model.get("indexManipulator"))},onNodeChanged:function(){if(this._dolly){var e=this._switchManipulator;e.setNode(this.model.get("node"));var t=e.getOrbitManipulator(),i=this._switchManipulator.getHomeBoundingSphere().radius();t.setMinSpeed(this.model.get("minSpeed")*i)}},focusOnTarget:function(){this.model.get("enableCameraConstraints")&&!this.model.get("preventCameraConstraintsFocus")&&this.lookatTarget(),this.refreshConstraints()},lookatTarget:function(){var e=At.vec3.create();return function(){this._switchManipulator.getOrbitManipulator().getEyePosition(e),this._viewer.getFeaturesManager().focusOnTargetAndEye(this.model.get("target"),e,.3,!0)}}(),onTargetChanged:function(){this.model.get("usePanConstraints")&&this.model.get("enableCameraConstraints")&&this.focusOnTarget()},_initGizmo:function(){this._widgetNode=new At.Camera,this._widgetNode.setName("Camera - Constraints - Widgets"),this._featureNode.addChild(this._widgetNode),this._widgetNode.setNearFarRatio(5e-5),this._widgetNode.setNodeMask(Te.Z.NO_SHADOW),this._gizmo=new rt(this._switchManipulator.getOrbitManipulator(),this.model),this._widgetNode.addChild(this._gizmo),this._widgetNode.addUpdateCallback(this)},_updateGizmoDisplay:function(){if(F.Z.getFirstCameraAnimation().isFulfilled()){var e=this.model.get("displayGizmo");!this._gizmo&&e&&(this._initGizmo(),this.refreshConstraints(),(0,o.Z)()&&this._gizmo.setPivotSelected(this.model.get("useCameraConstraints"))),this._gizmo&&this._gizmo.setVisible(e)}},_onUseCamConstrainsToggle:function(){var e=this.model.get("useCameraConstraints");this._gizmo&&this._gizmo.setPivotSelected(e),this.refreshConstraints(),this._switchManipulator.getOrbitManipulator().enableRecenter(!e)},refreshConstraints:function(){F.Z.getFirstCameraAnimation().isFulfilled()&&this.applyConstraints()},applyConstraints:function(){if(!this._hasHotSpots()){var e=this.model,t=e.getInstance();e.get("enableCameraConstraints")&&this._applyModel(t);var i=this._switchManipulator.getOrbitManipulator();i.setLimitYawLeft(t.left),i.setLimitYawRight(t.right),i.setConstrainYaw(t.useYawConstraints);var n=.5*Math.PI*.99;i.setLimitPitchDown(Math.min(n,Math.max(-n,t.down))),i.setLimitPitchUp(Math.min(n,Math.max(-n,t.up))),i.setConstrainPitch(t.usePitchConstraints),-1===t.zoomOut&&(t.zoomOut=1/0),i.setLimitZoomOut(t.zoomOut),i.setConstrainZoom(t.useZoomConstraints);var r=!(t.usePanConstraints&&e.get("enableCameraConstraints")&&e.get("useCameraConstraints"));if(t.zoomIn>0)i.setLimitZoomIn(t.zoomIn);else{var a=this._switchManipulator.getHomeBoundingSphere().radius();i.setLimitZoomIn(.001*a)}i.setAutoPushTarget(r&&!t.useZoomConstraints),i.setConstrainPan(!r),i.setPanConstraintTarget(e.get("target")),this._gizmo&&(this._gizmo.updateConstraints(),r||this.lookatTarget()),k.Z.draw()}},update:function(){if(this._hasHotSpots())return!1;var e=this._viewer.getOptions().widgetAPI,t=e&&e.getTabbedWidget().get();return this.model.get("displayGizmo")&&this._gizmo.update(this._viewer.getCamera()),"scene"===t?this._currentTab!==t&&this.model.trigger("TabEnter"):this._currentTab!==t&&(this.model.trigger("TabLeave"),this.model.set("displayGizmo",!1)),this._currentTab=t,!0},_hasHotSpots:function(){if(this.model.get("viewer-api-hotspots"))return!1;var e=this._viewer.getFeatures().hotspot.getModel(),t=e.get("hotspots").length&&e.get("visible");return t&&this.model.get("useCameraConstraints")&&(this.model.set("useCameraConstraints",!1),(0,o.Z)()&&this.model.trigger("ForceDisable")),t},_applyModel:function(e){var t=this.model;t.get("useCameraConstraints")&&(e.useCameraConstraints=!0,e.usePanConstraints=t.get("usePanConstraints"),e.useZoomConstraints=t.get("useZoomConstraints"),e.useZoomConstraints&&(e.zoomIn=t.get("zoomIn"),e.zoomOut=t.get("zoomOut")),e.useYawConstraints=t.get("useYawConstraints"),e.useYawConstraints&&(e.left=Math.max(t.get("left"),-ft),e.right=Math.min(t.get("right"),ft)),e.usePitchConstraints=t.get("usePitchConstraints"),e.usePitchConstraints&&(e.up=t.get("up"),e.down=t.get("down")),(0,o.Z)()&&(0,l.Z)().apiLog&&(console.log("------"),console.log("Viewer API  Camera Constraints json:"),console.log(t.editorGetJSON()),console.log("------")))},_saveZoom:function(e){var t=this.model.limits(),i=Math.max(this._switchManipulator.getOrbitManipulator().getDistance(),t[e].min);this.model.set(e,i)},cameraMove:function(e){e&&k.Z.draw(),this._cameraMoved=At.Timer.instance().tick(),this._cameraIdle&&(this._viewer.trigger("cameraStart"),this._cameraIdle=!1)},cameraIdleNessDetect:function(){var e=2*k.Z.getFrameTimeAverage();this.timer=window.setTimeout(this.cameraIdleNessDetectBinded,e),At.Timer.instance().tick()-this._cameraMoved-e<=e||this._cameraIdle||(this._viewer.trigger("cameraStop"),this._cameraIdle=!0)}})]},mt=n.Z.create(pt);mt.prototype.getManipulator=function(){return this._views[0]._switchManipulator},mt.prototype.canMoveTarget=function(){return this._views[0].canMoveTarget()},mt.prototype.getNode=function(){return this._views[0].getNode()},mt.prototype.getWidgetNode=function(){return this._views[0].getWidgetNode()};const _t=mt;var vt=i("iEQ1"),Ct=i("lVmk"),bt=A.Z.osg,St=function(){bt.NodeVisitor.call(this,bt.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._source="",this._authoringTool="",this._sourceTool=""};bt.createPrototypeObject(St,bt.objectInherit(bt.NodeVisitor.prototype,{getSource:function(){return this._source},getAuthoringTool:function(){return this._authoringTool},getSourceTool:function(){return this._sourceTool},extractSource:function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t],r=n.Name;"source"===r?this._source=n.Value:"authoring_tool"===r?this._authoringTool=n.Value:"source_tool"===r&&(this._sourceTool=n.Value)}},checkStateSet:function(e){e&&e.getUserData()&&this.extractSource(e.getUserData())},checkNode:function(e){var t=e.getUserData();if(!t){if("LightSource"!==e.className())return;if(!e.getLight())return;if(!(t=e.getLight().getUserData()))return}this.extractSource(t)},apply:function(e){this._source||(this.checkNode(e),this._source||(this.checkStateSet(e.getStateSet()),this._source||this.traverse(e)))}}));const Et=St;var yt=i("KrkP"),It=i("puHF"),xt=i("b0A8"),Tt=i("KKY1"),wt=i("5sFf"),Mt=i("58Pd"),Rt=i("gPev"),Bt=i("qKlK"),Nt=i("DjJp"),Dt=i("AfAm"),Pt=i("o/tF"),Ft=i("u5VM"),Ot=A.Z.osg,Lt=function(e,t,i){Ot.NodeVisitor.call(this,Ot.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._lights=[],this._materials=[],this._materialManager=e,this._stateSetsProcessed={},this._authoringTool=t,this._source=i,this._style="",this._hasMetal=void 0,this._globalEnforceRoughness=void 0,this._dictionary=Bt.Z.channelNames,this._dictionaryKeys=Object.keys(Bt.Z.channelNames),this._sortedImages=void 0,this._textureFactor1=!1,this._textureUnit0=!1};Ot.createPrototypeObject(Lt,Ot.objectInherit(Ot.NodeVisitor.prototype,{getStyle:function(){return this._style},hasMetallicWorkflow:function(){return this._hasMetal},getLights:function(){return this._lights},getMaterials:function(){return this._materials},copyDiffuse:function(e){var t=e.getChannels().DiffuseColor,i=e.getChannels().AlbedoPBR,n=e.getChannels().DiffusePBR,r=t.get("UVTransforms"),a=t.getColor(),o=t.getFactor(),s=t.getTextureModel();a&&(i.setColor(a),n.setColor(a)),i.setFactor(o),n.setFactor(o),s&&(i.setTextureModel(s),n.setTextureModel(s)),r&&(i.set("UVTransforms",r),n.set("UVTransforms",r))},matchNameAgainstDict:function(e,t,i){var n=(0,Dt.Z)(e);if(!t)return!1;for(var r=0;r<t.length;r++){var a=t[r],o=(0,Nt.Z)(n,a);if(o<i&&o<a.length)return!0}return!1},channelTextureExtract:function(e,t){var i=e.getChannels()[t];if(i){var n=i.getTextureModel();if(n)return n.getImageModel().get("name")}},channelTextureMatch:function(e,t,i,n){var r=this.channelTextureExtract(e,t);return r&&this.matchNameAgainstDict(r,i,n)},hasTextureChannel:function(e,t){return void 0!==this.channelTextureExtract(e,t)},channelTextureCopy:function(e,t,i){var n=e.getChannels();if(this.channelTextureExtract(e,t))for(var r=n[t].get("UVTransforms"),a=i.length;a--;)n[i[a]].setTextureModel(n[t].getTextureModel().clone()),void 0!==r&&n[i[a]].set("UVTransforms",r)},checkPBRSlot:function(e){if(e)for(var t=0;t<this._dictionaryKeys.length;t++){var i=this._dictionaryKeys[t],n=this._dictionary[i];if(this.matchNameAgainstDict(e,n,Bt.Z.maxLevenshteinDistance))return i}},assignPBRTextureFromFilenames:function(e,t){for(var i=0,n=e.length;i<n;++i){var r=e[i],a=r.getName(),o=this.checkPBRSlot(a);if(!o&&r.getImage()&&(a=r.getImage().getURL(),o=this.checkPBRSlot(a)),o){var s=t.getChannels()[o];if(!s.getTextureModel()){var l=this.createTextureOptionsFromTextureOSG(r);l&&s.setupTextureModel(l)}}}},checkChannelsAndSetWorkFlowRoughGloss:function(e){if(e){var t=e.getChannels(),i=this.hasTextureChannel(e,"GlossinessPBR"),n=this.hasTextureChannel(e,"SpecularPBR"),r=this.hasTextureChannel(e,"RoughnessPBR");this.hasTextureChannel(e,"BumpMap")&&t.BumpMap.setFactor(10),this.hasTextureChannel(e,"MetalnessPBR")&&(this._hasMetal=!0),n&&void 0===this._hasMetal&&(this._hasMetal=!1);var a=r||this._globalEnforceRoughness;a||(a=!i&&void 0===this._globalEnforceRoughness),e.setWorkFlowRoughGloss(a,!1)}},matchFullNameAgainstDict:function(e,t){if(!t)return!1;for(var i=0;i<t.length;++i)if(!(t[i].length<4)&&-1!==e.indexOf(t[i]))return!0;return!1},setChannelsFromImagesNames:function(e,t,i,n){for(var r=Bt.Z.maxLevenshteinDistance,a=0,o=t.length;a<o;a++)for(var s=t[a],l=this._dictionary[s],u=0,h=i.length;u<h;u++){var c=i[u].get("name");if(n?this.matchFullNameAgainstDict(c,l):this.matchNameAgainstDict(c,l,r)){var A=e.getChannels()[s];A.setTextureModel(new Pt.Z({image:i[u]})),A.setFactor(1),e.setChannelEnable(A.get("name"),!0)}}},setGlossinessPBRFromSpecularGlossiness:function(e,t,i){var n=.2126*t[0]+.7152*t[1]+.0722*t[2],r=Math.pow(1e4*i,.25)/100*n;e.setChannelFactor("GlossinessPBR",r),e.setChannelEnable("GlossinessPBR",!0),this._globalEnforceRoughness=!1},getPBRChannels:function(e){var t=[],i=e.getChannels();for(var n in i)-1!==n.indexOf("PBR")&&t.push(n);return t},channelMatchAndCopy:function(e,t,i){var n=this._dictionary[i];if(this.channelTextureMatch(e,t,n,2))return this.channelTextureCopy(e,t,[i])},checkForPBRTextureFromChannelsAndFilenames:function(e){if(e){for(var t=this.getPBRChannels(e),i=t.length;i--;)if(void 0!==this.channelTextureExtract(e,t[i]))return;this.channelTextureCopy(e,"DiffuseColor",["AlbedoPBR","DiffusePBR"]),this.channelTextureCopy(e,"DiffuseIntensity",["AOPBR"]),this.channelMatchAndCopy(e,"SpecularColor","MetalnessPBR")||this.channelMatchAndCopy(e,"SpecularHardness","MetalnessPBR")||this.channelMatchAndCopy(e,"SpecularColor","SpecularPBR")||this.channelMatchAndCopy(e,"SpecularHardness","SpecularPBR"),this.channelMatchAndCopy(e,"SpecularColor","RoughnessPBR")||this.channelMatchAndCopy(e,"SpecularHardness","RoughnessPBR")||this.channelMatchAndCopy(e,"SpecularColor","GlossinessPBR")||this.channelMatchAndCopy(e,"SpecularHardness","GlossinessPBR")}},getOrCreateSortedImagesList:function(){return void 0===this._sortedImages&&(this._sortedImages=this._materialManager.getImageCollection().clone(),this._sortedImages.comparator=function(e,t){return(e.get("version")||0)-(t.get("version")||0)},this._sortedImages.sort()),this._sortedImages},checkForPBRTextureFromMaterialAndFilenames:function(e,t){if(e&&0!==this._materialManager.getImageCollection().length){var i=[],n=e.getChannels();for(var r in n)this.channelTextureExtract(e,r)||i.push(r);for(var a=[],o=this.getOrCreateSortedImagesList(),s=e.get("name").toLowerCase(),l=0;l<o.length;l++){var u=o.models[l].get("name");(t||-1!==u.toLowerCase().indexOf(s))&&a.push(o.models[l])}this.setChannelsFromImagesNames(e,i,a,t)}},hasMaterialAttributes:function(e){return e.getAttribute("Material")},hasTextureAttributes:function(e){for(var t=0,i=e.getNumTextureAttributeLists();t<i;t++)if(e.getTextureAttribute(t,"Texture"))return!0;return!1},processDefaultMaterial:function(e,t){t.removeAttribute("Material");for(var i=0,n=t.getNumTextureAttributeLists();i<n;i++)t.removeTextureAttribute(i,"Texture")},getReferencedTextures:function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var n=e.getTextureAttribute(i,"Texture");n&&("PackedMaterialTexture"===n.className()&&(n=n.getTexture()),t[i]=n)}return t},createMaterial:function(e,t){var i=this._materialManager.createMaterial(e,t);return this._materials.push(i),i},createTextureOptionsFromTextureOSG:function(e){var t=Ft.Z.getOptions(e),i=e.getImage().getURL(),n=this._materialManager.getImageCollection().getImageFromURL(i);if(n)return t.image=n,t;Ot.error("Cannot find image in collection : "+i)},mapTexturesOnMaterial:function(e,t){for(var i=["EmitColor","DiffuseColor","SpecularColor"],n=this.getReferencedTextures(e),r=e.getNumTextureAttributeLists(),a=0,o=r;a<o;a++)if(e.getTextureAttribute(a,"Texture")){var s=1===r?"DiffuseColor":i[a];if(s&&n[a]){var l=this.createTextureOptionsFromTextureOSG(n[a]);if(l){var u=new Pt.Z(l);this.setMaterialChannelTexture(e,t,a,s,u)}}}},applyExistingMaterial:function(e,t){if(e){var i=this._materialManager.getMaterialByStateSet(e);if(i){var n=(i.get("stateSet")||e).getInstanceID();if(!0===this._stateSetsProcessed[n])return i;this._stateSetsProcessed[n]=!0;var r=e.getAttributeMap().Material,a=this._materialManager.getUniqueMaterialName(r,e,t);return i.set("name",a),i.setStateSet(e),this._materials.push(i),i}this._stateSetsProcessed[e.getInstanceID()]=!0}},processLightSource:function(){},pushLight:function(e){var t=this.nodePath[this.nodePath.length-1];t instanceof Ot.LightSource&&(t.setNodeMask(0),t.setLight(e)),e._worldMatrix=Ot.computeLocalToWorld(this.nodePath),this._lights.push(e)},processNode:function(e){var t=e.getStateSet();if(t){var i=this.applyExistingMaterial(t,e);if(i)e.setStateSet(i.get("stateSet"));else{var n=t.getUserData();if(this.hasMaterialAttributes(t)||this.hasTextureAttributes(t))if(n){var r=d.Z.convertUserDataToObject(n);this.processMaterial(e,t,r)}else this.processDefaultMaterial(e,t);i=this._materialManager.getMaterialByStateSet(t),this.checkForPBRTextureFromChannelsAndFilenames(i),this.checkForPBRTextureFromMaterialAndFilenames(i),this.checkChannelsAndSetWorkFlowRoughGloss(i)}}},apply:function(e){e.typeID===Ot.LightSource.typeID&&this.processLightSource(e),this.processNode(e),this.traverse(e)},handleSingleMaterialMapping:function(){if(1===this.getMaterials().length){var e=this.getMaterials()[0];this.checkForPBRTextureFromMaterialAndFilenames(e,!0),this.checkChannelsAndSetWorkFlowRoughGloss(e)}},setMaterialChannelColor:function(e,t,i,n){var r=t.getChannels()[i];return r.setColor&&r.setColor(n),r.setEnable(!0),r},setMaterialChannelFactor:function(e,t,i,n){var r=t.getChannels()[i];return r.setFactor(n),r.setEnable(!0),r},setMaterialChannelTexture:function(e,t,i,n,r){e.removeTextureAttribute(i,"Texture");var a=t.getChannels()[n];return a.setTextureModel(r),a.resetTextureFormat(),this._textureFactor1&&a.setFactor(1),a.setTexCoordUnit(this._textureUnit0?0:i),a.setEnable(!0),a},setChannelsFromMetaDataFactor:function(e,t){if(this._metaMapFactor){var i=this._metaMapFactor;for(var n in i)if(void 0!==e[n]){var r=JSON.parse(e[n]);this.setMaterialChannelFactor(e,t,i[n],r)}}},setChannelsFromMetaDataColor:function(e,t){if(this._metaMapColor){var i=this._metaMapColor;for(var n in i)if(void 0!==e[n]){var r=JSON.parse(e[n]);this.setMaterialChannelColor(e,t,i[n],r)}}},setChannelsFromMetaDataTexture:function(e,t,i){if(this._metaMapTexture){var n=this.getReferencedTextures(t),r=this._metaMapTexture;for(var a in r)if(void 0!==e[a]){var o=JSON.parse(e[a]),s=n[o];if(s){var l=this.createTextureOptionsFromTextureOSG(s);if(l){var u=new Pt.Z(l),h=r[a];this.setMaterialChannelTexture(t,i,o,h,u)}}}}},handleSeparatedAlphaMaskChannel:function(e){var t=e.getChannels();if("alphaMask"===t.Opacity.getTransparency()){if(t.AlphaMask.setEnable(!0),t.AlphaMask.setFactor(t.Opacity.getFactor()),t.AlphaMask.set("invert",t.Opacity.get("invert")),t.Opacity.getTextureModel()){t.AlphaMask.setTextureModel(t.Opacity.getTextureModel()),t.Opacity.setTextureModel(void 0);var i=t.Opacity.get("UVTransforms");i&&t.AlphaMask.set("UVTransforms",i)}t.Opacity.setTransparency("alphaBlend"),t.Opacity.setFactor(1)}}}));const kt=Lt;var Zt=A.Z.osg,Ut=function(){Zt.Light.apply(this,arguments)};Ut.DIRECTION=Zt.Light.DIRECTION,Ut.SPOT=Zt.Light.SPOT,Ut.POINT=Zt.Light.POINT,Ut.HEMI=Zt.Light.HEMI,Zt.createPrototypeStateAttribute(Ut,Zt.objectInherit(Zt.Light.prototype,{attributeType:"SketchfabLight",isDirectionLight:function(){return 0===this._position[3]&&(-1===this._ground[3]||0===this._ground[3])}}),"osgSketchfab","Light");var Vt=Zt.vec3.create();Zt.LightSource.prototype.computeBoundingSphere=function(e){if(Zt.Node.prototype.computeBoundingSphere.call(this,e),!e.valid())return e;if(void 0!==this._light&&this._referenceFrame===Zt.Transform.RELATIVE_RF){var t=this._light.getPosition();0!==t[3]&&e.expandByVec3(Zt.vec3.scale(Vt,t,1/t[3]))}return e};const Qt=Ut;var Gt=A.Z.osg,Ht=function(){kt.apply(this,arguments)};Gt.createPrototypeObject(Ht,Gt.objectInherit(kt.prototype,{_handleCycleDefaultValue:function(e,t,i,n,r,a){if(void 0!==e)if(Array.isArray(e))if("Opacity"===t)if("Color"===i){var o=e[0]*e[1]*e[2]*e[3];1===o&&(o=.15),n[r](t,o)}else n[r](t,e);else"SpecularPBR"===t?("Color"===i||(e=e[0]*e[1]*e[2]*e[3]),n[r](t,e)):"Color"===i&&"NormalMap"===t||n[r](t,e);else"setChannelFactor"===r&&("Strength"===i&&"Emission"===a&&(e/=10),n[r](t,e))},_handleCycleLinkSpecular:function(e,t,i,n,r,a){for(var o=0;o<e.links.length;o++){var s=e.links[o];if(s.from_node){var l=t.nodes[s.from_node],u=l&&l.texture_slot,h=l&&i.getTextureAttribute(u,"Texture");if(!l||!h)return void Gt.warn("Missing Texture linked in "+a+" node destined to "+r);var c=this.createTextureOptionsFromTextureOSG(h);if(c){var A=n.getChannels()[r];A.setupTextureModel(c),A.resetTextureFormat(),A.setTexCoordUnit(u),A.setEnable(!0),this._texturesAssigned.push(h)}}}},cyclesNodeToMaterial:function(e,t,i,n,r,a,o){var s=e.nodes[r];if(void 0!==s)if(!s.value||s.inputs){for(var l=0;l<s.inputs.length;l++){var u=s.inputs[l];if(u.name===a){var h=u.default_value;if(this._handleCycleDefaultValue(h,o,a,t,n,r),u.links&&"SpecularPBR"!==o)return void this._handleCycleLinkSpecular(u,e,i,t,o,r)}}(s=this.findNodeByValueCyclesMetadata(e.nodes,r))&&s.value&&t[n](o,s.value)}else t[n](o,s.value)},findNodeByValueCyclesMetadata:function(e,t){for(var i in e){var n=e[i];if(n instanceof Object){var r=this.findNodeByValueCyclesMetadata(n,t);if(void 0!==r)return r}else if(n===t)return e}},metaDataToMaterial:function(e,t,i,n,r,a){if(void 0!==e[n]){void 0===r&&(r=n);var o="setChannel"+i;void 0!==t[o]?void 0===a||!0===a?t[o](r,JSON.parse(e[n])):t[o](r,e[n]):Gt.warn("material has not method "+o)}},setTextureFromBlender:function(e,t,i,n,r){var a=this.createTextureOptionsFromTextureOSG(n);if(a){var o=e.getChannels()[t];o.setFactor(r),o.setupTextureModel(a),o.setTexCoordUnit(i),o.setEnable(!0)}},processDefaultMaterial:function(e,t){t.removeAttribute("Material");for(var i=0,n=t.getNumTextureAttributeLists();i<n;i++)t.removeTextureAttribute(i,"Texture");e.setStateSet(void 0)},processLightSource:function(e){var t=e.getLight();if(t&&void 0!==t.getUserData()&&t.typeID!==Qt.typeID){var i=t.getUserData(),n=d.Z.convertUserDataToObject(i),r=new Qt;"AREA"!==n.Type&&"SUN"!==n.Type&&"HEMI"!==n.Type||(n.Type="DIRECTION"),r.setLightType(n.Type),void 0!==n.SpotSize&&r.setSpotCutoff(90*JSON.parse(n.SpotSize)/Math.PI),void 0!==n.SpotBlend&&r.setSpotBlend(JSON.parse(n.SpotBlend)),Gt.vec3.scale(r.getDiffuse(),JSON.parse(n.Color),JSON.parse(n.Energy));var a=1/JSON.parse(n.Distance);r.setQuadraticAttenuation(Math.abs(a)===1/0?0:a),this.pushLight(r)}},processCyclesGraph:function(e,t,i){var n;try{n=JSON.parse(i.NodeTree)}catch(e){return Gt.warn("error in blender cycle graph json "+e),!0}if(void 0===n)return!0;this._texturesAssigned=[],this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Diffuse BSDF","Color","DiffusePBR"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Diffuse BSDF","Roughness","RoughnessPBR"),this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Diffuse BSDF","Normal","NormalMap"),this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Glossy BSDF","Color","SpecularPBR"),e.setChannelFactor("SpecularPBR",1),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Glossy BSDF","Roughness","RoughnessPBR"),this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Glossy BSDF","Normal","NormalMap"),this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Bump","Height","NormalMap"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Bump","Strength","NormalMap"),this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Emission","Color","EmitColor"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Emission","Strength","EmitColor"),this.cyclesNodeToMaterial(n,e,t,"setChannelColor","Ambient Occlusion","Color","AOPBR"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Ambient Occlusion","Strength","AOPBR"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Transparency","Strength","Opacity"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Transparent BSDF","Color","Opacity"),this.cyclesNodeToMaterial(n,e,t,"setChannelFactor","Glass BSDF","Color","Opacity");for(var r=[],a=0,o=t.getNumTextureAttributeLists();a<o;a++){var s=t.getTextureAttribute(a,"Texture");s&&-1===this._texturesAssigned.indexOf(s)&&r.push(s)}return this.assignPBRTextureFromFilenames(r,e),e.setWorkFlowMetalSpec(!1,!1),e.setWorkFlowRoughGloss(!0,!1),this._hasMetal=!1,!1},processMaterial:function(e,t,i){var n=this.createMaterial(e,t),r=t.getAttribute("Material"),a=r&&r.getUserData(),o=d.Z.convertUserDataToObject(a),s=!0;o.NodeTree&&(s=this.processCyclesGraph(n,t,o)),s&&(this.metaDataToMaterial(o,n,"Color","DiffuseColor"),this.metaDataToMaterial(o,n,"Factor","DiffuseIntensity","DiffuseColor"),n.setChannelEnable("DiffuseColor",!0),this.metaDataToMaterial(o,n,"Color","SpecularColor"),this.metaDataToMaterial(o,n,"Factor","SpecularIntensity","SpecularColor"),n.setChannelEnable("SpecularColor",!0),this.metaDataToMaterial(o,n,"Factor","Emit","EmitColor"),n.setChannelEnable("EmitColor",!0),this.metaDataToMaterial(o,n,"Factor","SpecularHardness"),n.setChannelEnable("SpecularHardness",!0),void 0!==o.Translucency&&(n.setChannelFactor("Opacity",1-JSON.parse(o.Translucency)),n.setChannelEnable("Opacity",!0)),void 0!==i.Shadeless&&n.set("shadeless",i.Shadeless));var l=(0,yt.Z)([function(e){return(0,vt.Z)(e,(function(e){var t=e.Name.substr(0,2),i=parseInt(t,10);if(!isNaN(i))return i}))},function(e){return(0,It.Z)(e,void 0)},xt.Z,function(e){return(0,Tt.Z)(e,(function(e){return e}))}])(t.getUserData());t.removeAttribute("Material");var u={},h=["DiffuseColor","DiffuseIntensity","SpecularColor","Normal","Bump","Translucency","Alpha","EmitColor","SpecularHardness"],c=this;for(var A in(0,wt.Z)(l,(function(e){var i=(0,Mt.Z)(t.getUserData(),(function(t){var i=t.Name.substr(0,2);return parseInt(i,10)===e}));(0,wt.Z)(i,(function(e){var i=e.Name.substr(0,2),r=parseInt(i,10),a=t.getTextureAttribute(r,"Texture");if(void 0!==a){u[r]=a;var o=e.Name.substr(3);if(!0===(0,Rt.Z)(h,o)){var s=parseFloat(e.Value);"DiffuseColor"===o?void 0!==n.getChannels().DiffuseColor.getTextureModel()&&void 0===n.getChannels().DiffuseIntensity.getTextureModel()&&(o="DiffuseIntensity"):"Alpha"===o?o="Opacity":"Translucency"===o?(o="Opacity",s=1-s):"Normal"===o?o="NormalMap":"Bump"===o&&(o="BumpMap"),c.setTextureFromBlender(n,o,r,a,s)}else"UsePremultiplyAlpha"===o?Gt.warn("UsePremultiplyAlpha not supported"):"UseAlpha"===o?Gt.warn("UseAlpha not supported"):Gt.warn("channel "+o+" not supported")}else Gt.warn("missing texture")}))})),u)t.removeTextureAttribute(parseInt(A,10),"Texture");"ksp"===o.source&&(-1===n.attributes.name.toLowerCase().indexOf("wheel")?n.getChannels().MetalnessPBR.setFactor(1):n.getChannels().SpecularF0.setFactor(0),-1!==n.attributes.name.toLowerCase().indexOf("fairing")&&n.getChannels().Opacity.setFactor(.25)),n.setStateSet(t)}}));const zt=Ht;var Wt=A.Z.osg,jt=function(){kt.apply(this,arguments),this._metaMapColor={emission_color:"EmitColor",diffuse_color:"DiffuseColor",specular_color:"SpecularColor",transparency_color:"Opacity"},this._metaMapFactor={bump_amount:"BumpMap",normal_amount:"NormalMap",shininess_amount:"SpecularHardness",transparency_amount:"Opacity"},this._metaMapTexture={emissive_unit:"EmitColor",diffuse_unit:"DiffuseColor",specular_unit:"SpecularColor",shininess_unit:"SpecularHardness",transparency_unit:"Opacity",bump_unit:"BumpMap",normal_unit:"NormalMap"}};Wt.createPrototypeObject(jt,Wt.objectInherit(kt.prototype,{setMaterialChannelColor:function(e,t,i,n){var r=t.getChannels()[i];r.setEnable(!0),"Opacity"!==i?(r.setColor&&r.setColor(n),"SpecularColor"===i&&r.setFactor(1)):r.setFactor(n[3])},setMaterialChannelFactor:function(e,t,i,n){var r=t.getChannels()[i];if(r.setEnable(!0),"SpecularHardness"===i){n*=128;var a=e.specular_color?JSON.parse(e.specular_color):Wt.vec3.ZERO;this.setGlossinessPBRFromSpecularGlossiness(t,a,n)}r.setFactor(n)},_extractMetaData:function(e,t,i){for(var n in t)if(n.startsWith(i)){var r=n.substr(i.length+1);e[r]||(e[r]=t[n])}},_cleanMetaData:function(e){var t={};return this._extractMetaData(t,e,"lambert"),this._extractMetaData(t,e,"blinn"),this._extractMetaData(t,e,"phong"),this._extractMetaData(t,e,"extra"),t},processMaterial:function(e,t,i){var n=this.createMaterial(e,t),r=n.getChannels();i=this._cleanMetaData(i),this.setChannelsFromMetaDataFactor(i,n),this.setChannelsFromMetaDataColor(i,n),this.setChannelsFromMetaDataTexture(i,t,n),i.transparency_alphamask&&r.Opacity.getTextureModel()&&r.Opacity.setTransparency("alphaMask"),"substancepainter"===this._source&&r.NormalMap.set("flipY",!1),this.handleSeparatedAlphaMaskChannel(n),t.removeAttribute("Material"),n.setStateSet(t)}}));const qt=jt;var Jt=A.Z.osg,Yt=function(){kt.apply(this,arguments)};Jt.createPrototypeObject(Yt,Jt.objectInherit(kt.prototype,{processMaterial:function(e,t){return this.processDefaultMaterial(e,t)},processDefaultMaterial:function(e,t){var i=this.createMaterial(e,t),n=t.getAttribute("Material");return void 0!==n&&(i.setChannelColor("EmitColor",n.getAmbient()),i.setChannelColor("DiffuseColor",n.getDiffuse()),i.setChannelColor("SpecularColor",n.getSpecular()),i.setChannelFactor("SpecularHardness",n.getShininess()),i.setChannelFactor("Opacity",n.getDiffuse()[3]),i.setChannelEnable("EmitColor",!0),i.setChannelEnable("DiffuseColor",!0),i.setChannelEnable("SpecularColor",!0),i.setChannelEnable("SpecularHardness",!0),i.setChannelEnable("Opacity",!0),t.removeAttribute("Material")),this.mapTexturesOnMaterial(t,i),i.setStateSet(t),i}}));const Kt=Yt;var Xt=A.Z.osg,$t=function(){kt.apply(this,arguments),this._textureFactor1=!0,this._metaMapColor={LambertDiffuseColor:"DiffuseColor",LambertEmissiveColor:"EmitColor",PhongSpecularColor:"SpecularColor"},this._metaMapFactor={LambertDiffuseFactor:"DiffuseColor",LambertBumpFactor:"BumpMap",LambertEmissiveFactor:"EmitColor",PhongSpecularFactor:"SpecularColor",PhongShininess:"SpecularHardness"},this._metaMapTexture={sDiffuse:"DiffuseColor",sNormalMap:"NormalMap",sBump:"BumpMap",sEmissive:"EmitColor",sSpecular:"SpecularColor",sOpacity:"Opacity",sAo:"AOPBR",sRoughness:"RoughnessPBR",sMetallic:"MetalnessPBR"}};Xt.createPrototypeObject($t,Xt.objectInherit(kt.prototype,{setMaterialChannelColor:function(e,t,i,n){var r=t.getChannels()[i];r.setColor&&r.setColor(n),r.setEnable(!0)},setMaterialChannelFactor:function(e,t,i,n){var r=t.getChannels()[i];if(r.setFactor(n),r.setEnable(!0),"SpecularHardness"===i){var a=e.PhongSpecularColor?JSON.parse(e.PhongSpecularColor):[0,0,0];this.setGlossinessPBRFromSpecularGlossiness(t,a,n)}},processLightSource:function(e){var t=e.getLight();if(t){var i=t.getUserData();if(void 0!==i&&t.typeID!==Qt.typeID){var n=d.Z.convertUserDataToObject(i),r=new Qt;if("directional"===n.Type)r.setLightType("DIRECTION");else if("point"===n.Type)r.setLightType("POINT");else{if("spot"!==n.Type)return;r.setLightType("SPOT")}if("spot"===n.Type){r.setSpotCutoff(JSON.parse(n.OuterAngle)/2);var a=JSON.parse(n.InnerAngle)/JSON.parse(n.OuterAngle);r.setSpotBlend(a!=a||Math.abs(a)===1/0?.5:Math.min(a,1))}Xt.vec3.scale(r.getDiffuse(),JSON.parse(n.Color),JSON.parse(n.Intensity)/100);var o=1/JSON.parse(n.DecayStart);r.setQuadraticAttenuation(Math.abs(o)===1/0?0:o),this.pushLight(r)}}},processMaterial:function(e,t,i){var n=this.createMaterial(e,t);if(this.setChannelsFromMetaDataColor(i,n),this.setChannelsFromMetaDataFactor(i,n),this.setChannelsFromMetaDataTexture(i,t,n),i.LambertBumpFactor&&!i.sBump&&n.getChannels().BumpMap.setEnable(!1),"Agisoft Metashape"===this._authoringTool){var r=n.getChannels().NormalMap;r.getTextureModel()&&r.set("flipY",!1)}if("Tilt Brush"===this._authoringTool){var a=n.getChannels(),o=a.EmitColor;if(o.set("type","multiplicative"),!o.getTextureModel()){var s=o.getColor();0===s[0]&&0===s[1]&&0===s[2]&&o.setColor(Xt.vec3.ONE)}a.SpecularF0.setFactor(0),a.RoughnessPBR.setFactor(1);var l=i.BlendMode;"AlphaMask"===l?(a.Opacity.setFactor(JSON.parse(i.LambertTransparencyFactor||0)),a.Opacity.setTransparency("alphaMask")):"AdditiveBlend"===l?(a.Opacity.setFactor(1-JSON.parse(i.LambertTransparencyFactor||0)),a.Opacity.setTransparency("additive")):a.Opacity.setEnable(!1)}this.handleSeparatedAlphaMaskChannel(n),t.removeAttribute("Material"),n.setStateSet(t)}}));const ei=$t;var ti=A.Z.osg,ii=function(){kt.apply(this,arguments),this._metaMapTexture={diffuse:"DiffuseColor",specular:"SpecularColor",transparency:"Opacity"}};ti.createPrototypeObject(ii,ti.objectInherit(kt.prototype,{processMaterial:function(e,t,i){var n=this.createMaterial(e,t);this.setChannelsFromMetaDataTexture(i,t,n),t.removeAttribute("Material"),n.setStateSet(t)}}));const ni=ii;var ri=A.Z.osg,ai=function(){kt.apply(this,arguments),this._metaMapColor={kd:"DiffuseColor",ka:"EmitColor",ks:"SpecularColor"},this._metaMapFactor={ns:"SpecularHardness",tr:"Opacity",d:"Opacity"},this._metaMapTexture={map_ka:"EmitColor",map_kd:"DiffuseColor",map_occlusion:"DiffuseIntensity",map_d:"Opacity",map_ks:"SpecularColor",map_ns:"SpecularHardness",map_normal:"NormalMap",bump:"BumpMap"}};ri.createPrototypeObject(ai,ri.objectInherit(kt.prototype,{checkOpacityFactor:function(e){var t=e.getChannels().Opacity;t.getFactor()<.001&&t.setFactor(1)},setMaterialChannelColor:function(e,t,i,n){var r=t.getChannels()[i];r.setColor&&r.setColor(n),r.setEnable(!0),"SpecularColor"===i&&r.setFactor(1)},setMaterialChannelFactor:function(e,t,i,n){var r=t.getChannels()[i];if(r.setFactor(n),r.setEnable(!0),"SpecularHardness"===i){var a=void 0!==e.ks?JSON.parse(e.ks):[0,0,0];this.setGlossinessPBRFromSpecularGlossiness(t,a,n)}},processMaterial:function(e,t,i){var n=this.createMaterial(e,t);this.setChannelsFromMetaDataColor(i,n),this.setChannelsFromMetaDataFactor(i,n),this.setChannelsFromMetaDataTexture(i,t,n),this.checkOpacityFactor(n),t.removeAttribute("Material"),n.setStateSet(t)}}));const oi=ai;var si=A.Z.osg,li=function(){kt.apply(this,arguments),this._metaMapColor={kd:"DiffuseColor"},this._metaMapFactor={tr:"Opacity",d:"Opacity"}};si.createPrototypeObject(li,si.objectInherit(oi.prototype,{isSelfIlluminationSurface:function(e){if(!e.length)return!1;var t=e[0].getImage().getURL().split("/").pop().split(".").shift();return!!(t.match("carrot_crop_(.*)")||t.match("crops_(.*)")||"fern"===t||"dead_shrub"===t||"flower_red"===t||"flower_yellow"===t||"lilypad"===t||"mushroom_brown"===t||"mushroom_red"===t||t.match("netherwart_(.*)")||t.match("potato_crop_(.*)")||t.match("sapling_(.*)")||"tall_grass"===t||"torch"===t||"torch_flame"===t)},getReferencedTextures:function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var n=e.getTextureAttribute(i,"Texture");void 0!==n&&("PackedMaterialTexture"===n.className()&&(n=n.getTexture()),t[i]=n)}return t},setMaterialChannelTexture:function(e,t,i,n,r,a,o){e.removeTextureAttribute(i,"Texture");var s=t.getChannels()[r],l=this.createTextureOptionsFromTextureOSG(n);l&&(l.wrapT=si.Texture[a],l.wrapS=si.Texture[a],o&&(l.minFilter=si.Texture.NEAREST_MIPMAP_LINEAR,l.magFilter=si.Texture.NEAREST),s.setupTextureModel(l),s.setTexCoordUnit(0),s.setEnable(!0))},processMaterial:function(e,t,i){var n,r,a=this.createMaterial(e,t);this.setChannelsFromMetaDataColor(i,a),this.setChannelsFromMetaDataFactor(i,a),void 0!==i.ka&&(a.setChannelFactor("EmitColor",.1),a.setChannelEnable("EmitColor",!0)),a.setChannelColor("SpecularColor",si.vec3.create()),a.setChannelEnable("SpecularColor",!0),a.setChannelFactor("SpecularHardness",1),a.setChannelEnable("SpecularHardness",!0),this.checkOpacityFactor(a);var o="mineways"===i.source,s=this.getReferencedTextures(t),l=this.isSelfIlluminationSurface(s),u=l?"CLAMP_TO_EDGE":"REPEAT";if(void 0!==i.map_kd&&void 0!==(r=s[n=JSON.parse(i.map_kd)])&&this.setMaterialChannelTexture(t,a,n,r,"DiffuseColor",u,o),l||(void 0!==i.map_ke?void 0!==(r=s[n=JSON.parse(i.map_ke)])&&(this.setMaterialChannelTexture(t,a,n,r,"EmitColor",u,o),a.setChannelFactor("EmitColor",1)):void 0!==i.map_ka?void 0!==(r=s[n=JSON.parse(i.map_ka)])&&this.setMaterialChannelTexture(t,a,n,r,"EmitColor",u,o):void 0!==i.map_kd&&void 0!==(r=s[n=JSON.parse(i.map_kd)])&&(this.setMaterialChannelTexture(t,a,n,r,"EmitColor",u,o),a.setChannelFactor("EmitColor",.1))),l&&(a.set("shadeless",!0),a.setChannelFactor("EmitColor",0),a.setChannelEnable("EmitColor",!0)),void 0!==i.map_d&&void 0!==(r=s[n=JSON.parse(i.map_d)])){this.setMaterialChannelTexture(t,a,n,r,"Opacity",u,o);var h=a.getChannels().Opacity;o?(h.getTextureModel().set("internalFormat",si.Texture.ALPHA),-1!==a.attributes.name.toLowerCase().indexOf("leaves")&&(h.setTransparency("alphaMask"),a.setChannelFactor("Opacity",.2))):(h.getTextureModel().set("internalFormat",si.Texture.LUMINANCE),h.setTransparency("alphaBlend")),a.set("cullFace",si.CullFace.BACK)}if(a.setChannelFactor("RoughnessPBR",1),a.setChannelFactor("SpecularF0",0),!this._lights.length){var c=new Qt;c.setLightType("DIRECTION"),si.vec3.set(c.getDiffuse(),1,1,1),this._lights.push(c),c._worldMatrix=si.mat4.fromRotation(si.mat4.create(),Math.PI/6,si.vec3.fromValues(1,1,0))}this.handleSeparatedAlphaMaskChannel(a),t.removeAttribute("Material"),a.setStateSet(t)}}));const ui=li;var hi=A.Z.osg,ci=function(){kt.apply(this,arguments),this._textureFactor1=!0,this._metaMapColor={DiffuseColor:"DiffuseColor",SpecularPBRColor:"SpecularPBR",EmissiveColor:"EmitColor"},this._metaMapFactor={DiffuseFactor:"DiffuseColor",EmissiveFactor:"EmitColor",MetallicFactor:"MetalnessPBR",RoughnessFactor:"RoughnessPBR",GlossinessPBRFactor:"GlossinessPBR",SpecularPBRFactor:"SpecularPBR",AOFactor:"AOPBR",NormalFactor:"NormalMap",ClearcoatFactor:"ClearCoat",ClearcoatRoughnessFactor:"ClearCoatRoughness"},this._metaMapTexture={sDiffuse:"DiffuseColor",sMetallic:"MetalnessPBR",sRoughness:"RoughnessPBR",sSpecularPBR:"SpecularPBR",sGlossinessPBR:"GlossinessPBR",sNormalMap:"NormalMap",sEmissive:"EmitColor",sOpacity:"Opacity",sAO:"AOPBR",sClearCoat:"ClearCoat",sClearCoatNormal:"ClearCoatNormalMap",sClearCoatRoughness:"ClearCoatRoughness",sSheenColor:"Sheen",sSheenRoughness:"SheenRoughness"}};hi.createPrototypeObject(ci,hi.objectInherit(kt.prototype,{setMaterialChannelColor:function(e,t,i,n){var r=t.getChannels()[i];r.getTextureModel()||(r.setColor&&r.setColor(n),r.setFactor(1))},checkWorkflowPBR:function(e){e.sMetallic||e.MetallicFactor||!e.sSpecularPBR&&!e.SpecularPBRColor&&!e.SpecularPBRFactor?this._hasMetal=!0:void 0===this._hasMetal&&(this._hasMetal=!1)},checkWorkflowRoughGloss:function(e){e.RoughnessPBR||e.RoughnessFactor||!e.GlossinessPBR&&!e.GlossinessPBRFactor?this._globalEnforceRoughness=!0:void 0===this._globalEnforceRoughness&&(this._globalEnforceRoughness=!1)},checkAlphaMode:function(e,t){var i=t.getChannels();if(e.alphaMode&&"OPAQUE"!==e.alphaMode){var n=i.Opacity;if("gltf"===this._source&&this.hasTextureChannel(t,"DiffuseColor")){var r=i.DiffuseColor,a=r.getTextureModel().clone();if(a&&a.getImageModel()&&a.getImageModel().get("alpha")){a.set("internalFormat",hi.Texture.ALPHA),a.updateMultiresTexture(),n.setTextureModel(a),n.setTexCoordUnit(r.getTexCoordUnit());var o=r.get("UVTransforms");o&&n.set("UVTransforms",o)}}if("BLEND"===e.alphaMode?n.setFactor(JSON.parse(e.OpacityFactor||1)):"MASK"===e.alphaMode&&(n.setTransparency("alphaMask"),n.setFactor(JSON.parse(e.alphaCutoff||.5))),n.setEnable(!0),"usd"===this._source){var s=n.getTextureModel();s&&s.getImageModel()&&!s.getImageModel().get("alpha")&&n.setEnable(!1)}}},checkNormalMap:function(e,t){t.getChannels().NormalMap.set("flipY",void 0!==e.yUp&&!1===JSON.parse(e.yUp))},checkCullFace:function(e,t){void 0!==e.doubleSided&&!1!==JSON.parse(e.doubleSided)||t.set("cullFace",hi.CullFace.BACK)},checkClearCoat:function(e,t){void 0===e.ClearcoatFactor&&void 0===e.ClearcoatRoughnessFactor&&void 0===e.sClearCoat&&void 0===e.sClearCoatNormal&&void 0===e.sClearCoatRoughness||(t.getChannels().ClearCoat.setEnable(!0),t.getChannels().ClearCoatRoughness.setEnable(!0),t.getChannels().ClearCoatNormalMap.setEnable(!0),t.getChannels().ClearCoatNormalMap.set("flipY",void 0!==e.yUp&&!1===JSON.parse(e.yUp)))},applyTextureTransforms:function(e,t,i){for(var n in t)if(!(void 0===this._metaMapTexture[n]||t[n]>=e.length)){var r=e[JSON.parse(t[n])];if(r&&0!==r.length){var a=this._metaMapTexture[n],o=i.getChannels()[a],s=d.Z.convertUserDataToObject(r[0]._object._userdata),l=void 0!==s.offset&&JSON.parse(s.offset)||[0,0],u=void 0!==s.scale&&JSON.parse(s.scale)||[1,1],h=void 0!==s.rotation&&JSON.parse(s.rotation)||0;if(1!==u[0]||1!==u[1]||0!==h||0!==l[0]||0!==l[1]){Math.abs(l[0])>1&&(l[0]=Math.sign(l[0])*(l[0]%1)),Math.abs(l[1])>1&&(l[1]=Math.sign(l[0])*(l[1]%1));var c=o.getOrCreateUVTransforms();c.offset=hi.vec2.fromValues(l[0],l[1]),c.scale=hi.vec2.fromValues(u[0],u[1]),c.rotation=h,o.set("UVTransforms",c)}}}},handleTransmissionExtension:function(e,t,i){if(void 0!==e.TransmissionFactor||void 0!==e.sTransmission){var n=t.getChannels().Opacity;n.setEnable(!0),n.setTransparency("refraction"),n.set("ior",1),n.set("invert",!0);var r=JSON.parse(e.TransmissionFactor||0);n.setFactor(1-r);var a=JSON.parse(e.DiffuseColor||[1,1,1,1]);t.getChannels().DiffuseColor.getTextureModel()?(n.set("useAlbedoTint",!1),n.set("refractionColor",[a[0],a[1],a[2]])):n.set("useAlbedoTint",!0);var o=t.getChannels().RoughnessPBR.getEnable()?t.getChannels().RoughnessPBR.getFactor():t.getChannels().GlossinessPBR.getFactor();n.set("roughnessFactor",o),n.set("useMicrosurfaceTexture",!0);var s=JSON.parse(e.sTransmission||-1);if(-1!==s){var l=this.getReferencedTextures(i)[s];if(l){var u=this.createTextureOptionsFromTextureOSG(l);if(u){var h=new Pt.Z(u);n.setTextureModel(h),n.setFactor(1)}}}}},checkSheen:function(e,t){if(void 0!==e.sheenColorFactor||void 0!==e.sheenRoughnessFactor||void 0!==e.sSheenColor||void 0!==e.sSheenRoughness){var i=t.getChannels().Sheen;i.setEnable(!0),i.setFactor(1);var n=JSON.parse(e.sheenColorFactor||[0,0,0]);i.set("colorFactor",n);var r=JSON.parse(e.sheenRoughnessFactor||0),a=t.getChannels().SheenRoughness;a.setEnable(!0),a.setFactor(r)}},processMaterial:function(e,t,i){var n=this.createMaterial(e,t),r=JSON.parse(JSON.stringify(e.getStateSet()._textureAttributeArrayList));this.checkWorkflowPBR(i),this.checkWorkflowRoughGloss(i),this.setChannelsFromMetaDataTexture(i,t,n),this.setChannelsFromMetaDataFactor(i,n),this.setChannelsFromMetaDataColor(i,n),this.checkNormalMap(i,n),this.checkCullFace(i,n),this.checkClearCoat(i,n),this.checkSheen(i,n),this.applyTextureTransforms(r,i,n),this.checkAlphaMode(i,n),n.getChannels().AOPBR.set("occludeSpecular",!0),this.copyDiffuse(n),this.handleSeparatedAlphaMaskChannel(n),this.handleTransmissionExtension(i,n,t),t.removeAttribute("Material"),n.setStateSet(t)}}));const Ai={default:Kt,wavefront:oi,blender:zt,ksp:zt,lightwave:ni,minecraft:ui,collada:qt,fbx:ei,substancepainter:qt,mineways:ui,gltf:ci,usd:ci};var di=i("UFcT"),gi=function(e){this._materialManager=e};gi.prototype={apply:function(e){var t=new Et;e.accept(t);var i=t.getSource(),n=t.getAuthoringTool();i=i?i.toLowerCase():"default";var r=new(Ai[i]?Ai[i]:Ai.default)(this._materialManager,n,i);e.accept(r),(0,di.Z)()&&r.handleSingleMaterialMapping();var a=!d.Z.hasTriangles&&!d.Z.hasVertexNormals;("q3d"===i||a)&&(r._style="shadeless");var o=e.getUserData()||[];return o.push({Name:"source",Value:i}),o.push({Name:"authoringTool",Value:n}),o.push({Name:"sourceTool",Value:t.getSourceTool()}),e.setUserData(o),e.userDataMap=d.Z.convertUserDataToObject(o),r}};const fi=gi;var pi=A.Z.osg,mi=function(){pi.NodeVisitor.call(this,pi.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._paths=[],this._pathsStateSet=[],this._currentStateSet=[],this._stateSetMap={},this._stateSetMapNodes={},this._wireframePaths=[],this._noGeometryPaths=[],this.nodeMaskOverride=-1};pi.createPrototypeObject(mi,pi.objectInherit(pi.NodeVisitor.prototype,{getPathList:function(){return this._paths},getStateSetMap:function(){return this._stateSetMap},getStateSetMapNodes:function(){return this._stateSetMapNodes},getStateSetPathList:function(){return this._pathsStateSet},getWireframePathList:function(){return this._wireframePaths},getNoGeometryPathList:function(){return this._noGeometryPaths},apply:function(e){var t=e.getStateSet();if(t){var i=t._uniqueID;this._stateSetMap[i]||(this._stateSetMap[i]=t,this._stateSetMapNodes[i]=[]),this._stateSetMapNodes[i].push(e),this._currentStateSet.push(t)}e instanceof pi.Geometry?e.userDataMap&&e.userDataMap.wireframe?this._wireframePaths.push(this.nodePath.slice(0)):(this._pathsStateSet.push(this._currentStateSet.slice(0)),this._paths.push(this.nodePath.slice(0))):(this.traverse(e),0===e.getChildren().length&&this._noGeometryPaths.push(this.nodePath.slice(0))),t&&this._currentStateSet.pop()}}));const _i=mi;var vi=i("OBBi"),Ci=i("3o3Y"),bi=i("U4yk"),Si=i("AhvN"),Ei=i("sFNe"),yi=A.Z.osg,Ii=A.Z.osgAnimation,xi=function(){yi.NodeVisitor.call(this),this._stats={nodeCount:0,matrixTransformCount:0,geometryCount:0,boneCount:0,skeletonCount:0,morphGeometryCount:0,rigGeometryCount:0}},Ti=new Ct.Z;xi.stats=window.sketchfabViewerStats={promiseReady:Ti.promise,materialCountBefore:0,materialCountAfter:0,nodeCountBefore:0,nodeCountAfter:0,matrixTransformCountBefore:0,matrixTransformCountAfter:0,geometryCountBefore:0,geometryCountAfter:0,boneCountBefore:0,boneCountAfter:0,skeletonCountBefore:0,skeletonCountAfter:0,morphGeometryCountBefore:0,morphGeometryCountAfter:0,rigGeometryCountBefore:0,rigGeometryCountAfter:0},xi.registerStats=function(e,t){var i=new xi;e.accept(i);var n=i.getStats(),r=xi.stats;r["nodeCount"+t]=n.nodeCount,r["matrixTransformCount"+t]=n.matrixTransformCount,r["geometryCount"+t]=n.geometryCount,r["boneCount"+t]=n.boneCount,r["skeletonCount"+t]=n.skeletonCount,r["morphGeometryCount"+t]=n.morphGeometryCount,r["rigGeometryCount"+t]=n.rigGeometryCount};var wi=function(e){for(var t=["geometry","rigGeometry","morphGeometry"],i=0,n=0;n<t.length;++n)i+=xi.stats[t[n]+e];return i};xi.computeStats=function(e){if(!(0,ot.Z)()&&!window.RunningTests){var t=xi.stats;if((0,l.Z)().graphOptimizer){var i=wi("CountBefore"),n=wi("CountAfter");Ei.Z.logMessage("Geometry count : before "+i+", after "+n)}if((0,l.Z)().mergeMaterials){var r="Material count : before ";r+=t.materialCountBefore,r+=", after ",r+=t.materialCountAfter,Ei.Z.logMessage(r)}var a=e.getFeatures(),o=a.animation.getModel(),s=a.environment.getModel(),u=a.lighting.getModel(),h=o.getEnabledAnimationsCount(),c=0,A=0,d=0;if(Ci.Z.get("mask")&Ci.Z.LIT){for(var g=u.get("lights"),f=0,p=g.length;f<p;++f){var m=g[f];m&&m.get("enable")&&"NONE"!==m.get("type")&&(d++,m.isCastingShadows()&&(A++,(h||m.isAttachedToCamera())&&c++))}s.get("enable")&&(d++,s.get("shadowEnable")&&(d++,A++,h&&c++)),t.pbr=Ci.Z.get("mask")&Ci.Z.PBR?1:0}t.lights=d,t.shadows=A,t.realTimeShadows=c,t.vertexCount=e._currentScene._dataScene.vertexCount;var _=t.materialCountAfter/10;_*=d>0&&t.pbr?t.lights+t.shadows:1,_*=t.transparent?4:1;var v=0;v+=t.boneCountAfter/35,v+=t.morphGeometryCountAfter/2,v+=t.geometryCountAfter/5,v+=t.vertexCount/15e4,v+=t.matrixTransformCountAfter/50,v+=t.nodeCountAfter/100;var C=_+(v*=t.realTimeShadows>0?t.realTimeShadows+1:1);t.complexity=C,t.shadingComplexity=_,t.meshComplexity=v,Ti.resolve(t)}};var Mi=yi.Node.typeID,Ri=yi.MatrixTransform.typeID,Bi=Ii.Bone.typeID,Ni=Ii.Skeleton.typeID,Di=yi.Geometry.typeID,Pi=Ii.MorphGeometry.typeID,Fi=Ii.RigGeometry.typeID;yi.createPrototypeObject(xi,yi.objectInherit(yi.NodeVisitor.prototype,{getStats:function(){return this._stats},apply:function(e){var t=this._stats,i=e.typeID;e.userDataMap&&e.userDataMap.wireframe||(i===Mi?t.nodeCount++:i===Ri?t.matrixTransformCount++:i===Di?t.geometryCount++:i===Bi?t.boneCount++:i===Ni?t.skeletonCount++:i===Pi?t.morphGeometryCount++:i===Fi?(t.rigGeometryCount++,e.getSourceGeometry().typeID===Pi&&t.morphGeometryCount++):console.error("Unknown node type ID : "+i+" "+e.className()),this.traverse(e))}}));const Oi=xi;var Li=A.Z.osg,ki=Li.WebGLCaps.instance().getWebGLExtension("OES_element_index_uint")?4294967296:65535,Zi={splitLimit:Math.min((0,l.Z)().splitLimit,ki),limitMergePerMaterial:100,canMergeGeometry:!0,isWireframe:!1,bakedGeometriesFromID:{},hasTransparency:!0,multiParentPathFromGeometryID:{},protectedGeometries:{}},Ui={};Ui[Li.primitiveSet.POINTS]=!0,Ui[Li.primitiveSet.LINES]=!0,Ui[Li.primitiveSet.TRIANGLES]=!0;var Vi={};Vi[Li.primitiveSet.POINTS]=!0,Vi[Li.primitiveSet.LINES]=!0,Vi[Li.primitiveSet.TRIANGLES]=!0,Vi[Li.primitiveSet.TRIANGLE_STRIP]=!0;var Qi={Vertex:1,Normal:1,Tangent:1},Gi=function(e){var t=e.getStateSet();return t&&t.getAttribute("SketchfabMaterial")?t:void 0},Hi=function(e,t){var i=e[e.length-1].getVertexAttributeList().Vertex;return t[t.length-1].getVertexAttributeList().Vertex.getElements().length-i.getElements().length},zi=function(e){return e.getVertexAttributeList().Vertex.getElements().length/3},Wi=function(e){return e[e.length-1].getVertexAttributeList().Vertex.getElements().length/3},ji=function(e){var t=e[e.length-1].getInstanceID(),i=Zi.multiParentPathFromGeometryID;return Boolean(i[t])},qi=function(e,t){t.xmin<e.xmin&&(e.xmin=t.xmin),t.ymin<e.ymin&&(e.ymin=t.ymin),t.zmin<e.zmin&&(e.zmin=t.zmin),t.xmax>e.xmax&&(e.xmax=t.xmax),t.ymax>e.ymax&&(e.ymax=t.ymax),t.zmax>e.zmax&&(e.zmax=t.zmax)},Ji=function(e,t){var i=Math.min(e.xmax-e.xmin,t.xmax-t.xmin),n=Math.min(e.ymax-e.ymin,t.ymax-t.ymin),r=Math.min(e.zmax-e.zmin,t.zmax-t.zmin);return qi(e,t),i=0===i?0:(e.xmax-e.xmin)/i,n=0===n?0:(e.ymax-e.ymin)/n,r=0===r?0:(e.zmax-e.zmin)/r,Math.max(i,n,r)>(0,l.Z)().zratio},Yi=function(e,t,i){if(!t._FQU){var n=e.getElements().length,r=Math.min(n,t.getElements().length-i);t._boxTest||(t._boxTest=t.computeMinMaxVertex({},0,i));var a=t.computeMinMaxVertex({},i,r);t._FQU=Ji(t._boxTest,a)}},Ki=function(e,t,i){var n=e.getElements(),r=t.getElements(),a=e.getItemSize(),o=t.getItemSize();if(a!==o)for(var s=r.length/o,l=0;l<s;++l){var u=l*a,h=l*o;n[i+u]=r[h],n[i+u+1]=r[h+1],n[i+u+2]=r[h+2]}else n.set(r,i)},Xi=function(e,t,i){var n=t.getVertexAttributeList().Vertex,r=e.getVertexAttributeList().Vertex.getElements(),a=n.getElements();n.setElements(r.subarray(i,i+a.length)),e._boundingBox.copy(t.getBoundingBox()),e._boundingBoxComputed=!0;var o=t.getBoundingSphere(),s=e._boundingSphere;s.set(Li.vec3.copy(s.center(),o.center()),o.radius()),e._boundingSphereComputed=!0,n.setElements(a),t.dirtyBound()},$i=function(e,t,i,n){var r=Zi.bakedGeometriesFromID[t.getInstanceID()];if(r||(Zi.bakedGeometriesFromID[i.getInstanceID()]=!0),r||function(e){return 9===e.length?Li.mat3.equals(Li.mat3.IDENTITY,e):Li.mat4.equals(Li.mat4.IDENTITY,e)}(e))i!==t&&Ki(i,t,n||0);else{var a=i.getElements();n&&(a=a.subarray(n));for(var o=t.getElements(),s=9===e.length?Li.vec3.transformMat3:Li.vec3.transformMat4,l=t.getItemSize(),u=Li.vec3.create(),h=Math.min(o.length,a.length),c=0;c<h;c+=l)u[0]=o[c],u[1]=o[c+1],u[2]=o[c+2],s(u,u,e),a[c]=u[0],a[c+1]=u[1],a[c+2]=u[2],4===l&&(a[c+3]=o[c+3])}},en=function(e,t,i,n){var r=i.getIndices().getElements(),a=i.getCount(),o=0,s=i.getMode(),l=e[s].primitive,u=l.getIndices().getElements(),h=l.getCount(),c=Vi[s]&&Zi.canMergeGeometry,A=h;if(s===Li.primitiveSet.TRIANGLE_STRIP&&c){var d=h>0,g=d?u[h-1]:void 0,f=r[0]+n,p=d&&g!==f?2:0;p&&(u[h]=g,u[h+1]=f);var m=h%2;m&&(u[h+p]=f),A+=p+m}u.set(r,A),l.setCount(A+a);var _=A+a;for(o=A;o<_;++o)u[o]+=n;c||(i.setIndices(l.getIndices()),i.setCount(a),i.setFirst(A*u.BYTES_PER_ELEMENT),Zi.canMergeGeometry&&t.push(i))},tn=function(e,t,i,n){for(var r=i.length,a=Zi.canMergeGeometry,o=e.DrawElements,s=e.DrawArrays,l=0;l<r;++l){var u=i[l],h=u.getMode();if(u instanceof Li.DrawElements)en(o,t,u,n);else if(u instanceof Li.DrawArrays){var c=s[h];if(a)if(c&&c.primitive.count===n&&0===u.getFirst())c.primitive.count+=u.getCount();else{var A=u.getFirst()+n;t.push(new Li.DrawArrays(h,A,u.getCount()))}else u.first+=n}else if(u instanceof Li.DrawArrayLengths)if(a){var d=u.getFirst()+n,g=u.getArrayLengths().slice();t.push(new Li.DrawArrayLengths(h,d,g))}else u.first+=n}},nn=function(e,t){var i=e.getElements(),n=i.BYTES_PER_ELEMENT;e.setNormalize(4!==n);var r=1;1===n?r=255:2===n&&(r=65535);for(var a=i.length,o=t*e.getItemSize();o<a;++o)i[o]=r},rn=function(e,t){var i=new Li.Geometry;return i.setName(t.getName()),function(e,t,i){if(ji(e))for(var n=0,r=i.length;n<r;++n){var a,o=i[n],s=o.getMode(),l=o.getFirst();if(o instanceof Li.DrawElements){var u=o.getIndices(),h=u.getElements(),c=new h.constructor(h),A=u.getItemSize(),d=new Li.BufferArray(Li.BufferArray.ELEMENT_ARRAY_BUFFER,c,A);a=new Li.DrawElements(s,d)}else o instanceof Li.DrawArrays?a=new Li.DrawArrays(s,l,o.getCount()):o instanceof Li.DrawArrayLengths&&(a=new Li.DrawArrayLengths(s,l,o.getArrayLengths().slice()));t.push(a)}else Array.prototype.push.apply(t,i)}(e,i.getPrimitiveSetList(),t.getPrimitiveSetList()),i},an=function(e,t,i){var n=t[t.length-1],r=e.getVertexAttributeList(),a=n.getVertexAttributeList(),o=Li.computeLocalToWorld(t),s=Li.mat3.create();for(var l in Li.mat3.normalFromMat4(s,o),a){var u=r[l],h=a[l],c=i*u.getItemSize();if(Qi[l])$i("Vertex"===l?o:s,h,u,c),"Vertex"===l&&Yi(h,u,c);else Ki(u,h,c)}},on=function(e,t,i){for(var n in t)if(!e[n]){var r=t[n].getItemSize(),a="Color"===n,o=new(a?t[n].getElements().constructor:Float32Array)(i*r),s=new Li.BufferArray(Li.BufferArray.ARRAY_BUFFER,o,r);e[n]=s,a&&nn(s,0)}},sn=function(e,t,i,n){for(var r=t.DrawElements,a=t.DrawArrays,o=Zi.canMergeGeometry,s=0,l=i.length;s<l;++s){var u=i[s],h=u.getMode();if(u instanceof Li.DrawElements){var c=r[h];if(!c){var A=u.getIndices().getItemSize(),d=new Li.BufferArray(Li.BufferArray.ELEMENT_ARRAY_BUFFER,new Uint16Array,A);c=r[h]={primitive:new Li.DrawElements(h,d),lastElement:-1,initCount:0},o&&e.push(c.primitive)}var g=c.primitive;if(h===Li.primitiveSet.TRIANGLE_STRIP&&Vi[h]&&o){var f=u.getIndices().getElements(),p=f[0]+n,m=c.lastElement!==p&&0!==g.getCount()?2:0,_=g.getCount()%2;g.setCount(g.getCount()+u.getCount()+m+_),c.lastElement=f[f.length-1]+n}else g.setCount(g.getCount()+u.getCount())}else u instanceof Li.DrawArrays&&Ui[h]&&o&&(a[h]||(a[h]={primitive:new Li.DrawArrays(h,0,0),initCount:0},e.push(a[h].primitive)))}},ln=function(e,t,i,n){for(var r=e.getVertexAttributeList(),a=e.getPrimitiveSetList(),o=zi(e),s=n,l=0,u=t.length;l<u;++l){var h=t[l],c=h[h.length-1];on(r,c.getVertexAttributeList(),o),sn(a,i,c.getPrimitiveSetList(),s),s+=Wi(h)}!function(e,t){for(var i in e){var n=e[i].primitive,r=n.getIndices(),a=r.getElements(),o=t>=65535?Uint32Array:Uint16Array;r.setElements(new o(n.getCount())),r.getElements().set(a),n.setIndices(r),n.setCount(a.length)}}(i.DrawElements,o)},un=function(e,t){var i=e.pathList,n=i.pop(),r=zi(n[n.length-1]),a=function(e,t,i){var n=e[e.length-1],r=rn(e,n),a=Li.computeLocalToWorld(e),o=Li.mat3.create();Li.mat3.normalFromMat4(o,a);var s=function(e,t){var i=t.getVertexAttributeList().Color;if(i&&4===i.getItemSize())return 4;for(var n=0,r=e.length;n<r;++n){var a=e[n],o=a[a.length-1].getVertexAttributeList().Color;if(o&&4===o.getItemSize())return 4}return 3}(i,n),l=t!==zi(n),u=ji(e),h=r.getVertexAttributeList(),c=n.getVertexAttributeList();for(var A in c){var d,g=c[A],f=Qi[A],p="Color"===A,m=p?s:g.getItemSize();if(l?d=new(p?g.getElements().constructor:Float32Array)(t*m):f&&u?d=new Float32Array(g.getElements().length):h[A]=g,d){var _=new Li.BufferArray(Li.BufferArray.ARRAY_BUFFER,d,m);p&&nn(_,g.getElements().length/g.getItemSize()),h[A]=_,f||Ki(_,g,0)}f&&$i("Vertex"===A?a:o,g,h[A],0)}return Zi.canMergeGeometry||Xi(r,n,0),r}(n,e.nbVertex,i);if(t.addChild(a),0!==i.length){var o=a.getPrimitiveSetList(),s=function(e){for(var t={DrawElements:{},DrawArrays:{}},i=Zi.canMergeGeometry,n=0,r=e.length;n<r;++n){var a=e[n],o=a.getMode();if(a instanceof Li.DrawElements){var s=a.getIndices().getElements();t.DrawElements[o]={primitive:a,lastElement:s[s.length-1],initCount:a.getCount()}}else a instanceof Li.DrawArrays&&Ui[o]&&i&&(t.DrawArrays[o]={primitive:a,first:a.getFirst(),initCount:a.getCount()})}return t}(o);ln(a,i,s,r);for(var l=Zi.canMergeGeometry,u=0,h=i.length;u<h;++u){var c=i[u];an(a,c,r);var A=c[c.length-1];if(!l||ji(c)){var d=rn(c,A);l||(d._attributes=a.getVertexAttributeList(),t.addChild(d),Xi(d,A,3*r)),A=d}var g=A.getPrimitiveSetList();tn(s,o,g,r),r+=Wi(c)}!function(e){var t=e.DrawElements,i=Zi.canMergeGeometry;for(var n in t){var r=t[n];i&&Vi[n]||r.primitive.setCount(r.initCount)}}(s)}},hn=function(e){var t=e.localRoot;e.renderPathList.sort(Hi);for(var i=function(e){for(var t=[{nbVertex:Wi(e[0]),pathList:[e[0]]}],i=e.length,n=1;n<i;++n){for(var r=e[n],a=t[t.length-1],o=Wi(r),s=!1,l=r[r.length-1]._primitives,u=0;u<l.length;u++)if(l[u].getMode()===Li.primitiveSet.TRIANGLES&&l[u].getCount()%3!=0){console.error("incorrect number ("+l[u].getCount()+") in Triangles IndexBuffer"),s=!0;break}s||(o+a.nbVertex>=Zi.splitLimit?t.push({nbVertex:o,pathList:[r]}):(a.nbVertex+=o,a.pathList.push(r)))}return t}(e.renderPathList),n=i.length,r=0;r<n;++r)un(i[r],t)},cn=function(e,t){for(var i=e.getAttribute("SketchfabMaterial").getMaterialModel(),n=i.get(Zi.isWireframe?"wireframeList":"geometryList"),r=Zi.protectedGeometries,a=[],o=0,s=n.length;o<s;++o){var l=n[o];r[l.getInstanceID()]&&a.push(l)}n.length=0,Array.prototype.push.apply(n,a),Array.prototype.push.apply(n,t.getChildren()),Zi.isWireframe&&i.getChannels().Displacement.updateGeometryOffsets(),function(e){if(!Zi.isWireframe)for(var t={xmin:1/0,ymin:1/0,zmin:1/0,xmax:-1/0,ymax:-1/0,zmax:-1/0},i=Zi.bakedGeometriesFromID,n={},r=0,a=e.length;r<a;++r){var o=e[r].getVertexAttributeList().Vertex;i[o.getInstanceID()]&&(o._minMax||(o._minMax=t,o.computeMinMaxVertex(n),t.xmin===1/0||t._FQU||o._FQU?(o._FQU&&(t._FQU=!0),qi(t,n)):t._FQU=Ji(t,n)))}}(n)},An=function(e){var t=e.localRoot,i=t.getStateSet(),n=i&&i.getBinNumber()===Me.Z.TRANSPARENT;n&&(Zi.hasTransparency=!0),Zi.canMergeGeometry=!n,e.renderPathList.length>Zi.limitMergePerMaterial&&(Zi.canMergeGeometry=!0),hn(e),cn(i,t)},dn=function(e,t,i){var n=function(e,t){for(var i=t||0,n=e.length-1;n>=i;--n){var r=Gi(e[n]);if(r)return r}}(e),r=n.getInstanceID(),a=t[r];a||(t[r]=a={localRoot:new Li.Node,renderPathList:[]},a.localRoot.setStateSet(n),a.localRoot.setName(n.getName()),i.addChild(a.localRoot)),a.renderPathList.push(e),e[0]===i&&e.shift()};Zi.optimizePaths=function(e,t,i){Zi.isWireframe=!!i;for(var n={},r=t.length,a=0;a<r;++a)dn(t[a],n,e);for(var o in n)An(n[o])},Zi.optimizeWireframe=function(e,t,i){var n=e.getChildren(),r=n.length;Zi.optimizePaths(e,t,!0);for(var a=n.length,o=r;o<a;++o)i.push(n[o])};const gn=Zi;var fn,pn,mn,_n=A.Z.osg,vn=A.Z.osgAnimation,Cn={},bn=function(e){var t=e.getStateSet();return t&&t.getAttribute("SketchfabMaterial")?t:void 0},Sn=function(e,t){for(var i=t||0,n=e.length-1;n>=i;--n){var r=bn(e[n]);if(r)return r}},En=function(e){for(var t=0,i=e.length;t<i;++t)e[t].removeChildren()},yn=function(e){for(var t=0,i=e.length-1;t<i;++t)e[t].addChild(e[t+1])},In=function(e){for(var t=e.length,i=0;i<t;++i)En(e[i])},xn=function(e){for(var t=!1,i=Cn,n=0,r=e.length;n<r;++n){var a,o=e[n],s=!1;if(o instanceof vn.Bone)a=vn.UpdateBone;else{if(!(o instanceof _n.MatrixTransform))continue;a=vn.UpdateMatrixTransform,s=!0}for(var l=o.getUpdateCallbackList(),u=l.length-1;u>=0;--u){var h=l[u];h instanceof a!=!1&&(i[h.getName()]||!s?t=!0:(h.update(o),o.removeUpdateCallback(h)))}}var c=e[e.length-1];return t||c instanceof vn.RigGeometry||c instanceof vn.MorphGeometry},Tn=(fn=[],function(e){return fn[0]=e,xn(fn)});A.Z.osgDB.Input.prototype.getJSON=function(){return mn=this,this._json.Animations&&(pn=this._json),this._json};var wn=function(e,t,i){for(var n=t.length-1;n>=0;--n){var r=t[n],a=r.length,o=r[a-1],s=o._uniqueID;if(o.getVertexAttributeList&&(s=o.getVertexAttributeList().Vertex.getInstanceID()),e[o._uniqueID]||e[s])e[s]=!0,i.push(r),t.splice(n,1);else if(o instanceof _n.Geometry||o instanceof vn.Bone)xn(r)&&(i.push(r),t.splice(n,1));else{for(var l=a-2;l>=0;--l)if(r[l]instanceof vn.Bone){i.push(r);break}t.splice(n,1)}}},Mn=function(e){for(var t=gn.protectedGeometries,i=0,n=e.length;i<n;++i){var r=e[i],a=r[r.length-1];a instanceof _n.Geometry&&(t[a.getInstanceID()]=!0)}},Rn=function(e){for(var t=gn.multiParentPathFromGeometryID,i=0,n=e.length;i<n;++i){for(var r=e[i],a=!1,o=0,s=r.length;o<s;++o)if(r[o].getParents().length>1){a=!0;break}t[r[r.length-1].getInstanceID()]=a}},Bn=function(e,t){var i=e.length;if(0!==i)for(var n=e[0].indexOf(t),r=t.getStateSet()?0:1,a=0;a<i;++a){e[a].splice(0,n+r)}},Nn=function(e){for(var t=e.getUpdateCallbackList(),i=0,n=t.length;i<n;++i){var r=t[i];if(r instanceof vn.BasicAnimationManager)return e.removeUpdateCallback(r),r}},Dn=function(e,t){!function(e){var t,i=e.getFeatures().material.getModel().attributes,n={},r=vi.Z.length;for(var a in i){var o=i[a];if(!o.get("uidUniqueMerged")){var s=o.get("texCoordUnitList");s.length=0;var l=o.getChannels();for(t=0;t<r;++t){var u=vi.Z[t],h=l[u];if(h.isEnableEffective()&&h.getTextureModel()&&"Matcap"!==u){var c=h.getTexCoordUnit();-1===s.indexOf(c)&&s.push(c)}}var A=o.get("geometryList"),d=A.length;for(t=0;t<d;++t){var g=A[t],f=n[g.getInstanceID()];if(f)for(var p=s.length,m=0;m<p;++m)-1===f.uvList.indexOf(s[m])&&f.uvList.push(s[m]);else n[g.getInstanceID()]={geometry:g,uvList:s.slice()}}}}for(var _ in n){var v=n[_],C=v.uvList,b=v.geometry.getVertexAttributeList();for(var S in b)-1!==S.indexOf("TexCoord")&&-1===C.indexOf(parseInt(S.substring(8)))&&delete b[S]}}(t);var i=t.getOrCreateScene().getWireframeNodes();i.length=0;var n=[],r=[],a=e.getPathList(),o=e.getWireframePathList();!function(e){var t=Cn;if(!pn||!pn.Animations||F.Z.OSG_VERSION<8)return t;for(var i=e.getFeatures().animation.getModel(),n=pn.Animations,r=0,a=n.length;r<a;++r){var o=n[r]["osgAnimation.Animation"],s=mn.setJSON(o.UserDataContainer).readUserDataContainer(),l=d.Z.convertUserDataToObject(s);if(i.getAnimationByUID(l.AnimationUID))for(var u=o.Channels,h=0,c=u.length;h<c;++h){var A=u[h];t[A[Object.keys(A)[0]].TargetName]=1}}}(t);var s=function(e){for(var t,i,n=e.getPathList(),r=n[0][0],a=r,o=[];;){t=bn(a)||t,i=i||Nn(a);var s=a.getChildren();if(1!==s.length)break;if(s[0]instanceof vn.Skeleton)break;if(s[0]instanceof _n.Geometry)break;if(Tn(a))break;o.push(a),a=s[0]}if(r.removeChildren(),i&&r.addUpdateCallback(i),r===a)return a;for(var l=a.getParents(),u=0,h=l.length;u<h;++u)l[u].removeChild(a);r.setStateSet(void 0),a.setStateSet(t);var c=_n.computeLocalToWorld(o);if(_n.mat4.equals(_n.mat4.IDENTITY,c))r.addChild(a);else{var A=new _n.MatrixTransform;A.setName("Optim - RootMatrix"),_n.mat4.copy(A.getMatrix(),c),r.addChild(A),A.addChild(a)}return Bn(n,a),Bn(e.getWireframePathList(),a),Bn(e.getNoGeometryPathList(),a),a}(e);if(function(e){Rn(e.getPathList()),Rn(e.getNoGeometryPathList()),Rn(e.getWireframePathList())}(e),s.removeChildren(),function(e){In(e.getPathList()),In(e.getNoGeometryPathList()),In(e.getWireframePathList())}(e),function(e,t,i,n){var r=function(e){var t=e.getFeatures(),i=t.hotspot.getModel().get("hotspots"),n=i.length,r={},a=0;for(a=0;a<n;++a){var o=i.at(a).get("geometryUid");o>=0&&(r[o]=!0)}var s=t.sound.getModel().get("soundtracks"),l=s.length;for(a=0;a<l;++a){var u=s.at(a).get("geometryUid");u>=0&&(r[u]=!0)}return r}(e);wn(r,t.getPathList(),i),wn(r,t.getNoGeometryPathList(),i),wn(r,t.getWireframePathList(),n),Mn(i),Mn(n)}(t,e,n,r),gn.optimizePaths(s,a),function(e,t,i,n){var r=0,a=e.length,o=i.length,s=!1;for(r=a-1;r>=0;--r){var l=e[r];yn(l);var u=l[0]===t;Sn(l,u?1:0)||(s=!0),u||t.addChild(l[0])}for(r=o-1;r>=0;--r){var h=i[r];yn(h),n.push(h[h.length-1]),h[0]!==t&&t.addChild(h[0])}s||t.setStateSet(void 0)}(n,s,r,i),o.length>0){var l=i.slice(0);F.Z.getWireframe().then((function(){for(var e=i.length=l.length,t=0;t<e;++t)i[t]=l[t];_n.time("optimizer - wireframe"),gn.optimizeWireframe(s,o,i),_n.timeEnd("optimizer - wireframe"),F.Z.resolveWireframeOptimized()}))}else F.Z.getWireframe().then((function(){F.Z.resolveWireframeOptimized()}))},Pn=function(e,t){for(var i=t.length,n=0;n<i;++n)-1===e.indexOf(t[n])&&e.push(t[n]);t.length=0},Fn={};Fn.reports=Oi.stats,Fn.optimize=function(e,t){(0,l.Z)().graphOptimizer||F.Z.getWireframe().then(F.Z.resolveWireframeOptimized);var i=t.getRootModel();(0,l.Z)().graphOptimizer||(0,l.Z)().mergeMaterials?(_n.time("optimizer"),Oi.registerStats(i,"Before"),(0,l.Z)().mergeMaterials&&(_n.time("optimizer - materials"),function(e){var t=e.getFeatures().material.getModel().attributes,i={},n={},r=vi.Z.length,a=0;for(var o in t){var s=t[o],l=s.get("stateSet");if(!l)return;var u=s.getChannels(),h=Ci.Z.get("mask"),c=[];c.push(s.get("cullFace")?1:0),c.push(s.hasOnlyPoints()?1:0),h&Ci.Z.LIT&&c.push(s.get("shadeless")?1:0),h===Ci.Z.CLASSIC_LIT&&c.push(s.get("reflection")),h!==Ci.Z.MATCAP&&c.push(s.get("hasVertexColor")?1:0),(u.Opacity.isEffective()||u.AlphaMask.isEffective())&&c.push(s.get("hasVertexAlpha")?1:0);for(var A=0;A<r;++A){var d=vi.Z[A],g=u[d];if(g.isEnableEffective()){var f=g.isEffective()?JSON.stringify(g.getJSON()):g.getFactor();c.push(d+f)}}var p=i[c=c.join(" / ")];if(p){n[l.getInstanceID()]=p.get("stateSet"),a++,p.get("uidListUnusedDuplicates").push(s.get("id")),s.set("uidUniqueMerged",p.get("id"));var m=s.get("stateSetWireframe");if(m){var _=p.get("stateSetWireframe");n[m.getInstanceID()]=_}Pn(p.get("geometryList"),s.get("geometryList")),Pn(p.get("wireframeList"),s.get("wireframeList")),s.get("texCoordUnitList").length=0}else i[c]=s}var v=Object.keys(n).length,C=Object.keys(t).length;if(Oi.stats.materialCountBefore=C,Oi.stats.materialCountAfter=C-a,0!==v){var b=function(){_n.NodeVisitor.call(this)};_n.createPrototypeObject(b,_n.objectInherit(_n.NodeVisitor.prototype,{apply:function(e){var t=e.getStateSet();if(t){var i=n[t.getInstanceID()];i&&e.setStateSet(i)}this.traverse(e)}}));var S=e.getRootModel(),E=new b;E.setNodeMaskOverride(-1),S.accept(E)}}(t),_n.timeEnd("optimizer - materials")),(0,l.Z)().graphOptimizer&&(_n.time("optimizer - nodes"),Dn(e,t),_n.timeEnd("optimizer - nodes"),Oi.stats.transparent=gn.hasTransparency),Oi.registerStats(i,"After"),Oi.computeStats(t),_n.timeEnd("optimizer")):Oi.registerStats(i,"Stats")};const On=Fn;var Ln=i("ydx7"),kn=new Ln.Z({hasTransparency:!1,hasScattering:!1,hasRefraction:!1,hasExtra:!1,protectDepthAndColorUnit:!1}),Zn=function(e,t,i){var n=t.getInstanceID();!!e.activeStateSets[n]!==i&&(e.activeStateSets[n]=i,e.count+=i?1:-1,kn.set(e.modelkey,e.count>0))};kn.registerStateSetIsTransparent=Zn.bind(Zn,{modelkey:"hasTransparency",activeStateSets:{},count:0}),kn.registerStateSetIsScattering=Zn.bind(Zn,{modelkey:"hasScattering",activeStateSets:{},count:0}),kn.registerStateSetIsRefraction=Zn.bind(Zn,{modelkey:"hasRefraction",activeStateSets:{},count:0});var Un=!1,Vn=!1,Qn=!1,Gn=!1,Hn=!1,zn=!1,Wn=function(){kn.set("hasExtra",Hn||Gn||Un||Vn||Qn||zn||(0,l.Z)().debug3D||(0,o.Z)()||!(0,l.Z)().vrStereo)};kn.setHotspot=function(e){Vn=e,Wn()},kn.setWireframe=function(e){Un=e,Wn()},kn.setGizmo=function(e){Qn=e,Wn()},kn.setDebugNormal=function(e){Gn=e,Wn()},kn.setOutline=function(e){zn=e,Wn()},kn.setDebugSkeleton=function(e){Hn=e,Wn()},Wn();const jn=kn;var qn=A.Z.osg;const Jn=O.Z.extend({getName:function(){return"MaterialManagerView3D"},initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this.model.bind("change",this.render,this),Ci.Z.bind("change:mask",this.cleanAndApplyMaterials,this),this._sceneLights=[],this._defaultStateSet=void 0,this._defaultMaterial=void 0,this._tracePathVisitor=new _i,this.model.setImageCollection(this.getTextureCollection()),this.model.setMatcapCollection(this.getMatcapCollection()),this.init()},init:function(){this._context=this.options.context,this._viewer=this._context.getViewer();var e=this._context.getScene();this._resourceDefer=new Ct.Z,e.addResourcePromise(this._resourceDefer),F.Z.getPolygon().then(this.initSceneGraph.bind(this))},getTextureCollection:function(){return this.getResourceManager().getTextureCollection()},getMatcapCollection:function(){return this.getResourceManager().getMatcapCollection()},getResourceManager:function(){return this._resourceManager||s.Z.instance},getOrCreateDefaultStateSet:function(){return void 0===this._defaultStateSet&&(this._defaultStateSet=new qn.StateSet,this._defaultStateSet._uniqueID=0),this._defaultStateSet},setDefaultMaterial:function(e,t){var i=this.getOrCreateDefaultStateSet();if(e.setStateSet(i),!this._defaultMaterial){if(this._defaultMaterial=t.getMaterialByStateSet(i),this._defaultMaterial){var n=i.getAttributeMap().Material,r=t.getUniqueMaterialName(n,i,e);this._defaultMaterial.set("name",r)}else this._defaultMaterial=t.createMaterial(e,i);this._defaultMaterial.setStateSet(i)}},addDefaultMaterial:function(e,t,i){0===e.getMaterials().length&&this.setDefaultMaterial(t,i);for(var n=this._tracePathVisitor.getPathList(),r=0,a=n.length;r<a;++r){for(var o=n[r],s=o.length,l=!1,u=0;u<s;++u){var h=o[u].getStateSet();if(h&&h.getAttribute("SketchfabMaterial")){l=!0;break}}if(!l){var c=o[s-1];this.setDefaultMaterial(c,i)}}},_handleCullFace:function(e){var t=this._context.getModel().get("options"),i=e.userDataMap.sourceTool.toLowerCase(),n=(0,l.Z)().singleSided,r=-1!==i.indexOf("sketchup"),a=r&&t.version<6,o=r&&(0,di.Z)();if(void 0!==n||o||a){var s=!1===n?qn.CullFace.DISABLE:qn.CullFace.BACK,u=this.model.getMaterials();for(var h in u)u[h].set("cullFace",s)}},processSceneGraph:function(e,t){var i=new fi(t).apply(e);(e.accept(this._tracePathVisitor),this.deleteUnusedMaterials(this._tracePathVisitor),this.addDefaultMaterial(i,e,t),this._sceneLights=i.getLights(),this._handleCullFace(e),(0,di.Z)()&&"substancepainter"===e.userDataMap.source)&&this._viewer.getFeatures().shadingStyle.getModel().set("vertexColorEnable",!1);return i},getSceneLights:function(){return this._sceneLights},initSceneGraph:function(){var e=this.model,t=this._viewer.getRootModel(),i=this._viewer.getFeatures();if(qn.time("initSceneGraph - create saved materials"),!1===(0,l.Z)().processMaterial){var n=this._context.getModel().get("options").materials;for(var r in n)e.addMaterial(n[r])}qn.timeEnd("initSceneGraph - create saved materials"),qn.time("initSceneGraph - processSceneGraph");var a=this.processSceneGraph(t,e);qn.timeEnd("initSceneGraph - processSceneGraph"),qn.time("initSceneGraph - apply materials"),e.removeUnboundMaterial();var o=i.shadingStyle.getModel(),s=o.get("vertexColorEnable")&&o.get("vertexColorUseAlpha");e.tagMaterialWithGeometryInfo(t,s),this._requestTextures(),e._style=a.getStyle();var u=a.hasMetallicWorkflow();void 0!==u&&e.setWorkFlowMetalSpec(u,!1),e.overrideMaterialChannels((0,l.Z)()),e.enforceWorkflowPerMaterial(),e.updateTexCoordUnitList(),jn.set("protectDepthAndColorUnit",this._checkProtectDepthColor()),this.applyMaterials(),this.setWireframeStateSets(),qn.timeEnd("initSceneGraph - apply materials"),On.optimize(this._tracePathVisitor,this._viewer),i.quality&&i.quality.getModel().trigger("updateTexelPolicy"),F.Z.resolveMaterial(),Si.Z.packAllMaterialsTextures(e.getMaterials())},_checkProtectDepthColor:function(){if(window.RunningTests)return!1;if((0,o.Z)()||(0,l.Z)().materialShowcase||(0,l.Z)().apiVersion)return!0;if(this._viewer.getFeatures().postProcess.getModel().isEffectiveSsr())return!0;var e=this.model.getMaterials();for(var t in e){var i=e[t].getChannels().Opacity;if("refraction"===i.getTransparency()&&i.isEffective())return!0}return!1},setWireframeStateSets:function(){if(this._viewer.hasIntegratedWireframe()){var e=0,t=this.model,i={},n=this._tracePathVisitor.getPathList(),r=n.length;for(e=0;e<r;++e){var a=n[e],o=a[a.length-1];if(o instanceof qn.Geometry!=!1){var s=o.getVertexAttributeList().Vertex;s&&(i[s.getInstanceID()]=a)}}var l={},u=this._tracePathVisitor.getWireframePathList(),h=this._context.getScene().getWireframeNodes(),c=h.length;for(e=0;e<c;++e){var A=h[e],d=i[A.getVertexAttributeList().Vertex.getInstanceID()];if(d){var g=d[d.length-1],f=t.findFirstMaterial(d);f.get("wireframeList").push(A);var p=f.get("stateSet");A._attributes=g.getVertexAttributeList();var m=p.getAttribute("SketchfabMaterial"),_=m.getInstanceID(),v=l[_];v||((v=l[_]=new bi.Z)._textureAttributeArrayList=p._textureAttributeArrayList,v._activeTextureAttributeUnit=p._activeTextureAttributeUnit,v._activeTextureAttribute=p._activeTextureAttribute,v.setAttributeAndModes(m),m.getMaterialModel().set("stateSetWireframe",v)),A.setStateSet(v)}else{h.splice(e,1),e--,c--;for(var C=A.getParents(),b=0,S=C.length;b<S;++b)C[b].removeChild(A);for(var E=0;E<u.length;++E){var y=u[E];y[y.length-1]===A&&(u.splice(E,1),E--)}}}}},deleteUnusedMaterials:function(e){for(var t=e.getStateSetMapNodes(),i=e.getStateSetPathList(),n=e.getStateSetMap(),r={},a=0,o=i.length;a<o;a++){var s=i[a];if(s.length>0){var l=s.length-1;r[s[l]._uniqueID]=s[l]}}for(var u in t)if(void 0===r[u]){this.model.removeMaterialByStateSet(n[u]);for(var h=0,c=t[u].length;h<c;h++){t[u][h].setStateSet(void 0)}}},cleanAndApplyMaterials:function(){var e=this.model.getMaterials();for(var t in e){var i=e[t];i.get("stateSet")&&i.trigger("change:stateSet")}this.applyMaterials()},applyMaterials:function(){var e=this.model.getMaterials();for(var t in e){e[t].trigger("apply")}},_requestTexture:function(e,t,i){if(e){var n=e.getChannels()[t],r=n.getTextureModel();if(r&&n.isEffective()){var a=r.getMultiresTexture();if(a){if(0!==a.getImageCount())return(i?a.getImageSmallest():a.getImageMaxSupported()).promise;n.setColor&&n.setColor(qn.vec3.fromValues(.9,.9,.9))}}}},_requestAllTextures:function(e,t){for(var i=[],n=new window.Set,r=0;r<vi.Z.length;++r){var a=vi.Z[r];for(var o in e){var s=e[o],l=this._requestTexture(s,a,t);l&&!n.has(l)&&(n.add(l),i.push(l))}}return i},_resolvePromiseTextures:function(e,t,i){for(var n=(new Date).getTime()-t,r=0,a=0,o=e.length;a<o;++a)!0!==e[a]&&r++;(i?F.Z.resolveLowResLoaded:F.Z.resolveHighResLoaded)({time:r>0?n:0,count:r})},requestAllLowResTextures:function(e){return this._requestAllTextures(e,!0)},requestAllHighResTextures:function(e){for(var t=this._requestAllTextures(e,!1),i=0,n=0,r=t.length;n<r;n++)i+=t[n].progressSize;return F.Z.resolveDataSizeTextures(i),t},_resolvePromiseLowResTextures:function(e,t){return this._resolvePromiseTextures(e,t,!0)},_resolvePromiseHighResTextures:function(e,t){return this._resolvePromiseTextures(e,t,!1)},_startHighResAfterLowRes:function(e,t,i,n){var r=Date.now();this._resolvePromiseLowResTextures(e,t);var a=this.requestAllHighResTextures(n);this._viewer.setFakeProgress(a,!i,"texture");var o=this;c().all((0,vt.Z)(a,(function(e){return e.reflect()}))).then((function(){o._resolvePromiseHighResTextures(a,r),i&&o._resourceDefer.resolve()})),i||this._resourceDefer.resolve()},_requestTextures:function(){var e=(0,l.Z)().preload,t=this.model.toJSON();if(e)this._startHighResAfterLowRes(c().resolve(),Date.now(),e,t);else{var i=Date.now(),n=this.requestAllLowResTextures(t);this._viewer.setFakePrimaryProgress(n,"texture");var r=this;c().all((0,vt.Z)(n,(function(e){return e.reflect()}))).then((function(){r._startHighResAfterLowRes(n,i,e,t)}))}},_getUniqueTextures:function(){var e={},t=this.model.getMaterials(),i=[];for(var n in t)for(var r=t[n].get("stateSet"),a=r.getNumTextureAttributeLists(),o=0;o<a;++o){var s=r.getTextureAttribute(o,"Texture");s&&s.getChannelPacking&&(s.isTextureNull()||s.isColorAtlas()||e[s.getInstanceID()]||(e[s.getInstanceID()]=!0,i.push(s)))}return i},getOrCreateTexelInfos:function(){if(this._infoTex)return this._infoTex;for(var e=this._infoTex={missingTextures:{},gpuTextureCount:0,gpuPixelCount:0,min:1/0,max:-1/0},t={width:0,height:0,missingTextures:e.missingTextures},i=this._getUniqueTextures(),n=i.length,r=0;r<n;++r){t=i[r].getMaxTextureSizePacked(t),e.gpuTextureCount++,e.gpuPixelCount+=t.width*t.height;var a=Math.max(t.width,t.height);e.min=Math.min(a,e.min),e.max=Math.max(a,e.max)}return e}});var Yn=i("R4My"),Kn=i.n(Yn),Xn=i("N6Kc"),$n=i("0z3s"),er=i("dq/g"),tr=A.Z.osg,ir=function(e,t){return e-t},nr={Matcap:"Matcap",SubsurfaceScattering:"Subsurface scattering",SubsurfaceTranslucency:"Subsurface translucency",DiffuseColor:"Diffuse",DiffuseIntensity:"Lightmap",SpecularColor:"Specular Color",SpecularHardness:"Glossiness",Displacement:"Displacement",NormalMap:"Normal map",BumpMap:"Bump map",AlphaMask:"Alpha Mask",Opacity:"Opacity",EmitColor:"Emission",DiffusePBR:"Albedo",AlbedoPBR:"Base Color",SpecularPBR:"Specular",GlossinessPBR:"Glossiness",RoughnessPBR:"Roughness",MetalnessPBR:"Metalness",Sheen:"Sheen",SheenRoughness:"SheenRoughness",SpecularF0:"Specular F0",AOPBR:"Ambient Occlusion",CavityPBR:"Cavity",ClearCoat:"Clear Coat",ClearCoatRoughness:"Clear Coat roughness",ClearCoatNormalMap:"Clear Coat normap map",Anisotropy:"Anisotropy"};const rr=a.Z.extend({initDefaults:function(e){var t=e.channels;for(var i in delete e.channels,e.reflection=(0,di.Z)()?.1:.3,e.verison=3,a.Z.prototype.initDefaults.call(this,e),t.Inspector={factor:1,enable:!0,maskThreshold:0,invert:!1,color:tr.vec3.fromValues(1,1,1)},t){var n=t[i];switch(n.name=i,n.material=this,n.displayName=nr[i],i){case"DiffuseColor":n.color=(0,di.Z)()?tr.vec3.fromValues(1,1,1):tr.vec3.fromValues(.5,.5,.5);break;case"Opacity":n.useAlbedoTint=!(0,di.Z)(),n.thinLayer=!(0,di.Z)()}t[i]=new er.Z[i].model(n)}this.set("channels",t)},getModelOptionPath:function(){return"materials:0"},getName:function(){return this.get("name")},defaults:function(){return{geometryList:[],wireframeList:[],texCoordUnitList:[],vertexColorColorSpace:"srgb",vertexColorEnable:!1,vertexAlphaEnable:!1,hasVertexColor:!1,hasVertexAlpha:!1,hasTriangles:!1,hasPoints:!1,hasLines:!1,stateSet:void 0,stateSetWireframe:void 0,uidUniqueMerged:"",uidListUnusedDuplicates:[]}},setMaterial:function(e){this.set(e);var t=this.getChannels();for(var i in e.channels)t[i].set(e.channels[i])},setMaterialJSON:function(e,t,i){var n=i||{},r=e.channels;n.ignore=["channels"];var o=a.Z.prototype.setJSON.call(this,e,n);if(r){var s=this.getChannels();if(r.Opacity){var l=r.Opacity;"alphaMask"===l.type&&(r.AlphaMask={enable:l.enable,factor:l.factor,invert:l.invert,texture:l.texture},l.factor=1,l.type="alphaBlend",l.texture={},l.enable=!1)}for(var u=vi.Z.length,h=0;h<u;++h){var c=vi.Z[h],A=r[c];if(A){var d=s[c];if(d){var g=d.setChannelJSON(A,t,n);g.length&&o.concat(g)}}}return o}},getChannels:function(){return this.get("channels")},getStateSet:function(){return this.get("stateSet")},setStateSet:function(e){return this.set("stateSet",e),this},setChannelEnable:function(e,t){var i=this.get("channels");return i[e]?(i[e].setEnable(t),this):this},setChannelColor:function(e,t){var i=this.get("channels")[e];return i&&i.setColor?(i.setColor(t),this):this},setChannelTexture:function(e,t){var i=this.get("channels");return i[e]?(i[e].setTextureModel(t),this):this},setChannelFactor:function(e,t){var i=this.get("channels");return i[e]?(i[e].setFactor(t),this):this},getJSON:function(){var e=a.Z.prototype.getJSON.call(this,{ignore:["channels"]});e.version=3,e.channels={};var t=this.get("channels");for(var i in t)"Inspector"!==i&&(e.channels[i]=t[i].getJSON());return e},copyDualChannel:function(e,t){var i=this.getChannels(),n=i[e],r=i[t],a=r.getTextureModel(),o="MetalnessPBR"===e||"SpecularPBR"===e,s="NormalMap"===e||"BumpMap"===e;a?(a=a.clone(),(o||s)&&(a.setImageModel(a.getImageModel()),a.set("internalFormat","NormalMap"===e||"SpecularPBR"===e?tr.Texture.RGB:tr.Texture.LUMINANCE),a.updateMultiresTexture()),n.setTextureModel(a)):o||(n.setColor?r.getColor&&n.setColor(r.getColor()):n.setTextureModel(void 0)),s||n.setFactor(r.getFactor())},isWorkflowMetalness:function(){return this.getChannels().MetalnessPBR.getEnable()},setWorkFlowRoughGloss:function(e,t){var i=e?"GlossinessPBR":"RoughnessPBR",n=e?"RoughnessPBR":"GlossinessPBR",r=this.getChannels();r[i].setEnable(!1),r[n].setEnable(!0),t&&this.copyDualChannel(n,i,r)},setWorkFlowMetalSpec:function(e,t){var i=e?"DiffusePBR":"AlbedoPBR",n=e?"SpecularPBR":"MetalnessPBR",r=e?"AlbedoPBR":"DiffusePBR",a=e?"MetalnessPBR":"SpecularPBR",o=this.getChannels();o[i].setEnable(!1),o[n].setEnable(!1),o.SpecularF0.setEnable(e),o[r].setEnable(!0),o[a].setEnable(!0),t&&(this.copyDualChannel(r,i),this.copyDualChannel(a,n))},hasOnlyPoints:function(){return this.get("hasPoints")&&!this.get("hasTriangles")&&!this.get("hasLines")},updateTexCoordUnitList:function(){var e=this.get("texCoordUnitList");e.length=0;for(var t,i,n=this.get("geometryList"),r=n.length,a="TexCoord",o=[],s=[],l=0;l<r;++l){var u=n[l].getVertexAttributeList();for(var h in s.length=0,u)-1!==h.indexOf("TexCoord")&&s.push(parseInt(h.substring(8)));for(0===s.length&&this.set("missingUvs",!0),s.sort(ir),t=s.length-1;t>=0;--t){var c=s[t],A=u[a+c];for(i=0;i<t;++i){var d=s[i];if(A===u[a+d]){var g=o[c];void 0!==g&&g!==d?-1===e.indexOf(c)&&e.push(c):o[c]=d;break}}var f=s[i];-1===e.indexOf(f)&&e.push(f)}}if(e.sort(ir),0!==o.length){var p=e.length;for(t=0;t<p;++t)o[e[t]]=e[t];var m=this.getChannels(),_=vi.Z.length;for(t=0;t<_;++t){var v=m[vi.Z[t]];v.setTexCoordUnit(o[v.getTexCoordUnit()])}}},enforceWorkflow:function(){var e=this.getChannels(),t=e.MetalnessPBR.getEnable();e.AlbedoPBR.setEnable(t),e.SpecularF0.setEnable(t),e.DiffusePBR.setEnable(!t),e.SpecularPBR.setEnable(!t);var i=e.RoughnessPBR.getEnable();e.GlossinessPBR.setEnable(!i),e.BumpMap.getEnable()&&e.NormalMap.getEnable()&&e.BumpMap.setEnable(!1)}});var ar=i("iI+4"),or=A.Z.osg,sr={};sr[or.Texture.LUMINANCE]="r",sr[or.Texture.ALPHA]="a",sr[or.Texture.RGB]="rgb";var lr=function(e){or.Texture.call(this),this._texture=e,this._isColorAtlas=!1,this._channels=[],this._packedTextures={}},ur=function(e,t){var i=vi.Z.getDefaultComponentCount(e),n=vi.Z.getDefaultComponentCount(t);return n===i?e<t?1:-1:n-i};or.createPrototypeStateAttribute(lr,or.objectInherit(or.Texture.prototype,{attributeType:"Texture",invalidate:function(){this._isColorAtlas||(this._texture=void 0)},isColorAtlas:function(){return this._isColorAtlas},setIsColorAtlas:function(e){this._isColorAtlas=e},getChannelPacking:function(e){var t=this._packedTextures[e];return t?t.pack:""},getPackedTextures:function(){return this._packedTextures},getOrderedChannels:function(){return this._channels},getTexture:function(){return this._texture||(this._texture=Si.Z.packTextures(this)),this._texture},setTexture:function(e){this._texture=e},getChannelCount:function(){return this._channels.length},addChannel:function(e,t,i){this._packedTextures[e]||(this._packedTextures[e]={texture:t,pack:"rgb"},i||this._channels.push(e),this._isColorAtlas||(this._texture=void 0,this.updatePacking()))},removeChannel:function(e){this._packedTextures[e]&&(delete this._packedTextures[e],this._channels.splice(this._channels.indexOf(e),1),this._isColorAtlas||(this._texture=void 0,this.updatePacking()))},packChannelIfPossible:function(e,t){if(this._isColorAtlas||!(0,l.Z)().materialPacking||t.isVideo())return!1;var i=this._channels,n=i.length;if(0===n)return!1;for(var r=4,a=0;a<n;++a)r-=this._packedTextures[i[a]].pack.length;return 0!==r&&(!(vi.Z.getDefaultComponentCount(e)>r)&&(!!this.isFilteringFriendly(t,this._packedTextures[i[0]].texture)&&(i.push(e),this.addChannel(e,t,!0),this.updatePacking(),!0)))},isFilteringFriendly:function(e,t){return e.getMinFilter()===t.getMinFilter()&&(e.getMagFilter()===t.getMagFilter()&&(e.getWrapS()===t.getWrapS()&&e.getWrapT()===t.getWrapT()))},getSinglePacking:function(e,t){if("Opacity"===e||"AlphaMask"===e){var i=t.getInternalFormat()&&sr[t.getInternalFormat()];return i&&1===i.length?i:"r"}return"EmitColor"===e&&t.getInternalFormat()===or.Texture.ALPHA?"aaa":vi.Z.getDefaultFormatComponent(e)},updatePacking:function(){var e=this._channels,t=0,i=e.length;if(1!==i){e.sort(ur);for(var n=0;n<i;++n){var r=e[n],a=this._packedTextures[r];if(a){var o=vi.Z.getDefaultFormatComponent(r).length;a.pack="rgba".substr(t,o),t+=o}}}else{var s=this._packedTextures[e[0]];s.pack=this.getSinglePacking(e[0],s.texture)}},getMaxTextureSizePacked:function(e){e.width=0,e.height=0;for(var t=this._channels,i=t.length,n=0;n<i;++n){var r=t[n],a=this._packedTextures[r];if(a){var o=a.texture;if(o.getImageJSONMaxSupported){var s=o.getImageJSONMaxSupported();if(e.width=Math.max(e.width,s.width),e.height=Math.max(e.height,s.height),!(s.width<=512&&s.height<=512)){var l=o.getImageJSONMaxSupported(512);if(512!==l.width&&512!==l.height){var u=o.getImageModel().getUID(),h=e.missingTextures[u];h?-1===h.indexOf("channelName")&&h.push(r):e.missingTextures[u]=[r]}}}}}return e},isProtectedTexture:function(){for(var e=$n.Z.compilerChannels[$n.Z.EARLYZ_COMPILER],t=0;t<e.length;++t)if(this._packedTextures[e[t]])return!0;return!1},getImage:function(){return this.getTexture().getImage()},cloneType:function(){return new lr(new ar.Z)},isTextureNull:function(){return!(!this._isColorAtlas||0!==this._channels.length)||this.getTexture().isTextureNull()},apply:function(e){var t=e.getGraphicContext();this.setGraphicContext(t);var i=this.getTexture(),n=i._textureObject&&!i.isDirty();i.apply(e),n||(this._packedTextures.AlphaMask||this._packedTextures.Opacity||this._packedTextures.Displacement)&&k.Z.redrawShadowNextFrame()},getHash:function(){return""}}),"osgSketchfab","PackedMaterialTexture");const hr=lr;var cr=i("RKWW"),Ar=A.Z.osg,dr=Ar.Texture.textureNull,gr=Ze.Z.CULL_BACK,fr=Ze.Z.CULL_DISABLE,pr=new Ar.PointSizeAttribute,mr=new Ar.PointSizeAttribute;mr.setCircleShape(!0);var _r=function(e){this._stateSet=void 0,this._materialModel=e,this._material=new $n.Z,this._material.setMaterialModel(this._materialModel),this._material.setStateSetContext(this);var t=new Ar.Texture;t.setImage(new Uint8Array(12),Ar.Texture.RGB),t.setTextureSize(4,1),t.setMinFilter(Ar.Texture.NEAREST),t.setMagFilter(Ar.Texture.NEAREST),this._colorAtlas=new hr(t),this._colorAtlas.setIsColorAtlas(!0),this._packedMaterialTextureCache={},this._maxTextureUnits=(0,cr.Z)()};_r.cachedSquarePoint=pr,_r.cachedCirclePoint=mr,_r.prototype={dirtyMaterial:function(){this._material&&this._material.dirtyMaterial()},getStateSet:function(){return this._stateSet},getChannelPacking:function(e){var t=this._packedMaterialTextureCache[e];return t.getChannelPacking&&t.getChannelPacking(e)},setStateSet:function(e){this._stateSet=e,e.getAttribute("SketchfabMaterial")||(this._material.setName(e.getName()),e.setAttributeAndModes(this._material));for(var t=0,i=e.getNumTextureAttributeLists();t<i;t++)e.removeTextureAttribute(t,"Texture")},setStateSetAlphaBlending:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(Me.Z.TRANSPARENT,"DepthSortedBin"),jn.registerStateSetIsTransparent(this._stateSet,!0),jn.registerStateSetIsRefraction(this._stateSet,!1))},setStateSetOpaque:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(Me.Z.OPAQUE,"RenderBin"),jn.registerStateSetIsTransparent(this._stateSet,!1),jn.registerStateSetIsRefraction(this._stateSet,!1))},setStateSetRefraction:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(Me.Z.REFRACTION,"RenderBin"),jn.registerStateSetIsTransparent(this._stateSet,!1),jn.registerStateSetIsRefraction(this._stateSet,!0))},setCullface:function(e){this._stateSet&&(this._stateSet.setAttributeAndModes(e?gr:fr),this._material.dirtyMaterial())},setPointCircle:function(e){this._stateSet&&(this._stateSet.setAttributeAndModes(e?mr:pr),this._material.dirtyMaterial())},isFreeSlot:function(e,t){return void 0===e||e===dr||(!(!e.getChannelCount||0!==e.getChannelCount())||!(!t||e!==this._colorAtlas))},isProtectedUnit:function(e){return!(!jn.get("protectDepthAndColorUnit")||4!==e&&5!==e)||(6===e||8===e||(0,l.Z)().shadowAtlas&&7===e)},_getFirstFreeUnit:function(e){for(;this.isProtectedUnit(e);)e++;return Math.min(e,this._maxTextureUnits-1)},getAvailableTextureUnit:function(e,t){for(var i=t===this._colorAtlas,n=t===dr,r=this._stateSet,a=r.getNumTextureAttributeLists(),o=this._getFirstFreeUnit(a),s=-1,l=0;l<=o;++l)if(!this.isProtectedUnit(l)){var u=r.getTextureAttribute(l,"Texture");if(-1===s&&this.isFreeSlot(u,i)&&(s=l,i||n))break;if(!n&&!i&&u&&u.packChannelIfPossible&&u.packChannelIfPossible(e,t)){s=l;break}}return s},setPackedMaterialTextureToStateSet:function(e,t){var i=e.getName(),n=this._packedMaterialTextureCache[i];n&&n instanceof hr&&(n.removeChannel(i),Si.Z.removePackedTexture(n));var r=this.getAvailableTextureUnit(i,t);if(r<0)return this._packedMaterialTextureCache[i]=dr,void this._material.setChannelMapping(i,-1);var a=this._stateSet.getTextureAttribute(r,"Texture");t===this._colorAtlas?a=this._colorAtlas:a&&a!==this._colorAtlas||(a=new hr),a.setName("Texture"+r),this._material.setChannelMapping(i,t===dr?-1:r),this._packedMaterialTextureCache[i]=a,a&&a.addChannel&&t!==dr&&a.addChannel(i,t);var o=a instanceof hr,s=o&&a.isProtectedTexture()?Ar.StateAttribute.PROTECTED:Ar.StateAttribute.ON;this._stateSet.setTextureAttributeAndModes(r,a,s),o&&Si.Z.addPackedTexture(a)},setTexture:function(e){var t=e.getTextureModel(),i=t.getImageModel(),n=t.getMultiresTexture();if(i&&n){this.setPackedMaterialTextureToStateSet(e,n),n.isTextureNull()&&n.setTextureSize(1,1);var r=F.Z.getLowResLoaded();if(r.isFulfilled())return n.setImageMaxSupported();n.setImageSmallest().promise.then((function(){r.then(n.setImageMaxSupported.bind(n))}))}},setColor:function(e){var t=vi.Z.getColorPacking(e.getName());if(t<0)this.setPackedMaterialTextureToStateSet(e,dr);else{var i=e.getColor();t*=3;var n=this._colorAtlas.getTexture(),r=n.getImage().getImage();r[t]=Math.round(255*i[0]),r[t+1]=Math.round(255*i[1]),r[t+2]=Math.round(255*i[2]),n.dirty(),this.setPackedMaterialTextureToStateSet(e,this._colorAtlas)}},setChannelEnable:function(e,t){return!1===t?this.setPackedMaterialTextureToStateSet(e,dr):e.getTextureModel()?this.setTexture(e):void this.setColor(e)},setChannelOpacity:function(e,t){var i=e.getTransparency(),n="alphaBlend"===i,r=!n&&"additive"===i,a=!r&&!n&&"dithering"===i,o=!r&&!n&&!a&&"refraction"===i;n||a||!o||r||"alphaMask"!==i||this.model.get("material").getChannels().AlphaMask._migrate();return this._material&&this._material.updateOpacity(),!1===t||a?this.setStateSetOpaque():n||r?this.setStateSetAlphaBlending():o?this.setStateSetRefraction():void Ar.warn("Unknow opacity type : "+i)},updateChannel:function(e){if(this._stateSet){var t=e.isEffective();this.setChannelEnable(e,t);var i=e.getName();"Opacity"===i&&this.setChannelOpacity(e,t),"SubsurfaceScattering"===i&&(jn.registerStateSetIsScattering(this._stateSet,t),this._materialModel.getChannels().Opacity.trigger("updateChannel")),this._material.dirtyMaterial()}}};const vr=_r;const Cr=O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this.model.bind("change:stateSet",this.stateSet,this),this.model.bind("change:cullFace",this.onCullFace,this),this.model.bind("change:shadeless",this.onDirty,this),this.model.bind("change:vertexColorEnable",this.onDirty,this),this.model.bind("change:vertexColorColorSpace",this.onDirty,this),this.model.bind("change:vertexAlphaEnable",this.onDirty,this),Ci.Z.bind("change:hasSsr",this.onDirty,this),this.model.bind("change:hasPoints",this.onPrimitive,this),this.model.bind("change:hasTriangles",this.onPrimitive,this),this.model.bind("change:hasLines",this.onPrimitive,this),this.model.bind("apply",this.apply,this),this.model.bind("change",k.Z.draw),this._context=new vr(this.model),this._views={};for(var e=this.model.get("channels"),t=vi.Z.length,i=0;i<t;++i){var n=vi.Z[i],r=e[n];this._views[n]=new er.Z[n].view({model:r,stateSetContext:this._context}),this._views[n].stateSetContext=this._context,r.bind("change:enable",this.model.enforceWorkflow,this.model)}},getStateSetContext:function(){return this._context},stateSet:function(){var e=this.model.get("stateSet");return e.setName(this.model.get("name")),this.getStateSetContext().setStateSet(e),this},apply:function(){for(var e in this._views)this._views[e].updateChannel();this.onCullFace(),this.onDirty()},onDirty:function(){this.getStateSetContext().dirtyMaterial()},onCullFace:function(){this.getStateSetContext().setCullface(this.model.get("cullFace"))},onPrimitive:function(){this.getStateSetContext().setPointCircle(this.model.hasOnlyPoints())}});function br(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var Sr=i("HWoV"),Er=A.Z.osg,yr=1,Ir=function(){Er.NodeVisitor.call(this,Er.NodeVisitor.TRAVERSE_PARENTS),this._material=void 0,this._manager=void 0};Er.createPrototypeObject(Ir,Er.objectInherit(Er.NodeVisitor.prototype,{setManager:function(e){this._manager=e},reset:function(){this.nodePath.length=0,this._material=void 0},apply:function(e){if(!this._material){var t=e.getStateSet();t&&(this._material=this._manager.getMaterialByStateSet(t)),this._material||this.traverse(e)}}}));var xr=function(e,t){Er.NodeVisitor.call(this),this._manager=e,this._useVertexAlpha=t,this._stackMaterial=[]};Er.createPrototypeObject(xr,Er.objectInherit(Er.NodeVisitor.prototype,{apply:function(e){var t=e.getStateSet(),i=t&&this._manager.getMaterialByStateSet(t);if(i&&this._stackMaterial.push(i),e instanceof Er.Geometry&&this._stackMaterial.length>0){var n=this._stackMaterial[this._stackMaterial.length-1];e.getVertexAttributeList().Color&&(n.set("hasVertexColor",!0),!n.get("hasVertexAlpha")&&e.userDataMap.hasVertexAlpha&&(n.set("hasVertexAlpha",!0),n.set("vertexAlphaEnable",this._useVertexAlpha))),e.userDataMap&&(n.set("hasPoints",e.userDataMap.hasPoints),n.set("hasTriangles",e.userDataMap.hasTriangles),n.set("hasLines",e.userDataMap.hasLines)),n.get("geometryList").push(e)}this.traverse(e),i&&this._stackMaterial.pop()}}));var Tr,wr=Kn().Model.extend({initialize:function(){this._materialByStateSetID={},this._materialNames={material_:0}},getImageCollection:function(){return this._imageCollection||A.Z.osg.error("ImageCollection not initialized in MaterialManager, something is wrong"),this._imageCollection},setImageCollection:function(e){this._imageCollection=e},getMatcapCollection:function(){return this._matcapCollection||A.Z.osg.error("matcapCollection not initialized in MaterialManager, somewhing wrong"),this._matcapCollection},setMatcapCollection:function(e){this._matcapCollection=e},setNewMaterial:function(e,t){this.attributes[e]=t;var i=t.get("stateSetID");void 0!==i&&(this._materialByStateSetID[i]=t)},addMaterial:function(e){var t=new rr,i=this.getImageCollection();return t.setMaterialJSON(e,i),new Cr({model:t}),this.setNewMaterial(e.id,t),t},getMaterials:function(){return this.attributes},getMaterialStateID:function(e){if(void 0!==e._materialID)return e._materialID;var t=e.getUserData();if(t)for(var i=t.length-1;i>=0;--i)if("UniqueID"===t[i].Name){e._materialID=parseInt(t[i].Value,10);break}return void 0===e._materialID&&(void 0!==e._uniqueID?e._materialID=e._uniqueID:(A.Z.osg.warn("v0 StateSet detected"),this.createMaterialStateId(e))),e._materialID},createMaterialStateId:function(e){for(e._materialID=yr++;this._materialByStateSetID[e._materialID];)e._materialID=yr++;return e._materialID},getMaterialByStateSetID:function(e){return void 0!==e?this._materialByStateSetID[e]:void 0},getMaterialByStateSet:function(e){return this.getMaterialByStateSetID(this.getMaterialStateID(e))},_getChannel:function(e,t){var i=this.getMaterialByStateSetID(e);if(!i)return"Unknown material for id"+e;var n=i.get("channels")[t];return n&&n.changeTexCoordTransform?n:"Couldn't find channel "+t+" or it doesn't have a texture"},setUVOffset:function(e,t,i,n){var r=this._getChannel(e,t);if(r.length)return r;var a=r.getOrCreateUVTransforms();a.offset=Er.vec2.fromValues(i,n),r.set("UVTransforms",a),r.changeTexCoordTransform()},setUVRotation:function(e,t,i){var n=this._getChannel(e,t);if(n.length)return n;var r=n.getOrCreateUVTransforms();r.rotation=i,n.set("UVTransforms",r),n.changeTexCoordTransform()},setUVScale:function(e,t,i,n){var r=this._getChannel(e,t);if(r.length)return r;var a=r.getOrCreateUVTransforms();a.scale=Er.vec2.fromValues(i,n),r.set("UVTransforms",a),r.changeTexCoordTransform()},_deleteMaterialById:function(e){var t=this.attributes[e];t&&delete this._materialByStateSetID[t.get("stateSetID")],delete this.attributes[e]},removeMaterialByStateSetID:function(e){var t=this.attributes;for(var i in t)t[i].get("stateSetID")===e&&this._deleteMaterialById(i)},removeMaterialByStateSet:function(e){var t=this.attributes;for(var i in t){if(t[i].get("stateSet")===e)return void this._deleteMaterialById(i)}},removeUnboundMaterial:function(){var e=this.attributes;for(var t in e){e[t].get("stateSet")||this._deleteMaterialById(t)}},getMaxUvCount:function(){var e=this.attributes,t=0;for(var i in e){var n=e[i];if(!n.get("uidUniqueMerged")){var r=n.get("texCoordUnitList").length;r>t&&(t=r)}}return t},createMaterial:function(e,t){void 0===t&&(t=e.getOrCreateStateSet());var i=new rr;new Cr({model:i});var n=br();return i.set("id",n),i.set("stateSetID",this.getMaterialStateID(t)),i.set("name",this.getUniqueMaterialName(t.getAttributeMap().Material,t,e)),this.setNewMaterial(n,i),i},makeMaterial:function(e){var t=new rr;e&&t.setMaterialJSON(e,this.getImageCollection()),new Cr({model:t});var i=new Er.StateSet;i.setAttribute(new Sr.Z),t.setStateSet(i);var n=br();return t.set("id",n),t.set("stateSetID",this.createMaterialStateId(i)),t.set("name",this.getUniqueMaterialName(i.getAttributeMap().Material,i,t)),this.setNewMaterial(n,t),(new $n.Z).setMaterialModel(t),t.trigger("apply"),this.trigger("addMaterial",t),t},destroyMaterial:function(e){var t=this.get(e).get("stateSetID");void 0!==t&&delete this._materialByStateSetID[t],this.unset(e)},assignMaterial:function(e,t){var i=this.get(t);i?e.setStateSet(i.getStateSet()):console.error("Unknown material",t)},getUniqueMaterialName:function(e,t,i){var n=this._materialNames,r=e&&e.getAttribute()?e.getAttribute().getName():void 0;return void 0===r&&(r=void 0!==t.getName()?t.getName():i.getName()),void 0===r?"material_"+n.material_++:(void 0===n[r]?n[r]=0:r+="_"+n[r]++,r)},setWorkFlowMetalSpec:function(e,t){var i=this.attributes;for(var n in i)i[n].setWorkFlowMetalSpec(e,t)},setWorkFlowRoughGloss:function(e,t){var i=this.attributes;for(var n in i)i[n].setWorkFlowRoughGloss(e,t)},overrideMaterialChannels:function(e){if(!(0,o.Z)()&&e.materialShowcase){var t=e.materialDisplacement,i=e.materialDisplacementFactor,n=e.materialNormal,r=e.materialDiffuse,a=e.materialMetalness,s=e.materialRoughness,l=e.materialGlossiness,u=e.materialSpecular,h=e.materialEmissive,c=e.materialTransparency,A=e.materialCavity,d=e.materialAO,g=e.materialF0,f=(e.materialNames||"main_material").split(";");if(e.substanceDisplacement&&void 0!==t){var p=this.attributes["ae605e73-2987-4b0f-b25b-bdf1dc02e6ed"];p||(p=(0,Xn.Z)(this.attributes,(function(e){return"Sides"===e.get("name")}))),p&&this._replaceChannelURL(p.getChannels(),"Displacement",t,!0,i)}for(var m in this.attributes){var _=this.attributes[m];if(-1!==f.indexOf(_.get("name"))){var v=_.getChannels();r&&(this._replaceChannelURL(v,"DiffuseColor",r),this._replaceChannelURL(v,"AlbedoPBR",r),this._replaceChannelURL(v,"DiffusePBR",r)),void 0!==g&&(g.length?this._replaceChannelURL(v,"SpecularF0",g):(v.SpecularF0.reset(),v.SpecularF0.setFactor(.5))),void 0!==n&&this._replaceChannelURL(v,"NormalMap",n,!0),void 0!==t&&this._replaceChannelURL(v,"Displacement",t,!0,i),void 0!==A&&this._replaceChannelURL(v,"CavityPBR",A,!0),void 0!==h&&this._replaceChannelURL(v,"EmitColor",h,!0),void 0!==c&&this._replaceChannelURL(v,"Opacity",c,!0),void 0!==d&&(this._replaceChannelURL(v,"AOPBR",d,!0),this._replaceChannelURL(v,"DiffuseIntensity",d,!0)),(u||a)&&(this._replaceChannelURL(v,"SpecularPBR",u),this._replaceChannelURL(v,"MetalnessPBR",a),_.setWorkFlowMetalSpec(Boolean(a))),(s||l)&&(this._replaceChannelURL(v,"RoughnessPBR",s),this._replaceChannelURL(v,"GlossinessPBR",l),_.setWorkFlowRoughGloss(Boolean(s)))}}}},enforceWorkflowPerMaterial:function(){var e=this.attributes;for(var t in e)e[t].enforceWorkflow()},_replaceChannelURL:function(e,t,i,n,r){var a=e[t];if(i&&i.length){var o=this.getImageCollection().addNewImage({url:i,name:i,width:1,height:1});a.setupTextureModel({image:o}),n&&a.setEnable(!0),a.setFactor(void 0===r?1:r)}else a.setEnable(!1)},tagMaterialWithGeometryInfo:function(e,t){var i=new xr(this,t);e.accept(i)},updateTexCoordUnitList:function(){var e=this.attributes;for(var t in e)e[t].updateTexCoordUnitList()},findFirstMaterial:(Tr=new Ir,function(e){var t=e.length,i=e[t-1];if(i._mostInfluencedRig)return Tr.reset(),Tr.setManager(this),i._mostInfluencedRig.accept(Tr),Tr._material;for(var n=t-1;n>=0;--n){var r=e[n].getStateSet();if(r){var a=this.getMaterialByStateSet(r);if(a)return a}}}),getJSON:function(){var e={},t=this.attributes;for(var i in t)e[i]=t[i].getJSON();return e},editorGetJSON:function(){var e={},t=this.getImageCollection(),i=this.getMatcapCollection();for(var n in this.attributes){var r=this.attributes[n].getJSON(),a=r.channels;for(var o in a){var s=a[o];if(s.texture){var l=("Matcap"===o?i:t).get(s.texture.uid).get("name");s.texture.name=l,delete s.texture.uid,delete s.texture.texCoordUnit,delete s.texture.textureTarget}}e[n]={shadeless:r.shadeless,name:r.name,cullFace:r.cullFace,reflection:r.reflection,channels:a}}return e},editorSetJSON:function(e){var t=this.getImageCollection(),i=this.getMatcapCollection(),n=function(e,n){for(var r=[],a=0,o=vi.Z.length;a<o;a++){var s=vi.Z[a],l=e.channels[s];if(l&&l.texture&&l.texture.name){var u=("Matcap"===s?i:t).where({name:l.texture.name})[0];u?l.texture.uid=u.getUID():(e.channels[s]=void 0,r.push("texture "+l.texture.name+" not found in the current scene, skipping channel "+s+" for material "+n.get("name")))}}var h=n.setMaterialJSON(e,t,{validate:!0});return h?c().reject(h):c().resolve(r)},r=[];for(var a in this.attributes){var o=e[a];o&&r.push(n(o,this.attributes[a]))}return c().all(r)}});wr.createMaterialModel=function(e){var t=new rr;new Cr({model:t});var i=e.getName();return i&&t.set("name",i),(new $n.Z).setMaterialModel(t),t.setStateSet(e),t};const Mr=wr;var Rr={FeatureName:"material",ModelType:Mr.extend({_textureTrashbin:[],_matcapTrashbin:[],getName:function(){return"Material"}}),ViewListType:[Jn]},Br=n.Z.create(Rr);Br.prototype.getSceneLights=function(){return this._views[0].getSceneLights()};const Nr=Br;const Dr=a.Z.extend({initialize:function(){a.Z.prototype.initialize.apply(this,arguments),this._wireframeSchema=this.getSubSchema("wireframe");var e=this.getInstance(this._wireframeSchema);this.set("wireframeEnable",e.enable),this.set("wireframeColor",e.color)},getModelOptionPath:function(){return"shading"},defaults:function(){return{hasWireframe:!0,hasVertexColor:!1,hasVertexAlpha:!1,hasPoints:!1,hasLines:!1,hasTriangles:!1,webVR:!1}},getName:function(){return"ShadingStyle"},init:function(e){this.set("hasWireframe",!!e.getScene().getWireframeSize()),this.set("vertexColorUseAlpha",(0,di.Z)()),this.set("vertexColorColorSpace",(0,di.Z)()?"srgb":"linear"),this.set("pointSize",(0,di.Z)()?2:0);var t=e.getModel().get("options"),i=t.shading,n=t.wireframe;i&&this.setJSON({shading:i,wireframe:n}),(0,di.Z)()&&F.Z.getMaterial().then(function(){var t=e.getFeatures().material.getModel();this.set("renderer","pbr",{copyChannel:!0,overrideTexture:!1}),t._style&&this.set("type",t._style)}.bind(this))},setWireframeColorSmooth:function(e){this.trigger("setWireframeColorSmooth",e)},setWireframeJSON:function(e,t){if(t&&t.validate){var i=this.validate(e,{schema:this._wireframeSchema});if(i.length)return i.join("\n")}return void 0!==e.enable&&this.set("wireframeEnable",e.enable),e.color&&e.enable&&this.set("wireframeColor",e.color),[]},setJSON:function(e,t){var i=a.Z.prototype.setJSON.call(this,e.shading,t),n=this.setWireframeJSON(e.wireframe,t);return i.concat(n),i},getJSON:function(){return{shading:a.Z.prototype.getJSON.call(this),wireframe:{enable:this.get("wireframeEnable"),color:this.get("wireframeColor")}}},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){return this.setJSON(e,{validate:!0})}});var Pr,Fr=A.Z.osg;var Or={FeatureName:"shadingStyle",ModelType:Dr,ViewListType:[O.Z.extend({initialize:function(e){O.Z.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:webVR",this.onWebVRChanged,this),t.bind("change:renderer",this.onRendererChanged,this),t.bind("change:type",this.onShadingChanged,this),t.bind("change:pointSize",this.onPointSizeChanged,this),t.bind("change:wireframeEnable",this.onWireframeEnableChanged,this),t.bind("change:wireframeColor",this.onWireframeColorChanged,this),t.bind("change:vertexColorEnable",this.onVertexColorChanged,this),t.bind("change:vertexColorUseAlpha",this.onVertexColorChanged,this),t.bind("change:vertexColorColorSpace",this.onVertexColorChanged,this),t.bind("setWireframeColorSmooth",this.onSetWireframeColorSmooth,this),this._viewer=e.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._rootStateSet=this._viewerOSGJS.getSceneData().getOrCreateStateSet(),this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),this.updateShadingGlobal(),this._wireframeNodes=e.context.getScene().getWireframeNodes(),F.Z.getPolygon().then(function(){this.model.set("hasVertexColor",$n.Z.hasVertexColor),this.model.set("hasVertexAlpha",$n.Z.hasVertexAlpha),!1===$n.Z.hasVertexColor&&this.model.set("vertexColorEnable",!1),!1===$n.Z.hasVertexAlpha&&this.model.set("vertexColorUseAlpha",!1),this.onVertexColorChanged(),this.model.set("hasPoints",d.Z.hasPoints),this.model.set("hasTriangles",d.Z.hasTriangles),this.model.set("hasLines",d.Z.hasLines)}.bind(this)),j.Z.getBoxReady().then(this.onPointSizeChanged.bind(this)),F.Z.getWireframeOptimizedSplit().then(this.initWireframe.bind(this)),this._viewer.bind("resizeRatio",this.updatePointSize,this),F.Z.getMaterial().then(function(){this._viewer.getFeatures().camera.getModel().bind("change:fov",this.onPointSizeChanged,this)}.bind(this))},onWebVRChanged:function(){for(var e=this._wireframeNodes,t=0,i=e.length;t<i;++t)e[t].getStateSet().setRenderBinVR(this.model.get("webVR"))},updatePointSize:function(){var e=this._viewer.getFeatures(),t=this._viewer.getFeaturesManager(),i=j.Z.getModelBoxWithDisplacement().radius();i*=this.model.get("pointSize"),i*=45/e.camera.getModel().get("fov"),i*=75e-5*t.getViewport3d().height(),vr.cachedSquarePoint.setPointSize(i),vr.cachedCirclePoint.setPointSize(i)},onPointSizeChanged:function(){this.updatePointSize(),k.Z.draw()},initWireframe:function(){var e=!0===this.model.get("wireframeEnable")?Te.Z.NO_PICK_NO_SHADOW:0;this.setWireframeNodesMask(e);var t=this.setWireframeNodesMask.bind(this,0);bi.Z.updateCallback.setFinishCallback(t),this.onWireframeColorChanged(),this.model.get("wireframeEnable")&&this.onWireframeEnableChanged()},setWireframeNodesMask:function(e){for(var t=this._wireframeNodes,i=0,n=t.length;i<n;++i)t[i].setNodeMask(e);jn.setWireframe(0!==e)},getCompilerName:function(){var e=this.model.get("type");return"matcap"===e||"inspector"===e?e:e+"-"+this.model.get("renderer")},updateShadingGlobal:function(){var e,t=this.model.get("type"),i="pbr"===this.model.get("renderer");e="matcap"===t?Ci.Z.MATCAP:"inspector"===t?Ci.Z.INSPECTOR:"shadeless"===t?i?Ci.Z.PBR_SHADELESS:Ci.Z.CLASSIC_SHADELESS:i?Ci.Z.PBR_LIT:Ci.Z.CLASSIC_LIT,Ci.Z.set("mask",e)},_overrideChannelTexture:function(e,t,i){e.getTextureModel()?!i&&t.getTextureModel()||t.setTextureModel(e.getTextureModel().clone()):!t.getTextureModel()&&t.setColor&&e.getColor&&t.setColor(e.getColor())},copyChannels:function(e,t,i){var n={DiffusePBR:"DiffuseColor",AlbedoPBR:"DiffuseColor",AOPBR:"DiffuseIntensity"};for(var r in n){var a=t.getChannels(),o=a[r],s=a[n[r]];if("pbr"!==e){var l=t.isWorkflowMetalness();(l&&"DiffusePBR"!==r||!l&&"AlbedoPBR"!==r)&&this._overrideChannelTexture(o,s,i)}else this._overrideChannelTexture(s,o,i)}},onRendererChanged:function(e,t,i){this.onShadingChanged();var n=this.model.get("renderer"),r=void 0===i.copyChannel||i.copyChannel,a=void 0===i.overrideTexture||i.overrideTexture,o=this._viewer.getFeatures().material;if(o){var s=o.getModel().attributes;if(r)for(var l in s)this.copyChannels(n,s[l],a);k.Z.draw()}else Fr.error("The renderer has been changed before the material feature is initialized")},onShadingChanged:function(){this.updateShadingGlobal(),this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),k.Z.draw()},onWireframeColorChanged:function(){for(var e=this._wireframeNodes,t=0,i=e.length;t<i;++t)e[t].getStateSet().setWireframeColor(this.getRGBA())},onSetWireframeColorSmooth:function(e){var t=this.model;t.off("change:wireframeColor",this.onWireframeColorChanged,this),t.set("wireframeColor",e),t.bind("change:wireframeColor",this.onWireframeColorChanged,this);for(var i=this._wireframeNodes,n=0,r=i.length;n<r;++n)i[n].getStateSet().setWireframeColorSmooth(this.getRGBA());t.off("change:wireframeColor",this.onWireframeColorChanged,this),t.set("wireframeColor",e),t.on("change:wireframeColor",this.onWireframeColorChanged,this)},onWireframeEnableChanged:function(){this.setWireframeNodesMask(Te.Z.NO_PICK_NO_SHADOW);for(var e=this._wireframeNodes,t=this.model.get("wireframeEnable"),i=0,n=e.length;i<n;++i)e[i].getStateSet().setWireframeEnable(t,this.getRGBA())},getRGBA:(Pr=Fr.vec4.create(),function(e){var t=e||this.model.get("wireframeColor");return Pr[0]=parseInt(t.substr(0,2),16)/255,Pr[1]=parseInt(t.substr(2,2),16)/255,Pr[2]=parseInt(t.substr(4,2),16)/255,Pr[3]=parseInt(t.substr(6,2),16)/255,Pr}),_inspectorForceAlpha:function(){var e=this._viewer.getFeatures().inspector.getModel();return"Default"!==e.get("displayView")&&-1!==e.get("availableDisplayView").indexOf("VertexAlpha")},onVertexColorChanged:function(){var e=this._viewer.getFeatures().material;if(e){var t=this.model.get("vertexColorEnable"),i=this.model.get("vertexColorColorSpace"),n=this.model.get("vertexColorUseAlpha")&&(this._inspectorForceAlpha()||t),r=e.getModel().attributes;for(var a in r){var o=r[a];o.set("vertexColorEnable",t&&o.get("hasVertexColor")),o.set("vertexColorColorSpace",i);var s=n&&o.get("hasVertexAlpha");o.set("vertexAlphaEnable",s)}k.Z.draw()}}})]};const Lr=n.Z.create(Or);var kr=i("pcq+"),Zr=A.Z.osg;const Ur=Ln.Z.extend({defaults:function(){var e=1;return kr.default.any?e=0:(0,o.Z)()&&(e=2),this._deferReady=(0,Ct.Z)(),{promiseReady:this._deferReady.promise,level:e,maxQuality:!1,dynamicResolutionScaling:Zr.vec2.fromValues(1,1)}},getBudget:function(){var e=(0,l.Z)();return void 0!==e.pixelBudget?e.pixelBudget<0?1/0:e.pixelBudget:this.getBudgetFromLevel(this.get("level"))},getBudgetFromLevel:function(e){return 0===e?6144:1===e?12288:1/0},getName:function(){return"Quality"}});var Vr=i("JeqU"),Qr=i("2fWj"),Gr=A.Z.osg.Timer.instance(),Hr=(0,l.Z)().drs?(0,l.Z)().drsRatio:0,zr=(0,l.Z)().drsMin,Wr=1e3/(0,l.Z)().drsFps,jr=1e3/55;var qr={FeatureName:"quality",ModelType:Ur,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.options.context;this._viewer=e.getViewer(),this._fMaterial=e.getFeatures().material,this._version=e.getModel().get("options").version,this.model.bind("change:level",this.onLevelChanged,this),this.model.bind("updateTexelPolicy",this.updateTexelPolicy,this),this.model.bind("updateDynamicResolutionScaling",this._updatePixelRatio.bind(this)),this._maxSize=(0,Vr.Z)(),this._resumeDrs=1,this._resumeQuality=1,this._resumeAfterSSAA=!0,this._drsTest=(0,l.Z)().drsTest,this._lastTickIncreaseDrs=0,this._lastTickIncreasePP=0,this._continuousDrs=0,this._continuousQuality=0,F.Z.getFirstCameraAnimation().then(this.initTimers.bind(this))},initTimers:function(){this._lastTick=Gr.tick(),this._viewer.getRootScene().addUpdateCallback(this)},_updatePixelRatio:function(){var e=this.model.get("dynamicResolutionScaling"),t=this._viewer.getViewerOSGJS().getCanvasPixelRatio(),i=this._viewer.getInputManager().getParam("pixelRatio");i[0]=t*e[0],i[1]=t*e[1]},_forceFullRes:function(){if(this.model.get("maxQuality"))return!0;var e=this._viewer.getSuperSample();return!(!e.isEnabled()&&!e.isFakeEnabled())||!!this._viewer.getFeatures().webVR.getModel().get("enable")},_sceneBeingDrawn:function(){return this._viewer.getFeatures().postProcess.getCamera().getNodeMask()},_handleQualitySSAA:function(){var e=this._viewer.getFeatures().postProcess.getModel(),t=this.model.get("dynamicResolutionScaling");if(this._forceFullRes()){if(this._resumeAfterSSAA)return!0;this._resumeQuality=e.getQuality(),this._resumeDrs=t[0],t[0]=1;var i=this.model.get("maxQuality")?1.01:Math.max(.5,.3+this._resumeQuality);return e.setQuality(i),this._resumeAfterSSAA=!0,!0}return!this._sceneBeingDrawn()||!!this._resumeAfterSSAA&&(this._resumeAfterSSAA=!1,t[0]=this._resumeDrs,e.setQuality(this._resumeQuality),this._continuousQuality=this._resumeQuality,this._continuousDrs=this._resumeDrs,!0)},_updateQuality:function(e,t){if(!this._handleQualitySSAA()){var i=e-t,n=this._viewer.getFeatures().postProcess.getModel(),r=this.model.get("dynamicResolutionScaling"),a=(Wr-i)/Wr;this._continuousDrs=this._continuousDrs+this._continuousDrs*Hr*a,this._continuousDrs=Math.min(1,Math.max(zr,this._continuousDrs));var o=Math.min(1,1.2*r[0]);if(this._continuousDrs<r[0]?(r[0]=this._continuousDrs,this._lastTickIncreaseDrs=e):this._continuousDrs>=o&&e-this._lastTickIncreaseDrs>500&&(r[0]=o,this._lastTickIncreaseDrs=e),this._drsTest){this._drsTest++,r[0]=this._drsTest%200>100?1:.3,k.Z.draw()}var s=(jr-i)/jr;this._continuousQuality=Math.min(Math.max(0,this._continuousQuality+s),1);var l=n.getQuality(),u=Math.min(1,l+.2),h=Math.max(0,l-.2);e-this._lastTickIncreasePP>500&&(this._continuousQuality<h?(n.setQuality(h),this._lastTickIncreasePP=e):this._continuousQuality>=u&&(n.setQuality(u),this._lastTickIncreasePP=e))}},update:function(){var e=this.model.get("dynamicResolutionScaling"),t=e[0],i=Gr.tick();return this._updateQuality(i,this._lastTick),this._lastTick=i,e[1]=e[0],t!==e[0]&&this.model.trigger("updateDynamicResolutionScaling"),!0},getMaterials:function(){return this._fMaterial.getModel().attributes},onLevelChanged:function(){this.updateTexelPolicy();var e=this._fMaterial._views[0].requestAllHighResTextures(this._fMaterial.getModel().attributes);this._viewer.setFakeSecondaryProgress(e,"texture"),this._fMaterial._views[0].cleanAndApplyMaterials()},getOrCreateTexelInfos:function(){return this._fMaterial._views[0].getOrCreateTexelInfos()},getMaxSizeFromBudget:function(e){var t=e*e,i=this.getOrCreateTexelInfos();if(0===i.gpuTextureCount||i.gpuPixelCount<=t)return this._maxSize;var n=Math.min(this._maxSize,Math.sqrt(t/i.gpuTextureCount));return n=Qr.Z.snapToPowerOf2(n,.75),this._version<2&&(n<1024?n=512:n>=1024&&n<2048&&(n=2048)),i.max<=n||i.gpuPixelCount<=n*n?this._maxSize:n},_printErrorMissingResolution:function(e){var t=Object.keys(e.missingTextures).length;if(0===t)return 0;var i="",n=e.missingTextures;for(var r in n)i+="\n"+r+" ("+n[r].join(", ")+")";return console.error("Multi-resolution textures missing : "+t+i),t},updateTexelPolicy:function(){if((0,l.Z)().imageCompression){var e=this.getOrCreateTexelInfos(),t=this._printErrorMissingResolution(e);0===e.gpuTextureCount||t>=e.gpuTextureCount||(this.model.get("promiseReady").isPending()&&this.initAvailableTextureQuality(),(0,l.Z)().maxTextureSize=this.getMaxSizeFromBudget(this.model.getBudget()))}},initAvailableTextureQuality:function(){var e=this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(0)),t=this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(1)),i={low:!0,mid:t!==e,high:t!==this._maxSize},n=this.model.get("level");i.high||2!==n||(n=1),i.mid||1!==n||(n=0),1===n&&(i.low=!1),this.model.off(null,this.onLevelChanged,this),this.model.set("level",n),this.model.on("change:level",this.onLevelChanged,this),this.model._deferReady.resolve(i)}})]},Jr=n.Z.create(qr);Jr.prototype.prepareForScreenShot=function(){this._model.set("maxQuality",!0)},Jr.prototype.resetAfterScreenShot=function(){this._model.set("maxQuality",!1)};const Yr=Jr;const Kr=Kn().Model.extend({defaults:{enable:!1,paused:!1,speed:.6},getName:function(){return"Autospin"},init:function(){var e=(0,l.Z)();void 0!==e.autospin&&(this.set("enable",!!e.autospin),this.set("speed",e.autospin))}});var Xr,$r=A.Z.osg,ea=function(e,t,i){this._speed=void 0!==e?e:-.6,this._fadeStart=void 0!==t?t:2,this._fadeEnd=void 0!==i?i:2,this._enable=!0,this._rotation=0,this._lastTime=-1,this._startTime=0,this._endTime=0,this._checkIfFinished=!1,this._fixedCenter=void 0};$r.createPrototypeObject(ea,{setSpeed:function(e){this._speed=e},setFadeStart:function(e){this._fadeStart=e},setFadeEnd:function(e){this._fadeEnd=e},deactivate:function(){this._enable=!1},resume:function(){this._enable=!0,this._checkIfFinished=!1;var e=Math.max((this._endTime-this._lastTime)/this._fadeEnd,0);this._startTime=this._lastTime-this._fadeStart*e,this._endTime=this._lastTime,k.Z.draw()},pause:function(){var e=Math.min((this._lastTime-this._startTime)/this._fadeStart,1);this._endTime=this._lastTime+this._fadeEnd*e,this._checkIfFinished=!0},update:(Xr=$r.mat4.create(),function(e,t){if(!1===this._enable)return!0;k.Z.draw();var i=t.getFrameStamp().getSimulationTime();if(!0===this._checkIfFinished&&this._endTime<i)return this._enable=!1,this._checkIfFinished=!1,this._lastTime=-1,!0;if(this._lastTime<0)return this._lastTime=i,this._startTime=i,!0;var n=i-this._lastTime;this._lastTime=i,this._endTime>i?this._rotation+=n*$r.smoothStep(0,1,(this._endTime-i)/this._fadeEnd):i-this._startTime<this._fadeStart?this._rotation+=n*$r.smoothStep(0,1,(i-this._startTime)/this._fadeStart):this._rotation+=n;var r=e.getMatrix();$r.mat4.fromZRotation(r,-this._rotation*this._speed);var a=e.getChildren();if(a.length>0){if(!this._fixedCenter){var o=a[0].getMinimumBound();o.valid()&&(this._fixedCenter=$r.vec3.create(),$r.vec3.copy(this._fixedCenter,o.center()))}var s=this._fixedCenter||a[0].getMinimumBound().center();$r.vec3.negate(s,s),$r.mat4.fromTranslation(Xr,s),$r.mat4.multiply(r,r,Xr),$r.vec3.negate(s,s),$r.mat4.fromTranslation(Xr,s),$r.mat4.multiply(r,Xr,r)}return e.dirtyBound(),!0})},"osgSketchfab","UpdateCallbackAutospin");const ta=ea;var ia=A.Z.osg,na=A.Z.InputGroups;var ra={FeatureName:"autospin",ModelType:Kr,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._inputManager=this._viewer.getInputManager();var e=this.model;e.bind("change:enable",this.onEnableChanged,this),e.bind("change:paused",this.onPausedChanged,this),e.bind("change:speed",this.onSpeedChanged,this),this._nodeAutospin=new ia.MatrixTransform,this._nodeAutospin.setName("Feature - Autospin"),this._callbackAutospin=new ta(e.get("speed"),1,1),this._nodeAutospin.addUpdateCallback(this._callbackAutospin),!1===e.get("enable")&&this._callbackAutospin.deactivate(),Ue.Z.initAutospin(this,this.model.get("enable")),F.Z.getModelDisplayed().then(this.linkWithEvents.bind(this))},isOrbit:function(){var e=this._viewer.getFeatures().camera;return e&&e.getModel().get("indexManipulator")===xe.ORBIT},linkWithEvents:function(){this._viewer.getFeatures().camera.getModel().bind("change:indexManipulator",this.onManipulatorChange.bind(this)),this.onManipulatorChange()},onManipulatorChange:function(){clearTimeout(this._timerAutospin),this.model.set("paused",!this.isOrbit())},pause:function(){clearTimeout(this._timerAutospin),this.model.set("paused",!0)},resume:function(){if(this.isOrbit()){var e=this.model;this._timerAutospin=setTimeout((function(){e.set("paused",!1)}),5e3)}},onEnableChanged:function(){!0===this.model.get("enable")?(this._callbackAutospin.resume(),this._inputManager.setEnable(na.AUTOSPIN,!0)):(this._callbackAutospin.deactivate(),this._inputManager.setEnable(na.AUTOSPIN,!1))},onPausedChanged:function(){!1!==this.model.get("enable")&&(!0===this.model.get("paused")?this._callbackAutospin.pause():this._callbackAutospin.resume())},onSpeedChanged:function(){this._callbackAutospin.setSpeed(this.model.get("speed"))}})]},aa=n.Z.create(ra);aa.prototype.getNode=function(){return this._views[0]._nodeAutospin};const oa=aa;var sa=A.Z.osg;const la=a.Z.extend({getModelOptionPath:function(){return"orientation"},defaults:{showGizmo:!1},getName:function(){return"Orientation"},init:function(e){this.setJSON(e.getModel().get("options").orientation);var t=(0,l.Z)().scale,i=this.get("matrix");1!==t&&sa.mat4.scale(i,i,sa.vec3.fromValues(t,t,t))},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){return this.setJSON(e,{validate:!0})}});var ua=A.Z.osg,ha=function(e,t,i,n){this._model=i.model,this._manipulator=e,this._applyWithoutTranslation=!1,this._quatCurrent=ua.mat4.getRotation(ua.quat.create(),this._model.get("matrix")),this._quatTarget=ua.quat.create(),this._quatStart=ua.quat.create(),this._nodeGrid=i._nodeGrid,st.Z.call(this,t),this._finished=!0,this._nodeGizmo=i._nodeGizmo,this._gizmoTra=i._gizmoTra,this._gizmoMode=!1,this._rootModel=n,this._nodeOrientation=i._nodeOrientation,this._features=i.options.context.getFeatures(),this._viewer=i._viewer,this._scaleModel=ua.vec3.create(),this._worldCenter=ua.vec3.create(),this._negateLocalCenter=ua.vec3.create(),j.Z.getBoxReady().then(this.initModelBound.bind(this))};ua.createPrototypeObject(ha,ua.objectInherit(st.Z.prototype,{setQuatTarget:function(e){ua.quat.copy(this._quatStart,this._quatCurrent),ua.quat.copy(this._quatTarget,e),this.reset(),this._gizmoMode=!1},initModelBound:function(){var e=j.Z.getModelBoxWithoutDisplacement();e.center(this._worldCenter);var t=this._rootModel.getMinimumBound();ua.vec3.negate(this._negateLocalCenter,t.center());var i=e.radius();ua.vec3.set(this._scaleModel,i,i,i),this._nodeGizmo.getMatrix()[14]-=.51*(e.getMax()[2]-e.getMin()[2])},setGizmoMode:function(e){this._gizmoMode=e,this.rotateNode(this._nodeOrientation)},getQuatTarget:function(){return this._quatTarget},getQuatStart:function(){return this._quatStart},update:function(e,t){if(this._gizmoMode){ua.mat4.getRotation(this._quatCurrent,this._nodeGizmo.getMatrix()),this.rotateNode(e);var i=this._viewer.getFeaturesManager().getNodeGizmo();return this._editing&&!i.isEditing()&&this._model.trigger("orientationDirty"),this._editing=i.isEditing(),!0}if(this._finished)return!0;k.Z.draw();var n=t.getFrameStamp().getSimulationTime(),r=this.interpolate(n,e,t);if(r=ua.smoothStep(0,1,r),ua.quat.slerp(this._quatCurrent,this._quatStart,this._quatTarget,r),this.rotateNode(e),this._finished){var a=this._nodeGizmo.getMatrix(),o=a[14];ua.mat4.fromQuat(a,this._quatCurrent),a[14]=o,this._gizmoMode=this._model.get("showGizmo"),this._model.trigger("orientationDirty")}return!0},rotateNode:function(){var e=ua.mat4.create();return function(t){var i=this._gizmoTra.getMatrix();ua.mat4.fromTranslation(i,this._worldCenter);var n=t.getMatrix();ua.mat4.fromQuat(n,this._quatCurrent),ua.mat4.mul(n,i,n),ua.mat4.translate(n,n,this._negateLocalCenter);var r=this._nodeGrid.getMatrix();ua.mat4.scale(r,i,this._scaleModel),r[14]+=this._nodeGizmo.getMatrix()[14],ua.mat4.invert(e,n),ua.mat4.mul(r,e,r),this.updateShadows(),t.dirtyBound()}}(),updateShadows:function(){var e=this._features.environment;e&&e.getNode().updateShadow();var t=this._features.lighting;if(t)for(var i=t.getModel().get("lights"),n=0,r=i.length;n<r;++n)i[n].dirty()}}));const ca=ha;var Aa=i("oIlX"),da=i("WIUU"),ga=i("gspP"),fa=i("4HDP"),pa=i("rGsq"),ma=A.Z.osg,_a=function(){ma.MatrixTransform.call(this),this._timeGrid=0;var e=ma.Uniform.createFloat4(ma.vec4.fromValues(.5,.5,.5,0),"uColor");this._callbackColor=new Aa.Z(e.getInternalArray(),1),this._callbackColor.setFinishCallback(this._disableGrid.bind(this)),this.addUpdateCallback(this._callbackColor);var t=this.getOrCreateStateSet();t.setAttributeAndModes(Ze.Z.DEPTH_LEQUAL_WRITE),t.setAttributeAndModes(Ze.Z.BLEND_SUBSTRACTIVE),t.setRenderBinDetails(Me.Z.GRID,"RenderBin"),t.addUniform(e),this._grid=ma.createGridGeometry(-1,-1,0,2,0,0,0,2,0,10,10),this._axis=ma.createAxisGeometry(1),this.addChild(this._grid),this.addChild(this._axis),this._grid.getOrCreateStateSet().setAttributeAndModes(we.Z.getOrCreateShader(da,ga,"orientation-grid","Grid")),this._axis.getOrCreateStateSet().setAttributeAndModes(we.Z.getOrCreateShader(fa,pa,"orientation-axis","OrientationAxis")),this._disableGrid()};ma.createPrototypeNode(_a,ma.objectInherit(ma.MatrixTransform.prototype,{showGridTemporary:function(e){this._grid.dirtyBound(),this._axis.dirtyBound(),this.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._callbackColor.show(),window.clearTimeout(this._timeGrid),e&&(this._timeGrid=window.setTimeout(this.hideGrid.bind(this),1e3*e))},_invalidateNodeBound:function(e){e.dirtyBound(),e.getBoundingBox().init(),e.getBoundingSphere().init()},_disableGrid:function(){this.setNodeMask(0),this._invalidateNodeBound(this._grid),this._invalidateNodeBound(this._axis),this._invalidateNodeBound(this)},hideGrid:function(){this._timeGrid=0,this._callbackColor.hide()}}),"osgSketchfab","Grid");const va=_a;var Ca=A.Z.osg,ba=A.Z.osgUtil;var Sa={FeatureName:"orientation",ModelType:la,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:matrix",this.onMatrixChanged,this),e.bind("change:showGizmo",this.onGizmoShowChanged,this),e.bind("turn",this.onTurn,this),e.bind("reset",this.onReset,this),e.bind("orientationDirty",this.onOrientationDirty,this);var t=this.options.context;this._viewer=t.getViewer(),this._nodeGrid=new va,this._nodeGrid.setName("Node grid"),this._nodeOrientation=new Ca.MatrixTransform,this._nodeOrientation.setName("Feature - Orientation"),this._nodeOrientation.addChild(this._nodeGrid),this._nodeGizmo=new Ca.MatrixTransform,this._nodeGizmo.setCullingActive(!1),this._nodeGizmo.editMask=ba.NodeGizmo.PICK_ARC|ba.NodeGizmo.PICK_ARROW_Z,this._gizmoTra=new Ca.MatrixTransform,this._gizmoTra.setReferenceFrame(Ca.Transform.ABSOLUTE_RF),this._gizmoTra.addChild(this._nodeGizmo);var i=this.model.get("matrix");this._nodeOrientation.setMatrix(i);var n=Ca.mat4.getRotation(Ca.quat.create(),i);Ca.mat4.fromQuat(this._nodeGizmo.getMatrix(),n);var r=this._viewer.getRootModel(),a=this._viewer.getViewerOSGJS().getManipulator();this._callbackOrientation=new ca(a,.5,this,r),this._nodeOrientation.addUpdateCallback(this._callbackOrientation)},onReset:function(){var e=Ca.mat4.getTranslation(Ca.vec3.create(),this.model.get("matrix"));Ca.mat4.fromTranslation(this.model.get("matrix"),e),this.onMatrixChanged()},onTurn:function(e,t){var i="right"===t?1:-1,n="x"===e?i:0,r="y"===e?i:0,a="z"===e?i:0,o=Ca.mat4.fromRotation(Ca.mat4.create(),-Math.PI/2,Ca.vec3.fromValues(n,r,a)),s=this.model.get("matrix");Ca.mat4.multiply(s,o,s),this.onMatrixChanged()},onGizmoShowChanged:function(){var e=this.model.get("showGizmo"),t=this._viewer.getFeaturesManager();if(t){var i=t.getNodeGizmo();if(i){var n=this._nodeGizmo.getMatrix(),r=n[14];Ca.mat4.copy(n,this.model.get("matrix")),n[12]=0,n[13]=0,n[14]=r,i.setForcePicking(e),i.setRotateInLocal(!e),i.setTranslateInLocal(!e),i.attachToNode(e?this._nodeGizmo:null),this._nodeGrid.showGridTemporary(e?0:2.5),this._callbackOrientation.setGizmoMode(e)}}},onMatrixChanged:function(){this.model.get("showGizmo")||this._nodeGrid.showGridTemporary(2.5),this._callbackOrientation.setQuatTarget(Ca.mat4.getRotation(Ca.quat.create(),this.model.get("matrix")))},onOrientationDirty:function(){var e=this.options.context.getFeatures().orientation.getNode();j.Z.computePreciseBox(e),this.model.trigger("orientationChanged")},getNodeGrid:function(){return this._nodeGrid},getNodeOrientation:function(){return this._nodeOrientation}})]},Ea=n.Z.create(Sa);Ea.prototype.getNode=function(){return this._views[0].getNodeOrientation()},Ea.prototype.getWidgetNode=function(){return this._views[0].getNodeGrid()};const ya=Ea;var Ia,xa=i("57NU"),Ta={substancepainter:{"80fba9759ab94307a782f38d359b8ea8":{rotation:1.57,environmentExposure:8.5,lightIntensity:1.5,brightness:1},"2e9c3708feb74137b0436f946b8b66b8":{rotation:1.6,environmentExposure:2.5,lightIntensity:2,brightness:1.12},"268447ca0a954f44b06d1387863d114e":{rotation:6.25,environmentExposure:1.2,lightIntensity:2.5,brightness:1},"3e2ad3e1f1ea47679f045a7eb0e6af49":{rotation:.3,environmentExposure:.59,lightIntensity:2.5,brightness:1},"2fa15e0b1cee45a5b02605a288934e1b ":{rotation:.68,environmentExposure:2.5,lightIntensity:2.5,brightness:1},"9190e8da70694ef3b9d1d0c01541917e":{rotation:3.24,environmentExposure:1.7,lightIntensity:2.5,brightness:.57},"749a0594343e4ff9a2875cb411d0ad1a":{rotation:4.73,environmentExposure:.35,lightIntensity:3,brightness:1},f2dabeb04674446696486eea67028bd8:{rotation:4.71,environmentExposure:.35,lightIntensity:3,brightness:1.5},df380da788ee444885722735039b0c09:{rotation:.27,environmentExposure:.55,lightIntensity:3,brightness:1.46},"16cdcddf277d423d99094f8db0c731e9":{rotation:3.73,environmentExposure:1.5,lightIntensity:2.2,brightness:.53},c281dff366844cbc8b33179337037f42:{rotation:3.64,environmentExposure:4.5,lightIntensity:3,brightness:.53}}};Ia={e871dd2920334a0f9c3107a00da3c24a:{uid:"e871dd2920334a0f9c3107a00da3c24a",name:"Gareoult",environmentExposure:.7,lightIntensity:3},"102d22e28ca34190a8470402ccdc35d3":{uid:"102d22e28ca34190a8470402ccdc35d3",name:"Milkyway",environmentExposure:6.8,lightIntensity:3},cd5e5b1607d844cdb928e96ff9c36b5c:{uid:"cd5e5b1607d844cdb928e96ff9c36b5c",name:"QueenMary chimney",environmentExposure:7,lightIntensity:3},"8653449395004fd58820874bfff93ce7":{uid:"8653449395004fd58820874bfff93ce7",name:"Kirby_cove",environmentExposure:.6,lightIntensity:4},"3e2ad3e1f1ea47679f045a7eb0e6af49":{uid:"3e2ad3e1f1ea47679f045a7eb0e6af49",name:"Gdansk shipyard buildings",environmentExposure:.4,lightIntensity:3},d348dfd2a8104ab0b8528f885d645eb3:{uid:"d348dfd2a8104ab0b8528f885d645eb3",name:"footprint",environmentExposure:1.2,lightIntensity:5},"2fa15e0b1cee45a5b02605a288934e1b":{uid:"2fa15e0b1cee45a5b02605a288934e1b",name:"glazed patio by restaurant",environmentExposure:2.7,lightIntensity:3},"5335c7c5c2434866ac8a442157f24f5e":{uid:"5335c7c5c2434866ac8a442157f24f5e",name:"tropical ruins",environmentExposure:2,lightIntensity:3},"9190e8da70694ef3b9d1d0c01541917e":{uid:"9190e8da70694ef3b9d1d0c01541917e",name:"industrial room",environmentExposure:1,lightIntensity:3},df380da788ee444885722735039b0c09:{uid:"df380da788ee444885722735039b0c09",name:"studio",environmentExposure:.8,lightIntensity:3},"4eda3e78ed214dc8852c439dc64b9c9d":{uid:"4eda3e78ed214dc8852c439dc64b9c9d",name:"road in dordogne",environmentExposure:.6,lightIntensity:2.5},"749a0594343e4ff9a2875cb411d0ad1a":{uid:"749a0594343e4ff9a2875cb411d0ad1a",name:"road in tenerife mountain",environmentExposure:.7,lightIntensity:3.5},c281dff366844cbc8b33179337037f42:{uid:"c281dff366844cbc8b33179337037f42",name:"urban exploring interior",environmentExposure:12,lightIntensity:3.3},"41192cc664484a0fa565da3361d10c9c":{uid:"41192cc664484a0fa565da3361d10c9c",name:"muir wood",environmentExposure:.9,lightIntensity:3},"5e7120378b00431ea18151e97a8366ec":{uid:"5e7120378b00431ea18151e97a8366ec",name:"treasure island",environmentExposure:.55,lightIntensity:3.5},e00dc642058b4176a4aaa449ea8ad5f8:{uid:"e00dc642058b4176a4aaa449ea8ad5f8",name:"trinitatis church",environmentExposure:.6,lightIntensity:4},e2aa1ab3582c4feab7371baf1e4cd734:{uid:"e2aa1ab3582c4feab7371baf1e4cd734",name:"arche pinetree",environmentExposure:2.3,lightIntensity:3.5},"2a016b232e444ef3a6ba323c51aa5063":{uid:"2a016b232e444ef3a6ba323c51aa5063",name:"tokyo bigsight",environmentExposure:2.3,lightIntensity:3.5},"08468d6fcf9846039cc3e51accddd9f9":{uid:"08468d6fcf9846039cc3e51accddd9f9",name:"studio soft",environmentExposure:2.3,lightIntensity:3}};const wa=function(e){return Ta[e]||Ia};var Ma=i("HJcC"),Ra=A.Z.osg,Ba={uid:"9190e8da70694ef3b9d1d0c01541917e",brightness:1.6868};const Na=a.Z.extend({_trashbin:[],getModelOptionPath:function(){return"environment"},getRandomEnvironment:function(){var e=[];return this.environmentCollection.each((function(t){t.get("isDefault")&&-1===Ma.Z.indexOf(t.get("uid"))&&e.push({uid:t.get("uid"),brightness:t.get("brightness")})})),0===e.length?Ba:e[Math.round(Math.random()*(e.length-1))]},resetToDefaultEnvironment:function(){return this.set("uid",Ba.uid),this.set("exposure",Ba.brightness),this},defaults:function(){return{}},initDefaults:function(e){e.enable=(0,di.Z)(),e.uid=Ba.uid,e.exposure=Ba.brightness,e.shadowEnable=(0,di.Z)(),a.Z.prototype.initDefaults.call(this,e)},init:function(e){this._context=e,this._viewer=e.getViewer();var t=e.getModel().get("options").environment,i=void 0===t.uid;t&&this.setJSON(t),this.environmentCollection=s.Z.instance.getEnvironmentCollection(),i&&this.resetToDefaultEnvironment(),this.checkEnvironmentValidity(),(0,di.Z)()?F.Z.getPolygon().then(this.updateEnvironmentConfig.bind(this)):F.Z.getPolygon().then(function(){var e=this.getEnvironment();if(e){var t=this._getYRotationFromLightDirection(e);this.set("lightRotation",t)}else this.checkEnvironmentValidity()}.bind(this)),(0,o.Z)()&&(0,l.Z)().apiLog&&(console.log("------"),console.log("Viewer API environment uid list:"),this.environmentCollection.each((function(e){console.log("- "+e.get("name")+": "+e.get("uid"))})),console.log("------"))},_getYRotationFromLightDirection:function(e){var t=e.get("lights"),i=0;if(t.length){var n=Ra.vec3.clone(t[0].direction);if(Math.abs(n[1])<.99999){n[1]=0,Ra.vec3.normalize(n,n);var r=Math.acos(n[0]);i=n[2]>0?r:2*Math.PI-r}}return i},updateEnvironmentConfig:function(){var e=this.getEnvironment();if(e){var t=this.get("rotation"),i=this.get("lightRotation"),n=this._getYRotationFromLightDirection(e);this.set("lightRotation",n);var r=0;void 0!==i&&(r=i-n);var a=2*Math.PI,o=(a+t+r)%a,s=wa(this._viewer.getRootUserData().source)[e.get("uid")];s?(void 0!==s.environmentExposure&&this.set("exposure",parseFloat(s.environmentExposure)),void 0!==s.lightIntensity&&this.set("lightIntensity",parseFloat(s.lightIntensity)),void 0!==s.brightness&&this.set("backgroundExposure",parseFloat(s.brightness)),void 0!==s.rotation&&(o=parseFloat(s.rotation))):this.set("exposure",parseFloat(e.get("brightness"))||1),this.set("rotation",o);var l=this._viewer.getRootUserData();(0,di.Z)()&&"Tilt Brush"===l.authoringTool&&(this.set("uid","3e2ad3e1f1ea47679f045a7eb0e6af49"),this.set("exposure",.5))}else this.checkEnvironmentValidity()},getEnvironmentCollection:function(){return this.environmentCollection},checkEnvironmentValidity:function(){this.getEnvironment()||(this.set("uid",Ba.uid),this.set("exposure",Ba.brightness))},getName:function(){return"Environment"},getEnvironment:function(){var e=this.get("uid");return this.environmentCollection.find((function(t){return t.get("uid")===e}))},isShadowEnable:function(){return this.get("shadowEnable")},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){return this.setJSON(e,{validate:!0})}});var Da=i("82Lz"),Pa=i("XZvc"),Fa=A.Z.osg,Oa={},La=function(e,t){if(Oa[e])return Oa[e];var i=e.toLowerCase();return Oa[e]=we.Z.getOrCreateShader(Da,Pa,i,t,e),Oa[e]},ka=function(){return La("LINE","LightingLineGizmo")},Za=Ze.Z.BLEND_SUBSTRACTIVE,Ua={},Va=function(e){if(Ua[e])return Ua[e];var t=Re.iconsLight[e];t||(t=Re.iconsLight.DIRECTION);var i=s.Z.instance.getOrCreateTexture(t,{internalFormat:Fa.Texture.RGBA});return Ua[e]=i.texture,i.texture},Qa={};Qa.createIconGeometry=function(){var e=Fa.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),t=e.getOrCreateStateSet();return t.setTextureAttributeAndModes(1,Va("DIRECTION")),t.addUniform(Fa.Uniform.createInt(1,"uTextureIcon")),t.setAttributeAndModes(Za),t.setAttributeAndModes(La("ICON","LightingIcon")),e.setLightType=function(e){t.setTextureAttributeAndModes(1,Va(e))},e},Qa.createDirectionalGeometry=function(e){for(var t=void 0===e?-1:-e,i=t/15,n=2*Math.PI,r=new Float32Array(180),a=0;a<5;++a){var o=6*a,s=n*a/5;r[o]=r[o+3]=Math.cos(s)*i,r[o+1]=r[o+4]=Math.sin(s)*i,r[o+5]=t}var l=new Fa.DrawArrays(Fa.primitiveSet.LINES,0,30),u=new Fa.Geometry;return u.getAttributes().Vertex=new Fa.BufferArray(Fa.BufferArray.ARRAY_BUFFER,r,3),u.getPrimitives().push(l),u.getOrCreateStateSet().setAttributeAndModes(ka()),u.getOrCreateStateSet().setAttributeAndModes(Za),u},Qa.createSpotGeometry=function(e){var t=void 0===e?-1:-e,i=50,n=2*Math.PI,r=new Fa.Geometry,a=new Float32Array(300),o=r.getAttributes().Vertex=new Fa.BufferArray(Fa.BufferArray.ARRAY_BUFFER,a,3),s=0,l=new Uint16Array(i);for(s=0;s<i;++s)l[s]=2*s+1;var u=new Fa.DrawElements(Fa.primitiveSet.LINE_LOOP,new Fa.BufferArray(Fa.BufferArray.ELEMENT_ARRAY_BUFFER,l,1)),h=new Uint16Array(10);for(s=0;s<5;++s)h[2*s]=20*s,h[2*s+1]=20*s+1;var c=new Fa.DrawElements(Fa.primitiveSet.LINES,new Fa.BufferArray(Fa.BufferArray.ELEMENT_ARRAY_BUFFER,h,1));return r.getPrimitives().push(c,u),r.getOrCreateStateSet().setAttributeAndModes(ka()),r.getOrCreateStateSet().setAttributeAndModes(Za),r.updateCone=function(e,l){var u=l?2*-l:t,h=Math.cos(e)*u,c=Math.sin(e)*u;for(s=0;s<i;++s){var A=6*s,d=n*s/i;a[A+3]=Math.cos(d)*c,a[A+4]=Math.sin(d)*c,a[A+5]=h}o.dirty(),r.dirtyBound()},r.updateCone(.1),r},Qa.createHemiGeometry=function(e){for(var t=void 0===e?-1:-e,i=50,n=new Fa.Geometry,r=new Float32Array(450),a=Math.PI,o=150,s=0;s<i;++s){var l=3*s,u=a*s/49,h=Math.cos(u),c=Math.sin(u);r[l]=h*t,r[l+2]=-c*t,r[o+l+1]=h*t,r[o+l+2]=-c*t,u=2*a*s/49,r[300+l]=Math.cos(u)*t,r[300+l+1]=Math.sin(u)*t}n.getAttributes().Vertex=new Fa.BufferArray(Fa.BufferArray.ARRAY_BUFFER,r,3);var A=new Fa.DrawArrays(Fa.primitiveSet.LINE_STRIP,0,i),d=new Fa.DrawArrays(Fa.primitiveSet.LINE_STRIP,i,i),g=new Fa.DrawArrays(Fa.primitiveSet.LINE_STRIP,100,i);n.getPrimitives().push(A,d,g);var f=n.getOrCreateStateSet();return f.setAttributeAndModes(La("HEMI","LightingHemiGizmo")),f.setAttributeAndModes(Za),f.addUniform(Fa.Uniform.createFloat(-t,"uRadius")),n},Qa.createPointGeometry=function(){var e=2*Math.PI,t=50,i=new Fa.Geometry,n=new Float32Array(1350),r=i.getAttributes().Vertex=new Fa.BufferArray(Fa.BufferArray.ARRAY_BUFFER,n,3),a=new Fa.DrawArrays(Fa.primitiveSet.LINE_STRIP,0,t),o=new Fa.DrawArrays(Fa.primitiveSet.LINE_STRIP,t,t),s=new Fa.DrawArrays(Fa.primitiveSet.LINE_STRIP,100,t);return i.getPrimitives().push(a,o,s),i.getOrCreateStateSet().setAttributeAndModes(ka()),i.getOrCreateStateSet().setAttributeAndModes(Za),i.updateRadius=function(a){for(var o=0;o<t;++o){var s=3*o,l=e*o/49;n[s]=n[150+s]=n[300+s+1]=Math.cos(l)*a,n[s+1]=n[150+s+2]=n[300+s+2]=Math.sin(l)*a}r.dirty(),i.dirtyBound()},i.updateRadius(1),i};const Ga=Qa;var Ha,za=i("SZYu"),Wa=i("MaYM"),ja=A.Z.osg,qa=(0,l.Z)().shadow,Ja=(0,l.Z)().shadowAtlas,Ya=Ja?7:12,Ka=(0,l.Z)().shadowTextureSize;A.Z.osgShadow.ShadowMap.prototype._preventTextureBindingDuringShadowCasting=function(){for(var e=(0,cr.Z)(),t=ja.StateAttribute.OVERRIDE_ON,i=0;i<e;i++)this._casterStateSet.setTextureAttributeAndModes(i,ja.Texture.textureNull,t)};var Xa,$a,eo=function(e){return(Ha=new A.Z.osgShadow.ShadowSettings).setLight(e),Ha.setShadowCastShaderGeneratorName("shadowcast"),Ha.setCastsShadowDrawTraversalMask(Te.Z.SHADOW),Ha.setCastsShadowBoundsTraversalMask(Te.Z.SHADOW_BOUNDS),Ha.userShadowCasterVisitor=!1,Ha.kernelSizePCF=(0,l.Z)().shadowPCF,Ha.fakePCF=!1,Ha.setTextureSize((0,l.Z)().shadowTextureSize),Ha};Ja&&((Xa=eo()).atlasSize=2*Ka,Xa.setTextureSize(Ka),($a=new A.Z.osgShadow.ShadowMapAtlas(Xa)).setTextureUnitBase(Ya));var to=Wa.Z.uShadowMapSize.getInternalArray();to[0]=Ka,to[1]=Ka;var io=function(e,t,i){var n=new ja.MatrixTransform;n.setName(e+" - LightNode "+t),n.getOrCreateStateSet().setAttributeAndModes(Ze.Z.DEPTH_DISABLE);var r=new Qt(t);i&&r.setLightType(i),r.setName(e+" - Light "+t),ja.vec3.copy(r.getAmbient(),ja.vec3.ZERO),ja.vec3.copy(r.getSpecular(),ja.vec3.ZERO),r.setLinearAttenuation(0);var a,o,s=new ja.LightSource;if(s.setName("skfb"+e+" - LightSource "+t),s.setLight(r),!qa)return{node:n,light:r,lightSource:s,shadowSettings:$a?Xa:eo(r),enableShadow:!1};if($a?(o=Xa,a=$a.addLight(r)):(o=eo(r),(a=new A.Z.osgShadow.ShadowMap(o)).setTextureUnitBase(Ya),a.setContinuousUpdate(!1),a.setTextureSize((0,l.Z)().shadowTextureSize)),a.setJitterOffset((0,l.Z)().shadowJitterOffset),(0,l.Z)().stats){var u=a.getCamera(),h=za.Z.getTimerGPU();u.setInitialDrawCallback((function(){h.start("ShadowMap"),h.start("ShadowMap"+t)})),u.setFinalDrawCallback((function(){h.end("ShadowMap"+t),h.end("ShadowMap")}))}return{node:n,light:r,lightSource:s,shadowSettings:o,shadowMap:a,enableShadow:qa&&(0,cr.Z)()>Ya}},no=function(e,t){qa&&(t.setContinuousUpdate(!1),Ja?(e.addShadowTechnique($a),$a.addShadowMap(t)):e.addShadowTechnique(t))},ro=function(e,t){Ja?$a.removeShadowMap(t):e.removeShadowTechnique(t)},ao=i("0Iaf"),oo=A.Z.osg;const so={ambient:oo.Uniform.createInt1(0,"uAmbient"),texture0:oo.Uniform.createInt1(0,"uTexture0"),backgroundExposure:oo.Uniform.createFloat(1,"uBackgroundExposure"),size:oo.Uniform.createFloat(1,"uSize"),color:oo.Uniform.createFloat3(oo.vec3.fromValues(0,0,1),"uBackgroundColor"),scale:oo.Uniform.createFloat2(oo.vec2.fromValues(1,1),"uFixedScale")};var lo=i("pts4"),uo=i("YVvG"),ho=A.Z.osg,co=function(){ho.Node.call(this),this._geometry=ho.createTexturedBoxGeometry(0,0,0,5,5,5),this._show="NONE",this._bgEnv=null,this._bgFixed=null,this._texRatio=1,this._canvasWidth=1,this._canvasHidth=1,this.init(),this.hide()};ho.createPrototypeNode(co,ho.objectInherit(ho.Node.prototype,{init:function(){var e=this._geometry,t=e.getOrCreateStateSet();for(var i in t.setAttributeAndModes(Ze.Z.DEPTH_LEQUAL_BACKGROUND_NO_WRITE,ho.StateAttribute.PROTECTED),t.setRenderBinDetails(Me.Z.BACKGROUND,"RenderBin"),t.setAttributeAndModes(we.Z.getOrCreateShader(lo,uo,"environment-background","Environment")),t.setTextureAttributeAndModes(0,ao.Z.dummyTexture),so)t.addUniform(so[i]);this.addChild(e)},rescale:function(e,t){e&&(this._canvasWidth=e),t&&(this._canvasHeight=t);var i=this._canvasWidth/this._canvasHeight,n=so.scale.getInternalArray();i>=this._texRatio?(n[0]=1,n[1]=this._texRatio/i):(n[0]=i/this._texRatio,n[1]=1)},getBackground:function(){return this._bgFixed},getEnvironment:function(){return this._bgEnv},hide:function(){this._show="NONE",this._update()},showColor:function(){this._show="COLOR",this._update()},showEnvironment:function(){this._show="ENV",this._update()},setEnvironment:function(e,t){this._bgEnv=e,void 0!==t&&so.size.setFloat(t),this._update()},setExposure:function(e){so.backgroundExposure.setFloat(e)},showAmbient:function(){this._show="AMBIENT",this._update()},showBackground:function(){this._show="FIXED",this._update()},setBackground:function(e){this._texRatio=e.getWidth()/e.getHeight(),this._bgFixed=e,this._update()},_update:function(){k.Z.draw(),"ENV"===this._show||"AMBIENT"===this._show?(this._geometry.setNodeMask(-1),so.ambient.getInternalArray()[0]="AMBIENT"===this._show,this._bgEnv&&"ENV"===this._show&&this._geometry.getOrCreateStateSet().setTextureAttributeAndModes(0,this._bgEnv)):this._geometry.setNodeMask(0)}}),"osgSketchfab","Background");const Ao=co;var go=A.Z.osg;const fo={environmentTransform:go.Uniform.createMatrix3("uEnvironmentTransform"),exposure:go.Uniform.createFloat1(1,"uEnvironmentExposure"),diffuseSPH:go.Uniform.createFloat3Array(new Float32Array(27),"uDiffuseSPH"),textureSpecular:go.Uniform.createInt1("sEnvironmentSpecular"),textureSpecularPBR:go.Uniform.createInt1("sSpecularPBR"),textureIntegrateBRDF:go.Uniform.createInt1("sIntegrateBRDF"),factorShadowEnv0:go.Uniform.createFloat(0,"uFactorShadowEnv0")};var po=A.Z.osg,mo=function(e,t){this._texture=e,this._channel=t||"Specular",this._isCubemap=!1,this._hash="Specular"===t?"EnvSpec":"SpecularPBR"===t?"EnvSpecPBR":"EnvBRDF"};mo.uniforms={},po.createPrototypeStateAttribute(mo,po.objectInherit(po.Texture.prototype,{attributeType:"Texture",channelType:["Specular","SpecularPBR","IntegrateBRDF"],getUniformName:function(e){return"uTextureEnvironment"+this.getChannel()+e},getOrCreateUniforms:function(){var e=mo.uniforms,t=this.getChannel();if(e[t])return e[t];var i=this._texture;return e[t]={size:po.Uniform.createFloat2([i.getWidth(),i.getHeight()],this.getUniformName("TextureSize"))},e[t]},setIsCubemap:function(e){this._isCubemap=e},getIsCubemap:function(){return this._isCubemap},getUniforms:function(){return fo},getTexture:function(){return this._texture},getChannel:function(){return this._channel},cloneType:function(){return new mo(new po.Texture)},getHash:function(){return this._hash},updateLodRange:function(e){var t=this.getOrCreateUniforms(),i=Math.log(this._texture.getWidth())/Math.LN2,n=i-Math.log(e)/Math.LN2;if(t.lodRange){var r=t.lodRange.getInternalArray();r[0]=i,r[1]=n}else t.lodRange=po.Uniform.createFloat2([i,n],this.getUniformName("LodRange"))},apply:function(e,t){var i=this._texture;void 0!==i&&i.apply(e);var n=this.getOrCreateUniforms(t).size.getInternalArray();n[0]=i.getWidth(),n[1]=i.getHeight()}}),"osgSketchfab","TextureEnvironment");const _o=mo;var vo=i("+HSU"),Co=A.Z.osg,bo=function(e){Co.Node.call(this),this.getOrCreateStateSet(),this._enable=!0,this._viewer=e,this._isPBR=!1,this._textureSpecular=void 0,this._textureSpecularUnit=6,this._textureSpecularPBR=void 0,this._textureIntegrateBRDF=void 0,this._textureSpecularPBRUnit=6,this._textureIntegrateBRDFUnit=8,this._nodeBackground=new Ao,this._adjustRotation=Co.mat4.fromXRotation(Co.mat4.create(),Math.PI/2),this._root=new Co.MatrixTransform,Co.mat4.multiply(this._root.getMatrix(),this._root.getMatrix(),this._adjustRotation),this._lightProbes=[];var t=io("Environment",3,Qt.DIRECTION);this._light=t.light,this._mtLight=t.node,this._shadow=t.shadowMap,this._mtLight.addChild(t.lightSource),this._lightIntensity=1,this._lightShadowEnabled=!1,this._shadowBias=5e-4,this._shadowedScene=void 0,this._lightNodeRoot=new Co.MatrixTransform,this._lightNodeRoot.setName("Env Lighting - Light"),Co.mat4.copy(this._lightNodeRoot.getMatrix(),this._root.getMatrix()),this._lightNodeRoot.addChild(this._mtLight),this.addUpdateCallback(this),Ci.Z.bind("change:mask",this.updateLightShadow,this)};Co.createPrototypeNode(bo,Co.objectInherit(Co.Node.prototype,{getBackground:function(){return this._nodeBackground},enable:function(){this._enable=!0,this.setTexturesStateSet(),k.Z.draw()},disable:function(){this._enable=!1,this.removeTexturesStateSet(),k.Z.draw()},setBackgroundExposure:function(e){this._nodeBackground.setExposure(e),k.Z.draw()},setBackgroundTexture:function(e,t){this._nodeBackground.setEnvironment(e,t),k.Z.draw()},createCameraNode:function(){var e={},t=this,i=Co.mat4.create(),n=fo.environmentTransform.getInternalArray(),r=new Co.Camera;return r.setName("Environment - Camera"),r.setCullCallback(new function(){this.cull=function(r,a){Co.mat4.getPerspective(e,t._mainCamera.getProjectionMatrix()),Co.mat4.perspective(a.getCurrentProjectionMatrix(),e.fovy*Math.PI/180,e.aspectRatio,1,1e3),Co.mat4.copy(a.getCurrentModelViewMatrix(),t._mainCamera.getViewMatrix()),Co.mat4.setTranslation(a.getCurrentModelViewMatrix(),Co.vec3.ZERO);var o=a.getCurrentModelViewMatrix();return Co.mat4.multiply(i,o,t._root.getMatrix()),Co.mat3.fromMat4(n,i),Co.mat3.transpose(n,n),!0}}),r.setReferenceFrame(Co.Transform.ABSOLUTE_RF),vo.Z.cameraEnvironment=r,r},init:function(e,t){for(var i in this._mainCamera=e,this._shadowedScene=t,this._shadowedScene.addChild(this._lightNodeRoot),fo)this.getStateSet().addUniform(fo[i]);var n=this.createCameraNode();n.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this.addChild(n),n.addChild(this._root),this._root.addChild(this._nodeBackground),this.updateTextureUnits(),this.updateLightShadow()},setLightShadowEnabled:function(e){this._lightShadowEnabled=e&&(0,l.Z)().shadow,this.updateLightShadow()},setLightIntensity:function(e){this._lightIntensity=e,this.updateLightColorAndIntensity(),k.Z.draw()},setShadowBias:function(e){this._shadowBias=e,this._shadow&&(this._shadow.setBias(e),this._shadow.requestRedraw(),k.Z.draw())},setLightProbes:function(e){this._lightProbes=e,this.updateLightShadow()},removeTexturesStateSet:function(){var e=this.getStateSet();e&&(this._isPBR?(this._textureSpecularPBR&&e.removeTextureAttribute(this._textureSpecularPBRUnit,this._textureSpecularPBR.getTypeMember()),this._textureIntegrateBRDF&&e.removeTextureAttribute(this._textureIntegrateBRDFUnit,this._textureIntegrateBRDF.getTypeMember())):this._textureSpecular&&e.removeTextureAttribute(this._textureSpecularUnit,this._textureSpecular.getTypeMember()))},setTexturesStateSet:function(){var e=this.getStateSet();e&&(this._isPBR?(this._textureSpecularPBR&&e.setTextureAttributeAndModes(this._textureSpecularPBRUnit,this._textureSpecularPBR),this._textureIntegrateBRDF&&e.setTextureAttributeAndModes(this._textureIntegrateBRDFUnit,this._textureIntegrateBRDF)):this._textureSpecular&&e.setTextureAttributeAndModes(this._textureSpecularUnit,this._textureSpecular))},updateLightColorAndIntensity:function(){if(this._light&&0!==this._lightProbes.length){var e=fo.exposure.getInternalArray()[0]/this._defaultExposure,t=this._lightProbes[0].color;Co.vec3.normalize(t,t),Co.vec3.scale(this._light.getDiffuse(),t,this._lightIntensity*e)}},setDefaultExposure:function(e){this._defaultExposure=e},setExposure:function(e){fo.exposure.setFloat(e),this.updateLightColorAndIntensity()},updateLightFromProbes:function(){var e=this._lightProbes[0].direction,t=Math.abs(e[2])>.999?Co.vec3.fromValues(0,1,0):Co.vec3.fromValues(0,0,1),i=this._mtLight.getMatrix();Co.mat4.lookAtDirection(i,Co.vec3.ZERO,e,t),Co.mat4.invert(i,i),this.updateLightColorAndIntensity(),(0,l.Z)().debugEnvShadow&&this._debugShadow()},_debugShadow:function(){if(!this._debugDone){this._debugDone=!0;var e=Co.createAxisGeometry(),t=new Co.MatrixTransform;t.setMatrix(Co.mat4.fromScaling(Co.mat4.create(),[100,100,-500])),Co.mat4.setTranslation(t.getMatrix(),[0,0,500]),t.addChild(e);var i=new Ga.createDirectionalGeometry(5);t.addChild(i),t.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._mtLight.addChild(t)}},isUsingLightShadow:function(){return Ci.Z.get("mask")&Ci.Z.LIT&&this._lightShadowEnabled&&this._lightProbes.length>0},updateLightShadow:function(){if(this._shadowedScene){var e=this.isUsingLightShadow();if(this._light.setEnabled(e),ro(this._shadowedScene,this._shadow),e){var t=(0,cr.Z)();((0,l.Z)().shadowAtlas&&t>7||t>12)&&no(this._shadowedScene,this._shadow),this._shadow.setBias(this._shadowBias),Co.mat4.copy(this._lightNodeRoot.getMatrix(),this._root.getMatrix()),this.updateLightFromProbes(),this._shadow.requestRedraw(),k.Z.draw()}}},update:function(e,t){if(e.getNumChildrenRequiringUpdateTraversal()>0&&t.traverse(e),!this._light||!this._shadow)return!1;var i=this._viewer.getFeaturesManager();return i&&i.getShadowForcedUpdate()&&this._shadow.requestRedraw(),!1},updateShadow:function(){this._light&&this._shadow&&this._shadow.requestRedraw()},updateRotation:function(e){Co.mat4.fromZRotation(this._root.getMatrix(),-e),Co.mat4.multiply(this._root.getMatrix(),this._root.getMatrix(),this._adjustRotation),Co.mat4.copy(this._lightNodeRoot.getMatrix(),this._root.getMatrix()),this._shadow&&this._shadow.requestRedraw()},setDiffuseSPH:function(e){for(var t=fo.diffuseSPH.getInternalArray(),i=1/(2*Math.sqrt(Math.PI)),n=-.5*Math.sqrt(3/Math.PI),r=-n,a=n,o=.5*Math.sqrt(15/Math.PI),s=-o,l=.25*Math.sqrt(5/Math.PI),u=s,h=.25*Math.sqrt(15/Math.PI),c=[i,i,i,n,n,n,r,r,r,a,a,a,o,o,o,s,s,s,l,l,l,u,u,u,h,h,h],A=0;A<27;++A)t[A]=e[A]*c[A]},setSpecularTexture:function(e){this._enable&&(this._textureSpecular=new _o(e,"Specular"),this._textureSpecular.setIsCubemap(!0),this.updateTextureUnits(),fo.textureSpecular.setInt(this._textureSpecularUnit),k.Z.draw())},setSpecularPBRTexture:function(e,t){if(this._enable){this._textureSpecularPBR=new _o(e,"SpecularPBR");var i="TextureCubeMap"===e.className();this._textureSpecularPBR.setIsCubemap(i),this._textureSpecularPBR.updateLodRange(t),this.updateTextureUnits(),fo.textureSpecularPBR.setInt(this._textureSpecularPBRUnit),k.Z.draw()}},setIntegrateBRDFTexture:function(e){this._enable&&(this._textureIntegrateBRDF=new _o(e,"IntegrateBRDF"),this.updateTextureUnits(),fo.textureIntegrateBRDF.setInt(this._textureIntegrateBRDFUnit),k.Z.draw())},updateTextureUnits:function(){this.setTexturesStateSet()},setIsPBR:function(e){this._isPBR=e}}),"osgSketchfab","Environment");const So=bo;var Eo,yo,Io=i("gmtI"),xo=A.Z.osg,To=A.Z.InputGroups;var wo={FeatureName:"environment",ModelType:Na,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._inputManager=this._viewer.getInputManager(),this._nodeEnvironment=new So(this._viewer),this._nodeEnvironment.setName("Feature - Environment"),this._backgroundLoaded={},this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change:exposure",this.onExposureChanged,this),this.model.bind("change:backgroundExposure",this.onExposureChanged,this),this.model.bind("change:rotation",this.onRotationChanged,this),this.model.bind("change:uid",this.onUIDChanged,this),this.model.bind("updateBackground",this.onBackgroundEnableChanged,this),this.model.bind("change:blur",this.onBlurChanged,this),Ci.Z.bind("change:mask",this.onEnvironmentChanged,this),this.model.bind("change",k.Z.draw),this._resourceDefer=new Ct.Z,this.options.context.getScene().addResourcePromise(this._resourceDefer),this.model.bind("change:shadowEnable",this.onShadowEnable,this),this.model.bind("change:shadowBias",this.onShadowBiasChanged,this),this.model.bind("change:lightIntensity",this.onLightIntensityChanged,this),F.Z.getMaterial().then(function(){this.initEnvironment(),this.initRotateEnvironment()}.bind(this))},getBackgroundEnableType:function(){var e=this._viewer.getFeatures().background;return e?e.getModel().getEnableType():"none"},isBackgroundEnvironment:function(){return"environment"===this.getBackgroundEnableType()},initEnvironment:function(){this.onRotationChanged(),this.onExposureChanged(),this.onEnableChanged(),this.model.get("enable")||F.Z.resolveDataSizeEnvironment(0)},initRotateEnvironment:function(){this._viewer.getViewerOSGJS()&&(this._rotEnv=!1,this.mx_=0,Ue.Z.initEnvironment(this))},startRotate:function(e){this._rotEnv=!0,this.mx_=e.canvasX,this._inputManager.setEnable(To.MANIPULATORS,!1)},_computeDelta:function(e){k.Z.draw();var t=(e.canvasX-this.mx_)/100;return this.mx_=e.canvasX,t},rotateEnv:function(e,t){if(this._rotEnv){t||(t=this._computeDelta(e));var i=(this.model.get("rotation")+t)%(2*Math.PI);this.model.set("rotation",i<0?i+2*Math.PI:i)}},rotateLight:(Eo=xo.mat4.create(),yo=xo.mat4.create(),function(e,t){if(this._rotEnv){t||(t=this._computeDelta(e));var i=this.options.context.getFeatures().lighting;if(i){var n=this._viewer.getFeaturesManager().getWorldNode().getMinimumBound().center();xo.mat4.fromZRotation(Eo,-t%(2*Math.PI)),xo.vec3.negate(n,n),xo.mat4.multiply(Eo,Eo,xo.mat4.fromTranslation(yo,n)),xo.vec3.negate(n,n),xo.mat4.multiply(Eo,xo.mat4.fromTranslation(yo,n),Eo);for(var r=i.getModel().get("lights"),a=0,o=r.length;a<o;++a){var s=r[a];if(!s.isAttachedToCamera()){var l=s.get("matrix");xo.mat4.multiply(l,Eo,l),s.dirty()}}}}}),rotateEnvAndLight:function(e){if(this._rotEnv){var t=this._computeDelta(e);this.rotateEnv(e,t),this.rotateLight(e,t)}},endRotate:function(){this._rotEnv&&(this._rotEnv=!1,this._inputManager.setEnable(To.MANIPULATORS,!0))},onUIDChanged:function(){this.model.updateEnvironmentConfig(),this.onEnvironmentChanged(),this.onBackgroundEnableChanged()},getRotating:function(){return this._rotEnv},getNodeEnvironment:function(){return this._nodeEnvironment},getResourceManager:function(){return this._resourceManager||s.Z.instance},onEnableChanged:function(){this.model.get("enable")?(this._nodeEnvironment.enable(),this._nodeEnvironment.setLightShadowEnabled(this.model.get("shadowEnable")),this._nodeEnvironment.setLightIntensity(this.model.get("lightIntensity")),this._nodeEnvironment.setShadowBias(this.model.get("shadowBias"))):(this._nodeEnvironment.disable(),this._nodeEnvironment.setLightShadowEnabled(!1)),this.onEnvironmentChanged()},onShadowEnable:function(){var e=this.getEnvironment().get("lights");!this.model.get("shadowEnable")||e&&0!==e.length?this._nodeEnvironment.setLightShadowEnabled(this.model.get("shadowEnable")):this.model.set("shadowEnable",!1)},onShadowBiasChanged:function(){this._nodeEnvironment.setShadowBias(this.model.get("shadowBias"))},onLightIntensityChanged:function(){this._nodeEnvironment.setLightIntensity(this.model.get("lightIntensity"))},onExposureChanged:function(){this._nodeEnvironment.setExposure(this.model.get("exposure")),this._nodeEnvironment.setBackgroundExposure(this.model.get("backgroundExposure"))},onRotationChanged:function(){this._nodeEnvironment.updateRotation(this.model.get("rotation"))},onBlurChanged:function(){this.abortLastDownloadEnv(),this.isBackgroundEnvironment()&&this.setBackgroundTexture()},onBackgroundEnableChanged:function(){var e=this.getBackgroundEnableType();"environment"===e?this.setBackgroundTexture():"ambient"===e&&this.setBackgroundAmbient()},resolvePreload:function(){this._resourceDefer&&(this._resourceDefer.resolve(),this._resourceDefer=void 0)},onEnvironmentChanged:function(){var e=this.getEnvironment();e&&this.model.get("enable")?(this._onlyLowRes=!0,this.setEnvironment(e).then(function(){var t=e.get("uid")===this.model.get("uid");(0,l.Z)().preload&&t||this.resolvePreload(),t&&(this._onlyLowRes=!1,this.setEnvironment(e).finally(this.resolvePreload.bind(this)))}.bind(this))):this.resolvePreload()},getEnvironment:function(){return this.model.getEnvironment()},getName:function(){return"Environment3D"},abortLastDownloadEnv:function(){for(var e=this.model.get("uid"),t=this.model.get("blur"),i=this.getResourceManager()._resourceLoader._processing,n=0,r=i.length;n<r;++n){var a=i[n],o=a.getXHR();o&&(void 0!==a._envUID&&a._envUID!==e&&o.abort(),void 0!==a._envBlur&&a._envBlur!==t&&o.abort())}},setEnvironment:function(e){this.abortLastDownloadEnv();var t=[];if(Ci.Z.get("mask")&Ci.Z.LIT){var i=Ci.Z.get("mask")&Ci.Z.PBR;this._nodeEnvironment.setIsPBR(i),this._nodeEnvironment.setDiffuseSPH(e.get("diffuseSPH"));var n=e.get("lights")||[];this._nodeEnvironment.setLightProbes(n,e.id),this.model.get("shadowEnable")&&this.model.set("shadowEnable",n.length>0),this._nodeEnvironment.setDefaultExposure(e.get("brightness")),i?this.setEnvironmentPBR(e,t):this.setEnvironmentOld(e,t),this.setProgress(t.slice(),"environment")}return this.isBackgroundEnvironment()&&t.push(this.setBackgroundTexture()),0===t.length?c().resolve():c().all((0,vt.Z)(t,(function(e){return e.reflect()})))},setEnvironmentPBR:function(e,t){var i=this._nodeEnvironment,n=e.get("textures"),r=!1;xo.WebGLCaps.instance().getWebGLExtension("EXT_shader_texture_lod")&&(r=!0),(0,l.Z)().panorama&&(r=!1);var a=(0,Xn.Z)(n,{encoding:"luv",type:"specular_ue4",format:r?"cubemap":"panorama"}),o=this.getImageRes(a),s={cubemap:r,panoramaLUV:!r,cubemapLUV:r,size:o.width,minFilter:r?xo.Texture.LINEAR_MIPMAP_LINEAR:xo.Texture.LINEAR,magFilter:xo.Texture.LINEAR,wrapS:xo.Texture.CLAMP_TO_EDGE,wrapT:xo.Texture.CLAMP_TO_EDGE,transferToGPU:!0,internalFormat:xo.Texture.RGBA},u=this.getResourceManager().getOrCreateTexture(o.file,s);this.markLastXHR(this.model.get("uid")),u.texture.setFlipY(!r),this._onlyLowRes&&i.setSpecularPBRTexture(u.texture,a.limitSize);var h=this.getPromiseTexture(u);h.then(i.setSpecularPBRTexture.bind(i,u.texture,a.limitSize)),t.push(h);var c=o.sizeCompressed,A=(0,cr.Z)();if(!kr.default.any&&A>8){var d=(0,Xn.Z)(n,{type:"brdf_ue4"});s={integrateBRDFLUV:!0,minFilter:xo.Texture.NEAREST,magFilter:xo.Texture.NEAREST,wrapS:xo.Texture.CLAMP_TO_EDGE,wrapT:xo.Texture.CLAMP_TO_EDGE,transferToGPU:!0,internalFormat:xo.Texture.RGBA},c+=(o=this.getImageRes(d)).sizeCompressed;var g=this.getResourceManager().getOrCreateTexture(o.file,s);this.markLastXHR(this.model.get("uid")),g.texture.setFlipY(!1),i.setIntegrateBRDFTexture(g.texture);var f=this.getPromiseTexture(g);f.then(i.setIntegrateBRDFTexture.bind(i,g.texture)),t.push(f)}F.Z.resolveDataSizeEnvironment(c)},getBackgroundResource:function(e,t,i){var n,r=(0,Xn.Z)(e,{encoding:"luv",type:"background",format:"cubemap"});return n=void 0!==i?this.getClosestBlur(r,i):this.getImageRes(r,512),t.cubemap=!0,t.cubemapLUV=!0,t.size=n.width,t.minFilter=xo.Texture.LINEAR,t.magFilter=xo.Texture.LINEAR,t.wrapS=xo.Texture.CLAMP_TO_EDGE,t.wrapT=xo.Texture.CLAMP_TO_EDGE,t.transferToGPU=!0,t.internalFormat=xo.Texture.RGBA,n},setEnvironmentOld:function(e,t){var i=this._nodeEnvironment,n={},r=this.getBackgroundResource(e.get("textures"),n),a=this.getResourceManager().getOrCreateTexture(r.file,n);this.markLastXHR(this.model.get("uid")),this._onlyLowRes&&i.setSpecularTexture(a.texture);var o=this.getPromiseTexture(a);o.then(i.setSpecularTexture.bind(i,a.texture)),F.Z.resolveDataSizeEnvironment(r.sizeCompressed),t.push(o)},setBackgroundTexture:function(){var e=this.getEnvironment();if(!e)return c().reject(new Error);var t={},i=this.getBackgroundResource(e.get("textures"),t,this.model.get("blur")),n=this._backgroundLoaded;if(this.getRequestLowRes()){if(n[i.file])return n[i.file].promise;i=this.getBackgroundResource(e.get("textures"),t,1)}var r=this._nodeEnvironment,a=this.getResourceManager().getOrCreateTexture(i.file,t);this.markLastXHR(this.model.get("uid"),this.model.get("blur"));var o=this.getPromiseTexture(a);return o.then((function(){r.setBackgroundTexture(a.texture,i.width),n[i.file]=a})),this.setProgress(o,"background"),o},setProgress:function(e,t){var i=this._viewer.setFakeSecondaryProgress.bind(this._viewer,e,t);F.Z.getHighResLoaded().then(i)},setBackgroundAmbient:function(){var e=this.getEnvironment();return e?(this._nodeEnvironment.setDiffuseSPH(e.get("diffuseSPH")),c().resolve()):c().reject(new Error)},markLastXHR:function(e,t){var i=this.getResourceManager()._resourceLoader._processing;if(i.length>0){var n=i[i.length-1];n._envUID=e,void 0===t||this.getRequestLowRes()||(n._envBlur=t)}},getPromiseTexture:function(e){return this._onlyLowRes||(0,l.Z)().preload?e.promise:c().all([e.promise,F.Z.getFirstCameraAnimation()])},getRequestLowRes:function(){return this._onlyLowRes&&!(0,l.Z)().preload},getImageRes:function(e,t){var i=new Io.Z(e);if(this.getRequestLowRes())return i.findImageSmallest();var n=void 0!==t?t:1/0;return i.findImageNearestPowerOfTwoUpToResolution(n,n)},getClosestBlur:function(e,t){for(var i=e.images,n=0,r=1/0,a=0,o=i.length;a<o;++a){var s=Math.abs(i[a].blur-t);s<r&&(n=a,r=s)}return i[n]}})]},Mo=n.Z.create(wo);Mo.prototype=(0,xa.Z)({},n.Z.prototype,{getNode:function(){return this._views[0].getNodeEnvironment()},getRotating:function(){return this._views[0].getRotating()}});const Ro=Mo;var Bo=A.Z.osg;const No=a.Z.extend({_trashbin:[],getModelOptionPath:function(){return"background"},defaults:function(){return{webVR:!1}},init:function(e){this.backgroundCollection=s.Z.instance.getBackgroundCollection(),this._defaultBackground=this.get("uid"),this.set("enable",(0,di.Z)()?"color":"fixed");var t=e.getModel().get("options").background;t&&this.setJSON(t),(0,l.Z)().transparent&&this.set("enable","none");var i=e.getViewer();(0,di.Z)()&&F.Z.getPolygon().then(function(){"Tilt Brush"===i.getRootUserData().authoringTool&&(this.set("enable","color"),this.set("color",Bo.vec3.create()))}.bind(this)),(0,o.Z)()&&(0,l.Z)().apiLog&&(console.log("------"),console.log("Viewer Api Background uid list:"),this.backgroundCollection.each((function(e){console.log("- "+e.get("name")+": "+e.get("uid"))})),console.log("------"))},getName:function(){return"Background"},setBackground:function(e){return this.setBackgroundUID(e.uid)},setBackgroundUID:function(e){e&&this.set("uid",e)},getBackground:function(){if(this.backgroundCollection){var e=this.get("uid"),t=this.backgroundCollection.find((function(t){return t.get("uid")===e||t.get("id")===e}));if(t)return t;this.set("uid",this._defaultBackground)}},resetToDefaultBackground:function(){return this.set("uid",this._defaultBackground),this},getEnableType:function(){var e=this.get("enable");return"fixed"!==e&&"none"!==e||!this.get("webVR")||(0,l.Z)().vrAr?e:"ambient"},getColor:function(){return this.get("color")},validate:function(e,t){var i=a.Z.prototype.validate.call(this,e,t),n=this.get("uid");n!==this._defaultBackground&&(this.getBackground()||console.warn("Couldn't find background "+n));return i},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){return this.setJSON(e,{validate:!0})}});var Do=A.Z.osg;var Po={FeatureName:"background",ModelType:No,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change:webVR",this.onEnableChanged,this),this.model.bind("change:uid",this.onBackgroundChanged,this),this.model.bind("change",k.Z.draw),this._viewer=this.options.context.getViewer();var e=this.options.context.getFeatures().environment;e&&(this._resourceDefer=new Ct.Z,this.options.context.getScene().addResourcePromise(this._resourceDefer.promise),this._modelEnvironment=e.getModel(),this._nodeBackground=e.getNode().getBackground(),this._nodeBackground.addUpdateCallback(this),F.Z.getMaterial().then(this.onEnableChanged.bind(this)),this._viewer=this.options.context.getViewer())},getResourceManager:function(){return this._resourceManager||s.Z.instance},onBackgroundChanged:function(){var e=this.model.getBackground();if(e){var t=this.options.context.getViewer(),i=Math.max((0,Vr.Z)(t.getWidth()),(0,Vr.Z)(t.getHeight())),n=e.findImageNearestToResolution(i,i).url;return this.getResources(n)}},getResources:function(e){for(var t={minFilter:Do.Texture.LINEAR,magFilter:Do.Texture.LINEAR,transferToGPU:!0,convertNPOT:!1,backgroundUid:this.model.get("uid"),internalFormat:Do.Texture.RGB},i=this.getResourceManager()._resourceLoader._processing,n=0;n<i.length;++n){var r=i[n],a=r._options;a&&a.backgroundUid&&a.backgroundUid!==this.model.get("uid")&&r.abort()}var o=this.getResourceManager().getOrCreateTexture(e,t);o.promise.then(function(e){this._nodeBackground.setBackground(e),this._nodeBackground.rescale(this._viewWidth,this._viewHeight),this.model.trigger("backgroundUpdated",e),this._viewer.trigger("backgroundLoaded"),"fixed"===this.model.getEnableType()&&this._nodeBackground.showBackground()}.bind(this));var s=this.options.context.getViewer();return this._resourceDefer?(o.promise.finally(this._resourceDefer.resolve.bind(this._resourceDefer)),this._resourceDefer=void 0):F.Z.getHighResLoaded().then(s.setFakeSecondaryProgress.bind(s,o.promise,"background")),o.promise},onEnableChanged:function(){var e=this.model.getEnableType();"color"===e?this._nodeBackground.showColor():"fixed"===e?this._nodeBackground.getBackground()?this._nodeBackground.showBackground():void 0!==this.model.get("uid")&&this.onBackgroundChanged():"environment"===e?(this._modelEnvironment.trigger("updateBackground"),this._nodeBackground.showEnvironment()):"ambient"===e?(this._modelEnvironment.trigger("updateBackground"),this._nodeBackground.showAmbient()):"none"===e&&this._nodeBackground.hide(),this._resourceDefer&&(this._resourceDefer.resolve(),this._resourceDefer=void 0)},requireBiggerTexture:function(){var e=this.options.context.getViewer(),t=Math.max((0,Vr.Z)(e.getWidth()),(0,Vr.Z)(e.getHeight())),i=this.model.getBackground();if(i){var n=i.findImageNearestUpToResolution(t,t);if(void 0!==this._nodeBackground&&!this._nodeBackground.getBackground())return!1;if(n.width<this._nodeBackground.getBackground().getWidth())return!1}return!0},update:function(){if("fixed"!==this.model.getEnableType())return!0;var e=this._viewer.getCamera().getViewport(),t=e.width(),i=e.height();return this._viewWidth===t&&this._viewHeight===i||(this._viewWidth=t,this._viewHeight=i,!0===this.requireBiggerTexture()&&this.onBackgroundChanged(),this._nodeBackground.rescale(t,i)),!0}})]};const Fo=n.Z.create(Po);var Oo=i("3r8u"),Lo=i("Smlm"),ko=i("gQUg"),Zo=i("BTJo"),Uo=i("MDIC"),Vo=A.Z.osg,Qo=function(e){var t=Vo.vec3.create(),i=Vo.vec3.create();if(e.getFeatures().camera.getModel().getCameraPosition(t,i),this.set("eye",t),this.set("target",i),(0,o.Z)()){var n=e.getScreenShot(128,128).toDataURL("image/jpeg");this.set("uidImage",void 0),this.set("imageFile",(0,ko.Z)(n)),this.set("preview",n)}};const Go=a.Z.extend({getModelOptionPath:function(){return"hotspot"},defaults:function(){return{webVR:!1,currentHotspotIndex:-1}},getName:function(){return"Hotspot"},getResourceManager:function(){return this._resourceManager||s.Z.instance},init:function(e){var t=this.getResourceManager().getHotspotCollection();this.set("hotspots",t),t.on("remove",this.onRemove,this),this._viewer=e.getViewer(),this.hotspotsToBeDeleted=[];var i=e.getModel().get("options").hotspot;this.setJSON(i)},onRemove:function(e){e.isNew()||this.hotspotsToBeDeleted.push(e)},setUpdateCallback:function(e){this.callback=e},_hotspotInitialize:function(e,t,i){return this.get("visible")||this.set("visible",!0),e.add(t,{sort:!1}),t.set("order",e.indexOf(t)),t.set("refreshAction",Qo.bind(t,this._viewer)),t.get("refreshAction")(),void 0===i&&e.trigger("select",t),this.get("started")||this.set("started",!0),t},preventHotspotCameraAction:function(e,t){this.get("hotspots").each((function(i){i.set("cameraPreventAnimation",e),i.set("cameraPreventMove",t)}))},createHotspotFromWorldPosition:function(e,t,i){var n=this.get("hotspots"),r=new Zo.Z;return r.set("building",i),r.set("uid","tmp_"+(0,Oo.Z)()),(0,Uo.D1)(r,e),this._hotspotInitialize(n,r,t)},createHotspotFromScenePosition:function(e,t,i){var n=this.get("hotspots"),r=new Zo.Z;return r.set("building",i),r.set("uid","tmp_"+(0,Oo.Z)()),(0,Uo.cW)(r,e),this._hotspotInitialize(n,r,t)},createHotspot:function(e,t){var i=this.get("hotspots"),n=new Zo.Z;return n.set("uid","tmp_"+(0,Oo.Z)()),(0,Uo.hP)(n,e),this._hotspotInitialize(i,n,t)},setJSON:function(e,t){if(t&&t.validate){var i=this.validate(e);if(i.length)return i.join("\n")}void 0!==(0,l.Z)().annotationsVisible?this.set("visible",(0,l.Z)().annotationsVisible):void 0!==e.visible?this.set("visible",e.visible):this.set("visible",!0);var n=e&&e.hotspots&&(0,Lo.Z)(e.hotspots,"uid"),r=this.get("hotspots");return r.each(function(e){e.collection=null;var t=e.get("images")[0];t&&(e.set("uidImage",t.uid),e.set("imageFile",(0,ko.Z)(t.url)),e.set("preview",t.url)),e.set("refreshAction",Qo.bind(e,this._viewer));var i=n&&n[e.get("uid")];i&&(e.set("geometryUid",i.geometryUid),e.set("indices",i.indices),e.set("barycentricWeights",i.barycentricWeights),e.set("localPosition",i.localPosition)),r.add(e)}.bind(this)),[]},getJSON:function(){var e=[];return this.get("hotspots").each((function(t){var i={uid:t.get("uid"),geometryUid:t.get("geometryUid"),indices:t.get("indices"),barycentricWeights:t.get("barycentricWeights"),localPosition:t.get("localPosition")};e.push(i)})),(0,o.Z)()&&(0,l.Z)().apiLog&&(console.log("------"),console.log("Viewer API environment hotspot list:"),this.get("hotspots").each((function(e){var t={ScenePosition:e.get("lastComputedScenePosition"),WorldPosition:e.get("lastComputedWorldPosition"),eye:e.get("eye"),target:e.get("target"),title:e.get("name"),text:e.get("content")?e.get("content").raw:""};console.log(t)})),console.log("------")),{hotspots:e,visible:this.get("visible")}}});var Ho=i("510x"),zo=i("O8uY"),Wo=i("PSPx"),jo={STRIP:Uint16Array,TRIANGLES:Uint16Array,VERTEX:Float32Array,NORMAL:Float32Array,COLOR:Float32Array},qo=function(e){for(var t in e){var i=e[t];e[t]=i.length?new jo[t](i):qo(i)}return e};const Jo=function(e){Promise.all([i.e(6851),i.e(4693)]).then(i.bind(i,"nvpW")).then((function(t){e(t.default)}))},Yo=function(e){i.e(2057).then(i.bind(i,"Aymh")).then((function(t){e(qo(t.default))}))},Ko=function(e){i.e(6574).then(i.bind(i,"Dpmd")).then((function(t){e(qo(t.default))}))},Xo=function(e){i.e(7596).then(i.bind(i,"PYFv")).then((function(t){e(qo(t.default))}))},$o=function(e){i.e(376).then(i.bind(i,"13NL")).then((function(t){e(qo(t.default))}))},es=function(e){i.e(2420).then(i.bind(i,"+Kdv")).then((function(t){e(qo(t.default))}))},ts=function(e){i.e(1386).then(i.bind(i,"Y+ZG")).then((function(t){e(qo(t.default))}))};var is,ns,rs,as,os=i("wwK1"),ss=i("tkW9"),ls=A.Z.osg,us=ls.BufferArray,hs=ls.Geometry,cs=ls.primitiveSet,As=ls.DrawElements,ds=ls.vec4.fromValues(1,1,1,1),gs="WHOLE_PANEL",fs=function(e,t,i,n,r,a){ls.MatrixTransform.call(this),this._subX=void 0!==r?r:1,this._subY=void 0!==a?a:1,this._curveAxis=i,this._curveFactor=n,this._distanceFromCam=2.5,this._width=1,t&&(this._distanceFromCam=t),e&&(this._width=e),this._clickActions={},this._opacity=1,this._round=.02,this._opaqueRollover=!1,this._visible=!0,this._currentPage=0,this._enabled=!0};fs.AXIS_X=0,fs.AXIS_Y=1,fs.AXIS_BOTH=2,ls.createPrototypeNode(fs,ls.objectInherit(ls.MatrixTransform.prototype,{initialize:function(e,t){this._texPanel=e,this._metaData=this._computeMetaData(t),this._panelGeom=this._createGridGeometry(this._metaData.cells),this.addChild(this._panelGeom);var i=this._panelGeom.getOrCreateStateSet(),n=ls.Uniform.createFloat1(this._opacity,"uAlpha");this._uAlpha=n.getInternalArray(),i.addUniform(n);var r=ls.Uniform.createFloat1(t.aspectRatio,"uRatio");this._uRatio=r.getInternalArray(),i.addUniform(r);var a=ls.Uniform.createFloat1(this._enabled?1:.5,"uVeilFactor");this._uVeilFactor=a.getInternalArray(),i.addUniform(a),i.addUniform(ls.Uniform.createFloat1(this._opaqueRollover?1:0,"uHoveredOpaque"));var o=ls.Uniform.createFloat1(this._round,"uRound");i.addUniform(o),i.addUniform(ls.Uniform.createInt(0,"uTexturePanel")),i.setTextureAttributeAndModes(0,this._texPanel),i.setAttributeAndModes(Ze.Z.CULL_DISABLE);var s=we.Z.getOrCreateShader(os,ss,"textured-panel","TexturedPanel");i.setAttributeAndModes(s);var l=ls.Uniform.createFloat4(ds,"uHoveredArea");this._uHoveredArea=l.getInternalArray(),i.addUniform(l),i.setRenderBinDetails(Me.Z.VR_MENU,"RenderBin"),i.setAttributeAndModes(Ze.Z.BLEND_SUBSTRACTIVE),this.initPage(),this._initialized=!0},changeTexture:function(e){var t=this._panelGeom.getOrCreateStateSet();this._texPanel=e,t.setTextureAttributeAndModes(0,this._texPanel)},updateMetaData:function(e){this._metaData=this._computeMetaData(e),this._uRatio[0]=this._metaData.aspectRatio},setEnabled:function(e){this._enabled=e,this._uVeilFactor&&(this._uVeilFactor[0]=e?1:.5)},setMetaData:function(e){this._metaData=e,this._uRatio[0]=this._metaData.aspectRatio},getTexture:function(){return this._texPanel},isInitialized:function(){return this._initialized},setVisible:function(e){if(this._visible!==e){if(this._animation){if(!this._animation.isFinished())return;e&&this._doSetVisible(!0),this._animation.start(0)}else this._doSetVisible(e);this._visible=e}},_doSetVisible:function(e){this.setNodeMask(e?Te.Z.PICK_GEOMETRY_FAST:0),this._uAlpha&&(this._uAlpha[0]=1),e||this.initPage()},isVisible:function(){return this._visible},setOpacity:function(e){this._opacity=e,this._uAlpha&&(this._uAlpha[0]=e)},updateHit:function(e){if(this._initialized&&this._enabled){var t=e&&e._localIntersectionPoint;if(e&&-1!==e._nodePath.indexOf(this)){var i={x:(t[0]+.5*this._width)/this._width,y:(t[1]+.5*this._height)/this._height},n=this._metaData.pages?this._findPage(i):void 0,r=i.x,a=i.y;if(n){var o=n.areas;if(o)for(var s=0;s<o.length;s++)if(this._checkArea(o[s],r,a,n.items[s],n))return this}return this._currentHovered!==gs&&(this._currentHovered=gs,ls.vec4.copy(this._uHoveredArea,ds)),this}void 0!==this._currentHovered&&(this._currentHovered=void 0,ls.vec4.copy(this._uHoveredArea,ds))}},_findPage:function(e){for(var t=e.x,i=e.y,n=0;n<this._metaData.cells.length;n++){var r=this._metaData.cells[n],a=r.x/this._width,o=1-r.y/this._height,s=(r.x+r.width)/this._width,l=1-(r.y+r.height)/this._height;if(t>=a&&t<=s&&i<=o&&i>=l)return e.x=(t-a)/(s-a),e.y=(i-l)/(o-l),r.page}},_checkArea:function(e,t,i,n,r){return t>e[0]&&t<e[1]&&i<e[2]&&i>e[3]&&(this._currentHovered!==n&&(this._currentHovered=n,r?(this._uHoveredArea[0]=r.x+e[0]*r.width,this._uHoveredArea[1]=r.x+e[1]*r.width,this._uHoveredArea[2]=1-r.y-r.height+e[2]*r.height,this._uHoveredArea[3]=1-r.y-r.height+e[3]*r.height):ls.vec4.copy(this._uHoveredArea,e)),!0)},click:function(){if(this._currentHovered)if(this._currentHovered!==gs){var e=this._clickActions[this._currentHovered];e&&e()}else this._panelClickAction&&this._panelClickAction()},initPage:function(){this._metaData&&this._metaData.pages&&this.setPageForCell(this._metaData.pages[0].id,this._metaData.cells[0].id)},setPageForCell:function(e,t){var i=this._getPage(e);if(i){var n=this._getCell(t);if(n){n.page=i;for(var r=this._panelGeom.getAttributes().TexCoord0,a=r.getElements(),o=this._subY,s=this._subX,l=n.startIndex?n.startIndex:0,u=0;u<=o;u++)for(var h=0;h<=s;h++){var c=2*l;a[c]=i.x+h/s*i.width,a[c+1]=1-i.y-u/o*i.height,l++}r.dirty(),this._panelGeom.dirty()}else ls.log("can't find cell named "+t+" for panel "+(this._metaData?this._metaData.id:"unknown"))}else ls.log("can't find page named "+e+" for panel "+(this._metaData?this._metaData.id:"unknown"))},_getPage:function(e){if(this._metaData&&this._metaData.pages)for(var t=0;t<this._metaData.pages.length;t++)if(this._metaData.pages[t].id===e)return this._metaData.pages[t]},_getCell:function(e){var t=this._metaData&&this._metaData.cells;if(t)for(var i=0;i<t.length;++i)if(t[i].id===e)return t[i]},setClickAction:function(e,t){this._clickActions[e]=t},removeClickAction:function(e){delete this._clickActions[e]},setPanelClickAction:function(e){this._panelClickAction=e},removePanelClickAction:function(){this._panelClickAction=void 0},displayInView:(is=ls.vec3.create(),ns=ls.vec3.create(),rs=ls.vec3.fromValues(0,0,.1),as=ls.vec3.create(),function(e,t,i){ls.vec3.copy(is,t),is[2]=e[2];var n=ls.mat4.lookAt(this.getMatrix(),e,is,rs);ls.mat4.invert(n,n);var r=i;ls.mat4.scale(n,n,ls.vec3.set(ns,r,r,r)),ls.vec3.sub(as,is,e),ls.vec3.normalize(as,as),ls.vec3.scale(as,as,this._distanceFromCam*i),ls.vec3.add(as,e,as),as[2]+=-.2*i,ls.mat4.setTranslation(n,as),this.dirtyBound(),this.setVisible(!0)}),setAnimation:function(e){e.setOnFinishCallback(this._onAnimationFinished.bind(this)),this._animation=e,this.addUpdateCallback(e)},getAnimation:function(){return this._animation},_onAnimationFinished:function(){this._visible||this._doSetVisible(!1)},_computeMetaData:function(e){var t,i,n=(0,xa.Z)(e,{aspectRatio:e.cellsWidth?e.cellsWidth/e.cellsHeight:e.width/e.height});if(this._height=this._width/n.aspectRatio,n.pages)for(i=0;i<n.pages.length;i++){var r=n.pages[i];if(r.areas)for(t=0;t<r.areas.length;t++){var a=r.areas[t];a[0]=a[0]/r.width,a[1]=a[1]/r.width,a[2]=1-a[2]/r.height,a[3]=1-a[3]/r.height}r.x/=e.width,r.y/=e.height,r.width/=e.width,r.height/=e.height}if(n.cells&&n.cells.length>0)for(t=0;t<n.cells.length;t++){var o=n.cells[t];o.x=o.x/n.cellsWidth*this._width,o.y=o.y/n.cellsHeight*this._height,o.z/=100,o.width=o.width/n.cellsWidth*this._width,o.height=o.height/n.cellsHeight*this._height}else n.cells=[{id:"default",x:0,y:0,z:0,width:this._width,height:this._height}];return n},_createTexturedGridGeometry:function(e,t,i,n,r,a,o,s,l,u,h,c){t*=-1,s&&(l=void 0!==l?l:.2);for(var A=n/a,d=r/o,g=this._verticesIndex,f=0,p=0,m=this._indicesIndex,_=0,v=0,C=0;C<=o;C++)for(var b=0;b<=a;b++)f=3*g,h[p=2*g]=b/a,h[p+1]=1-C/o,s&&(s!==fs.AXIS_X&&s!==fs.AXIS_BOTH||(_=(_=b/a-.5)*_*l),s!==fs.AXIS_Y&&s!==fs.AXIS_BOTH||(v=(v=C/o-.5)*v*l)),u[f]=e+A*b,u[f+1]=t-d*C,u[f+2]=i+_+v,g++;var S=this._verticesIndex;this._verticesIndex=g;for(var E=0;E<a*o;E++)m=this._indicesIndex+6*E,g=S+E+Math.floor(E/a),c[m]=g,c[m+1]=a+1+g,c[m+2]=a+1+g+1,c[m+3]=a+1+g+1,c[m+4]=g+1,c[m+5]=g;this._indicesIndex=m+6},_createGridGeometry:function(e){var t=this._subY,i=this._subX,n=(i+1)*(t+1)*e.length,r=new hs,a=new Float32Array(3*n),o=new Float32Array(2*n),s=new Uint8Array(i*t*6*e.length);this._verticesIndex=0,this._indicesIndex=0;for(var l=.5*this._width,u=.5*this._height,h=0;h<e.length;h++){var c=e[h];c.startIndex=this._verticesIndex,this._createTexturedGridGeometry(c.x-l,c.y-u,c.z,c.width,c.height,i,t,this._curveAxis,this._curveFactor,a,o,s)}r.getAttributes().Vertex=new us(us.ARRAY_BUFFER,a,3),r.getAttributes().TexCoord0=new us(us.ARRAY_BUFFER,o,2);var A=new As(cs.TRIANGLES,new us(us.ELEMENT_ARRAY_BUFFER,s,1));return r.getPrimitives().push(A),r}}),"osgSketchfab","TexturedPanel");const ps=fs;var ms=i("5Eyw"),_s=i.n(ms),vs=i("Hjnd"),Cs=i.n(vs),bs=i("b5Bu"),Ss=A.Z.osg,Es=new(_s())({device:"VWR",listen:!0}),ys={},Is=function(e){return 1<<Math.ceil(Math.log2(e))},xs=function(e){var t,i,n=0;if(0===e.length)return n;for(t=0,i=e.length;t<i;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return"vr-browser-"+n},Ts=function(e,t,i,n,r,a){ps.call(this,e,t,i,n,r,a),this._uPaginate=void 0,this._textureWidth=1024,this._textureHeight=1024,this._useCache=!1};Ts.prototype=Ss.objectInherit(ps.prototype,{initialize:function(e,t,i){bs.Z&&!(0,l.Z)().isApp||(t=(0,xa.Z)({},t),Jo(function(n){this._styles=n.vrStyles,this._appendVrElement();var r=Cs()(n.TEMPLATES.getFromMacro(e,"panel",[t]));this._templatePath=e,r.css("position","absolute"),r.css("top","0"),r.css("left","0"),this._$uiPanelsDiv.append(r);var a=this._extractMetaData(r);if(this._useCache){var o=xs(r.html()),s=localStorage.getItem(o);if(s){var u=new Image;return u.crossOrigin="anonymous",u.onload=function(){var e=new Ss.Texture;e.setTextureSize(1,1),e.setImage(u),this._applyTexture(e,a,i)}.bind(this),u.src=s,void r.remove()}}if(!(0,l.Z)().vrGenerateUiTextures)return i(ar.Z.dummyTexture,a),void r.remove();this._rasterizeElement(n.rasterizeHTML,r).then(function(e){if(this._useCache){var t=e.toDataURL(),i=xs(r.html());this._storeInCache(i,t)}var n=new Ss.Texture;return n.setTextureSize(1,1),n.setImage(e),n}.bind(this)).then(function(e){this._applyTexture(e,a,i)}.bind(this)),r.remove()}.bind(this)))},_storeInCache:function(e,t){try{localStorage.setItem(e,t)}catch(n){localStorage.removeItem(localStorage.key(0));for(var i=0;i<localStorage.length&&0!==localStorage.key(i).indexOf("vr-browser-");i++)localStorage.removeItem(localStorage.key(i));this._storeInCache(e,t)}},setUseCache:function(e){this._useCache=e||!1},_applyTexture:function(e,t,i){this.isInitialized()?(this.changeTexture(e),this.updateMetaData(t)):ps.prototype.initialize.call(this,e,t),i&&i(e,t)},_appendVrElement:function(){this._$uiPanelsDiv=Cs()("#vr-ui-panels"),this._$uiPanelsDiv.length||(this._$uiPanelsDiv=Cs()('<div id="vr-ui-panels" style="position:absolue; top:0;bottom:0;left:0;right:0; background:transparent"/>'),Cs()("body").append(this._$uiPanelsDiv),this._$uiPanelsDiv.append('<style id="vr-panel-style">'+this._styles+"</style>"))},_rasterizeElement:function(e,t){var i=document.createElement("canvas");return i.width=t.outerWidth(),i.height=t.outerHeight(),e.drawHTML(this._$uiPanelsDiv.prop("outerHTML"),i,{cacheBucket:ys,cache:"all"}).then(function(e){if(kr.default.apple.phone){var t="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e.svg))),n=(0,Oo.Z)("rasterize");return Es.createMessage({data:{_key:n,height:i.height+"",width:i.width+"",svg:t}}).appendToHash(),new(c())((function(e){Es.on("message:"+n,(function(t){var i,n=new Image;n.crossOrigin="anonymous",n.onload=function(){e(n)},t.b64&&(i=t.b64),t.data.b64&&(i=t.data.b64),i.indexOf("%3D")>-1&&(i=decodeURIComponent(i)),-1===i.indexOf("data:image/png")&&(i="data:image/png;base64,"+i),n.src=i}))}))}if(this._textureWidth=Is(i.width),this._textureHeight=Is(i.height),i.width===this._textureWidth&&i.height===this._textureHeight)return i;var r=document.createElement("canvas");return r.width=this._textureWidth,r.height=this._textureHeight,r.getContext("2d").drawImage(i,0,0,this._textureWidth,this._textureHeight),r}.bind(this),(function(e){console.log(e)}))},_extractMetaData:function(e){var t=e.find(".page"),i=e.outerHeight(!0),n=e.outerWidth(!0),r={id:e.attr("id"),width:n,height:i,cells:[],pages:[]};if(0===t.length)this._extractButtons(e,r,0,"default");else for(var a=0;a<t.length;a++)this._extractButtons(Cs()(t[a]),r,a,t[a].id);return this._extractCells(e,r),r},_extractButtons:function(e,t,i,n){if(n){var r=e.find("button"),a=e.offset().top,o=e.offset().left,s=e.outerHeight(!0),l=e.outerWidth(!0);t.pages[i]={id:n,num:i,x:o,y:a,width:l,height:s,items:[],areas:[]};for(var u=0;u<r.length;u++){var h=r[u].id,c=r[u].disabled;if(h&&!c){var A=Cs()(r[u]),d=Ss.vec4.create();d[0]=A.offset().left-o,d[1]=d[0]+A.outerWidth(),d[2]=A.offset().top-a,d[3]=d[2]+A.outerHeight(),d[0]>t.width&&(d[0]%=t.width),d[1]>t.width&&(d[1]%=t.width),t.pages[i].items.push(h),t.pages[i].areas.push(d)}}}},_extractCells:function(e,t){for(var i=e.find(".cell"),n=e.offset().top,r=e.offset().left,a=0,o=1/0,s=1/0,l=0,u=0;u<i.length;u++){var h=i[u].id;if(h){var c=Cs()(i[u]),A={};A.id=h,A.x=c.offset().left-r,A.y=c.offset().top-n;var d=c.css("z-index");A.z=isNaN(d)?0:d,A.width=c.outerWidth(!1),A.height=c.outerHeight(!1);var g=A.x+A.width;g>a&&(a=g),A.x<o&&(o=A.x);var f=A.y+A.height;f>l&&(l=f),A.y<s&&(s=A.y),t.cells[u]=A}}0===i.length?(t.cellsWidth=e.outerWidth(!1),t.cellsHeight=e.outerHeight(!1)):(t.cellsWidth=a-o,t.cellsHeight=l-s)}});const ws=Ts;var Ms=A.Z.osg,Rs=function(e,t){ws.call(this,e,t),this._round=.005};Rs.prototype=Ms.objectInherit(ws.prototype,{initialize:function(e,t){ws.prototype.initialize.call(this,e,t,function(){this.setClickAction("nextPage",function(){this.setPage(this._currentPage+1)}.bind(this)),this.setClickAction("prevPage",function(){this.setPage(this._currentPage-1)}.bind(this))}.bind(this)),this._nbColumns=t.column,this._currentPage=0},setHinted:function(e){this._hinted=e,this.setNodeMask(e?Te.Z.NO_PICK:0),this._uAlpha&&(this._uAlpha[0]=.1)},isHinted:function(){return this._hinted},getNbPage:function(){return this._nbColumns},getCurrentPage:function(){return this._currentPage},setPage:function(e){if(this._currentPage!==e){var t=this.getNbPage(),i=Math.min(t-1,Math.max(0,e));this.setPageForCell("column"+i,"default"),this._currentPage=i}}});const Bs=Rs;i("mpKL");var Ns=A.Z.osg,Ds=A.Z.osgUtil,Ps=Ns.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),Fs=Ds.GizmoGeometry.createCylinderGeometry(.0025,.0025,1,8,1,!1,!1),Os=new Ns.MatrixTransform;Os.getMatrix()[14]=.5,Os.addChild(Fs),Fs._boundingBoxComputed=!0,Fs._boundingSphereComputed=!0;var Ls=function(e,t){Ns.Node.call(this),this._idHotspot=e,this._viewer=t,this._hotspotMT=new Ns.MatrixTransform,this._cardPanel=new Bs,this._lineToCardMT=new Ns.MatrixTransform,this._hotspotMT.addChild(Ps),this.addChild(this._hotspotMT),this.addChild(this._lineToCardMT),this.addChild(this._cardPanel),this._cardPanel.setVisible(!1),this._lineToCardMT.setNodeMask(0),this._worldTeleportPos=void 0,this._cardInitialized=!1,this._texCard=new Ns.Texture,this._texCard.setTextureSize(1,1),this._canTeleport=!1,this._uAlpha=void 0,this._color=void 0,this._lineToCardMT.addChild(Os),this._hotspotMT._boundingBoxComputed=!0,this._hotspotMT._boundingSphereComputed=!0,this.init()};Ls.COLOR_NORMAL=Ns.vec3.fromValues(1,1,1),Ls.COLOR_HOVERED=Ns.vec3.fromValues(0,.8,1),Ls.COLOR_DRAG_OK=Ns.vec3.fromValues(0,.4,1),Ls.COLOR_DRAG_FAIL=Ns.vec3.fromValues(.8,.2,.2),Ls.initLineShader=function(e){var t=Fs.getOrCreateStateSet();t.setAttributeAndModes(e),t.addUniform(Ns.Uniform.createFloat4(Ns.vec4.fromValues(.03,.59,.78,.4),"uLineColor")),t.setRenderBinDetails(Me.Z.TOOLTIP,"RenderBin")},Ns.createPrototypeNode(Ls,Ns.objectInherit(Ns.Node.prototype,{init:function(){var e=this.getOrCreateStateSet();e.addUniform(Ns.Uniform.createFloat(this._idHotspot,"uHotspotIndex"));var t=Ns.Uniform.createFloat3(Ns.vec3.fromValues(1,1,1),"uColor");this._color=t.getInternalArray(),e.addUniform(t)},getIndex:function(){return this._idHotspot},getHotspotMatrix:function(){return this._hotspotMT.getMatrix()},getColor:function(){return this._color},isFullyVisibleCard:function(){return this._cardPanel.isVisible()},isVisibleCard:function(){return this._cardPanel.isHinted()||this._cardPanel.isVisible()},canTeleport:function(){return this._canTeleport&&!this.isFullyVisibleCard()},setWorldTeleportPosition:function(){var e=Ns.vec3.create(),t=Ns.vec3.create(),i=Ns.vec3.create();return function(n,r,a){if(!this.isFullyVisibleCard()){var o=this._cardPanel.getMatrix();this._worldTeleportPos=Ns.vec3.copy(this._worldTeleportPos||Ns.vec3.create(),r),Ns.vec3.copy(i,r),i[2]+=1.5*a,Ns.vec3.sub(t,n,i),t[2]=0,Ns.vec3.normalize(t,t),Ns.vec3.scale(t,t,1*a),Ns.vec3.add(t,i,t),this.lookToWorld(o,t,i,a),Ns.vec3.sub(e,r,n);var s=Ns.vec3.length(e);Ns.vec3.sub(e,r,t);var l=s<Ns.vec3.length(e)?-1:1;t[2]+=.5*l*.5625*a;var u=this._lineToCardMT.getMatrix();this.lookToWorld(u,n,t,1);var h=Ns.vec3.dist(t,n);Ns.vec3.set(e,a,a,h),Ns.mat4.scale(u,u,e),this._cardPanel.dirtyBound()}}}(),setCardVisibilityListener:function(e){this._cardVisibilityListener=e},setVisibleCard:function(e){this._isCardInitialized||this.initCard(),this._cardPanel.setVisible(e),this._lineToCardMT.setNodeMask(e?Te.Z.NO_PICK:0),this._cardVisibilityListener&&this._cardVisibilityListener(this,e)},setVisible:function(e){this.setNodeMask(e?-1:0)},setHovered:function(e){this._isCardInitialized||this.initCard(),Ns.vec3.copy(this.getColor(),e?Ls.COLOR_HOVERED:Ls.COLOR_NORMAL),this.isFullyVisibleCard()||(this._cardPanel.setHinted(e),this._lineToCardMT.setNodeMask(e?Te.Z.NO_PICK:0))},initCard:function(){var e=Cs()(".hotspots"),t=Cs()(e.get(0).childNodes[this._idHotspot]),i=this._viewer.getFeatures().hotspot._views[0]._hotspots;this._setDescriptionStyle(t,{width:"1024px",lineHeight:"2",fontSize:"38px"});var n=t.find(".description").outerHeight()+4*t.find(".title").outerHeight(),r=Math.max(1,Math.round(n/576)+(n%576>0?1:0));this._setDescriptionStyle(t,null),this._cardPanel.initialize("skfb_front/macros/hotspot",{hotspotIndex:this._idHotspot,displayNavigation:i.length&&i.length>1,column:r,widthContent:1024*r,title:t.find(".title")[0].innerText,description:t.find(".description").html()}),this._isCardInitialized=!0},_setDescriptionStyle:function(e,t){e.find(".description").css({width:null!==t?t.width:"",lineHeight:null!==t?t.lineHeight:"",fontSize:null!==t?t.fontSize:""})},updateCardHit:function(e){this._hoveredCard=this._cardPanel.updateHit(e)},onCardHit:function(e){this._isCallbackSetup||(this._setupCallback(e),this._isCallbackSetup=!0),this._hoveredCard?this._cardPanel.click():this._cardPanel.setVisible(!1)},_setupCallback:function(e){this._cardPanel.setClickAction("closeButton",function(){this.setVisibleCard(!1)}.bind(this)),this._cardPanel.setClickAction("nextButton",(function(){e.goToNextHotspot()})),this._cardPanel.setClickAction("prevButton",(function(){e.goToPrevHotspot()}))},lookToWorld:function(){var e=Ns.vec3.create(),t=Ns.vec3.fromValues(0,0,-1),i=Ns.mat4.fromXRotation(Ns.mat4.create(),Math.PI);return function(n,r,a,o){Ns.mat4.lookAt(n,r,a,t),Ns.mat4.multiply(n,i,n),Ns.mat4.invert(n,n),Ns.mat4.scale(n,n,Ns.vec3.set(e,o,o,o))}}(),updatePositionVR:function(e,t,i,n){var r=this._hotspotMT.getMatrix(),a=e.get("lastComputedWorldPosition");i=Math.max(1.5*i,.1*n),i=Math.min(4*i,i),this.lookToWorld(r,a,t,i);var o=1/0;this._worldTeleportPos&&(o=Ns.vec2.dist(this._worldTeleportPos,t));var s=o<.5*n;this._canTeleport=!s,this._hotspotMT.dirtyBound()},updatePosition:function(){var e=Ns.vec3.create();return function(t,i,n,r){var a=this._hotspotMT.getMatrix(),o=t.get("lastComputedWorldPosition");Ns.mat4.copy(a,r),Ns.vec3.set(e,n,n,n),Ns.mat4.scale(a,a,e),Ns.mat4.setTranslation(a,o),this.isVisibleCard()&&this.setVisibleCard(!1),this._hotspotMT.dirtyBound()}}()}),"osgSketchfab","Hotspot");const ks=Ls;var Zs,Us,Vs=i("rRD0"),Qs=i("gLrx"),Gs=i("HxyN"),Hs=i("T5Q4"),zs=i("+XBE"),Ws=A.Z.osg,js=A.Z.InputGroups;var qs={FeatureName:"hotspot",ModelType:Go,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this._nodeHotspot=new Ws.Node,this._nodeHotspot.setName("Feature - Hotspot"),this._hotspots=this.model.get("hotspots");var e=this._hotspots.length>0;jn.setHotspot(e),this.model.set("started",e),this._hotspots.on("sort",k.Z.draw),this._hotspots.on("remove",this.onHotspotRemoved,this),this._hotspots.on("add",this.onHotspotAdded,this),this._hotspots.on("select",this.onHotspotSelected,this),this._hotspots.on("inserted",this.onHotspotInserted,this),this.model.on("change:started",this.onHotspotStarted,this),this.model.on("change:visible",this.onVisible,this),this.model.on("change:textureOptions",this.setTextureHotspot,this),this._lastSuccessHit=void 0;var t=this.options.context;this._viewer=t.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._inputManager=this._viewerOSGJS.getInputManager(),this._idDragging=-1,this._dragHotspotStarted=!1,this._lastHoveredIndex=-1,this._dragCamera=!1,this._lastCoordNotDragging=Ws.vec2.create(),this._proxyHotspot=new Ws.Node,this._proxyHotspot.setName("Hotspot - Proxy"),this._proxyHotspot.setNodeMask(0),this._nodeHotspot.addChild(this._proxyHotspot),this.initHotspotProxy(),this._hotspots.each(this.onHotspotAdded.bind(this)),(e||(0,o.Z)())&&F.Z.getModelDisplayed().then(this.hotspotReady.bind(this))},onHotspotStarted:function(){this.model.get("proxyModel")&&this.model.get("proxyModel").set("annotationsVisible",!0),jn.setHotspot(!0),this.hotspotReady()},getNodeHotspot:function(){return this._nodeHotspot},getNodeProxy:function(){return this._proxyHotspot},getScreenThresholdHover:function(){return 20*Le.Z.getPixelRatio()[0]},onVisible:function(){this._proxyHotspot.setNodeMask(this.model.get("visible")?Te.Z.NO_SHADOW:0),k.Z.draw()},hotspotReady:function(){Ue.Z.initHotspot(this),this.onVisible();var e=this._viewer.getFeaturesManager().getTextureDepth();e&&this._proxyHotspot.getOrCreateStateSet().setTextureAttributeAndModes(0,e),k.Z.draw()},onHotspotInserted:function(){for(var e=0;e<this._proxyHotspot.children.length;e++)this._proxyHotspot.children[e].initCard()},initHotspotProxy:function(){if(!this._proxyInitialized&&this.model.get("hotspots").length){this._proxyHotspot.setCullCallback(this);var e=this._proxyHotspot.getOrCreateStateSet();e.setRenderBinDetails(Me.Z.HOTSPOT,"RenderBin"),e.setAttributeAndModes(Ze.Z.DEPTH_DISABLE),e.setAttributeAndModes(Ze.Z.BLEND_SUBSTRACTIVE),this.model.set("textureOptions",{url:Re.iconHotspot,colNumber:10,padding:2,iconSize:48}),this.setTextureHotspot(),e.addUniform(Ws.Uniform.createInt(0,"uTextureDepth")),e.addUniform(Ws.Uniform.createInt(1,"uTextureHotspot")),e.setAttributeAndModes(we.Z.getOrCreateShader(Qs,Gs,"hotspot","Hotspot")),e.setAttributeAndModes(Ze.Z.CULL_DISABLE),ks.initLineShader(we.Z.getOrCreateShader(Hs,zs,"hotspotline","VRHotspotLine")),this._proxyInitialized=!0}},setTextureHotspot:function(){var e=this.model.get("textureOptions"),t=this._proxyHotspot.getOrCreateStateSet();if(e.url){var i=s.Z.instance.getOrCreateTexture(e.url,{internalFormat:Ws.Texture.RGBA});t.setTextureAttributeAndModes(1,i.texture),i.promise.then(function(e){this._textureSize?this._textureSize.setVec2(Ws.vec2.fromValues(e._textureWidth,e._textureHeight)):(this._textureSize=Ws.Uniform.createFloat2(Ws.vec2.fromValues(e._textureWidth,e._textureHeight),"uHotspotTextureSize"),t.addUniform(this._textureSize))}.bind(this))}e.colNumber&&(this._iconsCol?this._iconsCol.setFloat(e.colNumber):(this._iconsCol=Ws.Uniform.createFloat(e.colNumber,"uHotspotCol"),t.addUniform(this._iconsCol))),e.padding&&(this._iconPadding?this._iconPadding.setFloat(e.padding):(this._iconPadding=Ws.Uniform.createFloat(e.padding,"uHotspotPadding"),t.addUniform(this._iconPadding))),e.iconSize&&(this._iconSize?this._iconSize.setFloat(e.iconSize):(this._iconSize=Ws.Uniform.createFloat(e.iconSize,"uHotspotSize"),t.addUniform(this._iconSize)))},createHotspot:function(e){if("annotations"===this._viewer.getOptions().widgetAPI.getTabbedWidget().get()){var t=this.options.context.getModel().toJSON(),i=(0,Ho.A8)(t),n=Bt.Z.maxHotspotsPerModel[i];if(this._hotspots.length>=n)this.model.trigger("hotspot-error",new Vs.r(void 0,"hotspot",this._hotspots.length,n,Wo.Z.me().toJSON().account));else if(this._viewer.getFeaturesManager()){var r=ke.Z.pickNearestSurface(e);r&&this.model.createHotspot(r)}}},getColorHotspot:function(e){return this._proxyHotspot.getChildren()[e].getColor()},setHotspotHovered:function(e,t){t>=0&&Ws.vec3.copy(this.getColorHotspot(t),e?ks.COLOR_HOVERED:ks.COLOR_NORMAL)},updateCameraDragged:function(){var e=Ws.vec2.create();return function(t){this._dragCamera=this._dragCamera||Ws.vec2.dist(Ws.vec2.set(e,t.glX,t.glX),this._lastCoordNotDragging)>5}}(),hoverHotspot:function(e){var t=this.pickHotspot(e);this.setHotspotHovered(0,this._lastHoveredIndex),this.setHotspotHovered(1,t),-1===this._idDragging&&Ws.vec2.set(this._lastCoordNotDragging,e.glX,e.glY),this._lastHoveredIndex!==t&&(-1!==this._lastHoveredIndex&&this._viewer.trigger("annotationMouseLeave",this._lastHoveredIndex),-1!==t&&this._viewer.trigger("annotationMouseEnter",t),this._lastHoveredIndex=t,k.Z.draw())},selectHotspot:function(e){var t=this.pickHotspot(e);this._hotspots.trigger("select",this._hotspots.at(t))},startDrag:function(e){this._idDragging=this.pickHotspot(e),this._dragCamera=!1,Ws.vec2.set(this._lastCoordNotDragging,e.glX,e.glY),this._idDragging>=0&&this._inputManager.setEnable(js.MANIPULATORS,!1)},cancelDrag:function(){this._dragCamera=!0,this.stopDrag()},stopDrag:function(){this._dragCamera?this._idDragging>=0&&(this._lastSuccessHit&&(0,Uo.hP)(this._hotspots.at(this._idDragging),this._lastSuccessHit),Ws.vec3.copy(this.getColorHotspot(this._idDragging),ks.COLOR_NORMAL),k.Z.draw()):this._hotspots.trigger("select",this._hotspots.at(this._idDragging)),this._idDragging>=0&&this._inputManager.setEnable(js.MANIPULATORS,!0),this._dragHotspotStarted=!1,this._dragCamera=!1,this._idDragging=-1},dragHotspot:function(){var e=Ws.vec3.create();return function(t){if(!(this._idDragging<0)&&(this.updateCameraDragged(t),this._dragHotspotStarted=!0,ke.Z.isInitialized())){var i=ke.Z.pickNearestSurface(t),n=this._hotspots.at(this._idDragging);Ws.vec3.copy(this.getColorHotspot(this._idDragging),i?ks.COLOR_DRAG_OK:ks.COLOR_DRAG_FAIL),i?(this._lastSuccessHit=i,(0,Uo.hP)(n,i)):(Ws.vec2.set(e,t.glX,t.glY),e[2]=ke.Z.getScreenPositionFromScenePoint(n.get("position"),Ws.vec3.create())[2],ke.Z.getScenePositionFromScreenPoint(e,n.get("position")),n.set("geometryUid",-1)),k.Z.draw()}}}(),onHotspotSelected:(Zs=Ws.vec3.create(),Us=Ws.vec3.create(),function(e){if(e){var t=this._hotspots.indexOf(e);zo.default.modelViewerAnnotationSelected(this.options.context.getModel().get("uid")+"_"+t);var i=this._viewer.getFeaturesManager();i&&(e.get("cameraPreventMove")||(Ws.vec3.copy(Zs,e.get("eye")),Ws.vec3.copy(Us,e.get("target")),i.applyAutospinToCamera(Zs,Us),i.focusOnTargetAndEye(Us,Zs,e.get("cameraPreventAnimation")?0:1.5)),this._viewer.trigger("annotationSelect",t),k.Z.draw())}else this._viewer.trigger("annotationSelect",-1)}),onHotspotAdded:function(e){this._proxyInitialized||this.initHotspotProxy();var t=new ks(this._hotspots.indexOf(e),this._viewer);t.setCardVisibilityListener(this._onCardVisibilityChange.bind(this)),this._proxyHotspot.addChild(t),k.Z.draw()},_onCardVisibilityChange:function(e,t){t?this._viewer.trigger("annotationFocus",e.getIndex()):this._viewer.trigger("annotationBlur",e.getIndex())},onHotspotRemoved:function(){this.setHotspotHovered(0,this._lastHoveredIndex),this._lastHoveredIndex=-1;var e=this._proxyHotspot.getChildren();this._proxyHotspot.removeChild(e[e.length-1]),k.Z.draw()},screenDistanceToHotspot:function(){var e=Ws.vec3.create();return function(t,i){return ke.Z.getScreenPositionFromWorldPoint(t.get("lastComputedWorldPosition"),e),Ws.vec2.dist(e,i)}}(),pickHotspot:function(){var e=Ws.vec2.create(),t=Ws.vec3.create();return function(i){if(!this._viewer.getFeaturesManager()||!this.model.get("visible"))return-1;Ws.vec2.set(e,i.glX,i.glY);for(var n=1/0,r=this._hotspots.length,a=-1,o=this.getScreenThresholdHover(),s=this._hotspots,l=0;l<r;++l){var u=s.at(l);if(u.get("visible")&&(ke.Z.getScreenPositionFromWorldPoint(u.get("lastComputedWorldPosition"),t),t[2]<=1&&t[2]>=0)){var h=Ws.vec2.dist(t,e);h<o&&h<n&&(n=h,a=l)}}return a}}(),cull:function(){var e=Ws.mat4.create(),t=Ws.quat.create(),i=Ws.vec3.create();return function(){this.model.callback&&this.model.callback();var n=this._viewer.getFeaturesManager();this._lastHoveredIndex>=0&&-1===this._idDragging&&(this.screenDistanceToHotspot(this._hotspots.at(this._lastHoveredIndex),this._lastCoordNotDragging)>=this.getScreenThresholdHover()&&this.setHotspotHovered(0,this._lastHoveredIndex));var r=this._hotspots,a=this._proxyHotspot.getChildren(),o=a.length,s=this._viewer.getFeatures().webVR.getModel().get("worldFactor"),l=this.model.get("webVR");this._manipulator.getEyePosition(i);var u=n.getIconScaleFov();if(!l){var h=this._viewer.getCamera();Ws.mat4.invert(e,h.getViewMatrix()),Ws.mat4.fromQuat(e,Ws.mat4.getRotation(t,e))}for(var c=0;c<o;++c){var A=a[c],d=r.at(c);if(d.get("visible")){A.setVisible(!0),(0,Uo.kR)(d);var g=d.get("lastComputedWorldPosition"),f=Ws.vec3.dist(g,i)/u;l?A.updatePositionVR(d,i,f,s):A.updatePosition(d,i,f,e)}else A.setVisible(!1)}return!0}}()})]},Js=n.Z.create(qs);Js.prototype.getNode=function(){return this._views[0].getNodeHotspot()},Js.prototype.getWidgetNode=function(){return this._views[0].getNodeProxy()};const Ys=Js;var Ks=A.Z.osg,Xs=A.Z.osgUtil;const $s=a.Z.extend({getModelOptionPath:function(){return"#.definitions.light"},defaults:function(){return{matrixPrev:Ks.mat4.create(),shadowNormalBias:(0,l.Z)().shadowNormalOffset?.075:void 0}},initialize:function(){a.Z.prototype.initialize.apply(this,arguments),Ci.Z.bind("change:mask",this.dirty,this),this.createNode(arguments[0])},createNode:function(e){this._mtLight=new Ks.MatrixTransform,this._mtLight.setName("Lighting - Mt");var t=io("Lighting",e);this._shadowMap=t.shadowMap,this._light=t.light,this._lightSource=t.lightSource,this._node=t.node,this._enableShadow=t.enableShadow,this._mtQuad=new Ks.MatrixTransform,this._mtQuad.setName("Lighting - TransformIcon "+e),this._quadGeom=Ga.createIconGeometry(),this._quadGeom.setName("Lighting -  GeomIcon "+e),this._pointGeom=new Ga.createPointGeometry,this._dirGeom=new Ga.createDirectionalGeometry(5),this._spotGeom=new Ga.createSpotGeometry(5),this._hemiGeom=new Ga.createHemiGeometry(4),this._hemiGeom.getOrCreateStateSet().addUniform(Ks.Uniform.createFloat4(Ks.vec4.fromValues(0,0,1,1),"uGround")),this._scale=new Ks.MatrixTransform,this._scale.setName("Lighting - ScaleIcon "+e),this._mtEditLight=new Ks.MatrixTransform,this._mtEditLight.getOrCreateStateSet().setTextureAttributeAndModes(0,ar.Z.dummyTexture),this._mtEditLight.setName("Lighting - MtEditLight "+e);var i=this._mtEditLight.getOrCreateStateSet();i.addUniform(Ks.Uniform.createFloat4(Ks.vec4.fromValues(1,1,1,1),"uColor")),i.addUniform(Ks.Uniform.createInt(1,"uEnable")),i.addUniform(Ks.Uniform.createInt(0,"uAttachedToCamera")),i.addUniform(Ks.Uniform.createInt(0,"uTextureDepth")),this._node.addChild(this._mtLight),this._node.addChild(this._mtEditLight),this._mtLight.addChild(this._lightSource),this._mtEditLight.addChild(this._scale),this._mtEditLight.addChild(this._spotGeom),this._mtEditLight.addChild(this._pointGeom),this._scale.addChild(this._mtQuad),this._scale.addChild(this._dirGeom),this._scale.addChild(this._hemiGeom),this._mtQuad.addChild(this._quadGeom),this._dirty=!0,this._updateMatrixOnToggleCamera=!0,this._scene=null},setDepthTexture:function(e){e&&this._mtEditLight.getOrCreateStateSet().setTextureAttributeAndModes(0,e)},setScene:function(e){this._scene=e},getShadowMap:function(){return this._shadowMap},isCastingShadows:function(){var e=this.get("type");return this._enableShadow&&this.get("castShadows")&&("DIRECTION"===e||"SPOT"===e)},getLightSource:function(){return this._lightSource},getNodeScale:function(){return this._scale},getNodeQuad:function(){return this._mtQuad},getNode:function(){return this._node},getNodeLight:function(){return this._mtLight},getNodeEditLight:function(){return this._mtEditLight},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},updateNode:function(){if(this._dirty){this._dirty=!1;var e=this._node,t=this._light,i=this.get("type");if("NONE"===i)return e.setNodeMask(0),t.setEnabled(!1),void(this._mtEditLight.editMask=0);e.setNodeMask(-1),this._mtEditLight.editMask="POINT"===i?Xs.NodeGizmo.PICK_ARROW|Xs.NodeGizmo.PICK_PLANE:Xs.NodeGizmo.PICK_GIZMO,"HEMI"===i&&Ci.Z.get("mask")&Ci.Z.PBR&&(i="DIRECTION");var n=this.get("enable"),r=this.get("falloff");t.setLightType(i),t.setSpotCutoff("SPOT"===i?this.get("angle"):180),t.setEnabled(n),t.setConstantAttenuation("DIRECTION"!==i?1:r),t.setQuadraticAttenuation("DIRECTION"!==i?r:0),t.setSpotBlend(this.get("hardness")),Ks.mat4.copy(this._mtLight.getMatrix(),this.get("matrix")),this._mtLight.dirtyBound(),this._mtEditLight.dirtyBound(),Ks.vec3.scale(t.getDiffuse(),this.get("color"),this.get("intensity")),Ks.vec3.copy(t.getSpecular(),t.getDiffuse()),Ks.vec3.scale(t.getGround(),this.get("ground"),this.get("intensityGround"));var a=this.getShadowMap();a&&(a.setTextureSize((0,l.Z)().shadowTextureSize),a.setBias(this.get("shadowBias")),(0,l.Z)().shadowNormalOffset&&a.setNormalBias(this.get("shadowNormalBias"))),this.isAttachedToCamera()?(this._mtLight.setReferenceFrame(Ks.Transform.ABSOLUTE_RF),this._mtLight.setCullingActive(!1)):(this._mtLight.setReferenceFrame(Ks.Transform.RELATIVE_RF),this._mtLight.setCullingActive(!0));var o=this._scene.getMinimumBound(),s=o.radius(),u=this.multUI_?this.multUI_:o.radius2()/1e3,h=Math.pow(r*u,.125),c=.05*s*(h=Math.min(Math.max(h,0),1))+.8*s*(1-h);"SPOT"===i&&this._spotGeom.updateCone(t.getSpotCutoff()*Math.PI/180,c),"POINT"===i&&this._pointGeom.updateRadius(c),this._dirGeom.setNodeMask(n&&"DIRECTION"===i?Te.Z.NO_PICK_NO_SHADOW:0),this._spotGeom.setNodeMask(n&&"SPOT"===i?Te.Z.NO_PICK_NO_SHADOW:0),this._hemiGeom.setNodeMask(n&&"HEMI"===i?Te.Z.NO_PICK_NO_SHADOW:0),this._pointGeom.setNodeMask(n&&"POINT"===i?Te.Z.NO_PICK_NO_SHADOW:0),Ks.vec3.copy(this._hemiGeom.getOrCreateStateSet().getUniform("uGround").getInternalArray(),t.getGround()),Ks.vec3.copy(this._mtEditLight.getOrCreateStateSet().getUniform("uColor").getInternalArray(),this.get("color"));var A=this._mtEditLight.getOrCreateStateSet();A.getUniform("uEnable").setInt(0|n),A.getUniform("uAttachedToCamera").setInt(0|this.isAttachedToCamera()),this._quadGeom.setLightType(i)}},setLightUnit:function(e){this._light.getLightNumber()!==e&&(this._light.setLightNumber(e),this._light.setName("skfb"+this._light.getTypeMember()),this._shadowMap.dirty())},setIconVisibility:function(e){this._mtEditLight.setNodeMask(e?Te.Z.PICK_GIZMO_LIGHT:0)},isAttachedToCamera:function(){var e=this.get("type");return("DIRECTION"===e||"HEMI"===e)&&this.get("attachedToCamera")},resetPosition:function(){Ks.mat4.identity(this._mtLight.getMatrix()),this._scene&&Ks.mat4.translate(this._mtLight.getMatrix(),this._mtLight.getMatrix(),this._scene.getMinimumBound().center()),k.Z.draw()},updateAttachedToCamera:function(){var e=Ks.mat4.create(),t=Ks.vec3.create();return function(i){if(this._updateMatrixOnToggleCamera){var n=this.get("matrix");Ks.mat4.getTranslation(t,n),this.get("attachedToCamera")?Ks.mat4.copy(e,i.getViewMatrix()):Ks.mat4.invert(e,i.getViewMatrix()),Ks.mat4.multiply(n,e,n),Ks.mat4.setTranslation(n,t)}}}(),setUpdateMatrixOnToggleCamera:function(e){this._updateMatrixOnToggleCamera=e}});var el=A.Z.osg,tl={ThreePointLight:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(-.9815804500275482,.1909922167095499,-.004668327333101102,0,.13548347102422797,.7131126062169096,.6878332937084056,0,.13469984856318096,.6745312327912614,-.7258536813891331,0,0,0,0,1),color:el.vec3.fromValues(.7806122448979592,.7985214493960848,1),intensity:.96},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.7755211495104662,-.0666602860002539,.6277924441503967,0,.2690483737361956,.9344846523281437,-.233133882464682,0,-.5711216326246741,.3497067926613838,.7426474533145686,0,0,0,0,1),color:el.vec3.fromValues(1,.8783319450229073,.7091836734693877),intensity:1},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.6903299131022926,-.7076363669144057,-.15064986988498263,0,-.011089698239978026,.19785137301620165,-.9801692980238416,0,.7234097246160907,.6783108479272498,.12873524736872857,0,0,0,0,1),color:el.vec3.fromValues(.423469387755102,.7352665556018328,1),intensity:.12,ground:el.vec3.fromValues(.9642857142857143,.6484128636877489,.2607507288629738),intensityGround:.06}]},FullMoonNight:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.9997395789367833,.0037284998571004493,-.02251383121813605,0,-.003172416108909601,.9996902441347245,.024685047253076783,0,.02259889562202194,-.024607195505995896,.9994417320914686,0,0,0,0,1),color:el.vec3.fromValues(.14431486880466474,.20264621883738915,.3928571428571429),intensity:1.5400000000000005,ground:el.vec3.fromValues(.9744897959183674,.6276245973191442,.3331164098292378),intensityGround:.06},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.9321120105125691,.3015730438836578,-.2005514873067817,0,.11902736304545063,-.7780729183457072,-.6167941476566071,0,-.34205216956578893,.5510501183556175,-.7611465564236605,0,0,0,0,1),color:el.vec3.fromValues(1,.613390254060806,.19387755102040816),intensity:2.9799999999999995},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.5165535747993983,-.2459126458378022,-.8201825254045677,0,-.40819067915319995,.771302442076031,-.48833688402577136,0,.7526970000035951,.5870430252243886,.29803978378898704,0,0,0,0,1),color:el.vec3.fromValues(1,1,1),intensity:.38}]},LowKeyLight:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.022621146436927503,-.2660807408393079,-.9636852821789301,0,-.18898982664775527,.9454138725983617,-.26547213586781604,0,.9817184571747294,.1881319984823789,-.02890020742997683,0,0,0,0,1),color:el.vec3.fromValues(1,1,1),intensity:1},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(-.9330760233019924,.058913139300351657,.35482161258401,0,.19787524547993016,.9078715652207372,.36961413432105955,0,-.30035732380815566,.4150885003001482,-.8587706416461712,0,0,0,0,1),color:el.vec3.fromValues(1,1,1),intensity:.22},{type:"NONE",enable:!0}]},EvilGenius:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.9967621126545051,.025235816589958687,.07634424888336766,0,.000702423157861877,-.9521689363972996,.3055713061819492,0,.08040396369728874,-.3045282747481311,-.9491036468693457,0,0,0,0,1),color:el.vec3.fromValues(1,.3450645564348185,.056122448979591844),intensity:1.5400000000000005},{type:"DIRECTION",enable:!0,attachedToCamera:!0,castShadows:!1,matrix:el.mat4.fromValues(-.7932202797763206,.039941473670798935,.6076234577701727,0,.16089796285361985,.9761307284151629,.14587887644631273,0,-.5872933111326324,.21347945972549276,-.780713191238742,0,0,0,0,1),color:el.vec3.fromValues(.15368596418159094,.7346938775510203,.20111518159950362),intensity:1.9000000000000008},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.9998681367204546,.01574007797565349,.003994886292083951,0,0,.24600379421877677,-.9692688652948499,0,-.016239124704439348,.9691410543235108,.24597135535169048,0,0,0,0,1),color:el.vec3.fromValues(.9897959183673469,.674842115105101,.02524989587671801),intensity:.02,ground:el.vec3.fromValues(.3,.2,.2),intensityGround:.98}]},FairyCamp:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.7285122591021403,-.5166704810444328,-.44980162555865727,0,.2899427624247639,.827461680647148,-.4808745798834604,0,.6206473095530125,.21990630067806594,.752620844826062,0,0,0,0,1),color:el.vec3.fromValues(.8476936693044566,.8957603762037927,.9948979591836735),intensity:.9},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.08433618912371937,-.8568665398386119,-.5085932953835439,0,-.8584235966554874,-.3216498975444721,.39956260099599905,0,-.5059608047162799,.40289089877364465,-.7626811835729392,0,0,0,0,1),color:el.vec3.fromValues(.37244897959183676,.538942107455227,1),intensity:1.7200000000000006},{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.9766324883850551,-.001534767629049323,.21491074221438983,0,.14494434684687327,-.7336231034872216,-.6639188793421307,0,.15868244688039193,.6795548443783637,-.7162577012039377,0,0,0,0,1),color:el.vec3.fromValues(.3389212827988338,.7142857142857143,.346581781400607),intensity:.5,ground:el.vec3.fromValues(.9947417742607245,.48469387755102045,1),intensityGround:.14}]},ThreePointLightV2:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,castShadows:!1,matrix:el.mat4.fromValues(-.9815804500275482,.1909922167095499,-.004668327333101102,0,.13548347102422797,.7131126062169096,.6878332937084056,0,.13469984856318096,.6745312327912614,-.7258536813891331,0,0,0,0,1),color:el.vec3.fromValues(.7806122448979592,.7985214493960848,1),intensity:.96},{type:"DIRECTION",enable:!0,attachedToCamera:!0,castShadows:!1,matrix:el.mat4.fromValues(.7755211495104662,-.0666602860002539,.6277924441503967,0,.2690483737361956,.9344846523281437,-.233133882464682,0,-.5711216326246741,.3497067926613838,.7426474533145686,0,0,0,0,1),color:el.vec3.fromValues(1,.8783319450229073,.7091836734693877),intensity:1},{type:"HEMI",enable:!0,attachedToCamera:!1,castShadows:!1,matrix:el.mat4.fromValues(.6903299131022926,-.7076363669144057,-.15064986988498263,0,-.011089698239978026,.19785137301620165,-.9801692980238416,0,.7234097246160907,.6783108479272498,.12873524736872857,0,0,0,0,1),color:el.vec3.fromValues(.423469387755102,.7352665556018328,1),intensity:.12,ground:el.vec3.fromValues(.9642857142857143,.6484128636877489,.2607507288629738),intensityGround:.06}]},TwoHeadLightV1:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,castShadows:!1,matrix:el.mat4.fromValues(Math.SQRT1_2,0,Math.SQRT1_2,0,-0,1,0,0,-Math.SQRT1_2,-0,Math.SQRT1_2,0,0,0,0,1),color:el.vec3.fromValues(.6,.48,.3),intensity:1},{enable:!0,attachedToCamera:!0,castShadows:!1,type:"DIRECTION",matrix:el.mat4.fromValues(Math.SQRT1_2,0,-Math.SQRT1_2,0,0,1,0,0,Math.SQRT1_2,0,Math.SQRT1_2,0,0,0,0,1),color:el.vec3.fromValues(.42,.42,.6),intensity:1},{type:"NONE",enable:!0}]},LightFromAbove:function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,castShadows:!0,matrix:el.mat4.fromValues(.9997395789367833,.0037284998571004493,-.02251383121813605,0,-.003172416108909601,.9996902441347245,.024685047253076783,0,.02259889562202194,-.024607195505995896,.9994417320914686,0,0,0,0,1),color:el.vec3.fromValues(1,1,1),intensity:.01},{type:"NONE",enable:!0},{type:"NONE",enable:!0}]}};const il=tl;var nl=A.Z.osg;const rl=a.Z.extend({defaults:function(){return{select:-1,lights:[new $s(0),new $s(1),new $s(2)],webVR:!1,forceShadowRedraw:!1}},getName:function(){return"Lighting"},getDefaultFalloff:function(){var e=this._root.getMinimumBound().radius();return e<0?0:3.90625/(e*e)},setPreset:function(e){il[e]||console.error("Preset does not exist: "+e),this.setJSON({enable:this.get("enable"),lights:il[e]()},{resetFalloff:!0})},init:function(e){this._viewer=e.getViewer(),this._root=this._viewer.getRootModel(),this.set("enable",!(0,di.Z)());var t=e.getModel().get("options").lighting;t&&t.lights&&(this._ignoreSceneLights=!0,this.setJSON(t)),F.Z.getModelDisplayed().then(this.initDepthTexture.bind(this))},initDepthTexture:function(){for(var e=this._viewer.getFeaturesManager().getTextureDepth(),t=this.get("lights"),i=0;i<3;++i)t[i].setDepthTexture(e)},dirtyScene:function(){j.Z.getModelBoxWithoutDisplacement()?this.recomputeLightsPositionAndFalloff():j.Z.getBoxReady().then(this.recomputeLightsPositionAndFalloff.bind(this))},recomputeLightsPositionAndFalloff:function(){for(var e=j.Z.getModelBoxWithoutDisplacement(),t=this.get("lights"),i=.8*e.radius(),n=this.getDefaultFalloff(),r=e.center(nl.vec3.create()),a=nl.vec3.fromValues(0,0,i),o=0;o<3;++o){var s=t[o],l=s.get("matrix");s.get("falloff")<0&&(s.set("falloff",n),l[12]=r[0],l[13]=r[1],l[14]=r[2],nl.mat4.translate(l,l,a)),s.dirty()}},initLights:function(e){var t=0,i=this.get("lights");for(t=0;t<3;++t)i[t].setScene(this._root);if(this._ignoreSceneLights)return this.trigger("uiReady");var n=e.length;if((0,di.Z)()){if(0===n)return this.setPreset("ThreePointLight"),this.trigger("uiReady");this.set("enable",!0)}else{for(t=0;t<3;++t)i[t].set("castShadows",!1);if(0===n)return this.setPreset("TwoHeadLightV1"),this.trigger("uiReady");if(n>3)return this.setPreset("ThreePointLightV2"),this.trigger("uiReady")}e.sort((function(e,t){return nl.vec3.len(e.getDiffuse())-nl.vec3.len(t.getDiffuse())}));var r=nl.vec3.create();for(t=0;t<3;++t){var a=e[t],o=i[t];if(a){var s=a.getLightType();o.set("type",s),o.set("attachedToCamera",!1),"SPOT"===s&&(o.set("angle",Math.min(90,a.getSpotCutoff())),o.set("hardness",a.getSpotBlend()));var l=a.getDiffuse(),u=Math.max(l[0],l[1],l[2],1);o.set("intensity",u),nl.vec3.scale(o.get("color"),l,1/u);var h=a.getGround(),c=Math.max(h[0],h[1],h[2],1);o.set("intensityGround",c),nl.vec3.scale(o.get("ground"),h,1/c),o.set("falloff",a.getQuadraticAttenuation());var A=o.get("matrix");nl.mat4.getScale(r,a._worldMatrix),nl.mat4.fromScaling(A,r),nl.mat4.invert(A,A),nl.mat4.multiply(A,a._worldMatrix,A)}else o.set("falloff",this.getDefaultFalloff()),o.set("type","NONE")}return this.trigger("uiReady")},getJSON:function(){var e={},t=this.get("lights");return e.enable=this.get("enable"),e.lights=[t[0].getJSON(),t[1].getJSON(),t[2].getJSON()],e},setJSON:function(e,t){var i=t||{};i.ignore=["lights"],a.Z.prototype.setJSON.call(this,e,i);var n=this.get("lights");void 0!==e.enable&&this.set("enable",e.enable);for(var r={validate:i.validate},o=0;o<3;++o){var s=e.lights[o];if(s){var l=n[o];l.setUpdateMatrixOnToggleCamera(!1),l.setJSON(s,r),l.setUpdateMatrixOnToggleCamera(!0),t&&t.resetFalloff&&l.set("falloff",-1),l.get("falloff")<0&&this.dirtyScene()}}},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){return this.setJSON(e,{validate:!0,resetFalloff:!0})}});var al=A.Z.osg;var ol={FeatureName:"lighting",ModelType:rl,ViewListType:[O.Z.extend({initialize:function(e){O.Z.prototype.initialize.apply(this,arguments),this.model.bind("change:select",this.onSelectChanged,this),this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change",k.Z.draw),this._viewer=e.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._isScreenshot=!1,this._nodeFeature=new al.Node,this._nodeFeature.setName("Feature - Lighting"),this._shadowNode=new A.Z.osgShadow.ShadowedScene(eo()),this._shadowNode.setName("Shadowed scene"),this._lightNode=new al.Camera,this._lightNode.setName("Lighting - Camera"),this._lightNode.setNearFarRatio(5e-5);var t=this._lightNode.getOrCreateStateSet();t.setRenderBinDetails(Me.Z.EDITOR_GIZMO,"RenderBin"),this._lightNode.setNodeMask(Te.Z.NO_SHADOW),this.initLightNode(),this.onEnableChanged(),this._nodeFeature.addChild(this._lightNode),F.Z.getMaterial().then(this.handleDirtyShadows.bind(this))},getNode:function(){return this._nodeFeature},getNodeLight:function(){return this._lightNode},getNodeShadow:function(){return this._shadowNode},isLightNone:function(e){return-1===e||"NONE"===this.model.get("lights")[e].get("type")},isTabLighting:function(){var e=this._viewer.getFeaturesManager();return e&&"lighting"===e.getCurrentTabName()},handleDirtyShadows:function(){var e=this._viewer.getFeatures().material;if(e){var t=e.getModel().attributes,i=this.model.get("lights"),n=i.length;for(var r in t)for(var a=t[r],o=a.getChannels().Opacity,s=a.getChannels().Displacement,l=0;l<n;++l){var u=i[l];o.bind("change",u.dirty,u),s.bind("change",u.dirty,u)}}},onEnableChanged:function(){var e=this.model.get("enable");if(this._lightNode.setNodeMask(e?Te.Z.NO_SHADOW:0),!e){var t=this.getGizmo();t&&t.attachToNode(null)}for(var i=this.model.get("lights"),n=0,r=i.length;n<r;++n){var a=i[n],o=e&&a.get("enable");a.getLightSource().getLight().setEnabled(o),(0,l.Z)().shadowAtlas&&!o&&ro(this._shadowNode,a.getShadowMap())}e&&this._updateLightsAndIcons()},initLightNode:function(){this._nodeFeature.addUpdateCallback(this);for(var e=this.model.get("lights"),t=0,i=e.length;t<i;++t){var n=e[t];n.setLightUnit(t),n.bind("change",n.dirty,n),n.bind("change:attachedToCamera",n.updateAttachedToCamera.bind(n,this._viewer.getCamera()),n),n.bind("change",k.Z.draw),this._lightNode.addChild(n.getNode())}},getGizmo:function(){var e=this._viewer.getFeaturesManager();return e?e.getNodeGizmo():null},onSelectChanged:function(){var e=this.getGizmo();if(e){var t=this.model.get("select");this.isLightNone(t)?e.attachToNode(null):e.attachToNode(this.model.get("lights")[t].getNodeEditLight())}},updateSelection:function(){var e=this.getGizmo();if(e&&!e._isEditing){var t=e._attachedNode;if(!this.isLightNone(this.model.get("select"))||t)for(var i=this.model.get("lights"),n=0;n<3;++n)if(i[n].getNodeEditLight()===t){e.updateGizmoMask(),this.model.set("select",n);break}}},updateLightIcons:function(){var e=al.vec4.create(),t=al.vec3.create(),i=al.vec3.create(),n=al.quat.create();return function(){var r=this.model.get("lights"),a=this._viewer.getCamera(),o=this._viewer.getFeaturesManager().getIconScaleFov();this._manipulator.getEyePosition(i);for(var s=this.getGizmo(),l=0;l<3;++l){var u=r[l];if("NONE"!==u.get("type")){var h=u.getNodeEditLight(),c=u.getNodeLight(),A=u.getNodeQuad(),d=u.getNodeScale(),g=s._isEditing&&s._attachedNode===h,f=A.getMatrix(),p=h.getMatrix(),m=c.getMatrix();u.isAttachedToCamera()?g?(al.mat4.getTranslation(t,p),al.mat4.multiply(m,a.getViewMatrix(),p),al.mat4.setTranslation(m,t)):(al.mat4.getTranslation(t,m),al.mat4.invert(p,a.getViewMatrix()),al.mat4.multiply(p,p,m),al.mat4.setTranslation(p,t)):g?al.mat4.copy(m,p):al.mat4.copy(p,m),al.mat4.copy(u.get("matrix"),m),h.getWorldMatrix(void 0,f),al.mat4.getTranslation(t,f);var _=al.vec3.dist(i,t)/o;al.mat4.fromScaling(d.getMatrix(),al.vec3.set(e,_,_,_)),al.mat4.multiply(f,a.getViewMatrix(),f),al.mat4.invert(f,f),al.mat4.fromQuat(f,al.mat4.getRotation(n,f)),A.dirtyBound(),c.dirtyBound(),d.dirtyBound()}}}}(),setIsScreenshot:function(e){this._isScreenshot=e},_updateLightsAndIcons:function(){if(this._lightNode.getNodeMask()&&this._shadowNode.getChildren().length){for(var e=this._viewer.getFeatures().shadingStyle,t=this._viewer.getFeatures().ARKit.getModel().get("enable")||"lit"===e.getModel().get("type"),i=!this._isScreenshot&&t&&this.isTabLighting(),n=this._viewer.getFeaturesManager().getShadowForcedUpdate(),r=this.model.get("webVR"),a=this.model.get("lights"),o=0;o<3;++o){var s=a[o],l=n||s.isDirty();s.updateNode();var u=s.getShadowMap();if(u){var h=r&&s.isAttachedToCamera();if(!h&&t&&s.get("enable")&&s.isCastingShadows()){if(!(l=l||s.isAttachedToCamera()||n)){for(var c=s.get("matrix"),A=s.get("matrixPrev"),d=0;d<16;d++)if(c[d]!==A[d]){l=!0;break}al.mat4.copy(A,c)}l&&u.requestRedraw(),no(this._shadowNode,u)}else(l||h)&&ro(this._shadowNode,u);s.setIconVisibility(i)}}i&&(this.updateLightIcons(),this.updateSelection())}},update:function(e,t){return e.getNumChildrenRequiringUpdateTraversal()>0&&t.traverse(e),this._updateLightsAndIcons(),!1}})]},sl=n.Z.create(ol);sl.prototype.getNode=function(){return this._views[0].getNode()},sl.prototype.getNodeShadow=function(){return this._views[0].getNodeShadow()},sl.prototype.prepareForScreenShot=function(){this._views[0].setIsScreenshot(!0)},sl.prototype.resetAfterScreenShot=function(){this._views[0].setIsScreenshot(!1)};const ll=sl;var ul=A.Z.osg;const hl=a.Z.extend({initialize:function(){a.Z.prototype.initialize.apply(this,arguments),this._sssSchema=this.getSubSchema("scene.sssProfiles"),this.set("sssProfiles",this.getInstance(this._sssSchema))},getModelOptionPath:function(){return"scene.postProcess"},defaults:{postProcessReady:!1,rgbmDefault:7,rgbmBloom:1,sssCurrentProfile:0,webVR:!1,AR:!1,veilFactor:1,doDistortionVR:!1,distortion:ul.vec2.fromValues(.441,.156),projectionLeft:ul.vec4.fromValues(1,1,-.5,-.5),unprojectionLeft:ul.vec4.fromValues(1,1,-.5,-.5),vrFadeLength:(0,l.Z)().vrFade/1e3/2,vrStartFade:!1,vrFadeStartTime:0,vrFadeCallback:void 0,vrFading:!1},getName:function(){return"PostProcess"},getViewer:function(){return this._viewer},useSSSLookupFloat:function(){return ul.WebGLCaps.instance().getWebGLExtension("OES_texture_float_linear")},getSSSWeightRange:function(){return 2*(0,l.Z)().sssHalfKernel-1>20?3:2},setQuality:function(e){void 0!==(0,l.Z)().quality&&(e=(0,l.Z)().quality),Wa.Z.uQuality.setFloat(e)},getQuality:function(){return Wa.Z.uQuality.getInternalArray()[0]},_getBoundRadius:function(){return j.Z.getModelBoxWithDisplacement().radius()},getMinimumSsaoRadius:function(){return.01*this._getBoundRadius()},getMaximumSsaoRadius:function(){return.1*this._getBoundRadius()},getMinimumSsaoBias:function(){return.002*this._getBoundRadius()},getMaximumSsaoBias:function(){return.01*this._getBoundRadius()},_makeValidOption:function(e,t,i,n){var r=this.get(e);r<t*j.Z.BIAS_MIN||r>i*j.Z.BIAS_MAX?this.set(e,n):this.set(e,Math.min(Math.max(r,t),i))},_makeValidSsaoRadius:function(){this._makeValidOption("ssaoRadius",this.getMinimumSsaoRadius(),this.getMaximumSsaoRadius(),.025*this._getBoundRadius())},_makeValidSsaoBias:function(){this._makeValidOption("ssaoBias",this.getMinimumSsaoBias(),this.getMaximumSsaoBias(),.005*this._getBoundRadius())},_isEffectivePP:function(){return this.get("enable")},isEffectiveGrain:function(){return this._isEffectivePP()&&!this.get("webVR")&&this.get("grainEnable")&&this.get("grainFactor")>=5e-4},isEffectiveSharpen:function(){return this._isEffectivePP()&&!this.get("webVR")&&this.get("sharpenEnable")&&this.get("sharpenFactor")>=5e-4},isEffectiveChromaticAberration:function(){return this._isEffectivePP()&&!this.get("webVR")&&this.get("chromaticAberrationEnable")&&this.get("chromaticAberrationFactor")>=.001},isEffectiveVignette:function(){return this._isEffectivePP()&&!this.get("webVR")&&this.get("vignetteEnable")&&this.get("vignetteHardness")-this.get("vignetteAmount")<=.5*Math.sqrt(2)},isEffectiveBloom:function(){return this._isEffectivePP()&&(!this.get("webVR")||!kr.default.any)&&this.get("bloomEnable")&&this.get("bloomFactor")>=.01},isEffectiveToneMapping:function(){return this._isEffectivePP()&&this.get("toneMappingEnable")},isEffectiveColorBalance:function(){return this._isEffectivePP()&&this.get("colorBalanceEnable")},isEffectiveDof:function(){return this._isEffectivePP()&&!this.get("webVR")&&this.get("dofEnable")&&(this.get("dofBlurNear")>=.01||this.get("dofBlurFar")>=.01)},isEffectiveSsao:function(){return this._isEffectivePP()&&!this.get("webVR")&&this.get("ssaoEnable")&&this.get("ssaoIntensity")>=.01},isEffectiveSsr:function(){return this._isEffectivePP()&&Ci.Z.get("mask")&Ci.Z.LIT&&!this.get("webVR")&&this.get("ssrEnable")&&this.get("ssrFactor")>.01},hasAtLeastOneEffectiveEffect:function(){return!!this.isEffectiveSsr()||(!!this.isEffectiveGrain()||(!!this.isEffectiveSharpen()||(!!this.isEffectiveChromaticAberration()||(!!this.isEffectiveVignette()||(!!this.isEffectiveBloom()||(!!this.isEffectiveToneMapping()||(!!this.isEffectiveColorBalance()||(!!this.isEffectiveDof()||!!this.isEffectiveSsao()))))))))},initAfterFirstFrame:function(){this._makeValidSsaoRadius(),this._makeValidSsaoBias(),this.trigger("uiReady"),this.set("postProcessReady",!0)},init:function(e){this._viewer=e.getViewer();var t=e.getModel().get("options");if(t.scene&&t.scene.sssProfiles&&this.setProfilesJSON(t.scene.sssProfiles),t.scene&&t.scene.postProcess){var i=t.scene.postProcess;this.setJSON(i),void 0!==(0,l.Z)().postProcess&&this.set("enable",(0,l.Z)().postProcess),void 0!==(0,l.Z)().ssr&&this.set("ssrEnable",(0,l.Z)().ssr);var n=i.taa,r=(0,l.Z)().taa;if(n){this.set("taaEnable",void 0!==r?r:n.enable);var a=(0,l.Z)().taaTransparent;this.set("taaTransparent",void 0!==a?a:n.transparent),void 0===r&&j.Z.getBoxReady().then(function(){j.Z.getMaxDistanceFromOrigin()>1e6&&this.set("taaEnable",!1)}.bind(this))}else void 0!==r&&this.set("taaEnable",r)}(0,di.Z)()&&F.Z.getMaterial().then(function(){"Tilt Brush"===this._viewer.getRootUserData().authoringTool?(this.set("bloomEnable",!0),this.set("bloomThreshold",.6),this.set("bloomFactor",1.6),this.set("bloomRadius",.2),this.set("toneMappingEnable",!0),this.set("toneMappingMethod","filmic")):"minecraft"!==this._viewer.getRootUserData().source&&"mineways"!==this._viewer.getRootUserData().source||(this.set("ssaoEnable",!0),this.set("ssaoRadius",.05),this.set("ssaoIntensity",1),this.set("ssaoBias",.006))}.bind(this))},fadeForTeleportVR:function(e){this.set("vrStartFade",!0),this.set("vrFadeCallback",e)},setProfilesJSON:function(e,t){if(t&&t.validate){var i=this.validate(e,{schema:this._sssSchema});if(i.length)return console.error("Failed to validate sss profile json",e,i),i.join("\n")}return this.set("sssProfiles",e),[]},getProfilesJSON:function(){return this.get("sssProfiles")},editorGetJSON:function(){return this.getJSON()},editorSetJSON:function(e){return this.setJSON(e,{validate:!0})}});var cl=i("J7eK"),Al=A.Z.osg,dl=A.Z.osgShader.shaderProcessor,gl={pascalCache:[[1]],getOrCreatePascalCoefficients:function(e){e=void 0===e?5:Math.min(e,128);var t=gl.pascalCache;if(t[e])return t[e];for(var i=t.length-1;i<e;i++){var n=t[i],r=n.length,a=new Array(r);a[0]=1,a[r]=1;for(var o=i===t.length-1?Math.pow(2,i):1,s=0;s<r-1;s++)a[s+1]=(n[s]+n[s+1])*o;o=Math.pow(2,i+1);for(var l=0;l<r+1;l++)a[l]/=o;t.push(a)}return t[e]}},fl=function(e){var t=e.toString();return-1===t.indexOf(".")?t+".0":t},pl=function(e,t){var i=.005/e,n=e,r=gl.getOrCreatePascalCoefficients(n),a=Math.floor(n/2),o=[],s=fl(r[a]);a+1>=e&&(s="1.0");var l,u=1;for(o.push("vec3 pixel = "+s+" * %fetch(gTexCoord.xy).rgb;"),o.push("vec2 offset;"),o.push("vec2 blurDir = uPixelRatio.xy * uBlurDir.xy / uTextureOutputSize.xy;"),t&&o.push("blurDir *= uGlobalTexSize.y * 0.00075;"),l=a+1;l<e;l+=2){var h=r[l],c=r[l+1],A=h+c;if(A<i)break;var d=(u*h+(u+1)*c)/A;o.push("offset = blurDir * "+fl(d)+";"),s=fl(A),o.push("pixel += "+s+" * %fetch(gTexCoord.xy + offset.xy).rgb;"),o.push("pixel += "+s+" * %fetch(gTexCoord.xy - offset.xy).rgb;"),u+=2}o.push("return vec4(pixel, 1.0);");for(l=0;l<o.length;++l)o[l]="    "+o[l].replace("%fetch","TEXTURE_2D_TextureBlurInput");return["uniform sampler2D TextureBlurInput;","uniform vec2 uTextureOutputSize;","uniform vec2 uPixelRatio;","uniform vec2 uBlurDir;",t?"uniform vec2 uGlobalTexSize;\n":"","vec4 gaussianBlur() {",o.join("\n"),"}"].join("\n")};const ml=function(e,t,i,n,r){for(var a=2,o=Al.Uniform.createFloat2(Al.vec2.fromValues(0,1),"uBlurDir"),s=Al.Uniform.createFloat2(Al.vec2.fromValues(1,0),"uBlurDir"),l={},u=t,h=0;h<n.length;h++){var c=n[h]+1,A="gaussianBlur"+h;dl.hasShader(A)||(l[A]=pl(c,r)),e.push({func:{name:"gaussianBlur",file:A},uniforms:o,textures:{name:u,uniformName:"TextureBlurInput"},out:{name:"TextureBlurTemp"+h,divisor:a,filter:"linear"}}),u=i+(h+1),e.push({func:{name:"gaussianBlur",file:A},uniforms:s,textures:{name:"TextureBlurTemp"+h,uniformName:"TextureBlurInput"},out:{name:u,divisor:a,filter:"linear"}}),a*=2}dl.addShaders(l)};var _l=i("C4z1"),vl=i("r6Wx"),Cl=i("mHqZ"),bl=i("x17P"),Sl=i("QorK"),El=i("iXLb"),yl=i("pg5E"),Il=i("RGp6"),xl=i("hgfR"),Tl=i("bjo4"),wl=i("R/Z7"),Ml=i("Ht5+"),Rl=i("Sru3"),Bl=i("uCb/"),Nl=i("q+nQ"),Dl=i("B0qL"),Pl=i("O+7P"),Fl=i("VThJ"),Ol=i("HF1e"),Ll=i("1irs"),kl=i("zE1p"),Zl=i("LiSq"),Ul=i("A6cf"),Vl=i("ZE7+"),Ql=i("Mg89"),Gl=i("E5qE"),Hl=i("/+vK"),zl=i("6LWN"),Wl=i("13g6"),jl=i("f4Fj"),ql=i("SzI9"),Jl=i("iffO"),Yl=i("UKde"),Kl=i("ME+G"),Xl=i("UUlS"),$l=i("Q9ME"),eu=i("apoH"),tu=i("N4IH"),iu=i("+5pB"),nu=i("LnOO"),ru=A.Z.osg,au=A.Z.osgUtil,ou=A.Z.osgShader.shaderProcessor,su=function(e){ru.Node.call(this),this.setName("PostProcess - node In"),this._view3d=e,this._camera=e._camera,this._effectiveConfig=e._effectiveConfig,this._viewer=e._viewer,this._viewerOSGJS=e._viewerOSGJS,this._model=e.model,this._hasTriangles=this._viewer.getOrCreateScene().getJSON().faceCount>0,za.Z.setHasTriangles(this._hasTriangles),this._viewer.getCamera().getRenderer().setRenderStage(new za.Z),this._model.on("pingPongTexture0",this.onPingPongTexture0,this),F.Z.getMaterial().then(function(){var e=this.getBackgroundModel();e.bind("backgroundUpdated",this.onBackgroundUpdated,this),e.bind("change:color",this.onBackgroundColor,this)}.bind(this)),this._composer=void 0,this._addShaders()};ru.createPrototypeNode(su,ru.objectInherit(ru.Node.prototype,{_addShaders:function(){var e={"passThrough.glsl":vl,"setDepthAlpha.glsl":Cl,"combineOpacity.glsl":bl,"combineRefraction.glsl":Sl,"packMipmapRefraction.glsl":El,"sssCommon.glsl":yl,"sssExtract.glsl":Il,"sssBlur.glsl":xl,"sssCombine.glsl":Tl,"packMipmapDepth.glsl":wl,"depthMipmap.glsl":Ml,"ssaoExtract.glsl":Rl,"ssaoBlur.glsl":Bl,"dofCommon.glsl":Nl,"dofCoC.glsl":Dl,"dofNearDilate.glsl":Pl,"dofDownsampleColor.glsl":Fl,"dofBlurCircular.glsl":Ol,"dofCombine.glsl":Ll,"bloomExtract.glsl":kl,"bloomCombine.glsl":Zl,"chromaticAberration.glsl":Ul,"vignette.glsl":Vl,"toneMapping.glsl":Ql,"colorBalance.glsl":Gl,"supersample.glsl":Hl,"supersampleTaa.glsl":zl,"composeExtra.glsl":Wl,"composeFixedBackground.glsl":jl,"fxaa.glsl":ql,"grain.glsl":Jl,"sharpen.glsl":Yl,"dofCross.glsl":Kl,"distortion.glsl":Xl,"ascii.glsl":$l,"fadeVr.glsl":eu,"veilVr.glsl":tu,"outline.glsl":iu,"finalPremultAlpha.glsl":nu};ou.addShaders(e)},getNodeBackground:function(){return this._viewer.getFeatures().environment.getNode().getBackground()},getBackgroundModel:function(){return this._viewer.getFeatures().background.getModel()},getBackgroundType:function(){return this.getBackgroundModel().getEnableType()},onPingPongTexture0:function(e){this._composer&&this._composer.swapFeedbackLoopTextures(e)},_replaceTexture:function(e,t,i){var n=this._composer.getStateSetPass(t);if(n){var r=n.getUniform(i);r&&n.setTextureAttributeAndModes(r.getInternalArray()[0],e)}},onBackgroundUpdated:function(e){void 0!==this._composer&&"fixed"===this._effectiveConfig.bgType&&(this._replaceTexture(e,"composeFixedBackground","TextureFixed"),this._replaceTexture(e,"composeFixedBackgroundRefraction","TextureFixed"))},onBackgroundColor:function(){var e=za.Z.getClearColor();if("color"===this.getBackgroundType()){ru.vec3.copy(e,this.getBackgroundModel().getColor()),e[3]=1,1===Wa.Z.uOutputLinear.getInternalArray()[0]&&cl.ZP.srgbToLinear(e,e);var t=Wa.Z.uRGBMRange.getInternalArray()[0];t>0&&cl.ZP.encodeRGBM(e,t,e)}else ru.vec4.set(e,0,0,0,0)},_getSupportedLinearFloatTexture:function(){var e=ru.WebGLCaps.instance();return 0===(0,l.Z)().floatRtt?ru.Texture.UNSIGNED_BYTE:e.hasLinearHalfFloatRTT()?ru.Texture.HALF_FLOAT:kr.default.any&&this._model.get("webVR")&&2===(0,l.Z)().floatRtt?ru.Texture.UNSIGNED_BYTE:e.hasLinearFloatRTT()?ru.Texture.FLOAT:ru.Texture.UNSIGNED_BYTE},_getSupportedFloatTexture:function(){var e=ru.WebGLCaps.instance();return 0===(0,l.Z)().floatRtt?ru.Texture.UNSIGNED_BYTE:e.hasLinearHalfFloatRTT()||e.hasHalfFloatRTT()?ru.Texture.HALF_FLOAT:kr.default.any&&this._model.get("webVR")&&2===(0,l.Z)().floatRtt?ru.Texture.UNSIGNED_BYTE:e.hasLinearFloatRTT()||e.hasFloatRTT()?ru.Texture.FLOAT:ru.Texture.UNSIGNED_BYTE},_updateEffectiveConfig:function(){var e=this._effectiveConfig,t=jn.get("hasTransparency"),i=jn.get("hasExtra"),n=jn.get("hasRefraction"),r=jn.get("hasScattering");e.webVR=this._model.get("webVR"),e.AR=this._model.get("AR");var a=this._model.get("doDistortionVR")&&(0,l.Z)().vrStereo;e.useDistortionVR=e.webVR&&a,e.useSss=r,e.useSsao=this._model.isEffectiveSsao(),e.useDof=this._model.isEffectiveDof(),e.useBloom=this._model.isEffectiveBloom(),e.useChromaticAberration=this._model.isEffectiveChromaticAberration(),e.useToneMapping=this._model.isEffectiveToneMapping(),e.useColorBalance=this._model.isEffectiveColorBalance(),e.bgType=this.getBackgroundType(),e.hasBG="none"!==e.bgType,e.useTaa=!e.AR&&this._model.get("taaEnable"),e.useTaaTransparent=e.useTaa&&this._model.get("taaTransparent");var s=(0,l.Z)().fxaa;return e.useFxaa=void 0===s?this._hasTriangles:s,e.useGrain=this._model.isEffectiveGrain(),e.useSharpen=this._model.isEffectiveSharpen(),e.useVignette=this._model.isEffectiveVignette(),e.useTransparency=t||e.webVR||(0,o.Z)(),e.useSsr=this._model.isEffectiveSsr(),e.useRefraction=n,e.useDepth=this._needDepthTexture(),e.useExtra=i||e.webVR||e.AR,Ci.Z.set("hasSsr",e.useSsr),this._effectiveConfig},_needDepthTexture:function(){if((0,o.Z)())return!0;var e=this._effectiveConfig;if(e.useRefraction||e.useSsr||e.useDof||e.useBloom||e.useSharpen||e.useSsao||e.useSss||e.useTaa||!e.useFxaa)return!0;if(this._viewer.getFeatures().hotspot.getModel().get("hotspots").length>0)return!0;var t=this.getBackgroundType();return"none"===t||"fixed"===t||this._model.get("webVR")},_addInternalTextures:function(e,t,i){e.addInternalTexture({name:"TextureOpaque",immuable:!0,srgb:i,rgbm:!i}),e.setInputTexture("TextureOpaque"),(t.useRefraction||t.useSsr)&&e.addInternalTexture({name:"TextureToBeRefracted",divisor:(0,l.Z)().refractionRes,immuable:!0,reusable:!1,srgb:!1,rgbm:!0}),t.useRefraction&&e.addInternalTexture({name:"TextureRefraction",immuable:!0,srgb:!1,rgbm:!0}),(t.useSsr||t.useSsao)&&e.addInternalTexture({name:"TextureMipmapDepth",immuable:!0,reusable:!1,srgb:!1,rgbm:!1}),t.useDepth&&e.addInternalTexture({name:"TextureDepth",filter:"nearest",immuable:!0,srgb:!1,rgbm:!1}),t.useTransparency&&e.addInternalTexture({name:"TextureTransparent",filter:"nearest",immuable:!0,type:this._getSupportedFloatTexture(),rgbm:!1,srgb:!1}),t.useExtra&&e.addInternalTexture({name:"TextureExtra",filter:"nearest",immuable:!0,srgb:!t.webVR,rgbm:!1})},_addSss:function(e,t){var i=this._getSupportedLinearFloatTexture();t.addExternalTexture("TextureSSSKernel",this._view3d._sssTexKernel),e.push({func:"sssExtract",textures:[{name:"%last",uniformName:"TextureSSSColor"},"TextureDepth"],out:{name:"TextureSSSExtract",rgbm:!1,divisor:2,type:i,filter:"linear"}});var n=[];n.push("#define SSS_HALF_KERNEL_SIZE "+(0,l.Z)().sssHalfKernel),n.push("#define SSS_PROFILE_COUNT "+this._model.get("sssProfiles").length),n.push("#define SSS_JITTER "+(0,l.Z)().sssJitter.toExponential());var r=this._model.useSSSLookupFloat()?"1.0":this._model.getSSSWeightRange().toExponential();n.push("#define SSS_BYTE_RANGE "+r);var a=ru.Uniform.createFloat2(ru.vec2.fromValues(0,1),"uBlurDir");e.push({func:"sssBlur",header:n,textures:[{name:"TextureSSSExtract",uniformName:"TextureSSSBlur"},"TextureDepth","TextureSSSKernel"],uniforms:a,out:{name:"TextureSSSBlur1",divisor:2,type:i,rgbm:!1,filter:"linear"}});var o=ru.Uniform.createFloat2(ru.vec2.fromValues(1,0),"uBlurDir");e.push({func:"sssBlur",header:n,textures:[{name:"TextureSSSBlur1",uniformName:"TextureSSSBlur"},"TextureDepth","TextureSSSKernel"],uniforms:o,out:{name:"TextureSSSBlur2",divisor:2,rgbm:!0,filter:"linear"}}),e.push({func:"sssCombine",textures:[{name:"TextureSSSBlur2",uniformName:"TextureSSSBlur"},{name:"%last",uniformName:"TextureSSSColor"},"TextureDepth"],out:{name:"%next"}})},_packMipmapDepth:function(e){for(var t=ru.Uniform.createInt(1,"uFirstDepth"),i=ru.Uniform.createInt(0,"uFirstDepth"),n=1;n<=5;n++){var r=1<<n+1,a=1===n?"TextureDepth":"TextureDepth"+(n-1),o="TextureDepth"+n;e.push({func:"depthMipmap",textures:[{name:a,uniformName:"TextureDepth"}],uniforms:1===n?t:i,out:{name:o,divisor:r,filter:"linear"}})}e.push({func:"packMipmapDepth",textures:[{name:"TextureDepth",uniformName:"TextureDepth0"},"TextureDepth1","TextureDepth2","TextureDepth3","TextureDepth4","TextureDepth5"],out:{name:"TextureMipmapDepth",filter:"linear"}})},_addSsao:function(e){var t=[["#extension GL_OES_standard_derivatives : enable"]];(0,l.Z)().ssaoNormal&&t.push("#define SSAO_NORMAL"),kr.default.any&&t.push("#define MOBILE"),e.push({func:"ssaoExtract",header:t,textures:"TextureMipmapDepth",out:{name:"TextureSsaoExtract",filter:"linear"}}),e.push({func:{name:"ssaoBlurH",file:"ssaoBlur.glsl"},header:"#define SSAO_BLUR_H",textures:{name:"TextureSsaoExtract",uniformName:"TextureBlurInput"},out:{name:"TextureSsaoBlurH",filter:"nearest"}}),e.push({func:{name:"ssaoBlurV",file:"ssaoBlur.glsl"},header:"#define SSAO_BLUR_V",textures:[{name:"%last",filter:"linear"},{name:"TextureSsaoBlurH",uniformName:"TextureBlurInput"}],out:{name:"%next"}})},_addCombineOpacity:function(e){e.push({func:"combineOpacity",textures:[{name:"%last",filter:"nearest"},"TextureTransparent"],out:{name:"%next"},collapsible:!0})},_packMipmapColor:function(e,t,i){var n=this._addFixedBackgroundRefraction(e,t,i);return ml(e,n,"TextureRefractionBlur",[3,5,7,9,11,13,15],!0),e.push({func:"packMipmapRefraction",textures:[{name:n,uniformName:"TextureRefractionBlur0"},"TextureRefractionBlur1","TextureRefractionBlur2","TextureRefractionBlur3","TextureRefractionBlur4","TextureRefractionBlur5","TextureRefractionBlur6","TextureRefractionBlur7"],out:{name:"TextureToBeRefracted",filter:"linear"}}),e.length},_addRefraction:function(e){e.push({func:"combineRefraction",textures:["%last","TextureRefraction"],out:{name:"%next"}})},_addDof:function(e){var t=(0,l.Z)().dofRes;e.push({func:"dofCoC",textures:"TextureDepth",out:{name:"TextureDofCoC",divisor:t,filter:"nearest"}}),e.push({func:{name:"dofNearDilateH",file:"dofNearDilate.glsl"},textures:["TextureDofCoC","TextureDepth"],out:{name:"TextureDofNearDilateH",divisor:t,filter:"linear"}}),e.push({func:{name:"dofNearDilateV",file:"dofNearDilate.glsl"},textures:[{name:"TextureDofNearDilateH",uniformName:"TextureDofCoC"},"TextureDepth"],out:{name:"TextureDofNearDilateV",divisor:t,filter:"nearest"}});var i=this._getSupportedFloatTexture()===ru.Texture.HALF_FLOAT,n=i?"#define COLOR_WITH_COC":"",r=["%last"];i&&r.push({name:"TextureDofNearDilateV",uniformName:"TextureDofCoC"}),e.push({func:"dofDownsampleColor",header:n,textures:r,out:{name:"TextureDofDownsampleColor",divisor:t,filter:"nearest",type:i?ru.Texture.HALF_FLOAT:ru.Texture.UNSIGNED_BYTE}});var a=[{name:"TextureDofDownsampleColor",uniformName:"TextureDofColor",rgbm:!i}];i||a.push({name:"TextureDofNearDilateV",uniformName:"TextureDofCoC"}),e.push({func:"dofBlurCircular",header:n,textures:a,out:{name:"TextureDofBlurCircular",divisor:t,filter:"linear",rgbm:!0}}),e.push({func:"dofCombine",textures:[{name:"%last",filter:"linear"},"TextureDofBlurCircular","TextureDofNearDilateV","TextureDepth"],out:{name:"%next"}})},_addBloom:function(e,t){var i,n=["%last"];t.hasBG&&(i="#define HAS_BACKGROUND",n.push("TextureDepth")),e.push({func:"bloomExtract",textures:n,header:i,out:{name:"TextureBloomExtract",filter:"linear"}});ml(e,"TextureBloomExtract","TextureBloomBlur",[3,5,7,9,11]),e.push({func:"bloomCombine",textures:[{name:"%last"},"TextureBloomBlur1","TextureBloomBlur2","TextureBloomBlur3","TextureBloomBlur4","TextureBloomBlur5"],out:{name:"%next"}})},_addMergeable:function(e,t){if(t.useChromaticAberration&&e.push({func:"chromaticAberration",textures:[{name:"%last",filter:"nearest"}],out:{name:"%next"}}),t.useColorBalance&&e.push({func:"colorBalance",textures:[{name:"%last",filter:"nearest"}],out:{name:"%next"},collapsible:!0}),t.useToneMapping){var i=[{name:"%last",filter:"nearest"}],n="";"fixed"!==t.bgType||t.useRefraction||t.useSsr||(n="#define HAS_FIXED_BACKGROUND",i.push("TextureDepth")),e.push({func:"toneMapping",header:n,textures:i,out:{name:"%next"},collapsible:!0})}t.webVR&&t.useExtra&&(e.push({func:"veilVr",textures:"%last",out:{name:"%next",filter:"nearest"},collapsible:!0}),e.push({func:"composeExtra",header:"#define LINEAR_EXTRA",textures:["%last","TextureExtra"],out:{name:"%next",filter:"nearest"},collapsible:!0}))},_addSuperSample:function(e,t){if(!t.hasBG){var i=["%last","TextureDepth"];if(t.useRefraction&&i.push("TextureRefraction"),e.push({func:"setDepthAlpha",header:t.useRefraction?"#define REFRACTION_FORCE_ALPHA_ONE":"",textures:i,out:{name:"%next"},collapsible:!0}),t.AR)return}if(t.useTaa){var n=[];t.useTaaTransparent&&n.push("#define TAA_TRANSPARENT"),n.push("#define FEEDBACK_MIN "+(0,l.Z)().taaFeedbackMin),n.push("#define FEEDBACK_MAX "+(0,l.Z)().taaFeedbackMax),vo.Z.vrConfig.doVR&&n.push("#define VR_ENABLED"),e.push({func:"supersampleTaa",textures:[{name:"%last",filter:"linear",rgbm:!1,srgb:!0},"%previous","TextureDepth"],header:n,out:{name:"%next",filter:"linear"}})}else e.push({func:"supersample",textures:[{name:"%last",filter:"linear",rgbm:!1,srgb:!0},"%previous"],out:{name:"%next",filter:"linear"}})},_addFinalPass:function(e,t){var i=[],n=[{name:"%last",filter:"linear",srgb:!0,rgbm:!1}];t.useDistortionVR&&i.push("#define VR_DISTORTION"),(0,l.Z)().postProcessAscii&&i.push("#define ASCII_FOOL"),t.useFxaa?e.push({func:"fxaa",header:i,textures:n,out:{name:"%next"}}):e.push({func:"passThrough",header:i,textures:n,out:{name:"%next"}}),t.useSharpen&&(i=[],n=["%last"],t.hasBG&&(i.push("#define HAS_BACKGROUND"),n.push("TextureDepth")),e.push({func:"sharpen",header:i,textures:n,out:{name:"%next"},collapsible:!0})),t.useVignette&&e.push({func:"vignette",textures:[{name:"%last",filter:"nearest"}],out:{name:"%next"},collapsible:!0}),t.useGrain&&e.push({func:"grain",textures:"%last",out:{name:"%next"},collapsible:!0}),t.useDof&&e.push({func:"dofCross",textures:"%last",out:{name:"%next"},collapsible:!0}),t.webVR?e.push({func:"fadeVr",textures:"%last",out:{name:"%next"},collapsible:!0}):t.useExtra&&e.push({func:"composeExtra",textures:["%last","TextureExtra"],out:{name:"%next"},collapsible:!0}),t.hasBG||e.push({func:"finalPremultAlpha",textures:"%last",out:{name:"%next"},collapsible:!0})},_addFixedBackground:function(e,t,i){if("fixed"===t.bgType){var n=this.getNodeBackground().getBackground()||ar.Z.dummyTexture;n.divisor=-1,i.addExternalTexture("TextureFixed",n);var r=["%last","TextureFixed","TextureDepth"],a=[];t.useRefraction&&(r.push("TextureRefraction"),a.push("#define REFRACTION_COMPOSITING_EXCLUSION")),e.push({func:"composeFixedBackground",header:a,textures:r,uniforms:[so.scale],out:{name:"%next"},collapsible:!0})}},_addFixedBackgroundRefraction:function(e,t,i){if(!t.useRefraction||"fixed"!==t.bgType)return"%last";var n=this.getNodeBackground().getBackground()||ar.Z.dummyTexture;return n.divisor=-1,i.addExternalTexture("TextureFixed",n),e.push({func:{name:"composeFixedBackgroundRefraction",file:"composeFixedBackground.glsl"},textures:["%last","TextureFixed","TextureDepth"],uniforms:[so.scale],out:{name:"TextureWithBackground"}}),"TextureWithBackground"},_addPassThrough:function(e){e.push({func:"passThrough",textures:"%last",out:{name:"%next"}})},_createComposer:function(){var e=this._updateEffectiveConfig(),t=this._composer||new au.ComposerPostProcess;void 0===this._composer&&this._initComposer(t),t.clear();var i=[],n=e.useSsr&&(0,l.Z)().depthMipmap||e.useSsao,r=e.useSsr||e.useRefraction,a=0;n&&this._packMipmapDepth(i),e.useSsao&&this._addSsao(i),e.useSss&&this._addSss(i,t),e.useTransparency&&this._addCombineOpacity(i),r&&(a=this._packMipmapColor(i,e,t)),e.useRefraction&&this._addRefraction(i,e,t),e.useDof&&this._addDof(i),e.useBloom&&this._addBloom(i,e),this._addMergeable(i,e),this._addFixedBackground(i,e,t),a>0&&i.length===a&&this._addPassThrough(i);var o=0===i.length;if(this._addSuperSample(i,e),this._addFinalPass(i,e),this._addInternalTextures(t,e,o),t.build(i),this._assignInternalTextureToCamera(),Wa.Z.uOutputLinear.setInt(o?0:1),Wa.Z.uRGBMRange.setFloat(o?-1:this._model.get("rgbmDefault")),this.onBackgroundColor(),e.useRefraction||e.useSsr){var s=this.getOrCreateStateSet(),u=t.getInternalTexture("TextureToBeRefracted");s.setTextureAttributeAndModes(5,u),s.addUniform(ru.Uniform.createInt(5,"uTextureToBeRefracted")),u=(0,l.Z)().depthMipmap?t.getInternalTexture("TextureMipmapDepth"):t.getInternalTexture("TextureDepth"),s.setTextureAttributeAndModes(4,u),s.addUniform(ru.Uniform.createInt(4,"uTextureMipmapDepth"))}},_assignInternalTextureToCamera:function(){var e=this._composer,t=this._effectiveConfig,i=this._camera;i._textureOpaque=e.getInternalTexture("TextureOpaque"),t.useDepth&&(i._textureDepth=e.getInternalTexture("TextureDepth")),t.useTransparency&&(i._textureTransparent=e.getInternalTexture("TextureTransparent")),t.useRefraction&&(i._textureRefraction=e.getInternalTexture("TextureRefraction")),t.useExtra&&(i._textureExtra=e.getInternalTexture("TextureExtra"))},_resizeMipmapHeight:function(e,t,i){var n=e.getInternalTexture(t);if(n){var r=e._screenWidth,a=e._screenHeight,o=e._getTextureSize(r,n.divisor),s=e._getTextureSize(a,.5*n.divisor);n.setTextureSize(o,s);var l=e.getStateSetPass(i);if(l){l.getUniform("uTextureOutputSize").getInternalArray()[1]=s;for(var u=e.getCameras(),h=0;h<u.length;++h){var c=u[h];if(c.getName()===t)return void c.getViewport().setViewport(0,0,o,s)}}}},_hookComposerResize:function(e){var t=this,i=au.ComposerPostProcess.prototype;e.resizeRatio=function(n,r,a,o){i.resizeRatio.call(e,n,r,a,o),t._resizeMipmapHeight(e,"TextureToBeRefracted","packMipmapRefraction"),t._resizeMipmapHeight(e,"TextureMipmapDepth","packMipmapDepth")}},_initComposer:function(e){e.setScreenSize(this._viewerOSGJS.getCanvasWidth(),this._viewerOSGJS.getCanvasHeight()),e.setMethodWrapUV(1,1),this._hookComposerResize(e),this._viewer.bind("resizeCanvas",e.resize,e),this._viewer.bind("resizeRatio",e.resizeRatio,e),e.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),e.setName("PostProcess - Composer"),this.addChild(e),this._composer=e;var t=e.getOrCreateStateSet();for(var i in _l.Z)t.addUniform(_l.Z[i])},resetCameraAttachments:function(){var e=this._camera;e.resetAttachments(),e.fboOpaque&&(e.fboOpaque.reset(),e.fboOpaque=void 0),e.fboTransparent&&(e.fboTransparent.reset(),e.fboTransparent=void 0),e.fboRefraction&&(e.fboRefraction.reset(),e.fboRefraction=void 0),e.fboDepth&&(e.fboDepth.reset(),e.fboDepth=void 0),e.fboExtra&&(e.fboExtra.reset(),e.fboExtra=void 0),e.attachRenderBuffer(ru.FrameBufferObject.DEPTH_ATTACHMENT,ru.FrameBufferObject.DEPTH_COMPONENT16)},createPathStandard:function(){if(this._createComposer(),this.resetCameraAttachments(),(0,l.Z)().stats){var e=this._composer.getCameras();e[e.length-1].setRenderOrder(ru.Camera.POST_RENDER,0);var t,i=[];for(t=0;t<e.length;t++){var n=e[t].getName();-1===n.indexOf("FeedbackTexture")&&i.push(n)}this._viewer.setOptionStatsPostProcess(i);var r=za.Z.getTimerGPU();for(t=0;t<e.length;++t){var a=e[t],o=a.getName();a.setInitialDrawCallback(r.start.bind(r,o)),a.setFinalDrawCallback(r.end.bind(r,o))}this._camera.setFinalDrawCallback((function(){r.start("PostProcess")}));var s=this._viewerOSGJS.getCamera();s.setInitialDrawCallback(r.start.bind(r,"Total GL")),s.setFinalDrawCallback((function(){r.end("PostProcess"),r.end("Total GL")}))}}}),"osgSketchfab","PostProcess");const lu=su;var uu,hu,cu,Au,du,gu,fu,pu=A.Z.osg,mu=A.Z.osgUtil,_u=!1,vu=!1,Cu=!1,bu=function(e){this._dirty=!0,this._view3d=e,this._effectiveConfig=e._effectiveConfig,this._viewer=e._viewer,this._viewerOSGJS=e._viewerOSGJS,this._model=e.model;var t=(0,l.Z)().dofTransition;this._interpolatorDofFocusPoint=new mu.DelayInterpolator(3,t?.15:1),this._interpolatorDofBlurNear=new mu.DelayInterpolator(1,t?.15:1),this._interpolatorDofBlurFar=new mu.DelayInterpolator(1,t?.15:1),this._interpolatorDofCross=new mu.DelayInterpolator(1,t?.08:1),this._interpolatorDofCross._epsilon=-.01,this._dofInitialized=!1,this._dofAutoFocus=!1,this._currentEye=pu.vec3.create(),this._lastEye=pu.vec3.create(),this._currentRot=pu.quat.create(),this._lastRot=pu.quat.create(),this._dofLastPos=pu.vec3.create(),this._dofLastFocal=0,this._firstFrame=!0,this._cullConfig=vo.Z.vrConfig,this._skipTaaFrames=0,this._lastUpdateTime=this._viewerOSGJS.getFrameStamp().getSimulationTime();var i=this.dirty.bind(this);jn.bind("change:hasTransparency",i),jn.bind("change:hasExtra",i),jn.on("change:hasScattering",i),jn.on("change:hasRefraction",i),F.Z.getMaterial().then(function(){this.getBackgroundModel().bind("change:enable",i)}.bind(this)),this._hookViewerCheckNeedToDoFrame(),this._hookViewerFrame(),this._hookViewerComputeCanvasSize(),this._model.on("resetTaa",this.onResetTaa.bind(this)),(0,l.Z)().dofCircle||(this.showDofCross=function(){})};pu.createPrototypeObject(bu,{dirty:function(){this._dirty=!0,Cu=!0},onResetTaa:function(){this._skipTaaFrames=2},getMainCamera:function(){return this._view3d._camera},getNodeIn:function(){return this._view3d._nodeIn},getCurrentComposer:function(){return this._view3d._nodeIn._composer},getBackgroundModel:function(){return this._viewer.getFeatures().background.getModel()},updateTargetDofBlurNear:function(){this._interpolatorDofBlurNear.setTarget(this._model.get("dofBlurNear"))},updateTargetDofBlurFar:function(){this._interpolatorDofBlurFar.setTarget(this._model.get("dofBlurFar"))},getClampedProjectionMatrix:function(){var e=this.getMainCamera();return e.clampedProjectionMatrix||e.getProjectionMatrix()},onEffectChanged:function(){return k.Z.draw(),this.getNodeIn().createPathStandard()},_toggleComposerCameras:function(e){this._viewer.getSuperSample().setSwitch(e);var t=e?-1:0;this.getMainCamera().setNodeMask(t);var i=this.getCurrentComposer(),n=i?i.getCameras():void 0;if(void 0!==n)for(var r=0;r<n.length-1;r++)n[r].setNodeMask(t)},_hookViewerCheckNeedToDoFrame:function(){var e=this._viewerOSGJS,t=e.checkNeedToDoFrame.bind(e),i=this;e.checkNeedToDoFrame=function(){this._requestContinousUpdate&&k.Z.draw();var e=t(),n=_u;return _u=!1,e||!n?(i._toggleComposerCameras(!0),e):(i._toggleComposerCameras(!1),!0)}},_hookViewerFrame:function(){var e=this.getMainCamera(),t=this._viewerOSGJS,i=this._viewer.getSuperSample(),n=(0,l.Z)().vrMirror,r=this,a=t.frame.bind(t);t.frame=function(t,o){a(t,o),k.Z.setShadowForcedUpdate(!1),vu&&(vu=!1,r._skipTaaFrames=1,k.Z.draw(),a(t,o),Cu=!0),Cu&&(Cu=!1,r._skipTaaFrames=1,k.Z.draw(),a(t,o)),e.setNodeMask(-1),this._hmd&&this._hmd.isPresenting&&n&&(i.setSwitch(!1),e.setNodeMask(0),this.getCamera().getRenderer().draw())}},_hookViewerComputeCanvasSize:function(){this._resizeCanvasTimeout=-1,this._doResizeCanvas=!1,this._overrideCanvasWidth=-1,this._overrideCanvasHeight=-1,this._viewer.bind("resizeViewer",this._onResizeCanvas,this),this._viewer.bind("resizeViewerOnNextFrame",this._onForceResizeCanvas,this),this._cbEnableResizeCanvas=this._enableResizeCanvas.bind(this);var e=this._viewerOSGJS,t=this._viewer.getCanvas();this._originalCanvasResize=e.computeCanvasSize.bind(e,t),e.computeCanvasSize=this._computeCanvasSize.bind(e,t,this)},_onResizeCanvas:function(e,t){this._overrideCanvasWidth=e,this._overrideCanvasHeight=t,k.Z.draw()},_onForceResizeCanvas:function(e,t){this._enableResizeCanvas(),this._onResizeCanvas(e,t)},_enableResizeCanvas:function(){this._doResizeCanvas=!0},_resetResizeCanvas:function(){this._doResizeCanvas=!1,window.clearTimeout(this._resizeCanvasTimeout)},_computeCanvasSize:function(e,t){var i=t._overrideCanvasWidth,n=t._overrideCanvasHeight;if(i>0){var r=!1;return this._canvasWidth!==i&&(e.width=i,this._canvasWidth=i,r=!0),this._canvasHeight!==n&&(e.height=n,this._canvasHeight=n,r=!0),r}var a=t._viewer.getFeatures().inspector;if(!a)return!1;var o=a.getModel();if(t._doResizeCanvas)return o.set("viewerToCanvasRatio",1),t._resetResizeCanvas(),t._originalCanvasResize();window.ResizeObserver?du||((du=new window.ResizeObserver((function(){fu=e.clientWidth,gu=e.clientHeight}))).observe(e),fu=e.clientWidth,gu=e.clientHeight):(fu=e.clientWidth,gu=e.clientHeight);var s=Math.max(1,Math.floor(fu*this._devicePixelRatio))/Math.max(1,Math.floor(gu*this._devicePixelRatio))/(this._canvasWidth/this._canvasHeight);if(s===o.get("viewerToCanvasRatio"))return!1;o.set("viewerToCanvasRatio",s),t._resetResizeCanvas();var u=(0,l.Z)().resizeTimeout;return t._resizeCanvasTimeout=window.setTimeout(t._cbEnableResizeCanvas,u),!1},showDofCross:function(){this._interpolatorDofCross.getCurrent()[0]=1,this._interpolatorDofCross.setTarget(0),pu.vec3.copy(this._dofLastPos,this._model.get("dofFocusPoint")),this._dofLastFocal=this.computeFocalDistance(),k.Z.draw()},hideDofCross:function(){this._interpolatorDofCross.getCurrent()[0]=0,k.Z.draw()},computeFocalDistance:function(){var e=pu.vec4.create();return function(){pu.vec3.copy(e,this._interpolatorDofFocusPoint.getCurrent())[3]=1;var t=this._viewer.getCamera();pu.vec4.transformMat4(e,e,t.getViewMatrix()),pu.vec4.transformMat4(e,e,this.getClampedProjectionMatrix());var i=Wa.Z.uNearFar.getInternalArray();return(e[3]-i[0])/(i[1]-i[0])}}(),_updateInterpolatorDofFocusPoint:function(){var e=this._model.get("dofFocusPoint");this._interpolatorDofFocusPoint.setTarget(e[0],e[1],e[2])},updateDofFocusPoint:function(){this._updateInterpolatorDofFocusPoint(),this.showDofCross(),this._dofAutoFocus=!1},updateGrain:function(e){if(this._effectiveConfig.useGrain&&this._model.get("grainAnimated")){_u=!0;var t=e.getSimulationTime(),i=(0,l.Z)().grainSpeed/1e3;i>0&&t-this._lastUpdateTime>=i&&(_l.Z.uTimeGrain.setFloat(t/1e3),this._lastUpdateTime=t)}},_callbackPicking:function(e,t,i,n){if(!(e<0)){if(e>=1){var r=this._viewer.getFeaturesManager().getViewport3d(),a=_l.Z.uDofCross.getInternalArray();t=a[0]*r.width(),i=a[1]*r.height(),e=ke.Z.pickDepth(n,t,i)}if(e<1){var o=this._model.get("dofFocusPoint");ke.Z.getWorldPositionFromDepthXY(e,t,i,o),this._updateInterpolatorDofFocusPoint()}this.dofUpdateShowCross()}},dofPickFocusPoint:function(){var e=this._viewer.getFeaturesManager().getViewport3d(),t=this._callbackPicking.bind(this);ke.Z.getPixelDepth(.5*e.width(),.5*e.height(),t)},dofUpdateShowCross:function(e,t){if(this._dofAutoFocus)this._interpolatorDofCross.getCurrent()[0]=0;else{var i=pu.vec3.dist(this._dofLastPos,this._model.get("dofFocusPoint")),n=this.computeFocalDistance();i>.1*e&&Math.abs(n-this._dofLastFocal)>.075&&t>.1&&this.showDofCross()}},dofUpdateInterpolators:function(e,t){this._interpolatorDofBlurNear.setTarget(this._model.get("dofBlurNear")*t),this._interpolatorDofBlurFar.setTarget(this._model.get("dofBlurFar")*t);var i=this._viewer.getFeaturesManager().getViewport3d(),n=_l.Z.uDofCross.getInternalArray();ke.Z.getScreenPositionFromWorldPoint(this._model.get("dofFocusPoint"),n),n[0]/=i.width(),n[1]/=i.height();var r=e.getDeltaTime();this._interpolatorDofBlurNear.update(r),this._interpolatorDofBlurFar.update(r),this._interpolatorDofFocusPoint.update(r),this._interpolatorDofCross.update(r);var a=_l.Z.uDofBlurNearFarFocal.getInternalArray();a[0]=this._interpolatorDofBlurNear.getCurrent()[0],a[1]=this._interpolatorDofBlurFar.getCurrent()[0],a[2]=this.computeFocalDistance(),_l.Z.uDofCross.getInternalArray()[2]=this._interpolatorDofCross.getCurrent()[0],this._interpolatorDofCross.isDone()||(_u=!0)},_getAttenuationDof:function(e,t){var i=this._viewerOSGJS.getManipulator(),n=i.getHomeBoundingSphere(),r=t>=.01&&(0,l.Z)().dofAttenuateSpeed?0:1,a=i.getHomeDistance(i.getHomeBoundingSphere());if((0,l.Z)().dofAttenuateDistance){var o=(pu.vec3.dist(n.center(),this._currentEye)-e)/(a-e);r*=Math.max(0,Math.min(1,1-o))}return r},_getCameraMoveFactorSinceLastFocus:function(e){var t=this._viewerOSGJS.getManipulator().getInverseMatrix();pu.mat4.getRotation(this._currentRot,t),pu.quat.normalize(this._currentRot,this._currentRot);var i=pu.quat.dot(this._lastRot,this._currentRot);i=Math.abs(1-i*i),this._viewerOSGJS.getManipulator().getEyePosition(this._currentEye);var n=pu.vec3.dist(this._lastEye,this._currentEye);return Math.max(n/e,.1*i)},updateDof:function(e){if(this._model.isEffectiveDof()){var t=Wa.Z.uNearFar.getInternalArray();if(!(t[0]>t[1])){this.updateDofScaleUniform();var i=this._viewerOSGJS.getManipulator().getHomeBoundingSphere().radius(),n=this._getCameraMoveFactorSinceLastFocus(i),r=this._getAttenuationDof(i,n),a=!0;!this._dofInitialized||(0,l.Z)().dofSticky?(this._updateInterpolatorDofFocusPoint(),F.Z.getFirstCameraAnimation().isFulfilled()&&(this._dofInitialized=!0)):this._dofAutoFocus||n>.01?(this._dofAutoFocus=n>1e-5,this.dofPickFocusPoint(),this.dofUpdateShowCross(i,r)):(this._updateInterpolatorDofFocusPoint(),a=!1),this.dofUpdateInterpolators(e,r),a&&(pu.vec3.copy(this._lastEye,this._currentEye),pu.quat.copy(this._lastRot,this._currentRot))}}},updateDofScaleUniform:function(){var e=this._viewer.getFeaturesManager().getViewport3d();_l.Z.uDofScale.getInternalArray()[0]=.0015*e.height()/(0,l.Z)().dofRes},updateDirtyEffect:function(){var e=this._viewerOSGJS.getCanvasWidth(),t=this._viewerOSGJS.getCanvasHeight();this._width&&this._height||(this._width=this._height=-1),this._dirty&&(this.onEffectChanged(),this._dirty=!1),e===this._width&&t===this._height||(this._viewer.trigger("resizeCanvas",e,t),this.getNodeIn().resetCameraAttachments(),this._width=e,this._height=t,vu=!0,k.Z.draw())},updateFade:function(e){var t=this._model.get("vrFading");if(this._model.get("vrStartFade")&&!t&&(this._model.set("vrStartFade",!1),t=!0,this._model.set("vrFading",!0),this._model.set("vrFadeStartTime",e.getSimulationTime())),t){var i=this._model.get("vrFadeStartTime"),n=this._model.get("vrFadeLength"),r=e.getSimulationTime(),a=(r-i)/n,o=this._model.get("vrFadeCallback");r>i+n&&(a=1-(a-1),o&&(o(),this._model.set("vrFadeCallback",void 0)));var s=_l.Z.uVrFadeFactor.getInternalArray();a>=0?s[0]=a:(s[0]=0,this._model.set("vrFading",!1))}},updateVeil:function(){_l.Z.uVrVeilFactor.getInternalArray()[0]=this._model.get("veilFactor")},_sssGaussian:function(e,t,i){var n=t/(.001+i);return Math.exp(-n*n/(2*e))/(2*Math.PI*e)},_sssProfile:function(e,t){return.1*this._sssGaussian(.0484,e,t)+.118*this._sssGaussian(.187,e,t)+.113*this._sssGaussian(.567,e,t)+.358*this._sssGaussian(1.99,e,t)+.078*this._sssGaussian(7.41,e,t)},_computeSSSKernel:function(e,t,i,n){var r=(0,l.Z)().sssHalfKernel,a=2*r-1,o=0,s=e*r*4,u=s+0,h=s+1,c=s+2,A=s+3,d=this._model.getSSSWeightRange(),g=Math.pow(d,2),f=2*d/(a-1);for(o=0;o<r;o++){var p=d-o*f;t[4*o+A]=d*Math.pow(p,2)/g}var m=0;for(o=0;o<r;o++){var _=t[4*o+A],v=((o>0?Math.abs(_-t[4*(o-1)+A]):0)+(m=o<r-1?Math.abs(_-t[4*(o+1)+A]):m))/2;t[4*o+u]=v*this._sssProfile(_,n[0]),t[4*o+h]=v*this._sssProfile(_,n[1]),t[4*o+c]=v*this._sssProfile(_,n[2])}for(var C=t[4*(o=r-1)+u],b=t[4*o+h],S=t[4*o+c],E=t[4*o+A];o>0;o--){var y=4*o,I=4*(o-1);t[y+u]=t[I+u],t[y+h]=t[I+h],t[y+c]=t[I+c],t[y+A]=t[I+A]}t[u]=C,t[h]=b,t[c]=S,t[A]=E;var x=t[u],T=t[h],w=t[c];for(o=1;o<r;o++)x+=2*t[4*o+u],T+=2*t[4*o+h],w+=2*t[4*o+c];for(o=0;o<r;o++)t[4*o+u]/=x,t[4*o+h]/=T,t[4*o+c]/=w;for(t[u]=1*(1-i[0])+i[0]*t[u],t[h]=1*(1-i[1])+i[1]*t[h],t[c]=1*(1-i[2])+i[2]*t[c],o=1;o<r;o++)t[4*o+u]*=i[0],t[4*o+h]*=i[1],t[4*o+c]*=i[2]},updateSSS:function(){_l.Z.uProjFactor.getInternalArray()[0]=this.getClampedProjectionMatrix()[0];var e=j.Z.getModelBoxWithoutDisplacement();if(e){var t=e.radius(),i=Wa.Z.uScatteringFactorPacker.getInternalArray(),n=t*vi.Z.getBoxFactor("SubsurfaceScattering");i[0]=1/n,Wa.Z.uNormalizeFactorThickness.getInternalArray()[0]=.2*t*.25}if(!this._model.get("sssKernelDone")){this._model.set("sssKernelDone",!0);for(var r=this._model.get("sssProfiles"),a=r.length,o=(0,l.Z)().sssHalfKernel,s=new Float32Array(4*a*o),u=0,h=r.length;u<h;u++){var c=r[u];this._computeSSSKernel(u,s,c.strength,c.falloff)}var A=this._view3d._sssTexKernel;if(A.setTextureSize(o,a),A.setMinFilter(pu.Texture.LINEAR),A.setMagFilter(pu.Texture.LINEAR),this._model.useSSSLookupFloat())return A.setImage(s,pu.Texture.RGBA),void A.setInternalFormatType(pu.Texture.FLOAT);var d=new Uint8Array(4*o*a),g=this._model.getSSSWeightRange();for(u=0;u<o*a;++u){var f=4*u;d[f]=Math.floor(255*s[f]),d[f+1]=Math.floor(255*s[f+1]),d[f+2]=Math.floor(255*s[f+2]),d[f+3]=Math.floor(s[f+3]/g*255)}A.setImage(d,pu.Texture.RGBA),A.setInternalFormatType(pu.Texture.UNSIGNED_BYTE)}},updateSsao:function(){if(this._model.isEffectiveSsao()){var e=Wa.Z.uNearFar.getInternalArray();if(!(e[0]>e[1])){var t=this._viewer.getFeaturesManager().getViewport3d(),i=this.getClampedProjectionMatrix(),n=1===i[15]?1:2/i[5],r=-2*Math.tan(.5*n);_l.Z.uSsaoProjectionScale.setFloat(t.height()/r);var a=_l.Z.uSsaoProjectionInfo.getInternalArray();a[0]=-2/(t.width()*i[0]),a[1]=-2/(t.height()*i[5]),a[2]=(1-i[8])/i[0],a[3]=(1-i[9])/i[5]}}},updateViewSpaceCorners:(hu=[pu.vec4.fromValues(-1,-1,0,1),pu.vec4.fromValues(-1,1,0,1),pu.vec4.fromValues(1,-1,0,1),pu.vec4.fromValues(1,1,0,1)],cu=pu.mat4.create(),Au=pu.vec3.create(),function(e,t){pu.mat4.invert(cu,e);for(var i=0;i<4;i++)pu.vec3.transformMat4(Au,hu[i],cu),t[2*i]=Au[0]/Au[2],t[2*i+1]=Au[1]/Au[2]}),updateTaaMatrices:function(e,t,i){var n=i.invViewMatrix.getInternalArray();pu.mat4.invert(n,e);var r=i.lastFrame.getInternalArray(),a=i.currentFrame.getInternalArray();pu.mat4.copy(r,a),pu.mat4.multiply(a,t,e),this._firstFrame&&pu.mat4.copy(r,a);var o=i.motionMatrix.getInternalArray();pu.mat4.multiply(o,r,n),this.updateViewSpaceCorners(t,i.corners.getInternalArray())},updateTAA:(uu=pu.mat4.create(),function(){var e=Wa.Z.uNearFar.getInternalArray();if(e[0]>e[1]||!this._model.get("taaEnable"))_l.Z.uTaaEnabled.setFloat(0);else{var t,i=this._viewer.getCamera().getViewMatrix(),n=this._cullConfig.doVR;n?(pu.mat4.multiply(uu,this._cullConfig.leftOffsetView,i),t=this._cullConfig.leftProjection):(uu=i,t=this.getClampedProjectionMatrix());var r=_l.Z;this.updateTaaMatrices(uu,t,{motionMatrix:r.uTaaMotionMatrixLeft,invViewMatrix:r.uTaaInvViewMatrixLeft,lastFrame:r.uTaaLastFramePVLeft,currentFrame:r.uTaaCurrentFramePVLeft,corners:r.uTaaCornersCSLeft}),n&&(pu.mat4.multiply(uu,this._cullConfig.rightOffsetView,i),this.updateTaaMatrices(uu,this._cullConfig.rightProjection,{motionMatrix:r.uTaaMotionMatrixRight,invViewMatrix:r.uTaaInvViewMatrixRight,lastFrame:r.uTaaLastFramePVRight,currentFrame:r.uTaaCurrentFramePVRight,corners:r.uTaaCornersCSRight})),this._firstFrame&&(this._firstFrame=!1);var a=this._viewer.getFeatures().animation.getModel(),o=0===this._skipTaaFrames&&a.canActivateTAA();_l.Z.uTaaEnabled.setFloat(o?1:0),this._skipTaaFrames>0&&--this._skipTaaFrames}}),updateNearFarRatio:function(){var e,t=this._viewer.getFeatures();if(this._model.get("webVR")){var i=j.Z.getModelBoxWithDisplacement(),n=i?i.radius():1,r=t.webVR.getModel().get("worldFactor")/n;e=r>0?.005*Math.max(.1,r):.005}else e=t.camera.getModel().get("nearFarRatio");this.getMainCamera().setNearFarRatio(e)},updateGlobalTexUniforms:function(){var e=this._viewer.getFeaturesManager(),t=Wa.Z.uGlobalTexSize.getInternalArray(),i=Wa.Z.uGlobalTexRatio.getInternalArray(),n=Wa.Z.uHalton.getInternalArray();Wa.Z.uPreviousGlobalTexSize.setFloat2(t),Wa.Z.uPreviousGlobalTexRatio.setFloat2(i),Wa.Z.uPreviousHalton.setFloat4(n);var r=e.getViewport3d();t[0]=r.width(),t[1]=r.height();var a=this.getCurrentComposer();i[0]=a.getGlobalXRatio(),i[1]=a.getGlobalYRatio();var o=a.getInternalTexture("TextureToBeRefracted");if(o||this._model.isEffectiveSsr()){var s=Wa.Z.uTextureToBeRefractedSize.getInternalArray();if(s[0]=o.getWidth(),s[1]=o.getHeight(),!this._model.get("taaEnable")){var l=this.getClampedProjectionMatrix(),u=_l.Z.uTaaCornersCSLeft.getInternalArray();this.updateViewSpaceCorners(l,u)}}},_shadowJitterUpdate:function(e){if(Ci.Z.get("mask")&Ci.Z.LIT){var t=1+e;Wa.Z.uStaticFrameNumShadow0.setFloat(t),Wa.Z.uStaticFrameNumShadow1.setFloat(t),Wa.Z.uStaticFrameNumShadow2.setFloat(t),Wa.Z.uStaticFrameNumShadow3.setFloat(t)}},updateGlobalUniforms:function(e){this.updateNearFarRatio(),this.updateGlobalTexUniforms(),Wa.Z.uTimeViewer.setFloat(e.getSimulationTime()/1e3);var t=j.Z.getModelBoxWithDisplacement();Wa.Z.uBoxRadius.setFloat(t?t.radius():1),Wa.Z.uPixelRatio.setFloat2(Le.Z.getPixelRatio());var i=this._viewer.getSuperSample(),n=(e.getFrameNumber()+i.getFrameNumber())%16;this._shadowJitterUpdate(n),Wa.Z.uFrameMod.setFloat(n);var r=i.isEnabled()||_l.Z.uTaaEnabled.getInternalArray()[0];Wa.Z.uFrameModTaaSS.setFloat(r?n:0);var a=Wa.Z.uReprojectViewProj.getInternalArray(),o=Wa.Z.uPreviousProjection.getInternalArray(),s=Wa.Z.uPreviousViewInvView.getInternalArray(),l=this._viewer.getCamera().getViewMatrix(),u=this._cullConfig.doVR?this._cullConfig.leftProjection:this.getClampedProjectionMatrix();this._tmpView?(pu.mat4.invert(s,l),pu.mat4.mul(s,this._tmpView,s),pu.mat4.mul(a,this._tmpProjection,s),pu.mat4.copy(o,this._tmpProjection),pu.mat4.copy(this._tmpView,l),pu.mat4.copy(this._tmpProjection,u)):(this._tmpView=pu.mat4.clone(l),this._tmpProjection=pu.mat4.clone(u),pu.mat4.copy(a,u))},cull:function(e,t){if(t.traverse(e),!this._model.get("postProcessReady"))return!1;var i=t.getFrameStamp();return this.updateTAA(i),this.updateSSS(i),this.updateSsao(i),this.updateGrain(i),this.updateDof(i),this.updateFade(i),this.updateVeil(i),this.updateDirtyEffect(),this.updateGlobalUniforms(i),!1}});const Su=bu;var Eu=A.Z.osg;var yu={FeatureName:"postProcess",ModelType:hl,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:webVR",this.dirty,this),e.bind("change:distortVR",this.dirty,this),e.bind("change:enable",this.dirty,this),e.bind("change:grainEnable",this.checkGrainEnable,this),e.bind("change:sharpenEnable",this.checkSharpenEnable,this),e.bind("change:chromaticAberrationEnable",this.checkChromaticAberrationEnable,this),e.bind("change:vignetteEnable",this.checkVignetteEnable,this),e.bind("change:bloomEnable",this.checkBloomEnable,this),e.bind("change:dofEnable",this.checkDofEnable,this),e.bind("change:toneMappingEnable",this.dirty,this),e.bind("change:colorBalanceEnable",this.dirty,this),e.bind("change:ssaoEnable",this.checkSsaoEnable,this),e.bind("change:ssrEnable",this.checkSsrEnable,this),Ci.Z.bind("change:mask",this.checkSsrEnable,this),e.bind("change:taaEnable",this.checkTaaEnable,this),e.bind("change:taaTransparent",this.checkTaaTransparentEnable,this),e.bind("change:distortion",this.onDistortionChanged,this),e.bind("change:projectionLeft",this.onProjectionLeftChanged,this),e.bind("change:unprojectionLeft",this.onUnprojectionLeftChanged,this),e.bind("change:grainFactor",this.onGrainFactor,this),e.bind("change:sharpenFactor",this.onSharpenFactor,this),e.bind("change:chromaticAberrationFactor",this.onChromaticAberrationFactor,this),e.bind("change:vignetteAmount",this.onVignetteLensChanged,this),e.bind("change:vignetteHardness",this.onVignetteLensChanged,this),e.bind("change:bloomFactor",this.onBloomFactorChanged,this),e.bind("change:bloomThreshold",this.onBloomThresholdChanged,this),e.bind("change:bloomRadius",this.onBloomRadiusChanged,this),e.bind("change:toneMappingExposure",this.onToneMappingExposureChanged,this),e.bind("change:toneMappingBrightness",this.onToneMappingBrightnessChanged,this),e.bind("change:toneMappingContrast",this.onToneMappingContrastChanged,this),e.bind("change:toneMappingSaturation",this.onToneMappingSaturationChanged,this),e.bind("change:toneMappingMethod",this.onToneMappingMethodChanged,this),e.bind("change:colorBalanceLow",this.onColorBalanceShiftChanged,this),e.bind("change:colorBalanceMid",this.onColorBalanceShiftChanged,this),e.bind("change:colorBalanceHigh",this.onColorBalanceShiftChanged,this),e.bind("change:dofFocusPoint",this.onDofFocusPoint,this),e.bind("change:dofBlurNear",this.onDofBlurNear,this),e.bind("change:dofBlurFar",this.onDofBlurFar,this),e.bind("change:ssaoIntensity",this.onSsaoIntensity,this),e.bind("change:ssaoRadius",this.onSsaoRadius,this),e.bind("change:ssaoBias",this.onSsaoBias,this),e.bind("change:ssrFactor",this.onSsrFactor,this),e.bind("change",k.Z.draw),this._effectiveConfig={},this._viewer=this.model._viewer,this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._sssTexKernel=new Eu.Texture,this._sssTexKernel.divisor=-1,this._camera=this._createMainCamera(),this._nodeIn=new lu(this),this._nodeOut=this._createNodeOut(),this._nodeIn.addChild(this._camera),this._camera.addChild(this._nodeOut),this._callbackPostProcess=new Su(this),this._nodeIn.setCullCallback(this._callbackPostProcess),this._initUniforms()},dirty:function(){this._callbackPostProcess.dirty()},_initUniforms:function(){var e=this.model.attributes;for(var t in e)this.model.trigger("change:"+t)},_createNodeOut:function(){var e=new Eu.Node;return e.setName("PostProcess - node Out"),vo.Z.nodePostProcessOut=e,e},_createMainCamera:function(){var e=new Eu.Camera,t=this._viewerOSGJS.getCanvasWidth(),i=this._viewerOSGJS.getCanvasHeight();return e.setViewport(new Eu.Viewport(0,0,t,i)),e.setName("PostProcess - MainCamera"),e.setRenderOrder(Eu.Camera.PRE_RENDER,0),e.attachRenderBuffer(Eu.FrameBufferObject.DEPTH_ATTACHMENT,Eu.FrameBufferObject.DEPTH_COMPONENT16),vo.Z.cameraMain=e,e},methodToInt:function(e){return"reinhard"===e?1:"filmic"===e?2:0},checkGrainEnable:function(){this._effectiveConfig.useGrain!==this.model.isEffectiveGrain()&&this.dirty()},checkSharpenEnable:function(){this._effectiveConfig.useSharpen!==this.model.isEffectiveSharpen()&&this.dirty()},checkChromaticAberrationEnable:function(){this._effectiveConfig.useChromaticAberration!==this.model.isEffectiveChromaticAberration()&&this.dirty()},checkVignetteEnable:function(){this._effectiveConfig.useVignette!==this.model.isEffectiveVignette()&&this.dirty()},checkBloomEnable:function(){this._effectiveConfig.useBloom!==this.model.isEffectiveBloom()&&this.dirty()},checkDofEnable:function(){this._effectiveConfig.useDof!==this.model.isEffectiveDof()&&this.dirty()},checkSsaoEnable:function(){this._effectiveConfig.useSsao!==this.model.isEffectiveSsao()&&this.dirty()},checkSsrEnable:function(){this._effectiveConfig.useSsr!==this.model.isEffectiveSsr()&&this.dirty()},checkTaaEnable:function(){this._effectiveConfig.useTaa!==this.model.get("taaEnable")&&this.dirty()},checkTaaTransparentEnable:function(){this._effectiveConfig.useTaaTransparent!==(this.model.get("taaEnable")&&this.model.get("taaTransparent"))&&this.dirty()},onDistortionChanged:function(){_l.Z.uDistortion.setFloat2(this.model.get("distortion"))},onProjectionLeftChanged:function(){_l.Z.uProjectionLeft.setFloat4(this.model.get("projectionLeft"))},onUnprojectionLeftChanged:function(){_l.Z.uUnprojectionLeft.setFloat4(this.model.get("unprojectionLeft"))},onGrainFactor:function(){_l.Z.uGrainFactor.setFloat(this.model.get("grainFactor")),this.checkGrainEnable()},onSharpenFactor:function(){_l.Z.uSharpFactor.setFloat(this.model.get("sharpenFactor")),this.checkSharpenEnable()},onChromaticAberrationFactor:function(){_l.Z.uChromaFactor.setFloat(this.model.get("chromaticAberrationFactor")),this.checkChromaticAberrationEnable()},onVignetteLensChanged:function(){var e=_l.Z.uLensRadius.getInternalArray(),t=this.model.get("vignetteAmount"),i=this.model.get("vignetteHardness");e[0]=2-t-i,e[1]=i-t,this.checkVignetteEnable()},onBloomFactorChanged:function(){_l.Z.uBloomFactor.setFloat(this.model.get("bloomFactor")),this.checkBloomEnable()},onBloomThresholdChanged:function(){_l.Z.uBloomThreshold.setFloat(this.model.get("bloomThreshold")),this.checkBloomEnable()},onBloomRadiusChanged:function(){_l.Z.uBloomRadius.setFloat(this.model.get("bloomRadius")),this.checkBloomEnable()},onColorBalanceShiftChanged:function(){_l.Z.uColorBalanceLow.setFloat3(this.model.get("colorBalanceLow")),_l.Z.uColorBalanceMid.setFloat3(this.model.get("colorBalanceMid")),_l.Z.uColorBalanceHigh.setFloat3(this.model.get("colorBalanceHigh"))},onToneMappingExposureChanged:function(){_l.Z.uToneExposure.setFloat(this.model.get("toneMappingExposure"))},onToneMappingBrightnessChanged:function(){_l.Z.uToneBrightness.setFloat(this.model.get("toneMappingBrightness"))},onToneMappingContrastChanged:function(){_l.Z.uToneContrast.setFloat(this.model.get("toneMappingContrast"))},onToneMappingSaturationChanged:function(){_l.Z.uToneSaturation.setFloat(this.model.get("toneMappingSaturation"))},onToneMappingMethodChanged:function(){_l.Z.uToneMethod.setInt(this.methodToInt(this.model.get("toneMappingMethod")))},onDofFocusPoint:function(){this._callbackPostProcess.updateDofFocusPoint()},onDofBlurNear:function(){this._callbackPostProcess.updateTargetDofBlurNear(),this.checkDofEnable()},onDofBlurFar:function(){this._callbackPostProcess.updateTargetDofBlurFar(),this.checkDofEnable()},hideDofCross:function(){this._callbackPostProcess.hideDofCross()},onSsaoRadius:function(){_l.Z.uSsaoRadius.setFloat(this.model.get("ssaoRadius")),this.checkSsaoEnable()},onSsaoIntensity:function(){_l.Z.uSsaoIntensity.setFloat(this.model.get("ssaoIntensity")),this.checkSsaoEnable()},onSsaoBias:function(){_l.Z.uSsaoBias.setFloat(this.model.get("ssaoBias"))},onSsrFactor:function(){Wa.Z.uSsrFactor.setFloat(this.model.get("ssrFactor")),this.checkSsrEnable()}})]},Iu=n.Z.create(yu);Iu.prototype.getNodeIn=function(){return this._views[0]._nodeIn},Iu.prototype.getNodeOut=function(){return this._views[0]._nodeOut},Iu.prototype.getCamera=function(){return this._views[0]._camera},Iu.prototype.getCurrentComposer=function(){return this._views[0]._nodeIn._composer},Iu.prototype.prepareForScreenShot=function(){Wa.Z.uSSAARestart.setFloat(1),this._views[0].hideDofCross()},Iu.prototype.resetAfterScreenShot=function(){Wa.Z.uSSAARestart.setFloat(0)};const xu=Iu;var Tu=A.Z.osg;const wu=Kn().Model.extend({defaults:{colorSelection:Tu.vec3.fromValues(1,1,0),colorHover:Tu.vec3.fromValues(1,.5,0),durationOutline:-1,durationHighlight:-1,outlineWidth:1},getName:function(){return"Outline"}});var Mu,Ru=i("IcDE"),Bu=A.Z.osg,Nu=A.Z.osgUtil,Du=Bu.StateAttribute.OVERRIDE_ON,Pu=function(e){Bu.Node.call(this),this._viewerWebGL=e,this._viewerOSGJS=e.getViewerOSGJS(),this._durationOutline=5e3,this._timerOutline=void 0,this._durationHighlight=5e3,this._timerHighlight=void 0,this._nodeProxy=new Bu.Node,this._outlineScene=new Bu.Node,this._paths=void 0,this._cbHideHighlight=this.hideHighlight.bind(this),this._cbHideOutline=this.hideOutline.bind(this);var t=Ze.Z.DEPTH_DISABLE;this._stateSetSelection=new Bu.StateSet,this._uColorSelection=Bu.Uniform.createFloat3("uOutlineColor"),this._stateSetSelection.addUniform(this._uColorSelection),this._stateSetSelection.setAttributeAndModes(t,Du),this._stateSetHover=new Bu.StateSet,this._uColorHover=Bu.Uniform.createFloat3("uOutlineColor"),this._stateSetHover.addUniform(this._uColorHover),this._stateSetHover.setAttributeAndModes(t,Du),this._uOutlineFactor=Bu.Uniform.createFloat(.25,"uOutlineFactor"),this._uHighlightFactor=Bu.Uniform.createFloat(0,"uHighlightFactor"),this._uLineWidth=Bu.Uniform.createFloat(1,"uLineWidth"),this.init()};Bu.createPrototypeNode(Pu,Bu.objectInherit(Bu.Node.prototype,{getComposer:function(){return this._composer},setColorSelection:function(e){Bu.vec3.copy(this._uColorSelection.getInternalArray(),e)},setColorHover:function(e){Bu.vec3.copy(this._uColorHover.getInternalArray(),e)},setDurationHighlight:function(e){this._durationHighlight=e},setDurationOutline:function(e){this._durationOutline=e},setOutlineWidth:function(e){this._uLineWidth.getInternalArray()[0]=e},showOutline:function(){jn.setOutline(!0),this._nodeProxy.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._clearTimeoutOutline(),this._durationOutline>=0&&(this._timerOutline=setTimeout(this._cbHideOutline,this._durationOutline)),this._uHighlightFactor.setFloat(0!==this._durationHighlight?.15:0),this._clearTimeoutHighlight(),this._durationHighlight>=0&&this._durationHighlight<this._durationOutline&&(this._timerHighlight=setTimeout(this._cbHideHighlight,this._durationHighlight)),k.Z.draw()},hideOutline:function(){this._nodeProxy.setNodeMask(0),this._clearTimeoutOutline(),this.hideHighlight(),k.Z.draw()},hideHighlight:function(){this._uHighlightFactor.setFloat(0),this._clearTimeoutHighlight(),k.Z.draw()},_clearTimeoutOutline:function(){void 0!==this._timerOutline&&(clearTimeout(this._timerOutline),this._timerOutline=void 0)},_clearTimeoutHighlight:function(){void 0!==this._timerHighlight&&(clearTimeout(this._timerHighlight),this._timerHighlight=void 0)},clearOutlineScene:function(){for(var e=this._outlineScene,t=e.getChildren(),i=0,n=t.length;i<n;++i){var r=t[i];r.getChildren()[0].removeChildren(),r.removeChildren()}e.removeChildren()},_getMaterialNode:function(e){var t=e.getStateSet();return t&&t.getAttribute("SketchfabMaterial")?t:void 0},_getLastMaterialPath:function(e,t){for(var i=t||0,n=e.length-1;n>=i;--n){var r=this._getMaterialNode(e[n]);if(r)return r}},addPaths:(Mu=function(e){this._path=e},Bu.createPrototypeObject(Mu,{update:function(e){return e.setMatrix(Bu.computeLocalToWorld(this._path)),Mu}}),function(e,t){for(var i=this._outlineScene,n=t?this._stateSetHover:this._stateSetSelection,r=0,a=e.length;r<a;++r){var o=e[r],s=new Bu.MatrixTransform,l=new Bu.Node;i.addChild(s),s.addChild(l);var u=o[o.length-1];l.addChild(u),s.setStateSet(n),this._getMaterialNode(u)||l.setStateSet(this._getLastMaterialPath(o)),(0,Ru.Z)(o)?s.addUpdateCallback(new Mu(o)):s.setMatrix(Bu.computeLocalToWorld(o))}}),addPathsHover:function(e){this.addPaths(e,!0)},createSubSceneRtt:function(e){var t=new Bu.Camera;t.setName("Outline Camera"),t.setClearColor(Bu.vec4.create()),t.setRenderOrder(Bu.Camera.PRE_RENDER,0),t.attachTexture(Bu.FrameBufferObject.COLOR_ATTACHMENT0,e);var i=t.getOrCreateStateSet();return i.setShaderGeneratorName("outline",Du),i.setAttribute(new Sr.Z),t},init:function(){var e=Ze.Z.CULL_DISABLE;this._outlineScene.getOrCreateStateSet().setAttributeAndModes(e,Du);var t=this._createComposer();this._composer=t;var i=t.getInternalTexture("TextureOutline"),n=this.createSubSceneRtt(i);this._cameraRtt=n,n.addChild(this._outlineScene),this._nodeProxy.addChild(n),this._nodeProxy.addChild(t),this.addChild(this._nodeProxy),this._nodeProxy.setNodeMask(0)},_createComposer:function(){var e=new Nu.ComposerPostProcess,t=this._viewerOSGJS;e.setMethodWrapUV(1,1),e.setScreenSize(t.getCanvasWidth(),t.getCanvasHeight()),e.setFinalPassUpScaleToScreen(!1),e.addInternalTexture({name:"TextureOutline",immuable:!0,srgb:!0,rgbm:!1}),e.build({func:"outline",textures:["TextureOutline"],uniforms:[this._uOutlineFactor,this._uHighlightFactor,this._uLineWidth],out:{name:"%next"}});var i=e.getStateSetPass("outline"),n=Ze.Z.BLEND_SUBSTRACTIVE;return i.setAttributeAndModes(n),i.setRenderBinDetails(Me.Z.OUTLINE,"RenderBin"),this._viewerWebGL.bind("resizeCanvas",e.resize,e),this._viewerWebGL.bind("resizeRatio",e.resizeRatio,e),e}}),"osgSketchfab","Outline");const Fu=Pu;var Ou,Lu=A.Z.osg,ku=A.Z.osgAnimation,Zu=function(e){Lu.ComputeBoundsVisitor.call(this),this._paths=[],this.setStateSet(e)};Lu.createPrototypeObject(Zu,Lu.objectInherit(Lu.ComputeBoundsVisitor.prototype,{reset:function(){Lu.ComputeBoundsVisitor.prototype.reset.call(this),this._pushIfGeo=!1,this._paths.length=0,this._bonesBoxMatrix={},this._usedBones={}},setStateSet:function(e){this.reset(),this._stateSet=e},getBoundingBox:(Ou=new Lu.BoundingBox,function(){for(var e in this._usedBones){var t=this._bonesBoxMatrix[e];t&&(Ou.copy(t.box),Ou.transformMat4(Ou,t.matrix),this._bb.expandByBoundingBox(Ou))}return this._bb}),apply:function(e){var t=e.getStateSet(),i=this._pushIfGeo;if(t&&void 0!==t._materialID&&(this._pushIfGeo=t===this._stateSet),this._pushIfGeo&&e instanceof Lu.Geometry&&(this._paths.push(this.nodePath.slice(0)),e instanceof ku.RigGeometry)){var n=e.getBoneNameID();for(var r in n)this._usedBones[r]=1}Lu.ComputeBoundsVisitor.prototype.apply.call(this,e),this._pushIfGeo=i},pushMatrix:function(e){var t=this.nodePath[this.nodePath.length-1];if(t instanceof ku.Bone){var i=t.getBoneBoundingBox();i.valid()&&(this._bonesBoxMatrix[t.getName()]={matrix:Lu.mat4.clone(e),box:i})}Lu.ComputeBoundsVisitor.prototype.pushMatrix.call(this,e)},applyBoundingBox:function(e){this._pushIfGeo&&Lu.ComputeBoundsVisitor.prototype.applyBoundingBox.call(this,e)}}));const Uu=Zu;var Vu,Qu=A.Z.osg;var Gu={FeatureName:"outline",ModelType:wu,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS();var e=this.model;e.bind("change:colorSelection",this.onColorSelectionChanged,this),e.bind("change:colorHover",this.onColorHoverChanged,this),e.bind("change:outlineWidth",this.onOutlineWiddthChanged,this),e.bind("hideOutline",this.onHideOutline,this),e.bind("hideHighlight",this.onHideHighlight,this),e.bind("clearFocusTimeout",this.onClearFocusTimeout,this),this._nodeOutline=new Fu(this._viewer),this._nodeOutline.setName("Feature - Outline"),this.onColorSelectionChanged(),this.onColorHoverChanged(),this.onOutlineWiddthChanged(),this.model.bind("displayOutlineFocus",this._onMaterialChange.bind(this,!0)),this.model.bind("displayOutlineNoFocus",this._onMaterialChange.bind(this,!1))},getNodeOutline:function(){return this._nodeOutline},onColorSelectionChanged:function(){this._nodeOutline.setColorSelection(this.model.get("colorSelection"))},onColorHoverChanged:function(){this._nodeOutline.setColorHover(this.model.get("colorHover"))},onOutlineWiddthChanged:function(){this._nodeOutline.setOutlineWidth(this.model.get("outlineWidth"))},onHideOutline:function(){this._nodeOutline.hideOutline()},onHideHighlight:function(){this._nodeOutline.hideHighlight()},onClearFocusTimeout:function(){void 0!==this._timer&&(window.clearTimeout(this._timer),this._timer=void 0)},_focusOnBound:function(e){var t=this._viewer.getFeaturesManager(),i=e.getBoundingBox(),n=this._nodeOutline;this.onClearFocusTimeout(),this._timer=window.setTimeout((function(){t.focusOnBound(i,1)||t.focusOnHomePosition(1),n.showOutline()}),200)},_onMaterialChange:(Vu=new Uu,function(e,t,i){var n=this._viewer.getFeaturesManager();if(n){Vu.setStateSet(t||i),n.getWorldNode().accept(Vu);var r=Vu._paths;0!==r.length?(e&&this._focusOnBound(Vu),this._nodeOutline.clearOutlineScene(),t?(this._nodeOutline.addPaths(r),i&&(Vu.setStateSet(i),n.getWorldNode().accept(Vu),this._nodeOutline.addPathsHover(Vu._paths))):this._nodeOutline.addPathsHover(r),this._nodeOutline.setDurationOutline(1e3*this.model.get("durationOutline")),this._nodeOutline.setDurationHighlight(1e3*this.model.get("durationHighlight")),e||this._nodeOutline.showOutline()):Qu.error("Cound not find nodes attached to the stateset.")}})})]},Hu=n.Z.create(Gu);Hu.prototype.getNode=function(){return this._views[0].getNodeOutline()},Hu.prototype.prepareForScreenShot=function(){return this.getNode().hideOutline(),!1};const zu=Hu;var Wu=function(e){this.coefficients=e};Wu.prototype.distortInverse=function(e){for(var t=e/.9,i=.9*e,n=e-this.distort(t);Math.abs(i-t)>1e-4;){var r=e-this.distort(i),a=i-r*((i-t)/(r-n));t=i,i=a,n=r}return i},Wu.prototype.distort=function(e){return e*this.distortionFactor_(e)},Wu.prototype.distortionFactor_=function(e){for(var t=1,i=1,n=e*e,r=0;r<this.coefficients.length;r++){t+=this.coefficients[r]*(i*=n)}return t};const ju=Wu;var qu=A.Z.osg,Ju={base64:function(e,t){return"data:"+e+";base64,"+t},isMobile:function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},isFirefox:function(){return/firefox/i.test(navigator.userAgent)},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch(e){return!0}},appendQueryParameter:function(e,t,i){var n=e.indexOf("?")<0?"?":"&";return e+=n+t+"="+i},getQueryParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},isLandscapeMode:function(){return 90===window.orientation||-90===window.orientation},getScreenWidth:function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},getScreenHeight:function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},projectionMatrixToVector_:function(e,t){var i=t||{},n=i.xScale||1,r=i.yScale||1,a=i.xTrans||0,o=i.yTrans||0,s=qu.vec4.create();return s[0]=e[0]*n*.5,s[1]=e[5]*r*.5,s[2]=.5*(e[8]-1-a),s[3]=.5*(e[9]-1-o),s},leftProjectionVectorToRight_:function(e){return qu.vec4.fromValues(e[0],e[1],-e[2]-1,e[3])}};const Yu=Ju;var Ku=A.Z.osg,Xu=180/Math.PI,$u=Math.PI/180,eh=function(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients},th=function(e){this.width=e.width||Yu.getScreenWidth(),this.height=e.height||Yu.getScreenHeight(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters},ih=new th({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),nh=new th({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),rh={CardboardV1:new eh({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new eh({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function ah(e){this.viewer=rh.CardboardV1,this.updateDeviceParams(e)}ah.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},ah.prototype.getDevice=function(){return this.device},ah.prototype.setViewer=function(e){this.viewer=e},ah.prototype.determineDevice_=function(e){if(!e)return Yu.isIOS()?nh:ih;var t=.0254,i=t/e.xdpi,n=t/e.ydpi,r=Yu.getScreenWidth(),a=Yu.getScreenHeight();return new th({widthMeters:i*r,heightMeters:n*a,bevelMeters:.001*e.bevelMm})},ah.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=new ju(e.distortionCoefficients),n=e.screenLensDistance,r=(t.widthMeters-e.interLensDistance)/2,a=e.interLensDistance/2,o=e.baselineLensDistance-t.bevelMeters,s=t.heightMeters-o,l=Xu*Math.atan(i.distort(r/n)),u=Xu*Math.atan(i.distort(a/n)),h=Xu*Math.atan(i.distort(o/n)),c=Xu*Math.atan(i.distort(s/n));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(u,e.fov),downDegrees:Math.min(h,e.fov),upDegrees:Math.min(c,e.fov)}},ah.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},ah.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},ah.prototype.getProjectionMatrixLeftEye=function(e){var t=this.getFieldOfViewLeftEye(e),i=Ku.mat4.create(),n=.1,r=Math.tan($u*t.leftDegrees)*n,a=Math.tan($u*t.rightDegrees)*n,o=Math.tan($u*t.downDegrees)*n,s=Math.tan($u*t.upDegrees)*n;return Ku.mat4.frustum(i,-r,a,-o,s,n,1e3),i},ah.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,i=this.device,n=t.screenLensDistance,r=i.widthMeters/n,a=i.heightMeters/n,o=i.width/r,s=i.height/a,l=Math.round((e.eyePosX-e.outerDist)*o),u=Math.round((e.eyePosY-e.bottomDist)*s);return{x:l,y:u,width:Math.round((e.eyePosX+e.innerDist)*o)-l,height:Math.round((e.eyePosY+e.topDist)*s)-u}},ah.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:Xu*Math.atan(e.outerDist),rightDegrees:Xu*Math.atan(e.innerDist),downDegrees:Xu*Math.atan(e.bottomDist),upDegrees:Xu*Math.atan(e.topDist)}},ah.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=new ju(e.distortionCoefficients),n=e.screenLensDistance,r=e.interLensDistance/2/n,a=t.widthMeters/n,o=t.heightMeters/n,s=a/2-r,l=(e.baselineLensDistance-t.bevelMeters)/n,u=e.fov,h=i.distortInverse(Math.tan($u*u)),c=Math.min(s,h),A=Math.min(r,h),d=Math.min(l,h);return{outerDist:c,innerDist:A,topDist:Math.min(o-l,h),bottomDist:d,eyePosX:s,eyePosY:l}},ah.Viewers=rh;const oh=ah;const sh={format:1,last_updated:"2019-02-19T20:27:12Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3}]};var lh=function(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm},uh=!1,hh=function(e){uh},ch=function(e){uh},Ah=function(e){uh},dh=function(e,t){if(this.dpdb=sh,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t,hh();var i=new XMLHttpRequest,n=this;i.open("GET","https://dpdb.webvr.rocks/dpdb.json",!0),i.addEventListener("load",(function(){n.loading=!1,i.status>=200&&i.status<=299?(hh(),n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_()):ch()})),i.send()}};dh.prototype.getDeviceParams=function(){return this.deviceParams},dh.prototype.recalculateDeviceParams_=function(){hh();var e=this.calcDeviceParams_();hh(),hh(),e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):ch()},dh.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return ch(),null;if(1!==e.format)return ch(),null;if(!e.devices||!e.devices.length)return ch(),null;var t=navigator.userAgent||navigator.vendor||window.opera,i=Yu.getScreenWidth(),n=Yu.getScreenHeight();if(hh(),hh(),hh(),!e.devices)return ch(),null;for(var r=0;r<e.devices.length;r++){var a=e.devices[r];if(a.rules)if("ios"===a.type||"android"===a.type){if(Yu.isIOS()===("ios"===a.type)){for(var o=!1,s=0;s<a.rules.length;s++){var l=a.rules[s];if(this.matchRule_(l,t,i,n)){hh(),hh(),o=!0;break}}if(o){var u=a.dpi[0]||a.dpi,h=a.dpi[1]||a.dpi;return new lh({xdpi:u,ydpi:h,bevelMm:a.bw})}}}else Ah();else Ah()}return Ah(),null},dh.prototype.matchRule_=function(e,t,i,n){if(!e.ua&&!e.res)return!1;if(e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var r=e.res[0],a=e.res[1];if(Math.min(i,n)!==Math.min(r,a)||Math.max(i,n)!==Math.max(r,a))return!1}return!0};const gh=dh;var fh=A.Z.osg;(0,l.Z)().vrForceRaf&&(A.Z.osgViewer.Viewer.prototype.setVRDisplay=function(e){this._hmd=e,this._requestAnimationFrame=e.requestAnimationFrame.bind(e)});const ph=a.Z.extend({getModelOptionPath:function(){return"vr"},defaults:{enable:!1,deviceInfo:void 0,hit:void 0,hasNativeHMD:!1,humanMatrix:fh.mat4.create(),humanInAir:!1,displayFloor:!0},init:function(e){if(this._context=e,this._scene=e.getScene(),this._viewer=e.getViewer(),window.matchMedia&&window.matchMedia("(environment-blending: additive)").matches){var t=this._context.getFeatures().background.getModel();t.set("color",[0,0,0]),t.set("enable","color"),this.set("displayFloor",!1)}},initAfterFirstFrame:function(){this.set("deviceInfo",this._initDeviceInfo());var e=this._context.getModel().get("options").vr;e&&e.worldFactor>0&&this.setJSON(e),this.initBoundAndWorldFactor(),this.set("enable",(0,l.Z)().cardboard>0)},onVrDisplayReady:function(e){F.Z.getVrDisplayReady().isFulfilled()?e():F.Z.getVrDisplayReady().then((function(){e()}))},_getBoundRadius:function(){return j.Z.getModelBoxWithDisplacement().radius()},isDiorama:function(){return this._getBoundRadius()<2*this.get("worldFactor")},getMinimumWorldFactor:function(){return.001*this._getBoundRadius()},getMaximumWorldFactor:function(){return 100*this._getBoundRadius()},getDefaultHumanHeight:function(){return 1.65},_makeValidWorldFactor:function(){var e=this.get("worldFactor"),t=this.getMinimumWorldFactor(),i=this.getMaximumWorldFactor();if(e<t*j.Z.BIAS_MIN||e>i*j.Z.BIAS_MAX){var n=j.Z.getModelBoxWithDisplacement(),r=n.getMin()[2],a=n.radius();this.set("worldFactor",.5*a),this.set("floorHeight",r);var o=n.center(fh.vec3.create());o[1]-=1.2*a,o[2]=r,fh.mat4.fromTranslation(this.get("humanMatrix"),o)}else this.set("worldFactor",Math.min(Math.max(e,t),i))},initBoundAndWorldFactor:function(){this._makeValidWorldFactor(),this.trigger("uiReady")},_initDeviceInfo:function(){var e=new gh(!1),t=new oh(e.getDeviceParams());return(0,l.Z)().cardboard>1&&t.setViewer(oh.Viewers.CardboardV2),t},getName:function(){return"WebVR"},setJSON:function(e,t){var i=t||{};i.ignore=["initialCamera"];var n=a.Z.prototype.setJSON.call(this,e,i),r=this.get("humanMatrix"),o=e.initialCamera;return fh.mat4.fromQuat(r,o.rotation),fh.mat4.setTranslation(r,o.position),n},getJSON:function(){var e=fh.mat4.copy(fh.mat4.create(),this.get("humanMatrix")),t=fh.mat4.getScale(fh.vec3.create(),e);fh.vec3.set(t,1/t[0],1/t[1],1/t[2]);var i=fh.mat4.scale(e,e,t),n=fh.quat.create();fh.quat.normalize(n,fh.mat4.getRotation(n,i));var r=a.Z.prototype.getJSON.call(this,{ignore:"initialCamera"});return r.initialCamera={position:fh.mat4.getTranslation(fh.vec3.create(),i),rotation:n},r}});var mh,_h,vh=i("EMUO"),Ch=i("MdnG"),bh=i("IOM8"),Sh=i("Onwk"),Eh=i("FYHc"),yh=A.Z.osg,Ih=A.Z.osgUtil,xh=yh.vec3.fromValues(.1,.4,.8),Th=yh.vec3.fromValues(1,.7,.1),wh=yh.vec3.fromValues(1,0,0),Mh=yh.vec3.fromValues(0,0,.9),Rh=function(e){yh.MatrixTransform.call(this),this._model=e,this.setMatrix(e.get("humanMatrix")),this.setName("WebVR - Human"),this.setNodeMask(0),this.editMask=Ih.NodeGizmo.NO_FULL_CIRCLE|Ih.NodeGizmo.PICK_PLANE_Z|Ih.NodeGizmo.PICK_ARROW|Ih.NodeGizmo.PICK_ARC_Z,this._humanMT=new yh.MatrixTransform,yh.mat4.fromZRotation(this._humanMT.getMatrix(),Math.PI),this._geoHuman=new yh.Geometry,this._humanMT.addChild(this._geoHuman),this._uColorCylinder=yh.Uniform.createFloat3(yh.vec3.copy(yh.vec3.create(),xh),"uColor"),this._uColorHint=yh.Uniform.createFloat3(yh.vec3.copy(yh.vec3.create(),Th),"uColor"),this._hintToFloorMT=new yh.MatrixTransform,this._geoHintToFloor=yh.createTexturedBoxGeometry(0,0,-.5,.02,.02,1),this._hintToFloorMT.addChild(this._geoHintToFloor),this._hintToFloorMT.setNodeMask(Te.Z.NO_PICK),this._geoCylinder=Ih.GizmoGeometry.createCylinderGeometry(1,1,1,50,1,!1,!1),this._geoCylinder.setNodeMask(Te.Z.NO_PICK);for(var t=0,i=this._geoCylinder.getAttributes().Vertex.getElements(),n=i.length/3;t<n;++t)i[3*t+2]+=.5;this._cylinderMT=new yh.MatrixTransform,yh.mat4.fromScaling(this._cylinderMT.getMatrix(),yh.vec3.fromValues(1,1,.5)),this._cylinderMT.addChild(this._geoCylinder),this.addChild(this._humanMT),this.addChild(this._cylinderMT),this.addChild(this._hintToFloorMT),this._boundingBoxComputed=!0,this._boundingSphereComputed=!0,this.init()};yh.createPrototypeNode(Rh,yh.objectInherit(yh.MatrixTransform.prototype,{init:function(){this.getOrCreateStateSet().setAttributeAndModes(Ze.Z.CULL_BACK);var e=this._humanMT.getOrCreateStateSet();e.setShaderGeneratorName("shadeless-pbr"),e.setName("vrHuman");var t=Mr.createMaterialModel(e);t.set("name","NodeHuman"),t.set("hasVertexColor",!0),t.set("vertexColorEnable",!0),t.set("vertexColorColorSpace","linear"),t.trigger("apply"),e.setAttributeAndModes(e.getAttribute("SketchfabMaterial")),(0,o.Z)()&&ts(this.initHumanMesh.bind(this));var i=this._geoHintToFloor.getOrCreateStateSet();i.setAttributeAndModes(we.Z.getOrCreateShader(Sh,Eh,"webVR-hintToFloor","VRHintToFloor")),i.addUniform(this._uColorHint),i.setRenderBinDetails(Me.Z.TRANSPARENT_NO_EARLYZ_POST,"RenderBin");var n=this._geoCylinder.getOrCreateStateSet();n.setAttributeAndModes(we.Z.getOrCreateShader(Ch,bh,"webVR-humanCylinder","VRHumanCylinder")),n.addUniform(this._uColorCylinder),n.addUniform(yh.Uniform.createFloat(1,"uAlpha")),n.setRenderBinDetails(Me.Z.TRANSPARENT_NO_EARLYZ_POST,"RenderBin")},initHumanMesh:function(e){var t=this._geoHuman;t.getAttributes().Vertex=new yh.BufferArray(yh.BufferArray.ARRAY_BUFFER,e.VERTEX,3),t.getAttributes().Color=new yh.BufferArray(yh.BufferArray.ARRAY_BUFFER,e.COLOR,4),t.getPrimitives().push(new yh.DrawElements(yh.primitiveSet.TRIANGLES,new yh.BufferArray(yh.BufferArray.ELEMENT_ARRAY_BUFFER,e.TRIANGLES,1))),t.getPrimitives().push(new yh.DrawElements(yh.primitiveSet.TRIANGLE_STRIP,new yh.BufferArray(yh.BufferArray.ELEMENT_ARRAY_BUFFER,e.STRIP,1)))},setVisible:function(e){if(this._visible!==e){this._visible=e,this.setNodeMask(e?-1:0);var t=this._model._viewer.getFeaturesManager().getNodeGizmo();e?(t.attachToNode(this),this._initView()):this._restoreView()}},_initView:function(){var e=yh.vec3.create(),t=yh.vec3.create(),i=yh.vec3.create(),n=yh.quat.create(),r=yh.vec3.create(),a=yh.vec3.create(),o=yh.vec3.fromValues(0,0,-1);return function(){var s=this._model._viewer.getFeaturesManager(),l=this._model.get("worldFactor"),u=this._model._viewer.getViewerOSGJS().getManipulator();this._eyePos||(this._eyePos=yh.vec3.create(),this._eyeTarget=yh.vec3.create()),u.getEyePosition(this._eyePos),u.getTarget(this._eyeTarget),yh.mat4.getTranslation(e,this.getMatrix()),yh.mat4.getRotation(n,this.getMatrix()),yh.vec3.set(t,0,1,0),yh.vec3.transformQuat(t,t,n),yh.vec3.copy(r,Mh),yh.vec3.scale(r,r,l),yh.vec3.add(e,e,r),yh.vec3.scale(r,t,-1),yh.vec3.normalize(r,r),yh.vec3.cross(a,r,o),yh.vec3.copy(i,e),yh.vec3.scale(r,r,3*l),yh.vec3.scale(a,a,.5*l),yh.vec3.add(r,r,a),yh.vec3.add(i,i,r),s.focusOnTargetAndEye(e,i,1)}}(),_restoreView:function(){this._eyePos&&this._model._viewer.getFeaturesManager().focusOnTargetAndEye(this._eyeTarget,this._eyePos)},computeDistanceToFloor:(mh=yh.vec3.create(),_h=yh.vec3.create(),function(){var e=this.getMatrix(),t=this._model,i=t.get("worldFactor"),n=t.get("floorHeight");yh.mat4.getTranslation(mh,e),yh.vec3.copy(_h,mh);var r=.1*i;mh[2]+=r,_h[2]-=100*i,this.setNodeMask(Te.Z.NO_PICK);var a=ke.Z.computeNearestIntersection3D(mh,_h,Te.Z.PICK_GEOMETRY_SLOW);if(this.setNodeMask(-1),a)r=yh.vec3.dist(ke.Z.getWorldPositionFromHit(a,_h),mh);else{if(!t.get("displayFloor"))return 0;r=mh[2]-n}return Math.max(0,r-.1*i)}),updateNodeVR:function(){var e=yh.vec3.create();return function(t,i){if(0!==this.getNodeMask()){var n=this.getMatrix(),r=this._model,a=r._viewer.getFeaturesManager(),o=r.get("worldFactor"),s=r.get("floorHeight");yh.vec3.lerp(this._uColorHint.getInternalArray(),Th,wh,.5*Math.sin(10*i)+.5),yh.mat4.getScale(e,n),yh.vec3.set(e,o/e[0],o/e[1],o/e[2]),yh.mat4.scale(n,n,e),r.get("displayFloor")&&(n[14]=Math.max(n[14],s));var l=a.getNodeGizmo().getAttachedNode()===this||t&&-1!==t._nodePath.indexOf(this._humanMT);yh.vec3.copy(this._uColorCylinder.getInternalArray(),l?Th:xh);var u=this.computeDistanceToFloor()/o,h=u>.05;yh.mat4.fromScaling(this._hintToFloorMT.getMatrix(),yh.vec3.set(e,1,1,h?u:1e-7)),this._model.set("humanInAir",h),this.dirtyBound()}}}()}),"osgSketchfab","Human");const Bh=Rh;var Nh=i("uCEv"),Dh=i("pJ/q"),Ph=A.Z.osg,Fh=A.Z.osgUtil,Oh=function(){Ph.Node.call(this),this.setName("WebVR - Teleport"),this.setVisible(!0),this._interpolatorNormal=new Fh.DelayInterpolator(3),this._interpolatorNormal.setDelay(.08),this._geoCircle1=Ph.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._geoCircle2=Ph.createTexturedQuadGeometry(-.5,-.5,.15,1,0,0,0,1,0),this._geoCircle3=Ph.createTexturedQuadGeometry(-.5,-.5,.15,1,0,0,0,1,0),this._uAlpha1=Ph.Uniform.createFloat(1,"uAlpha"),this._uAlpha2=Ph.Uniform.createFloat(1,"uAlpha"),this._uAlpha3=Ph.Uniform.createFloat(1,"uAlpha"),this._uScale1=Ph.Uniform.createFloat(1,"uScale"),this._uScale2=Ph.Uniform.createFloat(.99,"uScale"),this._uScale3=Ph.Uniform.createFloat(.99,"uScale"),this._geoCylinder=Fh.GizmoGeometry.createCylinderGeometry(1,1,1,50,1,!1,!1);for(var e=0,t=this._geoCylinder.getAttributes().Vertex.getElements(),i=t.length/3;e<i;++e)t[3*e+2]+=.5;this._cylinderMT=new Ph.MatrixTransform,Ph.mat4.fromScaling(this._cylinderMT.getMatrix(),Ph.vec3.fromValues(.38,.38,.125)),this._cylinderMT.addChild(this._geoCylinder),this._hotspotHintMT=new Ph.MatrixTransform,this._hotspotHintMT.addChild(this._geoCylinder),this._hotspotHintMT.setNodeMask(0),this._teleportMT=new Ph.MatrixTransform,this._teleportMT.addChild(this._geoCircle1),this._teleportMT.addChild(this._geoCircle2),this._teleportMT.addChild(this._geoCircle3),this._teleportMT.addChild(this._cylinderMT),this.addChild(this._teleportMT),this.addChild(this._hotspotHintMT),this.init()};Ph.createPrototypeNode(Oh,Ph.objectInherit(Ph.Node.prototype,{init:function(){var e=this.getOrCreateStateSet();e.setAttributeAndModes(we.Z.getOrCreateShader(Nh,Dh,"webVR-teleportCircle","VRTeleportCircle")),e.addUniform(Ph.Uniform.createInt(0,"uTextureTeleportCircle")),e.setTextureAttributeAndModes(0,ar.Z.dummyTexture),this._geoCircle1.getOrCreateStateSet().addUniform(this._uScale1),this._geoCircle2.getOrCreateStateSet().addUniform(this._uScale2),this._geoCircle3.getOrCreateStateSet().addUniform(this._uScale3),this._geoCircle1.getOrCreateStateSet().addUniform(this._uAlpha1),this._geoCircle2.getOrCreateStateSet().addUniform(this._uAlpha2),this._geoCircle3.getOrCreateStateSet().addUniform(this._uAlpha3);var t=this._cylinderMT.getOrCreateStateSet();t.addUniform(Ph.Uniform.createFloat3(Ph.vec3.fromValues(.7,.7,.3),"uColor")),t.addUniform(this._uAlpha1);var i=this._hotspotHintMT.getOrCreateStateSet();i.addUniform(Ph.Uniform.createFloat3(Ph.vec3.fromValues(.1,.66,.85),"uColor")),i.addUniform(this._uAlpha1),this._geoCylinder.getOrCreateStateSet().setAttributeAndModes(we.Z.getOrCreateShader(Ch,bh,"webVR-teleportCylinder","VRTeleportCylinder"))},initTextureTeleport:function(){Jo(this.replaceTextureTeleport.bind(this))},replaceTextureTeleport:function(e){this.getOrCreateStateSet().setTextureAttributeAndModes(0,s.Z.instance.getOrCreateTexture(e.TELEPORT_CIRCLE,{internalFormat:Ph.Texture.RGBA}).texture)},setVisible:function(e){this.setNodeMask(e?Te.Z.NO_PICK:0)},setHotspotHint:function(){var e=Ph.vec3.create(),t=Ph.vec3.fromValues(0,0,1),i=Ph.quat.create();return function(n,r,a,o){if(this._hotspotHintMT.setNodeMask(n?-1:0),r){Ph.vec3.sub(e,a,r);var s=Ph.vec3.len(e);Ph.vec3.normalize(e,e),Ph.quat.rotationTo(i,t,e);var l=this._hotspotHintMT.getMatrix();Ph.mat4.fromQuat(l,i);Ph.mat4.scale(l,l,Ph.vec3.set(e,.02*o,.02*o,s)),Ph.mat4.setTranslation(l,r)}}}(),updateWorldNormal:function(e,t){this._interpolatorNormal.setTarget(t[0],t[1],t[2]),this._interpolatorNormal.update(e.getDeltaTime()),Ph.vec3.normalize(t,this._interpolatorNormal.getCurrent())},updateNodeVR:function(){var e=Ph.vec3.fromValues(0,0,1),t=Ph.vec3.create();return function(i,n,r,a,o,s,l){var u=this._teleportMT.getMatrix();if(this.getNodeMask()){var h=Math.acos(Ph.vec3.dot(e,l));Ph.vec3.cross(t,l,e),Ph.mat4.fromRotation(u,-h,t);var c=Math.min(Math.max(o,s),50*s);Ph.mat4.scale(u,u,Ph.vec3.set(t,c,c,c)),Ph.vec3.set(t,a[0],a[1],a[2]+.05*o),Ph.mat4.setTranslation(u,t),this.setNodeMask(Te.Z.NO_PICK)}var A=r.getSimulationTime(),d=A%.99,g=(A+.2)%.99;this._uScale2.setFloat(d),this._uScale3.setFloat(g),this._uAlpha1.setFloat(i),this._uAlpha2.setFloat(i*(1-d*d)),this._uAlpha3.setFloat(i*(1-g*g)),this._teleportMT.dirtyBound()}}()}),"osgSketchfab","Teleport");const Lh=Oh;var kh=i("xgxp"),Zh=i("60rR"),Uh=A.Z.osg,Vh=function(){Uh.MatrixTransform.call(this),this.setName("WebVR - Cursor"),this.setVisible(!0),this._geom=Uh.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._uAlpha=Uh.Uniform.createFloat(1,"uAlpha"),this._uColor=Uh.Uniform.createFloat3(Uh.vec3.fromValues(.7,.7,.7),"uCursorColor"),this.addChild(this._geom),this.init()};Uh.createPrototypeNode(Vh,Uh.objectInherit(Uh.MatrixTransform.prototype,{init:function(){var e=Uh.StateAttribute.OVERRIDE_ON,t=this.getOrCreateStateSet();t.setAttributeAndModes(we.Z.getOrCreateShader(kh,Zh,"webVR-cursor","VRCursor"),e),t.setRenderBinDetails(Me.Z.VR_CURSOR,"RenderBin"),t.setAttributeAndModes(Ze.Z.BLEND_SUBSTRACTIVE),t.addUniform(this._uColor),t.addUniform(this._uAlpha)},setVisible:function(e){this.setNodeMask(e?Te.Z.NO_PICK:0)},setColor:function(e){Uh.vec3.copy(this._uColor.getInternalArray(),e)},updateNodeVR:function(){var e=Uh.vec3.create(),t=Uh.quat.create();return function(i,n,r,a){var o=this.getMatrix();Uh.mat4.invert(o,n.getViewMatrix()),Uh.mat4.fromQuat(o,Uh.mat4.getRotation(t,o)),Uh.mat4.scale(o,o,Uh.vec3.set(e,a,a,a)),Uh.mat4.setTranslation(o,r),this._uAlpha.setFloat(i),this.dirtyBound()}}()}),"osgSketchfab","Cursor");const Qh=Vh;var Gh,Hh,zh=i("o0dJ"),Wh=i("uymv"),jh=A.Z.osg,qh=function(e){jh.MatrixTransform.call(this),this._model=e,this._postMultRotate=e._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),this.setName("WebVR - Floor"),this.setNodeMask(-1),this._cam=new jh.Camera,this._cam.setNearFarRatio(5e-5),this._geom=jh.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._uScaleToMeter=jh.Uniform.createFloat(1,"uScaleToMeter"),this._cam.addChild(this._geom),this.addChild(this._cam),this.init()};jh.createPrototypeNode(qh,jh.objectInherit(jh.MatrixTransform.prototype,{init:function(){var e=this.getOrCreateStateSet(),t=(this._model.get("displayFloor")?"#define DISPLAY_FLOOR\n":"")+Wh;e.setAttributeAndModes(we.Z.getOrCreateShader(zh,t,"webVR-floor","VRFloor")),e.addUniform(jh.Uniform.createInt(0,"uTextureFloor")),e.setTextureAttributeAndModes(0,ar.Z.dummyTexture),e.addUniform(this._uScaleToMeter),e.addUniform(jh.Uniform.createInt(1,"uTextureDepth")),e.setTextureAttributeAndModes(1,ar.Z.dummyTexture),e.setRenderBinDetails(Me.Z.TRANSPARENT_NO_EARLYZ_PRE,"RenderBin"),e.setAttributeAndModes(Ze.Z.DEPTH_DISABLE),e.setAttributeAndModes(Ze.Z.CULL_BACK),(0,o.Z)()&&this.initTextureFloor()},initTextureFloor:function(){Jo(this.replaceTextureFloor.bind(this))},replaceTextureFloor:function(e){this.getOrCreateStateSet().setTextureAttributeAndModes(0,s.Z.instance.getOrCreateTexture(e.FLOOR,{internalFormat:jh.Texture.RGBA}).texture)},setVisible:function(e){if(this.setNodeMask(e?-1:0),e&&!this._depthInitialized){var t=this._model._viewer.getFeaturesManager().getTextureDepth();t&&(this.getOrCreateStateSet().setTextureAttributeAndModes(1,t),this._depthInitialized=!0)}},updateNodeVR:(Gh=jh.vec3.create(),Hh=jh.vec3.create(),function(){var e=this.getMatrix(),t=j.Z.getModelBoxWithDisplacement();t.center(Hh);var i=t.radius(),n=Math.max(15*this._model.get("worldFactor"),5*i);jh.mat4.fromQuat(e,this._postMultRotate),jh.mat4.scale(e,e,jh.vec3.set(Gh,n,n,n)),e[12]=Hh[0],e[13]=Hh[1],this._uScaleToMeter.setFloat(n/this._model.get("worldFactor")),e[14]=this._model.get("floorHeight")-1e-4*i,this.dirtyBound()})}),"osgSketchfab","Floor");const Jh=qh;var Yh,Kh,Xh,$h,ec,tc,ic=i("ND70"),nc=i("Ma4s"),rc=A.Z.osg,ac=A.Z.InputGroups,oc=rc.vec3.create(),sc={TELEPORT:0,MENU:1,NAME:"DEFAULT"},lc={SCALE_THRESHOLD:.3,TELEPORT:0,MENU:1,SCALE_DIR_AXIS:0,NAME:"VIVE"},uc={SCALE_THRESHOLD:.7,TELEPORT:0,MENU:1,SCALE_DIR_AXIS:2,NAME:"Oculus touch"},hc={SCALE_THRESHOLD:.3,TELEPORT:0,MENU:2,SCALE_DIR_AXIS:0,NAME:"Oculus go"},cc={SCALE_THRESHOLD:.3,TELEPORT:0,MENU:2,SCALE_DIR_AXIS:0,NAME:"Oculus remote"},Ac={SCALE_THRESHOLD:.3,TELEPORT:0,MENU:1,SCALE_DIR_AXIS:2,NAME:"Windows mixed reality"},dc={SCALE_THRESHOLD:.3,TELEPORT:0,MENU:1,SCALE_DIR_AXIS:0,NAME:"Magic leap"},gc=rc.vec3.fromValues(.8481,.8481,.8481),fc=rc.vec3.fromValues(.00237,.30699,.57048),pc=function(e,t){rc.MatrixTransform.call(this),this.setName("VR - Controller"),this.setNodeMask(Te.Z.NO_PICK),this._pointerMT=new rc.MatrixTransform,this._pointerMTScale=new rc.MatrixTransform,this._proxyControllerMT=new rc.MatrixTransform,this._geomPointer=rc.createTexturedQuadGeometry(-.5,0,0,1,0,0,0,1,0),this.addChild(this._proxyControllerMT),this.addChild(this._pointerMT),this._pointerMT.addChild(this._pointerMTScale),this._pointerMTScale.addChild(this._geomPointer);var i=new rc.createTexturedBoxGeometry(0,-.1,0,.1,.2,.1);this._proxyControllerMT.addChild(i),this._uNormalSign=rc.Uniform.createFloat(1,"uNormalSign"),this._activeController=void 0,this._model=e,this._viewerOSGJS=e._viewer.getViewerOSGJS(),this._postMultRotate=e._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),this._uPointerAlpha=rc.Uniform.createFloat1(1,"uAlpha"),this._hitScaleOffset=20,this._inputManager=t,this._controllerMeshDisplay=void 0,this._pressedButtons=[],this._gamepadType=void 0,this._pointerClicked=!1,this._timeSinceLastPointerClick=0,this._menuPressed=!1,this._clickPressed=!1,this._teleportPressed=!1,this._menuPressedFrame=!1,this._clickPressedFrame=!1,this._teleportPressedFrame=!1,this._scaleValueChange=0,this._cbClick=this.onClick.bind(this),this._canvasX=0,this._canvasY=0,this._preferLeftHand=!1,this.init()};rc.createPrototypeNode(pc,rc.objectInherit(rc.MatrixTransform.prototype,{init:function(){var e=this._proxyControllerMT.getOrCreateStateSet();e.addUniform(rc.Uniform.createFloat3(gc,"uAlbedo")),e.addUniform(this._uNormalSign),e.addUniform(rc.Uniform.createFloat(.4,"uRoughness")),e.addUniform(rc.Uniform.createFloat(0,"uMetalness")),e.setShaderGeneratorName("controller"),Mr.createMaterialModel(e).trigger("apply");var t=this._geomPointer.getOrCreateStateSet();t.addUniform(this._uPointerAlpha),t.setRenderBinDetails(Me.Z.VR_CURSOR,"RenderBin"),t.setAttributeAndModes(Ze.Z.BLEND_SUBSTRACTIVE),t.setAttributeAndModes(we.Z.getOrCreateShader(ic,nc,"webVR-laser","VRLaser")),Ue.Z.initWebVRNavigation(this),this._ctrlLeft=.32,this._ctrlFwrd=.55},setEventListeners:function(){this._model.get("hasNativeHMD")?window.addEventListener("click",this._cbClick):this._inputManager.setEnable(ac.WEBVR_NAVIGATION,!0)},removeEventListeners:function(){this._model.get("hasNativeHMD")?window.addEventListener("click",this._cbClick):this._inputManager.setEnable(ac.WEBVR_NAVIGATION,!1)},onClick:function(){this._teleportPressed=!0,this._clickPressed=!0},setListenToEvents:function(e){e?this.setEventListeners():this.removeEventListeners()},isPosedController:function(){var e=this._activeController;return!(!e||!e.targetRayMode||"tracked-pointer"!==e.targetRayMode)},_createGeometryFromJSON:function(e){var t=new rc.Geometry,i=t.getAttributes();i.Vertex=new rc.BufferArray(rc.BufferArray.ARRAY_BUFFER,e.VERTEX,3),i.Normal=new rc.BufferArray(rc.BufferArray.ARRAY_BUFFER,e.NORMAL,3),e.COLOR&&(i.Color=new rc.BufferArray(rc.BufferArray.ARRAY_BUFFER,e.COLOR,1));var n=t.getPrimitives(),r=new rc.BufferArray(rc.BufferArray.ELEMENT_ARRAY_BUFFER,e.TRIANGLES,1);n.push(new rc.DrawElements(rc.primitiveSet.TRIANGLES,r));var a=new rc.BufferArray(rc.BufferArray.ELEMENT_ARRAY_BUFFER,e.STRIP,1);return n.push(new rc.DrawElements(rc.primitiveSet.TRIANGLE_STRIP,a)),t},replaceControllerMesh:function(e){this._proxyControllerMT.removeChildren();var t=this._createGeometryFromJSON(e.BODY),i=this._createGeometryFromJSON(e.BUTTON);this._proxyControllerMT.addChild(t),this._proxyControllerMT.addChild(i),i.getOrCreateStateSet().addUniform(rc.Uniform.createFloat3(fc,"uAlbedo")),this._updateCorrectionMatrix()},_checkControllerHand:function(e){this._activeController&&"left"===this._activeController.handedness?(rc.mat4.scale(e,e,rc.vec3.set(oc,-1,1,1)),this._uNormalSign.setFloat(-1)):this._uNormalSign.setFloat(1)},_updateCorrectionMatrix:function(){var e=this._proxyControllerMT.getMatrix();if(this._gamepadType===uc)rc.mat4.fromTranslation(e,rc.vec3.set(oc,0,.03262643,.031930979)),rc.mat4.rotateX(e,e,.22*Math.PI),this._checkControllerHand(e);else if(this._gamepadType===Ac){var t=(0,l.Z)().forceControllerOrientation;rc.mat4.fromXRotation(e,Math.PI*t),t=(0,l.Z)().forceControllerRayOrientation,rc.mat4.rotateX(this._pointerMT.getMatrix(),this._pointerMT.getMatrix(),Math.PI*t),this._checkControllerHand(e)}else this._gamepadType===dc?(rc.mat4.identity(e),rc.mat4.scale(e,e,[.01,.01,.01]),this._checkControllerHand(e)):rc.mat4.identity(e)},onPointerDown:function(){kr.default.any&&!this._activeController&&(this._pointerClicked=!0)},onPointerUp:function(e){this._pointerClicked=!1,kr.default.any||Math.abs(e.canvasX-this._canvasX)<5&&Math.abs(e.canvasY-this._canvasY)<5&&(this._clickPressed=!0,this._teleportPressed=!0)},displayMenu:function(){this._menuPressed=!0},onMouseDown:function(e){kr.default.any&&!this._activeController&&this._model.get("hasNativeHMD")&&(this._teleportPressed=!0),kr.default.any||(this._canvasX=e.canvasX,this._canvasY=e.canvasY)},updateButtonsPressed:function(){if(this._activeController)for(var e=this._pressedButtons.length,t=0;t<e;++t){var i=this._activeController.gamepad.buttons[t].pressed;i!==this._pressedButtons[t]&&(this._pressedButtons[t]=i,i?this.onButtonDown(t):this.onButtonUp(t))}},updateHoverAxes:function(){this._activeController&&(this._scaleValueChange=0,this.updateScaleChangeFromXAxis(this._gamepadType))},updateScaleChangeFromXAxis:function(e){if(this._activeController.gamepad){var t=this._activeController.gamepad.axes[e.SCALE_DIR_AXIS];t>e.SCALE_THRESHOLD?this._scaleValueChange=1:t<-e.SCALE_THRESHOLD&&(this._scaleValueChange=-1)}},updatePointerClick:function(e){if(this._pointerClicked){if(this._timeSinceLastPointerClick>1.2)return this._menuPressed=!0,this._pointerClicked=!1,void(this._timeSinceLastPointerClick=0);this._timeSinceLastPointerClick+=e}else this._timeSinceLastPointerClick>0&&this._timeSinceLastPointerClick<1.2&&(kr.default.any&&(this._clickPressed=!0,this._teleportPressed=!0),this._timeSinceLastPointerClick=0)},onButtonUp:function(e){switch(e){case this._gamepadType.TELEPORT:this._clickPressed=!0,this._teleportPressed=!0;break;case this._gamepadType.MENU:this._menuPressed=!0}},onButtonDown:function(e){},getAndSetActiveController:function(e){if(e.length){var t=this._activeController;if(this._activeController=this._getControllerWithPressedButtons(e),this._activeController||(this._isLastActiveControllerStillWorking(e,t)?this._activeController=t:this._activeController=this._getControllerWithOrientationAndPreferredHand(e)),!this._activeController)return this._pressedButtons.length=0,void(this._gamepadType=void 0);var i=this._activeController.profiles.length&&this._activeController.profiles[0];if(i!==this._lastProfile){this._lastProfile=i;for(var n=this._pressedButtons.length=this._activeController.gamepad&&this._activeController.gamepad.buttons.length,r=0;r<n;++r)this._pressedButtons[r]=!1;this._gamepadType=this._getGamepadType(this._activeController),console.log("Found a controller:",this._gamepadType.NAME),this._updateCorrectionMatrix()}}},_isLastActiveControllerStillWorking:function(e,t){if(!t)return!1;for(var i=0;i<e.profiles;i++)if(e[i].profiles.length==t.profiles.length&&e[i].profiles[0]==t.profiles[0])return!0;return!1},_getControllerWithPressedButtons:function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t];if(n.gamepad)for(var r=n.gamepad.buttons.length,a=0;a<r;++a)if(n.gamepad.buttons[a].pressed)return n}},setPreferLeftHand:function(e){this._preferLeftHand!==e&&(this._preferLeftHand=e,this.getAndSetActiveController(),this._updateCorrectionMatrix())},_getControllerWithOrientationAndPreferredHand:function(e){for(var t,i=this._preferLeftHand?"left":"right",n=0,r=e.length;n<r;++n){var a=e[n];if(a){var o="tracked-pointer"===a.targetRayMode;if(o&&a.handedness===i)return a;!o&&t||(t=a)}}return t},_getGamepadType:function(e){for(var t=0;t<e.profiles.length;t++){var i=e.profiles[t];if(-1!==i.indexOf("oculus")){if(-1!==i.indexOf("touch")||-1!==i.indexOf("rift"))return uc;if(-1!==i.indexOf("go"))return hc}if(-1!==i.indexOf("windows-mixed-reality"))return Ac;if(-1!==i.indexOf("vive"))return lc;if(-1!==i.indexOf("magicleap-one"))return dc;if(i.indexOf("generic-trigger-squeeze-touchpad"))return lc;if(i.indexOf("generic-trigger-squeeze-thumbstick"))return uc;if(i.indexOf("generic-trigger-squeeze-touchpad-thumbstick"))return uc;if(i.indexOf("generic-trigger-touchpad-thumbstick"))return uc;if(i.indexOf("generic-trigger-squeeze"))return uc;if(i.indexOf("generic-trigger-thumbstick"))return uc;if(i.indexOf("generic-trigger-touchpad"))return hc;if(i.indexOf("generic-trigger"))return hc;if(i.indexOf("generic-touchpad"))return hc;if(i.indexOf("generic-button"))return cc}return sc},applyPoseMatrix:($h=rc.quat.create(),ec=rc.vec3.create(),tc=rc.mat4.create(),function(e,t){var i=this._viewerOSGJS.getXRPose(this._activeController.targetRaySpace);if(i){var n=i.transform,r=n.orientation;r&&(r=rc.quat.set($h,r.x,-r.z,r.y,r.w),rc.quat.multiply(r,this._postMultRotate,r),rc.mat4.multiply(e,e,rc.mat4.fromQuat(tc,r)));var a=this._model.get("worldFactor"),o=n.position;o&&(o=rc.vec3.set(ec,o.x*a,-o.z*a,o.y*a),rc.vec3.transformQuat(o,o,this._postMultRotate),rc.vec3.add(o,o,t),rc.mat4.setTranslation(e,o))}}),updatePointerScaleFromHit:function(e){var t=rc.mat4.getTranslation(rc.vec3.create(),this.getMatrix()),i=rc.vec3.dist(t,e);this._hitScaleOffset=i/this._model.get("worldFactor")},resetPointerScale:function(){this._hitScaleOffset=20},isMenuPressed:function(){return this._menuPressedFrame},isTeleportPressed:function(){return this._teleportPressedFrame},isClickPressed:function(){return this._clickPressedFrame},checkScaleChangeValue:function(){return this._scaleValueChange},checkDownloadController:function(){var e=(0,l.Z)().forceController,t=this._gamepadType;if(e){switch(e){case"oculus":t=uc;break;case"go":t=hc;break;case"windows":t=Ac;break;case"magicleap":t=dc;break;default:t=lc}this._gamepadType=t}else if(!this.isPosedController())return;t===uc?this._controllerMeshDisplay!==uc&&(this._controllerMeshDisplay=uc,Ko(this.replaceControllerMesh.bind(this))):t===hc?this._controllerMeshDisplay!==hc&&(this._controllerMeshDisplay=hc,Xo(this.replaceControllerMesh.bind(this))):t===Ac?this._controllerMeshDisplay!==Ac&&(this._controllerMeshDisplay=Ac,$o(this.replaceControllerMesh.bind(this))):t===dc?this._controllerMeshDisplay!==dc&&(this._controllerMeshDisplay=dc,es(this.replaceControllerMesh.bind(this))):this._controllerMeshDisplay!==lc&&(this._controllerMeshDisplay=lc,Yo(this.replaceControllerMesh.bind(this)))},updateNodeVR:(Xh=rc.vec3.create(),function(e,t,i){var n=this._model.get("worldFactor");e&&(this.getAndSetActiveController(e),this.checkDownloadController()),this.updatePointerClick(t),this.updateButtonsPressed(),this.updateHoverAxes();var r=this.getMatrix();rc.mat4.fromScaling(this._pointerMTScale.getMatrix(),rc.vec3.set(Xh,.05,this._hitScaleOffset,1)),rc.mat4.fromScaling(r,rc.vec3.set(Xh,n,n,n)),(0,l.Z)().forceController?(this.setNodeMask(Te.Z.NO_PICK),rc.mat4.copy(r,this._model.get("humanMatrix")),r[14]+=2*n):this.isPosedController()?(this.setNodeMask(Te.Z.NO_PICK),this.applyPoseMatrix(r,i)):this.setNodeMask(0),this._menuPressedFrame=this._menuPressed,this._clickPressedFrame=this._clickPressed,this._teleportPressedFrame=this._teleportPressed,this._clickPressed=!1,this._menuPressed=!1,this._teleportPressed=!1,this.dirtyBound()}),raycastFromController:(Yh=rc.vec3.fromValues(0,20,0),Kh=rc.mat4.create(),function(e,t,i,n,r){var a=this.getMatrix();if(this._gamepadType===Ac){var o=2*(0,l.Z)().forceControllerRayOrientation;a=Kh,rc.mat4.rotateX(a,this.getMatrix(),Math.PI*o)}rc.mat4.getTranslation(n,a),rc.vec3.set(r,0,i/this._model.get("worldFactor"),0),rc.vec3.transformMat4(r,r,a);var s=ke.Z.computeNearestIntersection3DHotspotFirst(n,r,Te.Z.PICK_GEOMETRY_FAST,e);return s||rc.vec3.transformMat4(r,Yh,a),s})}),"osgSketchfab","Controller");const mc=pc;var _c=A.Z.osg,vc=function(e,t,i,n,r){this._startPosOffset=e,this._startPos=_c.vec3.create(),this._targetPos=_c.vec3.create(),this._duration=t,this._easingFunc=i,this._result=_c.vec3.create(),this._hasStarted=!1,this._reverse=!1,this._finished=!0,this._node=n,this._model=r};vc.prototype={isFinished:function(){return this._finished},_reverseAnim:function(){this._reverse=!this._reverse},start:function(){var e=_c.vec3.create();return function(t){this._started=.05*-t,this._hasStarted=!1,this._finished=!1,_c.vec3.scale(e,this._startPosOffset,this._model.get("worldFactor")),this._reverse?(_c.mat4.getTranslation(this._startPos,this._node.getMatrix()),_c.vec3.add(this._targetPos,this._startPos,e),this._node.setOpacity(1)):(_c.mat4.getTranslation(this._targetPos,this._node.getMatrix()),_c.vec3.add(this._startPos,this._targetPos,e),this._node.setOpacity(0)),_c.mat4.setTranslation(this._node.getMatrix(),this._startPos)}}(),update:function(e,t){if(!this._finished){var i=t.getFrameStamp().getSimulationTime();if(this._started<0)return this._started+=t.getFrameStamp().getDeltaTime(),!0;this._hasStarted||(this._started=i,this._hasStarted=!0);var n=(i-this._started)/this._duration;return n>1&&(this._finished=!0,n=1),this._easingFunc&&(n=this._easingFunc(n)),this.interpolate(n,e),this._finished&&(this._reverseAnim(),this._onFinishCallback&&this._onFinishCallback(),this._node.dirtyBound()),!0}},interpolate:function(e,t){_c.vec3.lerp(this._result,this._startPos,this._targetPos,e),_c.mat4.setTranslation(t.getMatrix(),this._result),this._reverse?this._node.setOpacity(1-e):this._node.setOpacity(e)},setOnFinishCallback:function(e){this._onFinishCallback=e}};const Cc=vc;i("Bq0d");var bc=A.Z.osgAnimation,Sc=A.Z.osg,Ec=bc.easeOutCubic,yc=function(e){Sc.Node.call(this),this._menuPanel=new ws(.9,2.5,ps.AXIS_BOTH,.2,10,10),this._menuPanel.setUseCache(!0),this._menuPanel.setClickAction("vrHelpButton",this.displayHelp.bind(this)),this._menuPanel.setClickAction("vrExitButton",this.hide.bind(this)),this._menuPanel.setVisible(!1);var t=new Cc(Sc.vec3.fromValues(0,0,-.05),.15,Ec,this._menuPanel,e);this._menuPanel.setAnimation(t),this.addChild(this._menuPanel),this._helpPanel=new ps(2,2,ps.AXIS_BOTH,.2,10,10),this._helpPanel.setPanelClickAction(this.hideHelp.bind(this)),this._helpPanel.setVisible(!1);var i=new Cc(Sc.vec3.fromValues(0,0,0),.3,Ec,this._helpPanel,e);this._helpPanel.setAnimation(i),this.addChild(this._helpPanel),this._model=e};Sc.createPrototypeNode(yc,Sc.objectInherit(Sc.Node.prototype,{initialize:function(e){var t=e.hotspot._views[0]._hotspots;this._menuPanel.initialize("skfb_front/macros/vr/vr-menu",{hasHotspotsNavigation:t.length&&t.length>1}),Jo(function(e){var t=s.Z.instance.getOrCreateTexture(e.MENU_HELP,{internalFormat:Sc.Texture.RGBA}).texture;this._helpPanel.initialize(t,{width:1e3,height:500})}.bind(this))},display:function(e,t){this._menuPanel.displayInView(e,t,this._model.get("worldFactor"))},hide:function(){this._menuPanel.setVisible(!1),this._helpPanel.isVisible()&&this._helpPanel.setVisible(!1)},setHomeAction:function(e){this._menuPanel.setClickAction("vrHomeButton",e)},setNextAction:function(e){this._menuPanel.setClickAction("vrNextButton",e)},setPrevAction:function(e){this._menuPanel.setClickAction("vrPrevButton",e)},displayHelp:function(){Sc.mat4.copy(this._helpPanel.getMatrix(),Sc.mat4.create()),Sc.mat4.setTranslation(this._helpPanel.getMatrix(),Sc.vec3.fromValues(0,0,.2)),Sc.mat4.multiply(this._helpPanel.getMatrix(),this._menuPanel.getMatrix(),this._helpPanel.getMatrix()),this._helpPanel.setVisible(!0)},hideHelp:function(){this._helpPanel.isVisible()&&this._helpPanel.setVisible(!1)},isVisible:function(){return this._menuPanel.isVisible()},isHelpVisible:function(){return this._helpPanel.isVisible()},updateHit:function(e){return this._helpPanel.isVisible()?this._helpPanel.updateHit(e):this._menuPanel.isVisible()?this._menuPanel.updateHit(e):void 0},click:function(){this._helpPanel.isVisible()?this._helpPanel.click():this._menuPanel.isVisible()&&this._menuPanel.click()}}),"osgSketchfab","Menu");const Ic=yc;var xc,Tc,wc,Mc,Rc,Bc,Nc,Dc,Pc,Fc=i("vasR"),Oc=A.Z.osg,Lc=A.Z.osgUtil,kc=A.Z.InputGroups;new(_s())({device:"VWR",listen:!0});var Zc={FeatureName:"webVR",ModelType:ph,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:enable",this.onEnable,this),e.bind("change:worldFactor",this.onWorldFactor,this),e.bind("change:floorHeight",this.onFloorHeight,this),e.bind("doubleTap",this.onDoubleTap,this),e.bind("snapHumanOnFloor",this.snapHumanOnFloor,this),this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._cullConfig=vo.Z.vrConfig,this._lastSelectedHotspot=void 0,this._lastHoveredHotspot=void 0,this._lastFloorHeight=0,this._lastTime=0,this._lastWorldFactor=-1,this._lastMouse=Oc.vec2.create(),this._interpolatorAlpha=new Lc.DelayInterpolator(1),this._interpolatorAlpha.setDelay(.1),this._webvrMaxHeight=this.getWebVRMaxHeight(),this._nodeWebVR=new Oc.Node,this._nodeWebVR.setName("Feature - WebVR"),this._proxyVR=new Oc.Node,this._proxyVR.setName("WebVR - Proxy"),this._proxyVR.setNodeMask(0),this._floorMT=new Jh(e),this._humanMT=new Bh(e),this._teleportNode=new Lh,this._cursorMT=new Qh,this._controllerMT=new mc(e,this._viewer.getInputManager()),this._nodeMenu=new Ic(e),this._nodeMenu.setHomeAction(this._onVrSessionEnd.bind(this)),this._nodeMenu.setNextAction(this.goToNextHotspot.bind(this)),this._nodeMenu.setPrevAction(this.goToPrevHotspot.bind(this)),this._dataDownloaded=!1,this._scaleControlEnabled=!0,this.onFloorHeight(),this.initGraphNodes(),this.hookComputeCanvasSize(),Ue.Z.initWebVR(this),this._onVrSessionEndBinded=this._onVrSessionEnd.bind(this),this._viewerOSGJS.getInputManager().getInputSource("WebVR").pollHeadset().catch((function(){})),F.Z.getModelDisplayed().then(this.initWebVR.bind(this))},getNodeWebVR:function(){return this._nodeWebVR},getProxyWebVR:function(){return this._proxyVR},getWebVRMaxHeight:function(){return-1===(0,l.Z)().maxDevicePixelRatio?-1:kr.default.any?Math.min(window.screen.width,window.screen.height)*(0,Fc.Z)():-1},_onVrDisplayPointerRestricted:function(){this._viewer.getCanvas().requestPointerLock()},_onVrDisplayPointerUnrestricted:function(){document.exitPointerLock()},initWebVR:function(){this._nodeWebVR.addUpdateCallback(this)},setProxyVisible:function(e){this._proxyVR.setNodeMask(e?Te.Z.NO_SHADOW:0)},onDoubleTap:function(e){if(!this.model.get("enable")&&-1===e._nodePath.indexOf(this._humanMT)){var t=Oc.vec3.create();ke.Z.getWorldPositionFromHit(e,t),Oc.mat4.setTranslation(this._humanMT.getMatrix(),t),k.Z.draw()}},scaleUp:function(){var e=this.model.get("worldFactor");e<=0||this.model.set("worldFactor",1.2*e)},scaleDown:function(){var e=this.model.get("worldFactor");e<=0||this.model.set("worldFactor",e*(1/1.2))},savePosition:function(e){this._lastMouse[0]=e.canvasX,this._lastMouse[1]=e.canvasX},onFloorHeight:function(){var e=this.model.get("floorHeight"),t=.05*this.model.get("worldFactor");Math.abs(this._humanMT.getMatrix()[14]-this._lastFloorHeight)<=t&&(this._humanMT.getMatrix()[14]=e),this._floorMT.getMatrix()[14]=e,this._lastFloorHeight=e},initGraphNodes:function(){this._nodeWebVR.addChild(this._proxyVR),this._proxyVR.addChild(this._floorMT),this._proxyVR.addChild(this._humanMT),this._proxyVR.addChild(this._teleportNode),this._proxyVR.addChild(this._cursorMT),this._proxyVR.addChild(this._controllerMT),this._proxyVR.addChild(this._nodeMenu);var e=this._proxyVR.getOrCreateStateSet();e.setRenderBinDetails(Me.Z.TRANSPARENT_NO_EARLYZ_POST,"RenderBin"),e.setAttributeAndModes(Ze.Z.DEPTH_LESS_NO_WRITE),e.setAttributeAndModes(Ze.Z.CULL_DISABLE)},resetCameraToHuman:function(){var e=Oc.vec3.create(),t=Oc.vec3.create(),i=Oc.mat4.create(),n=Oc.vec3.create();return function(){var r=Oc.mat4.copy(i,this._humanMT.getMatrix());Oc.mat4.getScale(e,r),Oc.vec3.set(e,1/e[0],1/e[1],1/e[2]),Oc.mat4.scale(r,r,e);var a=this._manipulator.getFirstPersonManipulator(),o=a.getPostMultRotate();Oc.quat.normalize(o,Oc.mat4.getRotation(o,r)),a.setResetInitialRotationVR(!0),Oc.mat4.getTranslation(t,r),t[2]+=this.getEyeLevel(),Oc.vec3.set(n,0,1,0),Oc.vec3.transformQuat(n,n,o),Oc.vec3.add(n,t,n),this._viewer.getFeaturesManager().focusOnTargetAndEye(n,t)}}(),requestData:function(e,t){e&&!this._dataDownloaded&&(this._dataDownloaded=!0,this._teleportNode.initTextureTeleport(),this._floorMT.initTextureFloor(),this._nodeMenu.initialize(t))},startEnable:function(e){var t=this._viewer.getFeatures();this.setProxyVisible(e),this.requestData(e,t),this.updateDistortion(),t.background.getModel().set("webVR",e&&!(0,l.Z)().vrAr),t.camera.getModel().set("webVR",e),t.hotspot.getModel().set("webVR",e),t.shadingStyle.getModel().set("webVR",e),t.lighting.getModel().set("webVR",e),t.postProcess.getModel().set("webVR",e),(0,l.Z)().vrStereo?(this._cullConfig.doVR=e,Wa.Z.uIsVr.setFloat(e)):(this._cullConfig.doVR=!1,Wa.Z.uIsVr.setFloat(0)),this._controllerMT.setListenToEvents(e),e?this._floorMT.updateNodeVR():this._viewer.getFeaturesManager().focusOnSavedCamera(2);var i=e&&!(0,l.Z)().vrAr?1:0;this._viewer.getCamera().getClearColor()[3]=i,this._resetOnNextFrame=!0,Oc.log("Viewer StartEnable: enabled:"+e)},onEnable:function(){var e=this.model.get("enable");if((0,l.Z)().cardboard||this.model.get("cardboard"))return this.model.set("hasNativeHMD",!1),this._viewer.getInputManager().setEnable(kc.WEBVR,e),this.startEnable(e),void(this._framePose=void 0);e?(this._viewer.getInputManager().setEnable(kc.WEBVR,e),this._viewerOSGJS.setPresentVR(!0).then(function(t){console.log("starting VR"),this.model.set("hasNativeHMD",!0),this._registerVRCallbacks(e,t),this.startEnable(e)}.bind(this)).catch(function(){this.model.set({enable:!1},{silent:!0}),this.model.trigger("presentVrFailed")}.bind(this))):(console.log("Shutting down VR"),this._registerVRCallbacks(!1,this._viewerOSGJS.getVRSession()),this._viewerOSGJS.setPresentVR(!1),this._viewer.getInputManager().setEnable(kc.WEBVR,e),this.startEnable(e),this._nodeMenu.hide()),this._framePose=void 0},onPoseChange:function(e){this._framePose=e.pose},_registerVRCallbacks:function(e,t){e?t.addEventListener("end",this._onVrSessionEndBinded):t&&(t.onend=void 0)},_onVrSessionEnd:function(){this.model.get("enable")&&this.model.set("enable",!1)},updateDistortion:function(){var e=this._viewer.getFeatures().postProcess.getModel(),t=!this.model.get("hasNativeHMD")&&!(0,l.Z)().vrAr;if(e.set("doDistortionVR",t),t){var i=this.model.get("deviceInfo"),n=i.getProjectionMatrixLeftEye(),r=i.getProjectionMatrixLeftEye(!0),a=i.getUndistortedViewportLeftEye(),o=i.device,s={xScale:a.width/(o.width/2),yScale:a.height/o.height,xTrans:2*(a.x+a.width/2)/(o.width/2)-1,yTrans:2*(a.y+a.height/2)/o.height-1};e.set("distortion",i.viewer.distortionCoefficients),e.set("projectionLeft",Yu.projectionMatrixToVector_(n)),e.set("unprojectionLeft",Yu.projectionMatrixToVector_(r,s))}},snapHumanOnFloor:function(){this._humanMT.getMatrix()[14]-=this._humanMT.computeDistanceToFloor()},getEyeLevel:function(){var e=this.getPosVR()[2];return this._framePose&&e||(e=0),this.model.get("worldFactor")*this.model.getDefaultHumanHeight()+e},snapOnClosestSurface:function(){var e=this._manipulator.getEyePosition(Oc.vec3.create()),t=Oc.vec3.copy(Oc.vec3.create(),e);t[2]-=5*this.model.get("worldFactor");var i=this._viewer.getFeaturesManager(),n=ke.Z.computeNearestIntersection3D(e,t,Te.Z.PICK_GEOMETRY_FAST,this._nodeWebVR);if(n){var r=Oc.vec3.create();ke.Z.getWorldPositionFromHit(n,r),r[2]+=this.getEyeLevel(),i.focusOnTargetAndEye(void 0,r)}},scaleMatrixTranslate:function(e,t){e[12]*=t,e[13]*=t,e[14]*=t},transformMatrixYuptoZup:(Nc=Oc.vec3.create(),Dc=Oc.vec3.create(),Pc=1e-7,function(e){var t=Oc.mat4.getScale(Nc,e),i=Math.abs(t[0]-1)>Pc||Math.abs(t[1]-1)>Pc||Math.abs(t[2]-1)>Pc;i&&(Dc[0]=1/t[0],Dc[1]=1/t[1],Dc[2]=1/t[2],Oc.mat4.scale(e,e,Dc));var n=e,r=n[4],a=n[5],o=n[6],s=n[7];n[4]=-n[8],n[5]=n[9],n[6]=n[10],n[7]=n[11],n[8]=r,n[9]=a,n[10]=o,n[11]=s;var l=n[1];n[1]=-n[2],n[2]=l,l=n[5],n[5]=n[6],n[6]=-l,l=n[10],n[10]=n[9],n[9]=-l,l=n[13],n[13]=-n[14],n[14]=l,i&&Oc.mat4.scale(e,e,t)}),computeEyesOffsetViewMatrices:(Bc=Oc.mat4.create(),function(e,t,i){var n=this._framePose;Oc.mat4.identity(Bc),n.transform.matrix&&(Bc=n.transform.inverse.matrix),Oc.mat4.multiply(e,Bc,e),Oc.mat4.multiply(t,Bc,t),Oc.mat4.invert(e,e),Oc.mat4.invert(t,t),this.transformMatrixYuptoZup(e),this.transformMatrixYuptoZup(t),this.scaleMatrixTranslate(e,i),this.scaleMatrixTranslate(t,i)}),_getCorrectionPixel:function(e){return this._webvrMaxHeight>0?Math.min(1,this._webvrMaxHeight/(e.renderHeight||512)):1},onWorldFactor:function(){var e=this.model.get("worldFactor");if(this._lastWorldFactor>0&&this._lastWorldFactor!==e&&this.model.get("enable")&&this.snapOnClosestSurface(),this._lastWorldFactor=e,this._framePose){var t=this._viewerOSGJS.getVRSession().renderState.baseLayer;(l=this._cullConfig).framebufferWidth=t.framebufferWidth,l.framebufferHeight=t.framebufferHeight;for(var i=0;i<this._framePose.views.length;i++){var n=this._framePose.views[i],r=t.getViewport(n),a=r.height-r.y,o=Math.floor(r.width-r.x)||512,s=Math.floor(a)||512;e=this.model.get("worldFactor");"left"===n.eye&&(l.leftRenderWidth=o,l.leftRenderHeight=s,Oc.mat4.copy(l.leftProjection,n.projectionMatrix),Oc.mat4.copy(l.leftOffsetView,n.transform.matrix)),"right"===n.eye&&(l.rightRenderWidth=o,l.rightRenderHeight=s,Oc.mat4.copy(l.rightProjection,n.projectionMatrix),Oc.mat4.copy(l.rightOffsetView,n.transform.matrix))}this.computeEyesOffsetViewMatrices(l.leftOffsetView,l.rightOffsetView,e),this._viewer.getInputManager().setParam("worldFactor",e),k.Z.draw()}else if(!this.model.get("hasNativeHMD")){var l,u=this.getConfigCardboard(),h=u.getEyeParameters("left"),c=u.getEyeParameters("right"),A=this._getCorrectionPixel(h);(l=this._cullConfig).leftRenderWidth=Math.floor(h.renderWidth*A)||512,l.leftRenderHeight=Math.floor(h.renderHeight*A)||512,l.rightRenderWidth=Math.floor(c.renderWidth*A)||512,l.rightRenderHeight=Math.floor(c.renderHeight*A)||512;var d=u.getFrameData(this._frameData);this._updateCullConfig(d,h,c),k.Z.draw(),l.framebufferWidth=2*l.leftRenderWidth,l.framebufferHeight=l.leftRenderHeight,this._viewer.getInputManager().setParam("worldFactor",e)}},perspectiveMatrixFromVRFieldOfView:function(e,t,i,n){var r=n||Oc.mat4.create(),a=Math.PI/180,o=Math.tan(e.upDegrees*a)*t,s=Math.tan(e.downDegrees*a)*t,l=Math.tan(e.leftDegrees*a)*t,u=Math.tan(e.rightDegrees*a)*t;return Oc.mat4.frustum(r,-l,u,-s,o,t,i),r},hookComputeCanvasSize:function(){var e=this._viewerOSGJS,t=e.computeCanvasSize,i=this;this._cullConfig;e.computeCanvasSize=function(n){if(!(i.model.get("enable")&&(i._framePose||!i.model.get("HasNativeHMD"))))return t.call(e,n);i.onWorldFactor();var r=Math.min(kr.default.any?4096:16384,vh.Z.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE")),a=(0,l.Z)().vrMaxRttSize;a&&(r=a);var o=i._cullConfig.framebufferWidth,s=i._cullConfig.framebufferHeight;if(o>r){var u=r/o;o=Math.floor(o*u)}if(s>r){var h=r/s;s=Math.floor(s*h)}var c=!1;return this._canvasWidth!==o&&(n.width=o,this._canvasWidth=o,c=!0),this._canvasHeight!==s&&(n.height=s,this._canvasHeight=s,c=!0),c}},_updateCullConfig:function(){var e=Oc.vec3.create();return function(t,i,n){var r=this.model.get("worldFactor"),a=this._cullConfig;t&&this._frameData.leftViewMatrix||(Oc.mat4.copy(a.leftProjection,this._frameData.leftProjectionMatrix),Oc.mat4.copy(a.rightProjection,this._frameData.rightProjectionMatrix),Oc.vec3.set(e,-r*i.offset[0],0,0),Oc.mat4.fromTranslation(a.leftOffsetView,e),Oc.vec3.set(e,-r*n.offset[0],0,0),Oc.mat4.fromTranslation(a.rightOffsetView,e))}}(),getConfigCardboard:function(){if(this._cardboardHMD)return this._cardboardHMD;var e=this.model.get("deviceInfo"),t=.5*e.viewer.interLensDistance,i=e.getUndistortedViewportLeftEye();this._frameData={leftProjectionMatrix:this.perspectiveMatrixFromVRFieldOfView(e.getFieldOfViewLeftEye(!1),.1,1e3,Oc.mat4.create()),rightProjectionMatrix:this.perspectiveMatrixFromVRFieldOfView(e.getFieldOfViewRightEye(!1),.1,1e3,Oc.mat4.create())};var n={left:{offset:Oc.vec3.fromValues(-t,0,0),renderWidth:i.width,renderHeight:i.height},right:{offset:Oc.vec3.fromValues(t,0,0),renderWidth:i.width,renderHeight:i.height}};return this._cardboardHMD={displayName:"fake-cardboard",isPresenting:!1,getFrameData:function(e){return e},getEyeParameters:function(e){return n[e]},capabilities:{hasPosition:!1,hasRotation:!1,hasExternalDisplay:!1}},this._cardboardHMD},getPosVR:(Rc=Oc.vec3.create(),function(){return this._manipulator.getCurrentManipulator()._vrPos||Oc.vec3.set(Rc,0,0,0)}),getTeleportPosFromHotspot:function(){var e=Oc.vec3.create(),t=Oc.vec3.create(),i=Oc.vec3.create(),n=Oc.vec3.create();return function(r,a,o,s){var l=this.model.get("worldFactor");ke.Z.getWorldPositionFromScenePoint(Oc.mat4.getTranslation(e,r.getHotspotMatrix()),t);var u=2.5*l;Oc.vec3.sub(e,t,a);var h=Oc.vec3.length(e);e[2]=0,Oc.vec3.normalize(e,e),Oc.vec3.scale(e,e,u),Oc.vec3.sub(i,t,e),i[2]=t[2]+l,h<u+.1*u&&Oc.vec3.copy(i,a),Oc.vec3.copy(n,i),n[2]-=3.5*l;var c=ke.Z.computeNearestIntersection3D(i,n,Te.Z.PICK_GEOMETRY_FAST,this._nodeWebVR);c?(ke.Z.getWorldPositionFromHit(c,o,s),c.backface&&Oc.vec3.negate(s,s)):(Oc.vec3.copy(o,i),o[2]-=this.getEyeLevel(),Oc.vec3.set(s,0,0,1)),this._teleportNode.setHotspotHint(r.canTeleport(),o,t,l),r.setWorldTeleportPosition(t,o,l)}}(),updateHitHotspot:(Mc=function(e){return e instanceof ks},function(e,t,i,n,r){var a=this._viewer.getFeatures().hotspot.getWidgetNode(),o=e&&-1!==e._nodePath.indexOf(a);if(this._lastHoveredHotspot&&this._lastHoveredHotspot.setHovered(!1),!o)return this._lastHoveredHotspot&&this._lastHoveredHotspot.updateCardHit(),this._lastHoveredHotspot=void 0,void this._teleportNode.setHotspotHint(!1);var s=this._lastHoveredHotspot=(0,Xn.Z)(e._nodePath,Mc);return s.updateCardHit(e),s.setHovered(!0),s.isFullyVisibleCard()||(this.getTeleportPosFromHotspot(s,t,n,r),this._viewer.getFeatures().hotspot.getModel().set("currentHotspotIndex",s.getIndex())),s}),handleHitPicking:function(e,t,i,n,r,a,o){var s,l=this._viewer.getFeaturesManager(),u=this.model.get("worldFactor"),h=this._floorMT.getBoundingSphere(),c=Oc.vec3.dist(h.center(),t)+h.radius();return e?s=ke.Z.computeNearestIntersection2D(this._lastMouse[0],this._lastMouse[1],Te.Z.PICK_GEOMETRY_FAST):this._controllerMT.isPosedController()?(s=this._controllerMT.raycastFromController(this._nodeWebVR,l,c,a,o))?(ke.Z.getWorldPositionFromHit(s,n,r),s._backface&&Oc.vec3.negate(r,r),this._controllerMT.updatePointerScaleFromHit(n),this._cursorMT.setColor(Oc.vec3.fromValues(.1,.66,.85))):(this._controllerMT.resetPointerScale(),Oc.vec3.copy(n,o)):(Oc.vec3.copy(a,t),Oc.vec3.copy(o,i),Oc.vec3.scale(o,i,c),Oc.vec3.add(o,a,o),(s=ke.Z.computeNearestIntersection3DHotspotFirst(a,o,Te.Z.PICK_GEOMETRY_FAST,this._nodeWebVR))?(ke.Z.getWorldPositionFromHit(s,n,r),s._backface&&Oc.vec3.negate(r,r)):(Oc.vec3.scale(n,i,3*u),Oc.vec3.add(n,t,n))),s},goToNextHotspot:function(){this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleportToHotspot.bind(this,1))},doTeleportToHotspot:function(e){this._nodeMenu&&this._nodeMenu.isVisible()&&this._nodeMenu.hide();var t=this.computeHotspotIndex(e);-1!==t&&(this.moveToHotspotWithIndex(t),this.displayHotspotCardForIndex(t))},goToPrevHotspot:function(){this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleportToHotspot.bind(this,-1))},displayHotspotCardForIndex:function(e){var t=this._viewer.getFeatures().hotspot.getWidgetNode().children[e];this.toggleHotspotCard(t)},computeHotspotIndex:function(e){var t=this._viewer.getFeatures().hotspot.getModel(),i=t.get("hotspots");if(0===i.length)return-1;if(1!==e&&-1!==e)return console.log("computeHotspotIndex was called with an invalid direction argument. Valid values are 1 for foward -1 for backward."),0;var n=t.get("currentHotspotIndex"),r=i.length;return(n+=e)<0&&(n=-1),n=(n%r+r)%r,t.set("currentHotspotIndex",n),n},moveToHotspotWithIndex:(xc=Oc.vec3.create(),Tc=Oc.vec3.create(),wc=Oc.vec3.create(),function(e){var t=this._viewer.getFeatures().hotspot.getWidgetNode().children[e],i=this._viewer.getFeatures().hotspot.getModel().get("hotspots").at(e);ke.Z.getWorldPositionFromScenePoint(i.get("eye"),Tc),ke.Z.getWorldPositionFromScenePoint(i.get("position"),xc),this.getTeleportPosFromHotspot(t,Tc,Tc,wc),Tc[2]+=this.getEyeLevel(),this._manipulator.getFirstPersonManipulator().setInitialPoseVR(Tc,xc)}),doTeleport:function(e,t,i){var n=this._viewer.getFeaturesManager();e[2]+=this.getEyeLevel(),t[2]+=this.getEyeLevel(),n.focusOnTargetAndEye(t,e),this.toggleHotspotCard(i)},toggleHotspotCard:function(e){e&&(e.isFullyVisibleCard()?e.onCardHit(this):(this._lastSelectedHotspot&&this._lastSelectedHotspot.setVisibleCard(!1),this._lastSelectedHotspot=e,e&&e.setVisibleCard(!0)))},setPauseUpdate:function(e){this._pauseUpdate=e},update:function(){var e=Oc.vec3.create(),t=Oc.vec3.create(),i=Oc.vec3.create(),n=Oc.vec3.create(),r=Oc.vec3.create(),a=Oc.vec3.create(),o=Oc.vec3.create(),s=Oc.vec3.create(),u=Oc.vec3.create(),h=Oc.vec3.create();return function(c,A){var d=this._viewer.getFeatures(),g=this.model.get("enable"),f=this._viewer.getOptions().widgetAPI,p=!!f&&"virtual reality and augmented reality"===f.getTabbedWidget().get()&&!this._pauseUpdate,m=g||p;this.setProxyVisible(m);var _=d.background.getModel();_.get("webVR")!==m&&_.set("webVR",m);var v=d.postProcess.getModel();if(v.get("webVR")!==m&&v.set("webVR",m),this._humanMT.setVisible(p),!g&&!p)return!0;var C=this.model.get("worldFactor"),b=A.getFrameStamp(),S=b.getSimulationTime(),E=b.getDeltaTime();this._resetOnNextFrame&&this._framePose&&(this._resetOnNextFrame=!1,this.resetCameraToHuman()),this._manipulator.getEyePosition(i),this._manipulator.getTarget(n),Oc.vec3.sub(n,n,i),Oc.vec3.normalize(n,n);var y=this._viewer.getCamera(),I=this._viewerOSGJS.getVRSession();if(I){this._controllerMT.setNodeMask(Te.Z.NO_SHADOW);var x=I.inputSources;this._controllerMT.updateNodeVR(x,E,Oc.vec3.sub(s,i,this.getPosVR()))}else this._controllerMT.updateNodeVR(null,E,Oc.vec3.sub(s,i,this.getPosVR())),this._controllerMT.setNodeMask(0);var T=this.handleHitPicking(!g&&p,i,n,t,e,r,a);Oc.vec3.copy(o,t);var w,M,R=g&&this._controllerMT.isTeleportPressed(),B=this._controllerMT.isClickPressed(),N=this._nodeMenu&&this._controllerMT.isMenuPressed(this._nodeMenu.isVisible()),D=T&&-1===T._nodePath.indexOf(this._nodeMenu)&&(R||B)&&this._nodeMenu.isVisible(),P=g&&(N||D);if(P&&(this._manipulator.getTarget(s),this._nodeMenu.isVisible()?this._nodeMenu.hide():this._nodeMenu.display(i,s)),g){M=this._nodeMenu.updateHit(T),w=this.updateHitHotspot(T,r,a,o,e),this._teleportNode.updateWorldNormal(b,e);var F=T&&e[2]>.5,O=w?w.canTeleport():F,L=T&&-1!==T._nodePath.indexOf(this._floorMT),Z=w?w.canTeleport():F&&(!this.model.isDiorama()||L);if(R&&S-this._lastTime>.5){if(O)Oc.vec3.add(h,o,n),Oc.vec3.copy(u,o),this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleport.bind(this,u,h,w)),this._lastTime=S;O||this.toggleHotspotCard(w),M&&M.click()}this._interpolatorAlpha.setTarget(Z?1:0),this._interpolatorAlpha.update(b.getDeltaTime())}var U=this._viewer.getFeaturesManager().getIconScaleFov(this._cullConfig.leftProjection),V=Oc.vec3.dist(t,i)/U,Q=P?0:this._interpolatorAlpha.getCurrent()[0];this._cursorMT.setVisible(g),this._teleportNode.setVisible(T&&g&&!N);var G=!(0,l.Z)().vrAr&&this.model.get("displayFloor");this._floorMT.setVisible(G),this._floorMT.updateNodeVR(),this._humanMT.updateNodeVR(T,S),this._teleportNode.updateNodeVR(Q,T,b,o,C,V,e),this._cursorMT.updateNodeVR(w?1:1-Q,y,t,V),this._nodeMenu&&this._lastSelectedHotspot&&this._nodeMenu.isVisible()&&this._lastSelectedHotspot.isFullyVisibleCard()&&this._lastSelectedHotspot.setVisibleCard(!1);var H=this._controllerMT.checkScaleChangeValue();return this._scaleControlEnabled&&0!==H&&(H=C*Math.abs(H)*(H>0?1.02:1/1.02),this.model.set("worldFactor",H,{silent:!!this._framePose})),k.Z.draw(),!0}}()})]},Uc=n.Z.create(Zc);Uc.prototype.getNode=function(){return this._views[0].getNodeWebVR()},Uc.prototype.getWidgetNode=function(){return this._views[0].getProxyWebVR()},Uc.prototype.prepareForScreenShot=function(){var e=n.Z.prototype.prepareForScreenShot.call(this);return e&&this._views[0].setPauseUpdate(!0),e},Uc.prototype.resetAfterScreenShot=function(){n.Z.prototype.resetAfterScreenShot.call(this),this._views[0].setPauseUpdate(!1)};const Vc=Uc;var Qc=i("W+BB"),Gc=i("Thrf");const Hc=a.Z.extend({getModelOptionPath:function(){return"sound"},defaults:function(){return{currentSoundIndex:-1,visible:(0,l.Z)().uiSound,autoplay:!0,playing:!1,volume:void 0,select:void 0,enable:!0}},getName:function(){return"Sound"},init:function(e){this._viewer=e.getViewer(),this.set("volume",Gc.Z.getVolume());var t=e.getModel().get("options").sound;this.set("soundtracks",s.Z.instance.getSoundCollection()),this.setJSON(t)},setJSON:function(e,t){var i=e&&e.soundtracks;if(i&&i.length)for(var n=this.get("soundtracks"),r=0;r<i.length;++r){var a=i[r],o=n.findWhere({uid:a.uid}),s=!0;o?o.get("isInit")?o=o.duplicate():s=!1:o=new Qc.Z,o.setJSON(a,t),o.set("isInit",!0),s&&n.add(o)}},getJSON:function(){var e=[];return this.get("soundtracks").each((function(t){e.push(t.getJSON())})),{soundtracks:e}}});var zc,Wc,jc,qc,Jc,Yc,Kc=i("sbxc"),Xc=A.Z.osg,$c=A.Z.osgUtil,eA=A.Z.InputGroups,tA=Ze.Z.BLEND_SUBSTRACTIVE,iA=Ze.Z.DEPTH_DISABLE,nA=Xc.StateAttribute.ON,rA=Xc.vec4.fromValues(.109375,.6640625,.84765625,1),aA=Xc.vec4.fromValues(1,1,0,1),oA=Xc.vec4.fromValues(.8,.8,.8,1),sA=Xc.vec4.fromValues(1,1,0,1),lA=.5,uA=function(){return Wc||(Wc=Xc.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0)),Wc};const hA={init:function(e,t,i){this.model=e,this._context=t,this._viewer=this._context.getViewer(),this._nodeFeature=i,this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._icons=[],this._nodeCamera=new Xc.Camera,this._nodeCamera.setNearFarRatio(5e-4),this._nodeCamera.setName("Sound - Camera"),this._nodeCamera.getOrCreateStateSet().setRenderBinDetails(Me.Z.EDITOR_GIZMO,"RenderBin"),this._nodeCamera.setNodeMask(0),this._nodeIcons=new Xc.MatrixTransform,this._nodeFeature.addChild(this._nodeCamera),this._nodeCamera.addChild(this._nodeIcons),this._nodeGizmos=new Xc.MatrixTransform,this._nodeGizmos.setNodeMask(0),this._nodeGizmos._forceEnterIntersection=!0,this._nodeCamera.addChild(this._nodeGizmos),this._prepareGeometriesGizmo(),this._gizmoRefDistance=this._makeGizmo(this._geomHandleDistance),this._nodeGizmos.addChild(this._gizmoRefDistance._nodeGizmo),this._gizmoFalloff=this._makeGizmo(this._geomHandleFalloff),this._nodeGizmos.addChild(this._gizmoFalloff._nodeGizmo),Ue.Z.initSound(this),this.initStateset()},_prepareGeometriesGizmo:function(){this._geomHandleFalloff=new Xc.createTexturedBoxGeometry(0,0,0,lA,lA,lA),this._geomHandleDistance=new Xc.createTexturedBoxGeometry(0,0,0,lA,lA,lA),this._arc=$c.GizmoGeometry.createCircleGeometry(64,1,3.2*Math.PI),this.setGizmoStateset(this._arc,rA),this.setGizmoStateset(this._geomHandleDistance,rA),this.setGizmoStateset(this._geomHandleFalloff,rA)},_makeGizmo:function(e){var t={};return t._nodeGizmo=new Xc.MatrixTransform,t._arcScale=new Xc.MatrixTransform,this._arcScale=new Xc.MatrixTransform,t._arcX=this._makeArc(t._arcScale,"arcX"),t._arcY=this._makeArc(t._arcScale,"arcY",.5*-Math.PI,Xc.vec3.fromValues(1,0,0)),t._arcZ=this._makeArc(t._arcScale,"arcZ",.5*Math.PI,Xc.vec3.fromValues(0,1,0)),t._handleX=this._makeHandle(t._nodeGizmo,"handleX",Xc.vec3.fromValues(1,0,0),e),t._handleY=this._makeHandle(t._nodeGizmo,"handleY",Xc.vec3.fromValues(0,1,0),e),t._handleZ=this._makeHandle(t._nodeGizmo,"handleZ",Xc.vec3.fromValues(0,0,1),e),t._handleXNeg=this._makeHandle(t._nodeGizmo,"handleXNeg",Xc.vec3.fromValues(-1,0,0),e),t._handleYNeg=this._makeHandle(t._nodeGizmo,"handleYNeg",Xc.vec3.fromValues(0,-1,0),e),t._handleZNeg=this._makeHandle(t._nodeGizmo,"handleZNeg",Xc.vec3.fromValues(0,0,-1),e),t._nodeGizmo.editMask=$c.NodeGizmo.PICK_ARROW|$c.NodeGizmo.PICK_PLANE,t._nodeGizmo.setCullingActive(!1),t._nodeGizmo.addChild(t._arcScale),t},_makeHandle:function(e,t,i,n){var r=new Xc.MatrixTransform;return r.setName(t),e.addChild(r),r.addChild(n),Xc.mat4.fromTranslation(r.getMatrix(),i),r},_makeArc:function(e,t,i,n){var r=new Xc.MatrixTransform;return r.setName(t),e.addChild(r),r.addChild(this._arc),i&&n&&Xc.mat4.fromRotation(r.getMatrix(),i,n),r},initStateset:function(){this._nodeCamera.getOrCreateStateSet().setTextureAttributeAndModes(0,ar.Z.dummyTexture,nA),this._nodeCamera.getOrCreateStateSet().addUniform(Xc.Uniform.createInt(0,"uTextureDepth"))},setGizmoStateset:function(e,t){var i=e.getOrCreateStateSet();i.setAttributeAndModes(we.Z.getOrCreateShader(Da,Pa,"line","Handle3D","LINE"),nA),i.setAttributeAndModes(tA,nA),i.setAttributeAndModes(iA,nA),i.addUniform(Xc.Uniform.createFloat4(t,"uColor"))},updateDragHandle:function(e,t){var i=e.getMatrix();Xc.mat4.fromTranslation(i,t);var n=e.getWorldMatrices()[0];Xc.mat4.getTranslation(t,n);var r=this.getIconSize(t);Xc.mat4.scale(i,i,r),e.dirtyBound()},updateArcScale:(Yc=Xc.vec3.create(),function(e,t){var i=e._arcScale.getMatrix();Xc.mat4.scale(i,Xc.mat4.IDENTITY,Xc.vec3.set(Yc,t,t,t)),e._arcScale.dirtyBound(),this.updateDragHandle(e._handleX,Xc.vec3.set(Yc,t,0,0)),this.updateDragHandle(e._handleY,Xc.vec3.set(Yc,0,t,0)),this.updateDragHandle(e._handleZ,Xc.vec3.set(Yc,0,0,t)),this.updateDragHandle(e._handleXNeg,Xc.vec3.set(Yc,-t,0,0)),this.updateDragHandle(e._handleYNeg,Xc.vec3.set(Yc,0,-t,0)),this.updateDragHandle(e._handleZNeg,Xc.vec3.set(Yc,0,0,-t))}),_checkSelectNodeChanged:function(){var e=this.model.get("select");if(e!==this._select){this._select=e;var t=this.getGizmo();if(!e||e.get("ambient"))return t.attachToNode(null),void this.hideIcon(e);this.addIcon(e),(0,Uo.kR)(e),this._setGizmoPositionFromSound()}},_updateFalloffGizmo:function(){var e=this.model.get("select");this.updateArcScale(this._gizmoRefDistance,e.get("distance")),"linear"===e.get("distanceModel")?(this._gizmoFalloff._nodeGizmo.setNodeMask(Te.Z.NO_SHADOW),this.updateArcScale(this._gizmoFalloff,e.get("distanceMax"))):this._gizmoFalloff._nodeGizmo.setNodeMask(0)},_setGizmoPositionFromSound:function(){var e=this.model.get("select").get("lastComputedWorldPosition");Xc.mat4.setTranslation(this._nodeGizmos.getMatrix(),e)},_setSoundPositionFromGizmo:function(){var e=this.model.get("select"),t=e.get("lastComputedWorldPosition");Xc.mat4.getTranslation(t,this._nodeGizmos.getMatrix()),(0,Uo.D1)(e,t)},updateGizmo:function(){var e=this.getGizmo();if(e){this._checkSelectNodeChanged();var t=this.model.get("select");if(!t||t.get("ambient"))return this._nodeGizmos.setNodeMask(0),void e.setNodeMask(0);e.attachToNode(this._nodeGizmos),this._nodeGizmos.setNodeMask(-1),e.setNodeMask(-1);var i=t.get("snap");i?this._nodeGizmos.editMask=$c.NodeGizmo.NO_PICK:(this._nodeGizmos.editMask=$c.NodeGizmo.PICK_ARROW|$c.NodeGizmo.PICK_PLANE,t.set("geometryUid",-1)),this._dragging&&k.Z.draw(),this._updateFalloffGizmo(),this._nodeGizmos.dirtyBound();var n=t.get("lastComputedWorldPosition"),r=t.get("snapChanged");r&&t.set("snapChanged",!1),e.isEditing()||r?i?(this.snapCheck(t,n),this._displaySnapHelp()):this._setSoundPositionFromGizmo():this._setGizmoPositionFromSound()}},_updateSoundObjectPosition:function(e){(0,Uo.kR)(e),e.get("soundObject").setPositionNormalized(e.get("lastComputedWorldPosition"))},getNodeCamera:function(){return this._nodeCamera},getGizmo:function(){var e=this._viewer.getFeaturesManager();return e?e.getNodeGizmo():null},_displaySnapHelp:function(){new Kc.Z({content:"Double-click to snap the sound on the object surface.",class:"info",delay:2e3})},initDepthTexture:function(){var e=this._viewer.getFeaturesManager().getTextureDepth();this._nodeCamera.getStateSet().setTextureAttributeAndModes(0,e,nA);for(var t=0,i=this._icons.length;t<i;t++)this._icons[t].getStateSet().setTextureAttributeAndModes(0,e,nA)},getIconSize:function(){var e=Xc.vec3.create(),t=Xc.vec3.create();return function(i){var n=this._viewer.getFeaturesManager(),r=n?n.getIconScaleFov():1;this._manipulator.getEyePosition(e);var a=Xc.vec3.dist(e,i||Xc.vec3.ZERO)/r;return Xc.vec3.set(t,a,a,a)}}(),updateIcons:function(){var e=Xc.quat.create(),t=Xc.mat4.create(),i=Xc.vec3.create(),n=Xc.vec3.create();return function(){var r=this.model.get("select"),a=this._viewer.getCamera(),o=Xc.mat4.getScale(i,a.getProjectionMatrix())[0],s=.02*this._viewerOSGJS.getCanvasClientWidth()*o;this._manipulator.getEyePosition(n),Xc.mat4.invert(t,a.getViewMatrix()),Xc.mat4.getRotation(e,t);for(var l=0,u=this._icons.length;l<u;l++){var h=this._icons[l],c=h.getUserData();h!==this._hovered&&this.setIconSelected(h,r===c);var A=h.getMatrix();this._updateSoundObjectPosition(c);var d=c.get("lastComputedWorldPosition"),g=Xc.vec3.dist(n,d)/s;Xc.vec3.set(i,g,g,g),Xc.mat4.fromRotationTranslationScale(A,e,d,i),h.dirtyBound()}}}(),addIcon:function(e){var t,i;if(i=this._findIcon(e))return i.setNodeMask(-1),i;t=uA(),(i=new Xc.MatrixTransform).addChild(t);var n=s.Z.instance.getOrCreateTexture(Re.iconSound,{internalFormat:Xc.Texture.RGBA});this.setGizmoStateset(i,oA);var r=i.getOrCreateStateSet();r.setTextureAttributeAndModes(1,n.texture,nA),r.addUniform(Xc.Uniform.createInt(1,"uTextureIcon")),r.addUniform(Xc.Uniform.createInt(0,"uAttachedToCamera")),r.addUniform(Xc.Uniform.createInt(1,"uEnable")),zc||(zc=we.Z.getOrCreateShader(Da,Pa,"icon","LightingIcon","ICON")),r.setAttributeAndModes(zc);var a=this._icons.length;i.setName("SOUNDIconMT_"+a);var o=i.getMatrix();Xc.mat4.fromTranslation(o,e.get("lastComputedWorldPosition")),Xc.mat4.scale(o,o,this.getIconSize()),this._icons.push(i),this._nodeIcons.addChild(i),i.setUserData(e),i.dirtyBound()},hideIcon:function(e){var t=this._findIcon(e);t&&t.setNodeMask(0)},_findIcon:function(e){for(var t=0;t<this._icons.length;t++)if(this._icons[t].getUserData()===e)return this._icons[t];return null},snapCheck:(jc=new $c.SphereIntersector,qc=new $c.IntersectionVisitor,Jc=Xc.vec3.create(),function(e,t){qc.setTraversalMask(Te.Z.PICK_GEOMETRY_SLOW);var i=10*j.Z.getModelBoxWithDisplacement().radius();ke.Z.getScenePositionFromWorldPoint(t,Jc),jc.set(Jc,i),qc.setIntersector(jc),this._viewer.getRootModel().accept(qc);var n=jc.getIntersections(),r=n.length;if(r){for(var a=n[0],o=1;o<r;++o){var s=n[o];s._ratio<a._ratio&&(a=s)}(0,Uo.hP)(e,a)}}),onDragStart:function(e){if(this.isSoundTabOpen()&&ke.Z.isInitialized()){var t=ke.Z.computeNearestIntersection2D(e.canvasX,e.canvasY,Te.Z.PICK_GEOMETRY,this._nodeCamera);if(this._dragging=!1,t){var i=t._nodePath[t._nodePath.length-1];if(i===uA()){var n=t._nodePath[t._nodePath.length-2].getUserData();n&&this.model.get("soundtracks").trigger("select",n)}else if(i===this._geomHandleDistance||i===this._geomHandleFalloff){var r=this.model.get("select");if(void 0===r)return;var a=this.getGizmo();if(!a||a.isEditing())return;this._manipulator.getInputManager().setEnable(eA.MANIPULATORS,!1),this._dragging=!0,this.model.set("dragging",!0);var o=a.getWorldMatrices()[0],s=Xc.vec3.create();Xc.vec3.transformMat4(s,s,o),a.getCanvasPositionFromWorldPoint(s,s),this._draggingStartGizmoCenterX=s[0],this._draggingStartGizmoCenterY=s[1],this._draggingStartX=e.canvasX,this._draggingStartY=e.canvasY;var l=(this._draggingStartX-this._draggingStartGizmoCenterX)/this._viewer.getWidth(),u=(this._draggingStartY-this._draggingStartGizmoCenterY)/this._viewer.getHeight();this._draggingStartScreenDistance=Math.sqrt(l*l+u*u),t._nodePath[t._nodePath.length-3]===this._gizmoFalloff._nodeGizmo?(this.draggingFallofGizmo=!0,this._draggingStartDistance=r.get("distanceMax")):(this.draggingRefDistanceGizmo=!0,this._draggingStartDistance=r.get("distance"))}}}},onHover:function(e,t,i){if(ke.Z.isInitialized()){var n,r=ke.Z.computeNearestIntersection2D(e,t,Te.Z.PICK_GEOMETRY,this._nodeCamera);if(r){var a=r._nodePath[r._nodePath.length-1];if(a===this._hovered||r._nodePath.length>2&&r._nodePath[r._nodePath.length-2]===this._hovered)return;a===uA()?(this._hovered=r._nodePath[r._nodePath.length-2],this.setIconSelected(this._hovered,!0),k.Z.draw()):a!==this._geomHandleDistance&&a!==this._geomHandleFalloff||(this._hovered=a,n=a.getStateSet().getUniform("uColor").getInternalArray(),Xc.vec4.copy(n,aA),k.Z.draw())}else this._hovered&&(this._hovered===this._geomHandleDistance||this._hovered===this._geomHandleFalloff?(n=this._hovered.getStateSet().getUniform("uColor").getInternalArray(),Xc.vec4.copy(n,rA)):this._hovered.getUserData()!==i&&this.setIconSelected(this._hovered,!1),k.Z.draw(),this._hovered=!1)}},setIconSelected:function(e,t){var i=e.getStateSet().getUniformList().uColor.getAttribute().getInternalArray();t?Xc.vec4.copy(i,sA):Xc.vec4.copy(i,oA)},onDragMove:function(e){if(this.isSoundTabOpen()){var t=this.model.get("select");if(this._dragging){if(void 0!==t){var i=this.getGizmo();if(i)if(i.isEditing())this.onDragEnd();else{var n=(e.canvasX-this._draggingStartGizmoCenterX)/this._viewer.getWidth(),r=(e.canvasY-this._draggingStartGizmoCenterY)/this._viewer.getHeight(),a=Math.sqrt(n*n+r*r);a=a*this._draggingStartDistance/this._draggingStartScreenDistance,this.draggingRefDistanceGizmo?(t.set("distance",a),a>t.get("distanceMax")&&t.set("distanceMax",a)):(t.set("distanceMax",a),a<t.get("distance")&&t.set("distance",a)),k.Z.draw()}}}else this.onHover(e.canvasX,e.canvasY,t)}},onDragEnd:function(){this._dragging&&this.isSoundTabOpen()&&(void 0!==this.model.get("select")&&(this._manipulator.getInputManager().setEnable(eA.MANIPULATORS,!0),this.draggingFallofGizmo=!1,this.draggingRefDistanceGizmo=!1,this._dragging=!1,this.model.set("dragging",!1),k.Z.draw()))},onDoubleClick:function(e){if(this.isSoundTabOpen()){var t=this.model.get("select");if(void 0!==t&&!t.get("ambient"))if(this._viewer.getFeaturesManager()){var i=ke.Z.pickNearestSurface(e);i&&((0,Uo.hP)(t,i),(0,Uo.kR)(t),t.get("snap")||t.set("geometryUid",-1),this._updateSoundObjectPosition(t))}}},isSoundTabOpen:function(){var e=this._viewer.getOptions().widgetAPI;return e&&"sound"===e.getTabbedWidget().get()},removeIcon:function(e){for(var t=0,i=this._icons.length;t<i;t++){var n=this._icons[t];if(n.getUserData()===e){n.getParents()[0].removeChild(n);break}}},updateVisibility:function(){this.isSoundTabOpen()?(0===this._nodeCamera.getNodeMask()&&this._manipulator.getInputManager().setEnable(eA.SOUND_GIZMO,!0),this._nodeCamera.setNodeMask(Te.Z.NO_SHADOW),this.updateGizmo(),this.updateIcons()):(0!==this._nodeCamera.getNodeMask()&&this._manipulator.getInputManager().setEnable(eA.SOUND_GIZMO,!0),this._nodeCamera.setNodeMask(0))}};var cA=i("6QKU"),AA=A.Z.osg;var dA={FeatureName:"sound",ModelType:Hc,ViewListType:[O.Z.extend({initialize:function(e){O.Z.prototype.initialize.apply(this,arguments),this._currentFrame=0,this._currentSimulationTime=0,this._soundPromises=[],this._soundObjects=[],this._context=e.context,this._viewer=this._context.getViewer();var t=(0,l.Z)().soundEnable;this.model.set("enable",t),(0,l.Z)().soundMute&&(this.model.set("mute",!0),this.model.set("volume",0),Gc.Z.setMute(!0)),this._nodeFeature=new AA.Node,this._nodeFeature.setName("Feature - Sound"),(0,o.Z)()&&hA.init(this.model,this._context,this._nodeFeature),this.listenTo(this.model,"change:playing",this.onPlayingChange.bind(this)),this.listenTo(this.model,"change:enable",this.onEnableChange.bind(this)),this.listenTo(this.model,"change:volume",this.updateVolume.bind(this)),this.listenTo(this.model,"change:mute",this.updateMute.bind(this));var i=this.model.get("soundtracks");(0,ot.Z)()||t&&Gc.Z.checkWillHaveSounds(this._viewer.model)||i.reset();var n=i.length>0;if(n||(F.Z.resolveHasSound(n),(0,o.Z)())){if(this._nodeFeature.setCullCallback(this),(0,o.Z)()||n){var r=(0,cA.X2)();r&&document.addEventListener(r,this.tabChange.bind(this))}if(kr.default.apple.device){var a,s,u=!1,h=[];for(a=0,s=i.length;a<s;a++){var A=i.at(a);!u&&A.get("ambient")?u=A:h.push(A)}for(a=0,s=h.length;a<s;a++)i.remove(h[a]);if(!u)return void F.Z.resolveHasSound(!1)}this.listenTo(i,"add",this.onAdd.bind(this)),this.listenTo(i,"remove",this.onRemove.bind(this)),this.listenTo(i,"select",this.onSelectChanged.bind(this)),Gc.Z.setWaiting(!(0,o.Z)()),i.each(this.onAdd.bind(this)),F.Z.resolveHasSound(n);var d=[];d.push(F.Z.getHasAnimation()),(0,l.Z)().soundPreload&&d.push(c().all(this._soundPromises).then((function(){F.Z.resolveSoundsCanPlayTrough(!0)}))),c().all(d).then(function(e){this._hasAnim=e[0],Gc.Z.setHasAnim(this._hasAnim),F.Z.resolveSoundsCanPlayTrough(!0),this._hasAnim||(Gc.Z.setWaiting(!1),this.play()),F.Z.getFirstAnimation().then(function(){(0,o.Z)()&&hA.initDepthTexture(),this.updatePositionAndTime(this.model.get("playing"));var e=this._viewer.getFeatures().animation.getModel();this._featureAnimationModel=e,this._hasAnim&&(Gc.Z.setWaiting(!1),e.bind("change:playing",this.onAnimationPlaying,this),e.bind("change:speed",this.onAnimationSpeedChange,this),e.bind("seek",this.onAnimationTimeSeek,this),e.bind("change:currentUID",this.onUidChange,this),this.onAnimationPlaying(e))}.bind(this))}.bind(this))}else this.model.set("enable",!1)},isTabHidden:function(){return document[this._hidden]},tabChange:function(){this.model.get("enable")&&((0,cA.BG)()?Gc.Z.hide():(Gc.Z.show(),this._hasAnim&&this._featureAnimationModel?this.onAnimationPlaying(this._featureAnimationModel):Gc.Z.forcePlay(!0),this.updatePositionAndTime(this.model.get("playing")),Gc.Z.update()))},animationTimeSync:function(){if(Gc.Z.canPlay()&&this._featureAnimationModel){var e=this.getTimeFromAnimationProgress();e!==this._currentSimulationTime&&(this._currentSimulationTime=e,this.updatePositionAndTime(this._featureAnimationModel.get("playing")))}},updatePositionAndTime:function(e){if(Gc.Z.canPlay())for(var t=this._viewer.getFeaturesManager&&this._viewer.getFeaturesManager(),i=0,n=this._soundObjects.length;i<n;i++){var r=this._soundObjects[i];t&&this.onSoundPositionChange(r.getModel()),r.setTime(this._currentSimulationTime,e)}},onAnimationPlaying:function(e){if(1===this._featureAnimationModel.get("speed")){var t=e.get("playing");this.model.set("playing",t),t?this.play():this.pause()}else Gc.Z.setWaiting(!0)},onUidChange:function(e){"-1"===e.get("currentUID")?this.pause():e.get("playing")&&this.play()},getTimeFromAnimationProgress:function(){var e=this._featureAnimationModel.getCurrentAnimation();if(!e)return 0;var t=e.get("duration");return this._featureAnimationModel.get("progress")*t/100},onAnimationTimeSeek:function(){this._currentSimulationTime=this.getTimeFromAnimationProgress()},displayAnimationSpeedWarning:function(){Gc.Z.getProxyModel().trigger("sound-show","Warning. Changing the animation speed will not change the sound speed. This can lead to unexpected sound playback issues",{position:"top",duration:5e3})},onAnimationSpeedChange:function(e){if(1!==e.get("speed")){if(this.pause(),Gc.Z.setWaiting(!0),!(0,o.Z)())return;this.displayAnimationSpeedWarning()}else Gc.Z.setWaiting(!1),this.play()},onSoundChange:function(e){e.get("soundObject").updateFromModel(e),k.Z.draw()},onSoundPositionChange:function(e){e.get("soundObject").setPositionNormalized((0,Uo.kR)(e))},onSoundDistanceChange:function(e){e.get("soundObject").setRefDistanceNormalized(e.get("distance"))},onSoundDistanceMaxPositionChange:function(e){e.get("soundObject").setMaxDistanceNormalized(e.get("distanceMax"))},onSoundTimeChange:function(e){var t=e.get("soundObject"),i=this.getTimeFromAnimationProgress();t.setTime(i,!1)},onSoundVolumeChange:function(e){e.get("soundObject").updateVolume()},onSoundSnapChange:function(e){e.set("snapChanged",!0)},cull:function(){return this._hasAnim&&this._featureAnimationModel&&this.animationTimeSync(),(0,o.Z)()&&!this._pauseUpdate&&hA.updateVisibility(),!0},setPauseUpdate:function(e){this._pauseUpdate=e},getNode:function(){return this._nodeFeature},getNodeEditor:function(){return hA.getNodeCamera()},onSelectChanged:function(e){this.model.get("select")!==e&&(this.model.set("select",e),this.model.get("soundtracks").trigger("select",e),k.Z.draw())},onAdd:function(e){var t=Gc.Z.createSound(e,this.model.get("playing")),i=e.get("distance")<0,n=e.get("distanceMax")<0;(i||n)&&(i&&e.set("distance",0),n&&e.set("distanceMax",0),j.Z.getBoxReady().then((function(){var t=j.Z.getModelBoxWithDisplacement();i&&e.set("distance",t.radius()),n&&e.set("distanceMax",2*t.radius()),t.center(e.get("position"))})),(0,o.Z)()&&(this.onSelectChanged(e),this._hasAnim&&(e.set("sync",!0),1!==this._featureAnimationModel.get("speed")&&this.displayAnimationSpeedWarning()))),e.set("soundObject",t),e.on("change:enable change:ambient change:distanceModel",this.onSoundChange.bind(this)),e.on("change:position ",this.onSoundPositionChange.bind(this)),e.on("change:distance",this.onSoundDistanceChange.bind(this)),e.on("change:distanceMax",this.onSoundDistanceMaxPositionChange.bind(this)),e.on("change:startTime change:loop change:sync",this.onSoundTimeChange.bind(this)),e.on("change:volume",this.onSoundVolumeChange.bind(this)),e.on("change:snap",this.onSoundSnapChange.bind(this)),this._soundObjects.push(t);var r=new(c())((function(e){(0,l.Z)().soundPreload?t.whenReady().then((function(){e(t)})):e(t)}));if(this._soundPromises.push(r),(0,o.Z)()){e.get("ambient")||hA.addIcon(e);var a=this._viewer.getFeatures().animation;if(a){var s=a.getModel();if(s&&1!==s.get("speed")){Gc.Z.setWaiting(!0);Gc.Z.getProxyModel().trigger("sound-show","Warning. The animation speed is not x1 but sound will play at normal speed. This can lead to unexpected sound playback issues.",{position:"top",duration:5e3})}}}},onRemove:function(e){e===this.model.get("select")&&this.onSelectChanged(),o.Z&&hA.removeIcon(e);var t=e.get("soundObject");Gc.Z.removeSound(t),this._soundObjects.splice(this._soundObjects.indexOf(t),1)},onEnableChange:function(){this.model.set("playing",this.model.get("enable"))},onPlayingChange:function(){this.model.get("enable")&&(this.model.get("playing")?this.onPlay():this.onPause())},onPlay:function(){if(!(0,cA.BG)()){if(!this.model.get("enable"))return this.model.set("playing",!1),void this.pause();Gc.Z.setPlaying(!0),Gc.Z.canPlay()?Gc.Z.forcePlay(!0):Gc.Z.featureDetectSoundAuthGestureNeeded()?Gc.Z.enableTapRequestPopup():Gc.Z.forcePlay(!0),this.updatePositionAndTime(!0)}},onPause:function(){Gc.Z.pause(),this.updatePositionAndTime()},play:function(){this.model.get("enable")&&(this.model.set("playing",!0),this.onPlay())},pause:function(){this.model.get("enable")&&(this.model.set("playing",!1),this.onPause())},updateMute:function(e){var t=e.get("mute");Gc.Z.setMute(t)},updateVolume:function(e){var t=e.get("volume");t>=0&&(e.set("mute",!1),Gc.Z.setMute(!1)),Gc.Z.setVolume(t)}})]},gA=n.Z.create(dA);gA.prototype.getNode=function(){return this._views[0].getNode()},gA.prototype.getWidgetNode=function(){return this._views[0].getNodeEditor()},gA.prototype.prepareForScreenShot=function(){var e=n.Z.prototype.prepareForScreenShot.call(this);return e&&this._views[0].setPauseUpdate(!0),e},gA.prototype.resetAfterScreenShot=function(){n.Z.prototype.resetAfterScreenShot.call(this),this._views[0].setPauseUpdate(!1)};const fA=gA;const pA=Kn().Model.extend({defaults:{availableDisplayView:["Default"],forceSingleSided:!1,materialList:[],materialByUid:{},displayView:"Default",material:void 0,hoverMaterial:void 0,splitType:"3d",texCoord:0,focusMaterial:!(0,o.Z)(),highlightOnHover:!(0,o.Z)(),autoSelectHoverMaterial:(0,l.Z)().autoMaterial,viewerToCanvasRatio:1,referenceShadingType:"lit",uiVisible:!1},init:function(e){this._viewer=e.getViewer(),F.Z.getMaterial().then(this.initAvailableView.bind(this))},getMaterialModel:function(){return this._viewer.getFeatures().material.getModel()},getShadingStyleModel:function(){return this._viewer.getFeatures().shadingStyle.getModel()},getPostProcessModel:function(){return this._viewer.getFeatures().postProcess.getModel()},getGroundModel:function(){return this._viewer.getFeatures().ground.getModel()},getCurrentMaterial:function(){return this.getMaterialByUid(this.get("material"))},getCurrentUVs:function(){return this.get("materialList").find(function(e){return e.uid===this.get("material")}.bind(this)).texCoordUnitList},getMaterialByUid:function(e){var t=this.getMaterialModel().getMaterials(),i=t[e],n=i.get("uidUniqueMerged");return n?t[n]:i},initAvailableView:function(){var e=this.get("displayView"),t=this.get("availableDisplayView"),i=this.get("materialList"),n=this.get("materialByUid");this.set("displayView","Default"),t.length=0,t.push("Default"),i.length=0;var r=vi.Z.length,a={},o=!1,s=this.getMaterialModel().attributes;for(var l in s){var u=s[l];if(!u.get("uidUniqueMerged")){for(var h={},c=u.getChannels(),A=0;A<r;++A){var g=vi.Z[A],f=c[g],p=f.isEffective();f.set("backupJSON",void 0),h[g]=p,a[g]||f.isEnableEffective()&&("DiffuseIntensity"!==g||p)&&(a[g]=!0)}var m=u.get("texCoordUnitList");o=o||m.length>0,void 0===this.get("material")&&this.set("material",l);var _=!1;c.MetalnessPBR.isEnableEffective()?_=c.GlossinessPBR.isEnableEffective():c.SpecularPBR.isEnableEffective()&&(_=c.RoughnessPBR.isEnableEffective());var v={uid:l,name:u.get("name"),texCoordUnitList:m,uidUniqueMerged:u.get("uidUniqueMerged"),uidListUnusedDuplicates:u.get("uidListUnusedDuplicates"),effectiveChannels:h,swapMicrosurface:_};i.push(v),n[l]=v}}a.MetalnessPBR?(delete a.GlossinessPBR,a.RoughnessPBR=!0):a.SpecularPBR&&(delete a.RoughnessPBR,a.GlossinessPBR=!0);for(var C=0;C<r;++C){var b=vi.Z[C];a[b]&&t.push(b)}t.push("MatcapFlat"),-1===t.indexOf("NormalMap")&&-1===t.indexOf("BumpMap")||t.push("MatcapDetail");var S=this.getShadingStyleModel();S.get("hasWireframe")&&t.push("Wireframe"),S.get("hasVertexColor")&&S.get("vertexColorEnable")&&(t.push("VertexColor"),S.get("hasVertexAlpha")&&S.get("vertexColorUseAlpha")&&-1!==t.indexOf("Opacity")&&t.push("VertexAlpha")),d.Z.hasVertexNormals&&t.push("VertexNormal"),o&&t.push("UVChecker"),this.getPostProcessModel().hasAtLeastOneEffectiveEffect()&&t.push("DefaultNoPostProcess"),this.getGroundModel().get("enable")&&t.push("DefaultNoGround"),d.Z.hasBones&&(t.push("Bones"),t.push("BoneWeights")),this.set("referenceShadingType",S.get("type")),this.trigger("change:availableDisplayView"),this.set("displayView",e)},_getCorrectedDisplayView:function(e){var t=this.get("displayView");return!this.get("materialByUid")[e].swapMicrosurface||"RoughnessPBR"!==t&&"GlossinessPBR"!==t?t:"RoughnessPBR"===t?"GlossinessPBR":"RoughnessPBR"},materialHasContentInView2d:function(e){var t=this.getMaterialByUid(e),i=this._getCorrectedDisplayView(e);return t.getChannels()[i]?this.get("materialByUid")[e].effectiveChannels[i]:"Wireframe"===i?t.get("geometryList").length>0:"VertexColor"===i?t.get("hasVertexColor"):"VertexAlpha"===i?t.get("hasVertexAlpha"):!("UVChecker"!==i||!t.get("texCoordUnitList").length)},materialHasTextureInView2d:function(e){var t=this.getMaterialByUid(e),i=this._getCorrectedDisplayView(e),n=t.getChannels()[i];return n?this.get("materialByUid")[e].effectiveChannels[i]&&!!n.getTextureModel():"Wireframe"===i?t.get("geometryList").length>0:"VertexColor"===i?t.get("hasVertexColor"):"VertexAlpha"===i&&t.get("hasVertexAlpha")},hasContentInView2d:function(){return this.materialHasContentInView2d(this.get("material"))},getName:function(){return"Inspector"}});var mA=i("Vpaz");var _A=i("PNlk"),vA=i("LTW4"),CA=A.Z.osg,bA=A.Z.osgUtil,SA=function(e,t){CA.Camera.call(this),this._model=t,this._viewer=e,this._viewerOSGJS=e.getViewerOSGJS(),this.setNodeMask(0),this.setName("Camera 2D"),this.setReferenceFrame(CA.Transform.ABSOLUTE_RF),this.setViewport(new CA.Viewport),CA.vec4.set(this.getClearColor(),.5,.5,1,1),this._manipulatorEnable=!1,this._scale=1,this._zoomCoord=CA.vec2.create();var i=this.getCameraEasing();this._panInterpolator=new bA.DelayInterpolator(2,i),this._zoomInterpolator=new bA.DelayInterpolator(1,i),this.addUpdateCallback(this),this.initGraph()};SA.prototype=CA.objectInherit(CA.Camera.prototype,{initGraph:function(){var e=CA.StateAttribute.OVERRIDE_ON,t=this.getOrCreateStateSet();t.addUniform(CA.Uniform.createFloat(1,"uDisplay2D")),t.addUniform(CA.Uniform.createInt(0,"uOutputLinear"),e),t.setAttributeAndModes(Ze.Z.DEPTH_DISABLE,e),t.setRenderBinDetails(Me.Z.OPAQUE_NO_EARLYZ,"RenderBin"),this._projectedGeometry=new CA.Node,this._projectedGeometry.setName("Projected Geometry");var i=this._projectedGeometry.getOrCreateStateSet();i.addUniform(CA.Uniform.createFloat4(CA.vec4.ONE,"uColor")),i.addUniform(CA.Uniform.createInt(0,"uProjectedWireframe")),this._projectedWireframe=new CA.Node,this._projectedWireframe.setName("Projected Wireframe"),this._projectedWireframe.getOrCreateStateSet().addUniform(CA.Uniform.createInt(1,"uProjectedWireframe")),this._projectedPolygon=new CA.Node,this._projectedPolygon.setName("Projected Polygon"),this._projectedGeometry.addChild(this._projectedPolygon),this._projectedGeometry.addChild(this._projectedWireframe),this._displayTexture=new CA.Node,this._displayTexture.setName("Display Texture"),this._displayTexture.getOrCreateStateSet().setShaderGeneratorName("inspector",e),this._quadTexture=CA.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._quadTexture.setName("Texture display 2D"),this._displayTexture.addChild(this._quadTexture),this.addChild(this._displayTexture),this.addChild(this._projectedGeometry),F.Z.getModelDisplayed().then(function(){var e=this._viewer.getFeatures(),t=e.environment.getNode();this._quadTexture.setStateSet(t.getStateSet()),e.postProcess.getNodeIn().addChild(this)}.bind(this))},getCameraEasing:function(){return void 0===(0,l.Z)().cameraEasing?.8:1-(0,l.Z)().cameraEasing},getViewportWidth:function(){return this.getViewport().width()},getViewportHeight:function(){return this.getViewport().height()},_replaceProjectedGeometry:function(e,t,i){e.removeChildren();for(var n=0;n<t.length;++n){var r=t[n],a=new CA.Geometry;a._attributes=r.getAttributes(),a._primitives=r.getPrimitives(),a._QVT=r._QVT,a._QVS=r._QVS,a._listQuantUV=r._listQuantUV,a.setBound(this._quadTexture.getBoundingBox()),a.setStateSet(i),e.addChild(a)}},_updateProjectedGeometry:function(e,t,i,n){if(n.isFulfilled())return this._replaceProjectedGeometry(e,t,i,n);var r=this,a=this._material;n.then((function(){a===r._material&&r._replaceProjectedGeometry(e,t,i,n)}))},_updateProjectedPolygon:function(e){this._updateProjectedGeometry(this._projectedPolygon,e.get("geometryList"),e.get("stateSet"),F.Z.getModelDisplayed())},_updateProjectedWireframe:function(e){this._updateProjectedGeometry(this._projectedWireframe,e.get("wireframeList"),e.get("stateSetWireframe"),F.Z.getWireframeOptimizedSplitCompressed())},setMaterial:function(e,t){this._material=e;var i=e.get("stateSet");this._displayTexture.setStateSet(i);var n="TexCoord"+t,r=n,a=_A;if((0,l.Z)().zz){var o="uQUV"+t;r=n+".xy * "+o+".zw + "+o+".xy",a="uniform vec4 "+o+";\n"+a}a=a.replace(/%UV%/g,n).replace(/%UV_UNPACK%/g,r);var s=we.Z.getOrCreateShader(a,vA,"inspector-projectedTexCoord"+t,"projectedTexCoord"+t);if(this._projectedGeometry.getOrCreateStateSet().setAttributeAndModes(s),!e.get("texCoordUnitList").length)return this._projectedPolygon.removeChildren(),void this._projectedWireframe.removeChildren();var u=this._quadTexture.getVertexAttributeList(),h="TexCoord"+t;u[h]||(u[h]=u.TexCoord0),this._updateProjectedWireframe(e),this._updateProjectedPolygon(e)},setManipulatorEnable:function(e){this._manipulatorEnable=e},setVisible:function(e){this.setNodeMask(e?Te.Z.NO_PICK_NO_SHADOW_CAST:0)},updateOrtho:function(){var e=.5*this._scale,t=e*this.getViewportHeight()/this.getViewportWidth();CA.mat4.ortho(this.getProjectionMatrix(),-e,e,-t,t,-10,10)},onEventStart:function(e){this._lastScale=e.scale||1,this._zoomInterpolator.reset(),this._panInterpolator.reset(),this._isPanning=!0},onEventEnd:function(){this._zoomInterpolator.reset(),this._panInterpolator.reset(),this._isPanning=!1},_registerHoverUV:function(){var e=CA.mat4.create();return function(t){var i=Wa.Z.uHoverUV.getInternalArray();CA.mat4.identity(e),this.getViewport().computeWindowMatrix(e),CA.mat4.multiply(e,e,this.getProjectionMatrix()),CA.mat4.multiply(e,e,this.getViewMatrix()),CA.mat4.invert(e,e),i[0]=t.glX,i[1]=t.glY,CA.vec2.transformMat4(i,i,e),i[0]+=.5,i[1]+=.5,k.Z.draw()}}(),onEventUpdate:function(e){if(this._registerHoverUV(e),this._isPanning){if(this._panInterpolator.setTarget(e.glX,-e.glY),e.scale){var t=e.scale>this._lastScale?5:10,i=(e.scale-this._lastScale)*t,n=this._zoomInterpolator.getTarget()[0]-i;this._zoomInterpolator.setTarget(n),this._lastScale=e.scale}this.registerFocusZoom(e),k.Z.draw()}},onMouseWheel:function(e){this._zoomInterpolator.setTarget(this._zoomInterpolator.getTarget()[0]-Math.sign(e.deltaY)),this.registerFocusZoom(e),k.Z.draw()},registerFocusZoom:function(e){var t=this._viewerOSGJS.getCanvasPixelRatio(),i=this.getViewportWidth(),n=this.getViewportHeight(),r=CA.vec2.set(this._zoomCoord,e.canvasX,e.canvasY),a="2d"===this._model.get("splitType")?.5:-.5;r[0]=a+(r[0]*t-i)/i,r[1]=r[1]*t/n-.5},_updateWireframeNodeMask:function(){var e=this._viewer.getOrCreateScene().getWireframeNodes();e.length&&this._projectedWireframe.setNodeMask(e[0].getNodeMask())},update:function(e,t){var i=t.getFrameStamp().getDeltaTime(),n=this.getViewMatrix(),r=this.getViewportWidth(),a=this.getViewportHeight(),o=this._panInterpolator.update(i),s=.1*this._zoomInterpolator.update(i)[0],l=this._scale*(1+s),u=l*this._viewerOSGJS.getCanvasPixelRatio()/r,h=l-this._scale;n[12]+=o[0]*u+this._zoomCoord[0]*h,n[13]-=o[1]*u+this._zoomCoord[1]*h*a/r,this._scale=l,this.updateOrtho(),this._updateWireframeNodeMask();var c=this._model.get("displayView"),A="VertexColor"===c||"VertexAlpha"===c?-1:0;return this._projectedPolygon.setNodeMask(A),!0}});const EA=SA;var yA,IA,xA=i("0rAA"),TA=i("R7V+"),wA=i("pBOM"),MA=i("Vq6u"),RA=i("ovGl"),BA=A.Z.osg,NA=A.Z.osgAnimation,DA=BA.vec3.create(),PA=function(){};xA.Z.createPrototypeObject(PA,{enable:!0,linkGeoms:[],cull:function(){var e=BA.vec3.create();return function(){if(!this.enable)return!0;for(var t=0;t<this.linkGeoms.length;t++){var i=this.linkGeoms[t];BA.mat4.getTranslation(e,i.userDataMap.startBoneMatrix);var n=i.userDataMap.startUniform.getInternalArray();BA.vec3.copy(n,e),BA.mat4.getTranslation(e,i.userDataMap.endBoneMatrix),n=i.userDataMap.endUniform.getInternalArray(),BA.vec3.copy(n,e)}return!0}}()},"osgShadow","LinkCullCallback");var FA,OA,LA=function(){BA.NodeVisitor.call(this),this._visitedNodes={},this._geoStateSet=new BA.StateSet,this._geoStateSet.setAttributeAndModes(yA||(yA=we.Z.getOrCreateShader(TA,wA,"debug/skeleton","debugSkeleton"))),this._geoStateSet.setRenderBinDetails(Me.Z.DEBUG_2,"RenderBin"),this._linkCullCallback=new PA};BA.createPrototypeObject(LA,BA.objectInherit(BA.NodeVisitor.prototype,{setEnable:function(e,t){e?(this._geoStateSet.setAttributeAndModes(Ze.Z.DEPTH_LESS_WRITE,BA.StateAttribute.OVERRIDE_ON),this._alreadyRun||(this._alreadyRun=!0,this.apply(t)),this._linkCullCallback.enable=e):this._geoStateSet.setAttributeAndModes(Ze.Z.DEPTH_NEVER,BA.StateAttribute.OVERRIDE_ON)},_setBoneStateSet:function(e){e.setStateSet(this._geoStateSet),e._isSkeleton=!0},_getOrCreateBoneGeometry:function(){return this._geomBone||(this._geomBone=BA.createTexturedSphere(),this._setBoneStateSet(this._geomBone),this._geomBone.setNodeMask(Te.Z.NO_PICK_NO_SHADOW)),this._geomBone},_getOrCreateBoneBodyGeometry:function(){if(this._geomBoneBody)return this._geomBoneBody;for(var e=.3,t=.05,i=new Float32Array(72),n=new Float32Array(72),r=0;r<4;++r){var a=3*r*3*2,o=0===r||1===r?t:-.05,s=0===r||3===r?t:-.05,l=0===r||3===r?t:-.05,u=2===r||3===r?t:-.05;i[a+3+0]=o,i[a+3+1]=s,i[a+3+2]=e,i[a+6+0]=l,i[a+6+1]=u,i[a+6+2]=e;var h=e;n[a+0]=n[a+3+0]=n[a+6+0]=s*h-h*u,n[a+1]=n[a+3+1]=n[a+6+1]=h*l-o*h,n[a+2]=n[a+3+2]=n[a+6+2]=o*u-s*l,i[a+9+0]=0,i[a+9+1]=0,i[a+9+2]=1,i[a+12+0]=l,i[a+12+1]=u,i[a+12+2]=e,i[a+15+0]=o,i[a+15+1]=s,i[a+15+2]=e,h=-.7,n[a+9+0]=n[a+12+0]=n[a+15+0]=s*h-h*u,n[a+9+1]=n[a+12+1]=n[a+15+1]=h*l-o*h,n[a+9+2]=n[a+12+2]=n[a+15+2]=o*u-s*l}this._geomBoneBody=new BA.Geometry;var c=this._geomBoneBody.getAttributes();c.Vertex=new BA.BufferArray(BA.BufferArray.ARRAY_BUFFER,i,3),c.Normal=new BA.BufferArray(BA.BufferArray.ARRAY_BUFFER,n,3);var A=new BA.DrawArrays(BA.primitiveSet.TRIANGLES,0,i.length/3);return this._geomBoneBody.getPrimitives().push(A),this._setBoneStateSet(this._geomBoneBody),this._geomBoneBody.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._geomBoneBody},_createBoneLinkGeometry:(FA=BA.vec3.create(),OA=BA.vec3.create(),function(e,t){BA.mat4.getTranslation(FA,e.getMatrixInSkeletonSpace()),BA.mat4.getTranslation(OA,t.getMatrixInSkeletonSpace());var i=new Float32Array(6);i[0]=1;var n=new Float32Array(2);n[0]=0,n[1]=1;var r=new BA.Geometry,a=r.getAttributes();a.Vertex=new BA.BufferArray(BA.BufferArray.ARRAY_BUFFER,i,3),a.BoneIndex=new BA.BufferArray(BA.BufferArray.ARRAY_BUFFER,n,1);var o=new BA.DrawArrays(BA.primitiveSet.LINES,0,i.length/3);r.getPrimitives().push(o);var s=r.getOrCreateStateSet(),l=BA.Uniform.createFloat3("uStartPos"),u=BA.Uniform.createFloat3("uEndPos");return s.addUniform(l),s.addUniform(u),r.userDataMap={},r.userDataMap.startBoneMatrix=e.getMatrixInSkeletonSpace(),r.userDataMap.endBoneMatrix=t.getMatrixInSkeletonSpace(),r.userDataMap.startUniform=l,r.userDataMap.endUniform=u,this._linkCullCallback.linkGeoms.push(r),r}),_addBone:function(e,t){var i=new BA.MatrixTransform,n=e.getMinimumBound().radius()/40;BA.vec3.set(DA,n,n,n),BA.mat4.fromScaling(i.getMatrix(),DA),i.getOrCreateStateSet().addUniform(BA.Uniform.createFloat3(e.getOrCreateDebugColor(),"uBoneColor")),i.setName("Debug joint ("+e.getName()+")"),e.addChild(i),i._isControlBone=t,i.addChild(this._getOrCreateBoneGeometry())},_addBoneBody:function(){var e=BA.vec3.create(),t=BA.vec3.fromValues(0,0,1),i=BA.quat.create(),n=BA.Uniform.createFloat3(BA.vec3.fromValues(-1,-1,-1),"uBoneColor");return function(r,a,o){var s=new BA.MatrixTransform,l=BA.vec3.len(a);BA.quat.rotationTo(i,t,BA.vec3.normalize(e,a));var u=s.getMatrix();BA.vec3.set(e,l,l,l),BA.mat4.fromRotationTranslationScale(u,i,BA.vec3.ZERO,e),s.getOrCreateStateSet().addUniform(n);var h="Debug bone ("+r.getName()+", "+o+")";s.setName(h),r.addChild(s),s.addChild(this._getOrCreateBoneBodyGeometry())}}(),_addBoneLink:function(e,t){if(!this._boneLinksNode){this._boneLinksNode=new BA.MatrixTransform,BA.mat4.invert(this._boneLinksNode,this._rootBone.getMatrix()),this._rootBone._parents[0].addChild(this._boneLinksNode);var i=this._boneLinksNode.getOrCreateStateSet();i.setAttributeAndModes(IA||(IA=we.Z.getOrCreateShader(MA,RA,"debug/skeletonWire","debugSkeletonWire"))),i.setRenderBinDetails(Me.Z.DEBUG_2,"RenderBin"),this._boneLinksNode.setCullCallback(this._linkCullCallback),this._boneLinksNode._isControlBone=!0}this._boneLinksNode.addChild(this._createBoneLinkGeometry(e,t))},_extractBoneData:function(e){for(var t,i=[],n=e.getChildren(),r=0;r<n.length;++r)if(n[r]instanceof NA.Bone){var a=n[r],o=a.isSkinning();a.getName().indexOf("_correct")>=0&&(o=a.getChildren()[0].isSkinning()),o?i.push(a):t||(t=a)}return 0===i.length&&t&&i.push(a),i},_epsEqual:function(e,t,i){for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(Math.abs(r-a)>i)return!1}return!0},_approximateTail:function(){var e=BA.vec3.create(),t=BA.vec3.create(),i=BA.vec3.create(),n=BA.vec3.create(),r=BA.vec3.create(),a=BA.vec3.create();return function(o,s){if(1===s.length)return BA.mat4.getTranslation(o.userDataMap.tail,s[0].getMatrix()),void(o.userDataMap.tailChild=s[0]);if(s.length>1){var l=.001*o.getMinimumBound().radius();BA.mat4.getTranslation(o.userDataMap.tail,s[0].getMatrix());for(var u=!0,h=1;h<s.length;h++){var c=s[h];if(BA.mat4.getTranslation(e,c.getMatrix()),!this._epsEqual(e,o.userDataMap.tail,l)){u=!1;break}}if(u)return void(o.userDataMap.tailChild=s[0])}for(var A,d=o.userDataMap.apexes,g=0,f=0;f<d.length;f++){var p=BA.vec3.sqrLen(d[f]);p>g&&(A=f,g=p)}if(s.length){var m=o.getBoneParent(),_=o.getMatrixInSkeletonSpace();if(m&&m.userDataMap.tail){var v=m.getMatrixInSkeletonSpace();BA.vec3.transformMat4(a,m.userDataMap.tail,v),BA.mat4.getTranslation(e,v),BA.vec3.sub(a,a,e),BA.vec3.normalize(a,a)}if(s.length>=1){BA.vec3.normalize(i,d[A]);for(var C=.95,b=.95,S=void 0,E=void 0,y=0;y<s.length;y++){var I=s[y];BA.mat4.getTranslation(t,I.getMatrix()),BA.vec3.normalize(r,t);var x=BA.vec3.dot(r,i);if(x>C&&(S=I,C=x),m&&m.userDataMap.tail){BA.vec3.transformMat4(n,t,_),BA.mat4.getTranslation(e,_),BA.vec3.sub(n,n,e),BA.vec3.normalize(n,n);var T=BA.vec3.dot(n,a);T>b&&(E=I,b=T)}}S?(BA.mat4.getTranslation(t,S.getMatrix()),BA.vec3.copy(o.userDataMap.tail,t),o.userDataMap.tailChild=S):E?(BA.mat4.getTranslation(t,E.getMatrix()),BA.vec3.copy(o.userDataMap.tail,t),o.userDataMap.tailChild=E):BA.vec3.copy(o.userDataMap.tail,d[A])}}else BA.vec3.copy(o.userDataMap.tail,d[A])}}(),_drawBone:function(e){this._addBone(e,!e.isSkinning());var t=e.getChildren();if(t.length){var i=this._extractBoneData(e);e.isSkinning()&&e.userDataMap.apexes&&(e.userDataMap.tail=BA.vec3.create(),this._approximateTail(e,i),e.userDataMap.tail&&this._addBoneBody(e,e.userDataMap.tail,e.getName()+"_tail"));for(var n=0;n<t.length;n++){var r=t[n];r!==e.userDataMap.tailChild&&t[n]instanceof NA.Bone&&this._addBoneLink(e,r)}}},apply:function(e){var t=e.getInstanceID();if(!this._visitedNodes[t]){if(this._visitedNodes[t]=!0,e instanceof NA.Bone){this._rootBone||(this._rootBone=e);var i=e.getName();i&&-1!==i.indexOf("_correct")||this._drawBone(e)}this.traverse(e)}}}),"osgSketchfab","DrawBoneVisitor");const kA=LA;var ZA=A.Z.osg,UA=function(){ZA.NodeVisitor.call(this),this._visible=!0};ZA.createPrototypeObject(UA,ZA.objectInherit(ZA.NodeVisitor.prototype,{setEnable:function(e,t){this._visible=e,this._visitedNodes={},this._alreadyRun=!0,this.apply(t)},validNodeMask:function(){return!0},apply:function(e){var t=e.getInstanceID();this._visitedNodes[t]||(this._visitedNodes[t]=!0,e._isControlBone&&e.setNodeMask(this._visible?Te.Z.NO_PICK_NO_SHADOW:0),this.traverse(e))}}),"osgSketchfab","ShowControlBonesVisitor");const VA=UA;var QA=A.Z.osg,GA=A.Z.osgUtil,HA=A.Z.InputGroups,zA=.25,WA=QA.vec3.fromValues(.7,.75,.75),jA={Opacity:!0,AOPBR:!0,CavityPBR:!0};var qA={FeatureName:"inspector",ModelType:pA,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:displayView",this.onDisplayView,this),e.bind("change:material",this.onMaterial,this),e.bind("change:texCoord",this.onTexCoord,this),e.bind("change:splitType",this.onSplitType,this),e.bind("change:viewerToCanvasRatio",this._onViewerToCanvasRatio,this),e.bind("change:forceSingleSided",this.onForceSingleSided,this),e.bind("change:uiVisible",this.onToggle,this),this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._inputManager=this._viewer.getInputManager(),this._viewer.bind("resizeCanvas",this._updateSplitView,this),this._nodeInspector=new QA.Node,this._nodeInspector.setName("Feature - Inspector"),this._normalVisitor=new GA.DisplayNormalVisitor,this._geoColorVisitor=new GA.DisplayGeometryVisitor,this._drawBonesVisitor=new kA,this._showControlBonesVisitor=new VA,this._camera2D=new EA(this._viewer,this.model),Ue.Z.initInspector(this),Ue.Z.initInspectorCamera2D(this._camera2D),Ue.Z.setInspectorInputsEnable(!1),this._matcapJSON={factor:1,color:QA.vec3.ONE,texture:{uid:"43a40dd3e9c34fc0b7da9cbf07b82ac8"}},F.Z.getMaterial().then(this.initAfterMaterials.bind(this)),j.Z.getBoxReady().then(this.initNormalVisitor.bind(this))},onToggle:function(){Ue.Z.setInspectorInputsEnable(this.model.get("uiVisible"))},onForceSingleSided:function(){for(var e=this.model.get("forceSingleSided"),t=this.model.get("materialList"),i=this.getMaterialModel().getMaterials(),n=0;n<t.length;++n){var r=i[t[n].uid],a=r.get("backupCullFace");(void 0!==a||(r.set("backupCullFace",r.get("cullFace")),e))&&(e?r.set("cullFace",QA.CullFace.BACK):r.set("cullFace",a))}},initAfterMaterials:function(){this._viewer.getFeatures().quality.getModel().bind("updateDynamicResolutionScaling",this._updateSplitView,this)},initNormalVisitor:function(){this._normalVisitor.setScale(.01*j.Z.getModelBoxWithDisplacement().radius())},hasDisplayView:function(e){return-1!==this.model.get("availableDisplayView").indexOf(e)},getMaterialModel:function(){return this._viewer.getFeatures().material.getModel()},getOutlineModel:function(){return this._viewer.getFeatures().outline.getModel()},getQualityModel:function(){return this._viewer.getFeatures().quality.getModel()},getShadingStyleModel:function(){return this._viewer.getFeatures().shadingStyle.getModel()},getPostProcessModel:function(){return this._viewer.getFeatures().postProcess.getModel()},getGroundModel:function(){return this._viewer.getFeatures().ground.getModel()},getImageCollection:function(){return this.getMaterialModel().getImageCollection()},getCurrentMaterial:function(){return this.model.getCurrentMaterial()},isOnView2D:function(e){var t=this.model.get("splitType");return"3d"!==t&&("2d"===t||"split"===t&&e.canvasX>.5*this._viewerOSGJS.getCanvasClientWidth())},isTabMaterial:function(){var e=this._viewer.getFeaturesManager();return e&&"materials"===e.getCurrentTabName()},canDisplayOutline:function(){return this.isTabMaterial()||"split"===this.model.get("splitType")},focusCheck:function(e){var t=(0,l.Z)();if(t.uiInspector&&t.uiGeneralControls){var i=this.isOnView2D(e);i===this._isView2DEnabled||this._cursorPressed||(this._inputManager.setEnable(HA.UI_INSPECTOR,i),(0,l.Z)().scrollwheel&&(this._inputManager.setEnable(HA.UI_INSPECTOR_ZOOM,i),this._inputManager.setEnable(HA.SCENE_INSPECTOR_ZOOM,!i)),this._inputManager.setEnable(HA.SCENE,!i),this._isView2DEnabled=i)}},onMouseMove:function(e){var t,i="split"===this.model.get("splitType")&&this.hitMaterial(e);this._cursorPressed?this.getOutlineModel().trigger("hideOutline"):this.model.get("highlightOnHover")&&this.canDisplayOutline()&&!this._freezeHoverOutline&&(this.isOnView2D(e)||(t=i),this.model.set("hoverMaterial",t),t?this.displayOutline("displayOutlineNoFocus",t):this.getOutlineModel().trigger("hideOutline"))},_freezeOutline:function(e){void 0!==this._timerFreezer&&(window.clearTimeout(this._timerFreezer),this._timerFreezer=void 0),this._freezeHoverOutline=!0;var t=1e3*e,i=this._enableOutline.bind(this);this._timerFreezer=window.setTimeout(i,t)},_enableOutline:function(){this._freezeHoverOutline=!1},_registerHoverUV:function(e,t){var i=Wa.Z.uHoverUV.getInternalArray();if("split"===this.model.get("splitType"))if(k.Z.draw(),e&&void 0!==e._i3&&t===this.getCurrentMaterial()){var n=e._nodePath[e._nodePath.length-1].getVertexAttributeList()["TexCoord"+this.model.get("texCoord")];if(n){var r=n.getElements(),a=2*e._i1,o=2*e._i2,s=2*e._i3;i[0]=r[a]*e._r1+r[o]*e._r2+r[s]*e._r3,i[1]=r[a+1]*e._r1+r[o+1]*e._r2+r[s+1]*e._r3}else i[0]=i[1]=1e6}else i[0]=i[1]=1e6;else i[0]=i[1]=1e6},hitMaterial:function(e){if(ke.Z.isInitialized()){var t=Te.Z.PICK_GEOMETRY_SLOW,i=ke.Z.computeNearestIntersection2D(e.canvasX,e.canvasY,t),n=i&&ke.Z.getMaterialFromHit(i);return this._registerHoverUV(i,n),n&&this.model.get("autoSelectHoverMaterial")&&this.model.set("material",n.get("id")),n}},displayOutline:function(e,t){this.isTabMaterial();var i=this.getOutlineModel();i.set("durationOutline",2),i.set("durationHighlight",2),i.trigger(e,t.get("stateSet"))},onMouseWheel:function(){this.getOutlineModel().trigger("hideOutline"),this._freezeOutline(zA)},onCursorDown:function(){this._cursorPressed=!0},onCursorUp:function(){this._cursorPressed=!1,this._freezeOutline(zA)},autoSelectUV:function(){var e=this.getCurrentMaterial(),t=e.getChannels(),i=this.model.get("displayView");if(t[i]){var n=t[i].getTextureModel();n&&this.model.set("texCoord",n.get("texCoordUnit"))}else{var r=e.get("texCoordUnitList");r.length&&-1===r.indexOf(this.model.get("texCoord"))&&this.model.set("texCoord",r[0])}},onTexCoord:function(){this.updateMaterial(),this.getCurrentMaterial().getChannels().Inspector.set("selectUV",this.model.get("texCoord"))},onMaterial:function(){var e=this.model.previous("material");if(e&&this.model.getMaterialByUid(e).getChannels().Inspector.set("isSelected",!1),this.getCurrentMaterial().getChannels().Inspector.set("isSelected",!0),this.autoSelectUV(),this.updateMaterial(),this.updateVisible2D(),this.canDisplayOutline()){var t=this.model.get("focusMaterial")&&!this.model.get("autoSelectHoverMaterial")?"Focus":"NoFocus";this.displayOutline("displayOutline"+t,this.getCurrentMaterial()),this._freezeOutline(zA)}},updateVisible2D:function(){var e=this.model.get("splitType");this._camera2D.setVisible("3d"!==e&&this.model.hasContentInView2d())},updateMaterial:function(){var e=this.getCurrentMaterial(),t=this.model.get("texCoord");this._camera2D.setMaterial(e,t),"UVChecker"===this.model.get("displayView")&&e.getChannels().Inspector.setTexCoordUnit(t),k.Z.draw()},onSplitType:function(){var e=this.model.get("splitType");Wa.Z.uSplitView.setFloat("split"===e?1:0),"split"!==e&&this.getOutlineModel().trigger("hideOutline"),this._updateSplitView(),this.updateVisible2D(),k.Z.draw()},setupCheckerTexture:function(e){if(!this._checkerImageProxy){var t=this.getImageCollection();this._checkerImageProxy=t.addNewImage({url:i("eAaX"),width:1024,height:1024,id:"skfbUVChecker",name:"UVChecker",internal:!0})}var n=e.setupTextureModel({image:this._checkerImageProxy});return n.updateMultiresTexture(),n},_getDisplayedChannel:function(e,t,i){return!i.swapMicrosurface||"RoughnessPBR"!==t&&"GlossinessPBR"!==t?("Opacity"===t&&e.Opacity.get("invert")&&e.Inspector.set("invert",!0),e[t]):(e.Inspector.set("invert",!0),"RoughnessPBR"===t?e.GlossinessPBR:e.RoughnessPBR)},_getColorProfile:function(e){var t=this.getPostProcessModel().get("sssProfiles")[e.get("profile")-1],i=QA.vec3.create();return QA.vec3.add(i,t.strength,t.falloff),QA.vec3.scale(i,i,.5),i},_updateTextureTransform:function(){this.inspect.set("UVTransforms",this.channel.get("UVTransforms"))},_setDisplayChannel:function(e,t){e.setInspectorSRGB(t.getSRGB());var i=t.getName();if(t.isEffective()){var n=t.getTextureModel();if(!n){var r=1;if("SubsurfaceScattering"===i)r=1/(vi.Z.getBoxFactor("SubsurfaceScattering")*j.Z.getModelBoxWithoutDisplacement().radius());"Opacity"===i&&"additive"===t.get("type")&&(r=.5),e.setFactor(t.getFactor()*r)}if("SubsurfaceScattering"===i)e.setColor(this._getColorProfile(t));else if("ClearCoat"===i)e.setColor(t.get("tint"));else{var a=t.getColor&&t.getColor();e.setColor(a||QA.vec3.ONE)}n&&(e.setTextureModel(t.getTextureModel()),"Opacity"===i&&"alphaMask"===t.get("type")&&e.set("maskThreshold",t.get("factor"))),this._prevChannel&&this._prevChannel.off(null,this._updateTextureTransform),e.set("UVTransforms",t.get("UVTransforms")),t.on("change:UVTransforms",this._updateTextureTransform,{inspect:e,channel:t}),t.on("change:UVOffset",this._updateTextureTransform,{inspect:e,channel:t}),this._prevChannel=t}else jA[i]||e.setFactor(0)},_setUVChecker:function(e,t){this.setupCheckerTexture(e);var i=this.getCurrentMaterial()===t?this.model.get("texCoord"):t.get("texCoordUnitList")[0];e.setTexCoordUnit(i||0)},_resetChannel:function(e){return e.get("backupJSON")?e.setChannelJSON(e.get("backupJSON"),this.getImageCollection()):e.set("backupJSON",(0,mA.Z)(e.getJSON())),e},_resetState:function(){var e=this.getShadingStyleModel();e.set("type",this.model.get("referenceShadingType")),this.hasDisplayView("VertexColor")&&e.set("vertexColorEnable",!0),this.hasDisplayView("VertexAlpha")&&e.set("vertexColorUseAlpha",!0);for(var t=this.model.get("materialList"),i=this.getMaterialModel().getMaterials(),n=0;n<t.length;++n){var r=i[t[n].uid].getChannels();this._resetChannel(r.Inspector),this._resetChannel(r.Displacement),this._resetChannel(r.Opacity),this._resetChannel(r.Matcap),this._resetChannel(r.BumpMap),this._resetChannel(r.NormalMap),r.Opacity.isEffective()||r.Opacity.set("enable",!1)}},onDisplayView:function(){var e=this.model.get("displayView");if(-1!==this.model.get("availableDisplayView").indexOf(e)){this._resetState();for(var t=this.getShadingStyleModel(),i="Default"===e||"DefaultNoPostProcess"===e,n="UVChecker"===e,r="Wireframe"===e,a="VertexColor"===e,o="VertexAlpha"===e,s="VertexNormal"===e,l="Opacity"===e,u="MatcapFlat"===e,h="MatcapDetail"===e,c="Bones"===e,A="BoneWeights"===e,d=this.getMaterialModel().getMaterials(),g=this.model.get("materialList"),f=0;f<g.length;++f)if(!i&&!s){var p=g[f],m=d[p.uid],_=m.getChannels(),v=_.Inspector;v.setTextureModel(void 0);var C=_.Opacity;if(C.isEffective()&&"refraction"===C.get("type")&&C.set("type","alphaBlend"),n)this._setUVChecker(v,m);else if(r)v.setColor(WA);else if(o)C.set("enable",!1);else if(!a)if(u||h||c||A)u&&(_.BumpMap.set("enable",!1),_.NormalMap.set("enable",!1)),(c||A)&&(_.Opacity.set("enable",!0),_.Opacity.set("factor",.1),_.Opacity.set("type","additive")),_.Matcap.setChannelJSON(this._matcapJSON);else{var b=this._getDisplayedChannel(_,e,p);this._setDisplayChannel(v,b),b===_.Displacement?_.Displacement.set("enable",!1):b===C&&C.set("enable",!1)}}o?Wa.Z.uInspectorView.setInt(1):c||A?Wa.Z.uInspectorView.setInt(2):Wa.Z.uInspectorView.setInt(0),this.updateVisible2D(),this.autoSelectUV();var S=this._viewer.getRootModel();this._normalVisitor.setNormalVisibility(s,S),jn.setDebugNormal(s),this._drawBonesVisitor.setEnable(c||A,S),this._showControlBonesVisitor.setEnable(c&&!A,S),jn.setDebugSkeleton(c||A),A?this._geoColorVisitor.setSkinningDebug(S):this._geoColorVisitor.disableDebug(S),this.hasDisplayView("VertexColor")&&t.set("vertexColorEnable",a||o||i),this.hasDisplayView("VertexAlpha")&&t.set("vertexColorUseAlpha",!o&&!l),r?(this._backupWireframeEnable=t.get("wireframeEnable"),this._backupWireframeColor=t.get("wireframeColor"),t.set("wireframeColor","000000FF"),t.set("wireframeEnable",!0)):this._backupWireframeColor&&(t.set("wireframeColor",this._backupWireframeColor),t.set("wireframeEnable",this._backupWireframeEnable),this._backupWireframeColor=void 0),u||h||c||A?t.set("type","matcap"):i||s||t.set("type","inspector"),this.hasDisplayView("DefaultNoPostProcess")&&this.getPostProcessModel().set("enable","Default"===e),this.hasDisplayView("DefaultNoGround")&&this.getGroundModel().set("enable","Default"===e),k.Z.draw()}else console.error("Unknown display view : "+e)},_onViewerToCanvasRatio:function(){this._updateViewports(),k.Z.draw()},_updateViewports:function(){var e=this._viewer.getFeatures(),t=this._viewer.getCamera(),i=e.postProcess.getCamera().getViewport(),n=this._camera2D.getViewport(),r=t.getViewport(),a=r.width(),o=r.height(),s=this.getQualityModel().get("dynamicResolutionScaling"),l=Math.round(a*s[0]),u=Math.round(o*s[1]),h=this.model.get("splitType"),c="split"===h;c?(i.setViewport(0,0,l>>1,u),n.setViewport(a>>1,0,a>>1,o)):"2d"===h?(i.setViewport(0,0,1,1),n.setViewport(0,0,a,o)):(i.setViewport(0,0,l,u),n.setViewport(0,0,0,0));var A=c?.5:1;A*=this.model.get("viewerToCanvasRatio");var d=t.getProjectionMatrix();d[0]=d[5]*u/(l*A)},_updateSplitView:function(){var e=this.getQualityModel(),t=this.model.get("splitType"),i=1,n=1;"split"===t?i=.5:"2d"===t&&(i=0,n=0);var r=e.get("dynamicResolutionScaling");this._updateViewports(),this._viewer.trigger("resizeRatio",i,n,r[0],r[1])}})]},JA=n.Z.create(qA);JA.prototype.getNode=function(){return this._views[0]._nodeInspector};const YA=JA;const KA=Kn().Model.extend({defaults:{enable:(0,l.Z)().arkit}});var XA,$A,ed=A.Z.osg,td=ed.mat4.fromRotation(ed.mat4.create(),.5*Math.PI,ed.vec3.fromValues(1,0,0)),id=ed.mat4.fromRotation(ed.mat4.create(),.5*-Math.PI,ed.vec3.fromValues(1,0,0)),nd=function(){window.updateARKit=this._onARKitEvent.bind(this),this._cameraListeners=[],this._planeListeners=[]};nd.prototype={update:function(){if(!this._lastARKitData)return!0;for(var e=0;e<this._cameraListeners.length;e++)this._cameraListeners[e].onCameraChange(this._lastARKitData.camera,this._lastARKitData.projection);if(this._lastARKitData.planes.length)for(var t=0;t<this._planeListeners.length;t++)this._planeListeners[t].onPlanesChange(this._lastARKitData.planes);return!0},_onARKitEvent:function(e){this._lastARKitData=e},getCameraMatrix:function(e,t){ed.mat4.multiply(e,t,id)},getMatrixTransformFromARPlane:(XA=ed.vec3.create(),$A=ed.mat4.create(),function(e,t){ed.vec3.set(XA,t.center[0],t.center[1],t.center[2]),ed.mat4.fromTranslation(e,XA),ed.mat4.multiply(e,t.transform,e);var i=ed.vec3.set(XA,t.extent[0],1,t.extent[2]);ed.mat4.multiply(e,e,ed.mat4.fromScaling($A,i)),ed.mat4.multiply(e,td,e)}),addCameraListener:function(e){this._cameraListeners.push(e)},addPlaneListener:function(e){this._planeListeners.push(e)}};const rd=new nd;var ad=A.Z.osg,od=function(e){this._camera=e,this._prevFrame={valid:!1,position:ad.mat4.create(),direction:ad.mat4.create(),speed:-1,at:-1}};od.prototype={onCameraChange:function(e,t){return!e||!t||(rd.getCameraMatrix(this._camera.getViewMatrix(),e),ad.mat4.copy(this._camera.getProjectionMatrix(),t),!0)}};const sd=od,ld=function(e){i.e(2128).then(i.bind(i,"12xc")).then((function(t){e(t.default)}))};var ud=A.Z.osg,hd=ud.createTexturedQuadGeometry(-.5,0,0,1,0,0,0,1,0),cd=ud.vec3.fromValues(0,0,1),Ad=ud.vec3.create(),dd=ud.vec3.create(),gd=ud.mat4.create(),fd=function(e){ud.MatrixTransform.call(this),this._camera=e;var t=ud.Uniform.createFloat1(.7,"uAlpha");this._uAlpha=t.getInternalArray();var i=hd.getOrCreateStateSet();i.setRenderBinDetails(Me.Z.EDITOR_GIZMO,"RenderBin"),i.setAttributeAndModes(Ze.Z.DEPTH_LESS_NO_WRITE),i.addUniform(t),i.setAttributeAndModes(we.Z.getOrCreateShader(ic,nc,"AR-Elevation-Widget","ARElevation")),this.addChild(hd),this.addUpdateCallback(this),this.setNodeMask(0)};ud.createPrototypeNode(fd,ud.objectInherit(ud.MatrixTransform.prototype,{setVisible:function(e,t){e!==this._visible&&(t||(t=.01),this._delay=t,this._visible=e,e&&this.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._isFading=!0)},update:function(e,t){var i=t.getFrameStamp();if(this._time=i.getSimulationTime(),this._updateTransforms(),this._isFading)return this._updateFading(),!0},_updateTransforms:function(){if(this._anchorPoint){var e=this.getMatrix();ud.mat4.invert(gd,this._camera.getViewMatrix()),ud.mat4.getTranslation(Ad,gd),Ad[2]=this._anchorPoint[2],ud.mat4.lookAt(e,this._anchorPoint,Ad,cd),ud.mat4.invert(e,e),ud.mat4.setTranslation(e,this._anchorPoint);var t=ud.vec3.length(ud.vec3.subtract(Ad,Ad,this._anchorPoint));ud.mat4.scale(e,e,ud.vec3.set(dd,.01*t,this._elevation,1))}},_updateFading:function(){this._startTime||(this._startTime=this._time);var e=this._time-this._startTime;e<this._delay?this._visible?this._uAlpha[0]=e/this._delay*.7:this._uAlpha[0]=.7*(1-e/this._delay):(this._visible||this.setNodeMask(0),this._startTime=0,this._isFading=!1)},setAnchorAndElevation:function(e,t){this._anchorPoint=e,this._elevation=t}}),"osgSketchfab","ElevationWidget");const pd=fd;var md=i("2oON"),_d=i("Xr/U"),vd=i("MCYI"),Cd=new(_s())({device:"VWR",listen:!0}),bd=A.Z.osg,Sd=.35,Ed=1.5,yd=.5,Id=Ed+yd;(0,l.Z)().arkitDebug&&(Ed=200);var xd=bd.vec3.create(),Td=bd.vec3.create(),wd=bd.vec3.create(),Md=bd.vec3.create(),Rd=bd.vec3.create(),Bd=bd.vec3.create(),Nd=bd.vec3.create();var Dd={FeatureName:"ARKit",ModelType:KA,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._featureNode=new bd.MatrixTransform,this._featureNode.setName("Feature - ARKit"),this._arSceneNode=new bd.MatrixTransform,this._arSceneNode.setName("ARKit - Scene"),this._featureNode.addChild(this._arSceneNode),F.Z.getModelDisplayed().then(this.onEnable.bind(this))},initGraphNode:function(){this._elevationWidget=new pd(this._viewer.getCamera()),this._proxyNode=new bd.Node,this._proxyNode.setName("ARKit - Widget-Shadows"),this._proxyNode.setNodeMask(Te.Z.NO_SHADOW),this._widgetNode=new bd.Node,this._widgetNode.setName("ARKit - Widget");var e=this._widgetNode.getOrCreateStateSet();this._createWidgetStateSet(e);var t=bd.Uniform.createFloat(Sd,"uAlpha");e.addUniform(t),this._uAlpha=t.getInternalArray(),e.setTextureAttributeAndModes(0,ar.Z.dummyTexture,bd.StateAttribute.OVERRIDE),this._featureNode.addChild(this._proxyNode),this._proxyNode.addChild(this._widgetNode),this._shadowPlaneNode=new bd.MatrixTransform,this._shadowPlaneNode.setName("ARKit - ShadowPlane"),(e=this._proxyNode.getOrCreateStateSet()).setShaderGeneratorName("shadow-ar"),this._setCommonStateSet(e)},_setCommonStateSet:function(e){e.setRenderBinDetails(Me.Z.EXTRA,"RenderBin"),e.setAttributeAndModes(Ze.Z.CULL_DISABLE),e.setAttributeAndModes(Ze.Z.BLEND_SUBSTRACTIVE),e.setAttributeAndModes(Ze.Z.DEPTH_LESS_NO_WRITE)},_createWidgetStateSet:function(e){var t=we.Z.getOrCreateShader(_d,vd,"plane","ArPlane");return e.setAttributeAndModes(t),this._setCommonStateSet(e),e.addUniform(bd.Uniform.createInt(0,"uTextureIcon")),e.addUniform(bd.Uniform.createFloat(0,"uDisplay2D")),e.addUniform(bd.Uniform.createFloat2(bd.vec2.fromValues(1,1),"uScale")),e},enableARShadows:function(e){e?(this._proxyNode.addChild(this._shadowPlaneNode),this._proxyNode.dirtyBound()):(this._proxyNode.removeChild(this._shadowPlaneNode),this._proxyNode.dirtyBound())},_setPlaneTexture:function(e){var t=s.Z.instance.getOrCreateTexture(e.SKFB_LOGO,{internalFormat:bd.Texture.RGBA});this._widgetNode.getOrCreateStateSet().setTextureAttributeAndModes(0,t.texture)},_getOrCreatePlaneGeometry:function(){return this._planeGeom||(this._planeGeom=bd.createTexturedQuadGeometry(-.5,0,-.5,1,0,0,0,0,1),this._planeGeom.setName("PlaneGeometry")),this._planeGeom},initEvents:function(){this.model.bind("change:enable",this.onEnable,this),this.model.bind("pick",this.onPick,this),Ue.Z.initAR(this)},onEnable:function(){if(this.model.get("enable")){this._planeNodes={},this._globalTranslation=bd.vec3.create(),this._globalScale=bd.vec3.fromValues(1,1,1),this._globalRotation=bd.mat4.create(),this._startMat=bd.mat4.create(),this._startPos=bd.vec2.create(),this._curPos=bd.vec2.create(),this._elevation=0,this.initGraphNode(),Cd.on("message:arShadows",function(e){this.enableARShadows(parseInt(e.data.arShadows,10)),e.removeFromHash()}.bind(this)),F.Z.getFirstAnimation().then(function(){var e=this._viewer.getFeatures(),t=e.lighting;t.getModel().setPreset("LightFromAbove"),t.getModel().set("enable",!0);var i=e.environment;if(i.getModel().get("enable"))i.getModel().set("shadowEnable",!1);else{var n=s.Z.instance.getEnvironmentCollection();if(n.length){var r=n.at(0).get("uid");i.getModel().set("uid",r)}else i.getModel().set("uid","2fa15e0b1cee45a5b02605a288934e1b");i.getModel().set("shadowEnable",!1),i.getModel().set("enable",!0)}e.ground.getModel().set("enable",!1),this.enableARShadows(!0)}.bind(this)),Ue.Z.setInspectorInputsEnable(!0),this.initEvents(),this._viewer.getViewerOSGJS().requestContinuousUpdate(!0),ld(this._setPlaneTexture.bind(this));var e=this._viewer.getFeatures();e.background.getModel().set("enable","none"),e.postProcess.getModel().set("enable",!1),e.postProcess.getModel().set("AR",!0),e.hotspot.getWidgetNode().setNodeMask(0),e.autospin.getModel().set("enable",!1),this._featureNode.addUpdateCallback(rd),this._widgetNode.addUpdateCallback(this),this._widgetNode.addChild(this._elevationWidget),rd.addPlaneListener(this),rd.addCameraListener(new sd(this._viewer.getCamera())),this._viewer.getViewerOSGJS().requestContinuousUpdate(!0),this._inputManager=this._viewer.getInputManager(),(0,l.Z)().arkitDebug?(Cs()(".viewer").css("background","rgba(125,125,125,255)"),e.camera.getModel().set("indexManipulator",xe.FPS)):(Cs()(".viewer").css("background","rgba(0,0,0,0)"),this._inputManager.setEnable(md.Z.SCENE,!1)),this._arSceneNode.setNodeMask(0),this._viewer.getCamera().getClearColor()[3]=0,j.Z.getBoxReady().then(function(){var e=j.Z.getModelBoxWithDisplacement(),t=e.getMin()[2];this._bBoxHeight=e.getMax()[2]-t;var i=1/this._bBoxHeight;bd.vec3.set(this._globalScale,i,i,i),this._invAnchorPoint=e.center(bd.vec3.create()),this._invAnchorPoint[2]=t,bd.vec3.negate(this._invAnchorPoint,this._invAnchorPoint),(0,l.Z)().arkitDebug&&(this._viewer.getFeaturesManager().focusOnTargetAndEye(bd.vec3.fromValues(0,0,0),bd.vec3.fromValues(5,5,2),.1),this.onPlanesChange([{uid:"123",transform:bd.mat4.IDENTITY,center:bd.vec3.ZERO,extent:bd.vec3.fromValues(10,1,10)}]));var n=e.radius()*i;this._shadowPlaneGeom=bd.createTexturedQuadGeometry(-n,-n,0,2*n,0,0,0,2*n,0),this._shadowPlaneNode.addChild(this._shadowPlaneGeom),this._shadowPlaneNode.dirtyBound()}.bind(this))}},getFeatureNode:function(){return this._featureNode},getWidgetNode:function(){return this._widgetNode},getArSceneNode:function(){return this._arSceneNode},update:function(e,t){var i=t.getFrameStamp();if(this._time=i.getSimulationTime(),this._modelPlaced){var n=this._time-this._hitTime;return n<yd&&(this._uAlpha[0]=n/yd*Sd),n>Ed&&n<Id&&(this._uAlpha[0]=(1-(n-Ed)/yd)*Sd),!0}},onPick:function(e){var t=ke.Z.computeNearestIntersection2D(e[0],e[1],Te.Z.PICK_GEOMETRY_FAST,this._widgetNode);this._hitTime=this._time,t&&(this._modelPlaced=!0,bd.vec3.transformMat4(this._globalTranslation,t._localIntersectionPoint,bd.computeLocalToWorld(t._nodePath.slice(1))),this._arSceneNode.setNodeMask(-1),this._updateSceneTransforms(),window.location.hash="buzz",window.setTimeout((function(){window.location.hash=""}),200))},_updateSceneTransforms:function(){var e=this._arSceneNode.getMatrix();bd.mat4.fromTranslation(e,this._globalTranslation),bd.mat4.multiply(e,e,this._globalRotation),bd.mat4.scale(e,e,this._globalScale),bd.mat4.translate(e,e,this._invAnchorPoint),bd.mat4.translate(e,e,bd.vec3.set(xd,0,0,this._elevation));var t=this._elevation>=0?this._bBoxHeight:0;this._elevationWidget.setAnchorAndElevation(this._globalTranslation,(this._elevation+t)*this._globalScale[0]);var i=this._shadowPlaneNode.getMatrix();bd.mat4.fromTranslation(i,this._globalTranslation);for(var n=this._viewer.getFeatures().lighting.getModel().get("lights"),r=0;r<n.length;r++){var a=n[r];a.isCastingShadows()&&a.dirty()}this._arSceneNode.dirtyBound(),this._shadowPlaneNode.dirtyBound()},_getPlaneNode:function(e){var t=this._planeNodes[e];if(!t){this._hitTime=this._time,(t=new bd.MatrixTransform).addChild(this._getOrCreatePlaneGeometry());var i=t.getOrCreateStateSet(),n=bd.Uniform.createFloat2(bd.vec2.fromValues(1,1),"uScale");i.addUniform(n),t._uScale=n.getInternalArray(),this._planeNodes[e]=t}return t},onPlanesChange:function(e){for(var t in this._planeNodes){var i=this._planeNodes[t];i.updated=!1}for(var n,r=0;r<e.length;r++){var a=e[r];n=this._getPlaneNode(a.uid),rd.getMatrixTransformFromARPlane(n.getMatrix(),a),n._uScale[0]=a.extent[0],n._uScale[1]=a.extent[2],0===n.getParents().length&&this._widgetNode.addChild(n),n.updated=!0,n.dirtyBound()}for(t in this._planeNodes)!(i=this._planeNodes[t]).updated&&n.getParents().length&&this._widgetNode.removeChild(i);this._widgetNode.dirtyBound()},startMotion:function(e){this._inputManager.setEnable(md.Z.MANIPULATORS,!1),bd.vec2.set(this._startPos,e.canvasX,e.canvasY)},endMotion:function(){this._inputManager.setEnable(md.Z.MANIPULATORS,!0),this.endElevate(),this.endRotate(),this.endScale()},motion:function(e){if(this._rotating)this.rotate(e);else if(this._scaling){bd.vec2.set(this._curPos,e.canvasX,e.canvasY);var t=this._viewer.getCanvas().height,i=1-(this._curPos[1]-this._startPos[1])/t;e.scale=i,this.scale(e)}else this._elevating&&this.elevate(e)},startRotate:function(e){this._rotating=!0,bd.vec2.set(this._startPos,e.canvasX,e.canvasY),bd.mat4.copy(this._startMat,this._globalRotation)},endRotate:function(){this._rotating=!1},rotate:function(e){this._rotating||this.startRotate(e),bd.vec2.set(this._curPos,e.canvasX,e.canvasY);var t=this._viewer.getCanvas().width,i=(this._curPos[0]-this._startPos[0])/t*Math.PI*2;bd.mat4.rotateZ(this._globalRotation,this._startMat,i),this._updateSceneTransforms()},startScale:function(){this._scaling=!0,this._initScale=this._globalScale[0]},endScale:function(){this._scaling=!1},scale:function(e){var t=Math.max(e.scale*this._initScale,1e-8);bd.vec3.set(this._globalScale,t,t,t),this._updateSceneTransforms()},startElevate:function(e){this._elevating=!0,this._initElevation=this._elevation,bd.vec2.set(this._startPos,e.glX,e.glY),this._startWorldElevation=this._getElevationFromScreenCoord(this._startPos),this._elevationWidget.setVisible(!0,yd),this._hitTime=this._time},endElevate:function(){this._elevating=!1,this._elevationWidget.setVisible(!1,yd)},elevate:function(e){this._elevating||this.startElevate(e),bd.vec2.set(this._curPos,e.glX,e.glY);var t=this._getElevationFromScreenCoord(this._curPos)-this._startWorldElevation;this._elevation=this._initElevation+t,this._elevation<0&&(this._elevation=0),this._updateSceneTransforms()},_getElevationFromScreenCoord:function(e){bd.vec2.copy(wd,e),wd[2]=0,ke.Z.getWorldPositionFromScreenPoint(wd,Md),wd[2]=1,ke.Z.getWorldPositionFromScreenPoint(wd,Rd),bd.vec3.sub(Nd,Rd,Md),bd.vec3.normalize(Nd,Nd),bd.mat4.getLookAt(Bd,xd,Td,this._viewer.getCamera().getViewMatrix()),bd.vec3.subtract(Bd,Bd,xd),Bd[2]=0,bd.vec3.normalize(Bd,Bd),bd.mat4.getTranslation(xd,this._featureNode.getMatrix());var t=bd.vec3.length(this._globalTranslation),i=bd.vec3.dot(Bd,Nd),n=-(bd.vec3.dot(Bd,Md)+t)/i;return 0===i&&(n=0),bd.vec3.scaleAndAdd(xd,Md,Nd,n),xd[2]/this._globalScale[0]}})]},Pd=n.Z.create(Dd);Pd.prototype.getNodeIn=function(){return this._views[0].getFeatureNode()},Pd.prototype.getNodeOut=function(){return this._views[0].getArSceneNode()},Pd.prototype.getWidgetNode=function(){return this._views[0].getWidgetNode()};const Fd=Pd;var Od=i("C+0K");const Ld=a.Z.extend({_trashbin:[],defaults:{progress:0},getModelOptionPath:function(){return"ground"},getName:function(){return"Ground"},init:function(e){var t=e.getModel().get("options");this._globalModel=e.getModel(),this.setJSON(t.ground);var i=this.get("aoTextureUid"),n=!1;if(i){var r=s.Z.instance.getTextureCollection().get(i);r&&(r.set("internal",!0),n=!0)}"BakedAO"!==this.get("shadowMode")||n||(this.set("enable",!1),i?(console.log("Ground: Couldn't load texture "+i+" for model "+e._model.id),Od.Z.client.captureMessage("Ground: Couldn't load texture "+i+" for model "+e._model.id)):Od.Z.client.captureMessage("Ground: Model "+e._model.id+" is in BakedAO mode but doesn't have an aoTextureUid"))},_adaptJSON:function(e){if(void 0===e.scale){e.scale=0,e.position=[0,0,0];var t=1.5,i=0;void 0!==e.size&&(t=e.size,i=e.height),j.Z.getBoxReady().then(this._updateTransforms.bind(this,i,t,!0))}},_updateTransforms:function(e,t,i){var n=j.Z.getModelBoxWithDisplacement();"BakedAO"===this.get("shadowMode")&&(t=1.5);var r=n.radius()*t;this.set("scale",r),0===e&&(e=1e-4);var a=this.get("position");n.center(a);var o=n.getMax()[2]-n.getMin()[2];a[2]=n.getMin()[2]+o*e,i?this.trigger("transformInit"):this.trigger("transformChanged")},startRender:function(){this._globalModel.trigger("status:pending")},stopRender:function(){this._globalModel.trigger("status:loaded")}});var kd=i("rMHa"),Zd=i("EJ86"),Ud=i("OT+x"),Vd=i("Q7lG"),Qd=A.Z.osgShader.shaderProcessor,Gd=A.Z.osgUtil,Hd=A.Z.osg,zd=function(e,t,i,n,r){this._textureSize=e,this._nodeFeature=t,this._viewer=i,this._nbFrames=0,this._targetNode=n,this._nbSamples=r||300,this._progress=0,this._samplingRange=1,this._validRender=!1,this._renderedCanvas=document.createElement("canvas"),this._init()};zd.prototype={_init:function(){this.initComposer(),this.initShadowCamera(),this.initLightMapCamera(),this._nodeFeature.addChild(this._shadowCamera),this._nodeFeature.addChild(this._lightMapCamera),this._nodeFeature.addChild(this._composer),this._nodeFeature.addUpdateCallback(this)},getFinalTexture:function(){return this._render?this._currentlightMap:this._composer.getInternalTexture("FinalTexture1")},requestRender:function(){this._render&&this.stopRender(),this._shadowCamera.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._lightMapCamera.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._render=!0,k.Z.draw()},onFrameRendered:function(e){this._frameCallback=e},stopRender:function(){this._render&&(this._nbFrames=0,this._render=!1,this._progress=0,this._shadowCamera.setNodeMask(0),this._lightMapCamera.setNodeMask(0),this._composer.setNodeMask(0))},update:function(e,t){if(!this._render||!F.Z.getModelDisplayed().isFulfilled())return!0;var i=t.getFrameStamp();return this._estimatedTime=i.getDeltaTime()*this._nbSamples,this._nbFrames>this._nbSamples&&(this._shadowCamera.setNodeMask(0),this._lightMapCamera.setNodeMask(0),this._composer.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._getLastComposerCamera().setFinalDrawCallback(function(e){this._renderedCanvas=(0,kd.i)(e,this._textureSize,this._textureSize,this._renderedCanvas)}.bind(this))),this._nbFrames>this._nbSamples+1?(this._validRender=!0,this.stopRender(),this._progress=100,this._frameCallback&&this._frameCallback(!0),this._getLastComposerCamera().setFinalDrawCallback(void 0),!0):(this._nbFrames++,this._uNumFrames.getInternalArray()[0]=this._nbFrames,this.updateCameras(),k.Z.draw(),this.swapLightMaps(),this._frameCallback&&this._frameCallback(),this._progress=this._nbFrames/this._nbSamples*100,!0)},getRenderedCanvas:function(){return this._renderedCanvas},isValidRender:function(){return this._validRender},getProgress:function(){return this._progress},getEstimatedTime:function(){return this._estimatedTime},setNbSamples:function(e){this._nbSamples=e},initComposer:function(){this._composer=new Gd.ComposerPostProcess,this._composer.setOffscreen(!0),this._composer.setScreenSize(this._textureSize,this._textureSize),this._composer.setNodeMask(0),this._composer.addInternalTexture({name:"LightMap1",immuable:!0,srgb:!1,reusable:!1}),this._composer.addInternalTexture({name:"FinalTexture1",immuable:!0,srgb:!1,reusable:!1}),this._composer.setInputTexture("LightMap1"),Qd.addShaders({"blurBakedAo.glsl":Zd});var e=[],t=Hd.Uniform.createFloat(1/this._textureSize,"uInvTextureSize");e.push({func:{name:"adaptativeBoxBlur",file:"blurBakedAo.glsl"},uniforms:[t],textures:{name:"LightMap1",uniformName:"TextureBlur"},out:{name:"FinalTexture1",filter:"linear"}}),this._composer.build(e);for(var i=0;i<this._composer.getCameras().length;i++){this._composer.getCameras()[i].setRenderOrder(Hd.Camera.PRE_RENDER,1)}},_getLastComposerCamera:function(){var e=this._composer.getCameras();return e[e.length-1]},initShadowCamera:function(){this._shadowCamera=new Hd.Camera,this._shadowCamera.setName("ShadowCam"),this._shadowCamera.setClearColor(Hd.vec4.fromValues(1,1,1,1)),this._shadowCamera.setRenderOrder(Hd.Camera.PRE_RENDER,0),this._shadowCamera.setReferenceFrame(Hd.Transform.ABSOLUTE_RF),this._shadowCamera.setViewport(new Hd.Viewport(0,0,this._textureSize,this._textureSize)),this._shadowCamera.setNodeMask(0),this._shadowCamera.setComputeNearFar(!1);var e=new Hd.Texture;e.setTextureSize(this._textureSize,this._textureSize),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),this._shadowCamera.attachTexture(Hd.FrameBufferObject.COLOR_ATTACHMENT0,e),this._shadowCamera.attachRenderBuffer(Hd.FrameBufferObject.DEPTH_ATTACHMENT,Hd.FrameBufferObject.DEPTH_COMPONENT16);var t=new Hd.MatrixTransform;t.setMatrix(this._viewer.getFeatures().orientation.getModel().get("matrix")),t.addChild(this._viewer.getRootModel()),this._shadowCamera.addChild(t);var i=this._shadowCamera.getOrCreateStateSet();i.setTextureAttributeAndModes(0,e,Hd.StateAttribute.ON),i.setShaderGeneratorName("shadow-ao-bake"),i.setAttributeAndModes(Ze.Z.DEPTH_LESS_WRITE,Hd.StateAttribute.ON|Hd.StateAttribute.OVERRIDE|Hd.StateAttribute.PROTECTED),this._shadowMap=e},initLightMapCamera:function(){this._lightMapCamera=new Hd.Camera,this._lightMapCamera.setName("LightMapCam"),this._lightMapCamera.setClearColor(Hd.vec4.fromValues(1,1,1,1)),this._lightMapCamera.setRenderOrder(Hd.Camera.PRE_RENDER,1),this._lightMapCamera.setReferenceFrame(Hd.Transform.ABSOLUTE_RF),this._lightMapCamera.setViewport(new Hd.Viewport(0,0,this._textureSize,this._textureSize)),this._lightMapCamera.setNodeMask(0),this._lightMapCamera.setComputeNearFar(!1),this._lightMap1=this._composer.getInternalTexture("LightMap1"),this._lightMap1.setMinFilter("LINEAR"),this._lightMap1.setMagFilter("LINEAR"),this._lightMapCamera.attachTexture(Hd.FrameBufferObject.COLOR_ATTACHMENT0,this._lightMap1),this._lightMap2=new Hd.Texture,this._lightMap2.setTextureSize(this._textureSize,this._textureSize),this._lightMap2.setMinFilter("LINEAR"),this._lightMap2.setMagFilter("LINEAR"),this._lightMapCamera.addChild(this._targetNode);var e=this._lightMapCamera.getOrCreateStateSet();e.setAttributeAndModes(we.Z.getOrCreateShader(Ud,Vd,"ground-bakeao","GroundBakeAo"),Hd.StateAttribute.ON|Hd.StateAttribute.OVERRIDE|Hd.StateAttribute.PROTECTED),e.setTextureAttributeAndModes(1,this._shadowMap,Hd.StateAttribute.ON),e.addUniform(Hd.Uniform.createInt(1,"uShadowMap")),e.setTextureAttributeAndModes(2,ar.Z.dummyTexture,Hd.StateAttribute.ON),e.addUniform(Hd.Uniform.createInt(2,"uPrevLightMap")),this._uNumFrames=Hd.Uniform.createFloat(0,"uNumFrames"),e.addUniform(this._uNumFrames),this._uTextureSize=Hd.Uniform.createFloat(this._textureSize,"uTextureSize"),e.addUniform(this._uTextureSize),this._currentlightMap=this._lightMap2},swapLightMaps:function(){var e=this._lightMapCamera.getOrCreateStateSet();this._currentlightMap&&e.setTextureAttributeAndModes(2,this._currentlightMap,Hd.StateAttribute.ON),this._currentlightMap===this._lightMap1?this._currentlightMap=this._lightMap2:this._currentlightMap=this._lightMap1,e.setTextureAttributeAndModes(0,this._currentlightMap,Hd.StateAttribute.ON),this._lightMapCamera.attachTexture(Hd.FrameBufferObject.COLOR_ATTACHMENT0,this._currentlightMap)},setSceneData:function(e,t){this._bounds=e,this._transform=t},updateCameras:function(){var e=Hd.mat4.create(),t=Hd.vec3.create(),i=Hd.vec3.create();return function(){var n=this._bounds.radius();Hd.mat4.getTranslation(t,this._transform.getMatrix()),Hd.mat4.copy(e,Hd.mat4.IDENTITY),this.getRandomPoint(i),Hd.vec3.scale(i,i,n),Hd.vec3.add(i,t,i),Hd.mat4.lookAt(e,i,t,[0,0,1]);var r=2*n,a=r/1e3;Hd.mat4.ortho(this._shadowCamera.getProjectionMatrix(),-n,n,-n,n,a,r),Hd.mat4.copy(this._shadowCamera.getViewMatrix(),e),Hd.mat4.copy(this._lightMapCamera.getViewMatrix(),this._shadowCamera.getViewMatrix()),Hd.mat4.copy(this._lightMapCamera.getProjectionMatrix(),this._shadowCamera.getProjectionMatrix())}}(),getRandomPoint:function(e){var t=Qr.Z.hemisphereSampleUniform(this._nbFrames,this._nbSamples*(1/this._samplingRange));Hd.vec3.set(e,t[0],t[1],t[2])}};const Wd=zd;var jd=A.Z.osg,qd="BakedAO",Jd=function(e,t){jd.StateAttribute.call(this),this._enable=t||!1,this._useBakedAo=e===qd,this._displayPlane=!1};Jd.prototype=jd.objectLibraryClass(jd.objectInherit(jd.StateAttribute.prototype,{attributeType:"GroundStateAttribute",cloneType:function(){return new Jd(!0)},setEnabled:function(e){this._enable=e},isEnabled:function(){return this._enable},isUseBakedAo:function(){return this._useBakedAo},setDisplayPlane:function(e){this._displayPlane=e},isDisplayPlane:function(){return this._displayPlane},getHash:function(){return"Ground"+this._useBakedAo+this._displayPlane}}),"osgSketchfab","GroundStateAttribute"),jd.setTypeID(Jd);var Yd={FeatureName:"ground",ModelType:Ld,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments);var e=this.model;this.listenTo(e,"change:enable",this.onEnableChanged),this._resourceDefer=new Ct.Z,this.options.context.getScene().addResourcePromise(this._resourceDefer.promise),this._nodeFeature=new jd.Node,this._nodeFeature.setName("Feature - Ground"),this._transform=new jd.MatrixTransform,this._transform.setName("Ground - Transform"),this._transform.setNodeMask(Te.Z.NO_PICK_NO_SHADOW),this._geometry=jd.createTexturedQuadGeometry(-1,-1,0,2,0,0,0,2,0),this._geometry.setName("Ground - Geometry"),this._geometry.setNodeMask(0),this._transform.addChild(this._geometry),this._viewer=this.options.context.getViewer(),this._needBake=!1;var t=this._transform.getOrCreateStateSet();this._uFade=jd.Uniform.createFloat("uGroundFade"),this._uOpacity=jd.Uniform.createFloat("uGroundOpacity");var i=jd.Uniform.createFloat(1,"uWidgetFade");t.addUniform(this._uFade),t.addUniform(this._uOpacity),t.addUniform(i),this._uWidgetFade=i.getInternalArray(),this._widgetFadeDirection=1,e.get("enable")&&this.onEnableChanged(),this.model.set("lastRenderHeight",this.model.get("height")),this.model.set("lastRenderSamplingRange",this.model.get("samplingRange")),this._nodeFeature.addUpdateCallback(this),e.get("enable")&&e.get("shadowMode")===qd||this._resourceDefer.resolve()},registerEvents:function(){this.listenTo(this.model,"change:opacity",this.onOpacityChanged),this.listenTo(this.model,"change:fade",this.onFadeChanged),this.listenTo(this.model,"transformChanged",this._onTransformChanged),this.listenTo(this.model,"transformInit",this._onPositionOrScaleChange),this.listenTo(this.model,"change:shadowMode",this.onShadowModeChanged),this.listenTo(this.model,"change:samplingRange",this.onSamplingRangeChanged),this.listenTo(this.model,"cancelRequested",this.cancelRender)},unRegisterEvents:function(){this.stopListening(this.model),this.listenTo(this.model,"change:enable",this.onEnableChanged)},initStateSet:function(){var e=this._geometry.getOrCreateStateSet();e.setName("Ground"),e.setShaderGeneratorName("ground"),e.setRenderBinDetails(Me.Z.TRANSPARENT_CUSTOM_EARLYZ,"RenderBin"),e.setAttribute(Ze.Z.CULL_BACK),this._initialized=!0},onShadowModeChanged:function(){var e=this._geometry.getOrCreateStateSet(),t=this.model.get("shadowMode"),i=t===qd;if(this._geometry.setNodeMask(0),this._groundStateAttrib=new Jd(t,!0),e.setAttributeAndModes(this._groundStateAttrib),this.cleanUpTexture(this._lightMapper,e),i){var n=this.model.get("aoTextureUid");n&&!this._needBake?this._setupBakedAoTexture(n):this._setupLightMapper()}else this._geometry.setNodeMask(-1),k.Z.draw();this._onPositionOrScaleChange()},_setupBakedAoTexture:function(e){var t=s.Z.instance.getOrCreateMultiresTexture(e,{minFilter:jd.Texture.LINEAR,magFilter:jd.Texture.LINEAR,wrapS:jd.Texture.CLAMP_TO_EDGE,wrapT:jd.Texture.CLAMP_TO_EDGE,internalFormat:jd.Texture.RGBA}).resource;t.setForceUpload(!0),t.isTextureNull()&&(t.setTextureSize(1,1),t.setImage(new Uint8Array([255,255,255,255])));var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,t,jd.StateAttribute.ON|jd.StateAttribute.OVERRIDE|jd.StateAttribute.PROTECTED),i.addUniform(jd.Uniform.createInt(0,"uTexture")),this._geometry.setNodeMask(-1),(0,l.Z)().preload?t.getImageMaxSupported().promise.then(function(){t.setImageMaxSupported(),this._resourceDefer.resolve()}.bind(this)):t.setImageSmallest().promise.then(function(){this._resourceDefer.resolve(),t.setImageMaxSupported()}.bind(this)),this.model.set("lastRenderHeight",this.model.get("height")),this.model.set("lastRenderSamplingRange",this.model.get("samplingRange"))},_setupLightMapper:function(){var e=this._geometry.getOrCreateStateSet();if(this._lightMapper)return this._lightMapper.isValidRender()?this._restoreTexture():this._needBake=!0,void(this._needBake&&this._bake());this._lightMapper=new Wd(512,this._nodeFeature,this._viewer,this._transform,600),e.addUniform(jd.Uniform.createInt(0,"uTexture")),this._lightMapper.onFrameRendered(function(t){if(e.setTextureAttributeAndModes(0,this._lightMapper.getFinalTexture(),jd.StateAttribute.ON),this._geometry.setNodeMask(-1),this.model.set("progress",this._lightMapper.getProgress()),this.model.set("estimatedTime",this._lightMapper.getEstimatedTime()),t){if(this.model.stopRender(),!this.model.get("dirty")){this.model.set("dirty",!0);var i=this.model.get("aoTextureUid");i&&this.model._trashbin.push(new Io.Z({uid:i})),this.model.set("aoTextureUid",void 0)}this.model.set("imageCanvas",this._lightMapper.getRenderedCanvas()),this.model.set("lastRenderHeight",this.model.get("height")),this.model.set("lastRenderSamplingRange",this.model.get("samplingRange"))}}.bind(this)),j.Z.getBoxReady().then(function(){var e=j.Z.getModelBoxWithDisplacement();this._lightMapper.setSceneData(e,this._transform),this._lightMapper._samplingRange=this.model.get("samplingRange"),this._bake(100)}.bind(this))},_restoreTexture:function(){var e=new jd.Texture;e.setImage(this.model.get("imageCanvas")),this._geometry.getOrCreateStateSet().setTextureAttributeAndModes(0,e,jd.StateAttribute.ON),this._geometry.setNodeMask(-1),k.Z.draw()},cancelRender:function(){if(this._lightMapper)if(this._lightMapper.stopRender(),this.model.stopRender(),this._holdBake=!0,this.model.set("height",this.model.get("lastRenderHeight")),this.model.set("samplingRange",this.model.get("lastRenderSamplingRange")),this._holdBake=!1,this.model.set("progress",100),this.model.set("estimatedTime",0),this._lightMapper.isValidRender())this._restoreTexture();else{var e=this.model.get("aoTextureUid");e?(this._setupBakedAoTexture(e),this.model.set("dirty",!1),this.model._trashbin.length=0):Ci.Z.get("mask")&Ci.Z.LIT?this.model.set("shadowMode","ShadowCatcher"):this.model.set("enable",!1)}},onSamplingRangeChanged:function(){this._lightMapper||this._setupLightMapper(),this._lightMapper._samplingRange=this.model.get("samplingRange"),this._bake()},cleanUpTexture:function(e,t){e&&t.setTextureAttributeAndModes(0,e.getFinalTexture(),jd.StateAttribute.OFF)},getNodeGround:function(){return this._nodeFeature},onOpacityChanged:function(){this._uOpacity.setFloat(Math.max(0,this.model.get("opacity"))),k.Z.draw()},onFadeChanged:function(){this._uFade.setFloat(this.model.get("fade")),k.Z.draw()},onEnableChanged:function(){var e=this._geometry.getOrCreateStateSet();this._nodeFeature.removeChild(this._transform),jn.registerStateSetIsTransparent(e,!1),this.model.get("enable")?(this.registerEvents(),this._onPositionOrScaleChange(),this._nodeFeature.addChild(this._transform),this._initialized||this.initStateSet(),this.onShadowModeChanged(),this.onFadeChanged(),this.onOpacityChanged(),jn.registerStateSetIsTransparent(e,!0),this._lightMapper&&!this._lightMapper.isValidRender()&&this._bake(1)):this.unRegisterEvents(),k.Z.draw()},_onTransformChanged:function(){this._lightMapper||this.model.get("shadowMode")!==qd||this._setupLightMapper(),this._onPositionOrScaleChange(),this._needBake=!0,this.model.get("shadowMode")===qd&&this._bake(),this._displayPlane(),k.Z.draw()},_displayPlane:function(){this.model.get("enable")&&(0,o.Z)()&&(this._groundStateAttrib.setDisplayPlane(!0),this._geometry.getOrCreateStateSet().setAttribute(Ze.Z.CULL_DISABLE),this._widgetFadeDirection=-1,this._schedulePlane&&clearTimeout(this._schedulePlane),this._schedulePlane=setTimeout(function(){this._widgetFadeDirection=1,k.Z.draw()}.bind(this),1e3))},update:function(e,t){if(!this._groundStateAttrib||!this._groundStateAttrib.isDisplayPlane())return!0;var i=t.getFrameStamp();(this._uWidgetFade[0]+=i.getDeltaTime()*this._widgetFadeDirection,this._uWidgetFade[0]>1)&&(this._uWidgetFade[0]=1,this._groundStateAttrib.setDisplayPlane(!1),this._geometry.getOrCreateStateSet().setAttribute(Ze.Z.CULL_BACK));return this._uWidgetFade[0]<.8&&(this._uWidgetFade[0]=.8),k.Z.draw(),!0},_onPositionOrScaleChange:function(){var e=jd.vec3.create();return function(){var t=this.model,i=this._transform.getMatrix(),n=t.get("scale");jd.vec3.set(e,n,n,n),jd.mat4.fromScaling(i,e);var r=this.model.get("position");i[12]=r[0],i[13]=r[1],i[14]=r[2],this._transform.dirtyBound()}}(),_bake:function(e){e=e||1e3,this._holdBake||(this.model.startRender(),this._schedule&&clearTimeout(this._schedule),this._schedule=setTimeout(this._lightMapper.requestRender.bind(this._lightMapper),e),this._needBake=!1)}})]},Kd=n.Z.create(Yd);Kd.prototype.getNode=function(){return this._views[0].getNodeGround()};const Xd=Kd;const $d=Kn().Model.extend({defaults:{enable:(0,l.Z)().decals,defaultScale:[1,1,1],decals:{},decalGeometries:{}}});var eg=i("wVsd"),tg=i("QrwD"),ig=function(e){tg.Z.call(this),this._enable=!e,this._discardOutOfTextureBoundsPixels=!0,this._polygonOffset=!0,this._computeFragmentTangents=!1,this._dirtyHash=!0,this._hash=""};xA.Z.createPrototypeStateAttribute(ig,xA.Z.objectInherit(tg.Z.prototype,{attributeType:"Decals",cloneType:function(){return new ig(!0)},setEnabled:function(e){this._enable=e,this._dirtyHash=!0},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._discardOutOfTextureBoundsPixels?"1":"0")},isDiscardOutOfTextureBoundPixels:function(){return this._discardOutOfTextureBoundsPixels},setComputeFragmentTangents:function(e){this._computeFragmentTangents=e},isComputeFragmentTangents:function(){return this._computeFragmentTangents},hasPolygonOffset(){return this._polygonOffset},apply:function(){this._enable}}),"osg","DecalsAttribute");const ng=ig;var rg,ag,og,sg,lg,ug,hg=A.Z.osg;A.Z.osgUtil,A.Z.InputGroups;var cg={FeatureName:"Decals",ModelType:$d,ViewListType:[O.Z.extend({initialize:function(){O.Z.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._model=this.options.model,F.Z.getModelDisplayed().then(this.onEnable.bind(this))},onEnable:function(){(0,l.Z)().debugDecals&&(Ue.Z.initDecals(this),console.log("decals debug enabled"))},onClick:function(e){this.createDecalFromPick(ke.Z.pickNearestSurface(e))},createDecalFromPick(e,t){if(e){if(t||(t={}),!t.scale){var i=.05*j.Z.getModelBoxWithDisplacement().radius();t.scale=hg.vec3.fromValues(i,i,i)}var n=hg.vec3.create(),r=hg.vec3.create();return ke.Z.getScenePositionFromHit(e,n,r),t.include=[e._drawable],t.nodePath=e._nodePath,this.createDecal(n,r,t.scale,t)}},createDecalFromData:function(e){var t=this._viewer.getFeaturesManager().getRootModel(),i=hg.vec3.fromValues(e.position[0],e.position[1],e.position[2]),n=hg.vec3.copy(hg.vec3.create(),i),r=hg.vec3.fromValues(e.normal[0],e.normal[1],e.normal[2]);hg.vec3.scale(r,r,e.scale[2]),hg.vec3.add(i,i,r),hg.vec3.sub(n,n,r);var a=ke.Z.computeNearestIntersection3D(i,n,Te.Z.PICK_GEOMETRY_SLOW,t);return this.createDecalFromPick(a,e)},createDecal:function(){var e=hg.vec3.fromValues(0,0,1),t=hg.mat4.create(),i=hg.mat4.create(),n=hg.vec3.create(),r=hg.vec3.create(),a=hg.mat4.create(),o=hg.mat4.create();return function(s,u,h,c){if(Math.abs(hg.vec3.dot(u,e)-1)<1e-6&&hg.vec3.set(e,0,1,0),hg.mat4.lookAtDirection(t,n,u,e),hg.mat4.ortho(i,-h[0],h[0],h[1],-h[1],h[2],-h[2]),c.rotation){var A=c.rotation*Math.PI/180;i=hg.mat4.multiply(i,i,hg.mat4.fromZRotation(a,A))}hg.mat4.multiply(i,i,t),i=hg.mat4.multiply(i,i,hg.mat4.fromTranslation(a,hg.vec3.negate(r,s))),hg.mat4.identity(o),hg.computeLocalToWorld(c.nodePath,!0,o);var d=c.include[0],g=this.makeDecalPatch(d,i,o),f=this._model.get("decals"),p=Object.keys(f).length;g.setName("Sketchfab_Internal_Decal_"+p),d.getParents()[0].addChild(g);var m,_=c.materialID,v=this._viewer.getFeatures().material.getModel();_||(_=(m=v.makeMaterial({name:g.getName()+"_Material",channels:{AlbedoPBR:{color:[0,1,0]}}})).get("id")),m||(m=v.get(_));var C=new ng(!1);if(C.setComputeFragmentTangents(!0),c.useBaseNormalMap){C.setComputeFragmentTangents(!1);var b=m.getChannels().NormalMap.get("texture");b&&b.set("texCoordUnit",1)}m.getStateSet().setAttribute(C),v.assignMaterial(g,_),(0,l.Z)().zz&&g.accept(new eg.Z);var S={id:p,position:s,normal:u,scale:h,materialID:_};return f[p]=S,this._model.get("decalGeometries")[p]=g,k.Z.draw(),S}}(),destroyDecal:function(e,t){var i=this._model.get("decals"),n=i[e];if(!n)throw"Couldn't find decal with id "+e;var r=this._model.get("decalGeometries"),a=r[e];(a.getParents()[0].removeChild(a),t&&t.deleteMaterial)&&this._viewer.getFeatures().material.getModel().destroyMaterial(n.materialID);delete i[e],delete r[e],k.Z.draw()},findUvs:function(e){for(const t in e)if(t.startsWith("TexCoord"))return e[t]},makeDecalPatch:(sg={min:hg.vec3.fromValues(-1,-1,-1),max:hg.vec3.fromValues(1,1,1)},lg=[hg.vec3.create(),hg.vec3.create(),hg.vec3.create()],ug=hg.mat4.create(),function(e,t,i){hg.mat4.multiply(ug,t,i);for(var n,r,a=e.getPrimitives()[0].indices,o=e.getAttributes().Vertex,s=e.getAttributes().Normal,l=e.getAttributes().Tangent,u=this.findUvs(e.getAttributes()),h=[],c=[],A=[],d=[],g=[],f=[],p=0,m=e.getPrimitives(),_=0;_<m.length;_++)for(var v=m[_],C=v.mode===hg.primitiveSet.TRIANGLES?3:1,b=(a=v.indices,0);b<a._numItems;b+=C){for(var S=0;S<3;S++)n=lg[S],r=3*a.getElements()[b+S],hg.vec3.set(n,o.getElements()[r],o.getElements()[r+1],o.getElements()[r+2]),n=hg.vec3.transformMat4(n,n,ug);if(this.intersectsTriangleAABB(lg[0],lg[1],lg[2],sg))for(var E=0;E<3;E++){n=lg[E],g.push(.5*(n[0]+1)),g.push(.5*(n[1]+1));var y=2*(r=a.getElements()[b+E]),I=3*r,x=4*r;c.push(o.getElements()[I]),c.push(o.getElements()[I+1]),c.push(o.getElements()[I+2]),A.push(s.getElements()[I]),A.push(s.getElements()[I+1]),A.push(s.getElements()[I+2]),u&&(f.push(u.getElements()[y]),f.push(u.getElements()[y+1])),l&&(x=4*r,d.push(l.getElements()[x]),d.push(l.getElements()[x+1]),d.push(l.getElements()[x+2]),d.push(l.getElements()[x+3])),h.push(p),p++}}var T=new hg.Geometry;return T.getAttributes().Vertex=new hg.BufferArray(hg.BufferArray.ARRAY_BUFFER,new Float32Array(c),3),T.getAttributes().Normal=new hg.BufferArray(hg.BufferArray.ARRAY_BUFFER,new Float32Array(A),3),l&&(T.getAttributes().Tangent=new hg.BufferArray(hg.BufferArray.ARRAY_BUFFER,new Float32Array(d),4)),T.getAttributes().TexCoord0=new hg.BufferArray(hg.BufferArray.ARRAY_BUFFER,new Float32Array(g),2),u&&(T.getAttributes().TexCoord1=new hg.BufferArray(hg.BufferArray.ARRAY_BUFFER,new Float32Array(f),2)),T.getPrimitives().push(new hg.DrawElements(hg.primitiveSet.TRIANGLES,new hg.BufferArray(hg.BufferArray.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),1))),T}),getWorldHitFromTexCoord:function(){var e=[hg.vec2.create(),hg.vec2.create(),hg.vec2.create()],t=[hg.vec3.create(),hg.vec3.create(),hg.vec3.create()],i=hg.vec3.create(),n=hg.vec3.create(),r=hg.vec3.create(),a=hg.vec3.create(),o=hg.mat4.create(),s=hg.mat3.create();return function(l,u){for(var h,c,A=l.getAttributes().Vertex,d=l.getAttributes().Normal,g=this.findUvs(l.getAttributes()),f=l.getPrimitives(),p=!1,m=0,_=0,v=0;v<f.length&&!p;v++){m=v;for(var C=f[v].indices,b=0;b<C._numItems&&!p;b+=3){_=b;for(var S=0;S<3;S++)h=e[S],c=2*C.getElements()[b+S],hg.vec3.set(h,g.getElements()[c],g.getElements()[c+1]);this.computeBarycentricCoordinates(i,u,e[0],e[1],e[2]),i[0]>=0&&i[1]>=0&&i[2]>=0&&(p=!0)}}hg.vec3.set(n,0,0,0),hg.vec3.set(r,0,0,0);for(S=0;S<3;S++)c=3*f[m].indices.getElements()[_+S],hg.vec3.set(a,A.getElements()[c],A.getElements()[c+1],A.getElements()[c+2]),hg.vec3.copy(t[S],a),hg.vec3.add(n,n,hg.vec3.scale(a,a,i[S])),hg.vec3.set(a,d.getElements()[c],d.getElements()[c+1],d.getElements()[c+2]),hg.vec3.add(r,r,a);l.getWorldMatrix(null,o),hg.vec3.transformMat4(n,n,o),hg.mat3.normalFromMat4(s,o),hg.vec3.transformMat3(r,r,s),hg.vec3.normalize(r,r),hg.vec3.transformMat4(t[0],t[0],o),hg.vec3.transformMat4(t[1],t[1],o),hg.vec3.transformMat4(t[2],t[2],o);var E=hg.vec3.length(hg.vec3.sub(a,t[0],t[1]));return E/=hg.vec2.length(hg.vec2.sub(a,e[0],e[1])),console.log("uvs",e),console.log("barycentric",i),console.log("triangle",t),console.log("position",n),console.log("normal",r),console.log("ratio",E),{normal:r,position3D:n,texCoordTo3DScaleRatio:E}}}(),computeBarycentricCoordinates:(rg=hg.vec2.create(),ag=hg.vec2.create(),og=hg.vec2.create(),function(e,t,i,n,r){hg.vec2.sub(rg,n,i),hg.vec2.sub(ag,r,i),hg.vec2.sub(og,t,i);var a=1/(rg[0]*ag[1]-ag[0]*rg[1]),o=(og[0]*ag[1]-ag[0]*og[1])*a,s=(rg[0]*og[1]-og[0]*rg[1])*a,l=1-o-s;hg.vec3.set(e,l,o,s)}),findDecalFromWorldPosition:function(e){if(e){var t=this._model.get("decals"),i=Object.keys(t).length;for(let a=0;a<i;a++){const i=t[a];var n=.5*hg.vec3.length(i.scale),r=Math.sqrt(n*n*2);if(hg.vec3.distance(e,i.position)<=r)return i}return uundefined}},intersectsTriangleAABB:function(){var e=hg.vec3.create(),t=hg.vec3.create(),i=hg.vec3.create(),n=hg.vec3.create(),r=hg.vec3.create(),a=hg.vec3.create(),o=hg.vec3.create(),s=hg.vec3.create(),l=[hg.vec3.create(),hg.vec3.create(),hg.vec3.create()],u=[hg.vec3.create(),hg.vec3.create(),hg.vec3.create()];return function(h,c,A,d){if(e=hg.vec3.min(e,h,hg.vec3.min(e,c,A)),t=hg.vec3.max(t,h,hg.vec3.max(t,c,A)),e[0]>=d.max[0]||t[0]<=d.min[0]||e[1]>=d.max[1]||t[1]<=d.min[1]||e[2]>=d.max[2]||t[2]<=d.min[2])return!1;i=hg.vec3.scale(i,hg.vec3.add(i,d.max,d.min),.5),n=hg.vec3.sub(n,d.max,i),hg.vec3.sub(l[0],c,h),hg.vec3.sub(l[1],A,h),hg.vec3.sub(l[2],A,c),r=hg.vec3.sub(r,h,i),a=hg.vec3.cross(a,l[0],l[1]);var g=hg.vec3.dot(a,r),f=Math.abs(hg.vec3.dot(n,Math.abs(a)));if(Math.abs(g)>=f)return!1;hg.vec3.set(u[0],Math.abs(l[0][0]),Math.abs(l[0][1]),Math.abs(l[0][2])),hg.vec3.set(u[1],Math.abs(l[1][0]),Math.abs(l[1][1]),Math.abs(l[1][2])),hg.vec3.set(u[2],Math.abs(l[2][0]),Math.abs(l[2][1]),Math.abs(l[2][2])),o=hg.vec3.sub(o,c,i),s=hg.vec3.sub(s,A,i);var p=l[0][1]*r[2]-l[0][2]*r[1],m=l[0][1]*s[2]-l[0][2]*s[1],_=.5*(p+m);return!((f=Math.abs(n[1]*u[0][2]+n[2]*u[0][1]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[1][1]*r[2]-l[1][2]*r[1])+(m=l[1][1]*o[2]-l[1][2]*o[1])),!((f=Math.abs(n[1]*u[1][2]+n[2]*u[1][1]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[2][1]*r[2]-l[2][2]*r[1])+(m=l[2][1]*o[2]-l[2][2]*o[1])),!((f=Math.abs(n[1]*u[2][2]+n[2]*u[2][1]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[0][2]*r[0]-l[0][0]*r[2])+(m=l[0][2]*s[0]-l[0][0]*s[2])),!((f=Math.abs(n[0]*u[0][2]+n[2]*u[0][0]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[1][2]*r[0]-l[1][0]*r[2])+(m=l[1][2]*o[0]-l[1][0]*o[2])),!((f=Math.abs(n[0]*u[1][2]+n[2]*u[1][0]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[2][2]*r[0]-l[2][0]*r[2])+(m=l[2][2]*o[0]-l[2][0]*o[2])),!((f=Math.abs(n[0]*u[2][2]+n[2]*u[2][0]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[0][0]*r[1]-l[0][1]*r[0])+(m=l[0][0]*s[1]-l[0][1]*s[0])),!((f=Math.abs(n[1]*u[0][0]+n[0]*u[0][1]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[1][0]*r[1]-l[1][1]*r[0])+(m=l[1][0]*o[1]-l[1][1]*o[0])),!((f=Math.abs(n[1]*u[1][0]+n[0]*u[1][1]))+Math.abs(_-p)<Math.abs(_))&&(_=.5*((p=l[2][0]*r[1]-l[2][1]*r[0])+(m=l[2][0]*o[1]-l[2][1]*o[0])),!((f=Math.abs(n[1]*u[2][0]+n[0]*u[2][1]))+Math.abs(_-p)<Math.abs(_))))))))))}}()})]},Ag=n.Z.create(cg);Ag.prototype.getNodeIn=function(){},Ag.prototype.getNodeOut=function(){};const dg=[W,_t,Nr,Lr,Yr,oa,ya,Ro,Fo,Ys,ll,xu,zu,Vc,fA,YA,Fd,Xd,Ag]},HJcC:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=["4024128cf8904b69946e891caac5f305","b83e3a8794ae47e0b4039e7fdb031602","16cdcddf277d423d99094f8db0c731e9","efd4ef0fc18a4ec0a1313d782fade965","675ff0f13b474c62947097939fe9aa1e","df5b82c5ccec42cbb9c5ba9528f0be52","491ddabd93aa49ecb5ad36538f7d00e3","02751cd893a14f3986fb17a90245f64f","78a54c2fd53a4ba4891a4bbdac7f30f7","956bb00775a044e7afdd1c17f6bdab63","003c1543cd754a19a0e14bc89726ccf5","268447ca0a954f44b06d1387863d114e","80fba9759ab94307a782f38d359b8ea8","e73867d210de4bc2b5eb261738cf3e79","2e9c3708feb74137b0436f946b8b66b8","591b2c2db5744df1803a09d477f5a2c7"]},LzEI:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=function(e){var t=e||{};return window.location&&window.location.hash?(window.location.hash.substr(1).split(",").forEach((function(e){var i=e.split("="),n=i[0],r=i[1];if("debug3d"===n&&(t.debug3D=!0),"stats"===n&&(t.stats=!0),"inspector"===n&&(t.inspector=!0),n.match("material_"))switch(n=n.substr(9)){case"showcase":t.materialShowcase=void 0===r?t.materialShowcase:"0"!==r;break;case"names":t.materialNames=r;break;case"normal":t.materialNormal=r;break;case"emissive":t.materialEmissive=r;break;case"transparency":t.materialTransparency=r;break;case"diffuse":t.materialDiffuse=r;break;case"metalness":t.materialMetalness=r;break;case"roughness":t.materialRoughness=r;break;case"glossiness":t.materialGlossiness=r;break;case"specular":t.materialSpecular=r;break;case"cavity":t.materialCavity=r;break;case"f0":t.materialF0=r;break;case"ao":t.materialAO=r;break;case"displacement":t.materialDisplacement=r;break;case"displacement_factor":t.materialDisplacementFactor=void 0===r?t.materialDisplacementFactor:Number(r)}})),t):t}},"5Cxy":(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var n,r=i("qKlK"),a=i("aStF"),o=i("GR6N"),s=i("Em6+"),l=i("ELsZ"),u=i("QLbI"),h=i("LzEI"),c=i("UFcT"),A=i("vasR"),d=i("PSPx"),g=function(e){if(null!=e)return"+Infinity"===e||"Infinity"===e?1/0:"-Infinity"===e?-1/0:e};const f=function(){if(n)return n;if(window.prefetchedData.embedOptions)for(var e in n=window.prefetchedData.embedOptions)n[e]=g(n[e]);else n=function(){var e={};for(var t in o){var i=o[t],n=g(i.defaultValue),r=void 0;if(void 0!==i.alias)for(var s in i.alias)if(void 0!==(r=u.ZP[i.type](s)))break;e[(0,a.Z)(t)]=void 0!==r?r:u.ZP[i.type](t,n)}return e}();try{d.Z.me().get("isStaff")&&void 0===n.webgl2&&(n.webgl2=!0)}catch(e){console.warn("Prefetching failure while trying to reach User.me(). This is probably because this code has been run in a non web context where prefetchdata are unusable.")}if(n.apiId=u.ZP.string("api_id",void 0),n.uiInspector){var t=(0,s.$u)();n.uiInspector=-1===r.Z.inspectorBlacklist.indexOf(t)}n.annotationCycleAutostart=void 0!==n.annotationCycle,n.annotationCycleDuration=5e3,void 0!==n.annotationCycle&&(n.annotationCycleDuration=1e3*n.annotationCycle,delete n.annotationCycle),(n.cardboard||n.annotation||(0,l.Z)())&&(n.camera=!1),n.stats&&(n.continuousRender=!0),n.processOptions&&(0,c.Z)(!0),n.processOptions&&(n.processMaterial=!0),n.stats&&(n.webglTimerGpu=!1);var i=(!n.apiVersion||"1.1.0"===n.apiVersion)&&!n.materialShowcase,f=!(0,c.Z)()&&!(0,l.Z)()&&i;return void 0===n.mergeMaterials&&(n.mergeMaterials=f),void 0===n.graphOptimizer&&(n.graphOptimizer=f),void 0===n.materialPacking&&(n.materialPacking=i),void 0===n.imageCompression&&(n.imageCompression=!(0,l.Z)()),n.shadowAtlas=n.shadowAtlas&&!(0,l.Z)(),navigator&&/OculusBrowser/i.test(navigator.userAgent)&&(/Quest/i.test(navigator.userAgent)&&(n.taa=0),void 0===n.vrQuality&&(/Quest/i.test(navigator.userAgent)&&(n.vrQuality=1.5),console.log("forcing VR quality to",n.vrQuality))),void 0!==n.vrQuality&&(n.vrScaleRtt=1,n.maxDevicePixelRatio=n.vrQuality),(0,A.Z)(n.maxDevicePixelRatio),void 0===n.drsMin&&(n.drsMin=1/(0,A.Z)()),n.sssKernel%2==0&&n.sssKernel++,n.sssHalfKernel=1+(n.sssKernel>>1),(0,h.Z)(n),void 0===n.zz&&(n.zz=!(0,l.Z)()),void 0===n.forceTriangles&&(n.forceTriangles=-1!==navigator.userAgent.indexOf("Firefox/62.0")),n}},MaYM:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("uuWb"),r=i("C4z1"),a=n.Z.osg;const o={uDrawOpaque:a.Uniform.createInt(-1,"uDrawOpaque"),uEarlyZ:a.Uniform.createInt(0,"uEarlyZ"),uQVT:a.Uniform.createFloat3("uQVT"),uQVS:a.Uniform.createFloat3("uQVS"),uQW:a.Uniform.createFloat2("uQW"),uQUV0:a.Uniform.createFloat4("uQUV0"),uNearFar:a.Uniform.createFloat2("uNearFar"),uPreviousNearFar:a.Uniform.createFloat2("uPreviousNearFar"),uBoxRadius:a.Uniform.createFloat("uBoxRadius"),uOutputLinear:a.Uniform.createInt(1,"uOutputLinear"),uRGBMRange:a.Uniform.createFloat("uRGBMRange"),uGlobalTexSize:a.Uniform.createFloat2("uGlobalTexSize"),uGlobalTexRatio:a.Uniform.createFloat2("uGlobalTexRatio"),uPixelRatio:a.Uniform.createFloat2("uPixelRatio"),uPreviousGlobalTexSize:a.Uniform.createFloat2("uPreviousGlobalTexSize"),uPreviousGlobalTexRatio:a.Uniform.createFloat2("uPreviousGlobalTexRatio"),uPreviousHalton:a.Uniform.createFloat4("uPreviousHalton"),uReprojectViewProj:a.Uniform.createMatrix4("uReprojectViewProj"),uTaaCornersCSLeft:r.Z.uTaaCornersCSLeft,uPreviousProjection:a.Uniform.createMatrix4("uPreviousProjection"),uPreviousViewInvView:a.Uniform.createMatrix4("uPreviousViewInvView"),uTextureToBeRefractedSize:a.Uniform.createFloat2("uTextureToBeRefractedSize"),uHoverUV:a.Uniform.createFloat2(a.vec2.fromValues(1e6,1e6),"uHoverUV"),uDisplay2D:a.Uniform.createFloat(0,"uDisplay2D"),uSplitView:a.Uniform.createFloat(0,"uSplitView"),uInspectorView:a.Uniform.createInt(0,"uInspectorView"),uTimeViewer:a.Uniform.createFloat("uTimeViewer"),uHalton:a.Uniform.createFloat4("uHalton"),uSSAARestart:a.Uniform.createFloat(0,"uSSAARestart"),uScatteringFactorPacker:a.Uniform.createFloat("uScatteringFactorPacker"),uNormalizeFactorThickness:a.Uniform.createFloat("uNormalizeFactorThickness"),uStaticFrameNumShadow0:a.Uniform.createFloat("uStaticFrameNumShadow0"),uStaticFrameNumShadow1:a.Uniform.createFloat("uStaticFrameNumShadow1"),uStaticFrameNumShadow2:a.Uniform.createFloat("uStaticFrameNumShadow2"),uStaticFrameNumShadow3:a.Uniform.createFloat("uStaticFrameNumShadow3"),uShadowMapSize:a.Uniform.createFloat2("uShadowMapSize"),uIsVr:a.Uniform.createInt("uIsVr"),uFrameMod:a.Uniform.createFloat(0,"uFrameMod"),uFrameModTaaSS:a.Uniform.createFloat(0,"uFrameModTaaSS"),uSsrFactor:a.Uniform.createFloat(1,"uSsrFactor"),uQuality:a.Uniform.createFloat(0,"uQuality")}},Mn1U:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i("uuWb"),r=i("sFNe"),a=i("5Cxy"),o=n.Z.osg,s={},l=function(e){for(var t=o.vec3.create(),i=0,n=e.length;i<n;i+=3)if(isFinite(e[i])&&isFinite(e[i+1])&&isFinite(e[i+2])){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2];break}return t},u=function(e,t,i){e[i]||t.push(i)},h=function(e,t,i,n){e[i]||e[n]||t.push(i,n)},c=function(e,t,i,n,r){e[i]||e[n]||e[r]||t.push(i,n,r)},A=function(e){if(function(e){var t=e.getVertexAttributeList().Vertex;if(void 0!==t.processedNaN)return t.processedNaN;t.processedNaN=!1;for(var i,n=t.getInstanceID(),r=t.getElements(),a=0,o=r.length;a<o;a+=3)isFinite(r[a])&&isFinite(r[a+1])&&isFinite(r[a+2])||(t.processedNaN=!0,i||(i=l(r)),r[a]=i[0],r[a+1]=i[1],r[a+2]=i[2],s[n]||(s[n]={}),s[n][a/3]=!0);return t.processedNaN}(e)||(0,a.Z)().forceTriangles){var t=e.getVertexAttributeList().Vertex,i=s[t.getInstanceID()]||{},n=[],r=[],A=[],d={operatorPoint:u.bind(this,i,n),operatorLine:h.bind(this,i,r),operatorTriangle:c.bind(this,i,A)};o.primitiveIndexFunctor(e,d);var g,f,p=e.getPrimitiveSetList();p.length=0,n.length&&(f=new Uint16Array(n),g=new o.BufferArray(o.BufferArray.ELEMENT_ARRAY_BUFFER,f,1),p.push(new o.DrawElements(o.primitiveSet.POINTS,g))),r.length&&(f=new Uint16Array(r),g=new o.BufferArray(o.BufferArray.ELEMENT_ARRAY_BUFFER,f,1),p.push(new o.DrawElements(o.primitiveSet.LINES,g))),A.length&&(f=new Uint16Array(A),g=new o.BufferArray(o.BufferArray.ELEMENT_ARRAY_BUFFER,f,1),p.push(new o.DrawElements(o.primitiveSet.TRIANGLES,g)))}};const d=function(e){for(var t=!1,i=0,n=e.length;i<n;++i)t=A(e[i])||t;t&&r.Z.logMessage("NaN values detected in vertices!")}},OBBi:(e,t,i)=>{"use strict";i.d(t,{Z:()=>h});var n=i("uuWb"),r=i("3o3Y"),a=n.Z.osg,o=["Inspector","Matcap","Displacement","AlphaMask","Opacity","SubsurfaceScattering","SubsurfaceTranslucency","DiffuseColor","DiffusePBR","AlbedoPBR","ClearCoat","ClearCoatRoughness","ClearCoatNormalMap","SpecularColor","DiffuseIntensity","SpecularPBR","MetalnessPBR","GlossinessPBR","RoughnessPBR","NormalMap","BumpMap","AOPBR","EmitColor","CavityPBR","SpecularHardness","SpecularF0","Anisotropy","Sheen","SheenRoughness"],s=function(e){switch(e){case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"NormalMap":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"SpecularPBR":case"Matcap":case"Inspector":case"ClearCoatNormalMap":case"Anisotropy":case"Sheen":return a.Texture.RGB;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SheenRoughness":case"SpecularF0":case"AOPBR":case"CavityPBR":case"Displacement":case"SubsurfaceScattering":case"SubsurfaceTranslucency":case"ClearCoat":case"ClearCoatRoughness":return a.Texture.LUMINANCE;case"Opacity":case"AlphaMask":return a.Texture.ALPHA;default:return console.error("unknown channel: "+e),a.Texture.RGB}},l=function(e){if("Anisotropy"===e)return"rg";var t=s(e);return t===a.Texture.RGB?"rgb":t===a.Texture.LUMINANCE?"r":t===a.Texture.ALPHA?"a":"rgba"},u=function(e){for(var t={},i=0,n=o.length;i<n;++i){var r=o[i];t[r]=e(r)}return function(e){return t[e]}};o.getShadingMask=u((function(e){switch(e){case"Matcap":return r.Z.MATCAP;case"SubsurfaceScattering":case"SubsurfaceTranslucency":return r.Z.LIT;case"Opacity":case"AlphaMask":case"Displacement":return r.Z.LIT|r.Z.SHADELESS|r.Z.MATCAP|r.Z.INSPECTOR;case"EmitColor":return r.Z.LIT|r.Z.SHADELESS;case"NormalMap":case"BumpMap":return r.Z.LIT|r.Z.MATCAP;case"DiffusePBR":case"AlbedoPBR":case"AOPBR":case"CavityPBR":return r.Z.PBR;case"SpecularPBR":case"MetalnessPBR":case"GlossinessPBR":case"RoughnessPBR":case"SpecularF0":case"ClearCoat":case"ClearCoatRoughness":case"ClearCoatNormalMap":case"Anisotropy":case"Sheen":case"SheenRoughness":return r.Z.PBR_LIT;case"DiffuseColor":case"DiffuseIntensity":return r.Z.CLASSIC;case"SpecularColor":case"SpecularHardness":return r.Z.CLASSIC_LIT;case"Inspector":return r.Z.INSPECTOR}})),o.isSRGB=u((function(e){switch(e){case"DiffuseColor":case"DiffusePBR":case"AlbedoPBR":case"EmitColor":case"SpecularColor":case"SpecularPBR":case"Matcap":case"Inspector":case"Sheen":return!0;default:return!1}})),o.getDefaultFormatEnum=u(s),o.getDefaultFormatComponent=u(l),o.getDefaultFormatString=u((function(e){var t=s(e);return t===a.Texture.RGB?"RGB":t===a.Texture.LUMINANCE?"LUMINANCE":t===a.Texture.ALPHA?"ALPHA":"RGBA"})),o.getDefaultComponentCount=u((function(e){return l(e).length})),o.getPossibleFormat=u((function(e){var t={};switch(e){case"NormalMap":case"SpecularPBR":case"ClearCoatNormalMap":case"Anisotropy":case"Sheen":t.RGB="RGB";break;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":case"Displacement":case"SubsurfaceScattering":case"SubsurfaceTranslucency":case"ClearCoat":case"ClearCoatRoughness":case"SheenRoughness":t.LUMINANCE="Luminance";break;case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"Matcap":case"Inspector":t.LUMINANCE="Luminance",t.RGB="RGB";break;case"AlphaMask":case"Opacity":t.ALPHA="Alpha",t.LUMINANCE="Luminance";break;default:return console.error("unknown channel: "+e),a.Texture.RGB}return t})),o.getPossibleFiltering=u((function(e){var t={};return"Displacement"!==e&&(t.LINEAR_MIPMAP_LINEAR="Trilinear (best)",t.NEAREST_MIPMAP_LINEAR="Nearest (mipmap)"),t.LINEAR="Bilinear",t.NEAREST="Nearest",t})),o.getColorPacking=u((function(e){switch(e){case"DiffuseColor":case"DiffusePBR":case"AlbedoPBR":case"Inspector":return 0;case"EmitColor":return 1;case"SpecularColor":case"SpecularPBR":return 2;case"DiffuseIntensity":return 3;default:return-1}})),o.getBoxFactor=u((function(e){return"SubsurfaceScattering"===e||"SubsurfaceTranslucency"===e?.2:"Displacement"===e?1:-1}));const h=o},"dq/g":(e,t,i)=>{"use strict";i.d(t,{Z:()=>J});var n=i("57NU"),r=i("uuWb"),a=i("k2rr"),o=i("R4My"),s=i.n(o),l=i("qKlK"),u=i("ELsZ"),h=i("OBBi"),c=i("3o3Y"),A=i("o/tF"),d=i("iO85"),g=i("N96t"),f=i("WIA/"),p=i("0z3s"),m=r.Z.osg,_=s().View,v=s().Model,C={CavityPBR:!0,AOPBR:!0,NormalMap:!0,Displacement:!0,BumpMap:!0,ClearCoatNormalMap:!0},b={DiffuseIntensity:!0,DiffusePBR:!0,AlbedoPBR:!0,SpecularPBR:!0,GlossinessPBR:!0,RoughnessPBR:!0,MetalnessPBR:!0,SpecularF0:!0},S={},E=S.view=_.extend({initialize:function(e){_.prototype.initialize.apply(this,arguments),e.stateSetContext&&(this.stateSetContext=e.stateSetContext),this.model.on("change:enable",this.updateChannel,this),this.model.on("change:texCoordUnit",this.changeTexCoord,this),this.model.on("setFactor",this.updateChannel,this),this.model.on("setColor",this.updateChannel,this),this.model.on("setTextureModel",this.updateChannel,this),this.model.on("updateChannel",this.updateChannel,this),this.model.on("all",d.Z.draw)},getStateSetContext:function(){return this.stateSetContext},updateChannel:function(){if(this.model.getTextureModel()){var e=this.model.get("material").get("texCoordUnitList"),t=this.model.getTexCoordUnit();e.length&&-1===e.indexOf(t)&&this.model.setTexCoordUnit(e[0])}this.getStateSetContext().updateChannel(this.model)},changeTexCoord:function(){this.getStateSetContext().dirtyMaterial()}}),y=S.model=a.Z.extend({getModelOptionPath:function(){return"materials:0.channels."+this.get("name")},_initFactorFromBox:function(e,t){var i=this;i.get(e)>=0||g.Z.getBoxReady().then((function(){if(!(i.get(e)>=0)){var n=g.Z.getModelBoxWithoutDisplacement().radius();i.set(e,n*t)}}))},setupTextureModel:function(e){var t=new A.Z(e);return-1===t.get("internalFormat")&&t.set("internalFormat",h.Z.getDefaultFormatEnum(this.get("name"))),t.updateMultiresTexture(),this.setTextureModel(t),t},_createTextureModel:function(e,t){var i=t.get(e.uid);if(i)return this.setupTextureModel((0,n.Z)({},e,{image:i}));(this.isEffective()||(0,u.Z)())&&m.error("can't find imageModel "+e.uid)},setChannelJSON:function(e,t,i){var n=this.setJSON(e,{ignore:["texture"],context:this.get("name"),imageCollection:t,validate:i&&i.validate,warnOnError:i&&i.warnOnError});return n.length||(e.texture?this._createTextureModel(e.texture,t):null===e.texture&&this.setTextureModel(void 0)),n},getJSON:function(){var e=a.Z.prototype.getJSON.call(this,{ignore:["texture"],context:this.get("name")}),t=this.get("textureModel");return t&&(e.texture=t.getJSON()),e},validate:function(e,t){var i=a.Z.prototype.validate.call(this,e,t);return t&&t.imageCollection&&e.texture&&e.enable&&e.factor&&!t.warnOnError?(t.imageCollection.get(e.texture.uid)||i.push(this.get("name")+" texture uid does not exist"),i):i},getName:function(){return this.get("name")},getEnable:function(){return this.get("enable")},getFactor:function(){return this.get("factor")},getTextureModel:function(){return this.get("textureModel")},getTexCoordUnit:function(){var e=this.get("textureModel");return e&&e.get("texCoordUnit")},setEnable:function(e){return this.set("enable",e)},setFactor:function(e){return this.set("factor",e),this.trigger("setFactor")},setTextureModel:function(e){return this.set("textureModel",e),this.trigger("setTextureModel")},setTexCoordUnit:function(e){var t=this.get("textureModel");void 0!==t&&(t.set("texCoordUnit",e),this.trigger("change:texCoordUnit"))},changeTexCoordTransform:function(){this.trigger("change:texCoordUnit")},getOrCreateUVTransforms:function(){var e=this.get("UVTransforms");return e||(e={scale:m.vec2.fromValues(1,1),rotation:0,offset:m.vec2.fromValues(0,0)},this.set("UVTransforms",e),e)},getNonIdentityUvTransform:function(){var e=this.get("UVTransforms");if(e&&(1!==e.scale[0]||1!==e.scale[1]||0!==e.rotation||0!==e.offset[0]||0!==e.offset[1]))return e},removeTexture:function(){this.setColor(m.vec3.ONE)},reset:function(){return this.removeTexture(),this.set("factor",1),this.trigger("updateChannel")},resetTextureFormat:function(){var e=this.get("textureModel");e&&(e.set("internalFormat",h.Z.getDefaultFormatEnum(this.get("name"))),e.updateMultiresTexture())},isEffective:function(){if(!this.isActivated())return!1;var e=this.get("name"),t=this.get("factor");if(0===t){if("RoughnessPBR"!==e&&"GlossinessPBR"!==e)return!1;var i=this.get("material").getChannels().Opacity;return i.isEffective()&&"refraction"===i.get("type")&&i.get("useMicrosurfaceTexture")}if(C[e]&&!this.get("textureModel"))return!1;if("Displacement"===e&&!m.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_TEXTURE_IMAGE_UNITS"))return!1;var n=this.get("color");return!(!b[e]&&n&&function(e){return 0===e[0]&&0===e[1]&&0===e[2]}(n)&&"SubsurfaceTranslucency"!==e)&&("DiffuseIntensity"!==e||1!==t||!n||!function(e){return 1===e[0]&&1===e[1]&&1===e[2]}(n))},isEnableEffective:function(){return!!this.isActivated()&&(!!b[this.get("name")]||this.isEffective())},isEnableEffectiveHardware:function(e){if(!this.isEnableEffective())return!1;if(!C[this.get("name")])return!0;var t=e.getChannelMapping(this.get("name"));return void 0!==t&&t>=0},isActivated:function(){return!!(h.Z.getShadingMask(this.get("name"))&this.getCurrentShading())&&this.get("enable")},getCurrentShading:function(){var e=this.get("material").get("stateSet"),t=e&&e.getShaderGeneratorName();return t?c.Z.nameMatch[t]:c.Z.get("mask")},shouldDisplayGUIWarningOnDeletion:function(){if(!this.getEnable())return!1;var e=c.Z.get("mask")&c.Z.CLASSIC?c.Z.CLASSIC:c.Z.PBR;return!!(h.Z.getShadingMask(this.getName())&e)},addUniforms:function(e,t){var i="u"+(t||this.get("name"))+"Factor";e[i]=m.Uniform.createFloat(i),e[i="u"+(t||this.get("name"))+"UVTransforms"]=m.Uniform.createFloat4(i),e[i="u"+(t||this.get("name"))+"UVOffset"]=m.Uniform.createFloat2(i)},cacheUniforms:function(e){this._uniformFactor=e["u"+this.get("name")+"Factor"].getInternalArray(),this._valueFactor=this.isEnableEffective()?this.get("factor"):0;var t=this.getNonIdentityUvTransform();if(t){var i=Math.cos(t.rotation),n=Math.sin(t.rotation);this._uniformUVTransform=e["u"+this.get("name")+"UVTransforms"].getInternalArray(),this._valueUVTransform=m.vec4.fromValues(i*t.scale[0],-n*t.scale[1],n*t.scale[0],i*t.scale[1]),this._uniformUVOffset=e["u"+this.get("name")+"UVOffset"].getInternalArray(),this._valueUVOffset=t.offset}else this._uniformUVTransform&&(this._valueUVTransform=m.vec4.fromValues(1,0,0,1),this._valueUVOffset=m.vec2.fromValues(0,0))},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._valueUVTransform&&this._uniformUVTransform&&(m.vec4.copy(this._uniformUVTransform,this._valueUVTransform),m.vec2.copy(this._uniformUVOffset,this._valueUVOffset))},getSRGB:function(){var e=this.get("textureModel");if(!e)return!1;if(!e.getImageModel())return h.Z.isSRGB(this.get("name"));var t=e.getImageModel().get("colorSpace");return"srgb"===t||"linear"!==t&&h.Z.isSRGB(this.get("name"))},getShaderHash:function(){var e=this.isEffective()&&this.get("textureModel"),t=this.getSRGB()?"1":"0";return t+=e?e.get("texCoordUnit"):"x",t+=this._valueUVTransform?"x":"t"}}),I={};I.view=E,I.model=y.extend({_adaptJSON:function(e){e.texture?delete e.color:delete e.texture},getColor:function(){return this.get("color")},setColor:function(e){return this.set("textureModel",void 0),this.set("color",m.vec3.copy(this.get("color")||m.vec3.create(),e)),this.trigger("setColor")},setTextureModel:function(e){e&&this.set("color",void 0),y.prototype.setTextureModel.call(this,e)},getJSON:function(){var e=y.prototype.getJSON.call(this);return this.get("textureModel")&&e.color&&delete e.color,e},setChannelJSON:function(e,t,i){var n=y.prototype.setChannelJSON.call(this,e,t,i);return n.length||e.color&&this.setColor(e.color),n}});var x=y.prototype.addUniforms,T=y.prototype.cacheUniforms,w=y.prototype.updateUniforms,M={};M.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:invert",this.updateChannel,this),this.model.get("material").on("change:vertexAlphaEnable",this.updateChannel,this),this._migrate()},_migrate:function(){var e=this.model.get("material").getChannels().Opacity;"alphaMask"===e.get("type")&&(this.model.set("enable",e.get("enable")),this.model.set("invert",e.get("invert")),this.model.set("factor",e.get("factor")),this.model.setTextureModel(e.getTextureModel()),e.set("enable",!1),e.set("factor",1),e.set("invert",!1),e.set("type","alphaBlend"),e.setTextureModel(void 0))},_checkForceLuminance:function(){var e=this.model.getTextureModel(),t=e&&e.getMultiresTexture();if(t){var i=e.getImageModel();if(!(!1===i.get("alpha"))){var n=i.get("name")||t.getImageModel().getURL();if(-1===(n=n.toLowerCase()).indexOf("jpg")&&-1===n.indexOf("jpeg"))return}e.set("internalFormat",m.Texture.LUMINANCE),e.updateMultiresTexture()}},updateChannel:function(){this._checkForceLuminance(),E.prototype.updateChannel.call(this),d.Z.redrawShadow()},_updateMaskingFiltering:function(){var e=this.model.isMasked();if(e!==this._isMasking){this._isMasking=e;var t=this.model.getTextureModel();if(t&&t.get("magFilter")!==m.Texture.NEAREST){var i=t.get("minFilter"),n=i===m.Texture.LINEAR_MIPMAP_LINEAR,r=i;e&&i===n?r=m.Texture.LINEAR:e||i!==m.Texture.LINEAR||(r=this._blendFilter),r&&(t.set("minFilter",i),t.set("magFilter",n?m.Texture.LINEAR:i),t.updateMultiresTexture())}}},changeType:function(){this._updateMaskingFiltering(),this.updateChannel()}}),M.model=y.extend({_modelOptionPath:"materials:0.channels.AlphaMask",isMasked:function(){var e=this.get("factor");return(this.get("textureModel")||this.get("material").get("vertexAlphaEnable"))&&0!==e},isEffective:function(){return!!this.isActivated()&&(this.isMasked(),!0)},addUniforms:function(e,t){x.call(this,e,t),e.uAlphaMaskInvert=m.Uniform.createInt("uAlphaMaskInvert")},cacheUniforms:function(e){T.call(this,e),this._uniformInvert=e.uAlphaMaskInvert.getInternalArray();var t=this.isEnableEffective();this._valueInvert=t&&this.get("textureModel")&&this.get("invert")?1:0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformInvert[0]=this._valueInvert},_hasTextureAlpha:function(){var e=this.get("textureModel");if(!e)return!1;var t=e.getMultiresTexture();return!(!t||!t.getOriginalFormat)&&t.getOriginalFormat()===m.Texture.ALPHA},getSRGB:function(){return!this._hasTextureAlpha()&&y.prototype.getSRGB.call(this)},getShaderHash:function(){var e=y.prototype.getShaderHash.call(this);return e+=this.get("textureModel")&&this.get("textureModel").isLuminance()?"1":"0"}});var R={};R.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:type",this.changeType,this),this.model.on("change:invert",this.updateChannel,this),this.model.on("change:ior",this.updateChannel,this),this.model.on("change:roughnessFactor",this.updateChannel,this),this.model.on("change:useMicrosurfaceTexture",this.updateChannel,this),this.model.on("change:useAlbedoTint",this.updateChannel,this),this.model.on("change:useNormalOffset",this.updateChannel,this),this.model.on("change:refractionColor",this.updateChannel,this),this.model.on("change:thinLayer",this.updateChannel,this),this.model.get("material").on("change:vertexAlphaEnable",this.updateChannel,this)},_checkForceLuminance:function(){var e=this.model.getTextureModel(),t=e&&e.getMultiresTexture();if(t){var i=e.getImageModel();if(!(!1===i.get("alpha"))){var n=i.get("name")||t.getImageModel().getURL();if(-1===(n=n.toLowerCase()).indexOf("jpg")&&-1===n.indexOf("jpeg"))return}e.set("internalFormat",m.Texture.LUMINANCE),e.updateMultiresTexture()}},updateChannel:function(){var e=this.model.get("material").getChannels();e.RoughnessPBR.isEnableEffective()?e.RoughnessPBR.trigger("updateChannel"):e.GlossinessPBR.isEnableEffective()&&e.GlossinessPBR.trigger("updateChannel"),this._checkForceLuminance(),E.prototype.updateChannel.call(this),d.Z.redrawShadow()},changeType:function(){this.updateChannel()}}),R.model=y.extend({_modelOptionPath:"materials:0.channels.Opacity",getTransparency:function(){return this.get("type")},setTransparency:function(e){this.setJSON({type:e})},isEffective:function(){if(!this.isActivated())return!1;var e=this.get("type"),t=this.get("factor"),i=this.get("textureModel");if("dithering"===e)return!0;if(("alphaBlend"===e||"refraction"===e||"additive"===e)&&this.get("material").getChannels().SubsurfaceScattering.isEffective())return!1;return"alphaBlend"!==e&&"refraction"!==e&&"dithering"!==e||(i||this.get("material").get("vertexAlphaEnable")||1!==t)},addUniforms:function(e,t){x.call(this,e,t),e.uOpacityInvert=m.Uniform.createInt("uOpacityInvert"),e.uOpacityDithering=m.Uniform.createInt("uOpacityDithering"),e.uOpacityAdditive=m.Uniform.createInt("uOpacityAdditive"),e.uOpacityIOR=m.Uniform.createFloat("uOpacityIOR"),e.uOpacityRoughnessFactor=m.Uniform.createFloat("uOpacityRoughnessFactor"),e.uOpacityRefractionColor=m.Uniform.createFloat3("uOpacityRefractionColor"),e.uOpacityThinLayer=m.Uniform.createFloat("uOpacityThinLayer")},cacheUniforms:function(e){T.call(this,e),this._uniformInvert=e.uOpacityInvert.getInternalArray(),this._uniformDithering=e.uOpacityDithering.getInternalArray(),this._uniformAdditive=e.uOpacityAdditive.getInternalArray(),this._uniformIOR=e.uOpacityIOR.getInternalArray(),this._uniformRoughnessFactor=e.uOpacityRoughnessFactor.getInternalArray(),this._uniformRefractionColor=e.uOpacityRefractionColor.getInternalArray();var t=this.isEnableEffective();this._valueInvert=t&&this.get("textureModel")&&this.get("invert")?1:0,this._valueDithering=t&&"dithering"===this.get("type")?1:0,this._valueAdditive=t&&"additive"===this.get("type")?1:0;var i=t&&"refraction"===this.get("type");this._valueIOR=i?this.get("ior"):0,this._valueRoughness=i?this.get("roughnessFactor"):0,this._valueRefractionColor=i?this.get("refractionColor"):m.vec3.ONE,this._uniformThinLayer=e.uOpacityThinLayer.getInternalArray(),this._valueThinLayer=this.get("thinLayer")?1:0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformInvert[0]=this._valueInvert,this._uniformDithering[0]=this._valueDithering,this._uniformAdditive[0]=this._valueAdditive,this._uniformIOR[0]=this._valueIOR,this._uniformRoughnessFactor[0]=this._valueRoughness,m.vec3.copy(this._uniformRefractionColor,this._valueRefractionColor),this._uniformThinLayer[0]=this._valueThinLayer},_hasTextureAlpha:function(){var e=this.get("textureModel");if(!e)return!1;var t=e.getMultiresTexture();return!(!t||!t.getOriginalFormat)&&t.getOriginalFormat()===m.Texture.ALPHA},getSRGB:function(){return!this._hasTextureAlpha()&&y.prototype.getSRGB.call(this)},_isReadingMicrosurface:function(){if("refraction"!==this.get("type"))return!1;if(!this.get("useMicrosurfaceTexture"))return!1;if(0==(c.Z.get("mask")&c.Z.PBR))return!1;var e=this.get("material").getChannels();return e.RoughnessPBR.isEnableEffective()?e.RoughnessPBR.getTextureModel():e.GlossinessPBR.getTextureModel()},getShaderHash:function(){var e=y.prototype.getShaderHash.call(this),t=this.get("type"),i="alphaBlend"===t||"additive"===t,n=this.get("textureModel")&&this.get("textureModel").isLuminance(),r="refraction"===t,a=this._isReadingMicrosurface(),o=r&&this.get("useAlbedoTint"),s=r&&this.get("useNormalOffset");return p.Z.CURRENT_COMPILER===p.Z.SHADOWCAST_COMPILER||p.Z.CURRENT_COMPILER===p.Z.EARLYZ_COMPILER?(e+=i||r?"1":"0",e+=n?"1":"0",e+="0000"):(e+=i?"1":"0",e+=n?"1":"0",e+=r?"1":"0",e+=a?"1":"0",e+=o?"1":"0",e+=s?"1":"0"),e}});var B={};B.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:occludeSpecular",this.updateChannel,this)}}),B.model=y.extend({getModelOptionPath:function(){return"materials:0.channels.AOPBR"},addUniforms:function(e,t){x.call(this,e,t),e.uAOPBROccludeSpecular=m.Uniform.createInt("uAOPBROccludeSpecular")},cacheUniforms:function(e){T.call(this,e),this._uniformOcclude=e.uAOPBROccludeSpecular.getInternalArray(),this._valueOcclude=this.isEnableEffective()&&this.get("occludeSpecular")?1:0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformOcclude[0]=this._valueOcclude}});var N={};N.view=E.extend({}),N.model=y.extend({_modelOptionPath:"materials:0.channels.BumpMap",addUniforms:function(e,t){x.call(this,e,t);var i="u"+t+"Size";e[i]=m.Uniform.createFloat2(m.vec2.create(),i)},cacheUniforms:function(e){T.call(this,e),this._uniformSize=e["u"+this.get("name")+"Size"].getInternalArray(),this._mrTexture=this.get("textureModel")&&this.get("textureModel").getMultiresTexture()},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformSize[0]=this._mrTexture?this._mrTexture.getWidth():0,this._uniformSize[1]=this._mrTexture?this._mrTexture.getHeight():0}});var D={};D.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:colorFactor",this.updateChannel,this)}}),D.model=y.extend({addUniforms:function(e,t){y.prototype.addUniforms.call(this,e,t);var i="uSheenColorFactor";e[i]=m.Uniform.createFloat3(m.vec3.create(),i)},cacheUniforms:function(e){y.prototype.cacheUniforms.call(this,e),this._uniformColorFactor=e.uSheenColorFactor.getInternalArray(),this._valueColorFactor=this.get("colorFactor")||m.vec3.create()},updateUniforms:function(){y.prototype.updateUniforms.call(this),m.vec3.copy(this._uniformColorFactor,this._valueColorFactor)}});var P={};P.view=E.extend({}),P.model=y.extend({isEnableEffective:function(){return this.get("material").getChannels().Sheen.isEnableEffective()}});var F={};F.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:thickness",this.updateChannel,this),this.model.on("change:tint",this.updateChannel,this),this.model.on("change:reflectivity",this.updateChannel,this),this.model.on("change:useBaseNormalMap",this.updateChannel,this)}}),F.model=y.extend({addUniforms:function(e,t){y.prototype.addUniforms.call(this,e,t);var i="uClearCoatThickness";e[i]=m.Uniform.createFloat(0,i),e[i="uClearCoatIor"]=m.Uniform.createFloat(0,i),e[i="uClearCoatF0"]=m.Uniform.createFloat(0,i),e[i="uClearCoatTint"]=m.Uniform.createFloat3(m.vec3.create(),i)},cacheUniforms:function(e){y.prototype.cacheUniforms.call(this,e),this._uThickness=e.uClearCoatThickness.getInternalArray(),this._uIor=e.uClearCoatIor.getInternalArray(),this._uF0=e.uClearCoatF0.getInternalArray(),this._uTint=e.uClearCoatTint.getInternalArray(),this._valueRoughness=this.get("roughness"),this._valueThickness=this.get("thickness");var t=this.get("reflectivity");this._valueIOR=1.4*(1-t)+1*t,this._valueF0=.04*(1+t),this.updateTintUniform()},updateTintUniform:function(){var e=this.get("thickness"),t=Math.max(20-e,.01);this._valueTint||(this._valueTint=m.vec3.create()),m.vec3.copy(this._valueTint,this.get("tint")),this._valueTint[0]=-Math.log(m.clamp(this._valueTint[0],.01,.99))/t,this._valueTint[1]=-Math.log(m.clamp(this._valueTint[1],.01,.99))/t,this._valueTint[2]=-Math.log(m.clamp(this._valueTint[2],.01,.99))/t},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uThickness[0]=this._valueThickness,m.vec3.copy(this._uTint,this._valueTint),this._uIor[0]=this._valueIOR,this._uF0[0]=this._valueF0}}),F.model.validateJSON=function(e,t,i){return y.validateJSON(e,t,i)};var O={};O.view=E.extend({}),O.model=y.extend({isEnableEffective:function(){return this.get("material").getChannels().ClearCoat.isEnableEffective()}});var L={};L.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:flipY",this.updateChannel,this)}}),L.model=y.extend({addUniforms:function(e,t){x.call(this,e,t),e.uClearCoatNormalMapFlipY=m.Uniform.createInt("uClearCoatNormalMapFlipY")},cacheUniforms:function(e){T.call(this,e),this._uniformFlip=e.uClearCoatNormalMapFlipY.getInternalArray(),this._valueFlip=this.isEnableEffective()&&this.get("flipY")?1:0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformFlip[0]=this._valueFlip},isEffective:function(){return this.get("material").getChannels().ClearCoat.isEffective()&&void 0!==this.getTextureModel()}});var k,Z={};Z.view=E.extend({updateChannel:function(){E.prototype.updateChannel.call(this),this.model.updateGeometryOffsets(),d.Z.redrawShadow()}}),Z.model=y.extend({_modelOptionPath:"materials:0.channels.Displacement",updateGeometryOffsets:(k=m.vec3.create(),function(){var e=this.isEffective()?this.getFactor():0;if(g.Z.updateMaxWorldDisplacement(e),0!==e)for(var t=this.get("material").get("geometryList"),i=0,n=t.length;i<n;++i){var r=t[i];if(!r._maxScale){for(var a=r.getWorldMatrices(),o=0,s=0,l=a.length;s<l;++s)m.mat4.getScale(k,a[s]),o=Math.max(o,k[0],k[1],k[2]);r._maxScale=o}var u=e/(r._maxScale||1);r._displacementFactor=Math.max(r._displacementFactor||0,u),r.dirtyBound()}}),setTextureModel:function(e){return e&&e.get("minFilter")===m.Texture.LINEAR_MIPMAP_LINEAR&&(e.set("minFilter",m.Texture.LINEAR),e.updateMultiresTexture()),y.prototype.setTextureModel.call(this,e)},addUniforms:function(e,t){N.model.prototype.addUniforms.call(this,e,t),e.uDisplacementNormal=m.Uniform.createFloat(1,"uDisplacementNormal")},cacheUniforms:function(e){if(N.model.prototype.cacheUniforms.call(this,e),this._uniformNormal=e.uDisplacementNormal.getInternalArray(),this.isEnableEffective()){var t=g.Z.getModelBoxWithoutDisplacement();t?this._valueNormal=250*this.get("factor")/t.radius():g.Z.getBoxReady().then(this.cacheUniforms.bind(this,e))}else this._valueNormal=0},updateUniforms:function(){N.model.prototype.updateUniforms.call(this),this._uniformNormal[0]=this._valueNormal}});var U={};U.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:flipY",this.updateChannel,this)}}),U.model=y.extend({_modelOptionPath:"materials:0.channels.NormalMap",addUniforms:function(e,t){x.call(this,e,t),e.uNormalMapFlipY=m.Uniform.createInt("uNormalMapFlipY")},cacheUniforms:function(e){T.call(this,e),this._uniformFlip=e.uNormalMapFlipY.getInternalArray(),this._valueFlip=this.isEnableEffective()&&this.get("flipY")?1:0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformFlip[0]=this._valueFlip}});var V,Q={};Q.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:type",this.updateChannel,this)}}),Q.model=I.model.extend({_modelOptionPath:"materials:0.channels.EmitColor",addUniforms:function(e,t){x.call(this,e,t),e.uEmitMultiplicative=m.Uniform.createInt("uEmitMultiplicative")},cacheUniforms:function(e){T.call(this,e),this._uniformMultiply=e.uEmitMultiplicative.getInternalArray();var t=this.isEnableEffective()&&"multiplicative"===this.get("type");this._valueMultiply=t?1:0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformMultiply[0]=this._valueMultiply},isEffective:function(){return!!this.isActivated()&&(0!==this.get("factor")||"additive"!==this.get("type"))}});var G=function(){if(V)return V;0===(V=f.Z.instance.getMatcapCollection()).length&&V.addNewImage({url:l.Z.defaultMatcapUid,name:l.Z.defaultMatcapUid,width:1,height:1}).set("uid",l.Z.defaultMatcapUid);return V},H={};H.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:curvature",this.updateChannel,this)}}),H.model=I.model.extend({_modelOptionPath:"materials:0.channels.Matcap",_adaptJSON:function(){},initialize:function(){if(y.prototype.initialize.apply(this,arguments),!this.get("textureModel")){var e=G(),t=e.get(l.Z.defaultMatcapUid);t||(t=e.at(0)),this.setChannelJSON({texture:{uid:t.getUID()}})}},setTextureModel:function(e){return this.set("textureModel",e),this.trigger("setTextureModel")},setColor:function(e){return this.set("color",m.vec3.copy(this.get("color")||m.vec3.create(),e)),this.trigger("setColor")},isEffective:function(){return!!this.isActivated()},addUniforms:function(e,t){x.call(this,e,t),e.uMatcapCurvature=m.Uniform.createFloat("uMatcapCurvature"),e.uMatcapColor=m.Uniform.createFloat3("uMatcapColor")},cacheUniforms:function(e){T.call(this,e),this._uniformCurvature=e.uMatcapCurvature.getInternalArray(),this._valueCurvature=this.isEnableEffective()?this.get("curvature"):0,this._uniformColor=e.uMatcapColor.getInternalArray(),this._valueColor=this.isEnableEffective()?this.get("color"):m.vec3.ONE},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformCurvature[0]=this._valueCurvature,m.vec3.copy(this._uniformColor,this._valueColor)},getJSON:function(){return y.prototype.getJSON.call(this)},setChannelJSON:function(e,t,i){return!1===e.enable&&(e.enable=!0),y.prototype.setChannelJSON.call(this,e,G(),i)},resetToDefaultMatcap:function(){this.setChannelJSON({texture:{uid:l.Z.defaultMatcapUid}})}});var z={};z.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:profile",this.updateChannel,this)}}),z.model=y.extend({_modelOptionPath:"materials:0.channels.SubsurfaceScattering",initialize:function(){y.prototype.initialize.apply(this,arguments),this._initFactorFromBox("factor",.05)},addUniforms:function(e,t){x.call(this,e,t),e.uSubsurfaceScatteringProfile=m.Uniform.createFloat("uSubsurfaceScatteringProfile")},cacheUniforms:function(e){T.call(this,e),this._uniformProfile=e.uSubsurfaceScatteringProfile.getInternalArray(),this._valueProfile=this.isEnableEffective()?this.get("profile"):1},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformProfile[0]=this._valueProfile}});var W={};W.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:thicknessFactor",this.updateChannel,this)}}),W.model=I.model.extend({_modelOptionPath:"materials:0.channels.SubsurfaceTranslucency",initialize:function(){y.prototype.initialize.apply(this,arguments),this._initFactorFromBox("thicknessFactor",.05)},setTextureModel:H.model.prototype.setTextureModel,setColor:H.model.prototype.setColor,getJSON:H.model.prototype.getJSON,setJSON:H.model.prototype.setJSON,_adaptJSON:H.model.prototype._adaptJSON,addUniforms:function(e,t){x.call(this,e,t),e.uSubsurfaceTranslucencyColor=m.Uniform.createFloat3("uSubsurfaceTranslucencyColor"),e.uSubsurfaceTranslucencyThicknessFactor=m.Uniform.createFloat("uSubsurfaceTranslucencyThicknessFactor")},cacheUniforms:function(e){T.call(this,e),this._uniformThicknessFactor=e.uSubsurfaceTranslucencyThicknessFactor.getInternalArray(),this._uniformColor=e.uSubsurfaceTranslucencyColor.getInternalArray(),this._valueColor=this.isEnableEffective()?this.get("color"):m.vec3.ONE,this._valueThicknessFactor=this.isEnableEffective()?this.get("thicknessFactor"):0},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformThicknessFactor[0]=this._valueThicknessFactor,m.vec3.copy(this._uniformColor,this._valueColor)}});var j={};j.view=E.extend({initialize:function(){E.prototype.initialize.apply(this,arguments),this.model.on("change:direction",this.updateChannel,this),this.model.on("change:flipXY",this.updateChannel,this)}}),j.model=y.extend({isEnableEffective:function(){return y.prototype.isEnableEffective.call(this)&&!this.get("material").get("missingUvs")},addUniforms:function(e,t){x.call(this,e,t),e.uAnisotropyDirection=m.Uniform.createFloat("uAnisotropyDirection"),e.uAnisotropyFlipXY=m.Uniform.createInt("uAnisotropyFlipXY")},cacheUniforms:function(e){T.call(this,e),this._uniformDirection=e.uAnisotropyDirection.getInternalArray(),this._valueDirection=this.isEnableEffective()?this.get("direction"):0,this._uniformFlipXY=e.uAnisotropyFlipXY.getInternalArray(),this._valueXY=this.get("flipXY")?1:0},updateUniforms:function(){w.call(this);var e=!!this.getTextureModel()?-1:Math.sign(this._valueDirection)||1;this._uniformFactor[0]=this._valueFactor*e,this._uniformDirection[0]=this._valueDirection<0?1+this._valueDirection:this._valueDirection,this._uniformFlipXY[0]=this._valueXY}});var q={};q.view=E.extend({}),q.model=I.model.extend({transient:!0,initialize:function(){v.prototype.initialize.apply(this,arguments),this.set("selectUV",0)},setInspectorSRGB:function(e){this._srgb=e},getSRGB:function(){return!!this._srgb},setTextureModel:H.model.prototype.setTextureModel,setColor:H.model.prototype.setColor,addUniforms:function(e,t){x.call(this,e,t),e.uInspectorInvert=m.Uniform.createInt("uInspectorInvert"),e.uInspectorMaskThreshold=m.Uniform.createFloat("uInspectorMaskThreshold"),e.uInspectorColor=m.Uniform.createFloat3("uInspectorColor"),e.uInspectorSelected=m.Uniform.createInt("uInspectorSelected")},cacheUniforms:function(e){T.call(this,e),this._uniformInvert=e.uInspectorInvert.getInternalArray(),this._uniformMaskThreshold=e.uInspectorMaskThreshold.getInternalArray(),this._uniformColor=e.uInspectorColor.getInternalArray(),this._uniformSelected=e.uInspectorSelected.getInternalArray()},updateUniforms:function(){w.call(this),this._uniformFactor[0]=this._valueFactor,this._uniformInvert[0]=this.get("invert")?1:0,this._uniformMaskThreshold[0]=this.get("maskThreshold"),m.vec3.copy(this._uniformColor,this.getColor()),this._uniformSelected[0]=this.get("isSelected")?1:0},setChannelJSON:function(e,t){(void 0!==e.enable&&this.setEnable(e.enable),void 0!==e.factor&&this.setFactor(e.factor),e.color&&this.setColor(e.color),e.texture)&&(this._createTextureModel(e.texture,t)||this.setColor(e.color||m.vec3.fromValues(1,1,1)));return void 0!==e.invert&&this.set("invert",e.invert),void 0!==e.maskThreshold&&this.set("maskThreshold",e.maskThreshold),[]},setTexCoordUnit:function(e){y.prototype.setTexCoordUnit.call(this,e),this.set("fallbackUV",e)},getShaderHash:function(){var e=y.prototype.getShaderHash.call(this);return e+=this.isEffective()&&!this.get("textureModel")?this.get("selectUV"):0},getJSON:function(){var e={},t=this.get("textureModel");t&&(e.texture=t.getJSON());var i=this.get("color");return i&&(e.color=i),e.factor=this.get("factor"),e.enable=this.get("enable"),e.invert=this.get("invert"),e.maskThreshold=this.get("maskThreshold"),e}});const J={DiffusePBR:I,AlbedoPBR:I,SpecularPBR:I,GlossinessPBR:S,RoughnessPBR:S,MetalnessPBR:S,SpecularF0:S,CavityPBR:S,Matcap:H,SubsurfaceTranslucency:W,DiffuseColor:I,SpecularColor:I,DiffuseIntensity:I,SpecularHardness:S,SubsurfaceScattering:z,Displacement:Z,NormalMap:U,AOPBR:B,BumpMap:N,EmitColor:Q,Opacity:R,AlphaMask:M,ClearCoat:F,ClearCoatRoughness:O,ClearCoatNormalMap:L,Anisotropy:j,Sheen:D,SheenRoughness:P,Inspector:q}},AhvN:(e,t,i)=>{"use strict";i.d(t,{Z:()=>y});var n=i("bP3Y"),r=i("lZH+"),a=i.n(r),o=i("uuWb"),s=i("iI+4"),l=i("R6lU"),u=i("O/gg"),h=i("iO85"),c=i("sFNe"),A=i("OBBi"),d=i("5Cxy"),g=i("GpBa"),f=i("47H3"),p=o.Z.osg,m=p.StateAttribute.OVERRIDE_ON,_=p.createTexturedFullScreenFakeQuadGeometry(),v=function(e,t){p.Camera.call(this),this.addChild(_),this.setNodeMask(0),this._outTexture=e,this._packedTextures=(0,n.Z)(t.getPackedTextures()),this._channels=t.getOrderedChannels().slice(),this._lastHash="",this.initPacking()};v.AUTO_RELEASE_GL=!1;var C,b=function(e){for(var t in C)for(var i=C[t].get("stateSet"),n=i.getNumTextureAttributeLists(),r=0;r<n;++r){var a=i.getTextureAttribute(r,"Texture");if(a&&a.getTexture&&a.getTexture()===e)return!1}return!0};p.createPrototypeNode(v,p.objectInherit(p.Camera.prototype,{getNbChannels:function(){return this._channels.length},disablePacking:function(){this.setNodeMask(0);for(var e=this.getStateSet(),t=this.getNbChannels(),i=0;i<t;++i){var n=e.getTextureAttribute(i,"Texture");n&&n!==s.Z.dummyTexture&&b(n)&&n.releaseGLObjects()}if(v.AUTO_RELEASE_GL){var r=this.frameBufferObject;r&&r.releaseGLObjects()}},initPacking:function(){var e=this.getOrCreateStateSet(),t=this._packedTextures,i=0,n=this._channels,r=n.length,a=p.Uniform.createInt4("uReadPacking"),o=a.getInternalArray();for(i=0;i<r;++i){var l=n[i],u=t[l].texture.getInternalFormat()===p.Texture.ALPHA,h=A.Z.getDefaultComponentCount(l);o[i]=2===h?4:3===h?u?3:2:u?1:0}for(i=0;i<4;++i)e.setTextureAttributeAndModes(i,s.Z.dummyTexture,m);this._outTexture.setTextureSize(1,1),this.setRenderOrder(p.Camera.PRE_RENDER,0),this.attachTexture(p.FrameBufferObject.COLOR_ATTACHMENT0,this._outTexture,p.Texture.TEXTURE_2D);var c=new p.Viewport(0,0,1,1);this.setReferenceFrame(p.Transform.ABSOLUTE_RF),this.setViewport(c),e.addUniform(p.Uniform.createInt(0,"uTexture0"),m),e.addUniform(p.Uniform.createInt(1,"uTexture1"),m),e.addUniform(p.Uniform.createInt(2,"uTexture2"),m),e.addUniform(p.Uniform.createInt(3,"uTexture3"),m),e.addUniform(a,m)},updatePacking:function(e){var t,i=this._packedTextures,n=this._channels,r=n.length,a=0,o="";for(a=0;a<r;++a)o+=""+(t=i[n[a]].texture).getWidth()+t.getHeight();if(o===this._lastHash)return 0;var s=0,l=0;for(a=0;a<r;++a){if(!(t=i[n[a]].texture).apply(e))return-1;s=Math.max(s,t.getWidth()),l=Math.max(l,t.getHeight())}if(!h.Z.requestTextureBudget(s*l))return-1;this._lastHash=o,this.setNodeMask(-1);var u=this.getStateSet();for(a=0;a<r;++a)t=i[n[a]].texture,u.setTextureAttributeAndModes(a,t,m);return this._outTexture.setTextureSize(s,l),this._outTexture.dirtyMipmap(),this._outTexture._rttPass=!0,this.setRenderOrder(p.Camera.PRE_RENDER,0),this.resetAttachments(),this.attachTexture(p.FrameBufferObject.COLOR_ATTACHMENT0,this._outTexture,p.Texture.TEXTURE_2D),this.getViewport().setViewport(0,0,s,l),(this._packedTextures.Opacity||this._packedTextures.Displacement)&&h.Z.redrawShadowNextFrame(),s*l}}),"osgSketchfab","TexturePacker");var S=function(){p.Node.call(this),this.setCullCallback(this),this._program=l.Z.getOrCreateShader(g,f,"material-packer","MaterialPacker"),this._dirtyPackedTextures=[],this._cacheCameras={},this._currentPackingCameras=[],this._frameCount=-1,this._lowResDone=!1,this._highResDone=!1,this._canResolveHighRes=!1,this._allMaterialsPackingCalled=!1};p.createPrototypeNode(S,p.objectInherit(p.Node.prototype,{initReadyForHighResBound:function(){((0,d.Z)().preload?u.Z.getHighResLoaded():a().all([u.Z.getHighResLoaded(),u.Z.getFirstCameraAnimation()])).then(function(){this._canResolveHighRes=!0}.bind(this))},addPackedTexture:function(e){this._allMaterialsPackingCalled&&this._dirtyPackedTextures.push(e)},removePackedTexture:function(e){var t=this._dirtyPackedTextures.indexOf(e);t>=0&&(this._dirtyPackedTextures[t]=void 0)},packAllMaterialsTextures:function(e){for(var t in e)for(var i=e[t].get("stateSet"),n=i.getNumTextureAttributeLists(),r=0;r<n;++r){var a=i.getTextureAttribute(r,"Texture");a&&a.getTexture&&a.getTexture()}this._allMaterialsPackingCalled=!0},resetCaches:function(){var e=this.frameBufferObject;e&&e.releaseGLObjects(),this._cacheCameras={},this._currentPackingCameras=[]},deleteUnusedCameras:function(e){var t={};for(var i in e)for(var n=e[i].get("stateSet"),r=n.getNumTextureAttributeLists(),a=0;a<r;++a){var o=n.getTextureAttribute(a,"Texture");if(o&&o.getTexture)t[this._getHash(o)]=!0}var s=this._cacheCameras;for(var l in s)if(!t[l]){var u=s[l];u.disablePacking(),u.getParents()[0].removeChild(u),delete this._cacheTextures[l]}},packTextures:function(e){var t=e.getPackedTextures(),i=e.getOrderedChannels();if(0===i.length)return p.Texture.textureNull;var n=t[i[0]].texture;if(1===i.length)return n;var r=this._getHash(e);if(this._cacheCameras[r])return this._cacheCameras[r]._outTexture;var a=new s.Z;a.setForceUpload(!0),a.generateMipmap=function(){this._rttPass||p.Texture.prototype.generateMipmap.apply(this,arguments),this._rttPass=!1},a.setImageFormat(p.Texture.RGBA),a.setWrapS(n.getWrapS()),a.setWrapT(n.getWrapT()),a.setMagFilter(n.getMagFilter());var o=n.getMinFilter();a.setMinFilter(o),o===p.Texture.LINEAR_MIPMAP_LINEAR&&(0,d.Z)().anisotropy&&a.setMaxAnisotropy(16);var l=new v(a,e);return l.getOrCreateStateSet().setAttributeAndModes(this._program,m),this._cacheCameras[r]=l,this.addChild(l),a},_getHash:function(e){var t="";if(e.getOrderedChannels().length<=1)return t;for(var i=e.getPackedTextures(),n=e.getOrderedChannels(),r=0;r<n.length;++r){var a=n[r],o=i[a].texture,s=A.Z.getDefaultComponentCount(a);t+=o.getInstanceID()+"-"+s+"-"}return t},_createNewJobs:function(){var e=this._dirtyPackedTextures,t=e.length;if(t){for(var i=0;i<t;++i)e[i]&&e[i].getTexture();e.length=0}},_disableOldJobs:function(){var e=this._currentPackingCameras,t=e.length;if(!t)return 0;for(var i=0;i<t;++i)e[i].disablePacking();return e.length=0,h.Z.draw(),t},_updateNewJobs:function(e){for(var t=this._currentPackingCameras,i=this.getChildren(),n=i.length,r=0;r<n;++r){var a=i[r].updatePacking(e);if(0!==a){if(a<0)return t.length||-1;t.push(i[r])}}return t.length},_checkResolveHighResBound:function(){if(this._canResolveHighRes&&!this._highResDone){this._highResDone=!0,u.Z.resolveHighResBound(),(0,d.Z)().textureFrameBudget=1/0;var e=this.getChildren(),t=e.length;c.Z.logMessage("Texture packing FBO Count : "+t),v.AUTO_RELEASE_GL=!0;for(var i=0;i<t;++i){var n=e[i].frameBufferObject;n&&n.releaseGLObjects()}}},_checkResolveLowResBound:function(){this._lowResDone||(this._lowResDone=!0,u.Z.resolveLowResBound())},cull:function(e,t){if(this._frameCount++,0===this._frameCount)return!0;this._createNewJobs();var i=this._disableOldJobs(),n=this._updateNewJobs(t.getRenderer().getState());return this._frameCount>1&&!i&&!n&&(this._checkResolveLowResBound(),this._checkResolveHighResBound()),!0}}));var E=new S;E.setMaterials=function(e){C=e};const y=E},"+eNq":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n={PICK_GEOMETRY_FIXED:1,PICK_GEOMETRY_ANIMATED:2,PICK_GEOMETRY_RIG_BOX:4,PICK_GIZMO_LIGHT:8,SHADOW_CAST:16,SHADOW_BOUNDS:32};n.PICK_GEOMETRY_SLOW=n.PICK_GEOMETRY_FIXED|n.PICK_GEOMETRY_ANIMATED,n.PICK_GEOMETRY_FAST=n.PICK_GEOMETRY_FIXED|n.PICK_GEOMETRY_RIG_BOX,n.PICK_GEOMETRY=n.PICK_GEOMETRY_FIXED|n.PICK_GEOMETRY_ANIMATED|n.PICK_GEOMETRY_RIG_BOX,n.PICK=n.PICK_GEOMETRY|n.PICK_GIZMO_LIGHT,n.SHADOW=n.SHADOW_BOUNDS|n.SHADOW_CAST,n.PICK_GEOMETRY_SHADOW=n.PICK_GEOMETRY|n.SHADOW,n.NO_SHADOW=~n.SHADOW,n.NO_PICK=~n.PICK,n.NO_PICK_NO_SHADOW_CAST=~(n.PICK|n.SHADOW_CAST),n.NO_PICK_NO_SHADOW_BOUNDS=~(n.PICK|n.SHADOW_BOUNDS),n.NO_PICK_NO_SHADOW=~(n.PICK|n.SHADOW);const r=n},"0z3s":(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("uuWb"),r=i("OBBi"),a=i("3o3Y"),o=n.Z.osg,s=function(){o.StateAttribute.call(this),this._channelMapping={},this._materialModel=void 0,this._stateSetContext=void 0,this._additive=!1,this._depthWrite=!0,this._castShadows=!0,this._hashes=["",""],this._dirtyUniforms=!0,this._activeChannels=[]};s.SHADING_COMPILER=0,s.EARLYZ_COMPILER=1,s.SHADOWCAST_COMPILER=2,s.WIREFRAME_COMPILER=3,s.CURRENT_COMPILER=s.SHADING_COMPILER,(s.compilerChannels=[])[s.SHADING_COMPILER]=r.Z,s.compilerChannels[s.EARLYZ_COMPILER]=["AlphaMask","Opacity","Displacement","SubsurfaceScattering"],s.compilerChannels[s.SHADOWCAST_COMPILER]=["Displacement","AlphaMask","Opacity"],s.compilerChannels[s.WIREFRAME_COMPILER]=["Displacement"],s.hasVertexColor=!1,s.hasVertexAlpha=!1,o.createPrototypeStateAttribute(s,o.objectInherit(o.StateAttribute.prototype,{attributeType:"SketchfabMaterial",dirtyMaterial:function(){for(var e=this._hashes.length,t=0;t<e;++t)this._hashes[t]="";this._dirtyUniforms=!0},getHash:function(){if(!this._materialModel)return"";var e=this._hashes[s.CURRENT_COMPILER];if(e)return e;e=this.attributeType,s.CURRENT_COMPILER!==s.WIREFRAME_COMPILER&&(e+=this.getVertexAlphaEnable()?"1":"0"),s.CURRENT_COMPILER===s.SHADING_COMPILER&&(e+=this.getShadeless()?"1":"0",e+=this.getVertexColorEnable()?"1":"0",e+=this.getHasOnlyPoints()?"1":"0",e+="srgb"===this.getVertexColorColorSpace()?"1":"0",e+=a.Z.get("hasSsr")?"1":"0");for(var t=s.CURRENT_COMPILER===s.SHADOWCAST_COMPILER,i=this._materialModel.getChannels(),n=s.compilerChannels[s.CURRENT_COMPILER],r=n.length,o=this._channelMapping,l=0;l<r;++l){var u=n[l],h=i[u];if(h.isEnableEffective())if(!t||this._castShadows){var c=o[u];e+=".",e+=c<0?"":c,e+=h.getShaderHash(),e+=this.getChannelPacking(u)}else e+=".0";else e+=".0"}return this._hashes[s.CURRENT_COMPILER]=e,e},setMaterialModel:function(e){this._materialModel=e},setStateSetContext:function(e){this._stateSetContext=e},setChannelMapping:function(e,t){this._channelMapping[e]=t},getChannelPacking:function(e){return this._stateSetContext?this._stateSetContext.getChannelPacking(e):""},updateOpacity:function(){this._additive=!1,this._depthWrite=!0,this._castShadows=!0;var e=this._materialModel.getChannels().Opacity;if(e.isEffective()){var t=e.getTransparency();if("dithering"!==t){if("additive"===t)return this._additive=!0,this._depthWrite=!1,void(this._castShadows=!1);var i=!1;return 1===e.getFactor()&&(i=e.getTextureModel()||this.getVertexAlphaEnable()),i?void 0:(this._depthWrite=!1,void(this._castShadows=!1))}}},cloneType:function(){return new s},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getMaterialModel:function(){return this._materialModel},getShadeless:function(){return this._materialModel&&this._materialModel.get("shadeless")},getReflection:function(){return this._materialModel&&this._materialModel.get("reflection")},getVertexColorEnable:function(){return this._materialModel&&this._materialModel.get("vertexColorEnable")},getVertexAlphaEnable:function(){return this._materialModel&&this._materialModel.get("vertexAlphaEnable")},getVertexColorColorSpace:function(){return this._materialModel&&this._materialModel.get("vertexColorColorSpace")},getCullFace:function(){return this._materialModel&&this._materialModel.get("cullFace")},getHasOnlyPoints:function(){return this._materialModel&&this._materialModel.hasOnlyPoints()},getAdditive:function(){return this._additive},getDepthWrite:function(){return this._depthWrite},getCastShadows:function(){return this._castShadows},getChannelMapping:function(e){return this._channelMapping[e]},getOrCreateUniforms:function(){if(s.uniforms)return s.uniforms;var e=s.uniforms={};e.uReflection=o.Uniform.createFloat("uReflection");for(var t=i("dq/g").Z,n=r.Z.length,a=0;a<n;++a){var l=r.Z[a],u=t[l].model;u.prototype.addUniforms.call(u,e,l)}return e},_cacheChannelUniforms:function(){var e=this.getOrCreateUniforms(),t=this._materialModel.getChannels(),i=r.Z.length,n=this._activeChannels;n.length=0;for(var a=0;a<i;++a){var o=t[r.Z[a]];o.isEnableEffective()&&(o.cacheUniforms(e),n.push(o))}},apply:function(){if(this._materialModel){this._dirtyUniforms&&(this._dirtyUniforms=!1,this._cacheChannelUniforms()),this.getOrCreateUniforms().uReflection.setFloat(this.getReflection());for(var e=this._activeChannels,t=e.length,i=0;i<t;++i)e[i].updateUniforms()}}}),"osgSketchfab","Material");const l=s},"iI+4":(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var n=i("lZH+"),r=i.n(n),a=i("uuWb"),o=i("iEQ1"),s=i("JeqU"),l=i("2fWj"),u=i("O/gg"),h=i("iO85"),c=i("5Cxy"),A=a.Z.osg,d=function(){A.Texture.call(this),this._isVideo=!1,this._requireOriginalCompression=!1,this._imageModel=void 0,this._convertNPOT=!0,this._truePackingRead=void 0},g=A.ImageStream.prototype.play;A.ImageStream.prototype.play=function(){this._status!==A.ImageStream.PLAYING&&(h.Z.draw(),g.call(this))};var f=-1===navigator.userAgent.indexOf("Firefox/46");A.createPrototypeStateAttribute(d,A.objectInherit(A.Texture.prototype,{isVideo:function(){return this._isVideo},getOriginalFormat:function(){return this._truePackingRead||this.getInternalFormat()},_resizeToNearestPowerOf2:function(e){var t=document.createElement("canvas"),i=t.width=l.Z.floorPowerOf2(e.getWidth()),n=t.height=l.Z.floorPowerOf2(e.getHeight()),r=t.getContext("2d");r.drawImage(e.getImage(),0,0,i,n);var a=this._internalFormat;if(a===A.Texture.RGB||a===A.Texture.RGBA)return t;for(var o=r.getImageData(0,0,i,n).data,s=a===A.Texture.ALPHA?3:0,u=i*n,h=new Uint8Array(u),c=0;c<u;++c)h[c]=o[4*c+s];return this.setTextureSize(i,n),h},setImage:function(e,t){var i=e instanceof A.Image;if(!i||e.isDirty()||e!==this.getImage()&&e!==this._lastSetImage){this._lastSetImage=e;var n=e instanceof A.ImageStream;this._convertNPOT&&i&&!n&&(l.Z.isPowerOf2(e.getWidth())&&l.Z.isPowerOf2(e.getHeight())||(e.setDirty&&e.setDirty(!1),e=this._resizeToNearestPowerOf2(e))),!f&&this.hasMipmapFilter()&&this.setMinFilter(this.getMagFilter()),A.Texture.prototype.setImage.call(this,e,t),h.Z.draw()}},applyTexImage2D:function(){A.Texture.prototype.applyTexImage2D.apply(this,arguments),h.Z.draw()},getResourceManager:function(){return this._resourceManager||i("WIA/").Z.instance},setImageModel:function(e){this._imageModel=e,this._isVideo=e.isVideo(),this.updateRequireOriginalCompression();var t=this.getImageJSONMaxSupported();t.options&&"A"===t.options.format?(this._truePackingRead=A.Texture.ALPHA,this.setInternalFormat(A.Texture.LUMINANCE)):this._truePackingRead=void 0},getImageModel:function(){return this._imageModel},getImageCount:function(){var e=this._imageModel;return e&&e.getImages?e.getImages().length:this._image?1:0},setImageSmallest:function(){var e=this.getImageSmallest();if(e)return!0===e.promise.isFulfilled()&&e.image?this.setImage(e.image):this._setEntryImage(e,e.promise),e},setImageMaxSupported:function(){var e=this.getImageMaxSupported();if(e){var t=(0,c.Z)().preload?r().resolve():u.Z.getFirstCameraAnimation(),i=r().all((0,o.Z)([t,e.promise,u.Z.getLowResBound()],(function(e){return e.reflect()})));return this._setEntryImage(e,i),e}},_setEntryImage:function(e,t){this._lastEntry=e,e.promise=t.then(function(){return this._lastEntry!==e?this._lastEntry.promise:(this.setImage(e.image),e.image)}.bind(this))},getImageSmallest:function(){if(this._imageModel){var e=this._requireOriginalCompression?void 0:this.getOriginalFormat(),t=this._imageModel.findImageNearestToResolution(128,128,e);return this.getResourceImage(t)}},updateRequireOriginalCompression:function(){var e=(0,s.Z)(),t=this._imageModel.findImageNearestPowerOfTwoUpToResolution(e,e,this.getOriginalFormat()),i=this._imageModel.findImageNearestPowerOfTwoUpToResolution(e,e),n=Math.min(e,l.Z.floorPowerOf2(i.width)),r=Math.min(e,l.Z.floorPowerOf2(i.height));return this._requireOriginalCompression=t.width<n||t.height<r,this._requireOriginalCompression},getImageJSONMaxSupported:function(e){e=(0,s.Z)(e);var t=this._requireOriginalCompression?void 0:this.getOriginalFormat();return this._imageModel.findImageNearestPowerOfTwoUpToResolution(e,e,t)},getImageMaxSupported:function(){if(this._imageModel)return this.getResourceImage(this.getImageJSONMaxSupported())},getImageWidget:function(){if(this._imageModel){var e=this._imageModel.findImageWidget();return e.options?e.options.widget=!0:e.options={widget:!0},this.getResourceImage(e,!0)}},getResourceImage:function(e,t){!t&&e.url&&e.width*e.height>1048576&&(e.options=e.options||{},e.options.decodeAsync=!0),e.pk&&(e.options.pk=e.pk);var i=this.getResourceManager().getOrCreateImage(e.url,e.options);return i.promise.progressSize=e.size,i},_shouldBindNull:function(){return!!this._textureNull||(this._image?!this._image.isReady():0===this._textureHeight||0===this._textureWidth)},_requestUploadBudget:function(e){var t=this._textureWidth*this._textureHeight,i=this._forceUpload||h.Z.requestTextureBudget(t);return i||h.Z.draw(),i||e||this._gl.texImage2D(this._textureTarget,0,this._getInternalFormatGL(),1,1,0,this._internalFormat,this._getTypeGL(),null),i},setForceUpload:function(e){this._forceUpload=e},apply:function(e){var t=e.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1,this.setGraphicContext(t)),this._textureObject&&!this.isDirty())return this._textureObject.bind(t),void 0!==this._image&&this._image.isDirty()&&this.applyImage(t),this.isDirtyMipmap()&&this.generateMipmap(t,this._textureTarget),!0;if(this._shouldBindNull())return t.bindTexture(this._textureTarget,null),!0;if(this.computeTextureFormat(),this._image){var i=this._image.getWidth()||this._textureWidth,n=this._image.getHeight()||this._textureHeight;this.setTextureSize(i,n)}var r=!!this._textureObject;return this._textureObject||this.init(e),this._textureObject.bind(t),!!this._requestUploadBudget(r)&&(this.applyImage(t),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1,!0)},getHash:function(){return"osgSketchfabTexture"}}),"osgSketchfab","MultiresTexture"),(d.dummyTexture=new d).setName("MultiresDummyTexture"),d.dummyTexture.setTextureSize(1,1);const p=d},"0Iaf":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("uuWb").Z.osg,r=function(){n.TextureCubeMap.call(this),this._imageProxy=void 0};n.createPrototypeStateAttribute(r,n.objectInherit(n.TextureCubeMap.prototype,{getHash:function(){return"osgSketchfabTexture"}}),"osgSketchfab","TextureCubeMap"),(r.dummyTexture=new r).setTextureSize(1,1);const a=r},C4z1:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("uuWb").Z.osg;const r={uProjFactor:n.Uniform.createFloat("uProjFactor"),uSsaoRadius:n.Uniform.createFloat("uSsaoRadius"),uSsaoIntensity:n.Uniform.createFloat("uSsaoIntensity"),uSsaoBias:n.Uniform.createFloat("uSsaoBias"),uSsaoProjectionInfo:n.Uniform.createFloat4("uSsaoProjectionInfo"),uSsaoProjectionScale:n.Uniform.createFloat(1,"uSsaoProjectionScale"),uDofBlurNearFarFocal:n.Uniform.createFloat3("uDofBlurNearFarFocal"),uDofCross:n.Uniform.createFloat3(n.vec3.create(),"uDofCross"),uDofScale:n.Uniform.createFloat(1,"uDofScale"),uBloomFactor:n.Uniform.createFloat("uBloomFactor"),uBloomThreshold:n.Uniform.createFloat("uBloomThreshold"),uBloomRadius:n.Uniform.createFloat("uBloomRadius"),uChromaFactor:n.Uniform.createFloat("uChromaFactor"),uColorBalanceLow:n.Uniform.createFloat3("uColorBalanceLow"),uColorBalanceMid:n.Uniform.createFloat3("uColorBalanceMid"),uColorBalanceHigh:n.Uniform.createFloat3("uColorBalanceHigh"),uToneExposure:n.Uniform.createFloat("uToneExposure"),uToneBrightness:n.Uniform.createFloat("uToneBrightness"),uToneContrast:n.Uniform.createFloat("uToneContrast"),uToneSaturation:n.Uniform.createFloat("uToneSaturation"),uToneMethod:n.Uniform.createInt("uToneMethod"),uDistortion:n.Uniform.createFloat2("uDistortion"),uProjectionLeft:n.Uniform.createFloat4("uProjectionLeft"),uUnprojectionLeft:n.Uniform.createFloat4("uUnprojectionLeft"),uSharpFactor:n.Uniform.createFloat("uSharpFactor"),uLensRadius:n.Uniform.createFloat2("uLensRadius"),uTimeGrain:n.Uniform.createFloat("uTimeGrain"),uGrainFactor:n.Uniform.createFloat("uGrainFactor"),uTaaMotionMatrixLeft:n.Uniform.createMatrix4("uTaaMotionMatrixLeft"),uTaaCornersCSLeft:n.Uniform.createFloat4Array("uTaaCornersCSLeft",2),uTaaEnabled:n.Uniform.createFloat(1,"uTaaEnabled"),uTaaInvViewMatrixLeft:n.Uniform.createMatrix4("uTaaInvViewMatrixLeft"),uTaaCurrentFramePVLeft:n.Uniform.createMatrix4("uTaaCurrentFramePVLeft"),uTaaLastFramePVLeft:n.Uniform.createMatrix4("uTaaLastFramePVLeft"),uTaaMotionMatrixRight:n.Uniform.createMatrix4("uTaaMotionMatrixRight"),uTaaCornersCSRight:n.Uniform.createFloat4Array("uTaaCornersCSRight",2),uTaaInvViewMatrixRight:n.Uniform.createMatrix4("uTaaInvViewMatrixRight"),uTaaCurrentFramePVRight:n.Uniform.createMatrix4("uTaaCurrentFramePVRight"),uTaaLastFramePVRight:n.Uniform.createMatrix4("uTaaLastFramePVRight"),uVrFadeFactor:n.Uniform.createFloat(0,"uVrFadeFactor"),uVrVeilFactor:n.Uniform.createFloat(1,"uVrVeilFactor")}},"jO+y":(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n={OPAQUE:0};n.OPAQUE_NO_EARLYZ=n.BACKGROUND=1,n.REFRACTION=2,n.TRANSPARENT_CUSTOM_EARLYZ=8,n.TRANSPARENT_NO_EARLYZ_PRE=9,n.TRANSPARENT=10,n.TRANSPARENT_NO_EARLYZ_POST=11,n.EXTRA=19,n.EDITOR_GIZMO=n.HOTSPOT=20,n.GRID=n.TOOLTIP=n.VR_MENU=21,n.WIREFRAME=n.VR_CURSOR=22,n.OUTLINE=23,n.DEBUG=24,n.DEBUG_2=25;const r=n},iO85:(e,t,i)=>{"use strict";i.d(t,{Z:()=>w});var n,r,a,o,s=i("uuWb"),l=i("59ul"),u=i("6QKU"),h=i("lZH+"),c=i.n(h),A=i("O/gg"),d=i("5Cxy"),g=s.Z.osg,f={},p=-1,m=0,_=!1,v=40,C=g.Timer.instance().tick(),b=!1,S=!1,E=(0,u.X2)(),y=function(){(window.setTimeout(y,v),n&&r)&&(b||f.isDrawAlreadyQueued()||((0,u.BG)()&&!A.Z.getHighResBound().isFulfilled()&&o(),g.Timer.instance().tick()-C-v<=v||(r.enable(),p=-1)))};(0,l.Z)()||window.setTimeout(y,v),o=function(){a||(a=new(c())((function(e){e()})).finally((function(){n.requestRedraw(),n.frame(),a=void 0})))};var I=function(e){if(n&&!b){if((0,u.BG)())return o(),void(S=!0);S=!1;var t=f.isDrawAlreadyQueued();if(t||n.requestRedraw(),r&&!e&&(r.reset(),!t)){var i=g.Timer.instance().tick();m+=i-C,0===++p?(p=0,m=0):4===p&&(v=Math.min(200,Math.max(16,m/p)),p=0,m=0),C=i}}};f.setPoseForScreenshot=function(e){b=e},f.isDrawAlreadyQueued=function(){return n._requestRedraw},f.draw=function(){I()},f.drawNoJitter=function(){this._doJitter=!1,I()},f.drawSameFrame=function(){I(!0)},f.redrawShadow=function(){_=!0,I()},f.redrawShadowNextFrame=function(){window.setTimeout(f.redrawShadow,0)},f.getShadowForcedUpdate=function(){return _},f.setShadowForcedUpdate=function(e){_=e},f.setViewer=function(e){n=e},f.setSuperSample=function(e){r=e},f.getSuperSample=function(){return r},f.getFrameTimeAverage=function(){return v},f.requestDrawHiddenDefered=function(){o()};var x=0,T=0;f.requestTextureBudget=function(e){if(!A.Z.getModelDisplayed().isResolved())return!0;if(!n)return!0;var t=n.getFrameStamp().getFrameNumber();if(T<t&&(T=t,x=0),(x+=e)===e)return!0;var i=(0,d.Z)().textureFrameBudget;return x<=i*i},E&&document.addEventListener(E,(function(){S&&I()}));const w=f},LyKb:(e,t,i)=>{"use strict";i.d(t,{Z:()=>T});var n=i("JAIH"),r=i("lZH+"),a=i.n(r),o=i("Hjnd"),s=i.n(o),l=i("/HjK"),u=i("iEQ1"),h=i("gmtI"),c=i("PSPx"),A=i("UNIa"),d=i("qKlK"),g=i("XF2a"),f=i("yfOW"),p=i("510x"),m=i("gQUg"),_=i("rRD0"),v=i("p5Kp"),C=i("Z10h"),b=i("uuWb"),S=i("cgbd"),E=b.Z.osg;function y(e,t){var i,n=e.getImageModel(),r=e.getMultiresTexture().getImage().getImage();if(!r.toBlob){if(!r.toDataURL){var o=r;if(r=document.createElement("canvas"),void 0!==o.width)r.width=o.width,r.height=o.height,r.getContext("2d").drawImage(o,0,0);else{var s=r.getContext("2d"),l=e.getImageModel().getImages()[0];r.width=l.width,r.height=l.height;var u=s.getImageData(0,0,l.width,l.height);u.data.set(o),s.putImageData(u,0,0)}}return(i=(0,m.Z)(r.toDataURL(t.type,.95))).name=t.name,n.set("imageFile",i),n}r.toBlob((function(e){return e.name=t.name,n.set("imageFile",e),a().resolve(n)}),t.type,.95)}function I(e,t){return a().resolve(e.save(t).then((function(t){e.set("uid",t.uid)})))}var x={FeatureName:"saveUI",ModelName:"Material",ViewListType:[f.Z.extend({savingEnabled:!1,constructor:function(){this.onSave=(0,l.Z)(this.onSave,1e3),f.Z.apply(this,arguments)},initialize:function(){f.Z.prototype.initialize.apply(this,arguments),s()(".save-model").click(this.onSave.bind(this));var e=this.options.context;this._features=e.getFeatures();var t=e.getModel();t&&(this.listenTo(t,"status:loaded",this.enableSaving.bind(this)),this.listenTo(t,"status:pending",this.disableSaving.bind(this)))},onSave:function(e){e.preventDefault();var t=g.n2.store.getState();g.wl.authUser.canAccessFeature("ff_read_only_mode",t)?v.Z.showPopup():this.save()},save:function(){var e=this._features.inspector.getModel(),t=e.get("displayView");e.set("displayView","Default");var i=this._save();return i.finally((function(){e.set("displayView",t)})),i},_save:function(){if(!this.savingEnabled)return a().reject(new Error("Model is still loading. Please try to save again later."));if(s()(".save-model").hasClass("progress"))return a().reject(new Error("Already saving previous changes. Please try to save again later."));s()(".save-model").addClass("progress");var e={modelUID:this.options.context.getModel().get("uid"),userUID:this.options.context.getModel().get("user").uid},t=this,i=[];return this.cancelSave=!1,a().resolve(this.checkVersion(i)).then(function(){return a().all([this.saveBackgroundImages(e,i),this.saveMaterialImages(e,i),this.saveTexturesColorspace(e,i),this.saveHotspots(e,i),this.saveAnimations(e,i),this.saveSounds(e,i),this.saveGroundTexture(e,i)].map((function(e){return e.reflect()})))}.bind(this)).then(function(){return i.length>0||this.cancelSave?a().reject(new Error):t.saveOptions()}.bind(this)).then((function(){return i.length>0?a().reject(new Error):a().all([t.deleteTextures(i),t.deleteMatcaps(i),t.deleteBackgroundImages(i),t.deleteAnimations(i),t.deleteEnvironments(i),t.deleteGroundTexture(i)].map((function(e){return e.reflect()})))})).then(function(){if(i.length>0)return a().reject(new Error);s()(".save-model").removeClass("progress"),s()(".save-model").addClass("success"),setTimeout((function(){s()(".save-model").removeClass("success")}),4e3)}.bind(this)).catch(function(e){if(s()(".save-model").removeClass("progress"),e&&503===e.status)v.Z.showPopup();else{if(this.cancelSave)return;var t="";if(i.length)t=i.join("<br/>");else{t="An unexpected error happened while saving the following settings : <br/><ul>";var n=e&&e.responseJSON&&e.responseJSON.detail||e&&e.response&&e.response.data.detail||e;if(n){E.error(n);var r="string"==typeof n?{"":[n]}:n;for(var a in r)t+="<li>&bullet; "+(a?a+": ":"")+r[a].join(", ")+"</li>"}t+="</ul>"}t+='<br/>Contact our support team <a href="'+d.Z.hosts.faq+'/requests/new?type=3d_viewing&utm_source=website&utm_campaign=save_error" target="_blank">here</a> if you need help.';var o=new S.Z({title:"Error",text:t,buttons:{ok:!0},safe:!0});o.open().then(o.close.bind(o))}}.bind(this))},deleteUnusedResources:function(e,t,i){if(0===e.length)return a().resolve();var n="Errors while deleting the following "+t+" :<br/><ul>",r=!1,o=(0,u.Z)(e,(function(e){return a().resolve(e.destroy()).catch((function(t){var i=t&&t.responseJSON&&t.responseJSON.detail;n+="<li>&bullet; "+(0,C.escapeHTML)(e.get("name"))+" : "+i+"</li>",e.trigger("restore",e),r=!0}))}));return e.length=0,a().all(o).then((function(){if(r)return i.push(n+"</ul>"),a().reject(new Error)}))},deleteTextures:function(e){var t=this._features.material.getModel()._textureTrashbin,i=(0,u.Z)(t,(function(e){return new h.Z({uid:e})}));return t.length=0,this.deleteUnusedResources(i,"material textures",e)},deleteMatcaps:function(e){var t=this._features.material.getModel()._matcapTrashbin;return this.deleteUnusedResources(t,"matcap textures",e)},deleteAnimations:function(e){var t=this._features.animation.getModel().get("animations")._trashbin;return this.deleteUnusedResources(t,"animations",e)},deleteEnvironments:function(e){var t=this._features.environment.getModel()._trashbin;return this.deleteUnusedResources(t,"environments",e)},deleteBackgroundImages:function(e){var t=this._features.background.getModel()._trashbin;return this.deleteUnusedResources(t,"backgrounds",e)},deleteGroundTexture:function(e){var t=this._features.ground.getModel()._trashbin;return this.deleteUnusedResources(t,"ground",e)},saveBackgroundImages:function(e,t){var i=[];return this._features.background.getModel().backgroundCollection.each((function(n){if(n.isNew()){var r=I(n,e);r.catch((function(e){var i=0;if(e.responseJSON.detail.imageFile)for(i=0;i<e.responseJSON.detail.imageFile.length;i++)e.responseJSON.detail.imageFile[i].match("The image should be less than 4mb")&&t.push("Background image is too big (max: 4MB)")})),i.push(r)}})),a().all(i)},saveGroundTexture:function(e,t){var i=this._features.ground.getModel(),n="BakedAO"===i.get("shadowMode");if(i.get("enable")&&i.get("dirty")&&n){var r=i.get("imageCanvas"),o=(0,m.Z)(r.toDataURL("image/jpeg",.95));o.name="internal_ground_ao_texture";var s=new h.Z({name:o.name,imageFile:o}),l=I(s,e);return l.then((function(){i.set("aoTextureUid",s.get("uid")),i.set("dirty",!1)})),l.catch((function(){t.push("Error while saving the baked AO texture "),i.set("enable",!1)})),a().resolve(l)}if(!i.get("enable")||!n){var u=i.get("aoTextureUid");u&&(i._trashbin.push(new h.Z({uid:u})),i.set("aoTextureUid",void 0))}return a().resolve()},saveMaterialImages:function(e,t){var i,n={},r=this._features.material,o="Errors while saving the following texture materials :<br/><ul>",s=!1;return i=Object.values(r.getModel().attributes).reduce((function(e,t){var i=t.getChannels();return e.concat(Object.values(i).filter((function(e){if(e.transient)return!1;var t=e.getTextureModel();if(!t)return!1;var i=t.getImageModel();if(!i||!i.isNew())return!1;var r=i.getUID();return 1!==n[r]&&(n[r]=1,!0)})).map((function(e){var t=e.getTextureModel(),i=t.getImageModel();return new(a())((function(e){var n=i.get("imageFile");if(void 0===n){var r=i.findImageNearestToResolution(16384,16384),a=(0,m.Z)(r.url);return i.set("imageFile",a),e(i)}if(0===n.size)e(y(t,n));else if(window.File){var o=new FileReader;o.onload=function(){this.readyState===FileReader.DONE?e(i):e(y(t,n))},o.onerror=function(){e(y(t,n))},o.readAsArrayBuffer(n)}}))})))}),[]),a().map(i,(function(t){return I(t,e).catch((function(e){var i=e&&e.responseJSON&&e.responseJSON.detail;i=i&&i.imageFile&&i.imageFile[0],o+="<li>&bullet; "+(0,C.escapeHTML)(t.get("name"))+" : "+i+"</li>",s=!0}))}),{concurrency:4}).then((function(){if(s)return t.push(o+"</ul>"),a().reject(new Error)}))},checkVersion:function(e){var t=this.options.context.getModel();return A.Z.getModelVersion(t.get("uid"),t.get("version").uid).then((function(i){return t.set("version",i),i.isCurrentVersion?a().resolve():new S.Z({title:"Update old version",text:"You are about to update an old version of your model.<br/>These changes will not show up on the model page.<br/>To update the latest version, go to 3D settings from the model page.<br/><br/>Do you wish to update the old version?",buttons:{ok:!0,cancel:!0},safe:!0}).open().catch((function(){e.push("You chose not to update this older version of your model.")}))}))},saveOptions:function(){var e=this.options.context,t=e.getModel(),i=e.getViewer(),n=i.getOptionsJSON();if(i.getFeaturesManager().registerOptionsJSON(n),n.animation)for(var r=this._features.animation.getModel().get("animations")._trashbin,a=0;a<r.length;a++)r[a]&&n.animation.order.splice(a,0,r[a].get("uid"));return t.set({options:n}),A.Z.patchModelOptions(t.get("uid"),t.get("version").uid,n)},saveHotspot:function(e,t,i){return e.save(t).catch((function(t){if(i.push("Annotation #"+(+e.get("order")+1)+" could not be saved."),t.responseJSON&&t.responseJSON.detail){var n=0;if(t.responseJSON.detail.name)for(n=0;n<t.responseJSON.detail.name.length;n++)t.responseJSON.detail.name[n].match("This field is required.")?i.push("Title is required."):t.responseJSON.detail.name[n].match("Ensure this value has at most 64 characters")?i.push("Title is too long (64 characters max)."):i.push(t.responseJSON.detail.name[n]);if(t.responseJSON.detail.content)for(n=0;n<t.responseJSON.detail.content.length;n++)t.responseJSON.detail.content[n].match("Ensure this value has at most 1024 characters")?i.push("Description is too long (1024 characters max)."):i.push(t.responseJSON.detail.content[n])}}))},deleteHotspot:function(e,t,i,n){return e.remove(t).catch((function(){n.push(e),i.push("An annotation could not be deleted. Please try saving your settings again.")}))},saveHotspots:function(e,t){var i=this._features.hotspot.getModel(),n=i.get("hotspots"),r=this.options.context.getModel().toJSON(),o=(0,p.A8)(r),s=d.Z.maxHotspotsPerModel[o];if(n.length>s)return i.trigger("hotspot-error",new _.r(void 0,"hotspot",n.length,s,c.Z.me().toJSON().account)),this.cancelSave=!0,a().reject();if(n.models.some((function(e){return!e.get("name")}))){var l=new S.Z({title:"Error",text:"All your annotations must have a title.",buttons:{ok:!0},safe:!0});return l.open().then(l.close.bind(l)),this.cancelSave=!0,a().reject()}var u=[],h=this,A=i.hotspotsToBeDeleted.map((function(i){return h.deleteHotspot(i,e,t,u)}));return i.hotspotsToBeDeleted=u,a().all(A).then((function(){return a().all(n.map((function(i){return i.set("order",n.indexOf(i)),h.saveHotspot(i,e,t)})))}))},saveTexturesColorspace:function(e,t){var i="Errors while changing the following texture colorspace :<br/><ul>",n=!1,r=[];return this.model.getImageCollection().each((function(e){!e.isNew()&&e.hasChanged("colorSpace")&&r.push(e.saveColorspace().catch((function(t){var r=t&&t.responseJSON&&t.responseJSON.detail;i+="<li>&bullet; "+(0,C.escapeHTML)(e.get("name"))+" : "+r+"</li>",n=!0})))})),a().all(r).then((function(){if(n)return t.push(i+"</ul>"),a().reject(new Error)}))},saveAnimations:function(e,t){var i=this._features.animation.getModel(),n="Errors while saving the following animations :<br/><ul>",r=!1,o=i.get("animations").map((function(t){return t.save(e).catch((function(e){var i=e&&e.responseJSON&&e.responseJSON.detail;n+="<li>&bullet; "+(0,C.escapeHTML)(t.get("name"))+" : "+i+"</li>",r=!0}))}));return a().all(o).then((function(){if(r)return t.push(n+"</ul>"),a().reject(new Error)}))},saveSounds:function(e,t){var i=this._features.sound.getModel(),n=i.get("soundtracks"),r=this.options.context.getModel().toJSON(),o=(0,p.A8)(r),s=d.Z.maxSoundtracksPerModel[o];if(this.maxSoundtracksCount=d.Z.maxSoundtracksPerModel[o],n.length>s)return i.trigger("sound-error",new _.r(void 0,"sound",n.length,s,c.Z.me().toJSON().account)),this.cancelSave=!0,a().reject();var l=!1,u="Errors while saving the following sounds :<br/><ul>",h=a().resolve();return n.each((function(t){h=h.then((function(){return t.save(e)})).catch((function(e){var i=e&&e.responseJSON&&e.responseJSON.detail;return i&&i.__all__&&(i=i.__all__[0]),i&&i.soundFile&&(i=i.soundFile[0]),u+="<li>&bullet; "+(0,C.escapeHTML)(t.get("name"))+" : "+i+"</li>",l=!0,a().resolve()}))})),h.then((function(){if(l)return t.push(u+"</ul>"),a().reject(new Error)}))},enableSaving:function(){this.savingEnabled=!0,s()(".save-model").removeClass("btn-disabled")},disableSaving:function(){this.savingEnabled=!1,s()(".save-model").addClass("btn-disabled")}})]};const T=n.Z.create(x)},U4yk:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("uuWb"),r=i("oIlX"),a=i("jO+y"),o=i("jQgr"),s=n.Z.osg,l=s.Uniform.createFloat4("uColor"),u=new r.Z(l.getInternalArray(),1),h=function(){s.StateSet.call(this),this.init()};h.updateCallback=u,s.createPrototypeObject(h,s.objectInherit(s.StateSet.prototype,{setRenderBinVR:function(e){var t=e?a.Z.TRANSPARENT_NO_EARLYZ_POST:a.Z.WIREFRAME;this.setRenderBinDetails(t,"RenderBin")},init:function(){this.setRenderBinDetails(a.Z.WIREFRAME,"RenderBin"),this.setAttributeAndModes(o.Z.DEPTH_LEQUAL_WRITE),this.setAttributeAndModes(o.Z.BLEND_SUBSTRACTIVE),this.setShaderGeneratorName("wireframe"),this.addUniform(l),this.addUpdateCallback(u)},setWireframeColorSmooth:function(e){u.setColorTarget(e)},setWireframeColor:function(e){l.setFloat4(e)},setWireframeEnable:function(e,t){e?(!0===u._finished&&(l.setFloat3(t),l.getInternalArray()[3]=0),u.show(t[3])):u.hide()}}));const c=h},oIlX:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("uuWb"),r=i("EZMu"),a=i("iO85"),o=n.Z.osg,s=function(e,t){this._color=e,this._colorDelta=o.vec4.create(),this._lastRatio=0,r.Z.call(this,t),this._finished=!0,this._disableAfterFinished=!1,this._finishCallback=void 0,this._lastFrame=0};o.createPrototypeObject(s,o.objectInherit(r.Z.prototype,{hide:function(){o.vec3.init(this._colorDelta),this._colorDelta[3]=-this._color[3],this._disableAfterFinished=!0,this._lastRatio=0,this.reset()},show:function(e){o.vec3.init(this._colorDelta),this._colorDelta[3]=void 0!==e?e:1-this._color[3],this._disableAfterFinished=!1,this._lastRatio=0,this.reset()},setColorTarget:function(e){o.vec4.sub(this._colorDelta,e,this._color),this._disableAfterFinished=!1,this._lastRatio=0,this.reset()},setFinishCallback:function(e){this._finishCallback=e},finished:function(){!0===this._disableAfterFinished&&this._finishCallback&&this._finishCallback()},update:function(e,t){if(!0===this._finished)return!0;a.Z.draw();var i=t.getFrameStamp(),n=i.getFrameNumber();if(this._lastFrame===n)return!0;this._lastFrame=n;var r=i.getSimulationTime(),s=this.interpolate(r,e,t),l=(s=o.smoothStep(0,1,s))-this._lastRatio;return this._lastRatio=s,o.vec4.scaleAndAdd(this._color,this._color,this._colorDelta,l),!0}}));const l=s},Thrf:(e,t,i)=>{"use strict";i.d(t,{Z:()=>I});var n=i("N96t"),r=i("lWrq"),a=i("3Alh"),o=i("uuWb"),s=i("lZH+"),l=i.n(s),u=i("pcq+"),h=i("lVmk"),c=i("b5Bu"),A=o.Z.osg,d=.2;c.Z&&(d=.35);var g=function(e,t,i){var n=i.isNew()?i.get("url"):i.get("files")[0].url;this._src=n,t&&this.setMediaElement(t),this._manager=e,this._model=i,this._mediaElementSource=void 0,this._gain=void 0,this._panner=void 0,this._canPlayDefered=void 0,this._isPlaying=!1,this._seeking=!1,this._duration=void 0,this._isPlayerPendingToPlay=!1,this._doPausePlayerWhenPendingToPlayFinished=void 0,this.pendingToPlayResolvedBound=this.pendingToPlayResolved.bind(this),this.releasePlayerBound=this.releasePlayer.bind(this)};g.prototype={setMediaElement:function(e){this._player=e,this._player.setAttribute("src",this._src),u.default.apple.device||this._player.load(),this._player.addEventListener("ended",this.onEnded.bind(this)),this._player.addEventListener("loadedmetadata",function(e){this._duration=e.currentTarget.duration}.bind(this))},isPlayerPlaying:function(){return!!this._player&&!(!(this._player.currentTime>0)||this._player.paused||this._player.ended)},playerPlay:function(){if(this._player&&!this.isPlayerPlaying()){if(this._isPlayerPendingToPlay)return this._pendingToPlayPromise;var e;this._managerContextVersion=this._manager._releaseSafeCounter;try{e=this._player.play()}catch(e){return this.checkAndHandleDOMError(e),l().resolve()}return this._isPlayerPendingToPlay=!0,this._pendingToPlayPromise=e,e||(e=new(l())(function(e){this._player.addEventListener("play",e)}.bind(this))),e.then(this.pendingToPlayResolvedBound).catch(function(e){return e instanceof DOMException&&"The element has no supported sources."===e.message?(this._isPlayerPendingToPlay=!1,void(this._pendingToPlayPromise=void 0)):this.checkAndHandleDOMError(e)?void 0:this._doPausePlayerWhenPendingToPlayFinished||this._managerContextVersion!==this._manager._releaseSafeCounter||this._manager.releasePending?void this.pendingToPlayResolved():(this._isPlayerPendingToPlay=!1,this._pendingToPlayPromise=void 0,void window.setTimeout(this.playerPlay.bind(this),1e3))}.bind(this)),e}},playerPause:function(){return this._gain&&0!==this._gain.gain.value&&this.setGainValue(0),this._doPausePlayerWhenPendingToPlayFinished?this._doPausePlayerWhenPendingToPlayFinished.promise:this._isPlayerPendingToPlay?(this._doPausePlayerWhenPendingToPlayFinished=new h.Z,this._doPausePlayerWhenPendingToPlayFinished.promise):(this.isPlayerPlaying()&&this._player&&this._player.pause(),l().resolve())},pendingToPlayResolved:function(){this._isPlayerPendingToPlay=!1,this._pendingToPlayPromise=void 0,this._doPausePlayerWhenPendingToPlayFinished&&(this._player&&this._player.pause(),this._doPausePlayerWhenPendingToPlayFinished.resolve(),this._doPausePlayerWhenPendingToPlayFinished=void 0),this.updateVolume()},releasePlayer:function(){this._player=void 0,this._mediaElementSource=void 0},onEnded:function(){this._model.get("loop")||this.pause()},play:function(){this._isPlaying=!0,this.updateVolume()},pause:function(){this._isPlaying=!1,this.updateVolume()},getModel:function(){return this._model},updateVolume:function(){if(this._player)if(this._manager.getIsMute())this.setGainValue(0);else if(this._gain&&this._manager.isTabVisible()){if(void 0===this._model.get("volume")||!this._isPlaying||this._seeking||!this._manager.isPlaying()){if(this._player.muted)return;return A.debug("[SOUND] Volume Change: "+this._model.get("name")+" = 0"),void this.setGainValue(0)}this._volumeReal=this._model.get("volume")*this._manager.getVolume(),this.setGainValue(this._volumeReal)}else this.setGainValue(0)},_seekToSync:function(e){return!!this._player&&(void 0!==this._duration&&this._duration<1.5||(Math.abs(this._player.currentTime-e)>d?this._player.seeking?(this._seeking=!0,!1):(this._player.currentTime=e+.05,this._seeking=!0,!1):!(this._seeking&&!this._player.seeking)||(this._seeking=!1,!0)))},setTime:function(e,t){if(this._manager.canPlay()){if(!this._player||!this._gain){if(!t)return;this.updateFromModel()}if(void 0!==this._duration){var i=this._model.get("loop");if(this._player.loop!==i&&(this._player.loop=i),this.isSoundAsync())i||this._player.currentTime<this._duration?this.play():this.pause();else{var n=e-this._model.get("startTime"),r=n>=0;if(r&&(i?n%=this._duration:r=r&&this._duration>=n),!r)return this.isPlayerPlaying()&&(this._player.currentTime=0,this.playerPause()),void this.pause();this._seekToSync(n)&&this._manager.isPlaying()?(!this.isPlayerPlaying()&&this._manager.isPlaying()&&this.playerPlay(),this.play()):this.pause()}}}},isSoundAsync:function(){return!1===this._manager._hasAnim||!this._model.get("sync")},setRefDistanceNormalized:function(e){this._panner&&(this._panner.refDistance=e/this._manager.getRadius())},setMaxDistanceNormalized:function(e){this._panner&&(this._panner.maxDistance=e/this._manager.getRadius())},setPositionNormalized:function(e){if(this._panner){var t=this._manager.getRadius();this._manager._setPannerPosition(this._panner,e[0]/t,e[1]/t,e[2]/t)}},setLoop:function(){this._player&&(this._player.loop=this._model.get("loop"))},updateFromModel:function(){if(!this._player){var e=this._manager._createAudio();e&&this.setMediaElement(e)}var t;this.setLoop(),t=this._model.get("ambient")?this._manager.connectAmbientSound(this):this._manager.connect3DSound(this),this.isSoundAsync()&&this.play(),t?t.catch(function(e){this.checkAndHandleDOMError(e)}.bind(this)):(this.isSoundAsync()&&this.playerPlay(),this.updateVolume())},checkAndHandleDOMError:function(e){A.debug(e.message);return e instanceof DOMException&&-1!==["Failed to execute 'play' on 'HTMLMediaElement': API can only be initiated by a user gesture.","play() can only be initiated by a user gesture."].indexOf(e.message)&&(this._authErrors=!0,this.pendingToPlayResolved(),this._manager._lock(),!0)},whenReady:function(){if(!this._canPlayDefered){var e=new(l())(function(e){this._player.addEventListener("canplaythrough",e)}.bind(this));this._canPlayDefered=e}return this._canPlayDefered},setGainValue:function(e){if(this._player&&(this._player.muted=e<=0),this._gain){var t=this._gain.gain;if(t.setValueAtTime){var i=this._manager.getOrCreateAudioContext();if(!i)return;t.setValueAtTime(e,i.currentTime)}else t.value=e}}};const f=g;var p,m,_,v=i("5Cxy"),C=i("ELsZ"),b=i("59ul"),S=o.Z.osg,E=.016,y=function(){if(this._volume=Number(r.ZP.get("sf_volume",1)),this._sounds=[],this._context=void 0,this._enabled=!1,this._tabVisible=!0,this._isPlaying=!1,this._waiting=!(0,C.Z)(),this._muted=!1,this._unlockBound=this._unlock.bind(this),this._lockBound=this._lock.bind(this),this._forcePlayBound=function(){this.forcePlay(this._isPlaying)}.bind(this),this._hasSounds=!1,this._willHaveSounds=void 0,window.AudioContext||window.webkitAudioContext){if((0,C.Z)()&&(this._willHaveSounds=!0),!this._willHaveSounds){var e=(0,v.Z)()&&(0,v.Z)().model;if(!e){var t=window.location.href.match(/\/models\/((.+)(?:\/)+|(.+))/);t&&t.length>3&&(e=t[2]?t[2]:t[3])}e&&a.Z.get(e).then(this.checkWillHaveSounds.bind(this))}this._authErrors=this.featureDetectSoundAuthGestureNeeded(),this._resetPlayedOnceFromAuthGesture(),this._enablingAuthAudio=!1,this._firstEnter=!0,this._readyForErrorMessage=new h.Z,this._audioContextTriesCount=0,window.addEventListener("beforeunload",this.exit.bind(this)),this._contextClosePending=!1,this._radius=1,n.Z.getBoxReady().then(function(){this._radius=n.Z.getModelBoxWithoutDisplacement().radius()}.bind(this))}else this._willHaveSounds=!1};y.prototype={release:function(){if(this._context&&!this._releasePending){var e;this._releasePendingPromises=[];for(var t=0;t<this._sounds.length;t++)(e=this.releaseSound(this._sounds[t]))&&this._releasePendingPromises.push(e);var i=this._context.close;i&&((e=this._context.close())?(this._contextClosePending=!0,e.then(function(){this._contextClosePending=!1,this._context=void 0}.bind(this)),this._releasePendingPromises.push(e)):i=!1),this._releasePending=l().all(this._releasePendingPromises),this._releasePending.finally(function(){i||(this._context=void 0),this._releasePendingPromises=void 0,this._releasePending=void 0}.bind(this))}},releaseSound:function(e){if(e&&(this.disconnectSound(e),e._mediaElementSource&&(e._mediaElementSource.disconnect(),e._mediaElementSource=void 0),e._player)){e._player.volume=0,e.pause();var t=e.playerPause();return t.then(e.releasePlayerBound),e.isSoundAsync()&&(e._exitTime=e._player.currentTime),e._player=void 0,e.isPlayerPlaying()||e.releasePlayer(),t}},removeSound:function(e){e&&(this.releaseSound(e),this._sounds.splice(this._sounds.indexOf(e),1))},reset:function(){this._releasePending?this._releasePending.then(this.reset.bind(this)):(this._audioContextTriesCount=0,this._hasSounds&&!this._firstEnter&&this.forcePlay(this._isPlaying))},enableTapRequestPopup:function(){this._osdProxyModel&&this._willHaveSounds&&!(0,C.Z)()&&this._osdProxyModel.trigger("sound-show","Tap/Click to play sounds",{position:"top",duration:1/0})},exit:function(){this._context&&(this.release(),this._firstEnter=!1,this._lock())},enter:function(){this.reset()},checkWillHaveSounds:function(e){if(void 0!==this._willHaveSounds)return this._willHaveSounds;var t,i=e.get("options").sound;if(!i||!i.soundtracks||!i.soundtracks.length)return this._willHaveSounds=!1,!1;if(!u.default.apple.device)return this._willHaveSounds=!0,!0;for(var n=0,r=i.soundtracks.length;n<r;n++)if(i.soundtracks[n].ambient){t=n;break}return void 0!==t?(i.soundtracks.length>1&&(i.soundtracks.splice(t+1,i.soundtracks.length-t),i.soundtracks.splice(0,t)),this._willHaveSounds=!0,!0):(i.soundtracks.length=0,this._willHaveSounds=!1,!1)},setProxyModel:function(e){this._osdProxyModel=e,this._readyForErrorMessage&&this._readyForErrorMessage.resolve()},getProxyModel:function(){return this._osdProxyModel},getOrCreateAudioContext:function(e){if(this._willHaveSounds&&this._enabled&&(!this._waiting||(0,C.Z)())&&this._tabVisible){if(this._context&&!this._contextClosePending)return this._context;var t=window.AudioContext||window.webkitAudioContext;try{return this._context=e?new t:new t({latencyHint:"interactive"}),"suspended"===this._context.state?void this._context.resume().then(function(){this._unlock()}.bind(this)).catch(function(){this._authErrors=!0,this._lock()}.bind(this)):(this._audioContextTriesCount&&this.forcePlay(this._isPlaying),this._context)}catch(e){if(e instanceof TypeError){if(S.debug(e.message),this.getOrCreateAudioContext(!0),this._context)return this._context}else if("An AudioContext in a cross origin iframe must be created or resumed from a user gesture to enable audio output."===e.message)return this._authErrors=!0,this.pendingToPlayResolved(),void this._lock();this._readyForErrorMessage.promise.then(function(){this._audioContextTriesCount++,this._audioContextTriesCount<5?setTimeout(function(){this.getOrCreateAudioContext()}.bind(this),200):this._osdProxyModel.trigger("sound-error",new Error('Your browser can not play additional sounds and this page must be reloaded. If the problem persists, try to restart your browser. <a style="color: -webkit-link; cursor: auto; text-decoration: underline;" href="javascript:window.location.reload()">reload</a>'),{position:"top",duration:1/0})}.bind(this))}return this._context}},_createAudio:function(){var e=document.createElement("audio");return e.loop=!0,e.volume=1,e.muted=!0,e.preload="auto",e.crossOrigin="anonymous",e},addSound:function(e,t){return this._hasSounds=!0,this._playedOnceFromAuthGesture||this._enableAuthAudioListener(this._forcePlayBound),this.canPlay()&&(t||!1===this._hasAnim)&&e.play(),this._sounds.push(e),e},createSound:function(e,t){this._isPlaying=t;var i,n=this._createAudio(e),r=new f(this,n,e);return n&&this.canPlay()&&(i=e.get("ambient")?this.connectAmbientSound(r):this.connect3DSound(r))&&i.then(this._unlockBound).catch(this._lockBound),this.addSound(r,t)},createPreview:function(e){var t=this._createAudio(e),i=new f(this,t,e);return this.connectAmbientSound(i),i},_errorCatchAndTryAgain:function(e){S.debug(e.message),this.exit(),window.setTimeout(function(){this.reset()}.bind(this),500)},_tryCreateMediaElementSource:function(e){if(e._mediaElementSource)return!0;try{return e._mediaElementSource=this._context.createMediaElementSource(e._player),!0}catch(e){return e instanceof DOMException&&"Failed to execute 'createMediaElementSource' on 'BaseAudioContext': AudioContext has been closed."===e.message&&this._errorCatchAndTryAgain(e),!1}},_tryConnectMediaElementSource:function(e,t){try{return e._mediaElementSource.connect(t),!0}catch(e){return this._errorCatchAndTryAgain(e),!1}},_setPannerPosition:function(e,t,i,n){if(e.positionX){var r=this.getOrCreateAudioContext(),a=r?r.currentTime:0;e.positionX.setTargetAtTime(t,a,E),e.positionY.setTargetAtTime(i,a,E),e.positionZ.setTargetAtTime(n,a,E)}else e.setPosition(t,i,n)},_setPannerOrientation:function(e,t,i,n,r,a,o){if(e.forwardX){var s=this.getOrCreateAudioContext(),l=s?s.currentTime:0;e.forwardX.setTargetAtTime(t,l,E),e.forwardY.setTargetAtTime(i,l,E),e.forwardZ.setTargetAtTime(n,l,E),e.upX.setTargetAtTime(r,l,E),e.upY.setTargetAtTime(a,l,E),e.upZ.setTargetAtTime(o,l,E)}else e.setOrientation(t,i,n,r,a,o)},connect3DSound:function(e){var t=this.getOrCreateAudioContext();if(t){this.disconnectSound(e);var i=t.createPanner();if(e._panner=i,i.panningModel="HRTF",i.rolloffFactor=1,i.coneInnerAngle=360,i.coneOuterAngle=0,i.coneOuterGain=0,i.distanceModel=e.getModel().get("distanceModel"),e.setRefDistanceNormalized(e.getModel().get("distance")),e.setMaxDistanceNormalized(e.getModel().get("distanceMax")),e._player||(e._player=this._createAudio(e.getModel())),this._tryCreateMediaElementSource(e)){var n=e._gain?e._gain:t.createGain();if(e._gain=n,e.setGainValue(0),n.connect(i),i.connect(t.destination),this._tryConnectMediaElementSource(e,n))return e.playerPlay()}}},connectAmbientSound:function(e){var t=this.getOrCreateAudioContext();if(t&&(this.disconnectSound(e),e._player||(e._player=this._createAudio(e.getModel())),this._tryCreateMediaElementSource(e))){var i=t.createGain();if(e._gain=i,e.setGainValue(0),i.connect(t.destination),this._tryConnectMediaElementSource(e,i))return e.playerPlay()}},disconnectSound:function(e){e&&(e._panner&&(e._panner.disconnect(),e._panner=void 0),e._gain&&(e._gain.disconnect(),e._gain=void 0))},update:(p=S.vec3.create(),m=S.vec3.create(),_=S.vec3.create(),function(){if(!this._enabled)return!0;var e=this._context,t=this._camera;if(!t||!e)return!0;S.mat4.getLookAt(p,m,_,t.getViewMatrix()),S.vec3.sub(m,m,p),S.vec3.normalize(m,m);var i=this._radius,n=e.listener;return this._setPannerPosition(n,p[0]/i,p[1]/i,p[2]/i),this._setPannerOrientation(n,m[0],m[1],m[2],_[0],_[1],_[2]),!0}),getVolume:function(){return this._volume},setCamera:function(e){this._camera=e},setVolume:function(e){var t=0===this._volume;if(this._volume=e,!this._muted&&(r.ZP.set("sf_volume",e),this.canPlay())){!t&&e>0&&this._lock();for(var i=0,n=this._sounds.length;i<n;i++)this._sounds[i].updateVolume()}},isTabVisible:function(){return this._tabVisible},hide:function(){this._tabVisible=!1,this.exit()},show:function(){this._tabVisible=!0,this.enter()},setEnabled:function(e){e?(this._enabled=!0,this.reset()):(this.exit(),this._enabled=!1)},isEnabled:function(){return this._enabled},setHasAnim:function(e){this._hasAnim=e},_unlockAcknowledge:function(){document.removeEventListener("touchend",this._forcePlayBound,!0),document.removeEventListener("mouseup",this._forcePlayBound,!0),this._playedOnceFromAuthGesture=!0,this._authErrors=this.featureDetectSoundAuthGestureNeeded(),this._osdProxyModel&&this._osdProxyModel.trigger("sound-hide")},_unlock:function(){if(this._enablingAuthAudio=!1,this._context)return this._context.resume(),void this._unlockAcknowledge();var e=this.getOrCreateAudioContext();e&&(e.resume(),this._unlockAcknowledge())},_lock:function(){this._resetPlayedOnceFromAuthGesture(),this._playedOnceFromAuthGesture||this._waiting||this._muted||0===this._volume||(this._enableAuthAudioListener(this._forcePlayBound),this.enableTapRequestPopup())},_enableAuthAudioListener:function(){this._enablingAuthAudio||(this._enablingAuthAudio=!0,document.addEventListener("touchend",this._forcePlayBound,!0),document.addEventListener("mouseup",this._forcePlayBound,!0))},setPlaying:function(e){this._isPlaying=e},isPlaying:function(){return this._isPlaying},forcePlay:function(e){var t=this._sounds.length;if(!t)return this._unlock();for(var i=[],n=0;n<t;n++){var r=this._sounds[n];r.updateFromModel();var a=r.playerPlay();a&&i.push(a),r.isSoundAsync()&&(r.play(),r._exitTime&&(r._player.currentTime=r._exitTime,r._exitTime=void 0))}this._isPlaying=e,this._context&&this._context.resume&&i.push(this._context.resume()),i.length&&l().all(i).then(this._unlockBound).catch(function(){S.debug("error on sound play"),this._authErrors=!0,this._lock()}.bind(this))},pause:function(){for(var e=0;e<this._sounds.length;e++){var t=this._sounds[e];t.isSoundAsync()||t.pause()}this._isPlaying=!1},getPlayedOnceFromAuthGesture:function(){return this._playedOnceFromAuthGesture},_resetPlayedOnceFromAuthGesture:function(){this._playedOnceFromAuthGesture=!this._authErrors||(0,v.Z)().isApp||(0,b.Z)(),this._playedOnceFromAuthGesture||(this._playedOnceFromAuthGesture=!1,this._enabled&&this._hasSounds&&(this._playedOnceFromAuthGesture=!this._authErrors))},canPlay:function(){return this._enabled&&!this._releasePending&&!this._waiting&&this._tabVisible},setWaiting:function(e){this._waiting=e,this._enabled&&this._hasSounds&&this._lock()},getRadius:function(){return this._radius},featureDetectSoundAuthGestureNeeded:function(){if(window.navigator.userActivation){var e=window.navigator.userActivation.hasBeenActive||window.navigator.userActivation.isActive;return e||(this._authErrors=!0,this._lock()),e}var t=document.createElement("audio");try{return t.pause(),t.play().catch(function(e){e instanceof DOMException&&"NotAllowedError"===e.name&&(this._authErrors=!0,this._lock())}.bind(this)),t.paused}catch(e){return S.debug(e),!0}},setMute:function(e){if(this.canPlay()){this._muted=e;for(var t=0,i=this._sounds.length;t<i;t++)this._sounds[t].updateVolume();this._muted||this._lock()}},getIsMute:function(){return this._muted}};const I=new y},u5VM:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i("uuWb"),r=i("5Cxy"),a=n.Z.osg,o=["magFilter","minFilter","wrapS","wrapT","textureWidth","textureHeight","textureTarget","internalFormat"],s={getValidOptions:function(){return o},getOptions:function(e){var t={};return t.minFilter=e.getMinFilter(),t.magFilter=e.getMagFilter(),t.wrapT=e.getWrapT(),t.wrapS=e.getWrapS(),t.textureWidth=e.getWidth(),t.textureHeight=e.getHeight(),t.textureTarget=e.getTextureTarget(),t.internalFormat=e._internalFormat,t.imageFormat=e._imageFormat,t},setOptions:function(e,t){t.setMinFilter(e.minFilter),t.setMagFilter(e.magFilter),t.setWrapT(e.wrapT),t.setWrapS(e.wrapS),e.minFilter===a.Texture.LINEAR_MIPMAP_LINEAR&&(0,r.Z)().anisotropy&&t.setMaxAnisotropy(16),t.setInternalFormat(e.internalFormat)},createValidOptionsForMaterial:function(e){var t=s.createValidOptions(e),i=t.minFilter,n=t.magFilter;return i===a.Texture.LINEAR_MIPMAP_LINEAR||i===a.Texture.LINEAR?(t.magFilter=a.Texture.LINEAR,t):n===a.Texture.LINEAR?(t.minFilter=a.Texture.LINEAR_MIPMAP_LINEAR,t):i===a.Texture.NEAREST_MIPMAP_LINEAR||i===a.Texture.NEAREST?(t.magFilter=a.Texture.NEAREST,t):(t.magFilter=a.Texture.LINEAR,t.minFilter=a.Texture.LINEAR_MIPMAP_LINEAR,t)},createValidOptions:function(e){e||(e={});for(var t=o.length,i=0;i<t;++i){var n=o[i];"string"==typeof e[n]&&(e[n]=a.Texture[e[n]])}return e.magFilter||(e.magFilter=a.Texture.LINEAR),e.minFilter||(e.minFilter=a.Texture.LINEAR_MIPMAP_LINEAR),e.wrapS||(e.wrapS=a.Texture.REPEAT),e.wrapT||(e.wrapT=a.Texture.REPEAT),e.textureWidth||(e.textureWidth=0),e.textureHeight||(e.textureHeight=0),e.textureTarget||(e.textureTarget=a.Texture.TEXTURE_2D),e.internalFormat||(e.internalFormat=-1),e}};const l=s},"Ixh+":(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=3.14159265359,r=1801779,a={};const o=function(e,t,i,o,s,l){o=o||.25,s=s||720;var u=Math.cos(.01745329251*o),h=0,c=a.table;if(void 0===c)for(c=a.table=new Float32Array(r),a.nphi=s,a.epsilon=o,h=0;h<r;++h)c[h]=1/0;var A=n/(s-1),d=1.57079632679/(s-1),g=l?3:2,f=s!==a.nphi||o!==a.epsilon,p=e.length/g;for(h=0;h<p;++h){var m=h*i,_=h*g,v=e[_],C=e[_+1];4!==i||l||(t[m+3]=1024&v?-1:1,v&=-1025);var b,S,E,y=3*(v+s*C),I=y>=r;if(f||I||c[y]===1/0){var x=v*A,T=Math.cos(x),w=Math.sin(x);x+=d;var M=(u-T*Math.cos(x))/Math.max(1e-5,w*Math.sin(x));M>1?M=1:M<-1&&(M=-1);var R=6.28318530718*C/Math.ceil(n/Math.max(1e-5,Math.acos(M)));b=w*Math.cos(R),S=w*Math.sin(R),E=T,I||f||(c[y]=b,c[y+1]=S,c[y+2]=E)}else b=c[y],S=c[y+1],E=c[y+2];if(l){var B=47938362584151635e-21*e[_+2],N=Math.sin(B);t[m]=N*b,t[m+1]=N*S,t[m+2]=N*E,t[m+3]=Math.cos(B)}else t[m]=b,t[m+1]=S,t[m+2]=E}return t}},pYHo:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=function(e,t,i,n,r){for(var a=e.length/r,o=0;o<a;++o)for(var s=o*r,l=0;l<r;++l)t[s+l]=i[l]+e[s+l]*n[l];return t}},PzyL:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("uuWb").Z.osg;const r=function(e,t,i){for(var r=new n[i](t),a=0,o=0;a!==t;){var s=0,l=0;do{s|=(127&e[o])<<l,l+=7}while(0!=(128&e[o++]));r[a++]=s}if("U"!==i[0])for(var u=0;u<t;++u){var h=r[u];r[u]=h>>1^-(1&h)}return r}},Pd5s:(e,t,i)=>{"use strict";i.d(t,{Z:()=>x});var n=i("uuWb"),r=i("Ixh+");const a=function(e,t){for(var i=t||0,n=e.length,r=e[i],a=i+1;a<n;++a){var o=e[a];r=e[a]=r+(o>>1^-(1&o))}return e};var o=function(e,t,i,n){for(var r=e[o.IMPLICIT_HEADER_EXPECTED_INDEX],a=e[o.IMPLICIT_HEADER_MASK_LENGTH],s=new Uint32Array(e.subarray(o.IMPLICIT_HEADER_LENGTH,a+o.IMPLICIT_HEADER_LENGTH)),l=32*a-t.length,u=0;u<a;++u)for(var h=s[u],c=32*u,A=u===a-1?l:0;A<32;++A,++c)t[c]=h&-2147483648>>>A?e[i++]:n?r:r++;return t};o.IMPLICIT_HEADER_PRIMITIVE_LENGTH=0,o.IMPLICIT_HEADER_MASK_LENGTH=1,o.IMPLICIT_HEADER_EXPECTED_INDEX=2,o.IMPLICIT_HEADER_LENGTH=3;const s=o;const l=function(e,t,i){var n=e.length/t,r=new Uint8Array(n),a=i.length-1;r[i[0]]=1,r[i[1]]=1,r[i[2]]=1;for(var o=2;o<a;++o){var s=o-2,l=i[s],u=i[s+1],h=i[s+2],c=i[s+3];if(1!==r[c]){r[c]=1,l*=t,u*=t,h*=t,c*=t;for(var A=0;A<t;++A)e[c+A]=e[c+A]+e[u+A]+e[h+A]-e[l+A]}}return e};var u=i("pYHo"),h=i("PzyL");const c=function(e,t,i){for(var n=i[0],r=e.length,a=0;a<r;++a){var o=n-e[a];t[a]=o,n<=o&&(n=o+1)}return i[0]=n,t};var A=i("5Cxy"),d=n.Z.osg,g=n.Z.osgWrappers.osg.functionSortAttributes,f={Vertex:1,Normal:2,TexCoord:4,Color:8,Triangle:16,Tangent:32},p=1,m=2,_=1,v=2,C=4,b=function(e){return-1!==e.indexOf("TexCoord")?f.TexCoord:f[e]},S=function(e,t,i,n,r){var o,l=t.vb,u=l.Offset?l.Offset:0,A=e.getIndices();1===(o=l.Encoding&&"varint"===l.Encoding?(0,h.Z)(new Uint8Array(r,u),A.getItemSize()*l.Size,t.type):new d[t.type](r,u,A.getItemSize()*l.Size)).BYTES_PER_ELEMENT&&(o=new Uint16Array(o));var g=i.attributes,f=b("Triangle"),p=o,m=e.getMode()===d.primitiveSet.TRIANGLE_STRIP;if(0==(g&f)||!m&&e.getMode()!==d.primitiveSet.TRIANGLES)return o instanceof Uint16Array==!1&&(p=new Uint16Array(o.buffer,o.byteOffset,o.length)).set(o),A.setElements(p),void e.setIndices(A);var S=i.triangle_mode,E=0;if(S&C&&m&&(E=s.IMPLICIT_HEADER_LENGTH+o[s.IMPLICIT_HEADER_MASK_LENGTH],p=new Uint16Array(o[s.IMPLICIT_HEADER_PRIMITIVE_LENGTH])),S&_&&a(o,E),S&C&&m&&s(o,p,E,S&v),S&v&&c(p,p,n),p instanceof Uint16Array==!1){var y=p;(p=new Uint16Array(y.buffer,y.byteOffset,y.length)).set(y)}A.setElements(p),e.setIndices(A)},E=d.vec3.create(),y=d.vec3.create(),I=function(e,t,i,n,a,o){var s,c=t.vb,g=e.getItemSize(),f=c.Size,_=c.Offset?c.Offset:0;if(s=c.Encoding&&"varint"===c.Encoding?(0,h.Z)(new Uint8Array(o,_),g*f,t.type):new d[t.type](o,_,g*f),0==(n.attributes&b(i)))return"Color"===i?s=function(e,t){if(4===t.BYTES_PER_ELEMENT&&(0,A.Z)().convertVertexColor8Bit){for(var i=t.length,n=new Uint8Array(t.buffer,t.byteOffset,i),r=0;r<i;++r)n[r]=Math.round(255*Math.max(0,Math.min(1,t[r])));t=n}return 1===t.BYTES_PER_ELEMENT&&e.setNormalize(!0),t}(e,s):"Bones"===i&&(s=function(e,t){if(1===t.BYTES_PER_ELEMENT)return t;for(var i=0,n=t.length;i<n;++i)if(t[i]>255)return t;var r=new Uint8Array(t.buffer,t.byteOffset,n);return r.set(t),r}(0,s)),void e.setElements(s);if("Normal"===i)return e.setElements((0,r.Z)(s,new Float32Array(3*f),3,n.epsilon,n.nphi)),void e.setItemSize(3);if("Tangent"===i)return e.setElements((0,r.Z)(s,new Float32Array(4*f),4,n.epsilon,n.nphi)),void e.setItemSize(4);var v=null;if("Vertex"===i)v=n.vertex_mode;else if(-1!==i.indexOf("TexCoord")){var C="uv_"+i.substr(8)+"_mode";v=void 0!==n[C]?n[C]:n.vertex_mode}v&m&&void 0!==a&&l(s,g,a.getElements()),e.setElements(function(e,t,i,n,r){var a="Vertex"===n?"vtx_":"uv_"+n.substr(8)+"_",o=e&p&&void 0!==r[a+"bbl_x"],s=t instanceof Float32Array==1;if(!o&&s)return t;var l=4===t.BYTES_PER_ELEMENT?new Float32Array(t.buffer,t.byteOffset,t.length):new Float32Array(t.length);return o?(E[0]=r[a+"bbl_x"],E[1]=r[a+"bbl_y"],y[0]=r[a+"h_x"],y[1]=r[a+"h_y"],3===i&&(E[2]=r[a+"bbl_z"],y[2]=r[a+"h_z"]),(0,u.Z)(t,l,E,y,i)):(l.set(t),l)}(v,s,g,i,n))};const x=function(e,t,i){var n=function(e,t,i){for(var n,r=e.userDataMap,a=e.getPrimitiveSetList(),o=[0],s=0,l=a.length;s<l;++s){var u=a[s];if(!(u instanceof d.DrawArrays||u instanceof d.DrawArrayLengths)){var h=u.getIndices();h.getInitialBufferArray&&(h=h.getInitialBufferArray());var c=t[h.getInstanceID()];!0!==c.visited&&(c.visited=!0,c.inlined?(h.setElements(new Uint16Array(c.inlined)),u.setIndices(h)):(S(u,c,r,o,i),u.getMode()===d.primitiveSet.TRIANGLE_STRIP&&(n=h)))}}for(s=l-1;s>=0;s--)(u=a[s]).getCount()||a.splice(s,1);return n}(e,t,i);!function(e,t,i,n){var r=e.userDataMap,a=e.getVertexAttributeList(),o=Object.keys(a);o.sort(g);for(var s=o.length,l=0;l<s;++l){var u=o[l],h=a[u];h.getInitialBufferArray&&(h=h.getInitialBufferArray());var c=t[h.getInstanceID()];if(!0!==c.visited)if(c.visited=!0,c.inlined)h.setElements(new Float32Array(c.inlined));else{var A=r,d=u.indexOf("_");-1!==d&&(A=r["morph_"+u.slice(d+1)],u=u.slice(0,d)),I(h,c,u,A,n,i)}}}(e,t,i,n)}},"HF+a":(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i("uuWb").Z.osg,r=[0,0];const a={init:function(e,t,i){this._qualityModel=t,this._canvasPixelRatio=i,this._canvas=e,this._pixelRatio=[1,1]},getCanvasCoord:function(e,t){if(t=t||r,e.center||e.touches){if(e.center)t[0]=e.center.x,t[1]=e.center.y;else{t[0]=t[1]=0;for(var i=e.touches.length,n=0;n<i;++n)t[0]+=e.touches[n].clientX/i,t[1]+=e.touches[n].clientY/i}var a=e.target.getBoundingClientRect();t[0]+=-a.left,t[1]+=-a.top}else t[0]=void 0===e.offsetX?e.layerX:e.offsetX,t[1]=void 0===e.offsetY?e.layerY:e.offsetY;return t},getPixelRatio:function(){var e=this._qualityModel.get("dynamicResolutionScaling");return this._pixelRatio[0]=this._canvasPixelRatio*e[0],this._pixelRatio[1]=this._canvasPixelRatio*e[1],this._pixelRatio},canvasCoordToGL:function(e,t,i){var r=this._canvas,a=i||n.vec2.create(),o=this.getPixelRatio();return a[0]=e*o[0],a[1]=(r.clientHeight-t)*o[1],a},glCoordToCanvas:function(e,t,i){var r=this._canvas,a=i||n.vec2.create(),o=this.getPixelRatio();return a[0]=e/o[0],a[1]=r.clientHeight-t/o[1],a}}},HWoV:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i("uuWb"),r=i("5Cxy"),a=n.Z.osg,o=function(e){a.StateAttribute.call(this),this._enable=!e&&(0,r.Z)().zz};a.createPrototypeStateAttribute(o,a.objectInherit(a.StateAttribute.prototype,{attributeType:"VertexCompression",cloneType:function(){return new o(!0)},isEnabled:function(){return this._enable},getHash:function(){return"VCMP"+(this._enable?1:0)}}),"osg","VertexCompression");const s=o},wVsd:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i("uuWb"),r=i("MaYM"),a=n.Z.osg,o=n.Z.osgAnimation,s=a.BufferArray.randa,l={},u=function(e,t,i){e._listQuantUV||(e._listQuantUV=[]);var n="uQUV"+i.substr(8),o=t._objQUV;if(o)return-1===e._listQuantUV.indexOf(o)&&e._listQuantUV.push(o),void(o.uniformName!==n&&(e._listQuantUV.push({uniformName:n,_QUV:o._QUV}),r.Z[n]||(r.Z[n]=a.Uniform.createFloat4(n))));var s=t.computeMinMaxUV(l),u=a.vec4.fromValues(s.xmin,s.ymin,s.xmax-s.xmin,s.ymax-s.ymin);t._QUV=u,o={uniformName:n,_QUV:u},t._objQUV=o,e._listQuantUV.push(o),r.Z[n]||(r.Z[n]=a.Uniform.createFloat4(n))},h=function(){a.ComputeBoundsVisitor.call(this),this.nodeMaskOverride=-1};a.createPrototypeObject(h,a.objectInherit(a.NodeVisitor.prototype,{apply:function(e){if(e instanceof a.Geometry!=!1){var t=(e.getSourceGeometry?e.getSourceGeometry():e)instanceof o.MorphGeometry;if(!e._qcomp){e._qcomp=!0;var i=e.getVertexAttributeList();if(!t){var n=i.Vertex;n&&function(e,t){if(t._QVT)return e._QVT=t._QVT,void(e._QVS=t._QVS);var i=t._minMax||t.computeMinMaxVertex(l),n=a.vec3.fromValues(i.xmax-i.xmin,i.ymax-i.ymin,i.zmax-i.zmin);a.vec3.div(n,n,s);var r=a.vec3.fromValues(i.xmin,i.ymin,i.zmin);t._QVT=r,t._QVS=n,e._QVT=r,e._QVS=n}(e,n);var r=i.Normal;r&&(r._QNOR=!0);var h=i.Tangent;h&&(h._QTAN=!0)}for(var c in i)c.startsWith("TexCoord")&&u(e,i[c],c)}}else this.traverse(e)}}));const c=h},JeqU:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("uuWb"),r=i("5Cxy"),a=n.Z.osg;const o=function(e){var t=a.WebGLCaps.instance(),i=t.getWebGLParameter("MAX_TEXTURE_SIZE"),n=t.getWebGLParameter("MAX_RENDERBUFFER_SIZE"),o=(0,r.Z)().maxTextureSize,s=void 0===e?1/0:e;return Math.min(i,n,o,s)}},RKWW:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i("uuWb"),r=i("5Cxy"),a=n.Z.osg;const o=function(){var e=a.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS");return Math.min(e,(0,r.Z)().maxTextureUnits)}},vasR:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>r});const r=function(e){if(n)return n;if(void 0!==e){var t=e,i=window.devicePixelRatio||1;return n=-1!==t?Math.min(t,i):i}return console.warn("getPixelRatio call before getOptions() "),1}},sFNe:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i("uuWb").Z.osg,r=!0,a=n.Timer.prototype.tick,o=function(){this.children=[],this.message="",this.parent=this},s={},l={},u=new o,h=u,c=function(e){console.log("%c"+e,"color:purple")};n.time=function(e){var t=new o;s[e]=t,t.start=a(),r&&(h.children.push(t),t.parent=h,h=t,t.timerMessage=e)},n.timeEnd=function(e){var t=s[e],i=e+" : "+(a()-t.start).toFixed(2)+"ms";r?(h=t.parent||u,t.message=i):l.logMessage(i)};var A=function(e,t){var i=!e.message,n=e.children,r="";e!==u&&n.length>0&&(r=t+e.timerMessage+(i?"(pending)\n\n":"\n"));for(var a=e===u||i?"":"  |  ",o=0;o<n.length;++o)r+=A(n[o],t+a)+"\n";var s=(e.parent===u||!e.parent.message)&&e.timerMessage?"\n":"";return r+(t+e.message)+s};l.showMessage=function(){var e=A(u,"");e=e.replace(/(\n*$)/,"");var t=window.performance&&window.performance.now?(window.performance.now()/1e3).toString():"";c(e+="\n\n<<<<< Model Displayed! "+t+">>>>>"),r=!1},l.logBound=function(e){var t=e.center(n.vec3.create()),i="Bound center : [ "+t[0]+", "+t[1]+", "+t[2]+" ]\n";i+="Bound radius : "+e.radius()+"\n";var r=e.getMin(),a=e.getMax();i+="Bbox min : [ "+r[0]+", "+r[1]+", "+r[2]+" ]\n",i+="Bbox max : [ "+a[0]+", "+a[1]+", "+a[2]+" ]\n",l.logMessage(i)},l.logMessage=function(e){if(!r)return c(e);var t=new o;t.message=e,h.children.push(t),t.parent=h};const d=l},"2fWj":(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n={isPowerOf2:function(e){return 0==(e&e-1)},floorPowerOf2:function(e){return 1<<Math.floor(Math.log2(e))},ceilPowerOf2:function(e){return 1<<Math.ceil(Math.log2(e))},snapToPowerOf2:function(e,t){if(n.isPowerOf2(e))return e;var i=n.floorPowerOf2(e);return e/i-1>(void 0===t?.5:t)?n.ceilPowerOf2(e):i}},r=new Uint32Array(1);function a(e){return r[0]=e,r[0]=(r[0]<<16|r[0]>>16)>>>0,r[0]=(1431655765&r[0])<<1|(2863311530&r[0])>>>1>>>0,r[0]=(858993459&r[0])<<2|(3435973836&r[0])>>>2>>>0,r[0]=(252645135&r[0])<<4|(4042322160&r[0])>>>4>>>0,r[0]=(16711935&r[0])<<8|(4278255360&r[0])>>>8>>>0,2.3283064365386963e-10*r[0]}n.hammersley=function(e,t){return[e/t,a(e)]},n.hemisphereSampleUniform=function(e,t){var i=n.hammersley(e,t),r=2*i[1]*Math.PI,a=1-i[0],o=Math.sqrt(1-a*a);return[Math.cos(r)*o,Math.sin(r)*o,a]},n.hemisphereSampleCos=function(e,t){var i=n.hammersley(e,t),r=2*i[1]*Math.PI,a=Math.sqrt(1-i[0]),o=Math.sqrt(1-a*a);return[Math.cos(r)*o,Math.sin(r)*o,a]};const o=n},jQgr:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i("uuWb").Z.osg;const r={DEPTH_LESS_WRITE:new n.Depth(n.Depth.LESS,0,1,!0),DEPTH_LESS_NO_WRITE:new n.Depth(n.Depth.LESS,0,1,!1),DEPTH_DISABLE:new n.Depth(n.Depth.DISABLE,0,1,!0),DEPTH_ALWAYS:new n.Depth(n.Depth.ALWAYS,0,1,!0),DEPTH_NEVER:new n.Depth(n.Depth.NEVER,0,1,!1),DEPTH_LEQUAL_BACKGROUND_NO_WRITE:new n.Depth(n.Depth.LEQUAL,1,1,!1),DEPTH_LEQUAL_WRITE:new n.Depth(n.Depth.LEQUAL,0,1,!0),DEPTH_LEQUAL_NO_WRITE:new n.Depth(n.Depth.LEQUAL,0,1,!1),DEPTH_EQUAL_NO_WRITE:new n.Depth(n.Depth.EQUAL,0,1,!1),COLOR_MASK_NONE:new n.ColorMask(!1,!1,!1,!1),COLOR_MASK_ALPHA:new n.ColorMask(!1,!1,!1,!0),COLOR_MASK_RGBA:new n.ColorMask(!0,!0,!0,!0),BLEND_DISABLE:new n.BlendFunc,BLEND_SUBSTRACTIVE:new n.BlendFunc(n.BlendFunc.ONE,n.BlendFunc.ONE_MINUS_SRC_ALPHA),BLEND_ADDITIVE:new n.BlendFunc(n.BlendFunc.ONE,n.BlendFunc.ONE),CULL_BACK:new n.CullFace(n.CullFace.BACK),CULL_FRONT:new n.CullFace(n.CullFace.FRONT),CULL_DISABLE:new n.CullFace(n.CullFace.DISABLE)}},UFcT:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=!1;const r=function(e){return void 0!==e&&(n=e),n}},rMHa:(e,t,i)=>{"use strict";i.d(t,{Z:()=>A,i:()=>h});var n,r,a,o=i("5Cxy"),s=i("iO85"),l=document.createElement("canvas"),u=document.createElement("canvas"),h=function(e,t,i,a){return a||(a=u),function(e,t,i,n){l.width===t&&l.height===i||(n.width=t,n.height=i,l.width=t,l.height=i,r=new Uint8Array(4*t*i));var a=e.getGraphicContext(),o=a.checkFramebufferStatus(a.FRAMEBUFFER);if(o!==a.FRAMEBUFFER_COMPLETE)return console.error("FRAMEBUFFER status invalid.",o);a.flush(),a.finish(),a.readPixels(0,0,t,i,a.RGBA,a.UNSIGNED_BYTE,r);var s=l.getContext("2d"),u=s.getImageData(0,0,t,i);u.data.set(r),s.putImageData(u,0,0);var h=n.getContext("2d");h.clearRect(0,0,t,i),h.fillStyle="transparent",h.fillRect(0,0,t,i),h.save(),h.globalCompositeOperation="copy",h.scale(1,-1),h.drawImage(l,0,0,t,i,0,-i,t,i),h.restore()}(e,t,i,a),(0,o.Z)().downloadPicture&&(n||(n=document.createElement("a"),document.body.appendChild(n),n.style.display="none"),n.href=a.toDataURL("image/jpeg"),n.download="image.jpg",n.click()),a},c=function(e){e.getScene().updateSceneGraph(e.getUpdateVisitor());var t=e.getCamera().getRenderer();t.cull(),t.draw()};const A=function(e,t,i,n){var r=i.getSuperSample(),o=i.getViewerOSGJS();if(e&&t||(e=o.getCanvasWidth(),t=o.getCanvasHeight()),function(e,t,i){var n=e.getFeatures(),r=e.getSuperSample(),o=e.getViewerOSGJS(),l=e.getFeaturesManager().getNodeGizmo(),u=o.getCamera();for(var A in n)n[A].prepareForScreenShot();a=void 0,l&&l.getNodeMask()&&(a=l.getNodeMask(),l.setNodeMask(0)),e.trigger("resizeViewer",t,i),o.updateViewport(),s.Z.setPoseForScreenshot(!0),o.checkNeedToDoFrame(),c(o),u.setFinalDrawCallback((function(e){r.isEnabled()||h(e,t,i)}))}(i,e,t),r.canBeEnabled())for(r.forceEnable();r.isEnabled();)r.updateFrame(),c(o);else c(o);return function(e){var t=e.getFeatures(),i=e.getViewerOSGJS(),n=e.getFeaturesManager().getNodeGizmo(),r=i.getCamera();for(var o in s.Z.setPoseForScreenshot(!1),r.setFinalDrawCallback(void 0),t)t[o].resetAfterScreenShot();a&&n.setNodeMask(a),e.trigger("resizeViewerOnNextFrame",-1,-1)}(i),n||(o.updateViewport(),i.getFeatures().inspector.getModel().trigger("change:viewerToCanvasRatio")),u}},MDIC:(e,t,i)=>{"use strict";i.d(t,{gN:()=>d,kR:()=>p,hP:()=>m,cW:()=>v,D1:()=>C});var n,r,a,o=i("uuWb"),s=i("vRpy"),l=i("8AWZ"),u=i("IcDE"),h=i("5Cxy"),c=o.Z.osg,A=o.Z.osgAnimation,d=function(e){n=e.getViewerWebGL().getRootModel()},g=null!==(0,h.Z)().apiVersion,f=(r=c.vec3.create(),a=c.mat4.create(),function(e){var t=e.get("lastComputedScenePosition"),i=function(e){var t=e.get("sticky");if(void 0!==t)return t;var i=e.get("geometryUid");if(i<0)return e.set("sticky",null),null;var n=s.Z.uidGeometryMap[i];return n&&(g||n instanceof A.RigGeometry||n instanceof A.MorphGeometry||(0,u.Z)(n))?(e.set("sticky",n),n):(e.set("sticky",null),null)}(e);if(!i)return c.vec3.copy(t,e.get("position"));var o=e.get("indices"),l=o[0],h=o[1],d=o[2];if(i.getWorldMatrix(n,a),l<0||!i.computeTransformedVertex)return c.vec3.transformMat4(t,e.get("localPosition"),a);var f=i.getVertexAttributeList().Vertex.getElements().length/3;if(l>=f||h>=f||d>=f)return c.vec3.copy(t,e.get("position"));var p=e.get("barycentricWeights"),m=p[0],_=p[1],v=p[2];return c.vec3.init(t),i.computeTransformedVertex(l,r),c.vec3.scaleAndAdd(t,t,r,m),h>=0&&(i.computeTransformedVertex(h,r),c.vec3.scaleAndAdd(t,t,r,_)),d>=0&&(i.computeTransformedVertex(d,r),c.vec3.scaleAndAdd(t,t,r,v)),c.vec3.transformMat4(t,t,a),t}),p=function(e){f(e);var t=e.get("lastComputedScenePosition"),i=e.get("lastComputedWorldPosition");return l.Z.getWorldPositionFromScenePoint(t,i)},m=function(e,t){l.Z.getScenePositionFromHit(t,e.get("position"));var i=t._nodePath[t._nodePath.length-1],n=void 0!==i._uniqueID?i._uniqueID:-1;e.set("geometryUid",n);var r=e.get("localPosition");r[0]=t._localIntersectionPoint[0],r[1]=t._localIntersectionPoint[1],r[2]=t._localIntersectionPoint[2];var a=e.get("indices");a[0]=t._i1,a[1]=t._i2,a[2]=t._i3;var o=e.get("barycentricWeights");o[0]=t._r1,o[1]=t._r2,o[2]=t._r3},_=function(e){e.set("geometryUid",-1),c.vec3.set(e.get("indices"),-1,-1,-1),c.vec3.init(e.get("barycentricWeights")),c.vec3.init(e.get("localPosition"))},v=function(e,t){c.vec3.copy(e.get("position"),t),c.vec3.copy(e.get("lastComputedScenePosition"),t);var i=e.get("lastComputedWorldPosition");l.Z.getWorldPositionFromScenePoint(i,t),_(e)},C=function(e,t){var i=e.get("position");l.Z.getScenePositionFromWorldPoint(t,i),c.vec3.copy(e.get("lastComputedScenePosition"),i),c.vec3.copy(e.get("lastComputedWorldPosition"),t),_(e)}},"6QKU":(e,t,i)=>{"use strict";i.d(t,{X2:()=>A,BG:()=>c});var n,r,a=i("59ul"),o=!1;if(document)for(var s=["hidden","mozHidden","msHidden","webkitHidden"],l=0,u=s.length;l<u;l++){var h=s[l];if(void 0!==document[h]){n=h,r=h.toLowerCase().split("hidden").shift()+"visibilitychange";break}}var c,A=function(){return r};c=(0,a.Z)()?function(){return!1}:function(){return!(o||!n)&&document[n]}},Y09f:e=>{"use strict";e.exports="/*jshint worker: true */\n\nself.onmessage = function (event) {\n    var data = event.data;\n\n    var opt = {\n        imageOrientation: 'flipY',\n        premultiplyAlpha: 'none',\n        colorSpaceConversion: 'none',\n    };\n\n    self.fetch(data.url).then(function (response) {\n        response.blob().then(function (blob) {\n            self.createImageBitmap(blob, opt).then(function (bitmap) {\n                postMessage(\n                    {\n                        bitmap: bitmap,\n                        url: data.url,\n                        uid: data.uid,\n                    },\n                    [bitmap]\n                );\n            });\n        });\n    });\n};\n\n/*jshint worker: false */\n"},vs3H:e=>{"use strict";var t=e.exports=function(e,t,n){"function"==typeof t&&(n=t,t={}),i(t,"function"==typeof(n=t.cb||n)?n:n.pre||function(){},n.post||function(){},e,"",e)};function i(e,n,r,a,o,s,l,u,h,c){if(a&&"object"==typeof a&&!Array.isArray(a)){for(var A in n(a,o,s,l,u,h,c),a){var d=a[A];if(Array.isArray(d)){if(A in t.arrayKeywords)for(var g=0;g<d.length;g++)i(e,n,r,d[g],o+"/"+A+"/"+g,s,o,A,a,g)}else if(A in t.propsKeywords){if(d&&"object"==typeof d)for(var f in d)i(e,n,r,d[f],o+"/"+A+"/"+f.replace(/~/g,"~0").replace(/\//g,"~1"),s,o,A,a,f)}else(A in t.keywords||e.allKeys&&!(A in t.skipKeywords))&&i(e,n,r,d,o+"/"+A,s,o,A,a)}r(a,o,s,l,u,h,c)}}t.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},t.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},t.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},t.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},"5Eyw":(e,t,i)=>{var n=i("jG2q"),r=function(e){var t=e,i={};t.indexOf("#")>-1&&(t=t.slice(1));var n=t.split(":");return 1===n.length?i.data=n[0]:2===n.length?(i.from=n[0].toUpperCase(),i.data=n[1]):3===n.length&&(i.from=n[0].toUpperCase(),i.to=n[1].toUpperCase(),i.data=n[2]),i.data&&(i.stringData=i.data,i.data=function(e){e=e||"",e=decodeURIComponent(e);var t={};return e.split("&").forEach(function(e){if(e.indexOf("=")>-1){var i=e.split("=");t[i[0]]=i[1]}else t=e.indexOf(",")>-1?e.split(","):e}.bind(this)),t}(i.data)),i._originalString=e+";",i},a=function(e){var t=e;"string"==typeof e&&(t=r(e)),this._msg=t,this.from=t.from,this.to=t.to,this.data=o(t.data)},o=function(e){return"string"==typeof e?e=decodeURIComponent(e):Array.isArray(e)?e=e.map(decodeURIComponent):"object"===(typeof e).toLowerCase()&&Object.keys(e).forEach(function(t){"string"==typeof e[t]?e[t]=decodeURIComponent(e[t]):Array.isArray(e[t])&&(e[t]=e[t].map(decodeURIComponent))}.bind(this)),e};a.prototype._getStringifiedData=function(){var e="";if("string"==typeof this.data)return encodeURIComponent(this.data);if(Array.isArray(this.data))return this.data.map(encodeURIComponent).join(",");if("object"==typeof this.data)for(var t in this.data){var i;"string"==typeof this.data[t]?i=encodeURIComponent(this.data[t]):Array.isArray(this.data[t])&&(i=this.data[t].map(encodeURIComponent).join(",")),e+=t+"="+i}return e},a.prototype.toString=function(){var e="";return this.from&&(e+=this.from+":"),this.to&&(e+=this.to+":"),e+=this._getStringifiedData()+";"};var s=function(e){if(!(e=e||{}).device)throw new Error('ViewerHashAPI options need to contain the "device" identifier property');e.listen&&this.listen(e.listen),this.device=e.device};s.prototype.appendToHash=function(e,t){e instanceof a&&(e=e.toString()),"string"==typeof e&&-1===(t=l(t)).location.hash.indexOf(e)&&(t.location.hash=t.location.hash+e)},s.prototype.removeFromHash=function(e,t){if(!(e instanceof a))throw new Error("Please supply an instance of ViewerHashMessage");var i=(t=l(t)).location.hash;i=e._msg&&e._msg._originalString?i.replace(e._msg._originalString,""):i.replace(e.toString(),""),t.location.hash=i};var l=function(e){if((e=(!0===e?window:e)||window)&&e.tagName&&"iframe"===e.tagName.toLowerCase()&&(e=e.contentWindow),!e.addEventListener)throw new Error("Could not bind an event to supplied target. Please supply an instance of window or an iframe.");return e};s.prototype.listen=function(e){return(e=l(e)).addEventListener("hashchange",this._onHashChange.bind(this,e),!1)},s.prototype._onHashChange=function(e){(this.getMessages(e.location.hash).messages||[]).forEach(function(e){if(e)if(e.data&&!Array.isArray(e)){var t=e.data;if("object"==typeof e.data){var i=Object.keys(e.data);t=e.data._key?e.data._key:i[0]}t&&this.trigger("message:"+t,e)}else this.trigger("message",e)}.bind(this))},s.prototype.getMessages=function(e){var t=function(e,t){var i=e;i.indexOf("#")>-1&&(i=i.slice(1));var n=i.split(";"),o=[];for(var s in n){var l=new a(r(n[s]));l.from&&l.from===t||!l.data||o.push(l)}return o}(e,this.device),i=e;for(var n in t)i=t[n]._msg&&t[n]._msg._originalString?i.replace(t[n]._msg._originalString,""):i.replace(t[n].toString(),"");return{messages:t,hash:i}},s.prototype.createMessage=function(e){return(e=e||{}).from=this.device,new a(e)},n.mixin(s.prototype),a.prototype.removeFromHash=function(){s.prototype.removeFromHash.call(this,this)},a.prototype.appendToHash=function(){s.prototype.appendToHash.call(this,this)},e.exports=s},zlfu:e=>{"use strict";e.exports="(function webpackUniversalModuleDefinition(root, factory) {\n  if(typeof exports === 'object' && typeof module === 'object')\n    module.exports = factory();\n  else if(typeof define === 'function' && define.amd)\n    define([], factory);\n  else {\n    var a = factory();\n    for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n  }\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/  // The module cache\n/******/  var installedModules = {};\n\n/******/  // The require function\n/******/  function __webpack_require__(moduleId) {\n\n/******/    // Check if module is in cache\n/******/    if(installedModules[moduleId])\n/******/      return installedModules[moduleId].exports;\n\n/******/    // Create a new module (and put it into the cache)\n/******/    var module = installedModules[moduleId] = {\n/******/      exports: {},\n/******/      id: moduleId,\n/******/      loaded: false\n/******/    };\n\n/******/    // Execute the module function\n/******/    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/    // Flag the module as loaded\n/******/    module.loaded = true;\n\n/******/    // Return the exports of the module\n/******/    return module.exports;\n/******/  }\n\n\n/******/  // expose the modules object (__webpack_modules__)\n/******/  __webpack_require__.m = modules;\n\n/******/  // expose the module cache\n/******/  __webpack_require__.c = installedModules;\n\n/******/  // __webpack_public_path__\n/******/  __webpack_require__.p = \"\";\n\n/******/  // Load entry module and return exports\n/******/  return __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var decompressor = __webpack_require__( 1 );\n\n  /*jshint worker: true */\n\n  self.onmessage = function ( event ) {\n      var input = event.data;\n      var result = decompressor.decompress( input.buffer );\n\n      var img = new Uint8Array( result.img.buffer );\n      var width = result.width;\n      var height = result.height;\n\n      if ( input.swizzle ) {\n          var nbComponents = input.nbComponents || 3;\n          var nbPixel = width * height * 4;\n          for ( var i = 0, j = 0; i < nbPixel; i += 4, j += nbComponents ) {\n              var r = img[ i ];\n              var a = img[ i + 3 ];\n\n              var x = ( r / 255.0 ) * 2.0 - 1.0;\n              var y = ( a / 255.0 ) * 2.0 - 1.0;\n              var z = Math.sqrt( 1.0 - x * x - y * y );\n              z = Math.round( ( z * 0.5 + 0.5 ) * 255.0 );\n\n              img[ j ] = r;\n              img[ j + 1 ] = a;\n              img[ j + 2 ] = z;\n          }\n\n          img = img.subarray( 0, width * height * nbComponents );\n      }\n\n      postMessage( {\n          img: img,\n          width: width,\n          height: height,\n          uid: input.uid || 'uid'\n      }, [ img.buffer ] );\n  };\n\n  /*jshint worker: false */\n\n  module.exports = {\n      astcDecompressor: decompressor\n  };\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var precompute = __webpack_require__(2);\n  var cacheUnquantizeSimple = precompute.cacheUnquantizeSimple;\n  var cacheUnquantizeTrits = precompute.cacheUnquantizeTrits;\n  var cacheUnquantizeQuints = precompute.cacheUnquantizeQuints;\n  var cacheDecodeSimple = precompute.cacheDecodeSimple;\n  var cacheDecodeTrits = precompute.cacheDecodeTrits;\n  var cacheDecodeQuints = precompute.cacheDecodeQuints;\n\n  var bitUtils = __webpack_require__(3);\n  var popCount = bitUtils.popCount;\n  var readBits = bitUtils.readBits;\n  var writeBits = bitUtils.writeBits;\n  var extractBits = bitUtils.extractBits;\n  var replicateBits = bitUtils.replicateBits;\n  var bitTransferSigned = bitUtils.bitTransferSigned;\n  var reverseU8Array = bitUtils.reverseU8Array;\n\n\n  // Counting how many bits have been read for each block\n  // the value is reseted when computing a new block\n  var bitsReadCount = 0;\n  // Counting how many bits have been written\n  // useful when extracting color endpoint data\n  var bitsWrittenCount = 0;\n  // Counting how many bits have been read in the\n  // current block color data stream\n  var colorDataBitsRead = 0;\n  // Keeping track of the current index\n  // when calling the computeEndpoints routine\n  var decodedColorValuesIdx = 0;\n\n  // Contains the information\n  // of the current processed block\n  var CURRENT_BLOCK_INFO = {};\n  // Describes how trit/quint/bit is packed\n  // for a single encoded integer in the maxWeightQuintsTritsMapper\n  var TRIT_IDX = 0;\n  var QUINT_IDX = 1;\n  var BIT_IDX = 2;\n\n  // Maximum number of encoded values = 288\n  var resultDecodedStorage = new Uint16Array(288 * 6);\n  var subDecodedValue = new Array(8);\n  var classSelectorBitsArray = new Uint8Array(4);\n  var colorModeLSB = new Uint8Array(4);\n  var texelWeightData = new Uint8Array(16);\n  var colorEndpointData = new Uint8Array(16);\n  var endpoints = new Uint8Array(4 * 2 * 4);\n  var blockPixelsOutput = null;\n\n  /**\n   * Encodes a given value into its quints/trits/bits representation\n   * @param  {uint} val the value to encode\n   * @return {Object} contains the number of trits/quints/bits to encode the given value.\n   */\n  var getEncodedInteger = function(val) {\n    var encodedInt = {\n      trits: 0,\n      quints: 0,\n      bits: 0,\n      tritValue: 0,\n      quintValue: 0,\n      bitValue: 0\n    };\n    while (val > 0) {\n      var check = val + 1;\n\n      if (!(check & (check - 1))) {\n        encodedInt.bits = popCount(val);\n        return encodedInt;\n      }\n      if ((check % 3 === 0) && !(Math.floor(check / 3) & Math.floor((check / 3) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 3 - 1));\n        encodedInt.trits = 1;\n        return encodedInt;\n      }\n      if ((check % 5 === 0) && !(Math.floor(check / 5) & Math.floor((check / 5) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 5 - 1));\n        encodedInt.quints = 1;\n        return encodedInt;\n      }\n\n      val--;\n    }\n    return encodedInt;\n  };\n\n  var replicateBits0816Map = new Uint16Array(256);\n  for (var i = 0; i < 256; ++i)\n    replicateBits0816Map[i] = replicateBits(i, 8, 16);\n\n  var maxWeightQuintsTritsMapper = new Uint16Array(256 * 3);\n  var idx = 0;\n  for (var i = 0; i < 256; i++) {\n    var encodedInt = getEncodedInteger(i);\n    maxWeightQuintsTritsMapper[idx + TRIT_IDX] = encodedInt.trits;\n    maxWeightQuintsTritsMapper[idx + QUINT_IDX] = encodedInt.quints;\n    maxWeightQuintsTritsMapper[idx + BIT_IDX] = encodedInt.bits;\n\n    idx += 3;\n  }\n\n  /**\n   * Gives additional precision to RGB colors near gray\n   * pixel is changed in-place in the endpoints array\n   * Refers to ASTC specifications (Section 3.8)\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var blueContract = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = (r + b) >> 1;\n    endpoints[idx + 2] = (g + b) >> 1;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Expands a given seed\n   * Refers to ASTC specifications (Section 3.15)\n   * @param  {uint32} p the seed to expand\n   * @return {uint32} the processed expanded seed\n   */\n  var hash52 = function(p) {\n    p ^= (p >>> 15) >>> 0;\n    p -= (p << 17) >>> 0;\n    p += (p << 7) >>> 0;\n    p += (p << 4) >>> 0;\n    p ^= (p >>> 5) >>> 0;\n    p += (p << 16) >>> 0;\n    p ^= (p >>> 7) >>> 0;\n    p ^= (p >>> 3) >>> 0;\n    p ^= (p << 6) >>> 0;\n    p ^= (p >>> 17) >>> 0;\n\n    return p;\n  };\n\n  /**\n   * Computes the partition index for a given texel\n   * @param  {uint32} seed partition pattern index\n   * @param  {int} x texel x position withing the block\n   * @param  {int} y texel y position withing the block\n   * @param  {int} z texel z position withing the block\n   * @param  {uint} partitionCount maximum number of existing partitions\n   * @param  {bool} smallBlock set to true, number of texel in the block is less than 31\n   * @return {uint} the partition index of the given texel\n   */\n\n  var seedsPartitionTable = new Uint8Array(12);\n\n  var precomputeSelectPartition = function(seed, partitionCount) {\n\n    // Refers to ASTC specifications (Section 3.15)\n    seed += (partitionCount - 1) * 1024;\n    var seedUint32 = seed >>> 0;\n\n    var rnum = hash52(seedUint32);\n\n    // The seeds values should be saved in an uint8 variable\n    seedsPartitionTable[0] = rnum & 0xF;\n    seedsPartitionTable[1] = (rnum >> 4) & 0xF;\n    seedsPartitionTable[2] = (rnum >> 8) & 0xF;\n    seedsPartitionTable[3] = (rnum >> 12) & 0xF;\n    seedsPartitionTable[4] = (rnum >> 16) & 0xF;\n    seedsPartitionTable[5] = (rnum >> 20) & 0xF;\n    seedsPartitionTable[6] = (rnum >> 24) & 0xF;\n    seedsPartitionTable[7] = (rnum >> 28) & 0xF;\n    seedsPartitionTable[8] = (rnum >> 18) & 0xF;\n    seedsPartitionTable[9] = (rnum >> 22) & 0xF;\n    seedsPartitionTable[10] = (rnum >> 26) & 0xF;\n    seedsPartitionTable[11] = ((rnum >> 30) | (rnum << 2)) & 0xF;\n\n    seedsPartitionTable[0] *= seedsPartitionTable[0];\n    seedsPartitionTable[1] *= seedsPartitionTable[1];\n    seedsPartitionTable[2] *= seedsPartitionTable[2];\n    seedsPartitionTable[3] *= seedsPartitionTable[3];\n    seedsPartitionTable[4] *= seedsPartitionTable[4];\n    seedsPartitionTable[5] *= seedsPartitionTable[5];\n    seedsPartitionTable[6] *= seedsPartitionTable[6];\n    seedsPartitionTable[7] *= seedsPartitionTable[7];\n    seedsPartitionTable[8] *= seedsPartitionTable[8];\n    seedsPartitionTable[9] *= seedsPartitionTable[9];\n    seedsPartitionTable[10] *= seedsPartitionTable[10];\n    seedsPartitionTable[11] *= seedsPartitionTable[11];\n\n    var sh1 = 0;\n    var sh2 = 0;\n    var sh3 = 0;\n    if (seed & 1) {\n      sh1 = (seed & 2) ? 4 : 5;\n      sh2 = (partitionCount === 3) ? 6 : 5;\n    } else {\n      sh1 = (partitionCount === 3) ? 6 : 5;\n      sh2 = (seed & 2) ? 4 : 5;\n    }\n    sh3 = (seed & 0x10) ? sh1 : sh2;\n\n    seedsPartitionTable[0] >>= sh1;\n    seedsPartitionTable[1] >>= sh2;\n    seedsPartitionTable[2] >>= sh1;\n    seedsPartitionTable[3] >>= sh2;\n    seedsPartitionTable[4] >>= sh1;\n    seedsPartitionTable[5] >>= sh2;\n    seedsPartitionTable[6] >>= sh1;\n    seedsPartitionTable[7] >>= sh2;\n    seedsPartitionTable[8] >>= sh3;\n    seedsPartitionTable[9] >>= sh3;\n    seedsPartitionTable[10] >>= sh3;\n    seedsPartitionTable[11] >>= sh3;\n\n    return rnum;\n  };\n\n  var selectPartition = function(rnum, x, y, z, partitionCount, smallBlock) {\n    if (partitionCount === 1)\n      return 0;\n\n    if (smallBlock) {\n      x <<= 1;\n      y <<= 1;\n      z <<= 1;\n    }\n\n    var a = seedsPartitionTable[0] * x + seedsPartitionTable[1] * y + seedsPartitionTable[10] * z + (rnum >> 14);\n    var b = seedsPartitionTable[2] * x + seedsPartitionTable[3] * y + seedsPartitionTable[11] * z + (rnum >> 10);\n    var c = seedsPartitionTable[4] * x + seedsPartitionTable[5] * y + seedsPartitionTable[8] * z + (rnum >> 6);\n    var d = seedsPartitionTable[6] * x + seedsPartitionTable[7] * y + seedsPartitionTable[9] * z + (rnum >> 2);\n\n    a &= 0x3F;\n    b &= 0x3F;\n    c &= 0x3F;\n    d &= 0x3F;\n\n    if (partitionCount < 4)\n      d = 0;\n    if (partitionCount < 3)\n      c = 0;\n\n    if (a >= b && a >= c && a >= d)\n      return 0;\n    else if (b >= c && b >= d)\n      return 1;\n    else if (c >= d)\n      return 2;\n\n    return 3;\n  };\n\n  /**\n   * Simple swap util procedure swapping to cells in a given array\n   * @param  {array} array contains the cells to swap\n   * @param  {uint} i the first index\n   * @param  {uint} j the second index\n   */\n  var swapCell = function(array, i, j) {\n    var a = array[i];\n    array[i] = array[j];\n    array[j] = a;\n  };\n\n  /**\n   * Computes the total number of bits required to encoded\n   * the same encoded integer a given amount of times.\n   * @param  {uint} nbValues the number of encoded values\n   * @param  {[type]} encodedInteger the encoded value\n   * @return {uint} the number of bits to encoded nbValues of encodedInteger\n   */\n  var getBitsNbrFromEncodedInt = function(nbValues, trits, quints, bits) {\n    var totalBits = bits * nbValues;\n\n    if (trits)\n      totalBits += Math.floor((nbValues * 8 + 4) / 5);\n    else if (quints)\n      totalBits += Math.floor((nbValues * 7 + 2) / 3);\n\n    return totalBits;\n  };\n\n  /**\n   * Computes the number of weight values\n   * available in a given block\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of weight values encoded inside the block\n   */\n  var getNumberWeightValues = function(blockInfo) {\n    var nbValues = blockInfo.width * blockInfo.height;\n    if (blockInfo.dualPlane)\n      nbValues *= 2;\n\n    // max nbValues = 12*12*2\n    return nbValues;\n  };\n\n\n  /**\n   * Computes the total number of bits needed to\n   * encode all the weights using Integer Sequence Encoding\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of required bits to encoded the weights.\n   */\n  var getPackedBitSize = function(blockInfo) {\n    var nbValues = getNumberWeightValues(blockInfo);\n\n    var idx = blockInfo.maxWeight * 3;\n    var trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n    return getBitsNbrFromEncodedInt(nbValues, trits, quints, bits);\n  };\n\n  /**\n   * Reads n values from a given array\n   * @param  {array} decodedColorValues the array to read\n   * @param  {uint} n the number of array cells to read\n   * @return {array} sub-array containing the read data\n   */\n  var readNDecodedColor = function(decodedColorValues, n) {\n    for (var i = 0; i < n; ++i)\n      subDecodedValue[i] = decodedColorValues[decodedColorValuesIdx++];\n    return subDecodedValue;\n  };\n\n  /**\n   * Clamps a pixel to the [0...255] range\n   * @param  {uint} beginIdx the index of the pixel alpha channel\n   * in the endpoints global array\n   */\n  var clampPixel = function(beginIdx) {\n    for (var i = 0; i < 4; ++i)\n      endpoints[beginIdx + i] = Math.max(0, Math.min(255, endpoints[beginIdx + i]));\n  };\n\n  /**\n   * Fills the endpoints global array with the given channel colors\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var fillEndpointsWithPixel = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = r;\n    endpoints[idx + 2] = g;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Parses the first 16 bytes a buffer\n   * considering it as an ASTC file buffer.\n   * @param  {ArrayBuffer} imgBuffer buffer containing the ASTC raw data\n   * @return {Object} contains data about the compressed image\n   */\n  var parseHeader = function(imgBuffer) {\n    var header = {};\n\n    var u8buffer = new Uint8Array(imgBuffer);\n    var u32Buffer = new Uint32Array(imgBuffer);\n\n    header.magic = u32Buffer[0];\n\n    var littleEndian = u8buffer[0] === (header.magic & 0xFF);\n\n    var isFormatCorrect = false;\n    if (littleEndian && header.magic === 0x5CA1AB13)\n      isFormatCorrect = true;\n    else if (!littleEndian && header.magic === 0x13ABA15C)\n      isFormatCorrect = true;\n\n    if (!isFormatCorrect)\n      console.error('The ASTC header does not meet the requirements.');\n\n    header.blockDimX = u8buffer[4];\n    header.blockDimY = u8buffer[5];\n    header.blockDimZ = u8buffer[6];\n\n    if (header.blockDimX > 12 || header.blockDimY > 12)\n      console.error('Incorrect ASTC file: block can not be larger than 12x12 pixels.');\n    if (header.blockDimZ > 1)\n      console.error('3D ASTC file are not supported.');\n\n    // Image width\n    header.xSize = u8buffer[7] + (u8buffer[8] << 8) + (u8buffer[9] << 16);\n    // Image height\n    header.ySize = u8buffer[10] + (u8buffer[11] << 8) + (u8buffer[12] << 16);\n    // Image depth\n    header.zSize = u8buffer[13] + (u8buffer[14] << 8) + (u8buffer[15] << 16);\n\n    if (header.zSize > 1)\n      console.error('3D ASTC file are not supported.');\n\n    return header;\n  };\n\n  /**\n   * Computes the layout of 2D block\n   * @param  {uint} blockModeBits extracted 11 first bit of the block\n   * @return {int} contains the layout of the block [0...9]\n   */\n  var findBlockLayout = function(blockModeBits) {\n    var layout = -1;\n\n    // Layout is in [0-4]\n    if ((blockModeBits & 0x1) || blockModeBits & 0x2) {\n      // layout is in [2-4]\n      if (blockModeBits & 0x8) {\n        // layout is in [3-4]\n        if (blockModeBits & 0x4)\n          layout = (blockModeBits & 0x100) ? 4 : 3;\n        else\n          layout = 2;\n      }\n      // layout is in [0-1]\n      else\n        layout = blockModeBits & 0x4 ? 1 : 0;\n\n      return layout;\n    }\n\n    // Layout is in [7-9]\n    if (blockModeBits & 0x100) {\n      // Layout [7-8]\n      if (blockModeBits & 0x80) {\n        if ((blockModeBits & 0x40))\n          console.error('Invalid block layout found.');\n        layout = (blockModeBits & 0x20) ? 8 : 7;\n      } else\n        layout = 9;\n\n      return layout;\n    }\n\n    layout = (blockModeBits & 0x80) ? 6 : 5;\n    return layout;\n  };\n\n  /**\n   * Extracts data regarding how block data are organized\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the first byte id of the current block\n   * @return {Object} contains block related data (void extent, maximum weight, etc;..)\n   */\n  var getBlockInfo = function(u8buffer, blockId) {\n    var blockInfo = CURRENT_BLOCK_INFO;\n    blockInfo.isVoidExtent = false;\n    blockInfo.error = false;\n\n    // Get the 'block mode' represented by the last 11 bits\n    var blockModeBits = readBits(u8buffer, blockId, bitsReadCount, 11);\n    bitsReadCount += 11;\n\n    // Checks the 9 least significant bits\n    // allowing to know if the block is a void-extent block (uniform color)\n    if ((blockModeBits & 0x01FF) === 0x1FC) {\n      blockInfo.isVoidExtent = true;\n      return blockInfo;\n    }\n\n    // Checks the first reserved pattern\n    // (xxxxx0000)\n    if ((blockModeBits & 0xF) === 0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (xxxxx0000)');\n    }\n\n    // Checks the second reserved pattern\n    // (111xxxx00)\n    if ((blockModeBits & 0x3) === 0 &&\n      (blockModeBits & 0x1C0) === 0x1C0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (111xxxx00)');\n    }\n\n    var layout = findBlockLayout(blockModeBits);\n    if (layout < 0)\n      console.error('Invalid block layout found.');\n\n    // Retrieves the R least significant bit according\n    // to the current block layout\n    var R = !!(blockModeBits & 0x10);\n    if (layout < 5)\n      R |= (blockModeBits & 0x3) << 1;\n    else\n      R |= (blockModeBits & 0xC) >> 1;\n\n    if (R < 2 || R > 7)\n      console.error('Invalid block mode. The file is not encoded in ASTC or corrupted.');\n\n    var a = 0;\n    var b = 0;\n    // Computes weights grid dimension\n    // Refers to ASTC specifications(Table 11)\n    switch (layout) {\n      case 0:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 4;\n        blockInfo.height = a + 2;\n        break;\n      case 1:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 8;\n        blockInfo.height = a + 2;\n        break;\n      case 2:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 8;\n        break;\n      case 3:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 6;\n        break;\n      case 4:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = b + 2;\n        blockInfo.height = a + 2;\n        break;\n      case 5:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = 12;\n        blockInfo.height = a + 2;\n        break;\n      case 6:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = 12;\n        break;\n      case 7:\n        blockInfo.width = 6;\n        blockInfo.height = 10;\n        break;\n      case 8:\n        blockInfo.width = 10;\n        blockInfo.height = 6;\n        break;\n      case 9:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 9) & 0x3;\n        blockInfo.width = a + 6;\n        blockInfo.height = b + 6;\n        break;\n      default:\n        console.error('The block layout is not recognized. Layout should be [0-9].');\n    }\n\n    // The dual plane mode bit is the most significant bit\n    blockInfo.dualPlane = (layout !== 9) && (blockModeBits & 0x400);\n    // The high precision mode bit is the second most significant bit\n    blockInfo.highPrecisionRange = (layout !== 9) && (blockModeBits & 0x200);\n\n    // Selects the appropriate weight range\n    if (blockInfo.highPrecisionRange) {\n      var highWeightRanges = [9, 11, 15, 19, 23, 31];\n      blockInfo.maxWeight = highWeightRanges[R - 2];\n    } else {\n      var weightRanges = [1, 2, 3, 4, 5, 7];\n      blockInfo.maxWeight = weightRanges[R - 2];\n    }\n\n    return blockInfo;\n  };\n\n  /**\n   * Decodes a trit in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded trit will be pushed back at the end of this procedure\n   */\n\n  var lsbDecodingValues = new Uint8Array(5);\n  var msbDecodingValues = new Uint8Array(5);\n\n  var decodeTrit = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var t = msbDecodingValues;\n    var T = 0;\n\n    // Refers to ASTC specifications (Table 17)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T = readBits(colorData, 0, colorDataBitsRead, 2);\n    colorDataBitsRead += 2;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 2;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 4;\n    colorDataBitsRead += 1;\n\n    m[3] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    m[4] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 7;\n    colorDataBitsRead += 1;\n\n    var C = 0 >>> 0;\n    if (extractBits(T, 2, 4) === 7) {\n      C = (extractBits(T, 5, 7) << 2) | extractBits(T, 0, 1);\n      t[3] = 2;\n      t[4] = 2;\n    } else {\n      C = extractBits(T, 0, 4);\n      if (extractBits(T, 5, 6) === 3) {\n        t[4] = 2;\n        t[3] = extractBits(T, 7, 7);\n      } else {\n        t[4] = extractBits(T, 7, 7);\n        t[3] = extractBits(T, 5, 6);\n      }\n    }\n\n    if (extractBits(C, 0, 1) === 3) {\n      t[2] = 2;\n      t[1] = extractBits(C, 4, 4);\n      t[0] = (extractBits(C, 3, 3) << 1) | (extractBits(C, 2, 2) & ~extractBits(C, 3, 3));\n    } else if (extractBits(C, 2, 3) === 3) {\n      t[2] = 2;\n      t[1] = 2;\n      t[0] = extractBits(C, 0, 1);\n    } else {\n      t[2] = extractBits(C, 4, 4);\n      t[1] = extractBits(C, 2, 3);\n      t[0] = (extractBits(C, 1, 1) << 1) | (extractBits(C, 0, 0) & ~extractBits(C, 1, 1));\n    }\n\n    for (var i = 0; i < 5; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 1;\n      resultDecodedStorage[idx + 1] = 0;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = t[i];\n      resultDecodedStorage[idx + 4] = 0;\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes a quint in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded quint will be pushed back at the end of this procedure\n   */\n  var decodeQuint = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var q = msbDecodingValues;\n    var Q = 0;\n\n    // Refers to ASTC specifications (Table 18)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q = readBits(colorData, 0, colorDataBitsRead, 3);\n    colorDataBitsRead += 3;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 3;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    if (extractBits(Q, 1, 2) === 3 && extractBits(Q, 5, 6) === 0) {\n      q[0] = 4;\n      q[1] = 4;\n      q[2] = (extractBits(Q, 0, 0) << 2) | ((extractBits(Q, 4, 4) & ~extractBits(Q, 0, 0)) << 1) | (extractBits(Q, 3, 3) & ~extractBits(Q, 0, 0));\n    } else {\n      var C = 0 >>> 0;\n      if (extractBits(Q, 1, 2) === 3) {\n        q[2] = 4;\n        C = (extractBits(Q, 3, 4) << 3) | ((~extractBits(Q, 5, 6) & 3) << 1) | (extractBits(Q, 0, 0));\n      } else {\n        q[2] = extractBits(Q, 5, 6);\n        C = extractBits(Q, 0, 4);\n      }\n\n      if (extractBits(C, 0, 2) === 5) {\n        q[1] = 4;\n        q[0] = extractBits(C, 3, 4);\n      } else {\n        q[1] = extractBits(C, 3, 4);\n        q[0] = extractBits(C, 0, 2);\n      }\n    }\n\n    for (var i = 0; i < 3; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 0;\n      resultDecodedStorage[idx + 1] = 1;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = 0;\n      resultDecodedStorage[idx + 4] = q[i];\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes nbValues of colorData raw data\n   * according to its max range value\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} range max value of the Integere Sequence\n   * @param  {uint} nbValues contains the number of values to decode\n   * @return {array} contains decoded integer\n   */\n  var decodeIntegerSequence = function(colorData, range, nbValues) {\n    var baseIdx = range * 3;\n    var trits = maxWeightQuintsTritsMapper[baseIdx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[baseIdx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[baseIdx + BIT_IDX];\n\n    resultDecodedStorage.currIndex = 0;\n\n    var nbDecodedValues = 0;\n    while (nbDecodedValues < nbValues) {\n\n      if (quints === 0 && trits === 0) {\n        var idx = resultDecodedStorage.currIndex;\n        resultDecodedStorage[idx] = trits;\n        resultDecodedStorage[idx + 1] = quints;\n        resultDecodedStorage[idx + 2] = bits;\n        resultDecodedStorage[idx + 3] = 0;\n        resultDecodedStorage[idx + 4] = 0;\n        resultDecodedStorage[idx + 5] = readBits(colorData, 0, colorDataBitsRead, bits);\n        colorDataBitsRead += bits;\n\n        resultDecodedStorage.currIndex += 6;\n\n        nbDecodedValues++;\n      } else if (quints === 1 && trits === 0) {\n        decodeQuint(colorData, bits);\n        nbDecodedValues += 3;\n      } else {\n        decodeTrit(colorData, bits);\n        nbDecodedValues += 5;\n      }\n    }\n  };\n\n  /**\n   * Decodes color from the colorData encoded Integer Sequence\n   * @param  {Uint8Array} colorData encoded color raw data\n   * @param  {array} colorModes contains the color for each partition\n   * @param  {uint} nbPartitions Number of available partitions\n   * @param  {uint} colorDataBits remaining bits number on which color data are encoded\n   * @return {array} decoded endpoints value in the [0...255] range\n   */\n\n  var endpointValuesOutput = new Uint8Array(32);\n\n  var decodeColorValues = function(colorData, colorModes, nbPartitions, colorDataBits) {\n    var trits = 0;\n    var quints = 0;\n    var bits = 0;\n    var i = 0;\n    // Computes the number of endpoint by using the associated class\n    // max endpoint values = 32\n    var nbEndpointValues = 0;\n    for (i = 0; i < nbPartitions; ++i)\n      nbEndpointValues += ((colorModes[i] >> 2) + 1) << 1;\n\n    // Finds the max range for each color endpoints\n    var range = 256;\n    while (--range > 0) {\n\n      var idx = range * 3;\n      trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n      quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n      bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n      var bitsNbr = getBitsNbrFromEncodedInt(nbEndpointValues, trits, quints, bits);\n      if (bitsNbr <= colorDataBits) {\n        // Some integers share the same encoding\n        // this piece of code finds the smallest one\n        while (--range > 0) {\n          var newIdx = range * 3;\n          var newTrits = maxWeightQuintsTritsMapper[newIdx + TRIT_IDX];\n          var newQuints = maxWeightQuintsTritsMapper[newIdx + QUINT_IDX];\n          var newBits = maxWeightQuintsTritsMapper[newIdx + BIT_IDX];\n\n          if (newTrits !== trits || newQuints !== quints || newBits !== bits)\n            break;\n        }\n\n        range++;\n        break;\n      }\n    }\n\n    // Decodes the integer sequence based on the range and\n    // the number of values\n    var endpointIdx = 0;\n    decodeIntegerSequence(colorData, range, nbEndpointValues);\n\n    for (i = 0; i < nbEndpointValues * 6; i += 6) {\n      var bitLength = resultDecodedStorage[i + BIT_IDX];\n      var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n      // Refers to ASTC specifications(Section 3.11)\n      var result;\n      if (resultDecodedStorage[i + TRIT_IDX]) result = cacheDecodeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 7 + bitValue * 21];\n      else if (resultDecodedStorage[i + QUINT_IDX]) result = cacheDecodeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 6 + bitValue * 30];\n      else result = cacheDecodeSimple[bitLength + bitValue * 9];\n\n      endpointValuesOutput[endpointIdx++] = result;\n    }\n\n    // Makes sure each decoded value is not ambiguous\n    for (i = 0; i < nbEndpointValues; ++i)\n      if (endpointValuesOutput[i] > 255)\n        console.error('Decoded endpoint value can not be above 255.');\n  };\n\n  /**\n   * Computes the two color endpoint values\n   * from the decoded Integer Sequence data\n   * @param  {[type]} endpointColorValues [description]\n   * @param  {[type]} colorMode           [description]\n   */\n  var computeColorEndpointsLDR = function(endpointColorValues, colorMode) {\n    var v = 0;\n    var currIdx = 0;\n\n    switch (colorMode) {\n      case 0:\n        v = readNDecodedColor(endpointColorValues, 2);\n        fillEndpointsWithPixel(0xFF, v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 1:\n        v = readNDecodedColor(endpointColorValues, 2);\n        var L0 = (v[0] >> 2) | (v[1] & 0xC0);\n        var L1 = Math.max(L0 + (v[1] & 0x3F), 0xFF);\n\n        fillEndpointsWithPixel(0xFF, L0, L0, L0);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, L1, L1, L1);\n        endpoints.currIdx += 4;\n        break;\n      case 4:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[3], v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 5:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n\n        currIdx = endpoints.currIdx;\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n\n        fillEndpointsWithPixel(v[2] + v[3], v[0] + v[1], v[0] + v[1], v[0] + v[1]);\n        endpoints.currIdx += 4;\n\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 6:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(0xFF, v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 8:\n        v = readNDecodedColor(endpointColorValues, 6);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 9:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 10:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        fillEndpointsWithPixel(v[4], v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[5], v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 12:\n        v = readNDecodedColor(endpointColorValues, 8);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 13:\n        v = readNDecodedColor(endpointColorValues, 8);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n        bitTransferSigned(v, 7, 6);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(v[7] + v[6], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[6] + v[7], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      default:\n        console.error('Unsupported color endpoint mode. Only LDR modes are supported.');\n    }\n  };\n\n  /**\n   * Unquantizes a single texel returning it to a standard\n   * [0...64] range according to its trit/quint/bit encoding\n   * @param  {uint} val the decoded integer\n   * @return {uint} the unquantized weight in the range [0...64]\n   */\n  var unquantizeTexel = function(i) {\n    var bitLength = resultDecodedStorage[i + BIT_IDX];\n    var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n    // Refers to ASTC specifications (Section 3.11)\n    if (resultDecodedStorage[i + TRIT_IDX]) return cacheUnquantizeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 4 + bitValue * 12];\n    if (resultDecodedStorage[i + QUINT_IDX]) return cacheUnquantizeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 3 + bitValue * 15];\n    return cacheUnquantizeSimple[bitLength + bitValue * 8];\n  };\n\n  /**\n   * Returns weights in a standard range [0...64]\n   * @param  {array} weightValues contains the decoded\n   * Integer Sequence of the weight data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} multidimensional array containing the weights\n   * for both planes\n   */\n\n  var unquantizedOutput = new Uint8Array(2 * 144);\n  var infilledWeightsOutput = new Uint8Array(2 * 144);\n\n  var unquantizeWeights = function(blockInfo, blockWidth, blockHeight, nbWeightValues) {\n\n    var bw = blockInfo.width;\n    var bh = blockInfo.height;\n    var bwh = bw * bh;\n\n    var i = 0;\n    var end = 0;\n\n    if (blockInfo.dualPlane) {\n      end = Math.min(nbWeightValues * 2, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 12);\n        unquantizedOutput[i + 144] = unquantizeTexel(i * 12 + 6);\n      }\n\n    } else {\n      // Unquantizes the whole weight grid\n      end = Math.min(nbWeightValues, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 6);\n      }\n    }\n\n    // Applies the weight infill procedure\n    // Refers to ASTC specifications (Section 3.12)\n    // 3D blocks are not handled for the moment\n    var Ds = ((1024 + (blockWidth / 2)) / (blockWidth - 1)) >>> 0;\n    var Dt = ((1024 + (blockHeight / 2)) / (blockHeight - 1)) >>> 0;\n    var dPlane = (blockInfo.dualPlane) ? 2 : 1;\n\n    for (var planeId = 0; planeId < dPlane; ++planeId) {\n      var idp = planeId * 144;\n      for (var t = 0; t < blockHeight; ++t) {\n        for (var s = 0; s < blockWidth; ++s) {\n          var cs = Ds * s;\n          var ct = Dt * t;\n\n          var gs = (cs * (bw - 1) + 32) >> 6;\n          var gt = (ct * (bh - 1) + 32) >> 6;\n\n          var js = gs >> 4;\n          var fs = gs & 0xF;\n\n          var jt = gt >> 4;\n          var ft = gt & 0x0F;\n\n          var w11 = (fs * ft + 8) >> 4;\n          var w10 = (ft - w11) >>> 0;\n          var w01 = (fs - w11) >>> 0;\n          var w00 = (16 - fs - ft + w11) >>> 0;\n\n          var v0 = js + jt * bw;\n\n          var val = 8;\n          var vid = v0;\n          if (vid < bwh) val += w00 * unquantizedOutput[vid + idp];\n\n          vid = v0 + 1;\n          if (vid < bwh) val += w01 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw;\n          if (vid < bwh) val += w10 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw + 1;\n          if (vid < bwh) val += w11 * unquantizedOutput[vid + idp];\n\n          infilledWeightsOutput[t * blockWidth + s + idp] = val >> 4;\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a single void-extent block,\n   * in other words, a block containing only one color\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressVoidExtent = function(u8buffer, blockId, blockInfo, blockWidth, blockHeight) {\n    // Do not read extra data\n    bitsReadCount += 53;\n\n    var r16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var g16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var b16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var a16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n\n    if (bitsReadCount !== 128)\n      console.error('Invalid void-extent bits reading.');\n\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = extractBits(a16, 0, 7);\n      blockPixelsOutput[i + 1] = extractBits(r16, 0, 7);\n      blockPixelsOutput[i + 2] = extractBits(g16, 0, 7);\n      blockPixelsOutput[i + 3] = extractBits(b16, 0, 7);\n    }\n  };\n\n  /**\n   * Decompresses a single block by returning\n   * the error color (0xFF, 0xFF, 0x00, 0xFF)\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var getErrorPixelBlock = function(blockWidth, blockHeight) {\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = 0xFF;\n      blockPixelsOutput[i + 1] = 0xFF;\n      blockPixelsOutput[i + 2] = 0x00;\n      blockPixelsOutput[i + 3] = 0xFF;\n    }\n  };\n\n  /**\n   * Decompresses a single block by retrieving\n   * the block layout as well as the number of partitions,\n   * the color endpoints and weights data.\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressBlock = function(u8buffer, blockId, blockWidth, blockHeight) {\n    bitsReadCount = 0;\n    bitsWrittenCount = 0;\n    colorDataBitsRead = 0;\n    decodedColorValuesIdx = 0;\n\n    var i = 0;\n    var CEM = 0;\n    var blockInfo = getBlockInfo(u8buffer, blockId);\n\n    if (blockInfo.error)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Handles the case whenever the block is filled with only one color\n    if (blockInfo.isVoidExtent)\n      return decompressVoidExtent(u8buffer, blockId, blockInfo, blockWidth, blockHeight);\n\n    if (blockInfo.width > blockWidth)\n      console.error('Texel weight grid width can not be larger than the block width.');\n    if (blockInfo.height > blockHeight)\n      console.error('Texel weight grid height can not be larger than the block height.');\n\n    // Extracts the partitions number\n    var nbPartitions = readBits(u8buffer, blockId, bitsReadCount, 2) + 1;\n    bitsReadCount += 2;\n\n    if (nbPartitions > 4)\n      console.error('The block partitions number is too high.');\n    if (nbPartitions === 4 && blockInfo.dualPlane)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Reads the extra configuration field\n    // At most 4 modes describing how color data is encoded\n    var colorEndpointModes = [0, 0, 0, 0];\n    var partitionIndex = -1;\n    var planeIndex = -1;\n    var cemBits = 0;\n    if (nbPartitions === 1) {\n      colorEndpointModes[0] = readBits(u8buffer, blockId, bitsReadCount, 4);\n      bitsReadCount += 4;\n      partitionIndex = 0;\n    } else {\n      // Reads 10 bits containing the partition index\n      partitionIndex = readBits(u8buffer, blockId, bitsReadCount, 10);\n      bitsReadCount += 10;\n      // Reads 6 bits containing the cem extra\n      cemBits = readBits(u8buffer, blockId, bitsReadCount, 6);\n      bitsReadCount += 6;\n    }\n    var baseMode = (cemBits & 3);\n\n    // Computes remaining bits containing color endpoint data\n    //var numberWeightBits = getPackedBitSize(blockInfo);\n    var remainingBits = 128 - getPackedBitSize(blockInfo) - bitsReadCount;\n    var dualPlaneSelectorBits = (blockInfo.dualPlane) ? 2 : 0;\n    remainingBits -= dualPlaneSelectorBits;\n\n    // Gets extra bits number according to CEM\n    // mode 0 does not need any extra CEM bits\n    var extraCEMbitsNb = 0;\n    if (baseMode) {\n      if (nbPartitions === 2)\n        extraCEMbitsNb = 2;\n      else if (nbPartitions === 3)\n        extraCEMbitsNb = 5;\n      else if (nbPartitions === 4)\n        extraCEMbitsNb = 8;\n    }\n    remainingBits -= extraCEMbitsNb;\n\n    // Reads color data\n    // read data are written to a buffer for later use\n    var colorDataBits = remainingBits;\n    for (i = 0; i < 16; ++i)\n      colorEndpointData[i] = 0;\n\n    while (remainingBits > 0) {\n      var bitsNb = Math.min(remainingBits, 8);\n      var bits = readBits(u8buffer, blockId, bitsReadCount, bitsNb);\n      bitsReadCount += bitsNb;\n\n      writeBits(colorEndpointData, bits, bitsNb, bitsWrittenCount);\n      bitsWrittenCount += bitsNb;\n\n      remainingBits -= 8;\n    }\n\n    planeIndex = readBits(u8buffer, blockId, bitsReadCount, dualPlaneSelectorBits);\n    bitsReadCount += dualPlaneSelectorBits;\n\n    // Reads extra CEM data\n    if (baseMode) {\n      var extraCEMbits = readBits(u8buffer, blockId, bitsReadCount, extraCEMbitsNb);\n      bitsReadCount += extraCEMbitsNb;\n\n      CEM = (extraCEMbits << 6) | cemBits;\n      CEM >>= 2;\n\n      // Extracts the class selector bit by bit\n      var C = classSelectorBitsArray;\n      var M = colorModeLSB;\n      for (i = 0; i < nbPartitions; ++i) {\n        C[i] = CEM & 1;\n        CEM >>= 1;\n      }\n      // Extracts the color endoint mode low bits\n      /*for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error(  'Error while extracting the color endpoint mode LSB.'); \n      }*/\n      for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error('Error while extracting the color endpoint mode LSB.');\n\n        colorEndpointModes[i] = baseMode;\n        if (!(C[i]))\n          colorEndpointModes[i] -= 1;\n        colorEndpointModes[i] <<= 2;\n        colorEndpointModes[i] |= M[i];\n      }\n    } else if (nbPartitions > 1) {\n      CEM = cemBits >> 2;\n      for (i = 0; i < nbPartitions; ++i)\n        colorEndpointModes[i] = CEM;\n    }\n\n    // Makes sure the extracted data obtained until here is correct\n    var blockBitsRead = bitsReadCount + getPackedBitSize(blockInfo);\n\n    for (i = 0; i < nbPartitions; ++i)\n      if (colorEndpointModes[i] >= 16)\n        console.error('The color endpoint mode ' + colorEndpointModes[i] + ' is not correct.');\n\n    if (blockBitsRead < 128)\n      console.error('The current block as not been read entirely. (' + blockBitsRead + ' read)');\n    else if (blockBitsRead > 128)\n      console.error('Too many bits have been read for the current block. (' + blockBitsRead + ' read)');\n\n    // Decodes color data\n    decodeColorValues(colorEndpointData, colorEndpointModes, nbPartitions, colorDataBits);\n\n    // Computes endpoint for all partitions\n    endpoints.currIdx = 0;\n    for (i = 0; i < nbPartitions; i++)\n      computeColorEndpointsLDR(endpointValuesOutput, colorEndpointModes[i]);\n\n    // Reads remaining bits containing packed texel weight data\n    // This code can be factorized with the color data reading above\n    var texelWeightDataIndex = 0;\n    for (i = 0; i < 16; ++i)\n      texelWeightData[texelWeightDataIndex++] = u8buffer[blockId + i];\n\n    // Reverses the textWeightData array\n    // and each byte\n    reverseU8Array(texelWeightData);\n\n    var weightPackedSize = getPackedBitSize(blockInfo);\n    var clearByteStart = (weightPackedSize >> 3) + 1;\n    var nbBytesToClean = 16 - clearByteStart;\n    texelWeightData[clearByteStart - 1] &= (1 << (weightPackedSize % 8)) - 1;\n    for (i = 0; i < nbBytesToClean; ++i)\n      texelWeightData[clearByteStart + i] = 0;\n\n    // Decodes the weight\n    colorDataBitsRead = 0;\n    var nbWeightValues = getNumberWeightValues(blockInfo);\n    decodeIntegerSequence(texelWeightData, blockInfo.maxWeight, nbWeightValues);\n\n    unquantizeWeights(blockInfo, blockWidth, blockHeight, nbWeightValues);\n\n    // Interpolates colors\n    var smallBlock = (blockHeight * blockWidth) < 32;\n    var rnum = precomputeSelectPartition(partitionIndex, nbPartitions);\n    for (var j = 0; j < blockHeight; j++) {\n      for (i = 0; i < blockWidth; i++) {\n        var partition = selectPartition(rnum, i, j, 0, nbPartitions, smallBlock);\n        if (partition >= nbPartitions)\n          console.error('The block partition index can not be larger or equal to the number of partitions.');\n\n        var rowIndex = (j * blockWidth + i) * 4;\n        var endpointBaseIdx = partition * 8;\n        for (var c = 0; c < 4; ++c) {\n          var C0 = endpoints[endpointBaseIdx + c] >>> 0;\n          C0 = replicateBits0816Map[C0];\n\n          var C1 = endpoints[endpointBaseIdx + c + 4] >>> 0;\n          C1 = replicateBits0816Map[C1];\n\n          var plane = 0 >>> 0;\n          if (blockInfo.dualPlane && (((planeIndex + 1) & 3) === c))\n            plane = 1;\n\n          var weight = infilledWeightsOutput[j * blockWidth + i + plane * 144];\n          var color = Math.floor(((C0 * (64 - weight) + C1 * weight + 32) / 64));\n\n          if (color === 65535)\n            blockPixelsOutput[rowIndex + c] = 255;\n          else\n            blockPixelsOutput[rowIndex + c] = Math.round(255.0 * (color / 65536.0));\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a complete buffer containing ASTC file raw data\n   * @param  {ArrayBuffer} contains the compressed ASTC raw data\n   * @return {Object} contains the uncompressed image buffer\n   * as well as the image dimensions\n   */\n  // TODO export\n  var decompress = function(imgBuffer) {\n    var u8buffer = new Uint8Array(imgBuffer);\n\n    // Retrieves the header\n    var header = parseHeader(imgBuffer);\n\n    var imgWidth = header.xSize;\n    var imgHeight = header.ySize;\n    var halfImgHeight = (imgHeight >> 1);\n\n    var blockWidth = header.blockDimX;\n    var blockHeight = header.blockDimY;\n\n    var firstBlockIndex = 16;\n    var blockNb = 0;\n\n    // Initializes temp storages used\n    // in helper functions\n    blockPixelsOutput = new Uint8Array(blockWidth * blockHeight * 4);\n\n    var j = 0;\n    var i = 0;\n    var resultImg = new Uint8ClampedArray(imgWidth * imgHeight * 4);\n\n    for (j = 0; j < imgHeight; j += blockHeight) {\n      for (i = 0; i < imgWidth; i += blockWidth) {\n\n        var currentBlockIndex = firstBlockIndex + blockNb * 16;\n        // Decompresses the current block\n        decompressBlock(u8buffer, currentBlockIndex, blockWidth, blockHeight);\n\n        var widthBound = Math.min(blockWidth, imgWidth - i);\n        var heightBound = Math.min(blockHeight, imgHeight - j);\n        var rowIndex = (j * imgWidth + i) * 4;\n        for (var jj = 0; jj < heightBound; jj++) {\n          var destId = rowIndex + jj * imgWidth * 4;\n          var srcId = jj * blockWidth * 4;\n\n          for (var x = 0; x < widthBound * 4; x += 4) {\n            resultImg[destId + x] = blockPixelsOutput[srcId + x + 1];\n            resultImg[destId + x + 1] = blockPixelsOutput[srcId + x + 2];\n            resultImg[destId + x + 2] = blockPixelsOutput[srcId + x + 3];\n            resultImg[destId + x + 3] = blockPixelsOutput[srcId + x];\n          }\n        }\n\n        ++blockNb;\n      }\n    }\n\n    // Flips the image using the Y-axis\n    for (j = 0; j < halfImgHeight; j++) {\n      for (i = 0; i < imgWidth; i++) {\n        var beginByte = (j * imgWidth + i) * 4;\n        var endByte = ((imgHeight - j - 1) * imgWidth + i) * 4;\n\n        swapCell(resultImg, beginByte, endByte);\n        swapCell(resultImg, beginByte + 1, endByte + 1);\n        swapCell(resultImg, beginByte + 2, endByte + 2);\n        swapCell(resultImg, beginByte + 3, endByte + 3);\n      }\n    }\n\n    var result = {};\n    result.img = resultImg;\n    result.width = imgWidth;\n    result.height = imgHeight;\n\n    return result;\n  };\n\n  module.exports = {\n    decompress: decompress\n  };\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var replicateBits = __webpack_require__(3).replicateBits;\n\n  // Describes how to unpack trit/quint\n  // with no additional bits\n  var WEIGHT_TRIT_RANGE = [0, 32, 63];\n  var WEIGHT_QUINT_RANGE = [0, 16, 32, 47, 63];\n\n  ///////////////////\n  // CACHE UNQUANTIZE\n  ///////////////////\n\n  // -----------------\n  // UNQUANTIZE SIMPLE\n  // -----------------\n  var cacheUnquantizeSimple = new Uint8Array(256 * 8);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 8; ++bitLength) {\n\n      var result = replicateBits(bitValue, bitLength, 6);\n      if (result > 32) result++;\n\n      cacheUnquantizeSimple[bitLength + bitValue * 8] = result;\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheUnquantizeTrits = new Uint8Array(256 * 3 * 4);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 4; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_TRIT_RANGE[tri];\n            break;\n          case 1:\n            C = 50;\n            break;\n          case 2:\n            C = 23;\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 6) | (bBit << 2) | bBit;\n            break;\n          case 3:\n            C = 11;\n            var cbBits = (bitValue >> 1) & 3;\n            B = (cbBits << 5) | cbBits;\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = tri * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeTrits[bitLength + tri * 4 + bitValue * 12] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheUnquantizeQuints = new Uint8Array(256 * 5 * 3);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 3; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_QUINT_RANGE[quint];\n            break;\n          case 1:\n            C = 28;\n            break;\n          case 2:\n            C = 13;\n            var bBits = (bitValue >> 1) & 1;\n            B = (bBits << 6) | (bBits << 1);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = quint * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeQuints[bitLength + quint * 3 + bitValue * 15] = result;\n      }\n    }\n  }\n\n  ///////////////\n  // CACHE DECODE\n  ///////////////\n\n  // -------------\n  // DECODE SIMPLE\n  // -------------\n  var cacheDecodeSimple = new Uint8Array(256 * 9);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 9; ++bitLength) {\n      cacheDecodeSimple[bitLength + bitValue * 9] = replicateBits(bitValue, bitLength, 8);\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheDecodeTrits = new Uint8Array(256 * 3 * 7);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 7; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 204;\n            break;\n          case 2:\n            C = 93;\n            // b000b0bb0\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 4) | (bBit << 2) | (bBit << 1);\n            break;\n          case 3:\n            C = 44;\n            // cb000cbcb\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 2) | cbBit;\n            break;\n          case 4:\n            C = 22;\n            // dcb000dcb\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | dcbBit;\n            break;\n          case 5:\n            C = 11;\n            // edcb000ed\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 2);\n            break;\n          case 6:\n            C = 5;\n            // fedcb000f\n            var fedcbBit = (bitValue >> 1) & 0x1F;\n            B = (fedcbBit << 4) | (fedcbBit >> 4);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (tri * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeTrits[bitLength + tri * 7 + bitValue * 21] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheDecodeQuints = new Uint8Array(256 * 5 * 6);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 6; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 113;\n            break;\n          case 2:\n            C = 54;\n            // b0000bb00\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 3) | (bBit << 2);\n            break;\n          case 3:\n            C = 26;\n            // cb0000cbc\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 1) | (cbBit >> 1);\n            break;\n          case 4:\n            C = 13;\n            // dcb0000dc\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | (dcbBit >> 1);\n            break;\n          case 5:\n            C = 6;\n            // edcb0000e\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 3);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (quint * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeQuints[bitLength + quint * 6 + bitValue * 30] = result;\n      }\n    }\n  }\n\n\n  // TOTO module exports\n  module.exports = {\n    cacheUnquantizeSimple: cacheUnquantizeSimple,\n    cacheUnquantizeTrits: cacheUnquantizeTrits,\n    cacheUnquantizeQuints: cacheUnquantizeQuints,\n    cacheDecodeSimple: cacheDecodeSimple,\n    cacheDecodeTrits: cacheDecodeTrits,\n    cacheDecodeQuints: cacheDecodeQuints\n  };\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n  'use strict';\n\n  /**\n   * Creates a binary mask between two given bounds\n   * @param  {int} a starting bit\n   * @param  {int} b ending bit\n   * @return {int} mask integer containing binary 1 between a and b\n   */\n  var createMask = function(a, b) {\n    var r = 0;\n    for (var i = a; i <= b; ++i)\n      r |= 1 << i;\n\n    return r;\n  };\n\n  /**\n   * Applies the Hamming weight algorithm: looks for the number of bits set to 1\n   * @param  {int} value\n   * @return {int} the number of bits set to 1\n   */\n  var popCount = function(value) {\n    var i = 0;\n    for (; value; ++i)\n      value &= value - 1;\n    return i;\n  };\n\n  /**\n   * Extracts bits from a bounded range\n   * @param  {int} value representing the integer value where the bits are extracted\n   * @param  {int} start the index of the starting bit\n   * @param  {int} stop  the index of the ending bit\n   * @return {int} the integer composed by the extracted bits\n   */\n  var extractBits = function(value, start, stop) {\n    return (value & createMask(start, stop)) >> start;\n  };\n\n\n  /**\n   * Replicates the n lower bits until the given bit index\n   * @param  {int} val contains the bits to replicate\n   * @param  {int} bitsNb describes the number of lower bits to replicate\n   * @param  {int} endBit the \"index\" of the included final bit\n   * @return {int} result containing a number made of the replicated bits\n   */\n  var replicateBits = function(val, bitsNb, endBit) {\n    // Extracts the bitsNb lower bits from the val value\n    var extractedBits = val & ((1 << bitsNb) - 1);\n    var result = extractedBits;\n    var resultLength = bitsNb;\n\n    while (resultLength < endBit) {\n\n      var extractedBitsShift = 0;\n      if (bitsNb > endBit - resultLength) {\n        var newShift = endBit - resultLength;\n        extractedBitsShift = bitsNb - newShift;\n        bitsNb = newShift;\n      }\n\n      // Shifts the result to \"add\" the pattern\n      result <<= bitsNb;\n      result |= extractedBits >> extractedBitsShift;\n      resultLength += bitsNb;\n    }\n\n    return result;\n  };\n\n  /**\n   * Transfers one bit from an integer to another\n   * @param  {array} array containing the two cells to transfer\n   * @param  {uint} i1 the index of the first cell\n   * @param  {uint} i2 the index of the second cell\n   */\n  var bitTransferSigned = function(array, i1, i2) {\n    var a = array[i1];\n    var b = array[i2];\n\n    b >>= 1;\n    b |= a & 0x80;\n    a >>= 1;\n    a &= 0x3F;\n    if (a & 0x20)\n      a -= 0x40;\n\n    array[i1] = a;\n    array[i2] = b;\n  };\n\n  /**\n   * Reads at most 30 bits from the given U8Int array\n   * @param  {U8IntArray} u8buffer buffer containing data to read\n   * @param  {int} beginByteId first byte at which the reading should begin\n   * @param  {int} bitsOffset nth bits at which the reading should begin\n   * @param  {int} bitsNb number of bits to read\n   * @return {int} an integer containing the read bits\n   */\n  var readBits = function(u8buffer, beginByteId, bitsOffset, bitsNb) {\n    if (bitsNb > 30)\n      console.error('The reader can not read more than 30 bits in a row.');\n    if (bitsNb <= 0)\n      return 0;\n\n    // Updates the total number of extracted bits\n    // for the current block\n    //bitsReadCount += bitsNb;\n\n    var bitsReadResult = 0;\n    var offsetByteId = beginByteId + Math.floor(bitsOffset / 8);\n    var endByteId = beginByteId + Math.floor((bitsOffset + bitsNb) / 8);\n    var bornInfBit = bitsOffset % 8;\n    var bornSupBit = (bitsOffset + bitsNb - 1) % 8;\n\n    // Simple reading where data lies on the same byte\n    if (offsetByteId === endByteId)\n      return (u8buffer[offsetByteId] & createMask(bornInfBit, bornSupBit)) >> bornInfBit;\n\n    // Recreates the integer by shifting bytes\n    // the created integer is at most a 24bits integer\n    var shift = 8;\n    bitsReadResult += u8buffer[offsetByteId];\n    for (var i = offsetByteId + 1; i <= endByteId; ++i) {\n      bitsReadResult += u8buffer[i] << shift;\n      shift *= 2;\n    }\n\n    bitsReadResult = (bitsReadResult & createMask(bornInfBit, bornInfBit + bitsNb - 1)) >> bornInfBit;\n\n    return bitsReadResult;\n  };\n\n  /**\n   * Write a given value in colorEndpointData at the byte index\n   * computed from the number of bits currently written.\n   * It is important to note that the number of bits to write in\n   * a row never exceed the size of a byte (8 bits)\n   * @param  {Uint8Array} colorEndpointData destination byte array\n   * @param  {int} bits the value to write\n   * @param  {uint} bitsNb the number of bits to write\n   * @param  {uint} bitsWritten the current number of bits written\n   */\n  var writeBits = function(colorEndpointData, bits, bitsNb, bitsWritten) {\n    colorEndpointData[Math.floor(bitsWritten / 8)] = bits;\n  };\n\n  /**\n   * Reverses the bits in a byte\n   * @param  {uint8} b the byte to reverse\n   * @return {uint32} the reversed byte not casted\n   */\n  var reverseByte = function(b) {\n    // Converts x to a 32 bits unsigned integer\n    b = b >>> 0;\n    return ((b * 0x0802 & 0x22110) | (b * 0x8020 & 0x88440)) * 0x10101 >> 16;\n  };\n\n  /**\n   * Reverses each byte just as the global bytes order\n   * @param  {Uint8Array} u8array the array to reverse\n   */\n  var reverseU8Array = function(u8array) {\n    for (var i = 0; i < u8array.length / 2; ++i) {\n      var a = reverseByte(u8array[i]);\n      var b = reverseByte(u8array[u8array.length - 1 - i]);\n\n      u8array[i] = b;\n      u8array[u8array.length - 1 - i] = a;\n    }\n  };\n\n  module.exports = {\n    popCount: popCount,\n    readBits: readBits,\n    writeBits: writeBits,\n    extractBits: extractBits,\n    replicateBits: replicateBits,\n    bitTransferSigned: bitTransferSigned,\n    reverseU8Array: reverseU8Array\n  };\n\n/***/ }\n/******/ ])\n});\n;"},xPCe:(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/b3777f2937566c93f348026b39105bd5-v2.png"},u4Ci:(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/a737c0b59449a803c12c35dc4419bd30-v2.png"},cAcU:(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/e8b7f47873b16f8990c65b656d7d55c6-v2.png"},r5U0:(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/d91f3534ceb355a0ed921e8edcf93fb9-v2.png"},"1kUg":(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/bcdcc09eeea51281eb4ac02cb4712675-v2.png"},"99M6":(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/e60c7416f7f96f70ee26c9155975d380-v2.png"},"l8+D":(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/editor/6645552faa13d6445515e0e39f4606f1-v2.png"},"Ru/i":(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/viewer/e75739db52d049e0309547cab8bf1fa6-v2.png"},eAaX:(e,t,i)=>{"use strict";e.exports=i.p+"static/assets/images/viewer/45755f41f22fab7274193ee039ee779e-v2.png"},Wquf:e=>{"use strict";e.exports="AGFzbQEAAAABhgERYAF/AX9gAn9/AGABfwBgBX9/f39/AX9gAABgA39/fwF/YAABf2AGf39/f39/\nAX9gBH9/f38Bf2ACf38Bf2ADf39/AGABfwF+YAV/f39/fwBgCH9/f39/f39/AGAHf39/f39/fwF/\nYAh/f39/f39/fwF/YA9/f39/f39/f39/f39/f38BfwImAwNlbnYFYWJvcnQABANlbnYEc2JyawAA\nA2VudgZtZW1vcnkCAAIDVFMEAAQJAAYEBgYFBQQAAAIIDggDAwcDAwMHCQMHAwcBAgUAAgUIBwEF\nBQMKCwAIAgUICg8DDQILEAcCAgEBAgQCAQkGBgQAAAAABgwAAAAAAAAAAAQFAXABDQ0GCAF/AUGw\n8AQLB6MCCRFfX3dhc21fY2FsbF9jdG9ycwACIWhlU0JuYjI5a1lubGxDazVsZG1WeUlHZHZibTVo\nSUhSbAADI21WMlpYSWdaMjl1Ym1FZ2JHVjBJSGx2ZFNCa2IzZHVDazVsAAQQVW1samExSnZiR3hs\nWkRSVgAFIWRtVnlJR2R2Ym01aElISjFiaUJoY205MWJtUWdZVzVrSQAGIUdSbGMyVnlkQ0I1YjNV\nS1RtVjJaWElnWjI5dWJtRWdiVwAHIUZyWlNCNWIzVWdZM0o1Q2s1bGRtVnlJR2R2Ym01aElITgAI\nHmJHd2dZU0JzYVdVZ1lXNWtJR2gxY25RZ2VXOTFDZwAJIVRtVjJaWElnWjI5dWJtRWdaMmwyWlNC\nNWIzVWdkWEFLVAAKCRIBAEEBCwxKSElHTU5PUFFSU1QK7uwCUwMAAQsJAEGUICAAEEMLSwEBfxAN\nAkBBnPAAKAIARQRAQZzwAEEBNgIADAELEEAQDQtBlPAAQgA3AgADQCAAQZQgakEAOgAAIABBAWoi\nAEGAMEcNAAsQRhANCzgAQQAhAEGQIEEBOgAAA0AgAEHQH2ogADoAACAAQQFqIgBBwABHDQALQdAf\nQZQgIAFBKGtBA0kbCyMAIABBgRBPBEAQAAtBmPAAIAA2AgBBlPAAQQA2AgBBlOAAC/gBAQR/IwBB\nEGsiASQAQZTwACgCAEUEQEGQIC0AAARAQZTgACEAA0AgACAALQAAIAJBKG5BWGwgAmpB0R9qLQAA\nIgNBqX9BSUFQIANBwABLGyADQeAASxtqIAJB/wFxQShwQdAfai0AACIDQQlBwAAgA0HAAEsbakEE\ndHJrOgAAIABBAWohACACQQJqIgJBMEcNAAsLQZTwAEGU0ABBgBBBlOAAQZjwACgCABAvIgA2AgAg\nASAAQYEQTwR/EABBlPAAKAIABSAACzsBDCABQZTQADYCCCABIAEpAwg3AwAgARBBCwNAEEsiAEF9\nRg0ACyABQRBqJAAgAAsJAEGUIEEBED4LBAAQRQsEABBECzMBAX8gAgRAIAAhAwNAIAMgAS0AADoA\nACABQQFqIQEgA0EBaiEDIAJBAWsiAg0ACwsgAAspAQF/IAIEQCAAIQMDQCADIAE6AAAgA0EBaiED\nIAJBAWsiAg0ACwsgAAtOAgF/AX4CQEGg8AAoAgAiAEUNACAAKQIAIgFC//////////8/Vg0AA0Ag\nACABp0H/////A3FqIgApAgAiAUKAgICAgICAgMAAVA0ACwsLtwQCA38CfiAARQRAQQAPCyAAQQtq\nIgJBfHEhA0EAIQACQEGk8AAoAgAiAUUNAANAAkAgASIAKQIAIgVCgICAgIyAgIBAg0KAgICABFIE\nQAwBC0Gk8AAgADYCACAAIAWnQf////8DcWohASAADQELCyABRQRAQQAhAAwBCwNAIAEiACkCACIE\np0H/////A3EiASADSSAEQoCAgIAMg0IAUnJFBEACQCABIANrIgFBDUkNACAAIAJB/P///wNxrSIF\nIARCgICAgHyDhDcCACAAIANqIgIgAUH/////A3GtIAVCIIaENwIAIAApAgAiBEKAgICAgICAgMAA\nVA0AIAAgBEL//////////z+DNwIAIAIgAikCAEL//////////z+DQoCAgICAgICAwACENwIAIAAp\nAgAhBAsgACAEQv////9zg0KAgICABIQ3AgAgAEEIag8LIARC//////////8/Vg0BIAAgAWohASAA\nDQALIAEhAAsgAxABIgEgAkH8////A3GtIAEpAgBCgICAgPD///8/g4RCgICAgISAgIDAAIQiBTcC\nAAJAQaDwACgCAEUEQEGg8AAgATYCAEGk8AAgATYCACABIAVC/P///4eAgIDAAIM3AgAMAQsgASAA\nKQIAQiCGQoCAgIDw////P4MgBUL8////h4CAgMAAg4Q3AgAgACABIAAgACkCACIEp0H/////A3Fq\nRwR+EAAgACkCAAUgBAtC//////////8/gzcCAAsgAUEIaguxAQIBfwJ+AkAgAEUNACAAKQIAIgJC\n//////////8/Vg0AIAAgACACp0H/////A3FqIgEpAgAgAnxC/////wODIgMgAkKAgICAfIOEIgI3\nAgAgACACQv//////////P4MgASkCACICQoCAgICAgICAQIOENwIAIAJC//////////8/Vg0AIAEg\nASgCAEH/////A3FqIgEgASkCAEL/////j4CAgECDIANCIIaENwIACyAAC6sBAgF/AX4CQCAARQ0A\nIABBCGshAQJAIABBBGsoAgBB/////wNxIgBFDQAgASAAayIAQQNqLQAAQcABcQ0AIAAQDyEBCwJA\nIAEpAgAiAkL//////////z9WDQAgASACp0H/////A3FqQQNqLQAAQcABcQ0AIAEQDxogASkCACEC\nCyABIAJC/////3ODNwIAQaTwACgCACIAIAFNQQAgABsNAEGk8AAgATYCAAsL5ggCE38CfiMAQRBr\nIgokACAKQQA2AgwgCkEANgIIQVQhBAJAAkAgA0HkBWoiBiADIApBCGogCkEMaiABIAIgA0GAAWoQ\nEiIOQYh/Sw0AIAooAgwiDCAAKAIAIgFB/wFxQQFqSw0BIAAgAUH/gYB4cSAMQRB0QYCA/AdxcjYC\nACAKKAIIIQsgDEEATgRAIAxBAWohASADIQQDQCAEQUBrIAU2AgAgBCgCACAFaiEFIARBBGohBCAB\nQQFrIgENAAsLQQAhASALQQROBEAgC0EDayEFIANBQGshByADQeQDaiEJIAYhAgNAQQAhBANAIAcg\nAiAEai0AAEECdGoiCCAIKAIAIghBAWo2AgAgCCAJaiABIARqOgAAIARBAWoiBEEERw0ACyACQQRq\nIQIgAUEEaiIBIAVIDQALCyABIAtIBEAgA0FAayECIANB5ANqIQQDQCACIAEgBmotAABBAnRqIgUg\nBSgCACIFQQFqNgIAIAQgBWogAToAACALIAFBAWoiAUcNAAsLIAxBAWoiD0ECSQ0AIABBHGohECAA\nQQVqIREgA0HkA2ohCCAAQQdqIRIgAEEEaiETIABBDGohFCADKAIAIQdBACEAQQEhBANAIA8gBCIL\nayEJIAMgBEECdGooAgAhAQJAAkACQAJAAkACQEEBIAR0IhVBAXUiDUEBaw4IAwIEAQQEBAAECyAB\nQQFIDQQgByAIaiECIBQgAEEBdGohBCAJQQh0QYD+A3GtIRcgASEFA0AgBCACMQAAIBeEQoGAhICQ\ngMAAfiIYNwAAIARBCGsgGDcAACAEQRBqIQQgAkEBaiECIAVBAWsiBQ0ACwwECyABQQFIDQMgByAI\naiEEIBMgAEEBdGohAiAJQQh0QYD+A3GtIRcgASEFA0AgAiAEMQAAIBeEQoGAhICQgMAAfjcAACAC\nQQhqIQIgBEEBaiEEIAVBAWsiBQ0ACwwDCyABQQFIDQIgByAIaiECIBIgAEEBdGohBCABIQUDQCAC\nLQAAIQYgBCAJOgAAIARBAWsgBjoAACAEQQJrIAk6AAAgBEEDayAGOgAAIARBBGohBCACQQFqIQIg\nBUEBayIFDQALDAILIAFBAUgNASAHIAhqIQIgESAAQQF0aiEEIAEhBgNAIAItAAAhBSAEIAk6AAAg\nBEEBayAFOgAAIARBAmohBCACQQFqIQIgBkEBayIGDQALDAELIAFBAUgNACANQQF0IRYgECAAQQF0\naiECIAlBCHRBgP4Dca0hGEEAIQYDQAJAIBVBAk4EQCAIIAYgB2pqMQAAIBiEQoGAhICQgMAAfiEX\nQQAhBSACIQQDQCAEIBc3AAAgBEEIayAXNwAAIARBEGsgFzcAACAEQRhrIBc3AAAgBEEgaiEEIAVB\nEGoiBSANSA0ACyAFIA1GDQELEAALIAIgFmohAiAGQQFqIgYgAUcNAAsLIAtBAWohBCABIAdqIQcg\nASANbCAAaiEAIAsgDEcNAAsLIA4hBAsgCkEQaiQAIAQLuAMBBH9BuH8hCQJAAkAgBUUNACAELAAA\nIghB/wFxIQcCQCAIQX9MBEAgB0H+AGtBAXYiCCAFTw0CQWwhCSAHQf8AayIGQYACTw0CIAZFDQMg\nBEEBaiEKQQAhBQNAIAAgBWoiByAKIAVBAXZqIgQtAABBBHY6AAAgB0EBaiAELQAAQQ9xOgAAIAVB\nAmoiBSAGSQ0ACyAIIQcMAQsgBSAHTQ0BIAAgBEEBaiAHIAYQEyIGIQkgBkGIf0sNAQtBACEEIAFB\nAEE0EAwhCkFsIQkgBkUNACAAIQUgBiEBA0AgBS0AACIIQQtLDQEgCiAIQQJ0aiIIIAgoAgBBAWo2\nAgBBASAFLQAAdEEBdSAEaiEEIAVBAWohBSABQQFrIgENAAsgBEUgBEH/H0tyDQAgA0EgIARnayIB\nNgIAAn9BASABdCAEayIDBEAgA2dBH3MMAQsQABAAQT8LIQFBASABdCADRw0AIAAgBmogAUEBaiIA\nOgAAIAogAEECdGoiACAAKAIAQQFqNgIAIAooAgQiAEECSSAAQQFxcg0AIAIgBkEBajYCACAHQQFq\nIQkLIAkPCyABQQBBNBAMGkFsC54aAQ5/IwBBkARrIg0kACANQf8BNgIIAkAgDUEQaiANQQhqIA1B\nDGogASACEDUiBEGIf0sEQCAEIQcMAQtBVCEHIA0oAgwiBUEGSw0AIAIgBEkEQBAACyANKAIIIghB\nAXRBAmqtQgEgBa2GQQEgBXRBAWoiBqxCAoZ8fEILfEJ8g0LkAlYNACADIA1BEGogCCAFIAMgBkEC\ndCIFakHkAiAFaxA6IgdBiH9LDQAgAiAEayECIAEgBGohBiAAQf8BaiIOQQNrIQwCQAJAAkACfwJA\nIAMvAQIEQCACRQ0FAn8CQCACQQRPBEBBfyEHIAIgBmpBAWstAAAiBEUNCSACQYh/TQ0BDAcLIAYt\nAAAhBwJAAkACQCACQQJrDgIBAAILIAYtAAJBEHQgB3IhBwsgBi0AAUEIdCAHaiEHCyACIAZqQQFr\nLQAAIgRFDQVBACEBIARnQWByIAJBA3RrQSlqDAELIAYgAkEEayIBaigAACEHIARnQWByQQlqCyEC\nIAMvAQAiBEEgTwRAEAALQQAgAiAEaiICa0EfcSEJIARBAnRB8B1qIQQgAkEgSw0BIAFBBE4EQCAC\nQQdxIQggBiABIAJBA3ZrIgFqKAAADAMLIAFFBEBBACEBDAILIAIgASACQQN2IgIgASAGaiACayAG\nSRsiAkEDdGshCCAGIAEgAmsiAWooAAAMAgsgAkUNBAJ/IAJBBE8EQEF/IQcgAiAGakEBay0AACIE\nRQ0HIAJBiH9LDQUgBiACQQRrIgFqKAAAIQcgBGdBYHJBCWoMAQsgBi0AACEHAkACQAJAIAJBAmsO\nAgEAAgsgBi0AAkEQdCAHciEHCyAGLQABQQh0IAdqIQcLIAIgBmpBAWstAAAiBEUNA0EAIQEgBGdB\nYHIgAkEDdGtBKWoLIQIgAy8BACIEQSBPBEAQAAtBACACIARqIgJrQR9xIQUgBEECdEHwHWoCfwJA\nIAJBIEsNACABQQROBEAgAkEHcSEIIAYgASACQQN2ayIBaigAAAwCCyABRQRAQQAhAQwBCyACIAEg\nAkEDdiICIAEgBmogAmsgBkkbIgJBA3RrIQggBiABIAJrIgFqKAAADAELIAIhCCAHCyECKAIAIAMv\nAQAiBEEgTwRAEAALIAcgBXZxIQkgA0EEaiEKIARBAnRB8B1qKAIAIAJBACAEIAhqIgNrdnEhCAJA\nAkACQCADQSBLBEAgAyEFDAELIAFBBE4EQCADQQdxIQUgBiABIANBA3ZrIgFqKAAAIQIMAgsgAUUE\nQEEAIQEgAyEFDAILIAYgASABIANBA3YiAiABIAZqIAJrIAZJGyIEayIBaigAACECIAMgBEEDdGsi\nBUEgTQ0BCyAAIQQMAQsgACEEAkACQANAAkAgAUEETgRAIAVBB3EhAyAFQQN2IQdBACEFDAELIAFF\nBEBBACEBDAULIAUgASAFQQN2IgIgASAGaiACayAGSSIFGyIHQQN0ayEDCyAGIAEgB2siAWoiBygA\nACECIAQgDE8gBXINAiAKIAlBAnRqIgUtAAIhCSAFLwEAIQsgBS0AAyIFQSBPBEAQAAsgBCAJOgAA\nIAVBAnRB8B1qKAIAIAJBACADIAVqIgVrdnEgCiAIQQJ0aiIDLQACIQggAy8BACEPIAMtAAMiA0Eg\nTwRAEAALIAtqIQkgBEEBaiAIOgAAIANBAnRB8B1qKAIAIAJBACADIAVqIgNrdnEgD2ohCAJAIANB\nIEsNAAJAIAFBBE4EQCADQQdxIQUgBiABIANBA3ZrIgFqKAAAIQIMAQsgAUUEQEEAIQEMAgsgAyAB\nIANBA3YiAiAHIAJrIgMgBkkbIgJBA3RrIQUgBiABIAJrIgFqKAAAIQIgAyAGSQ0DCyAKIAlBAnRq\nIgMtAAIhByADLwEAIQkgAy0AAyIDQSBPBEAQAAsgBEECaiAHOgAAIANBAnRB8B1qKAIAIAJBACAD\nIAVqIgVrdnEgCiAIQQJ0aiIDLQACIQggAy8BACELIAMtAAMiA0EgTwRAEAALIAlqIQkgBEEDaiAI\nOgAAIANBAnRB8B1qKAIAIAJBACADIAVqIgVrdnEgC2ohCCAEQQRqIQQgBUEhSQ0BDAQLCyADIQUL\nIARBAmohBAwBCyADIQULQbp/IQcgBCAOQQJrIg5LDQUgBEEDaiEEAkADQCAKIAlBAnRqIgMtAAIh\nDCADLwEAIQ8gAy0AAyIJQSBPBEAQAAsgBEEDayAMOgAAAn8CfwJAIAUgCWoiBUEgTQRAIARBAmsh\nDCABQQROBEAgASAFQQN2ayEBIAVBB3EMAwsgAQ0BQQAhASAFIQMgAgwDCyAKIAhBAnRqIgEtAAIh\nAiABLQADQSBPBEAQAAsgBEECayACOgAAIARBAWshBAwECyABIAEgBUEDdiIDIAEgBmogA2sgBkkb\nIgNrIQEgBSADQQN0awshAyABIAZqKAAACyELIAwgDksNByAJQQJ0QfAdaigCACACQQAgBWt2cSAK\nIAhBAnRqIgItAAIhCCACLwEAIRAgAi0AAyICQSBPBEAQAAsgD2ohCSAMIAg6AAAgAiADaiIFQSBN\nBEAgAkECdEHwHWooAgAgC0EAIAVrdnECfwJ/IAFBBE4EQCABIAVBA3ZrIQEgBUEHcQwBCyABRQRA\nQQAhASALDAILIAEgASAFQQN2IgIgASAGaiACayAGSRsiAmshASAFIAJBA3RrCyEFIAEgBmooAAAL\nIQIgEGohCCAEQQFrIARBAmohBCAOTQ0BDAgLCyAKIAlBAnRqIgEtAAIhAiABLQADQSBPBEAQAAsg\nBEEBayACOgAACyAEIABrIQcMBQsgAiEIIAcLIQUgBCgCACADLwEAIgJBIE8EQBAACyAHIAl2cSEJ\nIANBBGohCiACQQJ0QfAdaigCACAFQQAgAiAIaiIDa3ZxIQgCQAJAAkAgA0EgSwRAIAMhAgwBCyAB\nQQROBEAgA0EHcSECIAYgASADQQN2ayIBaigAACEFDAILIAFFBEBBACEBIAMhAgwCCyAGIAEgASAD\nQQN2IgIgASAGaiACayAGSRsiAmsiAWooAAAhBSADIAJBA3RrIgJBIE0NAQsgACEEDAELIAAhBAJA\nAkADQAJ/IAFBBE4EQCACQQN2IQVBACEDIAJBB3EMAQsgAUUEQEEAIQEMBQsgAiABIAJBA3YiAiAB\nIAZqIAJrIAZJIgMbIgVBA3RrCyECIAYgASAFayIBaiILKAAAIQUgBCAMTyADcg0CIAogCUECdGoi\nAy0AAiEHIAMvAQAhCSADLQADIgNFBEAQABAACyAEIAc6AAAgCiAIQQJ0aiIHLQACIQggBy8BACEP\nIActAAMiB0UEQBAAEAALIAUgAnRBACADa3YgCWohCSAEQQFqIAg6AAAgBSACIANqIgJ0QQAgB2t2\nIA9qIQgCQCACIAdqIgNBIEsNAAJAIAFBBE4EQCADQQdxIQIgBiABIANBA3ZrIgFqKAAAIQUMAQsg\nAUUEQEEAIQEMAgsgAyABIANBA3YiAiALIAJrIgMgBkkbIgVBA3RrIQIgBiABIAVrIgFqKAAAIQUg\nAyAGSQ0DCyAKIAlBAnRqIgMtAAIhByADLwEAIQkgAy0AAyIDRQRAEAAQAAsgBEECaiAHOgAAIAog\nCEECdGoiBy0AAiEIIAcvAQAhCyAHLQADIgdFBEAQABAACyAFIAJ0QQAgA2t2IAlqIQkgBEEDaiAI\nOgAAIAUgAiADaiICdEEAIAdrdiALaiEIIARBBGohBCACIAdqIgJBIUkNAQwECwsgAyECCyAEQQJq\nIQQLC0G6fyEHIAQgDkECayIOSw0DIARBA2ohBAJAA0AgCiAJQQJ0aiIDLQACIQwgAy8BACEPIAMt\nAAMiCUUEQBAAEAALIARBA2sgDDoAAAJ/An8CQCACIAlqIgNBIE0EQCAEQQJrIQwgAUEETgRAIAEg\nA0EDdmshASADQQdxDAMLIAENAUEAIQEgBQwDCyAKIAhBAnRqIgEtAAIhAiABLQADRQRAEAAQAAsg\nBEECayACOgAAIARBAWshBAwECyABIAEgA0EDdiILIAEgBmogC2sgBkkbIgtrIQEgAyALQQN0awsh\nAyABIAZqKAAACyELIAwgDksNBSAKIAhBAnRqIggtAAIhECAILwEAIREgCC0AAyIIRQRAEAAQAAsg\nBSACdEEAIAlrdiAPaiEJIAwgEDoAACADIAhqIgJBIE0EQCALIAN0QQAgCGt2An8CfyABQQROBEAg\nASACQQN2ayEBIAJBB3EMAQsgAUUEQEEAIQEgCwwCCyABIAEgAkEDdiIFIAEgBmogBWsgBkkbIgVr\nIQEgAiAFQQN0awshAiABIAZqKAAACyEFIBFqIQggBEEBayAEQQJqIQQgDk0NAQwGCwsgCiAJQQJ0\naiIBLQACIQIgAS0AA0UEQBAAEAALIARBAWsgAjoAAAsgBCAAayEHDAMLQWwhBwwCCyACIQcMAQtB\nuH8hBwsgDUGQBGokACAHC4MGAQp/IANFBEBBuH8PCyAEKAIAIQcCfwJAAkAgA0EETwRAQX8gAiAD\nakEBay0AACIGRQ0DGiADQYh/TQ0BIAMPCyACLQAAIQYCQAJAAkAgA0ECaw4CAQACCyACLQACQRB0\nIAZyIQYLIAItAAFBCHQgBmohBgsgAiADakEBay0AACIFRQRAQWwPCyAFZ0FgciADQQN0a0EpaiEF\nQQAhAwwBCyAGZ0FgckEJaiEFIAIgA0EEayIDaigAACEGCyAEQQRqIQsgACABaiEMIAdBEHYiBEH/\nAXEhCQJAAkACQAJAAkACQAJAIAVBIU8EQEEAIARrQR9xIQoMAQsgDEEDayEOQQAgBGtBH3EhCiAJ\nRSENA0ACfyADQQROBEAgBUEDdiEGQQAhCCAFQQdxDAELIANFBEBBACEDIAIhByAFIQQMBQsgBSAD\nIAVBA3YiBCACIANqIARrIAJJIggbIgZBA3RrCyEEIAIgAyAGayIDaiIHKAAAIQYgACAOTyAIcg0C\nIAlFBEAQAAsgCyAGIAR0IAp2QQF0aiIFLQABIQcgACAFLQAAOgAAIAlFBEAQAAsgCyAGIAQgB2oi\nBHQgCnZBAXRqIgUtAAEhByAAQQFqIAUtAAA6AAAgAEECaiEAIAQgB2oiBUEhSQ0ACwsgAiADaiEH\nIAlFIQ0MAwsgBEEgSw0BCwNAAn8gA0EETgRAIARBA3YhBkEAIQggBEEHcQwBCyADRQ0CIAQgAyAE\nQQN2IgQgAiADaiAEayACSSIIGyIGQQN0awshBSACIAMgBmsiA2oiBygAACEGQQAgACAMTyIERSAI\nG0UEQCAERQ0EDAULIAlFBEAQAAsgCyAGIAV0IAp2QQF0aiIELQABIQggACAELQAAOgAAIABBAWoh\nACAFIAhqIgRBIE0NAAsLIAQhBQsgACAMTw0BCwNAIA0EQBAACyALIAYgBXQgCnZBAXRqIgMtAAEg\nACADLQAAOgAAIAVqIQUgDCAAQQFqIgBHDQALCyABQWwgBUEgRhtBbCACIAdGGwsLuxwBI38CQCAD\nQQpJDQAgAyACLwAEIgUgAi8AACIIQQZqIgogAi8AAiIJamoiDEkNAAJAIAhFDQAgAkEGaiEGIAQo\nAgAhCwJ/An8gCEEETwRAQX8gBiAIakEBay0AACIGRQ0CGiACIAhBAmoiDmooAAAhByAGZ0FgckEJ\nagwBCyAGLQAAIQcCQAJAAkAgCEECaw4CAQACCyACLQAIQRB0IAdyIQcLIAItAAdBCHQgB2ohBwsg\nBiAIakEBay0AACIGRQ0DQQYhDiAGZ0FgciAIQQN0a0EpagshBiAJRQ0BIAIgCmoiFSAJaiEUAn8g\nCUEETwRAQX8gFEEBay0AACIIRQ0CGiAVIAlBBGsiEGooAAAhDyAIZ0FgckEJagwBCyAVLQAAIQ8C\nQAJAAkAgCUECaw4CAQACCyAVLQACQRB0IA9yIQ8LIBUtAAFBCHQgD2ohDwsgFEEBay0AACIIRQ0D\nIAhnQWByIAlBA3RrQSlqCyEIIAVFDQEgBSAUaiERAn8gBUEETwRAQX8gEUEBay0AACIJRQ0CGiAU\nIAVBBGsiEmooAAAhFiAJZ0FgckEJagwBCyAULQAAIRYCQAJAAkAgBUECaw4CAQACCyAULQACQRB0\nIBZyIRYLIBQtAAFBCHQgFmohFgsgEUEBay0AACIJRQ0DIAlnQWByIAVBA3RrQSlqCyEJQbh/IAMg\nDGsiBUUNABoCfwJAIAVBBE8EQEF/IAUgEWpBAWstAAAiA0UNAxogBUGIf00NASAFDwsgES0AACEX\nAkACQAJAIAVBAmsOAgEAAgsgES0AAkEQdCAXciEXCyARLQABQQh0IBdqIRcLIAUgEWpBAWstAAAi\nA0UNBCADZ0FgciAFQQN0a0EpagwBCyARIAVBBGsiE2ooAAAhFyADZ0FgckEJagshAyAEQQRqIQ0g\nC0EQdiIbQf8BcSEZAn8gACABQQNqQQJ2IgpqIhwgCmoiHSAKaiIeIAAgAWoiH0EDayIkTwRAIB4h\nDCAcIQsgHQwBCyAKQQNsISAgCkEBdCElQQAgG2tBH3EhC0EBIRoDQCAAIQQgGUUEQBAACyANIAcg\nBnQgC3ZBAXRqIgAtAAEhBSAEIAAtAAA6AAAgGUUEQBAACyANIA8gCHQgC3ZBAXRqIgAtAAEhDCAE\nIApqIiEgAC0AADoAACAZRQRAEAALIA0gFiAJdCALdkEBdGoiAC0AASEiIAQgJWoiIyAALQAAOgAA\nIBlFBEAQAAsgDSAXIAN0IAt2QQF0aiIALQABISYgBCAgaiIYIAAtAAA6AAAgGUUEQBAACyANIAcg\nBSAGaiIAdCALdkEBdGoiBi0AASEFIARBAWogBi0AADoAACAZRQRAEAALIA0gDyAIIAxqIgh0IAt2\nQQF0aiIGLQABIScgIUEBaiAGLQAAOgAAIBlFBEAQAAsgDSAWIAkgImoiCXQgC3ZBAXRqIgYtAAEh\nISAjQQFqIAYtAAA6AAAgGUUEQBAACyAAIAVqIQAgDSAXIAMgJmoiInQgC3ZBAXRqIgMtAAEhIyAY\nQQFqIAMtAAA6AABBACEMAn8gDkEKSARAIAAhBkEADAELIABBIU8EQBAACyAAQQdxIQYgAiAOIABB\nA3ZrIg5qKAAAIQdBAQsgCCAnaiEAIBpxIBBBBEgEfyAABSAAQSFPBEAQAAsgFSAQIABBA3ZrIhBq\nKAAAIQ9BASEMIABBB3ELIQggCSAhaiEAIAxxQQAhDAJ/IBJBBEgEQEEAIQUgAAwBCyAAQSFPBEAQ\nAAsgFCASIABBA3ZrIhJqKAAAIRZBASEFIABBB3ELIQkgIiAjaiEAIAVxIBNBBEgEfyAABSAAQSFP\nBEAQAAsgESATIABBA3ZrIhNqKAAAIRdBASEMIABBB3ELIQMgBEECaiEAIAxxIhogGEECaiAkSXEN\nAAsgBEECaiIAIApqIQsgACAKQQNsaiEMIAAgCkEBdGoLIgogHksgCyAdS3INAkFsIAAgHEsNABoC\nQAJAAkACQAJAAkACQCAGQSFPBEBBACAba0EfcSEaDAELIBxBA2shIEEAIBtrQR9xIRogGUUhBANA\nAn8gDkEKTgRAIAZBA3YhB0EAIRggBkEHcQwBCyAOQQZGBEAgBiEFQQYhDgwFCyAGIA5BBmsgBkED\ndiIGIA4gBmtBBkgiGBsiB0EDdGsLIQUgAiAOIAdrIg5qKAAAIQcgACAgTyAYcg0CIBlFBEAQAAsg\nDSAHIAV0IBp2QQF0aiIGLQABIRggACAGLQAAOgAAIBlFBEAQAAsgDSAHIAUgGGoiBnQgGnZBAXRq\nIgUtAAEhGCAAQQFqIAUtAAA6AAAgAEECaiEAIAYgGGoiBkEhSQ0ACwsgGUUhBAwDCyAFQSBLDQEL\nA0ACfyAOQQpOBEAgBUEDdiEHQQAhGCAFQQdxDAELIA5BBkYEQEEGIQ4MAwsgBSAOQQZrIAVBA3Yi\nBiAOIAZrQQZIIhgbIgdBA3RrCyEGIAIgDiAHayIOaigAACEHQQAgACAcTyIFRSAYG0UEQCAFDQUM\nBAsgGUUEQBAACyANIAcgBnQgGnZBAXRqIgUtAAEhGCAAIAUtAAA6AAAgAEEBaiEAIAYgGGoiBUEg\nTQ0ACwsgBSEGCyAAIBxPDQELA0AgBARAEAALIA0gByAGdCAadkEBdGoiAi0AASAAIAItAAA6AAAg\nBmohBiAcIABBAWoiAEcNAAsLAkACQAJAAkACQAJAAkAgCEEhTwRAQQAgG2tBH3EhAgwBCyAdQQNr\nIRxBACAba0EfcSECA0ACfyAQQQROBEAgCEEDdiEFQQAhByAIQQdxDAELIBBFBEBBACEQIBUhGiAI\nIQAMBQsgCCAQIAhBA3YiACAQIBVqIABrIBVJIgcbIgVBA3RrCyEAIBUgECAFayIQaiIaKAAAIQ8g\nCyAcTyAHcg0CIAQEQBAACyANIA8gAHQgAnZBAXRqIggtAAEhBSALIAgtAAA6AAAgBARAEAALIA0g\nDyAAIAVqIgB0IAJ2QQF0aiIILQABIQUgC0EBaiAILQAAOgAAIAtBAmohCyAAIAVqIghBIUkNAAsL\nIBAgFWohGgwDCyAAQSBLDQELA0ACfyAQQQROBEAgAEEDdiEFQQAhByAAQQdxDAELIBBFDQIgACAQ\nIABBA3YiACAQIBVqIABrIBVJIgcbIgVBA3RrCyEIIBUgECAFayIQaiIaKAAAIQ9BACALIB1PIgBF\nIAcbRQRAIABFDQQMBQsgBARAEAALIA0gDyAIdCACdkEBdGoiAC0AASALIAAtAAA6AAAgC0EBaiEL\nIAhqIgBBIE0NAAsLIAAhCAsgCyAdTw0BCwNAIAQEQBAACyANIA8gCHQgAnZBAXRqIgAtAAEgCyAA\nLQAAOgAAIAhqIQggHSALQQFqIgtHDQALCwJAAkACQAJAAkACQAJAIAlBIU8EQEEAIBtrQR9xIQIM\nAQsgHkEDayELQQAgG2tBH3EhAgNAAn8gEkEETgRAIAlBA3YhBUEAIQcgCUEHcQwBCyASRQRAQQAh\nEiAUIQ8gCSEADAULIAkgEiAJQQN2IgAgEiAUaiAAayAUSSIHGyIFQQN0awshACAUIBIgBWsiEmoi\nDygAACEWIAogC08gB3INAiAEBEAQAAsgDSAWIAB0IAJ2QQF0aiIJLQABIQUgCiAJLQAAOgAAIAQE\nQBAACyANIBYgACAFaiIAdCACdkEBdGoiCS0AASEFIApBAWogCS0AADoAACAKQQJqIQogACAFaiIJ\nQSFJDQALCyASIBRqIQ8MAwsgAEEgSw0BCwNAAn8gEkEETgRAIABBA3YhBUEAIQcgAEEHcQwBCyAS\nRQ0CIAAgEiAAQQN2IgAgEiAUaiAAayAUSSIHGyIFQQN0awshCSAUIBIgBWsiEmoiDygAACEWQQAg\nCiAeTyIARSAHG0UEQCAARQ0EDAULIAQEQBAACyANIBYgCXQgAnZBAXRqIgAtAAEgCiAALQAAOgAA\nIApBAWohCiAJaiIAQSBNDQALCyAAIQkLIAogHk8NAQsDQCAEBEAQAAsgDSAWIAl0IAJ2QQF0aiIA\nLQABIAogAC0AADoAACAJaiEJIB4gCkEBaiIKRw0ACwtBACAba0EfcSECAkACQAJAAkACQAJAIANB\nIE0EQANAAn8gE0EETgRAIANBA3YhBUEAIQogA0EHcQwBCyATRQRAQQAhEyARIQcgAyEADAULIAMg\nEyADQQN2IgAgESATaiAAayARSSIKGyIFQQN0awshACARIBMgBWsiE2oiBygAACEXIAwgJE8gCnIN\nAiAEBEAQAAsgDSAXIAB0IAJ2QQF0aiIDLQABIQUgDCADLQAAOgAAIAQEQBAACyANIBcgACAFaiIA\ndCACdkEBdGoiAy0AASEFIAxBAWogAy0AADoAACAMQQJqIQwgACAFaiIDQSFJDQALCyARIBNqIQcM\nAwsgAEEgSw0BCwNAAn8gE0EETgRAIABBA3YhBUEAIQogAEEHcQwBCyATRQ0CIAAgEyAAQQN2IgAg\nESATaiAAayARSSIKGyIFQQN0awshAyARIBMgBWsiE2oiBygAACEXQQAgDCAfTyIARSAKG0UEQCAA\nRQ0EDAULIAQEQBAACyANIBcgA3QgAnZBAXRqIgAtAAEhBSAMIAAtAAA6AAAgDEEBaiEMIAMgBWoi\nAEEgTQ0ACwsgACEDCyAMIB9PDQELA0AgBARAEAALIA0gFyADdCACdkEBdGoiAC0AASEFIAwgAC0A\nADoAACADIAVqIQMgHyAMQQFqIgxHDQALCyABQWwgByARRhtBbCADQSBGG0FsIA8gFEYbQWwgCUEg\nRhtBbCAVIBpGG0FsIAhBIEYbQWwgBkEgRhtBbCAOQQZGGwsPC0G4fw8LQWwLNgAgACADIAQgBRAR\nIgVBiH9LBEAgBQ8LIAQgBUsEfyABIAIgAyAFaiAEIAVrIAAQFQVBuH8LC80IARh/IwBBwANrIgYk\nAEFUIQUCQCAEQdwLSQ0AIAAoAgAhEyADQfAEakEAQewAEAwhBCATQf8BcSIPQQxLDQAgA0HcCWoi\nByAEIAZBCGogBkEMaiABIAIgBkHQAGoQEiIWQYh/TQRAIAYoAgwiCSAPSw0BIAlBAnQgA2pB8ARq\nIQVBACEBA0AgDUEBaiENIAFBNGohASAFKAIAIAVBBGshBUUNAAsgCSANayICQQFqIQggAkECaiIL\nQQJPBEAgA0GsBWohBSAIIQQDQCAFIAo2AgAgBUE4aygCACAKaiEKIAVBBGohBSAEQQFrIgQNAAsL\nIANB3AVqIREgA0GoBWoiAiAKNgIAIAYoAggiBARAQQAhBQNAIAIgBSAHai0AACIOQQJ0aiIMIAwo\nAgAiDEEBajYCACARIAxBAXRqIgwgDjoAASAMIAU6AAAgBCAFQQFqIgVHDQALC0EAIQQgAkEANgIA\nIAtBAk8EQCAPIAlrIQcgA0H0BGohBUEAIQIDQCAFQfAEayACNgIAIAUoAgAgBCAHanQgAmohAiAF\nQQRqIQUgCCAEQQFqIgRHDQALCyAPIA1rQQFqIg4gDUsEQCADQQRqIQcgC0ECSSELIA0hAgNAIAtF\nBEAgByEFIAghBANAIAEgBWogBSgCACACdjYCACAFQQRqIQUgBEEBayIEDQALCyABQTRqIQEgAkEB\naiICIA5JDQALCyADQaQFaiEXIAZBEGogA0E0EAsaIAoEQCAJQQFqIgwgD2shGCAAQQRqIQlBACEL\nA0BBASAPIAwgESALQQF0aiIBLQABIgJrIghrIhR0IQcgAS0AACEOIAZBEGogAkECdGoiGSgCACEC\nAkAgDSAUTQRAIBcgCCAYaiIBQQEgAUEBShtBAnQiBGooAgAhECAGQdAAaiADIAhBNGxqQTQQCxog\nCiAQayEVAkAgAUECSA0AIAZB0ABqIARqKAIAIgRFDQAgCSACQQJ0aiEFIAhBEHRBgID8B3EgDnJB\ngICACHIhAQNAIAUgATYBACAFQQRqIQUgBEEBayIEDQALCyAVBEAgESAQQQF0aiEaIAkgAkECdGoh\nG0EAIQEDQEEBIBQgDCAaIAFBAXRqIgUtAAEiBGsiEmt0IAZB0ABqIARBAnRqIhwoAgAiBGohECAI\nIBJqQRB0QYCA/AdxIAUtAABBCHQgDnJyQYCAgBByIRIgGyAEQQJ0aiEFA0AgBSASNgEAIAVBBGoh\nBSAEQQFqIgQgEEkNAAsgHCAQNgIAIAFBAWoiASAVRw0ACwsgAiAHaiEBDAELIAIgAiAHaiIBTw0A\nIAkgAkECdGohBSAIQRB0QYCA/AdxIA5yQYCAgAhyIQIDQCAFIAI2AQAgBUEEaiEFIAdBAWsiBw0A\nCwsgGSABNgIAIAtBAWoiCyAKRw0ACwsgACATQf+BgHhxIA9BEHRyQYACcjYCAAsgFiEFCyAGQcAD\naiQAIAUL7AYBCn8gA0UEQEG4fw8LAn8CQAJAIANBBE8EQEF/IAIgA2pBAWstAAAiBkUNAxogA0GI\nf00NASADDwsgAi0AACEHAkACQAJAIANBAmsOAgEAAgsgAi0AAkEQdCAHciEHCyACLQABQQh0IAdq\nIQcLIAIgA2pBAWstAAAiBkUEQEFsDwsgBmdBYHIgA0EDdGtBKWohBUEAIQMMAQsgBmdBYHJBCWoh\nBSACIANBBGsiA2ooAAAhBwsgBEEEaiEJIAAgAWohCiAEKAIAQRB2IgRB/wFxIQsCQAJAAkACQAJA\nIAVBIU8EQEEAIARrQR9xIQQMAQsgCkEDayEOQQAgBGtBH3EhBCALRSENA0ACfyADQQROBEAgBUED\ndiEHQQAhCCAFQQdxDAELIANFBEAgCkECayEIQQAhAyACIQwgBSEGDAULIAUgAyAFQQN2IgYgAiAD\naiAGayACSSIIGyIHQQN0awshBiACIAMgB2siA2oiDCgAACEHIAAgDk8gCHINAiALRQRAEAALIAAg\nCSAHIAZ0IAR2QQJ0aiIFLwEAOwAAIAAgBS0AA2ohACAGIAUtAAJqIQUgC0UEQBAACyAAIAkgByAF\ndCAEdkECdGoiBi8BADsAACAAIAYtAANqIQAgBSAGLQACaiIFQSFJDQALCyACIANqIQwgCkECayEI\nIAtFIQ0MAwsgCkECayEIIAZBIEsNAQsDQAJAIANBBE4EQCAGQQdxIQUgBkEDdiEHQQAhBgwBCyAD\nRQ0CIAYgAyAGQQN2IgYgAiADaiAGayACSSIGGyIHQQN0ayEFCyACIAMgB2siA2oiDCgAACEHIAAg\nCEsgBnINAiALRQRAEAALIAAgCSAHIAV0IAR2QQJ0aiIGLwEAOwAAIAAgBi0AA2ohACAFIAYtAAJq\nIgZBIE0NAAsLIAYhBQsgACAITQRAA0AgDQRAEAALIAAgCSAHIAV0IAR2QQJ0aiIDLwEAOwAAIAUg\nAy0AAmohBSAAIAMtAANqIgAgCE0NAAsLAkAgACAKTw0AIA0EQBAACyAAIAkgByAFdCAEdiIAQQJ0\naiIDLQAAOgAAIAMtAANBAUYEQCAFIAMtAAJqIQUMAQsgBUEfSw0AIAUgCSAAQQJ0ai0AAmoiAEEg\nIABBIEkbIQULIAFBbCAFQSBGG0FsIAIgDEYbCwuEIAEjfwJAIANBCkkNACADIAIvAAQiBiACLwAA\nIgdBBmoiDCACLwACIhdqaiIOSQ0AAkAgB0UNACACQQZqIQUgBCgCACEZAn8CfyAHQQRPBEBBfyAF\nIAdqQQFrLQAAIgVFDQIaIAIgB0ECaiIRaigAACEIIAVnQWByQQlqDAELIAUtAAAhCAJAAkACQCAH\nQQJrDgIBAAILIAItAAhBEHQgCHIhCAsgAi0AB0EIdCAIaiEICyAFIAdqQQFrLQAAIgVFDQNBBiER\nIAVnQWByIAdBA3RrQSlqCyEJIBdFDQEgAiAMaiIdIBdqIRgCfyAXQQRPBEBBfyAYQQFrLQAAIgVF\nDQIaIB0gF0EEayISaigAACEPIAVnQWByQQlqDAELIB0tAAAhDwJAAkACQCAXQQJrDgIBAAILIB0t\nAAJBEHQgD3IhDwsgHS0AAUEIdCAPaiEPCyAYQQFrLQAAIgVFDQMgBWdBYHIgF0EDdGtBKWoLIQcg\nBkUNASAGIBhqIRMCfyAGQQRPBEBBfyATQQFrLQAAIgVFDQIaIBggBkEEayIUaigAACEaIAVnQWBy\nQQlqDAELIBgtAAAhGgJAAkACQCAGQQJrDgIBAAILIBgtAAJBEHQgGnIhGgsgGC0AAUEIdCAaaiEa\nCyATQQFrLQAAIgVFDQMgBWdBYHIgBkEDdGtBKWoLIQxBuH8gAyAOayIORQ0AGgJ/AkAgDkEETwRA\nQX8gDiATakEBay0AACIDRQ0DGiAOQYh/TQ0BIA4PCyATLQAAIRsCQAJAAkAgDkECaw4CAQACCyAT\nLQACQRB0IBtyIRsLIBMtAAFBCHQgG2ohGwsgDiATakEBay0AACIDRQ0EIANnQWByIA5BA3RrQSlq\nDAELIBMgDkEEayIVaigAACEbIANnQWByQQlqCyEFIARBBGohCiAZQRB2Ih9B/wFxIR4CQCAAIAFB\nA2pBAnYiA2oiFyADaiIOIANqIhkgACABaiIhQQNrIiVPBEAgGSEQIA4hDSAXIQMMAQtBACAfa0Ef\ncSEgIBchAyAOIQ0gGSEQA0AgHkUEQBAACyAAIAogCCAJdCAgdkECdGoiBC8BADsAACAELQADISMg\nBC0AAiEEIB5FBEAQAAsgAyAKIA8gB3QgIHZBAnRqIgYvAQA7AAAgBi0AAyEcIAYtAAIhJCAeRQRA\nEAALIA0gCiAaIAx0ICB2QQJ0aiIGLwEAOwAAIAYtAAMgBi0AAiEWIB5FBEAQAAsgECAKIBsgBXQg\nIHZBAnRqIgYvAQA7AAAgBi0AAyEiIAYtAAIhBiAeRQRAEAALIAAgI2oiJiAKIAggBCAJaiIEdCAg\ndkECdGoiAC8BADsAACAALQADIScgAC0AAiEAIB5FBEAQAAsgAyAcaiIjIAogDyAHICRqIhx0ICB2\nQQJ0aiIDLwEAOwAAIAMtAAMhJCADLQACIQcgHkUEQBAACyANaiILIAogGiAMIBZqIhZ0ICB2QQJ0\naiIDLwEAOwAAIAMtAAMhDSADLQACIB5FBEAQAAsgACAEaiEAIBAgImoiECAKIBsgBSAGaiIFdCAg\ndkECdGoiAy8BADsAACADLQADIQQgAy0AAiEDQQMhBgJ/IBFBCkgEQEEDISIgAAwBCyAAQSFPBEAQ\nAAsgAiARIABBA3ZrIhFqKAAAIQhBACEiIABBB3ELIQkgByAcaiEAIBJBBEgEfyAABSAAQSFPBEAQ\nAAsgHSASIABBA3ZrIhJqKAAAIQ9BACEGIABBB3ELIQcgFmohAEEDIRwCfyAUQQRIBEBBAyEWIAAM\nAQsgAEEhTwRAEAALIBggFCAAQQN2ayIUaigAACEaQQAhFiAAQQdxCyEMIAQgEGohECADIAVqIQAg\nFUEESAR/IAAFIABBIU8EQBAACyATIBUgAEEDdmsiFWooAAAhG0EAIRwgAEEHcQshBSAmICdqIQAg\nIyAkaiEDIAsgDWohDSAQICVPDQEgBiAiciAWciAcckUNAAsLIA0gGUsgAyAOS3INAkFsIAAgF0sN\nABoCQAJAAkACQAJAIAlBIU8EQEEAIB9rQR9xIRYMAQsgF0EDayELQQAgH2tBH3EhFiAeRSEEA0AC\nfyARQQpOBEAgCUEDdiEIQQAhHCAJQQdxDAELIBFBBkYEQCAXQQJrIRxBBiERIAkhBgwFCyAJIBFB\nBmsgCUEDdiIJIBEgCWtBBkgiHBsiCEEDdGsLIQYgAiARIAhrIhFqKAAAIQggACALTyAccg0CIB5F\nBEAQAAsgACAKIAggBnQgFnZBAnRqIgkvAQA7AAAgACAJLQADaiEAIAYgCS0AAmohBiAeRQRAEAAL\nIAAgCiAIIAZ0IBZ2QQJ0aiIJLwEAOwAAIAAgCS0AA2ohACAGIAktAAJqIglBIUkNAAsLIBdBAmsh\nHCAeRSEEDAMLIBdBAmshHCAGQSBLDQELA0ACQCARQQpOBEAgBkEHcSEJIAZBA3YhCEEAIQYMAQsg\nEUEGRgRAQQYhEQwDCyAGIBFBBmsgBkEDdiIJIBEgCWtBBkgiBhsiCEEDdGshCQsgAiARIAhrIhFq\nKAAAIQggACAcSyAGcg0CIB5FBEAQAAsgACAKIAggCXQgFnZBAnRqIgYvAQA7AAAgACAGLQADaiEA\nIAkgBi0AAmoiBkEgTQ0ACwsgBiEJCyAAIBxNBEADQCAEBEAQAAsgACAKIAggCXQgFnZBAnRqIgIv\nAQA7AAAgCSACLQACaiEJIAAgAi0AA2oiACAcTQ0ACwsCQCAAIBdPDQAgBARAEAALIAAgCiAIIAl0\nIBZ2IgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAkgAi0AAmohCQwBCyAJQR9LDQAgCSAKIABBAnRq\nLQACaiIAQSAgAEEgSRshCQsCQAJAAkACQAJAIAdBIU8EQEEAIB9rQR9xIQAMAQsgDkEDayEXQQAg\nH2tBH3EhAANAAn8gEkEETgRAIAdBA3YhC0EAIQggB0EHcQwBCyASRQRAIA5BAmshC0EAIRIgHSEW\nIAchAgwFCyAHIBIgB0EDdiICIBIgHWogAmsgHUkiCBsiC0EDdGsLIQIgHSASIAtrIhJqIhYoAAAh\nDyADIBdPIAhyDQIgBARAEAALIAMgCiAPIAJ0IAB2QQJ0aiIHLwEAOwAAIAMgBy0AA2ohAyACIAct\nAAJqIQcgBARAEAALIAMgCiAPIAd0IAB2QQJ0aiICLwEAOwAAIAMgAi0AA2ohAyAHIAItAAJqIgdB\nIUkNAAsLIBIgHWohFiAOQQJrIQsMAwsgDkECayELIAJBIEsNAQsDQAJ/IBJBBE4EQCACQQN2IQhB\nACEGIAJBB3EMAQsgEkUNAiACIBIgAkEDdiICIBIgHWogAmsgHUkiBhsiCEEDdGsLIQcgHSASIAhr\nIhJqIhYoAAAhDyADIAtLIAZyDQIgBARAEAALIAMgCiAPIAd0IAB2QQJ0aiICLwEAOwAAIAMgAi0A\nA2ohAyAHIAItAAJqIgJBIE0NAAsLIAIhBwsgAyALTQRAA0AgBARAEAALIAMgCiAPIAd0IAB2QQJ0\naiICLwEAOwAAIAcgAi0AAmohByADIAItAANqIgMgC00NAAsLAkAgAyAOTw0AIAQEQBAACyADIAog\nDyAHdCAAdiIAQQJ0aiICLQAAOgAAIAItAANBAUYEQCAHIAItAAJqIQcMAQsgB0EfSw0AIAcgCiAA\nQQJ0ai0AAmoiAEEgIABBIEkbIQcLAkACQAJAAkACQCAMQSFPBEBBACAfa0EfcSEADAELIBlBA2sh\nDkEAIB9rQR9xIQADQAJ/IBRBBE4EQCAMQQN2IQtBACEIIAxBB3EMAQsgFEUEQCAZQQJrIQtBACEU\nIBghAyAMIQIMBQsgDCAUIAxBA3YiAiAUIBhqIAJrIBhJIggbIgtBA3RrCyECIBggFCALayIUaiID\nKAAAIRogDSAOTyAIcg0CIAQEQBAACyANIAogGiACdCAAdkECdGoiAy8BADsAACANIAMtAANqIQwg\nAiADLQACaiEDIAQEQBAACyAMIAogGiADdCAAdkECdGoiAi8BADsAACAMIAItAANqIQ0gAyACLQAC\naiIMQSFJDQALCyAUIBhqIQMgGUECayELDAMLIBlBAmshCyACQSBLDQELA0ACfyAUQQROBEAgAkED\ndiEIQQAhDyACQQdxDAELIBRFDQIgAiAUIAJBA3YiAiAUIBhqIAJrIBhJIg8bIghBA3RrCyEMIBgg\nFCAIayIUaiIDKAAAIRogCyANSSAPcg0CIAQEQBAACyANIAogGiAMdCAAdkECdGoiAi8BADsAACAN\nIAItAANqIQ0gDCACLQACaiICQSBNDQALCyACIQwLIAsgDU8EQANAIAQEQBAACyANIAogGiAMdCAA\ndkECdGoiAi8BADsAACAMIAItAAJqIQwgDSACLQADaiINIAtNDQALCwJAIA0gGU8NACAEBEAQAAsg\nDSAKIBogDHQgAHYiAEECdGoiAi0AADoAACACLQADQQFGBEAgDCACLQACaiEMDAELIAxBH0sNACAM\nIAogAEECdGotAAJqIgBBICAAQSBJGyEMC0EAIB9rQR9xIRkCQAJAAkACQCAFQSBNBEADQAJ/IBVB\nBE4EQCAFQQN2IQtBACENIAVBB3EMAQsgFUUEQCAhQQJrIQtBACEVIBMhCCAFIQIMBQsgBSAVIAVB\nA3YiACATIBVqIABrIBNJIg0bIgtBA3RrCyECIBMgFSALayIVaiIIKAAAIRsgECAlTyANcg0CIAQE\nQBAACyAQIAogGyACdCAZdkECdGoiAC8BADsAACAQIAAtAANqIQUgAiAALQACaiECIAQEQBAACyAF\nIAogGyACdCAZdkECdGoiAC8BADsAACAFIAAtAANqIRAgAiAALQACaiIFQSFJDQALCyATIBVqIQgg\nIUECayELDAMLICFBAmshCyACQSBLDQELA0ACfyAVQQROBEAgAkEDdiENQQAhDyACQQdxDAELIBVF\nDQIgAiAVIAJBA3YiACATIBVqIABrIBNJIg8bIg1BA3RrCyEFIBMgFSANayIVaiIIKAAAIRsgCyAQ\nSSAPcg0CIAQEQBAACyAQIAogGyAFdCAZdkECdGoiAC8BADsAACAQIAAtAANqIRAgBSAALQACaiIC\nQSBNDQALCyACIQULIAsgEE8EQANAIAQEQBAACyAQIAogGyAFdCAZdkECdGoiAC8BADsAACAFIAAt\nAAJqIQUgECAALQADaiIQIAtNDQALCwJAIBAgIU8NACAEBEAQAAsgECAKIBsgBXQgGXYiAEECdGoi\nAi0AADoAACACLQADQQFGBEAgBSACLQACaiEFDAELIAVBH0sNACAFIAogAEECdGotAAJqIgBBICAA\nQSBJGyEFCyABQWwgBUEgRhtBbCAIIBNGG0FsIAxBIEYbQWwgAyAYRhtBbCAHQSBGG0FsIBYgHUYb\nQWwgCUEgRhtBbCARQQZGGwsPC0G4fw8LQWwLOQAgACADIAQgBUGAEBAXIgVBiH9LBEAgBQ8LIAQg\nBUsEfyABIAIgAyAFaiAEIAVrIAAQGQVBuH8LC2gBAX8gAEEBa0GAgAhPBEAQAAtBDyECIAAgAUsE\nQCABQQR0IABuIQILIABBCHYiASACQRhsIgBBjAhqKAIAbCAAQYgIaigCAGoiAkEDdiACaiAAQYAI\naigCACAAQYQIaigCACABbGpJCyMAIAQtAAEEQCAAIAEgAiADIAQQGA8LIAAgASACIAMgBBAUCzYA\nIAAgAyAEIAUQESIFQYh/SwRAIAUPCyAEIAVLBH8gASACIAMgBWogBCAFayAAEBQFQbh/CwsjACAE\nLQABBEAgACABIAIgAyAEEBkPCyAAIAEgAiADIAQQFQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAE\nEBsEQCAAIAEgAiADIAQgBRAaDwsgACABIAIgAyAEIAUQFgvcAQEBfyAARQRAEAALIAFFBEAQAAsg\nACABKAKo1QE2ApjnASAAIAEoAgQiAjYCtOUBIAAgAjYCsOUBIAAgAiABKAIIaiICNgK45QEgACAC\nNgKs5QEgASgCrNUBBEAgAEKBgICAEDcDgOYBIABBrNABaiABQajQAWooAgA2AgAgAEGw0AFqIAFB\nrNABaigCADYCACAAIAFBpNAAajYCDCAAIAFBlCBqNgIIIAAgAUGcMGo2AgQgACABQQxqNgIAIABB\ntNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4DmAQtfAQN/AkAgAEUNACAAQbjVAWooAgAhAiAAQbTV\nAWooAgAhAQJAAkACQCAAKAIAIgMEQCABRQ0CIAIgAyABEQEADAELIAFFDQILIAIgACABEQEADAIL\nIAMQEAsgABAQCwvpAwEKfyMAQYABayIDJABBYiEKAkAgAkEJSQ0AIAEoAABBt8jC4X5HBEAQAAsg\nAEGY0ABqIAFBCGoiBCACQQhrIABBmNAAEBciBkGIf0sNACADQR82AnwgAyADQfwAaiADQfgAaiAE\nIAZqIAQgBkGJf0kbIgQgASACaiICIARrEDUiBkGIf0sNACADKAJ8IgVBH0sNACADKAJ4IgdBCU8N\nACAAQYggaiADIAVBgAtBgAwgByAAQajQAWoiBUH0BBA2IANBNDYCfCADIANB/ABqIANB+ABqIAQg\nBmoiByACIAdrEDUiC0GIf0sNACADKAJ8IghBNEsNACADKAJ4IglBCk8NACAAQZAwaiADIAhBgA1B\n4A4gCSAFQfQEEDYgA0EjNgJ8IAMgA0H8AGogA0H4AGogByALaiIHIAIgB2sQNSIIQYh/Sw0AIAMo\nAnwiCUEjSw0AIAMoAngiDEEKTw0AIAAgAyAJQcAQQdARIAwgBUH0BBA2IAcgCGpBDGoiBSACSw0A\nIAIgBWshBSAEIAYgC2ogCGpqIQRBnNABIQIDQCACIARqQZzQAWsoAAAiBkEBayAFTw0BIAAgAmog\nBjYCACACQQRqIgJBqNABRw0ACyACIARqIAFrQZzQAWshCgsgA0GAAWokACAKC/MBAQJ/AkAgACgC\nACIBRSAAKAIERXMNAAJ/IAEEQCAAKAIIQbDoCSABEQkADAELQbDoCRAOCyIBRQ0AIAFBADYClOcB\nIAFBADYCiOcBIAFBADYCxOcBIAFBADYCtOcBIAFCADcCnOcBIAFBADYCuOUBIAFBADYCrOgJIAFC\nADcC1OcBIAFCADcCrOcBIAFCADcCjOcBIAFBADYCpOcBIAFCADcC5OcBIAFBgYCAwAA2ArznASAB\nQQA2AuTmASABIAApAgA3AvTmASABQfzmAWogAEEIaigCADYCACABQQA2AqjnASABQQA2AujmASAB\nIQILIAIL5AEBBH8CfwJAIABFDQBBQCAAKAKI5wENARogAEH85gFqKAIAIQMgAEH45gFqKAIAIQEg\nACgCkOcBECEgAEEANgKg5wEgAEIANwOQ5wECQCAAKAKw5wEiAkUNACABBEAgAyACIAERAQAMAQsg\nAhAQCyAAQQA2ArDnASAAKAKk5wEiAgRAAkACQAJAAkAgAigCACIEBEAgAUUNAiADIAQgAREBAAwB\nCyABRQ0CCyADIAIgAREBAAwCCyAEEBALIAIQEAsgAEEANgKk5wELIAEEQCADIAAgAREBAAwBCyAA\nEBALQQALGgtpAQF/IAJBAk8EQBAAC0G4fyEDIAFBAUEFIAIbIgJPBH8gACACakEBay0AACIAQQNx\nQQJ0QdAdaigCACACaiAAQQZ2IgFBAnRB4B1qKAIAaiAAQSBxQQV2IgBBAXNqIAAgAUVxagUgAwsL\nigQCBH8CfiADQQJPBEAQAAsgAEEAQSgQDCEEIAJBAUEFIAMbIgBJBEAgAA8LIAFFBEBBfw8LAkAC\nQCADQQFGDQAgASgAACIGQajqvmlGDQBBdiEDIAZBcHFB0NS0wgFHDQFBCCEDIAJBCEkNASAEQRBq\nQgA3AwAgBEIANwMIIARBIGpCADcDACAEQRhqQgA3AwAgBEEBNgIUIAQgATUABDcDAEEADwsgASAC\nIAMQJSIDIAJLDQAgBCADNgIYQXIhAyAAIAFqIgVBAWstAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMg\nBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIghCA4h+IAh8IQkgAEEBaiEACyACQQZ2IQUg\nAkECdgJAAkACQAJAIAJBA3EiA0EBaw4DAAECAwsgACABai0AACEDIABBAWohAAwCCyAAIAFqLwAA\nIQMgAEECaiEADAELIAAgAWooAAAhAyAAQQRqIQALQQFxIQICfgJAAkACQAJAIAVBAWsOAwECAwAL\nQn8gBkUNAxogACABajEAAAwDCyAAIAFqMwAAQoACfAwCCyAAIAFqNQAADAELIAAgAWopAAALIQgg\nBCACNgIgIAQgAzYCHCAEIAg3AwBBACEDIARBADYCFCAEIAggCSAGGyIINwMIIAQgCEKAgAggCEKA\ngAhUGz4CEAsgAwvOBgIMfwF+IAUEQCAFKAIEIQ0gBSgCCCELCyAAQYjmAWohDiABIQkCQAJAAkAC\nQAJAA0AgACgC5OYBIgZBAk8EQBAAC0EBQQUgBhsgBE0EQCADKAAAQXBxQdDUtMIBRgRAIARBCEkE\nQEG4fw8LIAMoAAQiBkF3SwRAQXIPC0G4fyAGQQhqIgYgBCAGSRsiBkGIf0sNAyAEIAZJBEAQAAsg\nBCAGayEEIAMgBmohAwwCCwJAIAUEQCAAIAUQKAwBCyAAIA0gCxApIgZBiH9LDQMLAkAgAkUNACAA\nKAKs5QEiBiAJRg0AIAAgBjYCuOUBIAAgCTYCrOUBIAAoArDlASEHIAAgCTYCsOUBIAAgCSAHIAZr\najYCtOUBCyAEQQVBCSAAKALk5gEiBhtJDQUgA0EBQQUgBhsgBhAlIgdBiH9LBEAgByEGDAcLIAQg\nB0EDakkNBSAAIAMgBxAqIgZBiH9LDQYgAiAJaiAJIAIbIQwgBCAHayEEIAMgB2ohAyAJIQgDQCAE\nQQNJDQYgAy8AACIPIAMtAAJBEHRyQQN2IQogD0EBdkEDcSIQIQdBbCEGAkACQCAQQQFrDgMBAAkA\nCyAKIQcLIARBA2siBCAHSQ0GIANBA2ohAwJAAkACQAJAIBAOAwABAgsLIAcgDCAIa0sNCCAIRQRA\nQQAhBiAHRQ0DDAgLIAggAyAHEAsaIAchBgwCCyAKIAwgCGtLDQcgCEUEQEEAIQYgCg0HDAILIAgg\nAy0AACAKEAwaIAohBgwBCyAAIAggDCAIayADIAcQKyIGQYh/Sw0ICyAAKALs5gEEQCAOIAggBhAs\nCyAGIAhqIAggBhshCCAEIAdrIQQgAyAHaiEDIA9BAXFFDQALIAApA8DlASISQn9SBEBBbCEGIBIg\nCCAJa6xSDQcLIAAoAuDlAQRAQWohBiAEQQRJDQcgACgC6OYBRQRAIAMoAAAgDhAtp0cNCAsgBEEE\nayEEIANBBGohAwsgCCAJayIGQYl/Tw0GIAIgBkkEQBAACyAIIAkgBhshCSACIAZrIQJBASERDAEL\nC0G4fyEGIAQNACAJIAFrIQYLIAYPC0G2fyEGDAILQbp/IQYMAQtBuH8hBgtBuH8gBiAGQXZGGyAG\nIBEbCz0AIABFBEAQAAsCQCABRQRAIAAQNwwBCyAAIAAoArjlASABKAIEIAEoAghqRzYCnOcBIAAQ\nNyAAIAEQIAsLpAIBAn8gABA3An9BACABRSACRXINABoCQCACQQdNBEAgACAAKAKs5QEiAzYCuOUB\nIAAoArDlASEEIAAgATYCsOUBIAAgASACajYCrOUBIAAgASAEIANrajYCtOUBDAELIAEoAABBt8jC\n4X5HBEAgACAAKAKs5QEiAzYCuOUBIAAoArDlASEEIAAgATYCsOUBIAAgASACajYCrOUBIAAgASAE\nIANrajYCtOUBDAELIAAgASgABDYCmOcBQWIgAEEQaiABIAIQIiIEQYh/Sw0BGiAAQoGAgIAQNwOA\n5gEgACgCrOUBIQMgACABIAJqNgKs5QEgACADNgK45QEgACgCsOUBIQIgACABIARqIgE2ArDlASAA\nIAEgAiADa2o2ArTlAQtBAAsLqwIBAX8jAEEwayIDJAACfyAAQcDlAWogASACIAAoAuTmARAmIgFB\niH9LBEAgAQwBC0G4fyABDQAaAkAgACgCqOcBQQFHDQAgACgCpOcBRQ0AIAAQMAsgAEHc5QFqKAIA\nIgEEQEFgIAAoApjnASABRw0BGgsCQCAAQeDlAWooAgBFBEAgAEEANgLs5gEMAQsgACAAKALo5gEi\nAUU2AuzmASABDQAgA0EAQSgQDCEBIABBqOYBakL56tDQ58mh5OEANwMAIABBoOYBakIANwMAIABB\nmOYBakLP1tO+0ser2UI3AwAgAEGQ5gFqQtbrgu7q/Yn14AA3AwAgAEIANwOI5gEgAEGw5gFqIAFB\nMBALGgsgACAAKQPo5QEgAq18NwPo5QFBAAsgA0EwaiQAC7RSAh5/BX4jAEHgAWsiBSQAIABByOUB\naikDAEKAgIAQViEdQbh/IQgCQCAEQf//B0sNACAAIAMgBBAxIghBiH9LDQAgACgCnOcBIQkgACAF\nQTRqIAMgCGogAyAIQYl/SSIDGyIKIAQgCEEAIAMbayILEDIiA0GIf0sEQCADIQgMAQsgBSgCNCEU\nIAFFBEBBun8hCCAUQQBKDQELIAsgA2shBiADIApqIQMCQAJAAkACQCAJBEAgAEEANgKc5wEMAQsg\nFEEFSA0BIABByOUBaikDAEKAgIAIWARADAILIAAoAggiBCgCBCIJQQlPBEAQAAsgBEEKaiEEQQAh\nCEEBIQcDQCAIIAQtAABBFktqIQggByAJdiAEQQhqIQQgB0EBaiEHRQ0ACyAJQQlPBEAQAAsgAEEA\nNgKc5wEgCEEIIAlrdEEUSQ0CCyAFIAAoAvDmASIENgLMASABIAJqIQ4gBCAAKAKA5wFqIRcgASEJ\nIBQEQCAAKAK45QEhESAAKAK05QEhGCAAKAKw5QEhECAAQQE2AoTmASAAQazQAWohAiAFQeQAaiEJ\nQQAhBANAIAQgCWogAiAEaigCADYCACAEQQRqIgRBDEcNAAsgBSARNgJ0IAUgEDYCcCAFIAEgEGs2\nAnggAUUEQBAACwJAAkACQAJAIAZBf0wEQBAAIAUgAzYCRCAFIANBBGo2AkggBUE4aiECDAELIAZF\nBEAgBUHIAGpBADYCACAFQUBrQgA3AwAgBUIANwM4DAgLIAUgAzYCRCAFIANBBGo2AkggBUE4aiEC\nIAZBBEkNAQsgBSAKIAtqQQRrIgQ2AkAgBSAEKAAANgI4IAMgBmpBAWstAAAiAw0BIAVBADYCPAwG\nCyAFIAM2AkAgBSADLQAAIgQ2AjgCQAJAAkAgBkECaw4CAQACCyAFIAMtAAJBEHQgBHIiBDYCOAsg\nBSADLQABQQh0IARqNgI4CyADIAZqQQFrLQAAIgJFBEAgBUEANgI8DAYLIAUgAmdBYHIgBkEDdGtB\nKWo2AjwgBUE4aiECDAELIAUgA2dBYHJBCWo2AjxBbCEIIAZBiH9LDQULIBRBBCAUQQRIGyEVIAVB\nzABqIAIgACgCABAzIAVB1ABqIAIgACgCCBAzIAVB3ABqIAIgACgCBBAzQQAhCgJAIAIoAgQiBEEg\nTQRAIBVBACAVQQBKGyETIAVB2ABqKAIAIRsgBUHgAGooAgAhHCAFQdAAaigCACEZIAVBgAFqIQcg\nBSgCRCENIAUoAkghDyAFQfAAaiEfIAVB9ABqISADQAJAIAICfyACKAIIIgMgAigCEE8EQCACIAMg\nBEEDdmsiCDYCCCAEQQdxDAELIAMgAigCDCIJRg0BIAIgAyADIAlrIARBA3YiBiADIAZrIAlJGyID\nayIINgIIIAQgA0EDdGsLIgQ2AgQgAiAIKAAANgIACyAKIBNGBEAgEyEKDAMLIBkgBSgCTEEDdGop\nAgAiI0IQiKciGkH/AXEhCyAcIAUoAlxBA3RqKQIAIiRCEIinIh5B/wFxIRIgGyAFKAJUQQN0aikC\nACIlQiCIpyEWICRCIIggI0IgiKchAwJAAkACQAJAICVCEIinIghB/wFxIgRBAk8EQCAEQSBPBEAQ\nAAsgHUUgBEEZSXJFBEAgBCAEQSAgBSgCPCIMayIJIAQgCUkbIghrIQkCQCAIBEAgBSgCOCEGDAEL\nEAAgBSgCOCEGEAALIAUgCCAMaiIENgI8IAYgDHRBACAIa3YgCXQhISAEQSBLDQIgBQJ/IA8gBSgC\nQCIITQRAIAUgBEEHcSIMNgI8IAUgCCAEQQN2ayIENgJAIAQoAAAMAQsgCCANRg0DIAUgBCAIIA1r\nIARBA3YiBCAIIARrIA1JGyIEQQN0ayIMNgI8IAUgCCAEayIENgJAIAQoAAALIgY2AjgMAwsCQCAE\nBEAgBSgCPCEMIAUoAjghBgwBCxAAIAUoAjwhDCAFKAI4IQYQAAsgBSAEIAxqIgk2AjwgBiAMdEEA\nIAhrdiAWaiEEIAlBIEsNAyAPIAUoAkAiBk0EQCAFIAlBB3E2AjwgBSAGIAlBA3ZrIgk2AkAgBSAJ\nKAAANgI4DAQLIAYgDUYNAyAFIAkgBiANayAJQQN2IgkgBiAJayANSRsiCUEDdGs2AjwgBSAGIAlr\nIgk2AkAgBSAJKAAANgI4DAMLAkAgBEUEQCADBEAgBSgCZCEEDAYLIAUoAmghBAwBCyAFIAUoAjwi\nBEEBajYCPAJAAkAgFiADRWogBSgCOCAEdEEfdmoiCUEDRgRAIAUoAmRBAWsiBCAERWohBAwBCyAJ\nQQJ0IAVqQeQAaigCACIEIARFaiEEIAlBAUYNAQsgBSAFKAJoNgJsCwsgBSAFKAJkNgJoIAUgBDYC\nZAwDCyAEIQwLIBYgIWohBCAJRQ0AIAUgCSAMajYCPCAGIAx0QQAgCWt2IARqIQQgCUEGSQ0AEAAL\nIAUpAmQhJyAFIAQ2AmQgBSAnNwNoC6chCSASBEAgBSAFKAI8IgYgEmo2AjwgBSgCOCAGdEEAIB5r\ndiAJaiEJCwJAIAsgEmpBFEkNACAFKAI8IghBIEsNACAPIAUoAkAiBk0EQCAFIAhBB3E2AjwgBSAG\nIAhBA3ZrIgY2AkAgBSAGKAAANgI4DAELIAYgDUYNACAFIAggBiANayAIQQN2IgggBiAIayANSRsi\nCEEDdGs2AjwgBSAGIAhrIgY2AkAgBSAGKAAANgI4CyAjQhiIAkAgC0UEQCAFKAI8IQgMAQsgBSAF\nKAI8IgYgC2oiCDYCPCAFKAI4IAZ0QQAgGmt2IANqIQMLpyEMAkACQCAIQSBLDQAgDyAFKAJAIgtN\nBEAgBSAIQQdxIgY2AjwgBSALIAhBA3ZrIgg2AkAgBSAIKAAANgI4DAILIAsgDUYNACAFIAggCyAN\nayAIQQN2IgYgCyAGayANSRsiCEEDdGsiBjYCPCAFIAsgCGsiCDYCQCAFIAgoAAA2AjgMAQsgCCEG\nCyAFIAUoAnggA2oiEiAJajYCeCAgIB8gBCASSxsoAgAhHiAFKAI4IQggDEH/AXEiC0EgTwRAEAAL\nIAUgBiALaiIWNgI8IAUgC0ECdEHwHWooAgAgCEEAIAYgDGprdnEgI6dB//8DcWo2AkwgJEIYiKci\nDEH/AXEiBkEgTwRAEAALICVCGIinIRogBSAGIBZqIgs2AjwgBSAGQQJ0QfAdaigCACAIQQAgDCAW\namt2cSAkp0H//wNxajYCXAJAAkAgC0EgSw0AIAUCfyAPIAUoAkAiDE0EQCAFIAtBB3EiBjYCPCAF\nIAwgC0EDdmsiCDYCQCAIKAAADAELIAwgDUYNASAFIAsgDCANayALQQN2IgYgDCAGayANSRsiCEED\ndGsiBjYCPCAFIAwgCGsiCDYCQCAIKAAACyIINgI4DAELIAshBgsgGkH/AXEiC0EgTwRAEAALIAUg\nBiALajYCPCAFIAtBAnRB8B1qKAIAIAhBACAGIBpqa3ZxICWnQf//A3FqNgJUIAdBDGogEiAeaiAE\nazYCACAHQQhqIAQ2AgAgB0EEaiAJNgIAIAcgAzYCACAHQRBqIQcgCkEBaiEKIAIoAgQiBEEgTQ0A\nCwtBbCEIIAogFUgNBQsgDkEgayEWIAVB8ABqISAgBUH0AGohHiAFQdgBaiEaIAEhCQNAAkAgBEEh\nTwRAQWwhCCAKIBRIDQcMAQsCQCACAn8gAigCCCIDIAIoAhBPBEAgAiADIARBA3ZrIgc2AgggBEEH\ncQwBCyADIAIoAgwiBkYNASACIAMgAyAGayAEQQN2IgggAyAIayAGSRsiA2siBzYCCCAEIANBA3Rr\nCzYCBCACIAcoAAA2AgALIAogFE4NACAFKAJQIAUoAkxBA3RqKQIAIiNCEIinIg9B/wFxIQcgBSgC\nYCAFKAJcQQN0aikCACIkQhCIpyISQf8BcSENIAUoAlggBSgCVEEDdGopAgAiJUIgiKchCyAkQiCI\nICNCIIinIRMCQAJAAkACQCAlQhCIpyIEQf8BcSIDQQJPBEAgA0EgTwRAEAALIB1FIANBGUlyRQRA\nIAMgA0EgIAUoAjwiCGsiBCADIARJGyIGayEEAkAgBgRAIAUoAjghDAwBCxAAIAUoAjghDBAACyAF\nIAYgCGoiAzYCPCAMIAh0QQAgBmt2IAR0IRsgA0EgSw0CIAUCfyAFKAJAIgggBSgCSE8EQCAFIANB\nB3EiBjYCPCAFIAggA0EDdmsiAzYCQCADKAAADAELIAggBSgCRCIGRg0DIAUgAyAIIAZrIANBA3Yi\nAyAIIANrIAZJGyIDQQN0ayIGNgI8IAUgCCADayIDNgJAIAMoAAALIgw2AjgMAwsCQCADBEAgBSgC\nPCEMIAUoAjghBgwBCxAAIAUoAjwhDCAFKAI4IQYQAAsgBSADIAxqIgM2AjwgBiAMdEEAIARrdiAL\naiELIANBIEsNAyAFKAJAIgQgBSgCSE8EQCAFIANBB3E2AjwgBSAEIANBA3ZrIgM2AkAgBSADKAAA\nNgI4DAQLIAQgBSgCRCIGRg0DIAUgAyAEIAZrIANBA3YiAyAEIANrIAZJGyIDQQN0azYCPCAFIAQg\nA2siAzYCQCAFIAMoAAA2AjgMAwsCQCADRQRAIBMEQCAFKAJkIQsMBgsgBSgCaCELDAELIAUgBSgC\nPCIDQQFqNgI8AkACQCALIBNFaiAFKAI4IAN0QR92aiIDQQNGBEAgBSgCZEEBayIDIANFaiELDAEL\nIANBAnQgBWpB5ABqKAIAIgQgBEVqIQsgA0EBRg0BCyAFIAUoAmg2AmwLCyAFIAUoAmQ2AmggBSAL\nNgJkDAMLIAMhBgsgCyAbaiELIARFDQAgBSAEIAZqNgI8IAwgBnRBACAEa3YgC2ohCyAEQQZJDQAQ\nAAsgBSkCZCEnIAUgCzYCZCAFICc3A2gLpyEMIA0EQCAFIAUoAjwiAyANajYCPCAFKAI4IAN0QQAg\nEmt2IAxqIQwLAkAgByANakEUSQ0AIAUoAjwiBEEgSw0AIAUoAkAiAyAFKAJITwRAIAUgBEEHcTYC\nPCAFIAMgBEEDdmsiAzYCQCAFIAMoAAA2AjgMAQsgAyAFKAJEIgZGDQAgBSAEIAMgBmsgBEEDdiIE\nIAMgBGsgBkkbIgRBA3RrNgI8IAUgAyAEayIDNgJAIAUgAygAADYCOAsgI0IYiAJAIAdFBEAgBSgC\nPCEEDAELIAUgBSgCPCIDIAdqIgQ2AjwgBSgCOCADdEEAIA9rdiATaiETC6chCAJAAkAgBEEgSw0A\nIAUoAkAiAyAFKAJITwRAIAUgBEEHcSIGNgI8IAUgAyAEQQN2ayIDNgJAIAUgAygAADYCOAwCCyAD\nIAUoAkQiBkYNACAFIAQgAyAGayAEQQN2IgQgAyAEayAGSRsiBEEDdGsiBjYCPCAFIAMgBGsiAzYC\nQCAFIAMoAAA2AjgMAQsgBCEGCyAFIAUoAnggE2oiGyAMajYCeCAeICAgCyAbSxsoAgAhISAFKAI4\nIQQgCEH/AXEiA0EgTwRAEAALIAUgAyAGaiIHNgI8IAUgA0ECdEHwHWooAgAgBEEAIAYgCGprdnEg\nI6dB//8DcWo2AkwgJEIYiKciCEH/AXEiBkEgTwRAEAALICVCGIinIQ0gBSAGIAdqIgM2AjwgBSAG\nQQJ0QfAdaigCACAEQQAgByAIamt2cSAkp0H//wNxajYCXAJAAkAgA0EgSw0AIAUCfyAFKAJAIgYg\nBSgCSE8EQCAFIANBB3EiCDYCPCAFIAYgA0EDdmsiAzYCQCADKAAADAELIAYgBSgCRCIIRg0BIAUg\nAyAGIAhrIANBA3YiAyAGIANrIAhJGyIDQQN0ayIINgI8IAUgBiADayIDNgJAIAMoAAALIgQ2AjgM\nAQsgAyEICyANQf8BcSIDQSBPBEAQAAsgBSADIAhqNgI8IAUgA0ECdEHwHWooAgAgBEEAIAggDWpr\ndnEgJadB//8DcWo2AlQgGiAFQYABaiAKQQNxQQR0aiIPKQMIIiM3AwAgBSAPKQMAIiQ3A9ABIAUo\nAswBIgcgJKciBmohHCAFKALUASEDIAlFBEAQAAsCQAJAAkAgFyAcSQ0AIAkgAyAGaiIIaiISIBZL\nDQAgCEEgaiAOIAlrTQ0BCyAFQShqIBopAwA3AwAgBSAFKQPQATcDICAJIA4gBUEgaiAFQcwBaiAX\nIBAgGCAREDQhCAwBCyAGQX9MBEAQAAsgBiAITgRAEAALIAYgCWohBCAOIBJJBEAQAAsgBCAWSwRA\nEAALICOnIQ0gCSAHKQAANwAAIAlBCGogB0EIaikAADcAAAJAIAZBEUkNACAGQRBrAkACQCAJQRBq\nIgYgB0EQaiIZayIfQQdMBEAgH0FxSA0CEAAMAQsgH0EPSw0BCxAACyAGIBkpAAA3AAAgBkEIaiAZ\nQQhqKQAANwAAQRFIDQAgB0EwaiEGIAlBIGohBwNAIAcgBkEQayIZKQAANwAAIAdBCGogGUEIaikA\nADcAACAHQRBqIAYpAAA3AAAgB0EYaiAGQQhqKQAANwAAIAZBIGohBiAHQSBqIgcgBEkNAAsLIAQg\nDWshByAFIBw2AswBIAQgEGsgDUkEQCANIAQgGGtLDQcgESARIAcgEGsiBmoiByADak8EQCAEIAcg\nAxALGgwCCyAEIAdBACAGaxALIAUgAyAGaiIDNgLUASAQIQcgBmshBAsgBCASSwRAEAALIAcgEEkE\nQBAACyADRQRAEAALIA1BEE8EQAJAAkAgBCAHayIGQQdMBEAgBkFxSA0CEAAMAQsgBkEPSw0BCxAA\nCyAEIAcpAAA3AAAgBEEIaiAHQQhqKQAANwAAIANBEUgNASADIARqIQMgB0EgaiEHIARBEGohBANA\nIAQgB0EQayIGKQAANwAAIARBCGogBkEIaikAADcAACAEQRBqIAcpAAA3AAAgBEEYaiAHQQhqKQAA\nNwAAIAdBIGohByAEQSBqIgQgA0kNAAsMAQsgBCAHSQRAEAALAkAgDUEHTQRAIAQgBy0AADoAACAE\nIActAAE6AAEgBCAHLQACOgACIAQgBy0AAzoAAyAEIAcgDUECdCIDQfAeaigCAGoiBigAADYABCAG\nIANBkB9qKAIAayEHDAELIAQgBykAADcAAAsgBEEIaiIDIAdBCGoiBmsiHEEHSiIZRQRAEAALIAUo\nAtQBIg1BCUkNACADIBJPBEAQAAsgBCANaiESAkACQCAZRQRAEAAMAQsgHEEPSg0BCwNAIAMgBikA\nADcAACAGQQhqIQYgA0EIaiIDIBJJDQALDAELIAMgBikAADcAACADQQhqIAZBCGopAAA3AAAgDUEZ\nSA0AIAdBKGohByAEQRhqIQQDQCAEIAdBEGsiAykAADcAACAEQQhqIANBCGopAAA3AAAgBEEQaiAH\nKQAANwAAIARBGGogB0EIaikAADcAACAHQSBqIQcgBEEgaiIEIBJJDQALCyAIQYh/Sw0GIA8gEzYC\nACAPIBsgIWogC2s2AgwgDyALNgIIIA8gDDYCBCAKQQFqIQogCCAJaiEJIAIoAgQhBAwBCwsgFCAK\nIBVrIgtKBEAgDkEgayETIAVB2AFqIQ0DQCANIAVBgAFqIAtBA3FBBHRqIgIpAwgiIzcDACAFIAIp\nAwAiJDcD0AEgBSgCzAEiCiAkpyICaiEPIAUoAtQBIQMgCUUEQBAACwJAAkACQCAPIBdLDQAgCSAC\nIANqIghqIgwgE0sNACAIQSBqIA4gCWtNDQELIAVBGGogDSkDADcDACAFIAUpA9ABNwMQIAkgDiAF\nQRBqIAVBzAFqIBcgECAYIBEQNCEIDAELIAJBf0wEQBAACyACIAhOBEAQAAsgAiAJaiEEIAwgDksE\nQBAACyAEIBNLBEAQAAsgI6chBiAJIAopAAA3AAAgCUEIaiAKQQhqKQAANwAAAkAgAkERSQ0AIAJB\nEGsCQAJAIAlBEGoiAiAKQRBqIgdrIhVBB0wEQCAVQXFIDQIQAAwBCyAVQQ9LDQELEAALIAIgBykA\nADcAACACQQhqIAdBCGopAAA3AABBEUgNACAKQTBqIQogCUEgaiEHA0AgByAKQRBrIgIpAAA3AAAg\nB0EIaiACQQhqKQAANwAAIAdBEGogCikAADcAACAHQRhqIApBCGopAAA3AAAgCkEgaiEKIAdBIGoi\nByAESQ0ACwsgBCAGayEHIAUgDzYCzAEgBCAQayAGSQRAIAYgBCAYa0sNByARIBEgByAQayICaiIK\nIANqTwRAIAQgCiADEAsaDAILIAQgCkEAIAJrEAsgBSACIANqIgM2AtQBIBAhByACayEECyAEIAxL\nBEAQAAsgByAQSQRAEAALIANFBEAQAAsgBkEQTwRAAkACQCAEIAdrIgJBB0wEQCACQXFIDQIQAAwB\nCyACQQ9LDQELEAALIAQgBykAADcAACAEQQhqIAdBCGopAAA3AAAgA0ERSA0BIAMgBGohAiAHQSBq\nIQcgBEEQaiEEA0AgBCAHQRBrIgMpAAA3AAAgBEEIaiADQQhqKQAANwAAIARBEGogBykAADcAACAE\nQRhqIAdBCGopAAA3AAAgB0EgaiEHIARBIGoiBCACSQ0ACwwBCyAEIAdJBEAQAAsCQCAGQQdNBEAg\nBCAHLQAAOgAAIAQgBy0AAToAASAEIActAAI6AAIgBCAHLQADOgADIAQgByAGQQJ0IgJB8B5qKAIA\naiIDKAAANgAEIAMgAkGQH2ooAgBrIQcMAQsgBCAHKQAANwAACyAEQQhqIgMgB0EIaiICayIPQQdK\nIhVFBEAQAAsgBSgC1AEiBkEJSQ0AIAMgDE8EQBAACyAEIAZqIQoCQAJAIBVFBEAQAAwBCyAPQQ9K\nDQELA0AgAyACKQAANwAAIAJBCGohAiADQQhqIgMgCkkNAAsMAQsgAyACKQAANwAAIANBCGogAkEI\naikAADcAACAGQRlIDQAgB0EoaiEHIARBGGohBANAIAQgB0EQayICKQAANwAAIARBCGogAkEIaikA\nADcAACAEQRBqIAcpAAA3AAAgBEEYaiAHQQhqKQAANwAAIAdBIGohByAEQSBqIgQgCkkNAAsLIAhB\niH9LDQYgCCAJaiEJIAtBAWoiCyAURw0ACwsgAEGs0AFqIQAgBUHkAGohAkEAIQQDQCAAIARqIAIg\nBGooAgA2AgAgBEEEaiIEQQxHDQALIAUoAswBIQQLQbp/IQggFyAEayIAIA4gCWtLDQMgCQR/IAkg\nBCAAEAsgAGoFQQALIAFrIQgMAwsgAEEANgKc5wELIAUgACgC8OYBIgQ2AtABIAEgAmohDCAEIAAo\nAoDnAWohEwJAIBRFBEAgASEJDAELIAAoArjlASENIAAoArTlASEXIAAoArDlASEQIABBATYChOYB\nIABBrNABaiECIAVB5ABqIQlBACEEA0AgBCAJaiACIARqKAIANgIAIARBBGoiBEEMRw0ACyAGRQRA\nIAVByABqQQA2AgAgBUFAa0IANwMAIAVCADcDOAwCCyAFIAM2AkQgBSADQQRqNgJIAkACQCAGQQRP\nBEAgBSAKIAtqQQRrIgI2AkAgBSACKAAANgI4IAMgBmpBAWstAAAiAg0BIAVBADYCPAwECyAFIAM2\nAkAgBSADLQAAIgQ2AjgCQAJAAkAgBkECaw4CAQACCyAFIAMtAAJBEHQgBHIiBDYCOAsgBSADLQAB\nQQh0IARqNgI4CyADIAZqQQFrLQAAIgJFBEAgBUEANgI8DAQLIAUgAmdBYHIgBkEDdGtBKWo2AjwM\nAQsgBSACZ0FgckEJajYCPEFsIQggBkGIf0sNAwsgBUHMAGogBUE4aiAAKAIAEDMgBUHUAGogBUE4\naiAAKAIIEDMgBUHcAGogBUE4aiAAKAIEEDMgAUUEQBAACyAMQSBrIQ8gASEJQQAhCANAIAUoAlAg\nBSgCTEEDdGopAgAiI0IQiKciGEH/AXEhDiAFKAJgIAUoAlxBA3RqKQIAIiRCEIinIhVB/wFxIREg\nBSgCWCAFKAJUQQN0aikCACIlQiCIpyEHICRCIIggI0IgiKchBAJAAkACQAJAICVCEIinIgpB/wFx\nIgJBAk8EQCACQSBPBEAQAAsgHUUgAkEZSXJFBEAgAiACQSAgBSgCPCIKayIDIAIgA0kbIgZrIQMC\nQCAGBEAgBSgCOCELDAELEAAgBSgCOCELEAALIAUgBiAKaiICNgI8IAsgCnRBACAGa3YgA3QhEiAC\nQSBLDQIgBQJ/IAUoAkAiBiAFKAJITwRAIAUgAkEHcSIKNgI8IAUgBiACQQN2ayICNgJAIAIoAAAM\nAQsgBiAFKAJEIgpGDQMgBSACIAYgCmsgAkEDdiICIAYgAmsgCkkbIgJBA3RrIgo2AjwgBSAGIAJr\nIgI2AkAgAigAAAsiCzYCOAwDCwJAIAIEQCAFKAI8IQsgBSgCOCEGDAELEAAgBSgCPCELIAUoAjgh\nBhAACyAFIAIgC2oiAzYCPCAGIAt0QQAgCmt2IAdqIQIgA0EgSw0DIAUoAkAiBiAFKAJITwRAIAUg\nA0EHcTYCPCAFIAYgA0EDdmsiAzYCQCAFIAMoAAA2AjgMBAsgBiAFKAJEIgpGDQMgBSADIAYgCmsg\nA0EDdiIDIAYgA2sgCkkbIgNBA3RrNgI8IAUgBiADayIDNgJAIAUgAygAADYCOAwDCwJAIAJFBEAg\nBARAIAUoAmQhAgwGCyAFKAJoIQIMAQsgBSAFKAI8IgJBAWo2AjwCQAJAIAcgBEVqIAUoAjggAnRB\nH3ZqIgNBA0YEQCAFKAJkQQFrIgIgAkVqIQIMAQsgA0ECdCAFakHkAGooAgAiAiACRWohAiADQQFG\nDQELIAUgBSgCaDYCbAsLIAUgBSgCZDYCaCAFIAI2AmQMAwsgAiEKCyAHIBJqIQIgA0UNACAFIAMg\nCmo2AjwgCyAKdEEAIANrdiACaiECIANBBkkNABAACyAFKQJkIScgBSACNgJkIAUgJzcDaAunIQcg\nEQRAIAUgBSgCPCIDIBFqNgI8IAUoAjggA3RBACAVa3YgB2ohBwsCQCAOIBFqQRRJDQAgBSgCPCIG\nQSBLDQAgBSgCQCIDIAUoAkhPBEAgBSAGQQdxNgI8IAUgAyAGQQN2ayIDNgJAIAUgAygAADYCOAwB\nCyADIAUoAkQiCkYNACAFIAYgAyAKayAGQQN2IgYgAyAGayAKSRsiBkEDdGs2AjwgBSADIAZrIgM2\nAkAgBSADKAAANgI4CyAjQhiIAkAgDkUEQCAFKAI8IQMMAQsgBSAFKAI8IgYgDmoiAzYCPCAFKAI4\nIAZ0QQAgGGt2IARqIQQLpyEKAkACQCADQSBLDQAgBSgCQCIGIAUoAkhPBEAgBSADQQdxIgs2Ajwg\nBSAGIANBA3ZrIgM2AkAgBSADKAAANgI4DAILIAYgBSgCRCILRg0AIAUgAyAGIAtrIANBA3YiAyAG\nIANrIAtJGyIDQQN0ayILNgI8IAUgBiADayIDNgJAIAUgAygAADYCOAwBCyADIQsLIAUoAjghAyAK\nQf8BcSIGQSBPBEAQAAsgBSAGIAtqIg42AjwgBSAGQQJ0QfAdaigCACADQQAgCiALamt2cSAjp0H/\n/wNxajYCTCAkQhiIpyILQf8BcSIKQSBPBEAQAAsgJUIYiKchESAFIAogDmoiBjYCPCAFIApBAnRB\n8B1qKAIAIANBACALIA5qa3ZxICSnQf//A3FqNgJcAkACQCAGQSBLDQAgBQJ/IAUoAkAiCyAFKAJI\nTwRAIAUgBkEHcSIKNgI8IAUgCyAGQQN2ayIDNgJAIAMoAAAMAQsgCyAFKAJEIgpGDQEgBSAGIAsg\nCmsgBkEDdiIDIAsgA2sgCkkbIgNBA3RrIgo2AjwgBSALIANrIgM2AkAgAygAAAsiAzYCOAwBCyAG\nIQoLIBFB/wFxIgZBIE8EQBAACyAFIAYgCmo2AjwgBSAGQQJ0QfAdaigCACADQQAgCiARamt2cSAl\np0H//wNxajYCVCAFIAQ2AoABIAUoAtABIQogBSACNgKIASAFIAc2AoQBIAkgBCAHaiIGaiELIAlF\nBEAQAAsCQAJAAkAgCyAPSw0AIAQgCmoiGCATSw0AIAZBIGogDCAJa00NAQsgBUEIaiAFQYgBaikD\nADcDACAFIAUpA4ABNwMAIAkgDCAFIAVB0AFqIBMgECAXIA0QNCEGDAELIARBf0wEQBAACyAEIAZO\nBEAQAAsgBCAJaiEDIAsgDEsEQBAACyADIA9LBEAQAAsgCSAKKQAANwAAIAlBCGogCkEIaikAADcA\nAAJAIARBEUkNACAEQRBrAkACQCAJQRBqIgQgCkEQaiIOayIRQQdMBEAgEUFxSA0CEAAMAQsgEUEP\nSw0BCxAACyAEIA4pAAA3AAAgBEEIaiAOQQhqKQAANwAAQRFIDQAgCkEwaiEKIAlBIGohBANAIAQg\nCkEQayIOKQAANwAAIARBCGogDkEIaikAADcAACAEQRBqIAopAAA3AAAgBEEYaiAKQQhqKQAANwAA\nIApBIGohCiAEQSBqIgQgA0kNAAsLIAMgAmshBCAFIBg2AtABIAMgEGsgAkkEQCADIBdrIAJJBEBB\nbCEGDAILIA0gDSAEIBBrIgpqIgQgB2pPBEAgAyAEIAcQCxoMAgsgAyAEQQAgCmsQCyAFIAcgCmoi\nBzYChAEgECEEIAprIQMLIAMgC0sEQBAACyAEIBBJBEAQAAsgB0UEQBAACyACQRBPBEACQAJAIAMg\nBGsiAkEHTARAIAJBcUgNAhAADAELIAJBD0sNAQsQAAsgAyAEKQAANwAAIANBCGogBEEIaikAADcA\nACAHQRFIDQEgAyAHaiECIARBIGohByADQRBqIQQDQCAEIAdBEGsiAykAADcAACAEQQhqIANBCGop\nAAA3AAAgBEEQaiAHKQAANwAAIARBGGogB0EIaikAADcAACAHQSBqIQcgBEEgaiIEIAJJDQALDAEL\nIAMgBEkEQBAACwJAIAJBB00EQCADIAQtAAA6AAAgAyAELQABOgABIAMgBC0AAjoAAiADIAQtAAM6\nAAMgAyAEIAJBAnQiAkHwHmooAgBqIgQoAAA2AAQgBCACQZAfaigCAGshBAwBCyADIAQpAAA3AAAL\nIANBCGoiByAEQQhqIgJrIg5BB0oiEUUEQBAACyAFKAKEASIKQQlJDQAgByALTwRAEAALIAMgCmoh\nCwJAAkAgEUUEQBAADAELIA5BD0oNAQsDQCAHIAIpAAA3AAAgAkEIaiECIAdBCGoiByALSQ0ACwwB\nCyAHIAIpAAA3AAAgB0EIaiACQQhqKQAANwAAIApBGUgNACAEQShqIQcgA0EYaiEEA0AgBCAHQRBr\nIgIpAAA3AAAgBEEIaiACQQhqKQAANwAAIARBEGogBykAADcAACAEQRhqIAdBCGopAAA3AAAgB0Eg\naiEHIARBIGoiBCALSQ0ACwsCQAJAIAUoAjwiAkEgSw0AIAUoAkAiBCAFKAJITwRAIAUgAkEHcSID\nNgI8IAUgBCACQQN2ayICNgJAIAUgAigAADYCOAwCCyAEIAUoAkQiA0YNACAFIAIgBCADayACQQN2\nIgIgBCACayADSRsiAkEDdGsiAzYCPCAFIAQgAmsiAjYCQCAFIAIoAAA2AjgMAQsgAiEDCyAUQQFr\nIgQgFCAGQYl/SSICGyEUIAggBiACGyEIIAYgCWohCSAEQQAgAhsNAAsgCEGIf0sNAkFsIQggFA0C\nAkAgA0EhTw0AIAUoAkAiAiAFKAJITwRAIAUgA0EHcTYCPCAFIAIgA0EDdmsiADYCQCAFIAAoAAA2\nAjgMBAsgBSgCRCIEIAJGBEAgA0EgTw0BDAQLIAUgAyACIARrIANBA3YiACACIABrIARJGyIAQQN0\nazYCPCAFIAIgAGsiADYCQCAFIAAoAAA2AjgMAwsgAEGs0AFqIQAgBUHkAGohAkEAIQQDQCAAIARq\nIAIgBGooAgA2AgAgBEEEaiIEQQxHDQALIAUoAtABIQQLQbp/IQggEyAEayIAIAwgCWtLDQEgCQR/\nIAkgBCAAEAsgAGoFQQALIAFrIQgMAQtBbCEICyAFQeABaiQAIAgLxAQCAn8EfiAAIAApAwAgAq18\nNwMAAkACQCAAKAJIIgMgAmoiBEEfTQRAIAFFDQEgACADakEoaiABIAIQCxogACgCSCACaiEEDAEL\nIAEgAmohAiADBEAgAEEoaiADaiABQSAgA2sQCxogACgCSCEDIABBADYCSCAAIAApAwggACkAKELP\n1tO+0ser2UJ+fEIfiUKHla+vmLbem55/fjcDCCAAIAApAxAgAEEwaikAAELP1tO+0ser2UJ+fEIf\niUKHla+vmLbem55/fjcDECAAIAApAxggAEE4aikAAELP1tO+0ser2UJ+fEIfiUKHla+vmLbem55/\nfjcDGCAAIAApAyAgAEFAaykAAELP1tO+0ser2UJ+fEIfiUKHla+vmLbem55/fjcDICABIANrQSBq\nIQELIAIgAUEgak8EQCACQSBrIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgASkAAELP\n1tO+0ser2UJ+IAh8Qh+JQoeVr6+Ytt6bnn9+IQggAUEYaikAAELP1tO+0ser2UJ+IAV8Qh+JQoeV\nr6+Ytt6bnn9+IQUgAUEQaikAAELP1tO+0ser2UJ+IAZ8Qh+JQoeVr6+Ytt6bnn9+IQYgAUEIaikA\nAELP1tO+0ser2UJ+IAd8Qh+JQoeVr6+Ytt6bnn9+IQcgAUEgaiIBIANNDQALIAAgBTcDICAAIAY3\nAxggACAHNwMQIAAgCDcDCAsgASACTw0BIABBKGogASACIAFrIgQQCxoLIAAgBDYCSAsLrQUCBX8F\nfiAAQShqIgIgACgCSCIEaiEDAn4gACkDACIGQiBaBEAgACkDECIHQgeJIAApAwgiCEIBiXwgACkD\nGCIJQgyJfCAAKQMgIgpCEol8IAhCgICAgPi0nfWTf34gCELP1tO+0ser2UJ+QiGIhEKHla+vmLbe\nm55/foVCh5Wvr5i23puef35CnaO16oOxjYr6AH0gB0KAgICA+LSd9ZN/fiAHQs/W077Sx6vZQn5C\nIYiEQoeVr6+Ytt6bnn9+hUKHla+vmLbem55/fkKdo7Xqg7GNivoAfSAJQoCAgID4tJ31k39+IAlC\nz9bTvtLHq9lCfkIhiIRCh5Wvr5i23puef36FQoeVr6+Ytt6bnn9+Qp2jteqDsY2K+gB9IApCgICA\ngPi0nfWTf34gCkLP1tO+0ser2UJ+QiGIhEKHla+vmLbem55/foVCh5Wvr5i23puef35CnaO16oOx\njYr6AH0MAQsgACkDGELFz9my8eW66id8CyAGfCEGIABBMGogA00EQCAAQShqIQEDQCAGIAEpAAAi\nBkLP1tO+0ser2UJ+QiGIIAZCgICAgPi0nfWTf36EQoeVr6+Ytt6bnn9+hUIbiUKHla+vmLbem55/\nfkKdo7Xqg7GNivoAfSEGIAFBEGohBSABQQhqIgIhASADIAVPDQALCwJAIAMgAkEEaiIBSQRAIAIh\nAQwBCyACNQAAQoeVr6+Ytt6bnn9+IAaFQheJQs/W077Sx6vZQn5C+fPd8Zn2masWfCEGCyABIANJ\nBEAgACAEakEoaiEAA0AgATEAAELFz9my8eW66id+IAaFQguJQoeVr6+Ytt6bnn9+IQYgACABQQFq\nIgFHDQALCyAGQiGIIAaFQs/W077Sx6vZQn4iBkIdiCAGhUL5893xmfaZqxZ+IgZCIIggBoULTgAC\nQAJAAkACQCAAKAKg5wFBAWoOAwMBAgALEAALIAAoApDnARAhIABBADYCoOcBIABCADcDkOcBQQAP\nCyAAQQA2AqDnAQsgACgClOcBC1ABAn8jAEEQayIEJAAgBEEIakEANgIAIARCADcDAAJAIAQQIyIF\nRQRAQUAhAAwBCyAFIAAgASACIAMgBRAuECchACAFECQLIARBEGokACAAC+4BAQd/IwBBEGsiAiQA\nAkAgACgCqOcBBEAgACgCpOcBDQELEAALAkAgACgClOcBRQ0AIAAoAqTnASEBIAIgAEHc5QFqKAIA\nIgU2AgwgASgCBEEBayIGIAJBDGoQOKdxIQMgASgCACEHA0AgByADQQJ0aigCACIBRQ0BAkAgASgC\nCEEISQ0AIAEoAgQiBCgAAEG3yMLhfkcNACAEKAAEIgQgBUYNACADIAZxQQFqIQMgBA0BCwsgACgC\nkOcBECEgAEEANgKQ5wEgAEF/NgKg5wEgACABNgKU5wEgACAAKALc5QE2ApjnAQsgAkEQaiQAC+kG\nAQl/QWwhCAJAIAJBA0kNAAJAAkACQAJAIAEtAAAiBEEDcSIJQQFrDgMDAQACCyAAKAKA5gENAEFi\nDwsgAkEFSQ0CQQMhBiABKAAAIQUCfwJAAkACQCAEQQJ2QQNxIgdBAmsOAgECAAsgBUEOdkH/B3Eh\nBCAFQQR2Qf8HcSEDIAdFDAILIAVBEnYhBEEEIQYgBUEEdkH//wBxIQNBAAwBCyAFQQR2Qf//D3Ei\nA0GAgAhLDQMgAS0ABEEKdCAFQRZ2ciEEQQUhBkEACyEFIAQgBmoiCyACSw0CAkAgA0GBBkkNACAA\nKAKc5wFFDQBBACECA0AgAkHE/wBJIAJBQGshAg0ACwsCfyAJQQNGBEAgASAGaiEBIABB+OcBaiEC\nIAAoAgwhBiAFBEAgAiADIAEgBCAGEBwMAgsgAiADIAEgBCAGEB4MAQsgAEGs1QFqIQIgASAGaiEB\nIABB+OcBaiEGIABBqNAAaiEHIAAoAoznASEKIAUEQCAHIAYgAyABIAQgAhAdDAELIAcgBiADIAEg\nBCACEB8LQYh/Sw0CIAAgAzYCgOcBIABBATYCgOYBIAAgAEH45wFqNgLw5gEgCUECRgRAIAAgAEGo\n0ABqNgIMCyAAIANqIgBBkOgBakIANwAAIABBiOgBakIANwAAIABBgOgBakIANwAAIABB+OcBakIA\nNwAAIAsPC0ECIQMgAgJ/AkACQAJAIARBAnZBA3FBAWsOAwEAAgALQQEhAyAEQQN2DAILIAEvAABB\nBHYMAQtBAyEDIAEvAAAgAS0AAkEQdHJBBHYLIgQgA2oiBUEgakkEQCACIAVJDQIgAEH45wFqIAEg\nA2ogBBALIQEgACAENgKA5wEgACABNgLw5gEgASAEaiIAQgA3AAAgAEEIakIANwAAIABBEGpCADcA\nACAAQRhqQgA3AAAgBQ8LIAAgBDYCgOcBIAAgASADajYC8OYBIAUPC0ECIQMCfwJAAkACQCAEQQJ2\nQQNxQQFrDgMBAAIAC0EBIQMgBEEDdgwCCyABLwAAQQR2DAELIAJBBEkNASABLwAAIAEtAAJBEHRy\nIgJBj4CAAUsNAUEDIQMgAkEEdgshAiAAQfjnAWogASADai0AACACQSBqEAwhASAAIAI2AoDnASAA\nIAE2AvDmASADQQFqIQgLIAgLsAMBBX9BuH8hBwJAIANFDQAgAi0AACIERQRAIAFBADYCAEEBQbh/\nIANBAUYbDwsCfyACQQFqIARBGHRBGHUiBUF/Sg0AGiAFQX9GBEAgA0EDSA0CIAIvAAFBgP4BaiEE\nIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIACayEEIAJBAmoLIQUgASAENgIAIAVBAWoiASAC\nIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKE5gEg\nACgCnOcBIAQgAEGs1QFqIgggACgCjOcBEDkiBkGIf0sNACAAQZggaiAAQQhqIAVBBHZBA3FBH0EI\nIAEgBmogASAGQYl/SRsiASADIAFrQYALQYAMQYAXIAAoAoTmASAAKAKc5wEgBCAIIAAoAoznARA5\nIgZBiH9LDQAgAEGgMGogAEEEaiAFQQJ2QQNxQTRBCSABIAZqIAEgBkGJf0kbIgEgAyABa0GADUHg\nDkGQGSAAKAKE5gEgACgCnOcBIAQgCCAAKAKM5wEQOSIAQYh/Sw0AIAAgAWogAmshBwsgBwvfAQEE\nfyABKAIAIQUgASgCBCIGIQQgASACKAIEIgNBIE8EfxAAIAEoAgQFIAQLIANqIgQ2AgQgACADQQJ0\nQfAdaigCACAFQQAgAyAGamt2cTYCAAJAIARBIEsNACABKAIIIgMgASgCEE8EQCABIARBB3E2AgQg\nASADIARBA3ZrIgQ2AgggASAEKAAANgIADAELIAMgASgCDCIFRg0AIAEgAyADIAVrIARBA3YiBiAD\nIAZrIAVJGyIDayIFNgIIIAEgBCADQQN0azYCBCABIAUoAAA2AgALIAAgAkEIajYCBAvuAQEHf0G6\nfyEKAkAgAigCBCIIIAIoAgAiCWoiCyABIABrSw0AQWwhCiAJIAQgAygCACIOa0sNACACKAIIIQwg\nC0EATARAEAALIAAgCWohBCAJIAtOBEAQAAsgBCAMayENIAAgAUEgayIBIAMoAgAgCUEAEEwgAyAJ\nIA5qNgIAAkACQCAEIAVrIAxPBEAgDSEFDAELIAwgBCAGa0sNAiAHIAcgDSAFayIDaiIAIAhqTwRA\nIAQgACAIEAsaDAILIAQgAEEAIANrEAsgAiADIAhqIgg2AgQgA2shBAsgBCABIAUgCEEBEEwLIAsh\nCgsgCgv+BQEMfyMAQRBrIgskAAJ/IARBB00EQCALQgA3AwggC0EIaiADIAQQCxpBbCAAIAEgAiAL\nQQhqQQgQNSIAIAAgBEsbIAAgAEGJf0kbDAELIABBACABKAIAIgBBAXRBAmoQDCEQQVQgAygAACIH\nQQ9xIgVBCksNABogAEEBaiEOIAIgBUEFajYCACADIARqIgBBBGshCiAAQQdrIQwgBUEGaiENQQQh\nACAHQQR2IQZBICAFdCIIQQFyIQdBACECQQAhBSADIQQCQANAAkAgBUUEQCAEIQUMAQsgBkGAgICA\neHJB/////wdzaCIFQRhPBEADQCAEIAxrIQUgAkEkaiECIAogBEEDaiAEIAxLIgYbIgQoAAAgBUED\ndCAAakEfcSAAIAYbIgB2IgZBgICAgHhyQf////8Hc2giBUEXSw0ACwsgACAFQR5xIg9qIQkgBiAP\ndkEDcSIGQQNGBEAQAAsgCUECaiEAIAYgBUEBdkEDbCACamoiAiAOTw0CAn8gBCAMS0EAIAogBCAA\nQQN1aiIFSRtFBEAgCUEeTgRAEAALIABBB3EMAQsgACAEIAoiBWtBA3RqQR9xCyEAIAUoAAAgAHYh\nBgsCfyANQQFrIAYgCEEBa3EiBCAIQQF0QQFrIgkgB2siD0kNABogBiAJcSIEQQAgDyAEIAhIG2sh\nBCANCyEJIARBAWshBiAEQQFOBH8gByAGawUgBARAEAALIAYgB2oLIQcgECACQQF0aiAGOwEAIAhB\nAUwEQBAACyAAIAlqIQAgAkEBaiECAkAgByAISARAIAdBAkgNAUEBIAdnQR9zIgR0IQggBEEBaiEN\nCyACIA5PDQACfyAAQQdxIAUgDEtBACAKIAUgAEEDdWoiBEkbRQ0AGiAAIAUgCiIEa0EDdGpBH3EL\nIQAgBkUhBSAEKAAAIAB2IQYMAQsLIAUhBAtBbCAHQQFHDQAaQVAgAiAOSw0AGkFsIABBIEoNABog\nASACQQFrNgIAIAQgAEEHakEDdWogA2sLIAtBEGokAAuYBgILfwF+IAJBNU8EQBAACyAFQQpPBEAQ\nAAsgB0HxBE0EQBAACyAAQQhqIQ9BASAFdCIOQQFrIQ0CQCACQX9GBEBBASEKIA0hCAwBCyACQQFq\nIRBBgIAEIAVBAWt0QRB1IREgASEJIAYhCyANIQhBASEKA0ACQCAJLgEAIgdBf0YEQCAPIAhBA3Rq\nIAw2AgQgCEEBayEIQQEhBwwBCyAKQQAgByARSBshCiAHQX9KDQAQACAJLwEAIQcLIAsgBzsBACAJ\nQQJqIQkgC0ECaiELIBAgDEEBaiIMRw0ACwsgACAFNgIEIAAgCjYCACAFQQpPBEAQAAsgDkEDdiAO\nQQF2akEDaiESAkACQCAIIA1HBEAgAkF/Rg0CQQAhB0EAIQwDQCABIAxBAXRqLgEAIglBAU4EQEEA\nIQsDQCAPIAdBA3RqIAw2AgQDQCAHIBJqIA1xIgcgCEsNAAsgC0EBaiILIAlHDQALCyACIAxHIAxB\nAWohDA0ACyAHDQEMAgsgAkF/RwRAIAZB6gBqIRFBACEIQQAhCgNAIAggEWogEzcAACABIApBAXRq\nLgEAIhBBCU4EQCAGIAhqIQtB8gAhBwNAIAcgC2ogEzcAACAHQeIAayAHQQhqIQcgEEgNAAsLIBNC\ngYKEiJCgwIABfCETIAggEGohCCACIApHIApBAWohCg0ACwsgBUUEQBAACyASQQF0IQJBACEIQQAh\nBwNAIA8gByANcUEDdGogBiAIaiIBQeoAai0AADYCBCAPIAcgEmogDXFBA3RqIAFB6wBqLQAANgIE\nIAIgB2ogDXEhByAIQQJqIgggDkkNAAsgB0UNAQsQAAsgAEEMaiEHIAVBAWohBUEAIQgDQCAGIAco\nAgAiAUEBdGoiACAALwEAIgJBAWo7AQAgAkUEQBAACyAHQQFrIAUgAmdBYHNqIgA6AAAgB0EEayAC\nIAB0IA5rOwEAIAdBAmsgBCABQQJ0IgJqIgEoAgAiAEH/AU8EfxAAIAEoAgAFIAALOgAAIAcgAiAD\naigCADYCACAHQQhqIQcgCEEBaiIIIA5JDQALC8MBAQF/IABFBEAQAAsgACgC5OYBIgFBAk8EQBAA\nCyAAQgA3A/DlASAAQgA3A+jlASAAQgA3ArTlASAAQgA3AqzlASAAQQA2ApjnASAAQgA3A4DmASAA\nQgM3A/jlASAAQQFBBSABGzYCvOUBIABBqNAAaiIBQYyAgOAANgIAIAAgAEEQajYCACAAIABBoDBq\nNgIEIABBrNABakHgEikCADcCACAAIABBmCBqNgIIIABBtNABakHoEigCADYCACAAIAE2AgwL2wQC\nA38CfiAAQQRqIQECQCAAQQdxRQRAQsnP2bLx5brqJyEEAkAgASAAQQhqSQRAIAAhAgwBCwNAIAQg\nACkAACIFQs/W077Sx6vZQn5CIYggBUKAgICA+LSd9ZN/foRCh5Wvr5i23puef36FQhuJQoeVr6+Y\ntt6bnn9+Qp2jteqDsY2K+gB9IQQgAEEQaiEDIABBCGoiAiEAIAEgA08NAAsLAkAgASACQQRqIgBJ\nBEAgAiEADAELIAI1AABCh5Wvr5i23puef34gBIVCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQQL\nIAAgAU8NAQNAIAAxAABCxc/ZsvHluuonfiAEhUILiUKHla+vmLbem55/fiEEIAEgAEEBaiIARw0A\nCwwBC0LJz9my8eW66ichBAJAIAEgAEEIakkEQCAAIQIMAQsDQCAEIAApAAAiBULP1tO+0ser2UJ+\nQiGIIAVCgICAgPi0nfWTf36EQoeVr6+Ytt6bnn9+hUIbiUKHla+vmLbem55/fkKdo7Xqg7GNivoA\nfSEEIABBEGohAyAAQQhqIgIhACABIANPDQALCwJAIAEgAkEEaiIASQRAIAIhAAwBCyACNQAAQoeV\nr6+Ytt6bnn9+IASFQheJQs/W077Sx6vZQn5C+fPd8Zn2masWfCEECyAAIAFPDQADQCAAMQAAQsXP\n2bLx5brqJ34gBIVCC4lCh5Wvr5i23puef34hBCABIABBAWoiAEcNAAsLIARCIYggBIVCz9bTvtLH\nq9lCfiIEQh2IIASFQvnz3fGZ9pmrFn4iBEIgiCAEhQvRAgAjAEGAAWsiDiQAIA4gAzYCfAJAAkAC\nQAJAAkACQCACDgQBAAMCBAsgBkUEQEG4fyECDAULQWwhAiADIAUtAAAiA0kNBCAAQQA7AQggAEEL\nakEAOgAAIAcgA0ECdCICaigCACEDIAIgCGooAgAhAiAAQgA3AgAgAkH/AU8EQBAACyABIAA2AgAg\nAEEMaiADNgIAIABBCmogAjoAAEEBIQIMBAsgASAJNgIAQQAhAgwDCyAKRQRAQWwhAgwDC0EAIQIg\nC0UgDEEZSHINAkEIIAR0QQhqIgBFDQJBACEDA0AgA0FAayIDIABJDQALDAILQWwhAiAOIA5B/ABq\nIA5B+ABqIAUgBhA1IgNBiH9LDQEgBCAOKAJ4IgRJDQEgACAOIA4oAnwgByAIIAQgDUGAEBA2IAEg\nADYCACADIQIMAQsQAEF/IQILIA5BgAFqJAAgAgvmBQIKfwF+QVIhBgJAIAJB/wFLDQAgBa0gAkEB\naiIMQQF0rUIBIAOthnxCCHxUDQBBVCEGIANBDEsNACAAQQRqIQlBASEKQQEgA3QiDkEBayINIQYg\nDARAQYCABCADQQFrdEEQdSEPIAEhBSAEIQggDSEGA0ACQCAFLwEAIgtB//8DRgRAIAkgBkECdGog\nBzoAAiAGQQFrIQZBASELDAELIApBACAPIAtBEHRBEHVKGyEKCyAIIAs7AQAgBUECaiEFIAhBAmoh\nCCAMIAdBAWoiB0cNAAsLIAAgCjsBAiAAIAM7AQAgDkEDdiAOQQF2akEDaiEAAkAgBiANRwRAIAxF\nDQFBACEFQQAhBwNAIAEgB0EBdGouAQAiCEEBTgRAIAhB//8DcSEIQQAhCwNAIAkgBUECdGogBzoA\nAgNAIAAgBWogDXEiBSAGSw0ACyALQQFqIgsgCEkNAAsLIAIgB0cgB0EBaiEHDQALQX8hBiAFRQ0B\nDAILIAwEQCAEIAJBAXRqQQJqIQggBCACQQF0aiELQQAhCkEAIQcDQCAIIApqIBA3AAAgASAHQQF0\nai4BACIGQQlOBEAgCiALaiEMQQghBQNAIAUgDGpBAmogEDcAACAFQQhqIgUgBkgNAAsLIBBCgYKE\niJCgwIABfCEQIAYgCmohCiACIAdHIAdBAWohBw0ACwsgA0UEQBAACyAAQQF0IQEgBCACQQF0aiEC\nQQAhBkEAIQUDQCAJIAUgDXFBAnRqIAIgBmoiCEECai0AADoAAiAJIAAgBWogDXFBAnRqIAhBA2ot\nAAA6AAIgASAFaiANcSEFIAZBAmoiBiAOSQ0ACyAFRQ0AEAALIANBAWohAUEAIQYDQCAEIAlBAmot\nAABBAXRqIgAgAC8BACIAQQFqOwEAIABFBEAQAAsgCUEDaiABIABnQWBzaiICOgAAIAkgACACdCAO\nazsBACAJQQRqIQkgBkEBaiIGIA5JDQALQQAhBgsgBguVAQICfwF+IwBBEGsiAkEIagJ/IABBf0wE\nQEGcLC8BACIBDAELQZwsLwEAIQFBniwvAQBBAWsLIABqQQxsQZQgaiIAQRBqKAIANgIAIABBCGop\nAgAhA0GcLCABQQFqOwEAIAIgAzcDACABQQxsQZwgaiEBQQAhAANAIAAgAWogACACai0AADoAACAA\nQQFqIgBBDEcNAAsLqAEBA38CQAJAIABBf0wEQCAAQX9GDQJBnCwvAQAiAUEBayECIAAgAWohAwwB\nC0GeLC8BACAAaiIBQZwsLwEAIgJGDQEgAkEBayECIAFBAWshA0GeLC8BAEEBayEBC0GUICAAIAFq\nED0gAkEMbEGcIGohASADQQxsQZwgaiECQQAhAANAIAAgAmogACABai0AADoAACAAQQFqIgBBDEcN\nAAsLQZQgQQEQPgumAQEGfwJAIAAgAUEMbGoiAkEIaiIFLQAAQQRHDQAgAkEMaiIGKAIABEAgACAB\nQQxsakEQaigCACEEIAAvAYgMIgcEQCAAQRBqIQIDQAJAIAEgA0YNACACQQhrLQAAQQRHDQAgAigC\nACAERg0ECyACQQxqIQIgA0EBaiIDIAdJDQALCyAEEBALIAVBADoAACAGQQA2AgAgACABQQxsakEQ\nakEANgIACwtNAQF/IAEgAC8BiAxKBEAQAAsgAUEBTgRAIAAvAYgMIQIDQCAAIAJB//8DcUEBaxA9\nIAAgAC8BiAxBAWsiAjsBiAwgAUEBayIBDQALCwuvAgIHfwF+IwBBEGsiBiQAQZwsLwEAQQxsQZAg\naiIBKAIEIQIgAS0AAEGeLC8BACEEQZQgQQEQPkGeLEGcLC8BACAAazsBAEEFRgRAQZQgIAIRAAAh\nAUGcLC8BACABa0GeLC8BAGsiAwRAIAFBAU4EQCAEQQFqIQADQAJ/IABBf0wEQEGcLC8BAAwBC0Ge\nLC8BAEEBawsgAGpBDGxBnCBqIgIpAgAhCCACAn8gACADakF/TARAQZwsLwEADAELQZ4sLwEAQQFr\nCyADaiAAakEMbEGcIGoiBSkCADcCACACQQhqIgIoAgAhByACIAVBCGoiAigCADYCACAFIAg3AgAg\nAiAHNgIAIABBAWohACABQQFrIgENAAsLQZQgIAMQPgtBniwgBDsBAAsgBkEQaiQACyUBAn9BnCwv\nAQAiAQRAA0BBlCAgABA9IAEgAEEBaiIARw0ACwsLPwEBfkGgLEEAOwEAQZQgIAApAgAiATcCACAA\nLwEEIAGnaiIAQQJrLQAABEAQAAsgAEEBay0AAEEBRwRAEAALC6ACAQd/IwBBEGsiBSQAIAAgAC8B\nigxBDGxqIgJBEGooAgAhBiACQQxqKAIAIQMgAkEIai0AAEEERwRAEAALIAEEfyABEA4FQQALIQcg\nASADIAEgA0kbIgQEQCAGIQIgByEDA0AgAyACLQAAOgAAIAJBAWohAiADQQFqIQMgBEEBayIEDQAL\nCyAALwGIDCIEBEAgAEEQaiECQQAhAwNAAkAgA0EBRg0AIAJBCGsiCC0AAEEERw0AIAIoAgAgBkcN\nACAIQQQ6AAAgAiAHNgIAIAJBBGsgATYCACACQQdrIgRBAmogBUEPai0AADoAACAEIAUvAA07AAAg\nAC8BiAwhBAsgAkEMaiECIANBAWoiAyAEQf//A3FJDQALCyAFQRBqJAALQwEBfyAAIAAvAYgMIgJB\nAWo7AYgMIABBCGogAkEMbGoiAiABBH8gARAOBUEACyIANgIIIAIgATYCBCACQQQ6AAAgAAsnAQF/\nQZwsLwEAQQxsQYggaiIAQRBqKAIAQQAgAEEIai0AAEEERhsLJwEBf0GcLC8BAEEMbEGIIGoiAEEM\naigCAEEAIABBCGotAABBBEYbC2MBA39BsB8hAEGwHygCAARAQeQyLQAAIQEDQCABQf8BcSICQQJ0\nQeQuaiAAKAIANgIAIAJBAXRB5CxqIABBBGovAQA7AQAgAUEBaiEBIABBCGoiACgCAA0AC0HkMiAB\nOgAACwvcAwIFfwJ9IABBCGoiAyAALwGKDEEMbGoiAigCBCEEIAJBEGooAgAhASACLQAAIQUgAkEM\nai0AACECIABBAhA+AkACQAJAIAIgBUYEQAJAIAVBAWsOAwADBAILIAAgAC8BiAwiAEEBajsBiAwg\nAyAAQQxsaiIAIAS+IAG+kjgCBCAAQQE6AABBAQ8LAkACQAJAIAVBAWsOAwIAAQMLAkACQAJAIAJB\nAWsOAwACAgELIAG+IgaLQwAAAE9dBEAgBqghAQwCC0GAgICAeCEBDAELEABBACEBCwwDCwJAAkAC\nQAJAIAJBAWsOAwADAwELIAG+IgZDAACAT10gBkMAAAAAYHFFDQEgBqkhAQwCCxAAC0EAIQELDAML\nIAS+IQcCfQJAAkACQAJAIAJBAWsOAwACAQMLIAG+DAMLIAGzDAILIAGyDAELEABDAAAAAAshBiAA\nIAAvAYgMIgBBAWo7AYgMIAMgAEEMbGoiACAGIAeSOAIEIABBAToAAEEBDwsQAEEADwsgACAALwGI\nDCIAQQFqOwGIDCADIABBDGxqIgAgASAEajYCBCAAQQI6AABBAQ8LIAAgAC8BiAwiAEEBajsBiAwg\nAyAAQQxsaiIAIAEgBGo2AgQgAEEDOgAAQQELbQEBfyAAIAAvAYgMIgFBAWo7AYgMIAAgAUEMbGoi\nAEEQakGAgAIQDiIBNgIAIABBDGpBgIACNgIAIABBCGpBBDoAAEEAIQADQCAAIAFqQQA6AAAgAEEB\naiIAQYCAAkcNAAsgAUH0/wE2AgBBAQvpBgINfwF+IwBBkIABayINJAACQCAAQQhqIgogAC8BigxB\nDGxqIgFBEGooAgAiB0UNACABQQxqIgMtAAAiBkEERw0AIAEoAghBACABLQAAQQRGGyEEIAMoAghB\nACAGQQRGGyEGA0AgBEEUaigCAEECdCIBQRRqIQsgAUGUoAFqIgMgBCgCAEsEQCAAIAFBoKABahBC\nIAogAC8BigxBDGxqIgEoAghBACABLQAAQQRGGyIEIAM2AgALIARBDGohCAJAIAsgBCgCBCICSwRA\nIAQgCyACayIBIAcgASAHSRsiBQR/IAIgBGpBDGohAiAGIQEgBSEDA0AgAiABLQAAOgAAIAFBAWoh\nASACQQFqIQIgA0EBayIDDQALIAQoAgQFIAILIAVqIgE2AgQgByAFayEHIAUgBmohBiABQQRJDQEg\nCC0AAEHyAEcNAyAILQABQTRHDQMgCC0AAkHDAEcNAyAILQADQfoARg0BDAMLIAggBCgCCEECdGoi\nAUEUaigCACABQRBqKAIAayIIIAIgC2siDEsEQCAEIAggDGsiASAHIAEgB0kbIgUEfyACIARqQQxq\nIQIgBiEBIAUhAwNAIAIgAS0AADoAACABQQFqIQEgAkEBaiECIANBAWsiAw0ACyAEKAIEBSACCyAF\najYCBCAFIAxqIQwgByAFayEHIAUgBmohBgsgCCAMRw0AIAAgDUEQakGAgAEgBCALakEMaiAIEC8i\nAUGAgAEgAUGJf0kbIgMQQyECIAMEQCANQRBqIQEDQCACIAEtAAA6AAAgAkEBaiECIAFBAWohASAD\nQQFrIgMNAAsLIAQgBCgCBCAIazYCBCAEIAQoAghBAWo2AgggCUEBaiEJCyAHDQALCyAAIAAvAYgM\nIgFBAWo7AYgMIAogAUEMbGoiAUIANwIEIAFBBDoAACAJQQFqIgRBAm0hByAJQQFOBEAgCUF/cyEG\nQX8hAUEAIQIDQCABIAAvAYgMIgNqIQUgCiACIAZqQQBOBH8gAC8BigxBAWsFIAMLIAZqIAJqQQxs\naiIDKQIAIQ4gAyAKIAVBDGxqIgUpAgA3AgAgA0EIaiIDKAIAIQkgAyAFQQhqIgMoAgA2AgAgBSAO\nNwIAIAMgCTYCACABQQFrIQEgAkEBaiICIAdIDQALCyANQZCAAWokACAEC9IDAgh/AX0gAEEIaiIG\nIAAvAYoMIgJBDGxqIgEtAAAgASgCBCEFIAEoAgghCCABQRBqKAIAIQMCQAJAAkAgAUEMai0AAEEB\naw4DAAICAQsgA74iCYtDAAAAT10EQCAJqCEDDAILQYCAgIB4IQMMAQsQACAALwGKDCECQQAhAwtB\nBEYhBCACQQxsIAZqIgdBHGooAgAhAQJAAkACQCAHQRhqLQAAQQFrDgMAAgIBCyABviIJi0MAAABP\nXQRAIAmoIQEMAgtBgICAgHghAQwBCxAAIAAvAYoMIQJBACEBCyAFQQAgBBshBSACQQxsIAZqIgdB\nKGooAgAhAgJAAkACQCAHQSRqLQAAQQFrDgMAAgIBCyACviIJi0MAAABPXQRAIAmoIQIMAgtBgICA\ngHghAgwBCxAAQQAhAgsgBSABayACIAEgAmogBUsbQQF2IgIEQCAIQQAgBBsgAWohAQNAIAEgA0GA\n/wNxQQd2IANzIgNBCXQgA3MiA0GAwANxQQ12IANzIgMgAS8BAHM7AQAgAUECaiEBIAJBAWsiAg0A\nCwsgAEEEED4gACAALwGIDCIAQQFqOwGIDCAGIABBDGxqIgAgA0H//wNxNgIEIABBAjoAAEEBC4IR\nAg9/AX0jAEEQayIHJABBfSEMQZggLwEAIQ1BlCAoAgAhA0GgLC8BACEAA0ACQCANIAAiBE0EQBAA\nCyAEQQFqIQACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgAyAEaiII\nLQAAIgoOFxQBEgIJAwwODg4NDQoLEBAQEBAQEBAQAAsCQCAKQfABaw4FBQYEBwgACyAKQf8BRw0Q\nQaAsQQA7AQBBmCBBADsBAEGUIEEANgIAQX8hDAwUC0GgLCAEQQJqOwEAIAAgA2otAAAhDAwTCyAA\nIANqLQAAQYABaxA7DBALIAAgA2otAAAQPwwPCyAAIANqIQFBACEAA0AgB0EEaiAAaiAAIAFqLQAA\nOgAAIABBAWoiAEEERw0ACyAHKAIEIQFBnCxBnCwvAQAiAEEBajsBACAAQQxsQZwgaiIAIAE2AgQg\nAEEBOgAADAoLIAAgA2ohAUEAIQADQCAHQQhqIABqIAAgAWotAAA6AAAgAEEBaiIAQQRHDQALIAco\nAgghAUGcLEGcLC8BACIAQQFqOwEAIABBDGxBnCBqIgAgATYCBCAAQQI6AAAMCQsgACADaiEBQQAh\nAANAIAdBDGogAGogACABai0AADoAACAAQQFqIgBBBEcNAAsgBygCDCEBQZwsQZwsLwEAIgBBAWo7\nAQAgAEEMbEGcIGoiACABNgIEIABBAzoAAAwICyAAIANqLQAAIQFBnCxBnCwvAQAiAEEBajsBACAA\nQQxsQZwgaiIAQQU6AAAgACABQQJ0QaAdaigCADYCBAwLCwJAQeQyLQAAIgJFBEBBACECQQAhCQwB\nCyAIQQJqLQAAIAAgA2otAABBCHRyIQFBACEJQeQsIQBB5C4hBQNAIAAvAQAgAUYEQEGcLEGcLC8B\nACIAQQFqOwEAIABBDGxBnCBqIgAgBSgCADYCBCAAQQU6AABB5DItAAAhAgwCCyAAQQJqIQAgBUEE\naiEFIAlBAWoiCSACSQ0ACwsgAkH/AXEgCU0EQBAACyAEQQNqIQAMCwsgACADai0AAEGAAWsQPAwJ\nCyAAIANqLQAAIAhBAmotAABB4ixB4iwvAQAiAEEBajsBACAAQQF0QaIsaiAEQQNqOwEAQQh0ciEA\nDAkLQeIsQeIsLwEAQQFrIgQ7AQAgBEH//wNxQQF0QaIsai8BACEADAgLIAAgA2otAAAgCEECai0A\nAEEIdHIhAAwHCyAAIANqLAAAIgFB/wFxQYABayEAIARBAmohBQJ/IAFBAE4EQEGcLC8BAAwBC0Ge\nLC8BAEEBawsgAGpBDGxBnCBqIgEoAgQhAAJAAkACQCABLQAAQQFrDgMAAgIBCyAAviIPi0MAAABP\nXQRAIA+oIQAMAgtBgICAgHghAAwBCxAAQQAhAAsgAyAFai0AACAIQQNqLQAAQQh0ciAEQQRqIApB\nCkYgAEEAR3MbIQAMBgsgACADaiwAACIGQf8BcUGAAWshCyAIQQJqLQAAIgFBGHRBGHUhCSAIQQNq\nLwAAIQAgAUGAAWshBQJ/IAZBAE4EQEGcLC8BAAwBC0GeLC8BAEEBawsgC2pBDGxBnCBqIgEoAgQh\nBiABLQAAIQsCfyAJQQBOBEBBnCwvAQAMAQtBniwvAQBBAWsLIAVqQQxsQZwgaiIBKAIEIQIgAS0A\nACEBAn0CQAJAAkACQAJAIApBB2sOAwIAAQYLAkACQAJAIAtBAWsOAwABAgULIAa+IQ8CfQJAAkAC\nQAJAIAFBAWsOAwACAQMLIAK+DAMLIAKzDAILIAKyDAELEABDAAAAAAsgD1wNBwwMCwJAAkACQCAB\nQQFrDgMAAgIBCyACviIPi0MAAABPXQRAIA+oIQIMAgtBgICAgHghAgwBCxAAQQAhAgsgAiAGRw0G\nDAsLAkACQAJAAkAgAUEBaw4DAAMDAQsgAr4iD0MAAIBPXSAPQwAAAABgcUUNASAPqSECDAILEAAL\nQQAhAgsgAiAGRw0FDAoLAkACQAJAIAtBAWsOAwABAgQLIAa+IQ8CfQJAAkACQAJAIAFBAWsOAwAC\nAQMLIAK+DAMLIAKzDAILIAKyDAELEABDAAAAAAsgD11FDQYMCwsCQAJAAkAgAUEBaw4DAAICAQsg\nAr4iD4tDAAAAT10EQCAPqCECDAILQYCAgIB4IQIMAQsQAEEAIQILIAIgBk4NBQwKCwJAAkACQAJA\nIAFBAWsOAwADAwELIAK+Ig9DAACAT10gD0MAAAAAYHFFDQEgD6khAgwCCxAAC0EAIQILIAIgBk8N\nBAwJCwJAAkACQCALQQFrDgMAAQIDCyAGviEPAkACQAJAIAFBAWsOAwYBAAILIAKzDAYLIAKyDAUL\nEABDAAAAAAwECwJAAkACQCABQQFrDgMAAgIBCyACviIPi0MAAABPXQRAIA+oIQIMAgtBgICAgHgh\nAgwBCxAAQQAhAgsgAiAGTA0EDAkLAkACQCABQQFrDgMAAQECCyACviIPQwAAgE9dIA9DAAAAAGBx\nBEAgD6khAgwBC0EAIQILIAIgBk0NAwwICxAADAILIAK+CyAPXg0FCyAEQQVqIQAMBAsgACADaiwA\nACIBQf8BcUGAAWshACAKQQxrIQUCfyABQQBOBEBBnCwvAQAMAQtBniwvAQBBAWsLIABqQQxsQZwg\naiIBKAIEIQACQAJAAkACQCABLQAAQQFrDgMAAwMBCyAAviIPQwAAgE9dIA9DAAAAAGBxRQ0BIA+p\nIQAMAgsQAAtBACEACyAEQQJqIQQgACAFSQRAIAMgAEEBdCAEamovAAAhAAwECyAFQQF0IARqIQAM\nAwsQAEF+IQwMAwtBlCAgACADai0AABA+CyAEQQJqIQALQaAsIAA7AQAgDkEBaiIOQYCAgIAERw0B\nCwsgB0EQaiQAIAwLzwYBA38gACADaiEGIAAgAmshBQJAAkACQAJAAkACQAJAIARFBEAgACABTyAF\nQQdqQQ9Pcg0BEAAgA0EISA0EDAULIARBAUZBACAFQX9KGw0BEAAgA0EISA0DIARBAUcNBAwCCyAD\nQQdKDQMMAgsgA0EISA0BCyAAIAJJBEAQAAsCQCAFQQdNBEAgACACLQAAOgAAIAAgAi0AAToAASAA\nIAItAAI6AAIgACACLQADOgADIAAgAiAFQQJ0IgVB8B5qKAIAaiICKAAANgAEIAIgBUGQH2ooAgBr\nIQIMAQsgACACKQAANwAAC0EBIQUgAEEIaiIAIAJBCGoiAmtBB0oNAhAAEAAMAgsgA0EBSA0CA0Ag\nACACLQAAOgAAIAJBAWohAiAAQQFqIgAgBkkNAAsMAgtBACEFCyABIAZPBEAgACADaiEGAkAgACAC\nayIBQQdMBEAgBEVBACABQXFIGw0BEAALIAVBAXMgAUEPSnJFBEADQCAAIAIpAAA3AAAgAkEIaiEC\nIABBCGoiACAGSQ0ADAQLAAsgAUEPakEeSw0AEAALIAAgAikAADcAACAAQQhqIAJBCGopAAA3AAAg\nA0ERSA0BIAJBIGohASAAQRBqIQIDQCACIAFBEGsiACkAADcAACACQQhqIABBCGopAAA3AAAgAkEQ\naiABKQAANwAAIAJBGGogAUEIaikAADcAACABQSBqIQEgAkEgaiICIAZJDQALDAELAkAgACABSwRA\nIAAhAQwBCyABIABrIQcCQAJAIAAgAmsiA0EHTARAIARFQQAgA0FxSBsNARAACyAFQQFzIANBD0py\nRQRAIAIhAwNAIAAgAykAADcAACADQQhqIQMgAEEIaiIAIAFJDQALDAILIANBD2pBHksNABAACyAA\nIAIpAAA3AAAgAEEIaiACQQhqKQAANwAAIAdBEUgNACACQSBqIQMgAEEQaiEAA0AgACADQRBrIgQp\nAAA3AAAgAEEIaiAEQQhqKQAANwAAIABBEGogAykAADcAACAAQRhqIANBCGopAAA3AAAgA0EgaiED\nIABBIGoiACABSQ0ACwsgAiAHaiECCyABIAZPDQADQCABIAItAAA6AAAgAkEBaiECIAYgAUEBaiIB\nRw0ACwsL3AMCBX8CfSAAQQhqIgMgAC8BigxBDGxqIgIoAgQhBCACQRBqKAIAIQEgAi0AACEFIAJB\nDGotAAAhAiAAQQIQPgJAAkACQCACIAVGBEACQCAFQQFrDgMAAwQCCyAAIAAvAYgMIgBBAWo7AYgM\nIAMgAEEMbGoiACAEviABvpM4AgQgAEEBOgAAQQEPCwJAAkACQCAFQQFrDgMCAAEDCwJAAkACQCAC\nQQFrDgMAAgIBCyABviIGi0MAAABPXQRAIAaoIQEMAgtBgICAgHghAQwBCxAAQQAhAQsMAwsCQAJA\nAkACQCACQQFrDgMAAwMBCyABviIGQwAAgE9dIAZDAAAAAGBxRQ0BIAapIQEMAgsQAAtBACEBCwwD\nCyAEviEHAn0CQAJAAkACQCACQQFrDgMAAgEDCyABvgwDCyABswwCCyABsgwBCxAAQwAAAAALIQYg\nACAALwGIDCIAQQFqOwGIDCADIABBDGxqIgAgByAGkzgCBCAAQQE6AABBAQ8LEABBAA8LIAAgAC8B\niAwiAEEBajsBiAwgAyAAQQxsaiIAIAQgAWs2AgQgAEECOgAAQQEPCyAAIAAvAYgMIgBBAWo7AYgM\nIAMgAEEMbGoiACAEIAFrNgIEIABBAzoAAEEBC5oDAgV/An0gAEEIaiIEIAAvAYoMQQxsaiICKAIE\nIQMgAkEQaigCACEBIAJBDGotAAAhBSACLQAAIQIgAEECED4CQAJAAkACQCACQQFrDgMCAAEDCwJA\nAkACQCAFQQFrDgMAAgIBCyABviIGi0MAAABPXQRAIAaoIQEMAgtBgICAgHghAQwBCxAAQQAhAQsg\nACAALwGIDCIAQQFqOwGIDCAEIABBDGxqIgAgAyABIAEgA0obNgIEIABBAjoAAEEBDwsCQAJAAkAC\nQCAFQQFrDgMAAwMBCyABviIGQwAAgE9dIAZDAAAAAGBxRQ0BIAapIQEMAgsQAAtBACEBCyAAIAAv\nAYgMIgBBAWo7AYgMIAQgAEEMbGoiACADIAEgASADSxs2AgQgAEEDOgAAQQEPCwJ9AkACQAJAAkAg\nBUEBaw4DAAIBAwsgAb4MAwsgAbMMAgsgAbIMAQsQAEMAAAAACyEGIAAgAC8BiAwiAEEBajsBiAwg\nBCAAQQxsaiIAIAO+IgcgBiAGIAdeGzgCBCAAQQE6AABBAQ8LEABBAAuaAwIFfwJ9IABBCGoiBCAA\nLwGKDEEMbGoiAigCBCEDIAJBEGooAgAhASACQQxqLQAAIQUgAi0AACECIABBAhA+AkACQAJAAkAg\nAkEBaw4DAgABAwsCQAJAAkAgBUEBaw4DAAICAQsgAb4iBotDAAAAT10EQCAGqCEBDAILQYCAgIB4\nIQEMAQsQAEEAIQELIAAgAC8BiAwiAEEBajsBiAwgBCAAQQxsaiIAIAMgASABIANIGzYCBCAAQQI6\nAABBAQ8LAkACQAJAAkAgBUEBaw4DAAMDAQsgAb4iBkMAAIBPXSAGQwAAAABgcUUNASAGqSEBDAIL\nEAALQQAhAQsgACAALwGIDCIAQQFqOwGIDCAEIABBDGxqIgAgAyABIAEgA0kbNgIEIABBAzoAAEEB\nDwsCfQJAAkACQAJAIAVBAWsOAwACAQMLIAG+DAMLIAGzDAILIAGyDAELEABDAAAAAAshBiAAIAAv\nAYgMIgBBAWo7AYgMIAQgAEEMbGoiACADviIHIAYgBiAHXRs4AgQgAEEBOgAAQQEPCxAAQQALXQED\nfyAAQQhqIgIgAC8BiAxBDGxqQQxrIgEoAgQhAyABLQAAIQEgAEEBED4gACAALwGIDCIAQQFqOwGI\nDCACIABBDGxqIgAgA0EAIAFBBEYbNgIEIABBAjoAAEEBC30BBX8gAEEIaiICIAAvAYoMQQxsaiIB\nKAIEIQMgAUEQaigCACEEAkAgAS0AACIFQQFrQQJNBEAgAUEMai0AAEEBa0EDSQ0BCxAACyAAQQIQ\nPiAAIAAvAYgMIgBBAWo7AYgMIAIgAEEMbGoiACADIARzNgIEIAAgBToAAEEBC30BBX8gAEEIaiIC\nIAAvAYoMQQxsaiIBKAIEIQMgAUEQaigCACEEAkAgAS0AACIFQQFrQQJNBEAgAUEMai0AAEEBa0ED\nSQ0BCxAACyAAQQIQPiAAIAAvAYgMIgBBAWo7AYgMIAIgAEEMbGoiACADIARxNgIEIAAgBToAAEEB\nC30BBX8gAEEIaiICIAAvAYoMQQxsaiIBKAIEIQMgAUEQaigCACEEAkAgAS0AACIFQQFrQQJNBEAg\nAUEMai0AAEEBa0EDSQ0BCxAACyAAQQIQPiAAIAAvAYgMIgBBAWo7AYgMIAIgAEEMbGoiACADIARy\nNgIEIAAgBToAAEEBC9MBAgZ/AX0gAEEIaiIDIAAvAYoMQQxsaiICKAIEIQQgAkEQaigAACEBIAIt\nAAAiBUEBa0ECTUEAIAJBDGotAAAiBkEBa0EDSRtFBEAQAAsgAEECED4gACAALwGIDCICQQFqOwGI\nDCADIAJBDGxqIAU6AAAgAyACQQxsagJ/AkACQAJAAkAgBkEBaw4DAAEBAgsgAb4iB4tDAAAAT10E\nQCAHqCEBDAELQYCAgIB4IQELIAFBf0oNASAEQQAgAWt0DAILEABBACEBCyAEIAF2CzYCBEEBCwu9\naAMAQYAIC7AXAAAAAAAAAAABAAAAAQAAAAIAAAACAAAAAAAAAAAAAAABAAAAAQAAAAIAAAACAAAA\nJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJ\nBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJ\nAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMA\nAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAA\nVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABq\nAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEA\nAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8A\nAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f\n/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAM\nAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoA\nAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAA\nAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAA\nGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAv\nAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOA\nAAADAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAAD\nAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAA\nAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAA\nAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAA\nQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEA\nAAABAAAAAQAAAAIAAAACAAAAAwAAAAMAAAAEAAAABgAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAA\nAA0AAAAOAAAADwAAABAAAAABAAAABAAAAAgAAAAAAAAAAQABAQYAAAAAAAAEAAAAABAAAAQAAAAA\nIAAABQEAAAAAAAAFAwAAAAAAAAUEAAAAAAAABQYAAAAAAAAFBwAAAAAAAAUJAAAAAAAABQoAAAAA\nAAAFDAAAAAAAAAYOAAAAAAABBRAAAAAAAAEFFAAAAAAAAQUWAAAAAAACBRwAAAAAAAMFIAAAAAAA\nBAUwAAAAIAAGBUAAAAAAAAcFgAAAAAAACAYAAQAAAAAKBgAEAAAAAAwGABAAACAAAAQAAAAAAAAA\nBAEAAAAAAAAFAgAAACAAAAUEAAAAAAAABQUAAAAgAAAFBwAAAAAAAAUIAAAAIAAABQoAAAAAAAAF\nCwAAAAAAAAYNAAAAIAABBRAAAAAAAAEFEgAAACAAAQUWAAAAAAACBRgAAAAgAAMFIAAAAAAAAwUo\nAAAAAAAGBEAAAAAQAAYEQAAAACAABwWAAAAAAAAJBgACAAAAAAsGAAgAADAAAAQAAAAAEAAABAEA\nAAAgAAAFAgAAACAAAAUDAAAAIAAABQUAAAAgAAAFBgAAACAAAAUIAAAAIAAABQkAAAAgAAAFCwAA\nACAAAAUMAAAAAAAABg8AAAAgAAEFEgAAACAAAQUUAAAAIAACBRgAAAAgAAIFHAAAACAAAwUoAAAA\nIAAEBTAAAAAAABAGAAABAAAADwYAgAAAAAAOBgBAAAAAAA0GACAAAAAAAAAAAAAAAQABAQUAAAAA\nAAAFAAAAAAAABgQ9AAAAAAAJBf0BAAAAAA8F/X8AAAAAFQX9/x8AAAADBQUAAAAAAAcEfQAAAAAA\nDAX9DwAAAAASBf3/AwAAABcF/f9/AAAABQUdAAAAAAAIBP0AAAAAAA4F/T8AAAAAFAX9/w8AAAAC\nBQEAAAAQAAcEfQAAAAAACwX9BwAAAAARBf3/AQAAABYF/f8/AAAABAUNAAAAEAAIBP0AAAAAAA0F\n/R8AAAAAEwX9/wcAAAABBQEAAAAQAAYEPQAAAAAACgX9AwAAAAAQBf3/AAAAABwF/f//DwAAGwX9\n//8HAAAaBf3//wMAABkF/f//AQAAGAX9//8AAAAAAAAAAAABAAEBBgAAAAAAAAYDAAAAAAAABAQA\nAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAA\nAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAA\nAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAA\nAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAA\nAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAAB\nBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAE\nBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYR\nAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOA\nAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBAAAAAAAAAAAAAAEAAAABQAA\nAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAEAAAA\nAAAAAAIAAAAEAAAACAAAAAAAAAABAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/\nAwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP//\n/wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAAAQAAAAQAAAAEAAAABAAA\nAAQAAAAIAAAACAAAAAgAAAAHAAAACAAAAAkAAAAKAAAACwAAAABBsB8LIAEAAADGAwAAAgAAAKoI\nAAADAAAAohMAAAAAAAAAAAAAAEHQHwvYUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n"},duFD:e=>{"use strict";e.exports="varying highp vec2 vTextureCoord;precision highp int;uniform sampler2D uT;uniform highp ivec2 uS;uniform bool uY;uniform int uO;int f(int i,int u){int y=i/u;return i-y*u;}int i(int i,int t){if(i<t)return i;return t;}int u(int i,int u){if(i<u)return u;return i;}int f(int y,int t,int f){int x=i(y,t),n=u(y,t);if(f<x)return f*(f+1)/2;if(f<n)return x*(x+1)/2+x*(f-x);int v=f-n;return x*(x+1)/2+x*(n-x)+(x-1)*v-(v-1)*v/2;}int i(int y,int t,ivec2 x){int v=i(y,t),n=u(y,t),r=0,g=x.x+x.y;bool h=f(g,2)==0;if(g<v){if(h)return f(y,t,g)+g-x.y;return f(y,t,g)+x.y;}if(g<n){int S=t-x.y-1;if(y<t)S=v-(y-x.x);if(h)return f(y,t,g)+S;return f(y,t,g)+v-S-1;}int S=t-x.y-1,e=v+n-g-1;if(h)return f(y,t,g)+S;return f(y,t,g)+e-S-1;}ivec2 u(int y,int t,int x){int g=i(y,t),v=u(y,t);if(x<g*(g+1)/2){int n=(-1+int(sqrt(float(8*x+1))))/2,h=x-f(y,t,n);bool S=f(n,2)==0;if(S)return ivec2(h,n-h);return ivec2(n-h,h);}if(x<g*(g+1)/2+g*(v-g)){x=x-g*(g+1)/2;int n=g+x/g,S=f(x,g);bool h=f(n,2)==0;int r=n-g+S+1,e=g-S-1,s=n-S,T=S;if(y>t){if(h)return ivec2(r,e);return ivec2(s,T);}if(h)return ivec2(T,s);return ivec2(e,r);}int n=g*(g-1)/2-(x-(g*(g+1)/2+g*(v-g)))-1,S=(-1+int(sqrt(float(8*n+1))))/2;n=v+g-S-2;int r=x-f(y,t,n);bool h=f(n,2)==0;int e=g+v-n-1;if(h)r=e-r-1;int s=n+r-y+1;return ivec2(n-s,s);}int f(ivec2 g){int y=uS.x/8,t=uS.y/8,x=i(y,t,ivec2(g.x/8,g.y/8)),n=f(x,4);g.x=f(g.x,8);g.y=f(g.y,8);ivec2 r=g;if(n==1)r.x=7-g.x;if(n==2)r.x=g.y,r.y=g.x;if(n==3)r.x=7-g.y,r.y=g.x;return x*64+r.x+r.y*8;}ivec2 i(int i){int x=uS.x,t=uS.y,g=x*t;if(i<0)i+=g;i=f(i,g);int y=x/8,n=t/8,h=i/64,v=i-h*64,S=v/8,r=v-S*8,s=f(h,4);ivec2 e=u(y,n,h),T=e*8;if(s==0)T.x+=r,T.y+=S;if(s==1)T.x+=7-r,T.y+=S;if(s==2)T.x+=S,T.y+=r;if(s==3)T.x+=S,T.y+=7-r;return T;}int t(ivec2 y,int i){int x=uS.x*uS.y,g=f(y)+i;if(g>x)g-=x;if(g<0)g+=x;if(g>x)return-1;if(g<0)return-2;return g;}void main(){ivec2 y=ivec2(gl_FragCoord);if(uY)y.y=uS.y-y.y-1;int g=t(y,uO);if(g>=0)y=i(g),gl_FragColor=texture2D(uT,(vec2(y)+.5)/vec2(uS));else gl_FragColor=vec4(1.,0.,0.,1.);}"},N6zH:e=>{"use strict";e.exports="attribute vec2 aVertex;\nvarying highp vec2 vTextureCoord;\n\nvoid main(void) {\n\tgl_Position = vec4(aVertex,0.0,1.0);\n\tvTextureCoord = aVertex*0.5+0.5;\n}\n"},MCYI:e=>{"use strict";e.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureIcon;\nuniform float uAlpha;\nuniform vec2 uScale;\n\n#pragma include "utils/functions.glsl"\n\nvoid main() {\n    vec2 uvCenter = vTexCoord0 * 2.0 - 1.0;\n\n    vec4 icon = texture2D(uTextureIcon, vTexCoord0 * uScale * 10.0);\n\n    float alpha = uAlpha * icon.a * clamp(1.0 - dot(uvCenter, uvCenter), 0.0, 1.0);\n\n    icon.rgb *= alpha;\n    icon.rgb = linearTosRGB(icon.rgb);\n    gl_FragColor = vec4(icon.rgb, alpha);\n}\n'},"Xr/U":e=>{"use strict";e.exports="attribute vec3 Vertex;\n\nattribute vec2 TexCoord0;\nvarying vec2 vTexCoord0;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},Og9V:e=>{"use strict";e.exports='\n#pragma include "shadowing/shadowReceive.glsl"\n\nvarying vec3 vModelNormal;\nvarying vec3 vModelVertex;\n\nvoid main() {\n    vec3 modelNormal = normalize(gl_FrontFacing ? vModelNormal : -vModelNormal);\n    #ifdef _ATLAS_SHADOW\n        float shadow = shadowReceive(true, modelNormal, vModelVertex, Texture7, uShadow_Texture0_renderSize, uShadow_Texture0_projection, uShadow_Texture0_viewRight, uShadow_Texture0_viewUp, uShadow_Texture0_viewLook, uShadow_Texture0_depthRange, uShadowReceive0_bias, uShadow_Texture0_mapSize, uStaticFrameNumShadow0);\n    #else\n        float shadow = shadowReceive(true, modelNormal, vModelVertex, Texture12, uShadow_Texture0_renderSize, uShadow_Texture0_projection, uShadow_Texture0_viewRight, uShadow_Texture0_viewUp, uShadow_Texture0_viewLook, uShadow_Texture0_depthRange, uShadowReceive0_bias, uStaticFrameNumShadow0);\n    #endif\n\n    // not much blending, so no need to convert to srgb\n    // gl_FragColor = vec4(0.0, 0.0, 0.0, linearTosRGB(0.5 - shadow));\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.5 - shadow);\n}\n'},PxxW:e=>{"use strict";e.exports='#pragma include "base.vert"\n'},YVvG:e=>{"use strict";e.exports='varying vec3 vLocalVertex;\n\n// common stuffs\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\nuniform float uEnvironmentExposure;\nuniform float uBackgroundExposure;\n\nuniform vec3 uDiffuseSPH[9];\nuniform samplerCube uTexture0;\nuniform float uSize;\nuniform int uAmbient;\n\nuniform float uFrameModTaaSS;\n\n#pragma include "utils/functions.glsl"\n#pragma include "utils/cubemap.glsl"\n#pragma include "utils/rand.glsl"\n\n// sph env\nvec3 evaluateDiffuseSphericalHarmonics(const in vec3 s[9], const in vec3 n) {\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\n    vec3 result = (s[0]+s[1]*n.y+s[2]*n.z+s[3]*n.x+s[4]*n.y*n.x+s[5]*n.y*n.z+s[6]*(3.0*n.z*n.z-1.0)+s[7]*(n.z*n.x)+s[8]*(n.x*n.x-n.y*n.y));\n    return max(result, vec3(0.0));\n}\n\nvoid main(void) {\n\n    vec3 color;\n    if (uAmbient == 1) {\n        vec3 normal = normalize(vLocalVertex + mix(-0.5/255.0, 0.5/255.0, pseudoRandom(gl_FragCoord.xy))*2.0);\n        // vec3 normal = normalize(vLocalVertex + (interleavedGradientNoise(gl_FragCoord.xy, uFrameModTaaSS) - 0.5) * 0.4);\n        color = evaluateDiffuseSphericalHarmonics(uDiffuseSPH, normal);\n    } else {\n        color = textureCubeFixed(uTexture0, normalize(vLocalVertex), uSize);\n    }\n\n    color *= uEnvironmentExposure * uBackgroundExposure;\n\n    if (uOutputLinear == 0 ) color = linearTosRGB(color);\n\n    gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'},pts4:e=>{"use strict";e.exports="attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform vec4 uHalton;\nuniform vec2 uGlobalTexSize;\nuniform vec2 uGlobalTexRatio;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void)\n{\n    vLocalVertex = Vertex.rgb;\n\n    mat4 projectionMatrix = uProjectionMatrix;\n    vec2 halt = uGlobalTexRatio.xy * uHalton.xy / uGlobalTexSize.xy;\n    projectionMatrix[2][0] += halt.x;\n    projectionMatrix[2][1] += halt.y;\n\n    gl_Position = (projectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0))).xyww;\n}\n"},cVj4:e=>{"use strict";e.exports='uniform float uDisplay2D;\nuniform float uPointSize;\n\nuniform vec2 uGlobalTexRatio;\nuniform vec2 uGlobalTexSize;\nuniform vec4 uHalton;\n\nuniform mat3 uModelNormalMatrix;\nuniform mat3 uModelViewNormalMatrix;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uModelViewMatrix;\n\n// in case of srgbToLinear texfetch\n#ifdef HAS_DISPLACEMENT\n#pragma include "utils/functions.glsl"\n#endif\n\n#ifdef IS_IOS\ninvariant gl_Position;\n#endif\n\n\n#if defined(HAS_COMPRESSION) && !defined(HAS_MORPHING)\n    #define HAS_POSITION_COMPRESSION\n#endif\n\n/////////////////////////////////////\n// ATTRIBUTES (NORMAL/VERTEX/TANGENT)\n/////////////////////////////////////\n\n#ifdef HAS_ZW_COMPRESSION\n    attribute vec4 Vertex;\n#else\n    attribute vec3 Vertex;\n#endif\n\n// need normal to displace vertex\n#if defined(HAS_VIEW_NORMAL) || defined(HAS_MODEL_NORMAL) || defined(HAS_SKETCHFAB_DISPLACEMENT)\n\n    #ifdef HAS_POSITION_COMPRESSION\n        attribute vec2 Normal;\n    #else\n        attribute vec3 Normal;\n    #endif\n\n    #define NEED_LOCAL_NORMAL\n#endif\n\n// if no normalmap, correct the normal with displacement (as bump)\n#if defined(HAS_DISPLACEMENT) && !defined(HAS_NORMALMAP) && (defined(HAS_MODEL_NORMAL) || defined(HAS_VIEW_NORMAL))\n    #define CORRECT_BUMP_NORMAL\n#endif\n\n// need tangent to correct normal\n#if defined(HAS_VIEW_TANGENT) || defined(HAS_MODEL_TANGENT) || defined(CORRECT_BUMP_NORMAL)\n\n    #ifdef HAS_POSITION_COMPRESSION\n        attribute vec3 Tangent;\n    #else\n        attribute vec4 Tangent;\n    #endif\n\n    #define NEED_LOCAL_TANGENT\n#endif\n\n#ifdef HAS_VERTEX_COLOR\n    attribute vec4 Color;\n#endif\n\n////////////////////\n// VARYING/VARIABLES\n////////////////////\n\n// view\n#ifdef HAS_VIEW_VERTEX\n    varying vec4 vViewVertex;\n#else\n    vec4 vViewVertex;\n#endif\n\n#ifdef HAS_VIEW_NORMAL\n    varying vec3 vViewNormal;\n#endif\n\n#ifdef HAS_VIEW_TANGENT\n    varying vec4 vViewTangent;\n#endif\n\n// model\n#if defined(HAS_MODEL_VERTEX)\n    varying vec3 vModelVertex;\n#elif defined(HAS_DISPLACEMENT)\n    vec3 vModelVertex;\n#endif\n\n#if defined(HAS_MODEL_NORMAL)\n    varying vec3 vModelNormal;\n#elif defined(HAS_SKETCHFAB_DISPLACEMENT)\n    vec3 vModelNormal;\n#endif\n\n#if defined(HAS_MODEL_TANGENT)\n    varying vec3 vModelTangent;\n#endif\n\n#ifdef HAS_VERTEX_COLOR\n    varying vec4 vColor;\n    uniform float uArrayColorEnabled;\n#endif\n\n////////////\n// ANIMATION\n////////////\n\n#ifdef HAS_MORPHING\n    uniform vec4 uTargetWeights;\n\n%UNROLL 4%\n    #if NUM_TARGETS > %ID%\n        attribute vec3 Vertex_%ID%;\n        #define ARG_MORPH_VERTEX_%ID% , Vertex_%ID%\n\n        #ifdef HAS_MORPHING_NORMAL\n            attribute vec3 Normal_%ID%;\n            #define ARG_MORPH_NORMAL_%ID% , Normal_%ID%\n        #endif\n\n        #ifdef HAS_MORPHING_TANGENT\n            attribute vec3 Tangent_%ID%;\n            #define ARG_MORPH_TANGENT_%ID% , Tangent_%ID%.xyz\n        #endif\n    #else\n        #define ARG_MORPH_VERTEX_%ID%\n        #define ARG_MORPH_NORMAL_%ID%\n        #define ARG_MORPH_TANGENT_%ID%\n    #endif\n%%\n\n    #pragma include "utils/morphing.glsl"\n#endif\n\n#ifdef HAS_SKINNING\n    #ifndef NUM_BONES\n        #define NUM_BONES 1\n    #endif\n\n    attribute vec4 Bones;\n    attribute vec4 Weights;\n    uniform vec4 uBones[NUM_BONES];\n\n    #pragma include "utils/skinning.glsl"\n#endif\n\n#ifdef HAS_DISPLACEMENT\n    uniform float uDisplacementFactor;\n#endif\n\n#ifdef CORRECT_BUMP_NORMAL\n    uniform float uDisplacementNormal;\n    uniform vec2 uDisplacementSize;\n    #pragma include "utils/normalBump.glsl"\n#endif\n\n#ifdef HAS_POSITION_COMPRESSION\n    uniform vec3 uQVT;\n    uniform vec3 uQVS;\n\n    #ifdef HAS_OCT_COMPRESSION\n        #define UNCOMPRESS_DIR(n) n.z = 1.0 - abs(n.x) - abs(n.y); n.xy = n.z >= 0.0 ? n.xy : (1.0 - abs(n.yx)) * sign(n.xy);\n    #else\n        #define UNCOMPRESS_DIR(n) n.z = dot(n.xy, n.xy); n.xyz = vec3(2.0 * n.xy * sqrt(1.0 - n.z), 1.0 - 2.0 * n.z);\n    #endif\n#endif\n\n// attribute -> morph -> skin -> model -> displace -> view -> screen\n// localVertex = skin(morph(Vertex))\n// modelVertex = displacement(modelMatrix * localVertex)\n// viewVertex = viewMatrix * modelVertex\n\nvoid main() {\n#ifdef ASSIGN_UV\n    ASSIGN_UV\n#endif\n\n#ifdef HAS_VERTEX_COLOR\n    vColor = uArrayColorEnabled == 1.0 ? Color : vec4(1.0);\n#endif\n\n#ifdef HAS_SKINNING\n    mat4 boneMatrix = skinning(Weights, Bones);\n#endif\n\n    /////////////////////\n    // LOCAL/MODEL VERTEX\n    /////////////////////\n    vec3 localVertex = Vertex.xyz;\n#ifdef HAS_POSITION_COMPRESSION\n    #ifdef HAS_ZW_COMPRESSION\n        localVertex += Vertex.w;\n    #endif\n    localVertex = localVertex * uQVS RAND_SCALE + uQVT;\n#endif\n\n#ifdef HAS_MORPHING\n    localVertex = morphing(uTargetWeights, localVertex ARG_MORPH_VERTEX_0 ARG_MORPH_VERTEX_1 ARG_MORPH_VERTEX_2 ARG_MORPH_VERTEX_3);\n#endif\n\n#ifdef HAS_SKINNING\n    localVertex = (vec4(localVertex, 1.0) * boneMatrix).xyz;\n#endif\n\n#if defined(HAS_MODEL_VERTEX) || defined(HAS_DISPLACEMENT)\n    vModelVertex = (uModelMatrix * vec4(localVertex, 1.0)).xyz;\n#endif\n\n#if (defined(NEED_LOCAL_NORMAL) && defined(HAS_MORPHING_NORMAL)) || (defined(NEED_LOCAL_TANGENT) && defined(HAS_MORPHING_TANGENT))\n    // normalize weights for direction morphing\n    vec4 nTargetWeights = abs(uTargetWeights);\n    nTargetWeights = uTargetWeights / max(1.0, nTargetWeights.x + nTargetWeights.y + nTargetWeights.z + nTargetWeights.w);\n#endif\n\n    /////////\n    // NORMAL\n    /////////\n#ifdef NEED_LOCAL_NORMAL\n    #ifdef HAS_POSITION_COMPRESSION\n        vec3 localNormal = Normal.xyy;\n        UNCOMPRESS_DIR(localNormal);\n    #else\n        vec3 localNormal = Normal;\n    #endif\n\n    #ifdef HAS_MORPHING_NORMAL\n        localNormal = morphing(nTargetWeights, localNormal ARG_MORPH_NORMAL_0 ARG_MORPH_NORMAL_1 ARG_MORPH_NORMAL_2 ARG_MORPH_NORMAL_3);\n    #endif\n\n    #ifdef HAS_SKINNING\n        localNormal = (vec4(localNormal, 0.0) * boneMatrix).xyz;\n    #endif\n\n    #if defined(HAS_MORPHING) || defined(HAS_SKINNING)\n        localNormal.xyz = normalize(localNormal);\n    #endif\n\n    #if defined(HAS_MODEL_NORMAL) || defined(HAS_SKETCHFAB_DISPLACEMENT)\n        vModelNormal = uModelNormalMatrix * localNormal;\n    #endif\n\n    // view normal computed later if we need to correct it (displacement)\n    #if defined(HAS_VIEW_NORMAL) && !defined(CORRECT_BUMP_NORMAL)\n        vViewNormal = uModelViewNormalMatrix * localNormal;\n    #endif\n#endif\n\n    //////////\n    // TANGENT\n    //////////\n#ifdef NEED_LOCAL_TANGENT\n    #ifdef HAS_POSITION_COMPRESSION\n        vec4 localTangent = Tangent.xyzz;\n        UNCOMPRESS_DIR(localTangent);\n    #else\n        vec4 localTangent = Tangent;\n    #endif\n\n    #ifdef HAS_MORPHING_TANGENT\n        localTangent.xyz = morphing(nTargetWeights, localTangent.xyz ARG_MORPH_TANGENT_0 ARG_MORPH_TANGENT_1 ARG_MORPH_TANGENT_2 ARG_MORPH_TANGENT_3);\n    #endif\n\n    #ifdef HAS_SKINNING\n        localTangent.xyz = (vec4(localTangent.xyz, 0.0) * boneMatrix).xyz;\n    #endif\n\n    #if defined(HAS_MORPHING) || defined(HAS_SKINNING)\n        localTangent.xyz = normalize(localTangent.xyz);\n    #endif\n\n    #ifdef HAS_MODEL_TANGENT\n        vModelTangent = vec4(uModelNormalMatrix * localTangent.xyz, localTangent.w).xyz;\n    #endif\n\n    #ifdef HAS_VIEW_TANGENT\n        vViewTangent = vec4(uModelViewNormalMatrix * localTangent.xyz, localTangent.w);\n    #endif\n#endif\n\n    //////////////////\n    // DISPLACE VERTEX\n    //////////////////\n#ifdef HAS_DISPLACEMENT\n    // we multiply by 1 - uDisplay2D here as we don\'t want the displacement to appear in the 2D view of the inspector\n    float displacement = (COLOR_CONVERT_DISPLACEMENT(texture2D(SAMPLER_DISPLACEMENT, UV_DISPLACEMENT).PACK_DISPLACEMENT) - 0.5) * uDisplacementFactor * (1.0 - uDisplay2D);\n    #ifdef HAS_SKETCHFAB_DISPLACEMENT\n        vModelVertex += normalize(vModelNormal) * displacement;\n    #else\n        vModelVertex += vec3(0.0, 0.0, 1.0) * (vModelVertex.z > 0.01 ? displacement : 0.0);\n    #endif\n    vViewVertex = uViewMatrix * vec4(vModelVertex, 1.0);\n#else\n    vViewVertex = uModelViewMatrix * vec4(localVertex, 1.0);\n#endif\n\n    //////////////////\n    // DISPLACE NORMAL\n    //////////////////\n#ifdef CORRECT_BUMP_NORMAL\n    // if there is no normal map, use displacement to correct normal\n    vec3 invSize = vec3(1.0 / uDisplacementSize, 0.0);\n    vec2 gradient = vec2(COLOR_CONVERT_DISPLACEMENT(texture2D(SAMPLER_DISPLACEMENT, UV_DISPLACEMENT - invSize.xz).PACK_DISPLACEMENT)\n                        - COLOR_CONVERT_DISPLACEMENT(texture2D(SAMPLER_DISPLACEMENT, UV_DISPLACEMENT + invSize.xz).PACK_DISPLACEMENT),\n                        COLOR_CONVERT_DISPLACEMENT(texture2D(SAMPLER_DISPLACEMENT, UV_DISPLACEMENT - invSize.zy).PACK_DISPLACEMENT)\n                        -COLOR_CONVERT_DISPLACEMENT(texture2D(SAMPLER_DISPLACEMENT, UV_DISPLACEMENT + invSize.zy).PACK_DISPLACEMENT));\n\n    localNormal = bumpMap(localTangent, localNormal, uDisplacementNormal * gradient);\n\n    #if defined(HAS_VIEW_NORMAL)\n        vModelNormal = uModelNormalMatrix * localNormal;\n    #endif\n\n    #ifdef HAS_VIEW_NORMAL\n        vViewNormal = uModelViewNormalMatrix * localNormal;\n    #endif\n#endif\n\n    ///////////////////////\n    // PROJECTION JITTERING (could be done on the CPU)\n    ///////////////////////\n    mat4 jitteredProjection = uProjectionMatrix;\n#if defined(WIREFRAME)\n    vViewVertex.w += 0.005 / uProjectionMatrix[1][1];\n#elif defined(SHADOW_CAST)\n    float doPersp = jitteredProjection[3][3] == 0.0 ? 1.0 : 0.0;\n    vec2 jitter = (abs(uHalton.z) == 2.0 ? 1.0 : 0.0) * (uHalton.xy / uShadowMapSize.xy);\n    jitteredProjection[2].xy += doPersp * jitter;\n    jitteredProjection[3].xy += (1.0 - doPersp) * jitter;\n#elif !defined(NO_JITTER)\n    jitteredProjection[2].xy += (1.0 - uDisplay2D) * (uHalton.xy * uGlobalTexRatio.xy / uGlobalTexSize.xy);\n#endif\n\n    #ifdef HAS_POLYGON_OFFSET\n        vViewVertex.z -= vViewVertex.z *  0.001;\n    #endif\n\n    gl_Position = jitteredProjection * vViewVertex;\n\n#ifdef HAS_POINT_SIZE\n    gl_PointSize = min(64.0, max(1.0, -uPointSize / vViewVertex.z));\n#else\n    gl_PointSize = 1.0;\n#endif\n\n// probably not the best solution (in case you need custom things while including base.vert)\n#ifdef INJECT_VERT\n    INJECT_VERT\n#endif\n}\n'},IJ4l:e=>{"use strict";e.exports="\nuniform float uAlpha;\n\nuniform vec4 uColor;\n\nuniform float uUp;\nuniform float uDown;\n\n#ifdef ICON\n    uniform sampler2D uTextureIcon;\n    varying vec2 vTexCoord0;\n#else\n    varying vec3 pos;\n#endif\n\nvoid main(void) {\n\n    #ifdef ICON\n        gl_FragColor = vec4(uColor.rgb, uAlpha) * texture2D(uTextureIcon, vTexCoord0);\n    #else\n        float alpha = step(pos.x, uUp) * step(uDown, pos.x);\n        gl_FragColor = vec4(uColor.rgb, uAlpha * alpha);\n    #endif\n\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n"},"3CjY":e=>{"use strict";e.exports="attribute vec3 Vertex;\n\n#ifdef ICON\n attribute vec2 TexCoord0;\n varying vec2 vTexCoord0;\n#else\n varying vec3 pos;\n#endif\n\n\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  #ifdef ICON\n    vTexCoord0 = TexCoord0;\n  #else\n    pos = Vertex.xyz;\n  #endif\n\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},"611C":e=>{"use strict";e.exports='uniform float uRGBMRange;\n\nvarying vec3 vViewNormal;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n   gl_FragColor = encodeRGBM(0.5 * vec3(abs(dot(vViewNormal.xyz, vec3(0.3, 0.6, 0.9)))), uRGBMRange);\n}\n'},EVpl:e=>{"use strict";e.exports='#define HAS_VIEW_NORMAL\n#pragma include "base.vert"\n'},JPvX:e=>{"use strict";e.exports="uniform vec3 uColorDebug;\n\nvoid main(void) {\n   gl_FragColor = vec4(uColorDebug, 1.0);\n}\n"},wMJb:e=>{"use strict";e.exports='#define NO_JITTER\n#pragma include "base.vert"\n'},W3fT:e=>{"use strict";e.exports="uniform vec3 uColorDebug;\n\nvoid main(void) {\n   gl_FragColor = vec4(uColorDebug, 1.0);\n}\n"},yYum:e=>{"use strict";e.exports='attribute float Offset;\nuniform float uScale;\n\n#define HAS_MODEL_VERTEX\n#define HAS_MODEL_NORMAL\n\n#define INJECT_VERT gl_Position = uProjectionMatrix * uViewMatrix * vec4(Offset == 1.0 ? vModelVertex + normalize(vModelNormal) * uScale : vModelVertex, 1.0);\n\n#pragma include "base.vert"\n'},pBOM:e=>{"use strict";e.exports="uniform vec3 uBoneColor;\n\nvarying vec3 vViewNormal;\n\nvoid main(void) {\n    vec3 boneColor = uBoneColor * 0.95; // slightingly darker than influence color\n    vec3 boneLinkColor = vec3(max(0.25, abs(dot(normalize(vViewNormal), vec3(0.15, 0.3, 0.9)))));\n    gl_FragColor = vec4(uBoneColor.r < 0.0 ? boneLinkColor : boneColor, 1.0);\n}\n"},"R7V+":e=>{"use strict";e.exports='uniform vec2 uNearFar;\n\n#define NO_JITTER\n#define HAS_VIEW_NORMAL\n#define INJECT_VERT gl_Position.z = -uNearFar.x;\n\n#pragma include "base.vert"\n'},ovGl:e=>{"use strict";e.exports="\nvoid main(void) {\n    gl_FragColor =  vec4(0.2, 0.2, 0.2, 1.0);\n}\n"},Vq6u:e=>{"use strict";e.exports="uniform vec2 uNearFar;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nuniform vec3 uStartPos;\nuniform vec3 uEndPos;\n\n#ifdef IS_IOS\ninvariant gl_Position;\n#endif\nattribute float BoneIndex;\n\nvoid main() {\n\n    vec3 localVertex = uStartPos * (1.0 - BoneIndex) + uEndPos * BoneIndex;\n    vec4 viewVertex = uModelViewMatrix * vec4(localVertex, 1.0);\n    gl_Position = uProjectionMatrix * viewVertex;\n    gl_Position.z = -uNearFar.x;\n\n}\n"},QwJF:e=>{"use strict";e.exports="varying vec3 vBonesColor;\n\nvoid main(void) {\n   gl_FragColor = vec4(vBonesColor, 1.0);\n}\n"},N68w:e=>{"use strict";e.exports='attribute vec3 BonesColor;\nvarying vec3 vBonesColor;\n\n#define NO_JITTER\n#define INJECT_VERT vBonesColor = BonesColor;\n\n#pragma include "base.vert"\n'},BuKJ:e=>{"use strict";e.exports="uniform vec3 uColorDebug;\n\nvoid main(void) {\n   gl_FragColor = vec4(uColorDebug, 1.0);\n}\n"},alNo:e=>{"use strict";e.exports='attribute float Offset;\nuniform float uScale;\n\n#define HAS_MODEL_VERTEX\n#define HAS_MODEL_TANGENT\n\n#define INJECT_VERT gl_Position = uProjectionMatrix * uViewMatrix * vec4(Offset == 1.0 ? vModelVertex + normalize(vModelTangent) * uScale : vModelVertex, 1.0);\n\n#pragma include "base.vert"\n'},"5isI":e=>{"use strict";e.exports='// opacity\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform int uDrawOpaque;\n\nvarying vec4 vViewVertex;\n\n#pragma include "utils/encodeDepth.glsl"\n\n#pragma include "utils/material.glsl"\n\n#ifdef HAS_OPACITY\n#pragma include "utils/rand.glsl"\n#endif\n\nvoid main() {\n#ifdef HAS_DISCARD_OOTB_PIXELS\n    if(vTexCoord0.x > 1.0 || vTexCoord0.x < 0.0 || vTexCoord0.y > 1.0 ||vTexCoord0.y < 0.0) discard;\n#endif\n\n#ifdef HAS_POINT_CIRCLE\n    if (length(2.0 * gl_PointCoord - 1.0) > 1.0) discard;\n#endif\n\n\n#ifdef HAS_ALPHAMASK\n    if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n#endif\n#ifdef HAS_OPACITY_DITHER\n    ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n#endif\n\n    float alpha = 1.0;\n#if defined(HAS_OPACITY_BLEND_OR_ADDITIVE) || defined(HAS_OPACITY_REFRACTION)\n    alpha = getMaterialOpacity();\n    if (uDrawOpaque == 1 && alpha < EPSILON_ALPHA) discard;\n    alpha = uDrawOpaque == 1 ? 1.0 : alpha;\n#endif\n\n    float depth = (-vViewVertex.z - uNearFar.x) / (uNearFar.y - uNearFar.x);\n    float scatter = 0.0;\n    float profile = 0.0;\n\n#ifdef HAS_SUBSURFACESCATTERING\n    scatter = getMaterialScattering();\n    profile = uSubsurfaceScatteringProfile;\n#endif\n\n    gl_FragColor = encodeDepthAlphaProfileScatter(depth, alpha, profile, scatter);\n}\n'},hZRv:e=>{"use strict";e.exports='#define HAS_VIEW_VERTEX\n#pragma include "base.vert"\n'},Q7lG:e=>{"use strict";e.exports="#pragma include \"utils/encodeDecode.glsl\"\n\nuniform sampler2D uShadowMap;\nuniform sampler2D uPrevLightMap;\nuniform float uNumFrames;\nuniform float uTextureSize;\n\nvarying vec4 vProjCoord;\n\nvec4 accumulateShadow(const in vec4 projCoord, const in sampler2D shadowMap, const in sampler2D prevLightMap, const in float numFrames, const in float textureSize ){\n    float depth = decode24(texture2D(shadowMap, projCoord.xy).rgb);\n    float prevShadow = decode24(texture2D(prevLightMap, gl_FragCoord.xy / textureSize).rgb);\n\n\n    // here should be step (projCoord.z, depth) for proper comparison.\n    // but I still have some precision issue I can't sort out for now\n    // step (1.0, depth) is actually putting shadows everywhere the depth has been written, even when behind the ground\n    // It's only a problem for scenes that already have a ground geometry that has been made transparent,\n    // has the shader doesnt take opacity into account.\n    float currentShadow = step (1.0, depth);\n\n    // limits of light frustum\n    if (any(bvec4 ( projCoord.x > 1., projCoord.x < 0., projCoord.y > 1., projCoord.y < 0.))) {\n       currentShadow = 1.0;\n    }\n\n    float s = mix(prevShadow , currentShadow, 1.0 / numFrames);\n    return vec4(encode24(s),1.0);\n}\n\n\nvoid main(void) {\n    gl_FragColor = accumulateShadow(vProjCoord, uShadowMap, uPrevLightMap, uNumFrames, uTextureSize);\n}\n"},"OT+x":e=>{"use strict";e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vProjCoord;\n\nvoid main(void) {\n  gl_Position = vec4(TexCoord0 * 2.0 - 1.0, 0.0, 1.0);\n  vProjCoord = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  vProjCoord = uProjectionMatrix * vProjCoord;\n  vProjCoord = vProjCoord / vProjCoord.w * 0.5 + 0.5;\n}\n"},PhaV:e=>{"use strict";e.exports='#pragma include "utils/encodeDecode.glsl"\n\n// opacity\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform int uDrawOpaque;\n\n#pragma include "utils/material.glsl"\n#ifdef HAS_OPACITY\n#pragma include "utils/rand.glsl"\n#endif\n\nvoid main(void) {\n\n    #ifdef HAS_ALPHAMASK\n        if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n    #endif\n    #ifdef HAS_OPACITY_DITHER\n        ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n    #endif\n\n    #if defined(HAS_OPACITY_BLEND_OR_ADDITIVE) || defined(HAS_OPACITY_REFRACTION)\n        if (getMaterialOpacity() < EPSILON_ALPHA) discard;\n    #endif\n\n    // Depth in clip space\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    gl_FragColor.rgb = encode24(depth);\n    gl_FragColor.a = 1.0;\n\n}\n'},DRy3:e=>{"use strict";e.exports='#pragma include "base.vert"\n'},EJ86:e=>{"use strict";e.exports='#pragma include "utils/encodeDecode.glsl"\n\nuniform float uInvTextureSize;\n\nvec4 adaptativeBoxBlur(){\n    float ao = decode24(TEXTURE_2D_TextureBlur(gTexCoord).rgb);\n    float kernel = 3.0;\n\n    if (ao < 0.2 ){\n        float o = 0.2;\n        ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(-o, o) * uInvTextureSize).rgb);\n        ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(o, o) * uInvTextureSize).rgb);\n        ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(o, -o) * uInvTextureSize).rgb);\n        ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(-o, -o) * uInvTextureSize).rgb);\n        ao *= 0.2;\n        return vec4(ao, ao, ao, 1.0);\n    }\n\n    ao = 0.0;\n\n    // webgl 1.0 goodness, only constant bounds for for loops iteration.\n    if (ao < 0.4 ){\n        kernel = 3.0;\n        for (float i = -1.0; i <= 1.0; i++){\n            for (float j = -1.0; j <= 1.0; j++){\n                ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(i, j) * uInvTextureSize).rgb);\n            }\n        }\n    } else if (ao < 0.6 ){\n        kernel = 7.0;\n        for (float i = -3.0; i <= 3.0; i++){\n            for (float j = -3.0; j <= 3.0; j++){\n                ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(i, j) * uInvTextureSize).rgb);\n            }\n        }\n    } else if (ao < 0.8 ){\n        kernel = 9.0;\n        for (float i = -4.0; i <= 4.0; i++){\n            for (float j = -4.0; j <= 4.0; j++){\n                ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(i, j) * uInvTextureSize).rgb);\n            }\n        }\n    } else if(ao < 1.0 ){\n        kernel = 11.0;\n        for (float i = -5.0; i <= 5.0; i++){\n            for (float j = -5.0; j <= 5.0; j++){\n                ao += decode24(TEXTURE_2D_TextureBlur(gTexCoord + vec2(i, j) * uInvTextureSize).rgb);\n            }\n        }\n    }\n\n    ao /= kernel * kernel;\n\n    return vec4(ao, ao, ao, 1.0);\n}\n'},mN8o:e=>{"use strict";e.exports='#pragma include "utils/encodeDepth.glsl"\nuniform vec2 uNearFar;\nvarying vec4 vViewVertex;\n\nuniform float uGroundFade;\nuniform float uGroundOpacity;\nuniform float uChanging;\n\nvarying vec2 vTexCoord0;\n\n#ifdef PASS_THROUGH\n    float getShadow(){\n       return 1.0;\n    }\n#endif\n\n#ifdef SHADOW_CATCHER\n\n    varying vec3 vModelNormal;\n    varying vec3 vModelVertex;\n\n    #define OPT_DISTANCE\n    #pragma include "shadowing/shadowReceive.glsl"\n\n    #pragma include "utils/getLuminance.glsl"\n\n    %UNROLL 4%\n    #ifdef LIGHT_TYPE_%ID%\n        uniform vec4 uSketchfabLight%ID%_diffuse;\n    #endif\n    %%\n\n\n    float getShadow(){\n        float shadow = 0.0;\n        vec3 modelNormal = normalize(gl_FrontFacing ? vModelNormal : -vModelNormal);\n        bool lighted = true;\n\n        float weight;\n        float sumWeights = 0.0;\n\n        %UNROLL 4%\n        #ifdef LIGHT_TYPE_%ID%\n            #ifdef HAS_SHADOW_%ID%\n                weight = getLuminance(uSketchfabLight%ID%_diffuse.rgb);\n                #ifdef _ATLAS_SHADOW\n                    shadow += weight * shadowReceive(lighted, modelNormal, vModelVertex, Texture7, uShadow_Texture0_renderSize, uShadow_Texture%ID%_projection, uShadow_Texture%ID%_viewRight, uShadow_Texture%ID%_viewUp, uShadow_Texture%ID%_viewLook, uShadow_Texture%ID%_depthRange, uShadowReceive%ID%_bias, uShadow_Texture%ID%_mapSize, OPT_DISTANCE uStaticFrameNumShadow%ID%);\n                #else\n                    shadow += weight * shadowReceive(lighted, modelNormal, vModelVertex, TEX_SHADOW_%ID%, uShadow_Texture%ID%_renderSize, uShadow_Texture%ID%_projection, uShadow_Texture%ID%_viewRight, uShadow_Texture%ID%_viewUp, uShadow_Texture%ID%_viewLook, uShadow_Texture%ID%_depthRange, uShadowReceive%ID%_bias, OPT_DISTANCE uStaticFrameNumShadow%ID%);\n                #endif // _ATLAS_SHADOW\n                sumWeights += weight;\n            #endif // HAS_SHADOW\n        #endif // LIGHT_TYPE\n        %%\n\n        #ifdef HAS_SHADOW\n            shadow /= sumWeights;\n        #else\n            shadow = 1.0;\n        #endif\n\n        return shadow;\n    }\n#endif\n\n#ifdef BAKED_AO\n    #pragma include "utils/encodeDecode.glsl"\n    uniform sampler2D uTexture;\n\n    float getShadow(){\n        return decode24(texture2D(uTexture, vTexCoord0).rgb);\n    }\n#endif\n\n#ifdef DISPLAY_PLANE\n    const float gridSize = 10.0;\n    const vec4 overlayColor = vec4(0.109,0.664,0.848,1.0);\n#endif\n\nuniform float uWidgetFade;\n\nvoid main() {\n    float shadow = getShadow();\n    #ifndef DISPLAY_PLANE\n\t    if (shadow >= 0.99) discard;\n    #endif\n    vec2 centerUV = vTexCoord0 * 2.0 - 1.0;\n    float fade = clamp(1.0 - dot(centerUV, centerUV) * (pow(10.0, uGroundFade) - 1.0) , 0.0, 1.0);\n\n    float alpha = (1.0 - shadow) * uGroundOpacity * fade;\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * uGroundOpacity * fade * alpha;\n\n\n    #ifdef DISPLAY_PLANE\n        float gridValue = clamp(step(0.03,fract(vTexCoord0.x * gridSize))\n            * step(0.03,fract(vTexCoord0.y * gridSize)),0.0,1.0)\n            * step(vTexCoord0.x,0.997)\n            * step(vTexCoord0.y,0.997);\n\n        gl_FragColor = mix(overlayColor * fade, gl_FragColor, uWidgetFade) * vec4(gridValue,gridValue,gridValue,1.0);\n    #endif\n\n}\n'},PJYv:e=>{"use strict";e.exports='#pragma include "base.vert"\n'},HxyN:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform vec3 uColor;\n\nuniform sampler2D uTextureDepth;\nuniform vec2 uGlobalTexSize;\nuniform vec2 uGlobalTexRatio;\nuniform vec2 uNearFar;\n\nconst float BIAS_VISIBILITY = 0.05;\n\nvoid main(void) {\n  float distDepth = distanceToDepth(uTextureDepth, uGlobalTexRatio * gl_FragCoord.xy / uGlobalTexSize, vViewPos, uNearFar);\n  float alpha = distDepth < BIAS_VISIBILITY ? 1.0 : 0.1;\n\n  gl_FragColor = vec4(uColor, 1.0) * texture2D(uTextureHotspot, vTexCoord0);\n  gl_FragColor.a *= alpha;\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n'},gLrx:e=>{"use strict";e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform vec2 uHotspotTextureSize;\nuniform float uHotspotCol;\n\nuniform float uHotspotIndex;\nuniform float uHotspotSize;\nuniform float uHotspotPadding;\n\n\nvoid main(void) {\n  // icon size uHotspotSize (48) pixel width\n  // uHotspotPadding (2) pixel padding between them (mipmapping)\n  vec2 ICON_SIZE = uHotspotSize / vec2(uHotspotTextureSize.x, -uHotspotTextureSize.y);\n  vec2 ICON_AND_PADDING = ICON_SIZE + uHotspotPadding / vec2(uHotspotTextureSize.x, -uHotspotTextureSize.y);\n\n  vec2 offset = vec2(mod(uHotspotIndex, uHotspotCol), floor(uHotspotIndex / uHotspotCol));\n  vTexCoord0 = vec2(TexCoord0.x, 1.0 - TexCoord0.y) * ICON_SIZE + offset * ICON_AND_PADDING;\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n} \n"},"+XBE":e=>{"use strict";e.exports='uniform vec4 uLineColor;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n    vec4 color = sRGBToLinear(uLineColor);\n    color.rgb *= color.a;\n    gl_FragColor = linearTosRGB(color);\n}\n'},T5Q4:e=>{"use strict";e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},WJzN:e=>{"use strict";e.exports='uniform float uRGBMRange;\nuniform int uOutputLinear;\n\n// stuffs (ssr, opacity, scattering)\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform float uTimeViewer;\nuniform int uDrawOpaque;\n\nuniform float uDisplay2D;\nuniform int uInspectorView; // see globalUniforms\n\nuniform float uInspectorFactor;\nuniform int uInspectorInvert;\nuniform float uInspectorMaskThreshold;\nuniform vec3 uInspectorColor;\n\nuniform vec2 uHoverUV;\nuniform int uInspectorSelected;\nuniform int uInspectorWireframe;\n\nfloat pattern(vec2 uv){\n    uv -= 0.5 + uTimeViewer * 3.0;\n    uv *= 15.0;\n    uv.x *= sign(cos(length(ceil(uv)) * 0.1));\n    return cos(min(length(uv = fract(uv)),length(--uv)) * 44.0);\n}\n\n#ifdef FEEDBACK_UV\n    vec3 colorHoverUV(const in vec3 frag) {\n        if (uInspectorSelected == 0) return frag;\n        return mix(vec3(1.0, 0.0, 0.0), frag, smoothstep(0.01, 0.02, distance(FEEDBACK_UV, uHoverUV) / gl_FragCoord.z));\n    }\n#endif\n\n#pragma include "utils/functions.glsl"\n#pragma include "utils/material.glsl"\n#pragma include "utils/rand.glsl"\n\nvoid main() {\n    //////////////////\n    // OPACITY DISCARD\n    //////////////////\n#ifdef HAS_POINT_CIRCLE\n    if (length(2.0 * gl_PointCoord - 1.0) > 1.0) discard;\n#endif\n\n#ifdef HAS_ALPHAMASK\n    if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n#endif\n#ifdef HAS_OPACITY_DITHER\n    if (uDisplay2D == 0.0) ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n#endif\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    float alpha = 1.0;\n    float alphaFinal = 1.0;\n\n    if (uDisplay2D == 0.0) {\n        alpha = getMaterialOpacity();\n        alphaFinal = alpha * float(1 - uOpacityAdditive);\n    }\n\n    if (alpha == 0.0 || (uDrawOpaque == 1 && alphaFinal < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaFinal >= EPSILON_ALPHA)) discard;\n#endif\n\n    ///////////\n    // MATERIAL\n    ///////////\n    vec3 frag = vec3(0.0);\n#ifdef HAS_INSPECTOR\n    frag = uInspectorFactor * COLOR_CONVERT_INSPECTOR(texture2D(SAMPLER_INSPECTOR, UV_INSPECTOR).PACK_INSPECTOR);\n    if (uInspectorInvert == 1) frag = 1.0 - frag;\n\n    if (uInspectorMaskThreshold > 0.0 && uDisplay2D == 0.0) frag = frag.x < uInspectorMaskThreshold ? vec3(0.0) : vec3(1.0);\n\n    #ifdef HAS_VERTEX_COLOR\n        #ifdef HAS_VERTEX_ALPHA\n            frag *= getVertexColor();\n        #else\n            frag *= uInspectorView == 1 ? sRGBToLinear(vColor.aaa) : getVertexColor();\n        #endif\n    #endif\n\n    // we want to display the linear textures as srgb textures, see comment in channelFactoryViewModel\n    #ifdef CONVERT_INSPECTOR_TO_LINEAR\n        frag = sRGBToLinear(frag);\n    #endif\n\n    #ifdef HAS_INSPECTOR_TEXTURE\n        frag *= uInspectorColor;\n    #endif\n\n    frag = colorHoverUV(frag);\n#endif\n\n    // premult\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    frag *= alpha;\n#endif\n\n    if (uOutputLinear != 1) frag = linearTosRGB(frag);\n\n    if (uDisplay2D == 1.0) {\n        #if defined(HAS_INSPECTOR) && defined(DISPLAY_WATERMARK)\n            float w = 0.08 - float(pattern(UV_INSPECTOR)) * 0.08;            \n            vec3 fragColor2 =  COLOR_CONVERT_INSPECTOR(texture2D(SAMPLER_INSPECTOR, UV_INSPECTOR, 2.5).PACK_INSPECTOR);\n            float d = smoothstep(length(UV_INSPECTOR - uHoverUV), 0.0, 0.15);\n            frag = frag * (1.0 - d) + fragColor2.ggg * d *0.75 + w * d + w * 0.1;\n        #endif \n        gl_FragColor = vec4(frag, 1.0);\n        return;\n    }\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    gl_FragColor = uDrawOpaque == 1 ? encodeRGBM(frag, uRGBMRange) : vec4(frag, alphaFinal);\n#else\n    gl_FragColor = encodeRGBM(frag, uRGBMRange);\n#endif\n}\n'},gBF6:e=>{"use strict";e.exports='#pragma include "base.vert"\n'},LTW4:e=>{"use strict";e.exports="uniform int uProjectedWireframe;\nuniform int uInspectorView; // see globalUniforms\nuniform vec4 uColor;\n\nvarying vec4 vColor;\n\nvoid main() {\n    gl_FragColor = uProjectedWireframe == 1 ? vec4(uColor.rgb * uColor.a, uColor.a) : vec4(uInspectorView == 1 ? vColor.aaa : vColor.rgb, 1.0);\n}\n"},PNlk:e=>{"use strict";e.exports="attribute vec2 %UV%;\nattribute vec4 Color;\n\nuniform float uArrayColorEnabled;\nuniform float uPointSize;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vColor;\n\nvoid main() {\n    vec2 uv = %UV_UNPACK%;\n    gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(uv - 0.5, 1.0, 1.0));\n    gl_PointSize = 1.0;\n    vColor = uArrayColorEnabled == 1.0 ? Color : vec4(1.0, 1.0, 1.0, 1.0);\n}\n"},XZvc:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\n#ifdef HEMI\nuniform vec4 uGround;\nvarying vec3 vLocalVertex;\nuniform float uRadius;\n#endif\n\n#ifdef ICON\nuniform sampler2D uTextureIcon;\nvarying vec2 vTexCoord0;\nuniform int uEnable;\n#endif\n\nvarying vec4 vViewPos;\nuniform vec2 uNearFar;\nuniform sampler2D uTextureDepth;\nuniform vec2 uGlobalTexSize;\nuniform vec2 uGlobalTexRatio;\n\nuniform vec4 uColor;\n\nvoid main(void) {\n  float distDepth = distanceToDepth(uTextureDepth, uGlobalTexRatio * gl_FragCoord.xy / uGlobalTexSize, vViewPos, uNearFar);\n  float alpha = distDepth < 0.0 ? 1.0 : 0.1;\n\n  // handles colors with values higher than 1\n  vec3 normColor = uColor.rgb / max(max(1.0, uColor.r), max(uColor.g, uColor.b));\n\n#ifdef HEMI\n  gl_FragColor = vec4(mix(uGround.rgb, normColor, vLocalVertex.z / uRadius), alpha);\n#endif\n\n#ifdef LINE\n  gl_FragColor = vec4(normColor, alpha);\n#endif\n\n#ifdef ICON\n  gl_FragColor = vec4(float(uEnable) * normColor, alpha) * texture2D(uTextureIcon, vTexCoord0);\n#endif\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n\n  gl_FragColor.rgb = sRGBToLinear(gl_FragColor.rgb);\n}\n'},"82Lz":e=>{"use strict";e.exports="#ifdef ICON\nattribute vec2 TexCoord0;\nvarying vec2 vTexCoord0;\n#endif\n\n#ifdef HEMI\nvarying vec3 vLocalVertex;\n#endif\n\nattribute vec3 Vertex;\n\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n#ifdef ICON\n  vTexCoord0 = TexCoord0;\n#endif\n\n#ifdef HEMI\n  vLocalVertex = Vertex;\n#endif\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"},DVv7:e=>{"use strict";e.exports='uniform float uRGBMRange;\nuniform int uOutputLinear;\n\n// stuffs (ssr, opacity, scattering)\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform int uDrawOpaque;\n\nuniform vec3 uMatcapColor;\n\nuniform int uInspectorView; // see globalUniforms\n\n//////////\n// VARYING\n//////////\nvarying vec4 vViewVertex;\nvarying vec3 vViewNormal;\n\n#ifdef HAS_VIEW_TANGENT\nvarying vec4 vViewTangent;\n#endif\n\n#pragma include "utils/common.glsl"\n\n#pragma include "utils/functions.glsl"\n\n#pragma include "utils/material.glsl"\n\n#pragma include "utils/curvature.glsl"\n\n// TODO ifdef around pragma include can result in error (files being included multiple times can be ignored)\n#pragma include "utils/decodeDepth.glsl"\n\n#pragma include "utils/rand.glsl"\n\n#ifdef HAS_VIEW_TANGENT\n#pragma include "utils/normalBump.glsl"\n#endif\n\n#ifdef HAS_OPACITY_REFRACTION\n#pragma include "utils/refraction.glsl"\n#endif\n\nvoid main() {\n    //////////////////\n    // OPACITY DISCARD\n    //////////////////\n#ifdef HAS_POINT_CIRCLE\n    if (length(2.0 * gl_PointCoord - 1.0) > 1.0) discard;\n#endif\n\n#ifdef HAS_ALPHAMASK\n    if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n#endif\n#ifdef HAS_OPACITY_DITHER\n    ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n#endif\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    float alpha = getMaterialOpacity();\n    float alphaFinal = alpha * float(1 - uOpacityAdditive);\n    if (alpha == 0.0 || (uDrawOpaque == 1 && alphaFinal < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaFinal >= EPSILON_ALPHA)) discard;\n#endif\n\n// /!\\ because of refraction roughness, this part should be done before the call to getMetalness/getSpecular\n#ifdef HAS_OPACITY_REFRACTION\n    gRefractionRoughness = uOpacityRoughnessFactor;\n    float alphaRefraction = getMaterialOpacity();\n    if ((uDrawOpaque == 1 && alphaRefraction < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaRefraction >= EPSILON_ALPHA)) discard;\n#endif\n\n    ///////////\n    // GEOMETRY\n    ///////////\n    vec3 eyeVector = -normalize(vViewVertex.xyz);\n    vec3 frontNormal = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n\n#ifdef HAS_VIEW_TANGENT\n    vec4 tangent = gl_FrontFacing ? vViewTangent : -vViewTangent;\n    tangent.xyz = normalize(tangent.xyz);\n    vec3 binormal = normalize(cross(frontNormal, tangent.xyz)) * tangent.w;\n#endif\n\n    ///////////\n    // MATERIAL\n    ///////////\n    vec3 materialNormal = frontNormal;\n#ifdef HAS_NORMALMAP\n    materialNormal = getMaterialNormalMap();\n    materialNormal = transformNormal(uNormalMapFactor, materialNormal, tangent.xyz, binormal, frontNormal);\n#endif\n\n#ifdef HAS_BUMPMAP\n    materialNormal = transformBump(getMaterialBumpMap(), tangent.xyz, binormal, frontNormal);\n#endif\n\n    vec3 materialDiffuse = uMatcapColor;\n#ifdef HAS_VERTEX_COLOR\n    materialDiffuse *= getVertexColor();\n#endif\n\n    vec3 nm_x = vec3(-eyeVector.z, 0.0, eyeVector.x);\n    vec3 nm_y = cross(nm_x, eyeVector);\n    vec2 uvMatcap = vec2(dot(materialNormal.xz, -nm_x.xz), dot(materialNormal, nm_y)) * 0.5 + 0.5;\n    vec3 diffuse = materialDiffuse * sRGBToLinear(texture2D(SAMPLER_MATCAP, uvMatcap).rgb) * getCurvature(materialNormal);\n\n    /////////////\n    // REFRACTION\n    /////////////\n#ifdef HAS_OPACITY_REFRACTION\n\n#ifdef HAS_REFRACTION_NORMAL_OFFSET\n    vec3 refractLight = refraction(uOpacityRoughnessFactor, materialNormal, frontNormal, eyeVector.xyz);\n#else\n    vec3 refractLight = refraction(uOpacityRoughnessFactor, materialNormal, eyeVector);\n#endif\n\n#ifdef HAS_REFRACTION_ALBEDO_TINT\n    refractLight *= materialDiffuse;\n#endif\n\n    diffuse = mix(refractLight, diffuse, alphaRefraction);\n#endif // HAS_OPACITY_REFRACTION\n\n    vec3 frag = diffuse;\n\n    if (uInspectorView == 2) {\n        frag = vec3(0.9, 0.75, 0.5) * max(0.25, dot(materialNormal.xyz, vec3(0.15, 0.3, 0.9)));\n    }\n\n// premult\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    frag *= alpha;\n#endif\n\n    if (uOutputLinear != 1) frag = linearTosRGB(frag);\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    gl_FragColor = uDrawOpaque == 1 ? encodeRGBM(frag, uRGBMRange) : vec4(frag, alphaFinal);\n#else\n    gl_FragColor = encodeRGBM(frag, uRGBMRange);\n#endif\n}\n'},CR0n:e=>{"use strict";e.exports='#define HAS_VIEW_NORMAL\n#define HAS_VIEW_VERTEX\n#pragma include "base.vert"\n'},"47H3":e=>{"use strict";e.exports="uniform sampler2D uTexture0;\nuniform sampler2D uTexture1;\nuniform sampler2D uTexture2;\nuniform sampler2D uTexture3;\n\n// vec4 (up to 4 textures input)\n// int meaning :\n// 0 -> read R\n// 1 -> read A\n// 2 -> read RGB\n// 3 -> read AAA\n// 4 -> read RG\nuniform ivec4 uReadPacking;\n\nvarying vec2 vTexCoord0;\n\nvoid main(void) {\n    if (uReadPacking.x == 4) {\n        gl_FragColor.rg = texture2D(uTexture0, vTexCoord0).rg;\n        if (uReadPacking.y == 4) {\n            gl_FragColor.ba = texture2D(uTexture1, vTexCoord0).rg;\n        } else {\n            gl_FragColor.b = uReadPacking.y == 0 ? texture2D(uTexture1, vTexCoord0).r : texture2D(uTexture1, vTexCoord0).a;\n            gl_FragColor.a = uReadPacking.z == 0 ? texture2D(uTexture2, vTexCoord0).r : texture2D(uTexture2, vTexCoord0).a;\n        }\n\n    } else if (uReadPacking.x == 3) {\n        // 1 rgb, 1 greyscale\n        gl_FragColor.rgb = texture2D(uTexture0, vTexCoord0).aaa;\n        gl_FragColor.a = uReadPacking.y == 0 ? texture2D(uTexture1, vTexCoord0).r : texture2D(uTexture1, vTexCoord0).a;\n\n    } else if (uReadPacking.x == 2) {\n        // 3 aaa, 1 greyscale\n        gl_FragColor.rgb = texture2D(uTexture0, vTexCoord0).rgb;\n        gl_FragColor.a = uReadPacking.y == 0 ? texture2D(uTexture1, vTexCoord0).r : texture2D(uTexture1, vTexCoord0).a;\n\n    } else {\n        // 4 greyscales\n        gl_FragColor.r = uReadPacking.x == 0 ? texture2D(uTexture0, vTexCoord0).r : texture2D(uTexture0, vTexCoord0).a;\n        gl_FragColor.g = uReadPacking.y == 0 ? texture2D(uTexture1, vTexCoord0).r : texture2D(uTexture1, vTexCoord0).a;\n        gl_FragColor.b = uReadPacking.z == 0 ? texture2D(uTexture2, vTexCoord0).r : texture2D(uTexture2, vTexCoord0).a;\n        gl_FragColor.a = uReadPacking.w == 0 ? texture2D(uTexture3, vTexCoord0).r : texture2D(uTexture3, vTexCoord0).a;\n    }\n}"},GpBa:e=>{"use strict";e.exports="attribute vec3 Vertex;\nvarying vec2 vTexCoord0;\n\nvoid main(void) {\n    gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);\n    vTexCoord0 = Vertex.xy;\n}\n"},rGsq:e=>{"use strict";e.exports="uniform vec4 uColor;\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vec4( vec3(vColor) * uColor.a, uColor.a);\n}\n"},"4HDP":e=>{"use strict";e.exports="attribute vec3 Vertex;\nattribute vec4 Color;\nvarying vec4 vColor;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n    vColor = Color;\n    gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"},gspP:e=>{"use strict";e.exports="uniform vec4 uColor;\n\nvoid main(void) {\n  gl_FragColor = vec4(uColor.xyz * uColor.a, uColor.a);\n}\n"},WIUU:e=>{"use strict";e.exports="attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"},m5qG:e=>{"use strict";e.exports="uniform vec3 uOutlineColor;\n\nvoid main() {\n#ifdef HAS_POINT_CIRCLE\n    if (length(2.0 * gl_PointCoord - 1.0) > 1.0) discard;\n#endif\n\n    gl_FragColor = vec4(uOutlineColor, 1.0);\n}\n"},OVPj:e=>{"use strict";e.exports='#define NO_JITTER 1\n#pragma include "base.vert"\n'},xcv8:e=>{"use strict";e.exports='uniform float uRGBMRange;\nuniform int uOutputLinear;\n\n// stuffs (ssr, opacity, scattering)\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform int uDrawOpaque;\n\n// shadow signature...\n#ifdef HAS_SUBSURFACETRANSLUCENCY\n    #define _OUT_DISTANCE\n    #define OPT_DISTANCE shadowDistance,\n#else\n    #define OPT_DISTANCE\n#endif\n\n//////////\n// VARYING\n//////////\nvarying vec4 vViewVertex;\nvarying vec3 vViewNormal;\n\n#ifdef HAS_SHADOW\n    varying vec3 vModelNormal;\n    varying vec3 vModelVertex;\n#endif\n\n#ifdef HAS_VIEW_TANGENT\n    varying vec4 vViewTangent;\n#endif\n\n#pragma include "utils/common.glsl"\n\n#pragma include "utils/functions.glsl"\n\n#pragma include "utils/material.glsl"\n\n// TODO ifdef around pragma include can result in error (files being included multiple times can be ignored)\n#pragma include "utils/decodeDepth.glsl"\n\n#pragma include "utils/rand.glsl"\n\n#if defined(HAS_NORMALMAP) || defined(HAS_BUMPMAP) || defined(HAS_CLEARCOATNORMALMAP) || defined(SAMPLER_ANISOTROPY)\n#pragma include "utils/normalBump.glsl"\n#endif\n\n#ifdef HAS_SHADOW\n#pragma include "shadowing/shadowReceive.glsl"\n#endif\n\n// /!\\ (lightsPBR is also included in clearcoat file, and ifdef around pragma include is not reliable)\n#if defined(HAS_LIGHT) || defined(HAS_CLEARCOAT) || defined(HAS_SHEEN)\n#pragma include "utils/lightsPBR.glsl"\n#endif\n\n#ifdef HAS_ENVIRONMENT\n#pragma include "utils/environment.glsl"\n#endif\n\n#ifdef HAS_SUBSURFACETRANSLUCENCY\n#pragma include "utils/lightsSSS.glsl"\n#endif\n\n#ifdef HAS_SUBSURFACESCATTERING\n#pragma include "utils/checkerboard.glsl"\n#endif\n\n#ifdef HAS_CLEARCOAT\n#pragma include "utils/clearCoat.glsl"\n#endif\n\n// #ifdef HAS_OPACITY_DITHER\n// #pragma include "utils/rand.glsl"\n// #endif\n\n#ifdef HAS_OPACITY_REFRACTION\n#pragma include "utils/refraction.glsl"\n#endif\n\n#ifdef HAS_SSR\n#pragma include "utils/ssr.glsl"\n#endif\n\nfloat specularOcclusion(const in int occlude, const in float ao, const in vec3 normal, const in vec3 eyeVector) {\n    if (occlude == 0) return 1.0;\n    // Yoshiharu Gotanda\'s specular occlusion approximation:\n    // cf http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx pg59\n    float d = dot(normal, eyeVector) + ao;\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\n}\n\nfloat adjustRoughnessNormalMap(const in float roughness, const in vec3 normal) {\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\n    float nlen2 = dot(normal, normal);\n    if (nlen2 < 1.0) {\n        float nlen = sqrt(nlen2);\n        float kappa = (3.0 * nlen -  nlen2 * nlen) / (1.0 - nlen2);\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\n        // page 91 : they use 0.5/kappa instead\n        return min(1.0, sqrt(roughness * roughness + 1.0 / kappa));\n    }\n    return roughness;\n}\n\nvec3 computeAnisotropicBentNormal(const in vec3 normal, const in vec3 eyeVector, const in float roughness, const in vec3 anisotropicT, const in vec3 anisotropicB, const in float anisotropy) {\n    vec3 anisotropyDirection = anisotropy >= 0.0 ? anisotropicB : anisotropicT;\n    vec3 anisotropicTangent = cross(anisotropyDirection, eyeVector);\n    vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);\n    float bendFactor = abs(anisotropy) * clamp(5.0 * roughness, 0.0, 1.0);\n    return normalize(mix(normal, anisotropicNormal, bendFactor));\n}\n\nvoid main() {\n\n#ifdef HAS_DISCARD_OOTB_PIXELS\n      if(vTexCoord0.x > 1.0 || vTexCoord0.x < 0.0 || vTexCoord0.y > 1.0 ||vTexCoord0.y < 0.0) discard;\n#endif\n\n    //////////////////\n    // OPACITY DISCARD\n    //////////////////\n#ifdef HAS_POINT_CIRCLE\n    if (length(2.0 * gl_PointCoord - 1.0) > 1.0) discard;\n#endif\n\n#ifdef HAS_ALPHAMASK\n    if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n#endif\n#ifdef HAS_OPACITY_DITHER\n    ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n#endif\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    float alpha = getMaterialOpacity();\n    float alphaFinal = alpha * float(1 - uOpacityAdditive);\n    if (alpha == 0.0 || (uDrawOpaque == 1 && alphaFinal < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaFinal >= EPSILON_ALPHA)) discard;\n#endif\n\n    // /!\\ because of refraction roughness, this part should be done before the call to getMetalness/getSpecular\n#ifdef HAS_OPACITY_REFRACTION\n    gRefractionRoughness = uOpacityRoughnessFactor;\n    float alphaRefraction = getMaterialOpacity();\n    if ((uDrawOpaque == 1 && alphaRefraction < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaRefraction >= EPSILON_ALPHA)) discard;\n#endif\n\n    ///////////\n    // GEOMETRY\n    ///////////\n    // https://twitter.com/pyalot/status/711956736639418369\n    vec3 eyeVector = -normalize(vViewVertex.xyz);\n    vec3 frontNormal = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n\n#ifdef HAS_VIEW_TANGENT\n    vec4 tangent;\n    tangent = vViewTangent;\n\n    tangent = gl_FrontFacing ? tangent : -tangent;\n    tangent.xyz = normalize(tangent.xyz);\n    vec3 binormal = normalize(cross(frontNormal, tangent.xyz)) * tangent.w;\n#elif  HAS_NORMALMAP && COMPUTE_FRAGMENT_TANGENTS\n    vec4 tangent; \n    vec3 binormal;\n    makeTBN(tangent, binormal, vViewNormal, vViewVertex.xyz, vTexCoord0);\n#endif\n\n    ///////////\n    // MATERIAL\n    ///////////\n#if defined(HAS_LEGACY_CLASSIC)\n    vec3 materialDiffuse = getMaterialLegacyDiffuse();\n    vec3 materialSpecular = getMaterialLegacySpecular();\n#elif defined(HAS_METALNESSPBR)\n    float f0 = 0.08 * getMaterialF0();\n    float metal = getMaterialMetalness();\n\n    #ifdef HAS_OPACITY_REFRACTION\n        metal *= alphaRefraction;\n    #endif\n\n    vec3 materialDiffuse = getMaterialAlbedo();\n    vec3 materialSpecular = mix(vec3(f0), materialDiffuse, metal);\n    materialDiffuse *= 1.0 - metal;\n#else\n    vec3 materialSpecular = getMaterialSpecular();\n    vec3 materialDiffuse = getMaterialDiffuse();\n\n    #ifdef HAS_OPACITY_REFRACTION\n        materialSpecular *= mix(0.08, 1.0, alphaRefraction);\n    #endif\n#endif // HAS_METALNESSPBR\n\n#if defined(HAS_ENVIRONMENT) || defined(HAS_LIGHT)\n    float materialF90 = clamp(50.0 * materialSpecular.g, 0.0, 1.0);\n#endif\n\n#if defined(HAS_LEGACY_CLASSIC)\n    float materialShininess = getMaterialLegacyShininess();\n    float materialRoughness = 0.0;\n#elif defined(HAS_ROUGHNESSPBR)\n    float materialRoughness = getMaterialRoughness();\n#else\n    float materialRoughness = 1.0 - getMaterialGlossiness();\n#endif // HAS_ROUGHNESSPBR\n\n#ifdef HAS_AOPBR\n    float materialAO = getMaterialAO();\n#endif\n\n#ifdef HAS_EMITCOLOR\n    vec3 materialEmit = getMaterialEmitColor();\n#endif\n\n#ifdef HAS_CAVITYPBR\n    float materialCavity = getMaterialCavity();\n#endif\n\n#ifdef HAS_SUBSURFACETRANSLUCENCY\n    float materialTranslucency = getMaterialTranslucency();\n#endif\n\n    vec3 materialNormal = frontNormal;\n#ifdef HAS_NORMALMAP\n    materialNormal = getMaterialNormalMap();\n    materialRoughness = adjustRoughnessNormalMap(materialRoughness, materialNormal);\n    materialNormal = transformNormal(uNormalMapFactor, materialNormal, tangent.xyz, binormal, frontNormal);\n#endif\n\n#ifdef HAS_BUMPMAP\n    materialNormal = transformBump(getMaterialBumpMap(), tangent.xyz, binormal, frontNormal);\n#endif\n\n#ifdef HAS_CLEARCOAT\n    float materialClearCoat = getMaterialClearCoat();\n    float materialClearCoatRoughness = getMaterialClearCoatRoughness();\n    #ifdef HAS_CLEARCOATNORMALMAP\n        vec3 materialClearCoatNormal = transformNormal(uClearCoatNormalMapFactor, getMaterialClearCoatNormal(), tangent.xyz, binormal, frontNormal);\n    #else\n        vec3 materialClearCoatNormal = frontNormal;\n    #endif\n#endif\n\n#if defined(HAS_ANISOTROPY) && (defined(HAS_LIGHT) || defined(HAS_ENVIRONMENT))\n    float anisotropy = uAnisotropyFactor;\n\n    #ifdef SAMPLER_ANISOTROPY\n        vec2 aniso = getMaterialDirectionAnisotropy();\n        vec3 anisotropicT = transformTangent(aniso, tangent.xyz, binormal);\n        // reproject tangent/binormal on the material normal plane\n        anisotropicT = normalize(anisotropicT - materialNormal * dot(anisotropicT, materialNormal));\n        vec3 anisotropicB = normalize(cross(materialNormal, anisotropicT.xyz));\n\n        anisotropy *= length(aniso);\n    #else\n        #if defined(HAS_NORMALMAP) || defined(HAS_BUMPMAP)\n            // reproject tangent/binormal on the material normal plane\n            tangent.xyz = normalize(tangent.xyz - materialNormal * dot(tangent.xyz, materialNormal));\n            binormal = normalize(cross(materialNormal, tangent.xyz)) * tangent.w;\n        #endif\n\n        vec3 anisotropicT = normalize(mix(tangent.xyz, binormal, uAnisotropyDirection));\n        vec3 anisotropicB = normalize(mix(binormal, -tangent.xyz, uAnisotropyDirection));\n    #endif\n#endif\n\n    vec3 diffuse = vec3(0.0);\n    vec3 specular = vec3(0.0);\n\n#if  (defined(HAS_ENVIRONMENT) || defined(HAS_LIGHT))\n    #if defined(HAS_CLEARCOAT)\n        float ccNoV = saturate(dot(materialClearCoatNormal, -refract(eyeVector, materialClearCoatNormal, 1.0 / uClearCoatIor)));\n    #endif\n    #if defined(HAS_SHEEN)\n        float sheenRoughness = getMaterialSheenRoughness();\n    #endif\n#endif\n    //////////////\n    // ENVIRONMENT\n    //////////////\n#ifdef HAS_ENVIRONMENT\n\n    #ifdef HAS_ANISOTROPY\n        vec3 bentAnisotropicNormal = computeAnisotropicBentNormal(materialNormal, eyeVector, materialRoughness, anisotropicT, anisotropicB, anisotropy);\n    #else\n        vec3 bentAnisotropicNormal = materialNormal;\n    #endif\n\n\n    diffuse = materialDiffuse * computeDiffuseSPH(materialNormal);\n\n    #ifdef HAS_SHEEN\n    diffuse += computeSheen(materialNormal, getSpecularDominantDir(materialNormal, reflect(-eyeVector, materialNormal), sheenRoughness), eyeVector, sheenRoughness);\n    #endif\n\n    #ifdef HAS_LEGACY_CLASSIC\n        specular = materialSpecular * textureCubeFixed(sEnvironmentSpecular, uEnvironmentTransform * normalize((2.0 * clamp(dot(materialNormal, eyeVector), 0.0, 1.0)) * materialNormal - eyeVector), uTextureEnvironmentSpecularTextureSize.x);\n    #else\n        specular = computeIBLSpecularUE4(bentAnisotropicNormal, eyeVector, materialRoughness, materialSpecular, frontNormal, materialF90);\n    #endif\n\n    #ifdef HAS_CLEARCOAT\n        float ccF0 = materialClearCoat * F_Schlick(uClearCoatF0, 1.0, ccNoV);\n        vec3 ccAbsorbtion = getClearCoatAbsorbtion(ccNoV, ccNoV, materialClearCoat);\n        specular = mix(specular * ccAbsorbtion, getPrefilteredEnvMapColor(materialClearCoatNormal, eyeVector, materialClearCoatRoughness, frontNormal), ccF0);\n        diffuse *= ccAbsorbtion * (1.0 - ccF0);\n    #endif\n\n    float aoSpec = 1.0;\n    #ifdef HAS_LEGACY_CLASSIC\n        aoSpec = uReflection;\n        specular *= aoSpec;\n    #endif\n\n    #ifdef HAS_AOPBR\n        diffuse *= uEnvironmentExposure * materialAO;\n        aoSpec = specularOcclusion(uAOPBROccludeSpecular, materialAO, materialNormal, eyeVector);\n        specular *= uEnvironmentExposure * aoSpec;\n    #else\n        diffuse *= uEnvironmentExposure;\n        specular *= uEnvironmentExposure;\n    #endif // HAS_AOPBR\n\n    #ifdef HAS_SSR\n        #ifdef HAS_CLEARCOAT\n            vec3 normalSsr = normalize(mix(bentAnisotropicNormal, materialClearCoatNormal, materialClearCoat * 0.5));\n            float roughnessSsr = mix(materialRoughness, materialClearCoatRoughness, materialClearCoat);\n            vec3 specularSsr = aoSpec * materialSpecular * mix(vec3(1.0), ccAbsorbtion, materialClearCoat);\n            specular = ssr(specular, specularSsr, roughnessSsr, normalSsr, eyeVector);\n        #else\n            specular = ssr(specular, materialSpecular * aoSpec, materialRoughness, bentAnisotropicNormal, eyeVector);\n        #endif\n    #endif // HAS_SSR\n#endif // HAS_ENVIRONMENT\n\n    /////////////////////////\n    // LIGHTING AND SHADOWING\n    /////////////////////////\n#ifdef HAS_LIGHT\n    float attenuation, dotNL;\n    vec3 eyeLightDir;\n    bool lighted;\n    vec3 lightSpecular;\n    vec3 lightDiffuse;\n    vec4 prepGGX = precomputeGGX(materialNormal, eyeVector, max(MIN_ROUGHNESS, materialRoughness));\n\n    #ifdef HAS_CLEARCOAT\n        vec4 prepGGXClearCoat = precomputeGGX(materialClearCoatNormal, eyeVector, materialClearCoatRoughness);\n        vec3 ccSpecular;\n        vec3 ccAttenuation;\n    #endif\n#endif\n\n#ifdef HAS_SHADOW\n    float shadow;\n    vec3 modelNormal = normalize(gl_FrontFacing ? vModelNormal : -vModelNormal);\n\n    #ifdef HAS_SUBSURFACETRANSLUCENCY\n        float shadowDistance;\n    #endif\n#endif // HAS_SHADOW\n\n\n%UNROLL 4%\n#ifdef LIGHT_TYPE_%ID%\n\n    #if LIGHT_TYPE_%ID% == LIGHT_SPOT\n        precomputeSpot(materialNormal, vViewVertex.xyz, uSketchfabLight%ID%_viewDirection, uSketchfabLight%ID%_attenuation, uSketchfabLight%ID%_viewPosition.xyz, uSketchfabLight%ID%_spotCutOff, uSketchfabLight%ID%_spotBlend, attenuation, eyeLightDir, dotNL);\n    #elif LIGHT_TYPE_%ID% == LIGHT_POINT\n        precomputePoint(materialNormal, vViewVertex.xyz, uSketchfabLight%ID%_attenuation, uSketchfabLight%ID%_viewPosition.xyz, attenuation, eyeLightDir, dotNL);\n    #elif LIGHT_TYPE_%ID% == LIGHT_DIRECTION\n        precomputeSun(materialNormal, uSketchfabLight%ID%_viewDirection, attenuation, eyeLightDir, dotNL);\n    #elif LIGHT_TYPE_%ID% == LIGHT_HEMI\n        precomputeSun(materialNormal, uSketchfabLight%ID%_viewDirection, attenuation, eyeLightDir, dotNL);\n    #endif\n\n    #ifdef HAS_LEGACY_CLASSIC\n        #if LIGHT_TYPE_%ID% == LIGHT_HEMI\n            hemiLight(materialNormal, eyeVector, dotNL, eyeLightDir, materialDiffuse, materialSpecular, materialShininess, uSketchfabLight%ID%_diffuse.rgb, uSketchfabLight%ID%_ground.rgb, lightDiffuse, lightSpecular, lighted);\n        #else\n            computeLightLambertCookTorrance(materialNormal, eyeVector, dotNL, attenuation, materialDiffuse, materialSpecular, materialShininess, uSketchfabLight%ID%_diffuse.rgb, uSketchfabLight%ID%_diffuse.rgb, eyeLightDir, lightDiffuse, lightSpecular, lighted);\n        #endif\n    #else\n        #ifdef HAS_ANISOTROPY\n            computeLightLambertGGXAnisotropy(materialNormal, eyeVector, dotNL, prepGGX, materialDiffuse, materialSpecular, attenuation, uSketchfabLight%ID%_diffuse.rgb, eyeLightDir, materialF90, anisotropicT, anisotropicB, anisotropy, lightDiffuse, lightSpecular, lighted);\n        #else\n            computeLightLambertGGX(materialNormal, eyeVector, dotNL, prepGGX, materialDiffuse, materialSpecular, attenuation, uSketchfabLight%ID%_diffuse.rgb, eyeLightDir, materialF90, lightDiffuse, lightSpecular, lighted);\n        #endif\n    #endif\n\n    #ifdef HAS_CLEARCOAT\n        computeLightLambertGGXClearCoat(ccNoV, materialClearCoatNormal, eyeVector, dot(materialClearCoatNormal, eyeLightDir), prepGGXClearCoat, attenuation, uSketchfabLight%ID%_diffuse.rgb, eyeLightDir, materialClearCoat, ccSpecular, ccAttenuation);\n        lightDiffuse *= ccAttenuation;\n        lightSpecular = ccSpecular + lightSpecular * ccAttenuation;\n    #endif\n\n    #ifdef HAS_SHEEN\n        lightDiffuse += computeSheen(materialNormal, eyeLightDir, eyeVector, sheenRoughness);\n    #endif\n\n\n\n    #ifdef HAS_SHADOW_%ID%\n        #ifdef _ATLAS_SHADOW\n            shadow = shadowReceive(lighted, modelNormal, vModelVertex, Texture7, uShadow_Texture0_renderSize, uShadow_Texture%ID%_projection, uShadow_Texture%ID%_viewRight, uShadow_Texture%ID%_viewUp, uShadow_Texture%ID%_viewLook, uShadow_Texture%ID%_depthRange, uShadowReceive%ID%_bias, uShadow_Texture%ID%_mapSize, OPT_DISTANCE uStaticFrameNumShadow%ID%);\n        #else\n            shadow = shadowReceive(lighted, modelNormal, vModelVertex, TEX_SHADOW_%ID%, uShadow_Texture%ID%_renderSize, uShadow_Texture%ID%_projection, uShadow_Texture%ID%_viewRight, uShadow_Texture%ID%_viewUp, uShadow_Texture%ID%_viewLook, uShadow_Texture%ID%_depthRange, uShadowReceive%ID%_bias, OPT_DISTANCE uStaticFrameNumShadow%ID%);\n        #endif // _ATLAS_SHADOW\n\n        lightDiffuse *= shadow;\n        lightSpecular *= shadow;\n\n        #ifdef HAS_SUBSURFACETRANSLUCENCY\n            lightDiffuse += computeLightSSS(dotNL, attenuation, uSubsurfaceTranslucencyThicknessFactor, uSubsurfaceTranslucencyColor, materialTranslucency, shadowDistance, materialDiffuse, uSketchfabLight%ID%_diffuse.rgb);\n        #endif\n    #endif // HAS_SHADOW\n\n    diffuse += lightDiffuse;\n    specular += lightSpecular;\n#endif // LIGHT_TYPE\n%%\n\n    /////////////\n    // REFRACTION\n    /////////////\n#ifdef HAS_OPACITY_REFRACTION\n    #ifdef HAS_REFRACTION_NORMAL_OFFSET\n        vec3 refractLight = refraction(gRefractionRoughness, materialNormal, frontNormal, eyeVector);\n    #else\n        vec3 refractLight = refraction(gRefractionRoughness, materialNormal, eyeVector);\n    #endif\n\n    #ifdef HAS_REFRACTION_ALBEDO_TINT\n        refractLight *= materialDiffuse;\n    #endif\n\n    diffuse = mix(refractLight, diffuse, alphaRefraction);\n#endif // HAS_OPACITY_REFRACTION\n\n    //////////////////////\n    // SCATTERING AND EMIT\n    //////////////////////\n#ifdef HAS_SUBSURFACESCATTERING\n    #ifdef HAS_EMITCOLOR\n        diffuse = uEmitMultiplicative == 1 ? diffuse * materialEmit : diffuse + materialEmit;\n        if (uEmitMultiplicative == 1) specular *= materialEmit;\n    #endif\n    vec3 frag = mix(specular, diffuse, checkerboard(gl_FragCoord.xy, uHalton));\n#else\n    vec3 frag = diffuse + specular;\n    #ifdef HAS_EMITCOLOR\n        frag = uEmitMultiplicative == 1 ? frag * materialEmit : frag + materialEmit;\n    #endif\n#endif // HAS_SUBSURFACESCATTERING\n\n#ifdef HAS_CAVITYPBR\n    frag *= materialCavity;\n#endif\n\n    // premult\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    frag *= alpha;\n#endif\n\n    if (uOutputLinear != 1) frag = linearTosRGB(frag);\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    gl_FragColor = uDrawOpaque == 1 ? encodeRGBM(frag, uRGBMRange) : vec4(frag, alphaFinal);\n#else\n    gl_FragColor = encodeRGBM(frag, uRGBMRange);\n#endif\n}\n'},EjV6:e=>{"use strict";e.exports='#define HAS_VIEW_NORMAL\n#define HAS_VIEW_VERTEX\n#pragma include "base.vert"\n'},Q9ME:e=>{"use strict";e.exports='//original shader : https://www.shadertoy.com/view/lssGDj by @movAX13h\n// Here\'s a little tool for new characters: thrill-project.com/archiv/coding/bitmap/\n\nfloat character(const in float n, vec2 p)\n{\n  p = floor(p*vec2(4.0, -4.0) + 2.5);\n  if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n  {\n      if (int(mod(n/exp2(p.x + 5.0 * p.y), 2.0)) == 1) return 1.5;\n  }\n  return 0.2;\n}\n\nuniform vec2 uTextureInputSize;\n\nvec4  ascii( const in vec2 coord )\n{\n  vec2 pix = coord*uTextureInputSize.xy;\n  vec3 col = TEXTURE_2D_TextureInput(floor(pix/16.0)*16.0/uTextureInputSize.xy).rgb;\n\n  float gray = 0.3 * col.r + 0.59 * col.g + 0.11 * col.b;\n\n  // 458144   fish\n  // 473536   square\n  // 33408895 empty round\n  // a 469450 33095217\n  // p 469448 33095184\n  // r 32078482\n  // i 14815374\n  // l 8659215\n\n/*\n  float n =  4096.0;               // .\n  if (gray > 0.2) n = 65600.0;    // :\n  if (gray > 0.3) n = 332772.0;   // *\n  if (gray > 0.4) n = 15255086.0; // o\n  if (gray > 0.5) n = 23385164.0; // &\n  if (gray > 0.6) n = 15252014.0; // 8\n  if (gray > 0.7) n = 13199452.0; // @\n  if (gray > 0.8) n = 11512810.0; // #\n*/\n\n  // letters are APRIL\n  // "emojii" are fish, square, hollow round\n  float n =  14815374.0;               // I\n  if (gray > 0.2) n = 473536.0;    // square\n  if (gray > 0.3) n = 15255086.0;   //  round o\n  if (gray > 0.4) n = 458144.0; // fish\n  if (gray > 0.5) n = 10955200.0; // A\n  if (gray > 0.6) n = 1113663.0; // P\n  if (gray > 0.7) n = 5356847.0; // R\n  if (gray > 0.8) n = 15762465.0; // L\n\n  vec2 p = mod(pix / 8.0, 2.0) - vec2(1.0);\n  col = col * vec3(character(n, p));\n  return vec4(col, 1.0);\n}\n'},LiSq:e=>{"use strict";e.exports="uniform sampler2D TextureInput;\nuniform sampler2D TextureBloomBlur1;\nuniform sampler2D TextureBloomBlur2;\nuniform sampler2D TextureBloomBlur3;\nuniform sampler2D TextureBloomBlur4;\nuniform sampler2D TextureBloomBlur5;\n\nuniform float uBloomRadius;\nuniform float uBloomFactor;\n\nfloat getRadiusFactored(const float value, const float middle) {\n    return mix(value, middle * 2.0 - value, uBloomRadius);\n}\n\nvec4 bloomCombine() {\n    vec3 bloom = vec3(0.0);\n\n    const float midVal = 0.6;\n\n    const float factor1 = 1.1;\n    const float factor2 = 0.9;\n    const float factor3 = 0.6;\n    const float factor4 = 0.3;\n    const float factor5 = 0.1;\n\n    bloom += TEXTURE_2D_TextureBloomBlur1(gTexCoord).rgb * getRadiusFactored(factor1, midVal);\n    bloom += TEXTURE_2D_TextureBloomBlur2(gTexCoord).rgb * getRadiusFactored(factor2, midVal);\n    bloom += TEXTURE_2D_TextureBloomBlur3(gTexCoord).rgb * getRadiusFactored(factor3, midVal);\n    bloom += TEXTURE_2D_TextureBloomBlur4(gTexCoord).rgb * getRadiusFactored(factor4, midVal);\n    bloom += TEXTURE_2D_TextureBloomBlur5(gTexCoord).rgb * getRadiusFactored(factor5, midVal);\n\n    vec3 color = TEXTURE_2D_TextureInput(gTexCoord).rgb;\n    return vec4(color + (bloom * uBloomFactor), 1.0);\n}"},zE1p:e=>{"use strict";e.exports='#pragma include "utils/getLuminance.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureInput;\n\n#ifdef HAS_BACKGROUND\nuniform sampler2D TextureDepth;\n#endif\n\nuniform float uBloomThreshold;\n\nvec3 extractBright(const in vec3 color) {\n    // TODO manage hdr pixel with high frequency? (use derivative??), for now we clamp the extracted pixel :(\n    return clamp(color * clamp(getLuminance(color) - uBloomThreshold, 0.0, 1.0), 0.0, 1.0);\n}\n\nvec4 bloomExtract() {\n    vec3 color = TEXTURE_2D_TextureInput(gTexCoord).rgb;\n\n#ifdef HAS_BACKGROUND\n\tfloat alpha = decodeAlpha(TEXTURE_2D_TextureDepth(gTexCoord));\n\tif(alpha == 0.0) {\n\t\treturn vec4(vec3(0.0), 1.0);\n    }\n#else\n\tfloat alpha = 1.0;\n#endif\n\n\treturn vec4(extractBright(color * alpha), 1.0);\n}'},A6cf:e=>{"use strict";e.exports="uniform sampler2D TextureInput;\n\nuniform float uChromaFactor;\n\nvec4 chromaticAberration() {\n    vec2 uv = gTexCoord;\n\n    vec2 dist = uv - 0.5;\n    vec2 offset = uChromaFactor * dist * length(dist);\n    vec3 col;\n    col.r = TEXTURE_2D_TextureInput(uv - offset).r;\n    col.g = TEXTURE_2D_TextureInput(uv).g;\n    col.b = TEXTURE_2D_TextureInput(uv + offset).b;\n\n    return vec4(col, 1.0);\n}"},E5qE:e=>{"use strict";e.exports="uniform vec3 uColorBalanceLow;\nuniform vec3 uColorBalanceMid;\nuniform vec3 uColorBalanceHigh;\n\nfloat RGBToL(const in vec3 color) {\n    float fmin = min(min(color.r, color.g), color.b);\n    float fmax = max(max(color.r, color.g), color.b);\n    return (fmax + fmin) / 2.0;\n}\n\nvec3 colorBalance(const in vec3 color) {\n    vec3 lrgb = uColorBalanceLow;\n    vec3 mrgb = uColorBalanceMid;\n    vec3 hrgb = uColorBalanceHigh;\n\n    float cLen = length(color);\n    if(cLen < 1e-5)\n        return color;\n\n    // TODO : I have no idea what I am doing, we should use a curve widge\n    float lightness = RGBToL(color);\n    // '  lightness=(lightness*0.9-1.0)/(lightness*2.0+1.0) +1.0;\n    lightness = (1.5 * lightness) / (lightness + 0.5);\n    // https://github.com/liovch/GPUImage/blob/master/framework/Source/GPUImageColorBalanceFilter\n    float a = 0.25;\n    float b = 0.333;\n    float scale = 0.7;\n    vec3 low = lrgb * clamp((lightness - b) / -a + 0.5, 0.0, 1.0);\n    vec3 mid = mrgb * clamp((lightness - b) / a + 0.5, 0.0, 1.0) * clamp((lightness + b - 1.0) / -a + 0.5, 0.0, 1.0);\n    vec3 high = hrgb * clamp((lightness + b - 1.0) / a + 0.5, 0.0, 1.0);\n    vec3 newColor = max(color + (low + mid + high) * scale, vec3(0.0));\n    // newColor can be negative\n    float len = length(newColor);\n    return len < 1e-5 ? newColor * cLen : newColor * cLen / len;\n}\n\nvec4 colorBalance(const in vec4 color) {\n    return vec4(colorBalance(color.rgb), 1.0);\n}"},x17P:e=>{"use strict";e.exports="uniform sampler2D TextureTransparent;\n\nvec4 combineOpacity(const in vec4 color) {\n\t// should be replaced with TEXTURE_2D_TextureTransparent as is can make sense\n    vec4 transparent = TEXTURE_2D_TextureTransparent(gTexCoord);\n    return vec4(color.rgb * (1.0 - transparent.a) + transparent.rgb, 1.0);\n}"},QorK:e=>{"use strict";e.exports="uniform sampler2D TextureInput;\nuniform sampler2D TextureRefraction;\n\nuniform vec2 uTextureRefractionSize;\nuniform vec2 uTextureRefractionRatio;\nuniform float uRGBMRange;\n\nvec4 combineRefraction() {\n    // manual fetch to check m value of rgba : we use m 0 (invalid of rgbm) as masking\n    vec2 uv = min(gTexCoord, 1.0 - 1.0 / uTextureRefractionSize.xy);\n    vec4 rgbmRefraction = texture2D(TextureRefraction, uv * uTextureRefractionRatio);\n\n    vec4 background = TEXTURE_2D_TextureInput(gTexCoord);\n    if (rgbmRefraction.a == 0.0) return background;\n    return vec4(decodeRGBM(rgbmRefraction, uRGBMRange), 1.0);\n}"},"13g6":e=>{"use strict";e.exports="uniform sampler2D TextureExtra;\r\n\r\n// LINEAR should be deduce from TEXTURE_2D_TextureExtra with user data\r\nvec4 composeExtra(const in vec4 color) {\r\n#ifdef LINEAR_EXTRA\r\n\tvec4 extra = sRGBToLinear(TEXTURE_2D_TextureExtra(gTexCoord));\r\n#else\r\n\tvec4 extra = TEXTURE_2D_TextureExtra(gTexCoord);\r\n#endif\r\n\treturn extra + vec4(color) * (1.0 - extra.a);\r\n}"},f4Fj:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\r\n\r\nuniform sampler2D TextureFixed;\r\nuniform vec2 uFixedScale;\r\n\r\nuniform sampler2D TextureDepth;\r\nuniform vec2 uTextureOutputSize;\r\n\r\nuniform vec4 uHalton;\r\nuniform float uSplitView;\r\n\r\nvec4 composeBackground(const in vec3 color, const in float alpha) {\r\n    vec2 jitter = uHalton.xy * 0.5 / uTextureOutputSize;\r\n    vec2 uv = (gTexCoord - 0.5 + jitter) * uFixedScale + 0.5;\r\n\r\n    // we recenter and unstretch the background\r\n    if (uSplitView == 1.0) uv.x = uv.x * 0.5 + 0.25;\r\n\r\n    // composer can\'t guess based on user data, so SRGBToLinear should be defined (or not) by TEXTURE_2D_XXXXXXX\r\n    vec3 backgroundColor = sRGBToLinear(texture2D(TextureFixed, uv).rgb);\r\n    return vec4(color.rgb + backgroundColor * (1.0 - alpha), 1.0);\r\n}\r\n\r\nuniform sampler2D TextureInput;\r\nuniform vec2 uTextureInputSize;\r\nuniform vec2 uTextureInputRatio;\r\n\r\nuniform sampler2D TextureRefraction;\r\nuniform vec2 uTextureRefractionSize;\r\nuniform vec2 uTextureRefractionRatio;\r\nuniform float uRGBMRange;\r\n\r\nvec4 composeFixedBackground(const in vec4 color) {\r\n#ifdef REFRACTION_COMPOSITING_EXCLUSION\r\n    // detect if we are on a refraction pixel\r\n    vec2 uvRef = min(gTexCoord, 1.0 - 1.0 / uTextureRefractionSize.xy);\r\n    if (texture2D(TextureRefraction, uvRef * uTextureRefractionRatio).a > 0.0) return color;\r\n#endif\r\n\r\n    float alpha = decodeAlpha(TEXTURE_2D_TextureDepth(gTexCoord));\r\n    return composeBackground(color.rgb, alpha);\r\n}\r\n\r\nvec4 composeFixedBackgroundRefraction() {\r\n    vec3 color = TEXTURE_2D_TextureInput(gTexCoord).rgb;\r\n    float alpha = decodeAlpha(TEXTURE_2D_TextureDepth(gTexCoord));\r\n    return composeBackground(color.rgb, alpha);\r\n}'},"Ht5+":e=>{"use strict";e.exports='#pragma include "utils/encodeDecode.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureDepth;\nuniform int uFirstDepth;\n\nuniform vec2 uTextureDepthSize;\nuniform vec2 uTextureOutputSize;\n\n// For some reasons it requires unpacking *and* repacking to avoid transition between mipmap\nvec4 depthMipmap() {\n    vec2 invSize = 1.0 / uTextureDepthSize;\n    vec4 depths;\n    vec2 offDepth = vec2(0.25, -0.25);\n    if (uFirstDepth == 1) {\n        depths.x = decodeDepth(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.yy * invSize));\n        depths.y = decodeDepth(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.xy * invSize));\n        depths.z = decodeDepth(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.yx * invSize));\n        depths.w = decodeDepth(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.xx * invSize));\n    } else {\n        depths.x = decode24(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.yy * invSize).xyz);\n        depths.y = decode24(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.xy * invSize).xyz);\n        depths.z = decode24(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.yx * invSize).xyz);\n        depths.w = decode24(TEXTURE_2D_TextureDepth(gTexCoord + offDepth.xx * invSize).xyz);\n    }\n\n    return vec4(encode24(min(min(depths.x, depths.y), min(depths.z, depths.w))), 1.0);\n}\n'},UUlS:e=>{"use strict";e.exports="// https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment-v2.js\n\nvec2 barrel(const in vec2 v, const in vec4 projection, const in vec4 unprojection) {\n  vec2 w = (v + unprojection.zw) / unprojection.xy;\n  float val = dot(w, w);\n  // float poly = (showCenter == 1 && val < 0.00010) ? 10000.0 : 1.0 + (uDistortion.x + uDistortion.y * val) * val;\n  float poly = 1.0 + (uDistortion.x + uDistortion.y * val) * val;\n  return projection.xy * (poly * w) - projection.zw;\n}\n\nvec2 distortion(const in vec2 texCoord) {\n\n  if (abs(texCoord.x - 0.5) < .001) {\n    discard;\n  }\n\n  vec2 a;\n\n  if (texCoord.x < 0.5){\n    a = barrel(vec2(texCoord.x / 0.5, texCoord.y), uProjectionLeft, uUnprojectionLeft);\n  } else {\n    // right projections are shifted and vertically mirrored relative to left\n    const vec3 swi = vec3(1.0, -1.0, 0.0);\n    vec4 projectionRight = (uProjectionLeft + swi.zzxz) * swi.xxyx;\n    vec4 unprojectionRight = (uUnprojectionLeft + swi.zzxz) * swi.xxyx;\n    a = barrel(vec2((texCoord.x - 0.5) / 0.5, texCoord.y), projectionRight, unprojectionRight);\n  }\n\n  if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {\n    discard;\n  }\n\n  return vec2(a.x * 0.5 + (texCoord.x < 0.5 ? 0.0 : 0.5), a.y);\n}"},HF1e:e=>{"use strict";e.exports='#pragma include "utils/rand.glsl"\n\nuniform vec3 uDofBlurNearFarFocal;\n#pragma include "dofCommon.glsl"\n\nuniform sampler2D TextureDofColor;\nuniform vec2 uTextureDofColorSize;\n\n#ifndef COLOR_WITH_COC\nuniform sampler2D TextureDofCoC;\nuniform vec2 uTextureDofCoCSize;\n#endif\n\nuniform float uDofScale;\nuniform float uQuality;\n\nuniform float uFrameModTaaSS;\n\n#ifdef COLOR_WITH_COC\n#define DOF_TAP(id) ofs = fTaps_Poisson[id]; \\\n                    ofs = gTexCoord + blurDist * vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) ); \\\n                    sumcol += TEXTURE_2D_TextureDofColor(ofs);\n#else\n#define DOF_TAP(id) ofs = fTaps_Poisson[id]; \\\n                    ofs = gTexCoord + blurDist * vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) ); \\\n                    cocWeight = abs(TEXTURE_2D_TextureDofCoC(ofs).a * 2.0 - 1.0); \\\n                    cocWeight *= cocWeight * cocWeight; \\\n                    sumcol.rgb += TEXTURE_2D_TextureDofColor(ofs).rgb * cocWeight; \\\n                    sumcol.a += cocWeight;\n#endif\n\nvec4 dofBlur16(const in vec2 blurDist, const in float ntime) {\n    float rnd = 6.28 * ditheringNoise(gl_FragCoord.xy, uFrameModTaaSS + ntime);\n\n    float cosa = cos(rnd);\n    float sina = sin(rnd);\n    vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n    vec4 sumcol = vec4(0.0);\n\n    float total = 0.0;\n\n    vec2 fTaps_Poisson[17];\n    // https://github.com/bartwronski/PoissonSamplingGenerator\n    fTaps_Poisson[0] = vec2(0.343280198355, 0.921191856785);\n    fTaps_Poisson[1] = vec2(-0.116859107262, 0.873056831344);\n    fTaps_Poisson[2] = vec2(-0.646421287853, 0.760425284853);\n    fTaps_Poisson[3] = vec2(-0.0437332058416, 0.47196719804);\n    fTaps_Poisson[4] = vec2(0.48240473891, 0.464894594736);\n    fTaps_Poisson[5] = vec2(-0.718897237297, 0.352191304304);\n    fTaps_Poisson[6] = vec2(-0.939061387886, -0.0387376698953);\n    fTaps_Poisson[7] = vec2(0.546569494557, -0.0169516524446);\n    fTaps_Poisson[8] = vec2(-0.182644095652, -0.0702667761349);\n    fTaps_Poisson[9] = vec2(-0.576191305396, -0.252368997099);\n    fTaps_Poisson[10] = vec2(0.921914032366, -0.366530187909);\n    fTaps_Poisson[11] = vec2(-0.0582053944545, -0.510617206206);\n    fTaps_Poisson[12] = vec2(-0.783101528934, -0.601411360136);\n    fTaps_Poisson[13] = vec2(0.430604354377, -0.729559481383);\n    fTaps_Poisson[14] = vec2(-0.350716524868, -0.809522919973);\n    fTaps_Poisson[15] = vec2(0.0600898835968, -0.952568587297);\n    fTaps_Poisson[16] = vec2(0.0, 0.0); // dummy because of intel off-by-one bug\n\n    vec2 ofs;\n    vec4 sampleTex;\n    float cocWeight;\n\n    DOF_TAP(0);\n    DOF_TAP(1);\n    DOF_TAP(2);\n    DOF_TAP(3);\n    DOF_TAP(4);\n    DOF_TAP(5);\n    DOF_TAP(6);\n    DOF_TAP(7);\n    DOF_TAP(8);\n    DOF_TAP(9);\n    DOF_TAP(10);\n    DOF_TAP(11);\n    DOF_TAP(12);\n    DOF_TAP(13);\n    DOF_TAP(14);\n    DOF_TAP(15);\n\n    return sumcol;\n}\n\nvec4 dofBlurCircular() {\n    if(uDofBlurNearFarFocal.x < EPS_EARLY_OUT && uDofBlurNearFarFocal.y < EPS_EARLY_OUT) {\n        return vec4(0.0);\n    }\n\n    float factor = MAX_BLUR * uDofScale;\n\n#ifdef COLOR_WITH_COC\n    vec2 blurDist = factor * pow(TEXTURE_2D_TextureDofColor(gTexCoord).a, 0.333) / uTextureDofColorSize;\n#else\n    vec2 blurDist = factor * abs(TEXTURE_2D_TextureDofCoC(gTexCoord).a * 2.0 - 1.0) / uTextureDofCoCSize;\n#endif\n\n    // TODO optimize dofBlur16 (unroll...)\n    vec4 sumcol = dofBlur16(blurDist, 0.0); // 16\n    if (uQuality > 0.33) sumcol += dofBlur16(blurDist, 3.0); // 32\n    if (uQuality > 0.66) sumcol += dofBlur16(blurDist, 5.0); // 48\n\n    return vec4(sumcol.rgb / sumcol.a, 1.0);\n}\n'},B0qL:e=>{"use strict";e.exports='uniform vec3 uDofBlurNearFarFocal;\n\n#pragma include "dofCommon.glsl"\n\nuniform sampler2D TextureDepth;\n\nvec4 dofCoC() {\n    if(uDofBlurNearFarFocal.x < EPS_EARLY_OUT && uDofBlurNearFarFocal.y < EPS_EARLY_OUT){\n        return vec4(0.0);\n    }\n\n    return vec4(vec3(0.0), texDepthToCoC(TEXTURE_2D_TextureDepth(gTexCoord)) * 0.5 + 0.5);\n}'},"1irs":e=>{"use strict";e.exports='uniform vec3 uDofBlurNearFarFocal;\n\n#pragma include "dofCommon.glsl"\n\nuniform sampler2D TextureInput;\nuniform sampler2D TextureDofBlurCircular;\nuniform sampler2D TextureDofNearDilateV;\nuniform sampler2D TextureDepth;\n\nuniform vec2 uTextureDofNearDilateVSize;\nuniform vec2 uTextureDofBlurCircularSize;\n\nuniform float uDofScale;\n\nvec4 dofCombine() {\n    vec2 uv = gTexCoord;\n    vec3 color = TEXTURE_2D_TextureInput(uv).rgb;\n\n    if(uDofBlurNearFarFocal.x < EPS_EARLY_OUT && uDofBlurNearFarFocal.y < EPS_EARLY_OUT){\n        return vec4(color, 1.0);\n    }\n\n    vec4 depthPacked = TEXTURE_2D_TextureDepth(uv);\n\n    // half res color\n    vec3 blur;\n    // no bilinear for background pixels because it can displays artefacts on low frequency due to rgbm bilinear fetching\n    if (depthPacked.x == 1.0) {\n        blur = TEXTURE_2D_NEAREST_TextureDofBlurCircular(uv).rgb;\n        vec2 off = vec2(1.0, -1.0) * uDofScale;\n        blur += TEXTURE_2D_NEAREST_TextureDofBlurCircular(uv + off.xx / uTextureDofBlurCircularSize).rgb;\n        blur += TEXTURE_2D_NEAREST_TextureDofBlurCircular(uv + off.yy / uTextureDofBlurCircularSize).rgb;\n        blur += TEXTURE_2D_NEAREST_TextureDofBlurCircular(uv + off.xy / uTextureDofBlurCircularSize).rgb;\n        blur += TEXTURE_2D_NEAREST_TextureDofBlurCircular(uv + off.yx / uTextureDofBlurCircularSize).rgb;\n        blur /= 5.0;\n    } else {\n        blur = TEXTURE_2D_TextureDofBlurCircular(uv).rgb;\n        vec2 off = vec2(1.0, -1.0) * uDofScale;\n        blur += TEXTURE_2D_TextureDofBlurCircular(uv + off.xx / uTextureDofBlurCircularSize).rgb;\n        blur += TEXTURE_2D_TextureDofBlurCircular(uv + off.yy / uTextureDofBlurCircularSize).rgb;\n        blur += TEXTURE_2D_TextureDofBlurCircular(uv + off.xy / uTextureDofBlurCircularSize).rgb;\n        blur += TEXTURE_2D_TextureDofBlurCircular(uv + off.yx / uTextureDofBlurCircularSize).rgb;\n        blur /= 5.0;\n    }\n\n    // merge full res and half res coc\n    vec2 uvNearest = (floor(uv * uTextureDofNearDilateVSize) + 0.5) / uTextureDofNearDilateVSize;\n    float coc = abs(min(TEXTURE_2D_TextureDofNearDilateV(uvNearest).a * 2.0 - 1.0, texDepthToCoC(depthPacked)));\n\n    // merge half res blurred color and full res pixels\n    float cocLower = 0.05;\n    float cocHigher = 0.3;\n\n    return vec4(mix(color, blur, smoothstep(cocLower, cocHigher, coc)), 1.0);\n}\n\n'},"q+nQ":e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n\nconst float MAX_BLUR = 16.0;\nconst float EPS_EARLY_OUT = 0.01; // early out (typically when we move the camera fast and the dof might be not effective)\n\nfloat texDepthToCoC(const in vec4 fetch) {\n    // background should be always max blurred so that the near blur can expand onto the background (because of special dilate background codepath below)\n    if(fetch.x == 1.0) return max(uDofBlurNearFarFocal.x, uDofBlurNearFarFocal.y);\n\n    float coc = decodeDepth(fetch);\n    coc = clamp((coc - uDofBlurNearFarFocal.z) / coc, -1.0, 1.0);\n    return (coc < 0.0 ? coc * uDofBlurNearFarFocal.x : coc * uDofBlurNearFarFocal.y);\n}'},"ME+G":e=>{"use strict";e.exports="uniform vec2 uTextureInputSize;\nuniform vec3 uDofCross;\n\nuniform vec2 uPixelRatio;\n\nvec4 dofCross(const in vec4 color) {\n    float ratio = uTextureInputSize.y / uTextureInputSize.x;\n    float dist = distance(vec2(uDofCross.x, uDofCross.y * ratio), gTexCoord * vec2(1.0, ratio));\n    float widthCircle = uPixelRatio.x / uTextureInputSize.x;\n    return vec4(mix(color.rgb, vec3(1.0), abs(dist - 60.0 * widthCircle) > widthCircle ? 0.0 : uDofCross.z), color.a);\n}"},VThJ:e=>{"use strict";e.exports="uniform sampler2D TextureInput;\n\n#ifdef COLOR_WITH_COC\nuniform sampler2D TextureDofCoC;\n#endif\n\nvec4 dofDownsampleColor() {\n    vec2 uv = gTexCoord;\n\n    vec4 color = TEXTURE_2D_NEAREST_TextureInput(uv);\n\n// premult with coc buffer\n#ifdef COLOR_WITH_COC\n    color.a = abs(TEXTURE_2D_TextureDofCoC(uv).a * 2.0 - 1.0);\n    color.a *= color.a * color.a;\n    color.rgb *= color.a;\n#endif\n\n    return color;\n}"},"O+7P":e=>{"use strict";e.exports='uniform vec3 uDofBlurNearFarFocal;\n\n#pragma include "dofCommon.glsl"\n\nuniform sampler2D TextureDofCoC;\nuniform vec2 uTextureDofCoCSize;\nuniform sampler2D TextureDepth;\n\nuniform float uDofScale;\n\nvec4 dilateNear(const in vec2 offset) {\n    if(uDofBlurNearFarFocal.x < EPS_EARLY_OUT && uDofBlurNearFarFocal.y < EPS_EARLY_OUT){\n        return vec4(0.0);\n    }\n\n    // TODO DOF both the weights and the formula can be tweaked, also we could add a bit of jitter or something\n    vec2 uv = gTexCoord;\n    bool isBG = TEXTURE_2D_TextureDepth(uv).x == 1.0;\n\n    float coc = 0.0;\n    vec2 ofs = MAX_BLUR * offset / 5.0;\n\n    float coc0 = TEXTURE_2D_TextureDofCoC(uv).a * 2.0 - 1.0;\n    float coc1 = TEXTURE_2D_TextureDofCoC(uv - 5.0 * ofs).a * 2.0 - 1.0;\n    float coc2 = TEXTURE_2D_TextureDofCoC(uv - 4.0 * ofs).a * 2.0 - 1.0;\n    float coc3 = TEXTURE_2D_TextureDofCoC(uv - 3.0 * ofs).a * 2.0 - 1.0;\n    float coc4 = TEXTURE_2D_TextureDofCoC(uv - 2.0 * ofs).a * 2.0 - 1.0;\n    float coc5 = TEXTURE_2D_TextureDofCoC(uv - 1.0 * ofs).a * 2.0 - 1.0;\n    float coc6 = TEXTURE_2D_TextureDofCoC(uv + 1.0 * ofs).a * 2.0 - 1.0;\n    float coc7 = TEXTURE_2D_TextureDofCoC(uv + 2.0 * ofs).a * 2.0 - 1.0;\n    float coc8 = TEXTURE_2D_TextureDofCoC(uv + 3.0 * ofs).a * 2.0 - 1.0;\n    float coc9 = TEXTURE_2D_TextureDofCoC(uv + 4.0 * ofs).a * 2.0 - 1.0;\n    float coc10 = TEXTURE_2D_TextureDofCoC(uv + 5.0 * ofs).a * 2.0 - 1.0;\n\n    if(isBG == true){\n        // avoid "shrink" effect on the out of focus far part on the model edges\n        // gaussian weights (sigma 10), (doesn\'t have to be gaussian though), but the sum must be 1.0\n        // http://dev.theomader.com/gaussian-kernel-calculator/\n        coc = abs(coc0) * 0.095474 +\n        (abs(coc1) + abs(coc10)) * 0.084264 +\n        (abs(coc2) + abs(coc9)) * 0.088139 +\n        (abs(coc3) + abs(coc8)) * 0.091276 +\n        (abs(coc4) + abs(coc7)) * 0.093585 +\n        (abs(coc5) + abs(coc6)) * 0.094998;\n    } else {\n        // blur only near field (expand)\n        coc = min(coc0, 0.0);\n        coc = min(coc1 * 0.3, coc);\n        coc = min(coc2 * 0.5, coc);\n        coc = min(coc3 * 0.75, coc);\n        coc = min(coc4 * 0.8, coc);\n        coc = min(coc5 * 0.95, coc);\n        coc = min(coc6 * 0.95, coc);\n        coc = min(coc7 * 0.8, coc);\n        coc = min(coc8 * 0.75, coc);\n        coc = min(coc9 * 0.5, coc);\n        coc = min(coc10 * 0.3, coc);\n        if(abs(coc0) > abs(coc)) coc = coc0;\n    }\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\nvec4 dofNearDilateH() {\n    vec2 offset = vec2(uDofScale / uTextureDofCoCSize.x, 0.0);\n    return dilateNear(offset);\n}\n\nvec4 dofNearDilateV() {\n    vec2 offset = vec2(0.0, uDofScale / uTextureDofCoCSize.y);\n    return dilateNear(offset);\n}'},apoH:e=>{"use strict";e.exports="uniform float uVrFadeFactor;\r\n\r\nvec4 fadeVr(const in vec4 color) {\r\n\treturn vec4(mix(color.rgb, vec3(0.0), clamp(uVrFadeFactor, 0.0, 1.0)), color.a);\r\n}"},LnOO:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\n\nvec4 finalPremultAlpha(const in vec4 color) {\n    return vec4(linearTosRGB(sRGBToLinear(color.rgb) * color.a), color.a);\n}'},SzI9:e=>{"use strict";e.exports='#ifdef VR_DISTORTION\nuniform vec2 uDistortion;\nuniform vec4 uProjectionLeft;\nuniform vec4 uUnprojectionLeft;\n\n#pragma include "distortion.glsl"\n#endif\n\n#ifdef ASCII_FOOL\n#pragma include "ascii.glsl"\n#endif\n\nuniform sampler2D TextureInput;\nuniform vec2 uTextureInputSize;\n\n// G3D version of FXAA\n// green (y) as luma\n// Quality 12\nvec4 fxaa() {\n#ifdef VR_DISTORTION\n    gTexCoord = distortion(gTexCoord);\n#endif\n\n    vec2 fxaaQualityRcpFrame = 1.0 / uTextureInputSize;\n    float fxaaQualitySubpix = 0.75;\n    float fxaaQualityEdgeThreshold = 0.125;\n    float fxaaQualityEdgeThresholdMin = 0.0625;\n\n    vec2 posM = gTexCoord;\n    vec4 rgbyM = TEXTURE_2D_TextureInput(posM);\n    float lumaM = rgbyM.y;\n\n    // Swizzler Offseter Util\n    vec4 sw = vec4(-1.0, 1.0, 1.0, -1.0) * fxaaQualityRcpFrame.xxyy;\n\n    float lumaS = TEXTURE_2D_TextureInput(posM + vec2(0.0, sw.z)).y;\n    float lumaE = TEXTURE_2D_TextureInput(posM + vec2(sw.y, 0.0)).y;\n    float lumaN = TEXTURE_2D_TextureInput(posM + vec2(0.0, sw.w)).y;\n    float lumaW = TEXTURE_2D_TextureInput(posM + vec2(sw.x, 0.0)).y;\n\n    float maxSM = max(lumaS, lumaM);\n    float minSM = min(lumaS, lumaM);\n\n    float maxESM = max(lumaE, maxSM);\n    float minESM = min(lumaE, minSM);\n\n    float maxWN = max(lumaN, lumaW);\n    float minWN = min(lumaN, lumaW);\n\n    float rangeMax = max(maxWN, maxESM);\n    float rangeMin = min(minWN, minESM);\n\n    float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    float range = rangeMax - rangeMin;\n    float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\n    bool earlyExit = range < rangeMaxClamped;\n\n    if (earlyExit) {\n#ifdef ASCII_FOOL\n    return ascii(posM);\n#else\n    return rgbyM;\n#endif\n    }\n\n    float lumaNW = TEXTURE_2D_TextureInput(posM + sw.xw).y;\n    float lumaSE = TEXTURE_2D_TextureInput(posM + sw.yz).y;\n    float lumaNE = TEXTURE_2D_TextureInput(posM + sw.yw).y;\n    float lumaSW = TEXTURE_2D_TextureInput(posM + sw.xy).y;\n\n    float lumaNS = lumaN + lumaS;\n    float lumaWE = lumaW + lumaE;\n    float subpixRcpRange = 1.0/range;\n    float subpixNSWE = lumaNS + lumaWE;\n    float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    float edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\n    float lumaNESE = lumaNE + lumaSE;\n    float lumaNWNE = lumaNW + lumaNE;\n    float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\n    float lumaNWSW = lumaNW + lumaSW;\n    float lumaSWSE = lumaSW + lumaSE;\n    float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    float edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    float edgeVert = abs(edgeVert3) + edgeVert4;\n\n    float subpixNWSWNESE = lumaNWSW + lumaNESE;\n    float lengthSign = fxaaQualityRcpFrame.x;\n    bool horzSpan = edgeHorz >= edgeVert;\n    float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    float subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\n    float gradientN = lumaN - lumaM;\n    float gradientS = lumaS - lumaM;\n    float lumaNN = lumaN + lumaM;\n    float lumaSS = lumaS + lumaM;\n    bool pairN = abs(gradientN) >= abs(gradientS);\n    float gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\n\n    vec2 posB = posM.xy;\n    vec2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n\n    vec2 posN;\n    posN.x = posB.x - offNP.x;\n    posN.y = posB.y - offNP.y;\n    vec2 posP;\n    posP.x = posB.x + offNP.x;\n    posP.y = posB.y + offNP.y;\n    float subpixD = ((-2.0)*subpixC) + 3.0;\n    float lumaEndN = TEXTURE_2D_TextureInput(posN).y;\n    float subpixE = subpixC * subpixC;\n    float lumaEndP = TEXTURE_2D_TextureInput(posP).y;\n\n    if(!pairN) lumaNN = lumaSS;\n    float gradientScaled = gradient * 1.0/4.0;\n    float lumaMM = lumaM - lumaNN * 0.5;\n    float subpixF = subpixD * subpixE;\n    bool lumaMLTZero = lumaMM < 0.0;\n\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    bool doneN = abs(lumaEndN) >= gradientScaled;\n    bool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * 1.5;\n    if(!doneN) posN.y -= offNP.y * 1.5;\n    bool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * 1.5;\n    if(!doneP) posP.y += offNP.y * 1.5;\n\n    if(doneNP) {\n        if(!doneN) lumaEndN = TEXTURE_2D_TextureInput(posN.xy).y;\n        if(!doneP) lumaEndP = TEXTURE_2D_TextureInput(posP.xy).y;\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * 2.0;\n        if(!doneN) posN.y -= offNP.y * 2.0;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * 2.0;\n        if(!doneP) posP.y += offNP.y * 2.0;\n\n        if(doneNP) {\n            if(!doneN) lumaEndN = TEXTURE_2D_TextureInput(posN.xy).y;\n            if(!doneP) lumaEndP = TEXTURE_2D_TextureInput(posP.xy).y;\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * 4.0;\n            if(!doneN) posN.y -= offNP.y * 4.0;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * 4.0;\n            if(!doneP) posP.y += offNP.y * 4.0;\n\n            if(doneNP) {\n                if(!doneN) lumaEndN = TEXTURE_2D_TextureInput(posN.xy).y;\n                if(!doneP) lumaEndP = TEXTURE_2D_TextureInput(posP.xy).y;\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * 12.0;\n                if(!doneN) posN.y -= offNP.y * 12.0;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * 12.0;\n                if(!doneP) posP.y += offNP.y * 12.0;\n\n            }\n\n        }\n\n    }\n\n    float dstN = posM.x - posN.x;\n    float dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n\n    bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    float spanLength = (dstP + dstN);\n    bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    float spanLengthRcp = 1.0/spanLength;\n\n    bool directionN = dstN < dstP;\n    float dst = min(dstN, dstP);\n    bool goodSpan = directionN ? goodSpanN : goodSpanP;\n    float subpixG = subpixF * subpixF;\n    float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    float subpixH = subpixG * fxaaQualitySubpix;\n\n    float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\n \n#ifdef ASCII_FOOL\n    return ascii(posM);\n#else\n    return TEXTURE_2D_TextureInput(posM);\n#endif\n}\n'},iffO:e=>{"use strict";e.exports='#pragma include "utils/rand.glsl"\n\nuniform float uTimeGrain;\nuniform float uGrainFactor;\n\nfloat nrandTriangle() {\n    float nrnd0 = pseudoRandom(gl_FragCoord.xy + 1000.0 * fract(uTimeGrain));\n\n    // Convert uniform distribution into triangle-shaped distribution.\n    float orig = nrnd0 * 2.0 - 1.0;\n    nrnd0 = orig * inversesqrt(abs(orig));\n    nrnd0 = max(-1.0, nrnd0); // Nerf the NaN generated by 0 * rsqrt(0). Thanks @FioraAeterna!\n    nrnd0 = nrnd0 - sign(orig) + 0.5;\n\n    // Result is range [-0.5,1.5] which is useful for actual dithering. convert to [0,1] for histogram.\n    return (nrnd0 + 0.5) * 0.5;\n    // return nrnd0;\n}\n\nvec4 grain(const in vec4 color) {\n    float grainFactor = nrandTriangle();\n    return vec4(mix(color.rgb, color.rgb * (color.rgb + (1.0 - color.rgb) * 2.0 * grainFactor), uGrainFactor), color.a);\n}'},"+5pB":e=>{"use strict";e.exports="uniform float uOutlineFactor;\nuniform vec2 uPixelRatio;\nuniform float uHighlightFactor;\nuniform float uLineWidth;\n\nuniform sampler2D TextureOutline;\nuniform vec2 uTextureOutlineSize;\n\nvec4 outline() {\n    float fac0 = 2.0;\n    float fac1 = 1.0;\n    float offsetx = uPixelRatio.x / uTextureOutlineSize[0] * uLineWidth;\n    float offsety = uPixelRatio.y / uTextureOutlineSize[1] * uLineWidth;\n\n    vec4 texel0 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(offsetx, offsety));\n    vec4 texel1 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(offsetx, 0.0));\n    vec4 texel2 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(offsetx, -offsety));\n    vec4 texel3 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(0.0, -offsety));\n    vec4 texel4 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(-offsetx, -offsety));\n    vec4 texel5 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(-offsetx, 0.0));\n    vec4 texel6 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(-offsetx, offsety));\n    vec4 texel7 = TEXTURE_2D_TextureOutline(gTexCoord + vec2(0.0, offsety));\n\n    vec4 rowx = -fac0 * texel5 + fac0 * texel1 + -fac1 * texel6 + fac1 * texel0 + -fac1 * texel4 + fac1 * texel2;\n    vec4 rowy = -fac0 * texel3 + fac0 * texel7 + -fac1 * texel4 + fac1 * texel6 + -fac1 * texel2 + fac1 * texel0;\n\n    float magSqr = sqrt(dot(rowy, rowy) + dot(rowx, rowx));\n    bool infMag = magSqr < 1.0 / 65025.0;\n\n    vec3 texelCenter = TEXTURE_2D_TextureOutline(gTexCoord).rgb;\n    if (texelCenter == vec3(0.0) || (uHighlightFactor == 0.0 && infMag)) {\n        discard;\n    }\n\n    float finalFactor = infMag ? uHighlightFactor : min(1.0, sqrt(magSqr) * uOutlineFactor);\n\n    return finalFactor * vec4(texelCenter, 1.0);\n}\n"},"R/Z7":e=>{"use strict";e.exports='#pragma include "utils/encodeDecode.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureDepth0;\nuniform sampler2D TextureDepth1;\nuniform sampler2D TextureDepth2;\nuniform sampler2D TextureDepth3;\nuniform sampler2D TextureDepth4;\nuniform sampler2D TextureDepth5;\nuniform vec2 uTextureOutputRatio;\n\nvec4 packMipmapDepth() {\n    vec4 result = vec4(0.0, 0.0, 0.0, 0.0);\n\n    // see _hookComposerResize in NodePostProcess.js (mipmap)\n    gTexCoord.y /= uTextureOutputRatio.y;\n\n    float levelLog = -log2(1.0 - gTexCoord.y) + 1.0;\n    float level = floor(levelLog) - 1.0;\n\n    float pLevel = pow(2.0, level + 1.0); // 2, 4, 8, 16...\n    gTexCoord.x = pLevel * gTexCoord.x * 0.5;\n    gTexCoord.y = pLevel * (1.0 - gTexCoord.y) - 1.0;\n\n    // unused part of the texture\n    if (gTexCoord.x > 1.0 || gTexCoord.y > 1.0) return result;\n\n    if (level < 0.1) result.rgba = vec4(encode24(decodeDepth(TEXTURE_2D_TextureDepth0(gTexCoord))), 1.0);\n    else if (level < 1.1) result.rgba = TEXTURE_2D_TextureDepth1(gTexCoord);\n    else if (level < 2.1) result.rgba = TEXTURE_2D_TextureDepth2(gTexCoord);\n    else if (level < 3.1) result.rgba = TEXTURE_2D_TextureDepth3(gTexCoord);\n    else if (level < 4.1) result.rgba = TEXTURE_2D_TextureDepth4(gTexCoord);\n    else if (level < 5.1) result.rgba = TEXTURE_2D_TextureDepth5(gTexCoord);\n\n    return result;\n}\n'},iXLb:e=>{"use strict";e.exports="uniform sampler2D TextureRefractionBlur0;\nuniform sampler2D TextureRefractionBlur1;\nuniform sampler2D TextureRefractionBlur2;\nuniform sampler2D TextureRefractionBlur3;\nuniform sampler2D TextureRefractionBlur4;\nuniform sampler2D TextureRefractionBlur5;\nuniform sampler2D TextureRefractionBlur6;\nuniform sampler2D TextureRefractionBlur7;\nuniform vec2 uTextureOutputRatio;\n\nvec4 packMipmapRefraction() {\n    vec4 result = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // see _hookComposerResize in NodePostProcess.js (mipmap)\n    gTexCoord.y /= uTextureOutputRatio.y;\n\n    float levelLog = -log2(1.0 - gTexCoord.y) + 1.0;\n    float level = floor(levelLog) - 1.0;\n\n    float pLevel = pow(2.0, level + 1.0); // 2, 4, 8, 16...\n    gTexCoord.x = pLevel * gTexCoord.x * 0.5;\n    gTexCoord.y = pLevel * (1.0 - gTexCoord.y) - 1.0;\n\n    // unused part of the texture\n    if (gTexCoord.x > 1.0 || gTexCoord.y > 1.0) return result;\n\n    if (level < 0.1) result.rgb = TEXTURE_2D_TextureRefractionBlur0(gTexCoord).rgb;\n    else if (level < 1.1) result.rgb = TEXTURE_2D_TextureRefractionBlur1(gTexCoord).rgb;\n    else if (level < 2.1) result.rgb = TEXTURE_2D_TextureRefractionBlur2(gTexCoord).rgb;\n    else if (level < 3.1) result.rgb = TEXTURE_2D_TextureRefractionBlur3(gTexCoord).rgb;\n    else if (level < 4.1) result.rgb = TEXTURE_2D_TextureRefractionBlur4(gTexCoord).rgb;\n    else if (level < 5.1) result.rgb = TEXTURE_2D_TextureRefractionBlur5(gTexCoord).rgb;\n    else if (level < 6.1) result.rgb = TEXTURE_2D_TextureRefractionBlur6(gTexCoord).rgb;\n    else if (level < 7.1) result.rgb = TEXTURE_2D_TextureRefractionBlur7(gTexCoord).rgb;\n\n    return result;\n}\n"},r6Wx:e=>{"use strict";e.exports='#ifdef VR_DISTORTION\nuniform vec2 uDistortion;\nuniform vec4 uProjectionLeft;\nuniform vec4 uUnprojectionLeft;\n\n#pragma include "distortion.glsl"\n#endif\n\n#ifdef ASCII_FOOL\n#pragma include "ascii.glsl"\n#endif\n\nuniform sampler2D TextureInput;\n\nvec4 passThrough() {\n#ifdef VR_DISTORTION\n    gTexCoord = distortion(gTexCoord);\n#endif\n\n#ifdef ASCII_FOOL\n    return ascii(gTexCoord.xy);\n#else\n    return TEXTURE_2D_TextureInput(gTexCoord);\n#endif\n}\n'},mHqZ:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureInput;\nuniform sampler2D TextureDepth;\n\nuniform sampler2D TextureRefraction;\nuniform vec2 uTextureRefractionSize;\nuniform vec2 uTextureRefractionRatio;\n\n// no background scenario\nvec4 setDepthAlpha(const in vec4 color) {\n#ifdef REFRACTION_FORCE_ALPHA_ONE\n    // detect if we are on a refraction pixel\n    vec2 uvRef = min(gTexCoord, 1.0 - 1.0 / uTextureRefractionSize.xy);\n    if (texture2D(TextureRefraction, uvRef * uTextureRefractionRatio).a > 0.0) return vec4(color.rgb, 1.0);\n#endif\n\n    float alpha = decodeAlpha(TEXTURE_2D_TextureDepth(gTexCoord));\n    return vec4(color.rgb, alpha);\n}'},UKde:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureInput;\nuniform vec2 uTextureInputSize;\n\n#ifdef HAS_BACKGROUND\nuniform sampler2D TextureDepth;\n#endif\n\nuniform float uSharpFactor;\n\nuniform vec2 uPixelRatio;\n\nvec3 sharpColorFactor(const in vec3 color, const float sharp) {\n    vec2 off = uPixelRatio.xy / uTextureInputSize.xy;\n\n    // use useAA, 4 texFetch already in cache. perhaps we could cache ourself.\n    vec3 rgbNW = TEXTURE_2D_TextureInput(gTexCoord + off * vec2(-1.0, -1.0)).rgb; \n    vec3 rgbSE = TEXTURE_2D_TextureInput(gTexCoord + off * vec2(1.0, 1.0)).rgb;\n    vec3 rgbNE = TEXTURE_2D_TextureInput(gTexCoord + off * vec2(1.0, -1.0)).rgb;\n    vec3 rgbSW = TEXTURE_2D_TextureInput(gTexCoord + off * vec2(-1.0, 1.0)).rgb;\n\n    return color + sharp * (4.0 * color - rgbNW - rgbNE - rgbSW - rgbSE);\n}\n\nvec4 sharpen(const in vec4 color) {\n#ifdef HAS_BACKGROUND\n\tfloat alpha = decodeAlpha(TEXTURE_2D_TextureDepth(gTexCoord));\n\tif( alpha == 0.0 ) {\n\t\treturn vec4(color.rgb,1.0);\n    }\n#else\n\tfloat alpha = 1.0;\n#endif\n\n    return vec4(sharpColorFactor(color.rgb, uSharpFactor * alpha), color.a);\n}\n\nvec4 sharpen() {\n    return sharpen(TEXTURE_2D_TextureInput(gTexCoord));\n}'},"uCb/":e=>{"use strict";e.exports='#pragma include "utils/encodeDecode.glsl"\n\nuniform sampler2D TextureBlurInput;\nuniform vec2 uTextureBlurInputSize;\n\n#define SSAO_FILTER_RADIUS 3\n\n#define SSAO_TAP_BLUR(id, absid) sampleTex = TEXTURE_2D_TextureBlurInput(uv + axis * float(id) * 2.0); \\\n    z = decode24(sampleTex.xyz); \\\n    weight = max(0.0, 1.0 - sharpnessFactor * abs(z - initialZ)) * (0.3 + gaussian[absid]); \\\n    sum += weight * sampleTex.a; \\\n    totalWeight += weight;\n\nvec4 ssaoBlur(const in vec2 axis) {\n    vec2 uv = gTexCoord;\n\n    vec4 aoDepth = TEXTURE_2D_TextureBlurInput(uv);\n\n    // background\n    if(aoDepth.x == 1.0){\n        return aoDepth;\n    }\n\n    float initialZ = decode24(aoDepth.xyz);\n\n    float gaussian[SSAO_FILTER_RADIUS + 2]; // dummy because of intel off-by-one bug\n    gaussian[0] = 0.153170;\n    gaussian[1] = 0.144893;\n    gaussian[2] = 0.122649;\n    gaussian[3] = 0.092902;\n    gaussian[4] = 0.0;\n\n    float totalWeight = gaussian[0];\n    float sum = aoDepth.a * totalWeight;\n    float sharpnessFactor = 400.0;\n\n    // ---- UNROLL ----\n    vec2 ofs;\n    float z;\n    float weight;\n    vec4 sampleTex;\n\n    SSAO_TAP_BLUR(-3, 3);\n    SSAO_TAP_BLUR(-2, 2);\n    SSAO_TAP_BLUR(-1, 1);\n    SSAO_TAP_BLUR(1, 1);\n    SSAO_TAP_BLUR(2, 2);\n    SSAO_TAP_BLUR(3, 3);\n    // ---- UNROLL ----\n\n    aoDepth.a = sum / totalWeight;\n    return aoDepth;\n}\n\n#ifdef SSAO_BLUR_H\nvec4 ssaoBlurH() {\n    return ssaoBlur(vec2(1.0, 0.0) / uTextureBlurInputSize);\n}\n#else\nvec4 ssaoBlurV() {\n    vec3 color = TEXTURE_2D_TextureInput(gTexCoord).rgb;\n    return vec4(color * ssaoBlur(vec2(0.0, 1.0) / uTextureBlurInputSize).aaa, 1.0);\n}\n#endif'},Sru3:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\n#pragma include "utils/encodeDecode.glsl"\n#pragma include "utils/rand.glsl"\n\nuniform sampler2D TextureMipmapDepth;\nuniform vec2 uTextureMipmapDepthSize;\nuniform vec2 uTextureMipmapDepthRatio;\n\nuniform float uQuality; // mipmap usage\n\nuniform vec2 uTextureOutputSize;\n\nuniform float uSsaoRadius;\nuniform float uSsaoIntensity;\nuniform float uSsaoBias;\nuniform vec4 uSsaoProjectionInfo;\nuniform float uSsaoProjectionScale;\n\nuniform vec2 uNearFar;\n\nuniform float uFrameModTaaSS;\n\n// Constant used to scale the depth view value that is given to the blur pass\n#define MIN_RADIUS 1.0\n#define NB_SPIRAL_TURNS 3.0\n\nvec4 fetchDepthPackLevel(const in vec2 uv, const in float level){\n    float maxLod = 5.0;\n    float powLevel = pow(2.0, min(maxLod, floor(level)) + 1.0);\n    vec2 pixelSize = 2.0 * powLevel / uTextureMipmapDepthSize;\n\n    vec2 uvFetch = max(pixelSize, min(1.0 - pixelSize, uv));\n    uvFetch = vec2(2.0 * uvFetch.x, powLevel - 1.0 - uvFetch.y) * uTextureMipmapDepthRatio.xy / powLevel;\n\n    return texture2D(TextureMipmapDepth, uvFetch);\n}\n\nfloat fetchDepthLevel(const in vec2 uv, const in float level){\n    return decode24(fetchDepthPackLevel(uv, level).xyz);\n}\n\nfloat zValueFromScreenSpacePosition(const in float depth) {\n    return uNearFar.x + (uNearFar.y - uNearFar.x) * depth;\n}\n\nvec3 reconstructCSPosition(const in vec2 ssP, const in float z) {\n    return vec3((ssP.xy * uSsaoProjectionInfo.xy + uSsaoProjectionInfo.zw) * z, z);\n}\n\nvec3 getPosition(const in vec2 uv) {\n    return reconstructCSPosition(uv * uTextureOutputSize, zValueFromScreenSpacePosition(fetchDepthLevel(uv, 0.0)));\n}\n\n#define MAX_MIP_LEVEL 5\n// Determines at which point we should switch mip level\n// if number is too small (~3) will lead to flashing (bad variance as many taps give same pixel)\n// if number is too high, mip level are not used well and the cache is not used efficiently\n#define LOG_MAX_OFFSET 3\n\nvec3 getOffsetedPixelPos(\n    const in vec2 uv,\n    const in vec2 unitOffset,\n    const in float screenSpaceRadius) {\n\n    float mipLevel = clamp(floor(log2(screenSpaceRadius)) - float(LOG_MAX_OFFSET), 0.0, float(MAX_MIP_LEVEL));\n    vec2 uvOff = uv + floor(screenSpaceRadius * unitOffset) / uTextureOutputSize;\n\n    float d = zValueFromScreenSpacePosition(fetchDepthLevel(uvOff, mipLevel));\n    return reconstructCSPosition(uvOff * uTextureOutputSize, d);\n}\n\n#define PIOVER8 0.39269908169\nvec3 unpackNormal1(const in float pack1) {\n    float pack8 = floor(pack1 * 255.0);\n    float th = PIOVER8 * float(pack8 / 16.0);\n    float len = sqrt(mod(float(pack8), 16.0) / 15.001);\n    vec2 nv = vec2(cos(th), sin(th)) * len;\n    return -vec3(nv.x, nv.y, sqrt(max(0.0, 1.0 - nv.x * nv.x - nv.y * nv.y)));\n}\n\nvec3 unpackNormal2(const in vec2 pack2) {\n    vec3 nv = pack2.rgg * 2.0 - 1.0;\n    return -vec3(nv.x, nv.y, sqrt(max(0.0, 1.0 - nv.x * nv.x - nv.y * nv.y)));\n}\n\n#define SSAO_TAP_EXTRACT(id) screenSpaceRadius = (float(id) + 0.5) * (1.0 / nbSamples); \\\n    angle = screenSpaceRadius * (NB_SPIRAL_TURNS * 6.28) + randomAngle; \\\n    screenSpaceRadius = max(0.75, screenSpaceRadius * ssRadius); \\\n    offsetUnitVec = vec2(cos(angle), sin(angle)); \\\n    occludingPoint = getOffsetedPixelPos(uv, offsetUnitVec, screenSpaceRadius); \\\n    occludingPoint -= cameraSpacePosition; \\\n    vv = dot(occludingPoint, occludingPoint); \\\n    vn = dot(occludingPoint, normal); \\\n    contrib += max(1.0 - vv * invRadius2, 0.0) * max((vn - uSsaoBias) * inversesqrt(vv), 0.0); \\\n\n#define SSAO_DO_TAPS(void) SSAO_TAP_EXTRACT(offset + 0); \\\n    SSAO_TAP_EXTRACT(offset + 1); \\\n    SSAO_TAP_EXTRACT(offset + 2); \\\n    SSAO_TAP_EXTRACT(offset + 3); \\\n    SSAO_TAP_EXTRACT(offset + 4); \\\n    SSAO_TAP_EXTRACT(offset + 5); \\\n    SSAO_TAP_EXTRACT(offset + 6); \\\n    SSAO_TAP_EXTRACT(offset + 7); \\\n    SSAO_TAP_EXTRACT(offset + 8); \\\n    SSAO_TAP_EXTRACT(offset + 9); \\\n    SSAO_TAP_EXTRACT(offset + 10); \\\n    offset += 11; \\\n\n\nvec4 ssaoExtract() {\n    vec2 uv = gTexCoord;\n\n    vec3 depthPacked = fetchDepthPackLevel(uv, 0.0).xyz;\n\n    vec3 cameraSpacePosition = getPosition(uv);\n    float ssRadius = -uSsaoProjectionScale * uSsaoRadius / cameraSpacePosition.z;\n\n#ifdef SSAO_NORMAL\n    vec3 normal = unpackNormal2(TEXTURE_2D_TextureDepth(uv).ba); // g buffer normal 2 component on ba\n#elif defined(GL_OES_standard_derivatives) && !defined(MOBILE)\n    vec3 normal = cross(dFdy(cameraSpacePosition), dFdx(cameraSpacePosition));\n#else\n    vec2 offDepth = vec2(1.0, 0.0);\n    vec3 depthLeft = getPosition(uv - offDepth.xy / uTextureMipmapDepthSize);\n    vec3 depthRight = getPosition(uv + offDepth.xy / uTextureMipmapDepthSize);\n    vec3 depthBottom = getPosition(uv - offDepth.yx / uTextureMipmapDepthSize);\n    vec3 depthTop = getPosition(uv + offDepth.yx / uTextureMipmapDepthSize);\n    vec3 normal = cross(depthLeft - depthRight, depthTop - depthBottom);\n#endif\n\n    // early returns should be done derivatives usage to avoid bad edges\n\n    // early return background\n    if (depthPacked.x == 1.0) {\n        return vec4(depthPacked, 1.0);\n    }\n\n    // early return radius too small (note: needs to be in separate conditional because of nvidia/osx bug)\n    if (ssRadius < MIN_RADIUS) {\n        return vec4(depthPacked, 1.0);\n    }\n\n    normal = normalize(normal);\n    float nFalloff = mix(1.0, max(0.0, 1.5 * normal.z), 0.35);\n\n     // needs to be > 2PI\n    float randomAngle = 6.28 * interleavedGradientNoise(gl_FragCoord.xy, uFrameModTaaSS);\n    float invRadius2 = 1.0 / (uSsaoRadius * uSsaoRadius);\n    float contrib = 0.0;\n\n    float vv;\n    float vn;\n    float screenSpaceRadius;\n    float angle;\n    vec3 occludingPoint;\n    vec2 offsetUnitVec;\n    int offset = 0;\n\n    float nbSamples = 11.0;\n\n    if (uQuality > 0.33) nbSamples += 11.0;\n#ifndef MOBILE\n    if (uQuality > 0.66) nbSamples += 11.0;\n#endif\n\n    SSAO_DO_TAPS();\n    if (uQuality > 0.33) { SSAO_DO_TAPS(); }\n#ifndef MOBILE\n    if (uQuality > 0.66) { SSAO_DO_TAPS(); }\n#endif\n\n    float aoValue = max(0.0, 1.0 - sqrt(contrib * nFalloff / nbSamples));\n    aoValue = pow(aoValue, 10.0 * uSsaoIntensity);\n\n    vec4 aoDepth;\n    aoDepth.rgb = depthPacked;\n    aoDepth.a = mix(1.0, aoValue, clamp(ssRadius - MIN_RADIUS, 0.0, 1.0));\n\n    return aoDepth;\n}\n'},hgfR:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\n#pragma include "utils/decodeDepth.glsl"\n#pragma include "utils/rand.glsl"\n\nuniform sampler2D TextureSSSBlur;\nuniform sampler2D TextureDepth;\nuniform sampler2D TextureSSSKernel;\n\nuniform vec2 uNearFar;\n\nuniform vec2 uBlurDir;\nuniform float uProjFactor;\nuniform float uScatteringFactorPacker;\nuniform float uFrameModTaaSS;\n\n#ifndef SSS_JITTER\n#define SSS_JITTER 1.0\n#endif\n\n#ifndef SSS_HALF_KERNEL_SIZE\n#define SSS_HALF_KERNEL_SIZE 11\n#endif\n\n#ifndef SSS_PROFILE_COUNT\n#define SSS_PROFILE_COUNT 1\n#endif\n\n#define SSS_FOLLOW_SURFACE\n\n// if we want to do it branchless\nvec3 sssFetchColorBranchless(const in vec2 uv, const in vec4 colorM, const in float depthNormBias){\n    vec4 fetch = TEXTURE_2D_TextureSSSBlur(uv);\n\n#ifdef SSS_FOLLOW_SURFACE\n    float mixer = smoothstep(0.0, 0.05, abs(colorM.a - fetch.a) * depthNormBias);\n    mixer = mix(mixer, 1.0, step(fetch.a, 0.0)); // force to 1 if fetch.a is 0 (background)\n    fetch.rgb = mix(fetch.rgb, colorM.rgb, mixer);\n#endif\n\n    // uv inside box\n    // https://stackoverflow.com/questions/12751080/glsl-point-inside-box-test\n    vec2 s = step(vec2(0.0), uv) - step(vec2(1.0), uv);\n    return mix(colorM.rgb, fetch.rgb, s.x * s.y);\n}\n\nvec3 sssFetchColor(const in vec2 uv, const in vec4 colorM, const in float depthNormBias){\n    if (uv.x < 0.0 || uv.y < 0.0 || uv.x > 1.0 || uv.y > 1.0) {\n        return colorM.rgb;\n    }\n\n    // ignore sss with big depth difference, original jimenez is clamp(dDiff, 0.0, 1.0)\n    // we use a much more aggressive function\n    vec4 fetch = TEXTURE_2D_TextureSSSBlur(uv);\n\n#ifdef SSS_FOLLOW_SURFACE\n    if (fetch.a == 0.0) return colorM.rgb;\n    return mix(fetch.rgb, colorM.rgb, smoothstep(0.0, 0.05, abs(colorM.a - fetch.a) * depthNormBias));\n#else\n    return fetch.rgb;\n#endif\n}\n\nvec4 sssBlur() {\n    vec4 colorM = TEXTURE_2D_TextureSSSBlur(gTexCoord);\n\n    vec4 pack = TEXTURE_2D_TextureDepth(gTexCoord);\n\n    // background or not sss stuffs\n    if (pack.x == 1.0) {\n        return colorM;\n    }\n\n    int profile = decodeProfile(pack);\n    float scatter = decodeScatter(pack);\n    if (scatter == 0.0) {\n        return colorM;\n    }\n\n    float scatterWorld = scatter / uScatteringFactorPacker;\n    float depthRange = (uNearFar.y - uNearFar.x);\n\n    // for follow surface\n    // factor to get a normalized depth difference depending of scatter but not of camera position\n    float depthNormBias = depthRange * 0.05 / scatterWorld;\n\n    float worldPos = uNearFar.x + depthRange * colorM.a;\n    // uScatteringFactorPacker is just a unpacking factor because subsurface factor \n    // is a world space value but written in 8 bit texture\n    vec2 finalStep = uBlurDir * uProjFactor * scatterWorld / worldPos;\n    finalStep *= 1.0 / 3.0;\n\n    float yProfile = 1.0 - (float(profile) - 0.5) / float(SSS_PROFILE_COUNT);\n    float xKernelSize = 1.0 / float(SSS_HALF_KERNEL_SIZE);\n\n    vec3 kernel0 = texture2D(TextureSSSKernel, vec2(xKernelSize * 0.5, yProfile)).rgb;\n    vec3 colorBlurred = colorM.rgb * kernel0;\n\n    // force nearest sample for sss texture kernel color\n    vec2 offKernelNearest = vec2(0.5 * xKernelSize, 0.0);\n\n    // randomize the sss texture alpha weight a bit\n    float rnd = interleavedGradientNoise(gl_FragCoord.xy, uFrameModTaaSS);\n    rnd = mix(0.5, rnd, SSS_JITTER);\n    vec2 offKernelJitter = vec2(rnd * xKernelSize, 0.0);\n\n    for (int i = 1; i < SSS_HALF_KERNEL_SIZE; i++) {\n        vec2 uvKernel = vec2(float(i) * xKernelSize, yProfile);\n\n        vec3 kernel = texture2D(TextureSSSKernel, uvKernel + offKernelNearest).rgb;\n        float kernelDither = texture2D(TextureSSSKernel, uvKernel + offKernelJitter).a;\n\n        vec2 offset = kernelDither * finalStep;\n\n        vec3 fetch = sssFetchColor(gTexCoord + offset, colorM, depthNormBias);\n        fetch += sssFetchColor(gTexCoord - offset, colorM, depthNormBias);\n\n        colorBlurred += kernel.rgb * fetch;\n    }\n\n    return vec4(colorBlurred, colorM.a);\n}\n'},bjo4:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureSSSColor;\nuniform vec2 uTextureSSSColorSize;\n\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uProjFactor;\nuniform float uScatteringFactorPacker;\n\n#pragma include "sssCommon.glsl"\n\nuniform sampler2D TextureSSSBlur;\nuniform sampler2D TextureDepth;\n\nvec4 sssCombine() {\n\n    // full res - not SSS\n    vec4 pack = TEXTURE_2D_TextureDepth(gTexCoord);\n    int profile = decodeProfile(pack);\n    // black pixels for background or non sss surfaces\n    if (pack.x == 1.0 || profile == 0) {\n        return TEXTURE_2D_TextureSSSColor(gTexCoord);\n    }\n\n    vec3 specular;\n    vec3 diffuse;\n    uncheckerboard(diffuse, specular);\n\n    // try to retain high res detail as much as possible (same ad dof)\n    // make sure to use a factor that is independent from bounding box\n    float scatterWorld = decodeScatter(pack) / uScatteringFactorPacker;\n    float worldPos = uNearFar.x + (uNearFar.y - uNearFar.x) * decodeDepth(pack);\n    float factor = uProjFactor * scatterWorld / worldPos;\n\n    // magic factor 10 (can be tweaked, e.g: if sss effects disappears too fast when we are far away)\n    factor = smoothstep(0.05, 0.3, factor * 10.0);\n    // return vec4(vec3(factor), 1.0);\n\n    diffuse = mix(diffuse, TEXTURE_2D_TextureSSSBlur(gTexCoord).rgb, factor);\n\n    return vec4(diffuse + specular, 1.0);\n}\n'},pg5E:e=>{"use strict";e.exports='#pragma include "utils/checkerboard.glsl"\n\n// blur jimenez\n// https://github.com/iryoku/separable-sss/blob/master/SeparableSSS.h#L454\n\n// blur UE4 (based on jimenez)\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/SeparableSSS.usf\n\n// UE 4 pre/post passes (down/upsample/checkerboard)\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/PostProcessSubsurface.usf\n\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Common.usf#L501\n// also solution 2 of http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color\nfloat luminanceLinear(const in vec3 color) {\n    return dot(color, vec3(0.3, 0.59, 0.11));\n}\n\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/PostProcessSubsurface.usf#L247\nvoid uncheckerboard(out vec3 diffuse, out vec3 specular) {\n\n    vec2 coordCenter = floor(gTexCoord * uTextureSSSColorSize) + 0.5;\n    vec2 uvCenter = coordCenter / uTextureSSSColorSize;\n    // not precomputing offset as 1.0/uTextureSSSColorSize.xy\n    // to make sure we don\'t loose precision and end up with ABCD being same texel\n    // on low precision gpu\n    vec3 offset = vec3(1.0, 1.0, 0.0);\n\n    vec3 A = TEXTURE_2D_TextureSSSColor((coordCenter + offset.xz)/ uTextureSSSColorSize.xy).rgb;\n    vec3 B = TEXTURE_2D_TextureSSSColor((coordCenter - offset.xz)/ uTextureSSSColorSize.xy).rgb;\n    vec3 C = TEXTURE_2D_TextureSSSColor((coordCenter + offset.zy)/ uTextureSSSColorSize.xy).rgb;\n    vec3 D = TEXTURE_2D_TextureSSSColor((coordCenter - offset.zy)/ uTextureSSSColorSize.xy).rgb;\n\n    // Luminance could be green channel only\n    float a = luminanceLinear(A);\n    float b = luminanceLinear(B);\n    float c = luminanceLinear(C);\n    float d = luminanceLinear(D);\n\n    float ab = abs(a - b);\n    float cd = abs(c - d);\n\n    // take the average in the direction that avoids dither pattern\n    vec3 quant1 = 0.5 * mix(A + B, C + D, ab > cd ? 1.0 : 0.0);\n    vec3 quant0 = TEXTURE_2D_TextureSSSColor(uvCenter).rgb;\n\n    float checker = checkerboard(coordCenter, uHalton);\n    diffuse = mix(quant1, quant0, checker);\n    specular = mix(quant0, quant1, checker);\n}\n\n'},RGp6:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n\nuniform sampler2D TextureSSSColor;\nuniform sampler2D TextureDepth;\nuniform vec2 uTextureSSSColorSize;\n\nuniform vec4 uHalton;\n\n#pragma include "sssCommon.glsl"\n\n// hacky line to force the composerPostprocess to\n// hook texture funciton in sssCommon because pragma defines\n// aren\'t handled directly\n\n// TEXTURE_2D_TextureSSSColor(whatever)\nvec4 sssExtract() {\n    vec4 pack = TEXTURE_2D_TextureDepth(gTexCoord);\n    vec3 specular;\n    vec3 diffuse;\n    uncheckerboard(diffuse, specular);\n\n    // force depth "0.0" to tell sss blur to skip the pixel when blurring\n    // make sure to return float not bool cast to float implicitely\n    // not all glsl compiler support that\n    float bgOrNotSSS = (decodeProfile(pack) == 0 || pack.x == 1.0) ? 0.0 : 1.0;\n    return vec4(diffuse, bgOrNotSSS * decodeDepth(pack));\n}\n'},"/+vK":e=>{"use strict";e.exports="uniform vec4 uHalton;\n\nuniform float uSSAARestart;\nuniform sampler2D TexturePrevious;\nuniform vec2 uTexturePreviousSize;\n\n// static in place amortized supersampling\nvec4 supersample() {\n    vec4 currFragColor = TEXTURE_2D_TextureInput(gTexCoord).rgba;\n\n    float haltz = abs(uHalton.z);\n    if (haltz == 1.0) {\n        // just return the color.\n        return currFragColor;\n    }\n\n    // same pixel for same projected interpolated vertex on prev frame\n    vec4 accumColorN = TEXTURE_2D_NEAREST_TexturePrevious(gTexCoord).rgba;\n\n    // mix frames\n    float lerpFac = 1.0 / uHalton.w;\n\n    // if uTaaSSSRestart is 0.0, then we used the previous TAAed image to start supersampling\n    // we do that to avoid a sudden re-aliasing of the image (which is perceptible)\n    if (uHalton.w == 1.0) lerpFac = uSSAARestart;\n\n    if (haltz == 3.0) {\n        // No supersample, crude motion blur by accumulation\n        return mix(currFragColor, accumColorN, lerpFac);\n    }\n\n    // Supsersample, accumulation + jittering\n    // http://en.wikipedia.org/wiki/Moving_average#Cumulative_moving_average\n    // cumulative moving average over frameNum (which starts at 2)\n    // n is previous frame\n    // accumColorN = Accum(n)\n    // return value is accumColor( n +1 )\n    // Accum(n+1) = Accum(n) + ((x(n+1) - Accum(n)) / (n + 1)))\n    // formula above is equal to glsl  mix\n    return mix(accumColorN, currFragColor, lerpFac);\n}\n"},"6LWN":e=>{"use strict";e.exports='#pragma include "utils/getLuminance.glsl"\n#pragma include "utils/decodeDepth.glsl"\n#pragma include "supersample.glsl"\n\nuniform sampler2D TextureInput;\nuniform vec2 uTextureInputSize;\nuniform sampler2D TexturePrevious;\nuniform vec2 uTexturePreviousSize;\nuniform sampler2D TextureDepth;\n\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\n\nuniform float uTaaEnabled;\nuniform mat4 uTaaMotionMatrixLeft;\nuniform vec4 uTaaCornersCSLeft[2];\n\n#ifdef VR_ENABLED\nuniform mat4 uTaaMotionMatrixRight;\nuniform vec4 uTaaCornersCSRight[2];\n#endif\n\nvec3 reconstructVSPosition(const in vec2 uv, const in vec4 corners0, const in vec4 corners1, const in float depth) {\n    vec2 finalUv = uv;\n#ifdef VR_ENABLED\n    float xViewportOffset = uv.x >= 0.5 ? -0.5 : 0.0;\n    finalUv.x = ( uv.x + xViewportOffset ) * 2.0;\n#endif\n\n    // the corners are in view space, it means if we interpolate between them we can retrieve the view space direction of the fragment\n    vec4 AB = mix(corners0, corners1, vec4(finalUv.x));\n\n    // multiply this view space direction by the depth gives us the view space position\n    return vec3(mix(AB.xy, AB.zw, vec2(finalUv.y)), 1.0) * depth;\n}\n\n#define NEIGHBOUR_SET_IF_DMIN_Z_GREATER(d, x, y) if(d < dmin.z) dmin = vec3(x, y, d);\n#define NEIGHBOUR_CREATE_FROM_OFFSET(d, x, y) d = decodeDepth(TEXTURE_2D_TextureDepth(uv + vec2(x,y)));\n#define FIND_NEIGHBOUR_MIN(d, x, y) NEIGHBOUR_CREATE_FROM_OFFSET(d, x, y); NEIGHBOUR_SET_IF_DMIN_Z_GREATER(d, x, y)\n\n\n// Neighborhood clamping from Tiago Sousa\n// 4tap(decent) comment t, ml, mr, b\n// https://github.com/playdeadgames/temporal/blob/9e6a7704e69bb73f29fe393390e545b21ddfd42d/Assets/Shaders/IncDepth.cginc#L111\n// 9Tap(good) slower but nicer\n// https://github.com/playdeadgames/temporal/blob/9e6a7704e69bb73f29fe393390e545b21ddfd42d/Assets/Shaders/IncDepth.cginc#L37\n//#define CLOSEST_9TAP\nvec3 closestFragment(const in vec2 uv, const in vec2 texelSize) {\n\n    float d;\n    vec2 size = 2.0 * texelSize;\n    vec3 dmin = vec3(0.0, 0.0, 0.0);\n\n    // 5Tap\n    NEIGHBOUR_CREATE_FROM_OFFSET(dmin.z, 0.0, 0.0);\n    FIND_NEIGHBOUR_MIN(d, -size.x, size.y);\n    FIND_NEIGHBOUR_MIN(d, size.x, size.y);\n    FIND_NEIGHBOUR_MIN(d, -size.x, -size.y);\n    FIND_NEIGHBOUR_MIN(d, size.x, -size.y);\n\n#ifdef CLOSEST_9TAP\n    FIND_NEIGHBOUR_MIN(d, 0.0, size.y);\n    FIND_NEIGHBOUR_MIN(d, -size.x, 0.0);\n    FIND_NEIGHBOUR_MIN(d, size.x, 0.0);\n    FIND_NEIGHBOUR_MIN(d, 0.0, -size.y);\n#endif\n\n    return vec3(uv + dmin.xy, dmin.z);\n}\n\n// note: only clips towards aabb center (but fast!)\n// same as https://github.com/gokselgoktas/temporal-anti-aliasing/blob/master/Assets/Resources/Shaders/TemporalAntiAliasing.cginc#L199\n// which is adapted from https://github.com/playdeadgames/temporal\n// using the mathematical similar version of https://twitter.com/Stubbesaurus/status/890154773726580736\n// exhibits numerical issue (in a consistent way on intel/nvidia at least)\nvec4 clip_aabb_opti(const in vec4 minimum, const in vec4 maximum, const in vec4 color) {\n    const float eps = 0.00000001;\n\n    vec4 center = 0.5 * (maximum + minimum);\n    vec4 extents = 0.5 * (maximum - minimum) + eps;\n    vec4 offset = color - center;\n\n    vec4 ts = abs(offset / extents);\n    float t = max(max(ts.r, ts.g), max(ts.b, ts.a));\n    return center + offset / max(1.0, t);\n    // return t > 1.0 : center + offset / t : color;\n}\n\nvec4 taa(const in vec2 ssVel, const in vec2 texelSize) {\n    vec2 uv = gTexCoord;\n\n    vec4 tl = TEXTURE_2D_TextureInput(uv + vec2(-texelSize.x, texelSize.y));\n    vec4 t  = TEXTURE_2D_TextureInput(uv + vec2(0.0, texelSize.y));\n    vec4 tr = TEXTURE_2D_TextureInput(uv + vec2(texelSize.x, texelSize.y));\n\n    vec4 ml = TEXTURE_2D_TextureInput(uv + vec2(-texelSize.x, 0.0));\n    vec4 m  = TEXTURE_2D_TextureInput(uv);\n    vec4 mr = TEXTURE_2D_TextureInput(uv + vec2(texelSize.x, 0.0));\n\n    vec4 bl = TEXTURE_2D_TextureInput(uv + vec2(-texelSize.x, -texelSize.y));\n    vec4 b  = TEXTURE_2D_TextureInput(uv + vec2(0.0, -texelSize.y));\n    vec4 br = TEXTURE_2D_TextureInput(uv + vec2(texelSize.x, -texelSize.y));\n\n    // sharpen\n    // https://github.com/Unity-Technologies/PostProcessing/blob/v1/PostProcessing/Resources/Shaders/TAA.cginc#L143\n    // reduces blurring, but increases flickering with dense geometry\n    vec4 corners = 2.0 * (tr + bl + br + tl) - 2.0 * m;\n    m += (m - (corners * 0.166667)) * 2.718282 * 0.3;\n    m = max(vec4(0.0), m);\n\n    // Brian Karis neighbourhood rounding: http://advances.realtimerendering.com/s2014/epic/TemporalAA.pptx\n    // average of rounded pattern with cross pattern\n    vec4 cmin5 = min(mr, min(m, min(ml, min(t, b))));\n    vec4 cmin = min(cmin5, min(tl, min(tr, min(bl, br))));\n\n    vec4 cmax5 = max(mr, max(m, max(ml, max(t, b))));\n    vec4 cmax = max(cmax5, max(tl, max(tr, max(bl, br))));\n\n    cmin = 0.5 * (cmin + cmin5);\n    cmax = 0.5 * (cmax + cmax5);\n\n    vec4 previousColor = TEXTURE_2D_TexturePrevious(uv - ssVel);\n    previousColor = clip_aabb_opti(cmin, cmax, previousColor);\n\n    float lum0 = getLuminance(m.rgb);\n    float lum1 = getLuminance(previousColor.rgb);\n    float diff = abs(lum0 - lum1) / max(lum0, max(lum1, 0.2));\n    float unbiased_weight = 1.0 - diff;\n    float feedback = mix(FEEDBACK_MIN, FEEDBACK_MAX, unbiased_weight * unbiased_weight);\n\n    return mix(m, previousColor, feedback);\n}\n\nvec2 computeSSVelocity(const in vec2 pixelPos, const in vec3 vsPos, const in mat4 motionMatrix, const in bool rightEye) {\n    vec4 screenSpaceNDCPrevPosition = motionMatrix * vec4(vsPos, 1.0);\n    vec2 ndcPrev = screenSpaceNDCPrevPosition.xy / screenSpaceNDCPrevPosition.w;\n\n    if(ndcPrev.x >= 1.0 || ndcPrev.x <= -1.0 ||\n       ndcPrev.y >= 1.0 || ndcPrev.y <= -1.0)\n        return vec2(0.0);\n    \n    vec2 ndcCurrent = pixelPos * 2.0 - 1.0;\n    \n#ifdef VR_ENABLED\n    ndcCurrent.x /= 2.0;\n    ndcPrev.x /= 2.0;\n\n    if (rightEye) {\n        ndcCurrent.x += 0.5;\n        ndcPrev.x += 0.5;\n    }\n#endif\n\n    return 0.5 * (ndcCurrent - ndcPrev);\n}\n\n\nvec4 computeTaa(const in mat4 motionMatrix, const in vec4 corners0, const in vec4 corners1, const in bool rightVR) {\n    vec2 uv = gTexCoord;\n    float haltz = abs(uHalton.z);\n    if (haltz == 1.0) {\n        vec2 texelSize = vec2(1.0) / uTextureInputSize;\n        vec3 closest = closestFragment(uv, texelSize);\n\n        // discard background fragments to save fillrate\n        // make sure the mesh isn\'t transparent\n        if (closest.z >= 1.0\n#ifdef TAA_TRANSPARENT\n            && decodeAlpha(TEXTURE_2D_TextureDepth(closest.xy)) == 0.0\n#endif\n        ) {\n            // unjitter for fixed background with highres pattern or text\n            return TEXTURE_2D_TextureInput(uv - 0.5 * uHalton.xy * texelSize);\n        }\n\n        float depth = -(uNearFar.x + (uNearFar.y - uNearFar.x) * closest.z);\n        vec3 viewSpace = reconstructVSPosition(closest.xy, corners0, corners1, depth);\n        vec2 ssVel = computeSSVelocity(closest.xy, viewSpace, motionMatrix, rightVR);        \n        \n        return taa(ssVel, texelSize);\n    }\n\n    return supersample();\n}\n\n// temporal anti-aliasing from Playdead\'s Inside\n// slides: http://www.gdcvault.com/play/1022970/Temporal-Reprojection-Anti-Aliasing-in\n// sources: https://github.com/playdeadgames/temporal\nvec4 supersampleTaa() {\n    if (uTaaEnabled == 0.0) {\n        return supersample();\n    }\n\n#ifdef VR_ENABLED\n    // left and right eyes have different matrices\n    if (gTexCoord.x >= 0.5) {\n        return computeTaa(uTaaMotionMatrixRight, uTaaCornersCSRight[0], uTaaCornersCSRight[1], true);\n    }\n#endif\n\n    return computeTaa(uTaaMotionMatrixLeft, uTaaCornersCSLeft[0], uTaaCornersCSLeft[1], false);\n}\n'},Mg89:e=>{"use strict";e.exports='#pragma include "utils/getLuminance.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\nuniform float uToneExposure;\nuniform float uToneBrightness;\nuniform float uToneContrast;\nuniform float uToneSaturation;\nuniform int uToneMethod;\n\n#ifdef HAS_FIXED_BACKGROUND\nuniform sampler2D TextureDepth;\n#endif\n\nvec3 toneMapping(const in vec3 color) {\n    vec3 col = color * uToneExposure;\n    float luminance = dot(col * (1.0 + uToneBrightness), vec3(0.2126, 0.7152, 0.0722));\n    col = mix(vec3(luminance), col * (1.0 + uToneBrightness), vec3(uToneSaturation));\n\n    // contrast is annoying and require special treatment in case of fixed background\n    // because it doesn\'t output black when the input is black\n    float toneContrast = uToneContrast;\n#ifdef HAS_FIXED_BACKGROUND\n    float alpha = decodeAlpha(TEXTURE_2D_TextureDepth(gTexCoord));\n    if(alpha == 0.0) toneContrast *= luminance;\n#endif\n    col = max(vec3(0.0), col * (1.0 + toneContrast) - 0.5 * toneContrast);\n\n    // simple reinhard and filmic\n    // http://filmicgames.com/archives/190\n    if(uToneMethod == 1) { // reinhard (on luminance)\n        col /= 1.0 + getLuminance(col);\n    } else if( uToneMethod == 2) { // filmic\n        vec3 x = max(vec3(0.0), col - 0.004);\n        col = (x * (6.2 * x + 0.5) ) / ( x * (6.2 * x + 1.7) + 0.06);\n        col = pow(col, vec3(2.2)); // filmic curve already encode srgb to linear\n    }\n\n    return col;\n}\n\nvec4 toneMapping(const in vec4 color) {\n    return vec4(toneMapping(color.rgb), 1.0);\n}\n'},N4IH:e=>{"use strict";e.exports="uniform float uVrVeilFactor;\r\n\r\nvec4 veilVr(const in vec4 color) {\r\n\treturn vec4(color.rgb * uVrVeilFactor, 1.0);\r\n}"},"ZE7+":e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n#pragma include "utils/rand.glsl"\n\nuniform vec2 uLensRadius;\nuniform float uFrameMod;\n\nfloat vignetteDithered() {\n    vec2 lens = uLensRadius;\n    // smoothesp is not realiable with edge0 == edge1\n    lens.y = min(lens.y, lens.x - 1e-4);\n\n    float jitter = interleavedGradientNoise(gl_FragCoord.xy, uFrameMod);\n\n    // jitter a bit the uv to remove the banding in some cases\n    // (lens.x - lens.y) reduce flickering when the vignette is harder (hardness)\n    // (lens.x + lens.y) reduce the flickering when the vignette has a strong radius\n    jitter = (lens.x - lens.y) * (lens.x + lens.y) * 0.07 * (jitter - 0.5);\n    return smoothstep(lens.x, lens.y, jitter + distance(gTexCoord, vec2(0.5)));\n}\n\nvec4 vignette(const in vec4 color) {\n    float factor = vignetteDithered();\n    return vec4(linearTosRGB(sRGBToLinear(color.rgb) * factor), clamp(color.a + (1.0 - factor), 0.0, 1.0));\n}'},BzYw:e=>{"use strict";e.exports='uniform float uRGBMRange;\nuniform int uOutputLinear;\n\n// stuffs (ssr, opacity, scattering)\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform int uDrawOpaque;\n\n//////////\n// VARYING\n//////////\n\n#ifdef HAS_OPACITY_REFRACTION\n    varying vec3 vViewNormal;\n    varying vec4 vViewVertex;\n#endif\n\n#pragma include "utils/common.glsl"\n#pragma include "utils/functions.glsl"\n#pragma include "utils/material.glsl"\n#pragma include "utils/decodeDepth.glsl"\n#pragma include "utils/rand.glsl"\n\n#ifdef HAS_OPACITY_REFRACTION\n#pragma include "utils/refraction.glsl"\n#endif\n\nvoid main() {\n    //////////////////\n    // OPACITY DISCARD\n    //////////////////\n#ifdef HAS_POINT_CIRCLE\n    if (length(2.0 * gl_PointCoord - 1.0) > 1.0) discard;\n#endif\n\n#ifdef HAS_ALPHAMASK\n    if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n#endif\n\n#ifdef HAS_OPACITY_DITHER\n    ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n#endif\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    float alpha = getMaterialOpacity();\n    float alphaFinal = alpha * float(1 - uOpacityAdditive);\n    if (alpha == 0.0 || (uDrawOpaque == 1 && alphaFinal < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaFinal >= EPSILON_ALPHA)) discard;\n#endif\n\n    // /!\\ because of refraction roughness, this part should be done before the call to getMetalness/getSpecular\n#ifdef HAS_OPACITY_REFRACTION\n    gRefractionRoughness = uOpacityRoughnessFactor;\n    float alphaRefraction = getMaterialOpacity();\n    if ((uDrawOpaque == 1 && alphaRefraction < EPSILON_ALPHA) || (uDrawOpaque == 0 && alphaRefraction >= EPSILON_ALPHA)) discard;\n#endif\n\n    ///////////\n    // GEOMETRY\n    ///////////\n#ifdef HAS_OPACITY_REFRACTION\n    vec3 eyeVector = -normalize(vViewVertex.xyz);\n    vec3 frontNormal = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n#endif\n\n    ///////////\n    // MATERIAL\n    ///////////\n#if defined(HAS_LEGACY_CLASSIC)\n    vec3 materialDiffuse = getMaterialLegacyDiffuse();\n#elif defined(HAS_ALBEDOPBR)\n    vec3 materialDiffuse = getMaterialAlbedo();\n#else\n    vec3 materialDiffuse = getMaterialDiffuse();\n#endif\n\n#ifdef HAS_AOPBR\n    float materialAO = getMaterialAO();\n#endif\n\n#ifdef HAS_EMITCOLOR\n    vec3 materialEmit = getMaterialEmitColor();\n#endif\n\n#ifdef HAS_CAVITYPBR\n    float materialCavity = getMaterialCavity();\n#endif\n\n    vec3 diffuse = materialDiffuse;\n\n#ifdef HAS_AOPBR\n    diffuse *= materialAO;\n#endif\n\n    /////////////\n    // REFRACTION\n    /////////////\n#ifdef HAS_OPACITY_REFRACTION\n\n    #ifdef HAS_REFRACTION_NORMAL_OFFSET\n        vec3 refractLight = refraction(gRefractionRoughness, frontNormal.xyz, frontNormal.xyz, eyeVector.xyz);\n    #else\n        vec3 refractLight = refraction(gRefractionRoughness, frontNormal.xyz, eyeVector.xyz);\n    #endif\n\n    #ifdef HAS_REFRACTION_ALBEDO_TINT\n        refractLight *= materialDiffuse;\n    #endif\n\n    diffuse = mix(refractLight, diffuse, alphaRefraction);\n#endif // HAS_OPACITY_REFRACTION\n\n    vec3 frag = diffuse;\n\n#ifdef HAS_EMITCOLOR\n    frag = uEmitMultiplicative == 1 ? frag * materialEmit : frag + materialEmit;\n#endif\n\n#ifdef HAS_CAVITYPBR\n    frag *= materialCavity;\n#endif\n\n    // premult\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    frag *= alpha;\n#endif\n\n    if (uOutputLinear != 1) frag = linearTosRGB(frag);\n\n#ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n    gl_FragColor = uDrawOpaque == 1 ? encodeRGBM(frag, uRGBMRange) : vec4(frag, alphaFinal);\n#else\n    gl_FragColor = encodeRGBM(frag, uRGBMRange);\n#endif\n}\n'},LB4S:e=>{"use strict";e.exports='#pragma include "pbr.vert"\n'},mAxk:e=>{"use strict";e.exports='// opacity\nuniform vec4 uHalton;\nuniform vec2 uNearFar;\nuniform float uFrameMod;\nuniform int uDrawOpaque;\n\nuniform vec4 uShadowDepthRange;\n\nvarying vec4 vViewVertex;\n\n#pragma include "utils/material.glsl"\n\n#ifdef HAS_OPACITY\n#pragma include "utils/material.glsl"\n#pragma include "utils/rand.glsl"\n#endif\n\nvec4 encodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n    return enc;\n}\n\nvoid main() {\n#ifdef HAS_ALPHAMASK\n  if (getMaterialAlphaMask() < uAlphaMaskFactor) discard;\n#endif\n#ifdef HAS_OPACITY_DITHER\n    ditheringMaskingDiscard(gl_FragCoord, uOpacityDithering, getMaterialOpacity(), uOpacityFactor, uOpacityThinLayer, uFrameMod, uNearFar, uHalton);\n#endif\n\n#if defined(HAS_OPACITY_BLEND_OR_ADDITIVE) || defined(HAS_OPACITY_REFRACTION)\n    if (getMaterialOpacity() < EPSILON_ALPHA) discard;\n#endif\n\n    gl_FragColor = encodeFloatRGBA((-vViewVertex.z - uShadowDepthRange.x) / (uShadowDepthRange.y - uShadowDepthRange.x));\n}\n'},"1bMp":e=>{"use strict";e.exports='uniform vec2 uShadowMapSize;\n#define SHADOW_CAST\n#define HAS_VIEW_VERTEX\n#pragma include "base.vert"\n'},HMIp:e=>{"use strict";e.exports="float decodeFloatRGBA(const in vec4 rgba) {\n    return dot(rgba, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\n\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return  decodeFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).x;\n#endif\n}\n\n// simulation of texture2Dshadow glsl call on HW\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\nfloat texture2DCompare(const in sampler2D depths,\n                       const in vec2 uv,\n                       const in float compare,\n                       const in vec4 clampDimension){\n    float depth = getSingleFloatFromTex(depths, clamp(uv, clampDimension.xy, clampDimension.zw));\n    return compare - depth;\n}\n\n#ifdef _JITTER_OFFSET\n// TODO could be in a random.glsl file\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/Random.ush#L27\nfloat shadowInterleavedGradientNoise(const in vec2 fragCoord, const in float frameMod) {\n    vec3 magic = vec3(0.06711056, 0.00583715, 52.9829189);\n    return fract(magic.z * fract(dot(fragCoord.xy + frameMod * vec2(47.0, 17.0) * 0.695, magic.xy)));\n}\n#endif\n\n// simulates linear fetch like texture2d shadow\nfloat texture2DShadowLerp(\n    const in sampler2D depths,\n    const in vec2 size,\n    const in vec2 uv,\n    const in float compare,\n    const in vec4 clampDimension\n    OPT_ARG_outDistance\n    OPT_ARG_jitter){\n\n    vec2 centroidCoord = uv / size.xy;\n\n#ifdef _JITTER_OFFSET\n    if (jitter > 0.0){\n        centroidCoord += shadowInterleavedGradientNoise(gl_FragCoord.xy, jitter);\n    }\n#endif\n\n    centroidCoord = centroidCoord + 0.5;\n    vec2 f = fract(centroidCoord);\n    vec2 centroidUV = floor(centroidCoord) * size.xy;\n\n    vec4 fetches;\n    const vec2 shift  = vec2(1.0, 0.0);\n    fetches.x = texture2DCompare(depths, centroidUV + size.xy * shift.yy, compare, clampDimension);\n    fetches.y = texture2DCompare(depths, centroidUV + size.xy * shift.yx, compare, clampDimension);\n    fetches.z = texture2DCompare(depths, centroidUV + size.xy * shift.xy, compare, clampDimension);\n    fetches.w = texture2DCompare(depths, centroidUV + size.xy * shift.xx, compare, clampDimension);\n\n#ifdef _OUT_DISTANCE\n    float _a = mix(fetches.x, fetches.y, f.y);\n    float _b = mix(fetches.z, fetches.w, f.y);\n    outDistance = mix(_a, _b, f.x);\n#endif\n\n    vec4 st = step(fetches, vec4(0.0));\n\n    float a = mix(st.x, st.y, f.y);\n    float b = mix(st.z, st.w, f.y);\n    return mix(a, b, f.x);\n}\n"},j6Sw:e=>{"use strict";e.exports="#extension GL_OES_standard_derivatives : enable\n\n%UNROLL 4%\n#ifdef HAS_SHADOW_%ID%\n    uniform float uShadowReceive%ID%_bias;\n    uniform float uStaticFrameNumShadow%ID%;\n    uniform vec2 uShadow_Texture%ID%_depthRange;\n    uniform vec3 uShadow_Texture%ID%_projection;\n    uniform vec4 uShadow_Texture%ID%_viewLook;\n    uniform vec4 uShadow_Texture%ID%_viewRight;\n    uniform vec4 uShadow_Texture%ID%_viewUp;\n\n    #ifdef _ATLAS_SHADOW\n        uniform vec4 uShadow_Texture%ID%_mapSize;\n    #else\n        uniform vec2 uShadow_Texture%ID%_renderSize;\n    #endif\n#endif // HAS_SHADOW\n%%\n\n// TODO rename sampler uniform to be better and sync with light number (e.g: sShadow0, sShadow1, etc)\n#ifdef _ATLAS_SHADOW\n    uniform vec2 uShadow_Texture0_renderSize;\n    uniform sampler2D Texture7;\n#else\n    #ifdef HAS_SHADOW_0\n        uniform sampler2D Texture12;\n        #define TEX_SHADOW_0 Texture12\n    #endif\n    #ifdef HAS_SHADOW_1\n        uniform sampler2D Texture13;\n        #define TEX_SHADOW_1 Texture13\n    #endif\n    #ifdef HAS_SHADOW_2\n        uniform sampler2D Texture14;\n        #define TEX_SHADOW_2 Texture14\n    #endif\n    #ifdef HAS_SHADOW_3\n        uniform sampler2D Texture15;\n        #define TEX_SHADOW_3 Texture15\n    #endif\n#endif // _ATLAS_SHADOW\n\n#ifdef _OUT_DISTANCE\n#define OPT_ARG_outDistance ,out float outDistance\n#define OPT_INSTANCE_ARG_outDistance ,outDistance\n#else\n#define OPT_ARG_outDistance\n#define OPT_INSTANCE_ARG_outDistance\n#endif\n\n#ifdef _ATLAS_SHADOW\n#define OPT_ARG_atlasSize ,const in vec4 atlasSize\n#else\n#define OPT_ARG_atlasSize\n#endif\n\n#ifdef _NORMAL_OFFSET\n#define OPT_ARG_normalBias ,const in float normalBias\n#else\n#define OPT_ARG_normalBias\n#endif\n\n#ifdef _JITTER_OFFSET\n#define OPT_ARG_jitter ,const in float jitter\n#define OPT_INSTANCE_ARG_jitter ,jitter\n#else\n#define OPT_ARG_jitter\n#define OPT_INSTANCE_ARG_jitter\n#endif\n\n#pragma include \"shadowing/tapPCF.glsl\"\n\nfloat shadowReceive(const in bool lighted,\n                    const in vec3 normalWorld,\n                    const in vec3 vertexWorld,\n\n                    const in sampler2D shadowTexture,\n\n                    const in vec2 shadowSize,\n                    const in vec3 shadowProjection,\n\n                    const in vec4 shadowViewRight,\n                    const in vec4 shadowViewUp,\n                    const in vec4 shadowViewLook,\n\n\n                    const in vec2 shadowDepthRange,\n                    const in float shadowBias\n                    OPT_ARG_atlasSize\n                    OPT_ARG_normalBias\n                    OPT_ARG_outDistance\n                    OPT_ARG_jitter) {\n\n    // 0 for early out\n    bool earlyOut = false;\n\n    // Calculate shadow amount\n    float shadow = 1.0;\n\n    if (!lighted) {\n        shadow = 0.0;\n#ifndef _OUT_DISTANCE\n        earlyOut = true;\n#endif // _OUT_DISTANCE\n    }\n\n    if (shadowDepthRange.x == shadowDepthRange.y) {\n        earlyOut = true;\n    }\n\n    vec4 shadowVertexEye;\n    vec4 shadowNormalEye;\n    float shadowReceiverZ = 0.0;\n    vec4 shadowVertexProjected;\n    vec2 shadowUV;\n    float N_Dot_L;\n    float invDepthRange;\n\n    if (!earlyOut) {\n\n        shadowVertexEye.x = dot(shadowViewRight.xyz, vertexWorld.xyz) + shadowViewRight.w;\n        shadowVertexEye.y = dot(shadowViewUp.xyz, vertexWorld.xyz) + shadowViewUp.w;\n        shadowVertexEye.z = dot(shadowViewLook.xyz, vertexWorld.xyz) + shadowViewLook.w;\n        shadowVertexEye.w = 1.0;\n\n\n        // derivated, only need z.\n        //vec3 shadowLightDir = vec3(0.0, 0.0, 1.0); // in shadow view light is camera\n        //shadowNormalEye =  shadowViewMatrix * normalFront;\n        //shadowNormalEye.x = dot(shadowViewRight.xyz, normalWorld.xyz);\n        //shadowNormalEye.y = dot(shadowViewUp.xyz, normalWorld.xyz);\n        shadowNormalEye.z = dot(shadowViewLook.xyz, normalWorld.xyz);\n        //shadowNormalEye.w = 0.0;\n\n        //N_Dot_L = dot(shadowNormalEye.xyz, shadowLightDir);\n        N_Dot_L = shadowNormalEye.z;\n\n        if (!earlyOut) {\n\n            invDepthRange = 1.0 / (shadowDepthRange.y - shadowDepthRange.x);\n\n#ifdef _NORMAL_OFFSET\n\n            // http://www.dissidentlogic.com/old/images/NormalOffsetShadows/GDC_Poster_NormalOffset.png\n            float normalOffsetScale = clamp(1.0  - N_Dot_L, 0.0 , 1.0);\n            normalOffsetScale *= abs((shadowVertexEye.z - shadowDepthRange.x) * invDepthRange);\n            normalOffsetScale *= max(shadowProjection.x, shadowProjection.y);\n            normalOffsetScale *= normalBias * invDepthRange;\n\n\n            vec4 shadowNormalShift =  vec4(normalWorld, 0.0) * normalOffsetScale;\n            shadowNormalEye.x = dot(shadowViewRight.xyz, shadowNormalShift.xyz);\n            shadowNormalEye.y = dot(shadowViewUp.xyz, shadowNormalShift.xyz);\n            shadowNormalEye.z = dot(shadowViewLook.xyz, shadowNormalShift.xyz);\n            shadowNormalEye.w = 0.0;\n\n            vec4 viewShadow = shadowVertexEye + shadowNormalEye;\n#else\n            vec4 viewShadow = shadowVertexEye;\n#endif\n\n\n            if (shadowProjection.z == 0.0){\n\n               // X, 0, 0, 0,\n               // 0, Y, 0, 0,\n               // 0, 0, -1, -1,\n               // 0, 0, -2.0*znear, 0\n               // mat4 shadowProjectionMatrix;\n               // shadowProjectionMatrix[0] = vec4(shadowProjection.x, 0.0, 0.0, 0.0 );\n               // shadowProjectionMatrix[1] = vec4(0.0, shadowProjection.y, 0.0, 0.0 );\n               // shadowProjectionMatrix[2] = vec4(0.0, 0.0, -1.0, -1.0 );\n               // shadowProjectionMatrix[3] = vec4(0.0, 0.0, -2.0*shadowDepthRange.x, 0.0 );\n               // shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\n\n               // derivated optimisation\n               shadowVertexProjected.x = shadowProjection.x * viewShadow.x;\n               shadowVertexProjected.y = shadowProjection.y * viewShadow.y;\n\n               shadowVertexProjected.z = - viewShadow.z - (2.0 * shadowDepthRange.x * viewShadow.w);\n               shadowVertexProjected.w = - viewShadow.z;\n\n            }\n            else{\n                // lr = 1/(left-right);\n                // bt = 1/(bottom-top);\n                // nf = 1/(near-far);\n                // -2*lr,           0,               0,              0,\n                // 0,               -2*bt,           0,              0,\n                // 0,               0,               2*nf,           0.0,\n                // (left+right)*lr, (top+bottom)*bt, (far+near)*nf), 1\n                // here left = -right && top = -bottom\n                // float lr = 1.0 / (-2.0 * shadowProjection.x);\n                // float bt = 1.0 / (-2.0 * shadowProjection.y);\n                // float nf = 1.0 / (shadowDepthRange.x - shadowDepthRange.y);\n                float nfNeg = 1.0 / (shadowDepthRange.x - shadowDepthRange.y);\n                float nfPos = (shadowDepthRange.x + shadowDepthRange.y)*nfNeg;\n\n                //mat4 shadowProjectionMatrix;\n                //shadowProjectionMatrix[0] = vec4(1.0 / shadowProjection.x, 0.0,     0.0,  0.0 );\n                //shadowProjectionMatrix[1] = vec4(0.0,     1.0 / shadowProjection.y, 0.0,  0.0 );\n                //shadowProjectionMatrix[2] = vec4(0.0,     0.0, 2.0*nfNeg, 0.0 );\n                //shadowProjectionMatrix[3] = vec4(0.0,     0.0, nfPos, 1.0 );\n                //shadowdertexProjected = shadowProjectionMatrix * shadowVertexEye;\n\n                // derivated optimisation\n                shadowVertexProjected.x = viewShadow.x / shadowProjection.x;\n                shadowVertexProjected.y = viewShadow.y / shadowProjection.y;\n\n                shadowVertexProjected.z = 2.0 * nfNeg* viewShadow.z + nfPos * viewShadow.w;\n                shadowVertexProjected.w = viewShadow.w;\n\n            }\n\n\n            if (shadowVertexProjected.w < 0.0) {\n                earlyOut = true; // notably behind camera\n            }\n\n        }\n\n        if (!earlyOut) {\n\n            shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\n            shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\n\n            if (any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0.))) {\n                earlyOut = true;// limits of light frustum\n            }\n\n            // most precision near 0, make sure we are near 0 and in [0,1]\n            shadowReceiverZ = - shadowVertexEye.z;\n            shadowReceiverZ =  (shadowReceiverZ - shadowDepthRange.x) * invDepthRange;\n\n            if(shadowReceiverZ < 0.0) {\n                earlyOut = true; // notably behind camera\n            }\n\n        }\n    }\n\n    // pcf pbias to add on offset\n    vec2 shadowBiasPCF = vec2 (0.);\n\n#ifdef GL_OES_standard_derivatives\n#ifdef _RECEIVERPLANEDEPTHBIAS\n    vec2 biasUV;\n\n    vec3 texCoordDY = dFdx(shadowVertexEye.xyz);\n    vec3 texCoordDX = dFdy(shadowVertexEye.xyz);\n\n    biasUV.x = texCoordDY.y * texCoordDX.z - texCoordDX.y * texCoordDY.z;\n    biasUV.y = texCoordDX.x * texCoordDY.z - texCoordDY.x * texCoordDX.z;\n    biasUV *= 1.0 / ((texCoordDX.x * texCoordDY.y) - (texCoordDX.y * texCoordDY.x));\n\n    // Static depth biasing to make up for incorrect fractional sampling on the shadow map grid\n    float fractionalSamplingError = dot(vec2(1.0, 1.0) * shadowSize.xy, abs(biasUV));\n    float receiverDepthBias = min(fractionalSamplingError, 0.01);\n\n    shadowBiasPCF.x = biasUV.x;\n    shadowBiasPCF.y = biasUV.y;\n\n    shadowReceiverZ += receiverDepthBias;\n\n#else // _RECEIVERPLANEDEPTHBIAS\n    shadowBiasPCF.x = clamp(dFdx(shadowReceiverZ) * shadowSize.x, -1.0, 1.0 );\n    shadowBiasPCF.y = clamp(dFdy(shadowReceiverZ) * shadowSize.y, -1.0, 1.0 );\n#endif\n\n#endif // GL_OES_standard_derivatives\n\n\n    vec4 clampDimension;\n\n#ifdef _ATLAS_SHADOW\n    shadowUV.xy  = ((shadowUV.xy * atlasSize.zw ) + atlasSize.xy) * shadowSize.xy;\n\n    // clamp uv bias/filters by half pixel to avoid point filter on border\n    clampDimension.xy = atlasSize.xy + vec2(0.5);\n    clampDimension.zw = (atlasSize.xy + atlasSize.zw) - vec2(0.5);\n\n    clampDimension = clampDimension * shadowSize.xyxy;\n#else\n    clampDimension = vec4(0.0, 0.0, 1.0, 1.0);\n#endif // _RECEIVERPLANEDEPTHBIAS\n\n\n    // now that derivatives is done and we don't access any mipmapped/texgrad texture we can early out\n    // see http://teknicool.tumblr.com/post/77263472964/glsl-dynamic-branching-and-texture-samplers\n    if (earlyOut) {\n        // empty statement because of weird gpu intel bug\n    } else {\n\n        // depth bias: fighting shadow acne (depth imprecsion z-fighting)\n        // cosTheta is dot( n, l ), clamped between 0 and 1\n        // float shadowBias = 0.005*tan(acos(N_Dot_L));\n        // same but 4 cycles instead of 15\n        float depthBias = 0.05 * sqrt( 1.0 - N_Dot_L * N_Dot_L) / clamp(N_Dot_L, 0.0005, 1.0);\n\n        // That makes sure that plane perpendicular to light doesn't flicker due to\n        // selfshadowing and 1 = dot(Normal, Light) using a min bias\n        depthBias = clamp(depthBias, 0.00005, 2.0 * shadowBias);\n\n        // shadowZ must be clamped to [0,1]\n        // otherwise it's not comparable to shadow caster depth map\n        // which is clamped to [0,1]\n        // Not doing that makes ALL shadowReceiver > 1.0 black\n        // because they ALL becomes behind any point in Caster depth map\n        shadowReceiverZ = clamp(shadowReceiverZ, 0.0, 1.0 -depthBias) - depthBias;\n\n        // Now computes Shadow\n        float res = getShadowPCF(shadowTexture,\n                                 shadowSize,\n                                 shadowUV,\n                                 shadowReceiverZ,\n                                 shadowBiasPCF,\n                                 clampDimension\n                                 OPT_INSTANCE_ARG_outDistance\n                                 OPT_INSTANCE_ARG_jitter);\n#ifdef _OUT_DISTANCE\n        if (lighted) shadow = res;\n        outDistance *= shadowDepthRange.y - shadowDepthRange.x; // world space distance\n#else\n        shadow = res;\n#endif  // _OUT_DISTANCE\n    }\n\n    return shadow;\n\n}\n"},"4don":e=>{"use strict";e.exports='#pragma include "shadowing/shadowLinearSoft.glsl"\n\nfloat getShadowPCF(\n    const in sampler2D depths,\n    const in vec2 size,\n    const in vec2 uv,\n    const in float compare,\n    const in vec2 biasPCF,\n    const in vec4 clampDimension\n    OPT_ARG_outDistance\n    OPT_ARG_jitter) {\n\n     float res = 0.0;\n\n     res += texture2DShadowLerp(depths, size, uv + biasPCF, compare, clampDimension OPT_INSTANCE_ARG_outDistance OPT_INSTANCE_ARG_jitter);\n\n\n#if defined(_PCFx1)\n\n#else\n\n    float dx0 = -size.x;\n    float dy0 = -size.y;\n    float dx1 = size.x;\n    float dy1 = size.y;\n\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF, compare, clampDimension OPT_INSTANCE_ARG_outDistance OPT_INSTANCE_ARG_jitter)\n\n    res += TSF(dx0, dx0);\n    res += TSF(dx0, .0);\n    res += TSF(dx0, dx1);\n\n#if defined(_PCFx4)\n\n    res /=4.0;\n\n#elif defined(_PCFx9)\n    res += TSF(.0, dx0);\n    res += TSF(.0, dx1);\n\n    res += TSF(dx1, dx0);\n    res += TSF(dx1, .0);\n    res += TSF(dx1, dx1);\n\n\n    res /=9.0;\n\n#elif defined(_PCFx25)\n\n    float dx02 = 2.0*dx0;\n    float dy02 = 2.0*dy0;\n    float dx2 = 2.0*dx1;\n    float dy2 = 2.0*dy1;\n\n    // complete row above\n    res += TSF(dx0, dx02);\n    res += TSF(dx0, dx2);\n\n    res += TSF(.0, dx02);\n    res += TSF(.0, dx2);\n\n    res += TSF(dx1, dx02);\n    res += TSF(dx1, dx2);\n\n    // two new col\n    res += TSF(dx02, dx02);\n    res += TSF(dx02, dx0);\n    res += TSF(dx02, .0);\n    res += TSF(dx02, dx1);\n    res += TSF(dx02, dx2);\n\n    res += TSF(dx2, dx02);\n    res += TSF(dx2, dx0);\n    res += TSF(dx2, .0);\n    res += TSF(dx2, dx1);\n    res += TSF(dx2, dx2);\n\n\n    res/=25.0;\n\n#endif\n\n#undef TSF\n\n#endif\n    return res;\n}\n/////// end Tap\n'},vKVh:e=>{"use strict";e.exports="float checkerboard(const in vec2 uv, const in vec4 halton) {\n  vec2 flooredUV = floor(uv);\n  return mod((halton.z < 0.0 ? 0.0 : 1.0) + flooredUV.x + flooredUV.y, 2.0);\n}\n"},"9D4N":e=>{"use strict";e.exports='#pragma include "utils/lightsPBR.glsl"\n\n//https://en.wikipedia.org/wiki/Beer%E2%80%93Lambert_law for translucent material absorbtion\nvec3 beerLambert(const float NoV, const float NoL, const vec3 tint, const float d) {\n    // exp(tint * -distance * density)\n    return exp(tint * -(d * ((NoL + NoV) / max(NoL * NoV, 1e-3))));\n}\n\nvec3 getClearCoatAbsorbtion(const in float NoV, const in float NoL, const in float clearCoatFactor) {\n    return mix(vec3(1.0), beerLambert(NoV, NoL, uClearCoatTint, uClearCoatThickness), clearCoatFactor);\n}\n\n// compute Light PBR for clearCoat layer\nvoid computeLightLambertGGXClearCoat(\n    const in float ccNoV,\n    const in vec3 normal,\n    const in vec3 eyeVector,\n    const in float dotNL,\n    const in vec4 precomputeGGX,\n\n    const in float attenuation,\n    const in vec3 lightColor,\n    const in vec3 eyeLightDir,\n\n    const in float clearCoatFactor,\n\n    out vec3 clearCoatSpecular,\n    out vec3 clearCoatAttenuation) {\n\n    if (dotNL <= 0.0) {\n        clearCoatSpecular = vec3(0.0);\n        clearCoatAttenuation = vec3(0.0);\n        return;\n    }\n\n    float ccNoL = saturate(dot(normal, -refract(eyeLightDir, normal, 1.0 / uClearCoatIor)));\n    vec3 clearCoatAbsorption = getClearCoatAbsorbtion(ccNoV, ccNoL, clearCoatFactor);\n\n    vec3 H = normalize(eyeVector + eyeLightDir);\n    float NoH = saturate(dot(normal, H));\n    float VoH = saturate(dot(eyeLightDir, H));\n\n    // distribution / visibility / fresnel\n    float D = D_GGX(precomputeGGX, NoH);\n    float V = V_SmithCorrelated(precomputeGGX, ccNoL);\n    float F = F_Schlick(uClearCoatF0, 1.0, VoH);\n\n    clearCoatSpecular = (attenuation * dotNL * clearCoatFactor * D * V * PI * F) * lightColor;\n    clearCoatAttenuation = (1.0 - F * clearCoatFactor) * clearCoatAbsorption;\n}\n'},K0P0:e=>{"use strict";e.exports="#define PI 3.141593\n#define saturate(_x) clamp(_x, 0., 1.)\n"},HNW4:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\n\n// used by background.frag\nvec3 textureCubeFixed(const in samplerCube tex, const in vec3 R, const in float size) {\n    vec3 dir = R;\n    float scale = 1.0 - 1.0 / size;\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 absDir = abs(dir);\n    float M = max(max(absDir.x, absDir.y), absDir.z);\n\n    if (absDir.x != M) dir.x *= scale;\n    if (absDir.y != M) dir.y *= scale;\n    if (absDir.z != M) dir.z *= scale;\n\n    return LUVToRGB(textureCube(tex, dir));\n}\n'},SyQS:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\r\n\r\n#extension GL_EXT_shader_texture_lod : enable\r\nvec3 prefilterEnvMapCube(const in float rLinear, const in vec3 R) {\r\n    vec3 dir = R;\r\n    float lod = min(uTextureEnvironmentSpecularPBRLodRange.x, linRoughnessToMipmap(rLinear) * uTextureEnvironmentSpecularPBRLodRange.y);\r\n\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / uTextureEnvironmentSpecularPBRTextureSize.x;\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\r\n    return LUVToRGB(textureCubeLodEXT(sSpecularPBR, dir, lod));\r\n}\r\n'},g8iT:e=>{"use strict";e.exports="#extension GL_OES_standard_derivatives : enable\n\nuniform float uMatcapCurvature;\nuniform mat4 uProjectionMatrix;\n\n// http://madebyevan.com/shaders/curvature/\nfloat getCurvature(const in vec3 normal) {\n#ifndef GL_OES_standard_derivatives\n    return 1.0;\n#else\n  if (uMatcapCurvature == 0.0) return 1.0;\n\n  // Compute curvature\n  vec3 dx = dFdx(normal);\n  vec3 dy = dFdy(normal);\n  vec3 xneg = normal - dx;\n  vec3 xpos = normal + dx;\n  vec3 yneg = normal - dy;\n  vec3 ypos = normal + dy;\n\n  float factor =  uMatcapCurvature / (length(vViewVertex.xyz) * atan(-1.0 / uProjectionMatrix[2][3]));\n  float curvature = (cross(xneg, xpos).y - cross(yneg, ypos).x) * factor;\n\n  float curvDirt = clamp(-curvature * 1.5, 0.0, 1.0);\n  float curvEdge = clamp(curvature * 2.5, 0.0, 1.0);\n\n  float factorDirt = mix(1.0, 0.3, curvDirt);\n  float factorEdge = 2.0;\n\n  return mix(factorDirt, factorEdge, curvEdge);\n#endif\n}\n"},I6qS:e=>{"use strict";e.exports="int decodeProfile(const in vec4 pack) {\n    float packValue = floor(pack.b * 255.0 + 0.5);\n    // we extract the 2 lowest bits\n    float profile = mod(packValue, 2.0);\n    profile += mod(packValue - profile, 4.0);\n    return int(profile);\n}\n\nfloat decodeDepth(const in vec4 pack) {\n    if(decodeProfile(pack) == 0){\n        const vec3 decode = 1.0 / vec3(1.0, 255.0, 65025.0);\n        return dot(pack.rgb, decode);\n    }\n\n    return pack.r + pack.g / 255.0;\n}\n\nfloat decodeScatter(const in vec4 pack) {\n  // avoid huge number, summation, division and associated loss of precision\n  // by deriving the whole computation to the end\n  // As floor is with mod(x,y) = x - y * floor(x/y)\n\n  // float scatter = pack.b - mod(pack.b, 4.0 / 255.0);\n  // float scatter = pack.b - pack.b  +  (4.0 /255.0) * floor(pack.b / (4.0 /255.0));\n  // float scatter = (4.0 /255.0) * floor(pack.b / (4.0 / 255.0));\n  float scatter = (4.0 / 255.0) * floor(pack.b * 255.0 * 0.25);\n\n  //return scatter * 255.0 / 4.0 / 63.0;\n  return scatter * 1.0119047619;\n}\n\nfloat decodeAlpha(const in vec4 pack) {\n    return pack.a;\n}\n\nfloat distanceToDepth(const in sampler2D depth, const in vec2 uv, const in vec4 viewPos, const vec2 nearFar) {\n    float fragDepth = clamp( (-viewPos.z * viewPos.w - nearFar.x) / (nearFar.y - nearFar.x), 0.0, 1.0);\n    return fragDepth - decodeDepth(texture2D(depth, uv));\n}\n"},mSVJ:e=>{"use strict";e.exports="vec3 encode24(const in float x){\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n    vec3 pack = vec3(code * x);\n    pack.gb = fract(pack.gb);\n    pack.rg -= pack.gb * (1.0 / 256.0);\n    return pack;\n}\n\nfloat decode24(const in vec3 x) {\n    const vec3 decode = 1.0 / vec3(1.0, 255.0, 65025.0);\n    return dot(x, decode);\n}\n"},"M+L8":e=>{"use strict";e.exports="// random links on packing :\n// cesium attributes packing\n// https://cesiumjs.org/2015/05/18/Vertex-Compression/\n\n// float packing in 24 bits or 32 bits\n// https://skytiger.wordpress.com/2010/12/01/packing-depth-into-color/\n\nvec4 encodeDepthAlphaProfileScatter(const in float depth, const in float alpha, const in float profile, const in float scatter) {\n    vec4 pack = vec4(0.0);\n\n    // opacity in alpha\n    pack.a = alpha;\n\n    if(profile == 0.0) {\n        const vec3 code = vec3(1.0, 255.0, 65025.0);\n        pack.rgb = vec3(code * depth);\n        pack.gb = fract(pack.gb);\n        pack.rg -= pack.gb * (1.0 / 256.0);\n    } else {\n        // depth in rg\n        pack.g = fract(depth * 255.0);\n        pack.r = depth - pack.g / 255.0;\n\n        // scatter 6 bits\n        pack.b = floor(0.5 + scatter * 63.0) * 4.0 / 255.0;\n    }\n\n    // profile on 2 lower bits\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n    pack.b += profile / 255.0; // 3 profile possible for sss\n\n    return pack;\n}\n"},FiKZ:e=>{"use strict";e.exports='uniform float uEnvironmentExposure;\r\nuniform mat3 uEnvironmentTransform;\r\nuniform vec2 uTextureEnvironmentSpecularPBRLodRange;\r\nuniform vec2 uTextureEnvironmentSpecularPBRTextureSize;\r\nuniform vec3 uDiffuseSPH[9];\r\n\r\n#ifdef HAS_ENVIRONMENT_BRDF\r\nuniform sampler2D sIntegrateBRDF;\r\n#endif\r\n\r\nvec3 computeDiffuseSPH(const in vec3 normal) {\r\n    vec3 n = uEnvironmentTransform * normal;\r\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\r\n    vec3 result =\r\n        uDiffuseSPH[0] +\r\n        uDiffuseSPH[1] * n.y +\r\n        uDiffuseSPH[2] * n.z +\r\n        uDiffuseSPH[3] * n.x +\r\n        uDiffuseSPH[4] * n.y * n.x +\r\n        uDiffuseSPH[5] * n.y * n.z +\r\n        uDiffuseSPH[6] * (3.0 * n.z * n.z - 1.0) +\r\n        uDiffuseSPH[7] * (n.z * n.x) +\r\n        uDiffuseSPH[8] * (n.x * n.x - n.y * n.y);\r\n     return max(result, vec3(0.0));\r\n}\r\n\r\n#ifndef HAS_LEGACY_CLASSIC\r\n\r\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/BRDF.ush#L202\r\nvec3 integrateBRDF(const in vec3 specular, const in float roughness, const in float NoV, const in float f90) {\r\n#ifdef HAS_ENVIRONMENT_BRDF\r\n    vec4 rgba = texture2D(sIntegrateBRDF, vec2(NoV, roughness));\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0);\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0);\r\n    const float div = 1.0 / 65535.0;\r\n    return (specular * a + b * f90) * div;\r\n#else\r\n    // https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\n    // TODO should we use somehow specular f0 ?\r\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\r\n    const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\r\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\r\n    return specular * AB.x + AB.y * f90;\r\n#endif\r\n}\r\n\r\n// Frostbite, Lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap(const in float roughnessLinear) {\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\n#ifdef ENV_CUBEMAP\r\nuniform samplerCube sSpecularPBR;\r\n#pragma include "utils/cubemapLod.glsl"\r\n#endif\r\n\r\n#ifdef ENV_PANORAMA\r\nuniform sampler2D sSpecularPBR;\r\n#pragma include "utils/panoramaLod.glsl"\r\n#endif\r\n\r\nvec3 getSpecularDominantDir(const in vec3 N, const in vec3 R, const in float realRoughness) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * (sqrt(smoothness) + realRoughness);\r\n    // The result is not normalized as we fetch in a cubemap\r\n    return mix(N, R, lerpFactor);\r\n}\r\n\r\nvec3 getPrefilteredEnvMapColor(const in vec3 normal, const in vec3 eyeVector, const in float roughness, const in vec3 frontNormal) {\r\n    vec3 R = reflect(-eyeVector, normal);\r\n\r\n    // specular dominant dir is using the bentNormal in the anisotropy scenario\r\n    // if we want to get rid of the dominant dir but still have a matching result with anisotropy=0 we could try:\r\n    // R = mix(getSpecularDominantDir(normal, R, roughness), R, anisotropy);\r\n    R = getSpecularDominantDir(normal, R, roughness);\r\n\r\n#ifdef ENV_CUBEMAP\r\n    vec3 prefilteredColor = prefilterEnvMapCube(roughness, uEnvironmentTransform * R);\r\n#else\r\n    vec3 prefilteredColor = prefilterEnvMapPanorama(roughness, uEnvironmentTransform * R);\r\n#endif\r\n\r\n    // http://marmosetco.tumblr.com/post/81245981087\r\n    // marmoset uses 1.3, we force it to 1.0\r\n    float factor = clamp(1.0 + dot(R, frontNormal), 0.0, 1.0);\r\n    prefilteredColor *= factor * factor;\r\n    return prefilteredColor;\r\n}\r\n\r\nvec3 computeIBLSpecularUE4(const in vec3 normal, const in vec3 eyeVector, const in float roughness, const in vec3 specular, const in vec3 frontNormal, const in float f90) {\r\n    float NoV = dot(normal, eyeVector);\r\n    return getPrefilteredEnvMapColor(normal, eyeVector, roughness, frontNormal) * integrateBRDF(specular, roughness, NoV, f90);\r\n}\r\n\r\n#endif\r\n'},ceKg:e=>{"use strict";e.exports="// approximation such as http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\n// introduced slightly darker colors and more slight banding in the darks.\n\n// so we stick with the reference implementation (except we don't check if color >= 0.0):\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\n\nfloat linearTosRGB(const in float color) { return LIN_SRGB(color); }\nvec3 linearTosRGB(const in vec3 color) { return vec3(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b)); }\nvec4 linearTosRGB(const in vec4 color) { return vec4(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b), color.a); }\n\nfloat sRGBToLinear(const in float color) { return SRGB_LIN(color); }\nvec3 sRGBToLinear(const in vec3 color) { return vec3(SRGB_LIN(color.r), SRGB_LIN(color.g), SRGB_LIN(color.b)); }\nvec4 sRGBToLinear(const in vec4 color) { return vec4(SRGB_LIN(color.r), SRGB_LIN(color.g), SRGB_LIN(color.b), color.a); }\n\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec3 RGBMToRGB( const in vec4 rgba ) {\n    const float maxRange = 8.0;\n    return rgba.rgb * maxRange * rgba.a;\n}\n\nconst mat3 LUVInverse = mat3( 6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720, 0.3007, -1.088, 5.6268 );\n\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n    vec3 Xp_Y_XYZp;\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\n    return max(vRGB, 0.0);\n}\n\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 color, const in float range) {\n    if(range <= 0.0) return vec4(color, 1.0);\n    vec4 rgbm;\n    vec3 col = color / range;\n    rgbm.a = clamp( max( max( col.r, col.g ), max( col.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = col / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 color, const in float range) {\n    if(range <= 0.0) return color.rgb;\n    return range * color.rgb * color.a;\n}\n"},cRML:e=>{"use strict";e.exports="float getLuminance(const in vec3 color) {\n    // http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color\n    const vec3 colorBright = vec3(0.2126, 0.7152, 0.0722);\n    return dot(color, colorBright);\n}\n"},QCSq:e=>{"use strict";e.exports="#define LIGHT_SPOT 0\n#define LIGHT_POINT 1\n#define LIGHT_DIRECTION 2\n#define LIGHT_HEMI 3\n\n%UNROLL 4%\n#ifdef LIGHT_TYPE_%ID%\n    uniform vec4 uSketchfabLight%ID%_diffuse;\n\n    #if LIGHT_TYPE_%ID% == LIGHT_DIRECTION\n        uniform vec3 uSketchfabLight%ID%_viewDirection;\n    #elif LIGHT_TYPE_%ID% == LIGHT_SPOT\n        uniform vec3 uSketchfabLight%ID%_viewDirection;\n        uniform vec4 uSketchfabLight%ID%_viewPosition;\n        uniform float uSketchfabLight%ID%_spotBlend;\n        uniform float uSketchfabLight%ID%_spotCutOff;\n        uniform vec4 uSketchfabLight%ID%_attenuation;\n    #elif LIGHT_TYPE_%ID% == LIGHT_POINT\n        uniform vec4 uSketchfabLight%ID%_viewPosition;\n        uniform vec4 uSketchfabLight%ID%_attenuation;\n    #elif LIGHT_TYPE_%ID% == LIGHT_HEMI\n        uniform vec4 uSketchfabLight%ID%_ground;\n        uniform vec3 uSketchfabLight%ID%_viewDirection;\n    #endif\n#endif // LIGHT_TYPE\n%%\n\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation) {\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\n    // TODO find a vector alu instead of 4 scalar\n    float constant = lightAttenuation.x;\n    float linear = lightAttenuation.y * dist;\n    float quadratic = lightAttenuation.z * dist * dist;\n    return 1.0 / (constant + linear + quadratic);\n}\n\nvoid precomputeSpot(\n        const in vec3 normal,\n        const in vec3 viewVertex,\n                          \n        const in vec3 lightViewDirection,\n        const in vec4 lightAttenuation,\n        const in vec3 lightViewPosition,\n        const in float lightSpotCutOff,\n        const in float lightSpotBlend,\n                          \n        out float attenuation,\n        out vec3 eyeLightDir,\n        out float dotNL) {\n\n    eyeLightDir = lightViewPosition - viewVertex;\n    float dist = length(eyeLightDir);\n    eyeLightDir = dist > 0.0 ? eyeLightDir / dist : vec3( 0.0, 1.0, 0.0 );\n\n    float cosCurAngle = dot(-eyeLightDir, lightViewDirection);\n    float spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightSpotCutOff) / lightSpotBlend);\n\n    dotNL = dot(eyeLightDir, normal);\n    attenuation = spot * getLightAttenuation(dist, lightAttenuation);\n}\n\nvoid precomputePoint(\n        const in vec3 normal,\n        const in vec3 viewVertex,\n\n        const in vec4 lightAttenuation,\n        const in vec3 lightViewPosition,\n\n        out float attenuation,\n        out vec3 eyeLightDir,\n        out float dotNL) {\n\n    eyeLightDir = lightViewPosition - viewVertex;\n    float dist = length(eyeLightDir);\n\n    attenuation = getLightAttenuation(dist, lightAttenuation);\n    eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n    dotNL = dot(eyeLightDir, normal);\n}\n\nvoid precomputeSun(\n        const in vec3 normal,\n        const in vec3 lightViewDirection,\n  \n        out float attenuation,\n        out vec3 eyeLightDir,\n        out float dotNL) {\n\n    attenuation = 1.0;\n    eyeLightDir = -lightViewDirection;\n    dotNL = dot(eyeLightDir, normal);\n}"},Bkbh:e=>{"use strict";e.exports='#pragma include "utils/lightCommon.glsl"\n\n////////////////\n// COOK TORRANCE\n////////////////\nvec3 specularCookTorrance(\n        const in vec3 normal,\n        const in vec3 lightDir,\n        const in vec3 eyeVector,\n        const in float materialShininess,\n        const in vec3 materialSpecular,\n        const in vec3 lightSpecular) {\n  \n    vec3 h = normalize(eyeVector + lightDir);\n    float nh = dot(normal, h);\n    float specfac = 0.0;\n\n    if(nh > 0.0) {\n        float nv = max( dot(normal, eyeVector), 0.0 );\n        float i = pow(nh, materialShininess);\n        i = i / (0.1 + nv);\n        specfac = i;\n    }\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    return specfac * materialSpecular * lightSpecular * att;\n}\n\nvec3 lambert(const in float dotNL,  const in vec3 materialDiffuse, const in vec3 lightDiffuse) {\n    return dotNL * materialDiffuse * lightDiffuse;\n}\n\nvoid computeLightLambertCookTorrance(\n        const in vec3 normal,\n        const in vec3 eyeVector,\n        const in float dotNL,\n        const in float attenuation,\n\n        const in vec3 materialDiffuse,\n        const in vec3 materialSpecular,\n        const in float materialShininess,\n\n        const in vec3 lightDiffuse,\n        const in vec3 lightSpecular,\n        const in vec3 eyeLightDir,\n\n        out vec3 diffuseOut,\n        out vec3 specularOut,\n        out bool lighted) {\n\n    lighted = dotNL > 0.0;\n    if (lighted == false) {\n        specularOut = diffuseOut = vec3(0.0);\n        return;\n    }\n\n    specularOut = attenuation * specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular);\n    diffuseOut = attenuation * lambert(dotNL, materialDiffuse, lightDiffuse);\n}\n\n///////\n// HEMI\n///////\nvoid hemiLight(\n        const in vec3 normal,\n        const in vec3 eyeVector,\n        const in float dotNL,\n        const in vec3 eyeLightDir,\n\n        const in vec3 materialDiffuse,\n        const in vec3 materialSpecular,\n        const in float materialShininess,\n\n        const in vec3 lightDiffuse,\n        const in vec3 lightGround,\n\n        out vec3 diffuseOut,\n        out vec3 specularOut,\n        out bool lighted) {\n\n    lighted = false;\n    float weight = 0.5 * dotNL + 0.5;\n    diffuseOut = materialDiffuse * mix(lightGround, lightDiffuse, weight);\n\n    // same cook-torrance as above for sky/ground\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\n    float skySpec = pow(skyWeight, materialShininess);\n    float skyGround = pow(gndWeight, materialShininess);\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    \n    specularOut = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\n}\n'},cXxc:e=>{"use strict";e.exports='#pragma include "utils/common.glsl"\n#pragma include "utils/lightCommon.glsl"\n\nvec4 precomputeGGX(const in vec3 normal, const in vec3 eyeVector, const in float roughness) {\n    float NoV = saturate(dot(normal, eyeVector));\n    float r2 = roughness * roughness;\n    return vec4(r2, r2 * r2, NoV, NoV * (1.0 - r2));\n}\n\n// Walter et al. 2007, "Microfacet models for refraction through rough surfaces"\nfloat D_GGX(const vec4 precomputeGGX, const float NoH) {\n    float a2 = precomputeGGX.y;\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\n    return a2 / (PI * d * d);\n}\n\n// Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"\nvec3 F_Schlick(const vec3 f0, const float f90, const in float VoH) {\n    float VoH5 = pow(1.0 - VoH, 5.0);\n    return f90 * VoH5 + (1.0 - VoH5) * f0;\n}\n\n// greyscale f0 version (clearcoat)\nfloat F_Schlick(const float f0, const float f90, const in float VoH) {\n    return f0 + (f90 - f0) * pow(1.0 - VoH, 5.0);\n}\n\n\n// Heitz 2014, "Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs"\nfloat V_SmithCorrelated(const vec4 precomputeGGX, const float NoL) {\n    float a = precomputeGGX.x;\n    float smithV = NoL * (precomputeGGX.w + a);\n    float smithL = precomputeGGX.z * (NoL * (1.0 - a) + a);\n    return 0.5 / (smithV + smithL);\n    // same as\n    // Hammon 2017, "PBR Diffuse Lighting for GGX+Smith Microsurfaces"\n    // return 0.5 / mix(2.0 * NoL * NoV, NoL + NoV, precomputeGGX.y)\n}\n\nvec3 specularLobe(const vec4 precomputeGGX, const vec3 normal, const vec3 eyeVector, const vec3 eyeLightDir, const vec3 specular, const float NoL, const float f90) {\n    vec3 H = normalize(eyeVector + eyeLightDir);\n    float NoH = saturate(dot(normal, H));\n    float VoH = saturate(dot(eyeLightDir, H));\n\n    // distribution / visibility / fresnel\n    float D = D_GGX(precomputeGGX, NoH);\n    float V = V_SmithCorrelated(precomputeGGX, NoL);\n    vec3 F = F_Schlick(specular, f90, VoH);\n\n    return (D * V * PI) * F; // we multipy by PI because our diffuse is not divided by PI\n}\n\n// pure compute Light PBR\nvoid computeLightLambertGGX(\n    const in vec3 normal,\n    const in vec3 eyeVector,\n    const in float NoL,\n    const in vec4 precomputeGGX,\n\n    const in vec3 diffuse,\n    const in vec3 specular,\n\n    const in float attenuation,\n    const in vec3 lightColor,\n    const in vec3 eyeLightDir,\n    const in float f90,\n\n    out vec3 diffuseOut,\n    out vec3 specularOut,\n    out bool lighted) {\n\n    lighted = NoL > 0.0;\n    if (lighted == false) {\n        specularOut = diffuseOut = vec3(0.0);\n        return;\n    }\n\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\n    specularOut = colorAttenuate * specularLobe(precomputeGGX, normal, eyeVector, eyeLightDir, specular, NoL, f90);\n    diffuseOut = colorAttenuate * diffuse;\n}\n\n/////////////\n// ANISOTROPY\n/////////////\n\nfloat V_SmithGGXCorrelated_Anisotropic(float at, float ab, float ToV, float BoV, float ToL, float BoL, float NoV, float NoL) {\n    // Heitz 2014, "Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs"\n    // UE4 version : https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/BRDF.ush#L270-L286\n    float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\n    float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\n    return 0.5 / (lambdaV + lambdaL);\n}\n\nfloat D_GGX_Anisotropic(const float at, const float ab, const float ToH, const float BoH, const float NoH) {\n    // Burley 2012, "Physically-Based Shading at Disney"\n    // https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L81\n    // similar to UE4 version https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/BRDF.ush#L232-L238\n    float a2 = at * ab;\n    vec3 d = vec3(ab * ToH, at * BoH, a2 * NoH);\n    float x = a2 / dot(d, d);\n    return a2 * (x * x) / PI;\n}\n\nvec3 anisotropicLobe(\n    const vec4 precomputeGGX,\n    const vec3 normal,\n    const vec3 eyeVector,\n\n    const vec3 eyeLightDir,\n    const vec3 specular,\n    const float NoL,\n    const float f90,\n\n    const in vec3 anisotropicT,\n    const in vec3 anisotropicB,\n    const in float anisotropy) {\n\n    vec3 H = normalize(eyeVector + eyeLightDir);\n    float NoH = saturate(dot(normal, H));\n    float NoV = saturate(dot(normal, eyeVector));\n    float VoH = saturate(dot(eyeLightDir, H));\n\n    float ToV = dot(anisotropicT, eyeVector);\n    float BoV = dot(anisotropicB, eyeVector);\n    float ToL = dot(anisotropicT, eyeLightDir);\n    float BoL = dot(anisotropicB, eyeLightDir);\n    float ToH = dot(anisotropicT, H);\n    float BoH = dot(anisotropicB, H);\n\n    // slide 26, Disney 2012, "Physically Based Shading at Disney"\n    // https://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_notes_v3.pdf\n    float aspect = sqrt(1.0 - abs(anisotropy) * 0.9);\n    if (anisotropy > 0.0) aspect = 1.0 / aspect;\n    float at = precomputeGGX.x * aspect;\n    float ab = precomputeGGX.x / aspect;\n\n    // slide 24, Kulla 2017, "Revisiting Physically Based Shading at Imageworks"\n    // https://blog.selfshadow.com/publications/s2017-shading-course/imageworks/s2017_pbs_imageworks_slides_v2.pdf\n    // float at = max(0.002025, precomputeGGX.x * (1.0 + anisotropy));\n    // float ab = max(0.002025, precomputeGGX.x * (1.0 - anisotropy));\n\n    // specular anisotropic BRDF\n    float D = D_GGX_Anisotropic(at, ab, ToH, BoH, NoH);\n    float V = V_SmithGGXCorrelated_Anisotropic(at, ab, ToV, BoV, ToL, BoL, NoV, NoL);\n    vec3 F = F_Schlick(specular, f90, VoH);\n\n    return (D * V * PI) * F;\n}\n\nvoid computeLightLambertGGXAnisotropy(\n    const in vec3 normal,\n    const in vec3 eyeVector,\n    const in float NoL,\n    const in vec4 precomputeGGX,\n\n    const in vec3 diffuse,\n    const in vec3 specular,\n\n    const in float attenuation,\n    const in vec3 lightColor,\n    const in vec3 eyeLightDir,\n    const in float f90,\n\n    const in vec3 anisotropicT,\n    const in vec3 anisotropicB,\n    const in float anisotropy,\n\n    out vec3 diffuseOut,\n    out vec3 specularOut,\n    out bool lighted) {\n\n    lighted = NoL > 0.0;\n    if (lighted == false) {\n        specularOut = diffuseOut = vec3(0.0);\n        return;\n    }\n\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\n    specularOut = colorAttenuate * anisotropicLobe(precomputeGGX, normal, eyeVector, eyeLightDir, specular, NoL, f90, anisotropicT, anisotropicB, anisotropy);\n    diffuseOut = colorAttenuate * diffuse;\n}\n'},MCB2:e=>{"use strict";e.exports='#pragma include "utils/common.glsl"\n#pragma include "utils/lightCommon.glsl"\n\n///////////////////////////\n/// SUBSURFACE TRANSLUCENCY\n///////////////////////////\nvec3 computeLightSSS(\n        const in float dotNL,\n        const in float attenuation,\n        const in float thicknessFactor,\n        const in vec3 translucencyColor,\n        const in float translucencyFactor,\n        const in float shadowDistance,\n        const in vec3 diffuse,\n        const in vec3 lightColor) {\n\n    // http://blog.stevemcauley.com/2011/12/03/energy-conserving-wrapped-diffuse/\n    // float scatter = 0.5;\n    // float wrap = saturate((dotNL + scatter) / ((1.0 + scatter) * (1.0 + scatter)));\n\n    // https://github.com/iryoku/separable-sss/blob/master/SeparableSSS.h#L362\n    float wrap = saturate(0.3 - dotNL);\n    float thickness = max(0.0, shadowDistance / max(0.001, thicknessFactor));\n\n    // http://www.crytek.com/download/2014_03_25_CRYENGINE_GDC_Schultz.pdf\n    // skin approximation vec3(0.98, 0.3, 0.2)\n    float finalAttenuation = translucencyFactor * attenuation * wrap;\n    return finalAttenuation * lightColor * diffuse * exp(-thickness / max(translucencyColor, vec3(0.001))); \n}\n'},ndRg:e=>{"use strict";e.exports='#define MIN_ROUGHNESS 0.045\n\n#pragma include "utils/functions.glsl"\n\n#ifdef HAS_OPACITY_REFRACTION\n    float gRefractionRoughness; // global variable (simpler to handle in order to re-use rough/gloss fetch)\n#endif\n\n#ifdef HAS_VERTEX_COLOR\n    varying vec4 vColor;\n\n    vec3 getVertexColor() {\n        return COLOR_CONVERT_VERTEX_COLOR(vColor.rgb);\n    }\n#endif\n\n// METALNESS WORKFLOW\n#ifdef HAS_ALBEDOPBR\n    uniform float uAlbedoPBRFactor;\n\n    vec3 getMaterialAlbedo() {\n        vec3 albedo;\n        #ifdef SAMPLER_ALBEDOPBR\n            albedo = uAlbedoPBRFactor * COLOR_CONVERT_ALBEDOPBR(texture2D(SAMPLER_ALBEDOPBR, UV_ALBEDOPBR).PACK_ALBEDOPBR);\n        #else\n            albedo = vec3(uAlbedoPBRFactor);\n        #endif\n\n        #ifdef HAS_VERTEX_COLOR\n            albedo *= getVertexColor();\n        #endif\n\n        return albedo;\n    }\n#endif\n\n#ifdef HAS_METALNESSPBR\n    uniform float uMetalnessPBRFactor;\n\n    float getMaterialMetalness() {\n        #ifdef SAMPLER_METALNESSPBR\n            return uMetalnessPBRFactor * COLOR_CONVERT_METALNESSPBR(texture2D(SAMPLER_METALNESSPBR, UV_METALNESSPBR).PACK_METALNESSPBR);\n        #else\n            return uMetalnessPBRFactor;\n        #endif\n    }\n#endif\n\n#ifdef HAS_SPECULARF0\n    uniform float uSpecularF0Factor;\n\n    float getMaterialF0() {\n        #ifdef SAMPLER_SPECULARF0\n            return uSpecularF0Factor * COLOR_CONVERT_SPECULARF0(texture2D(SAMPLER_SPECULARF0, UV_SPECULARF0).PACK_SPECULARF0);\n        #else\n            return uSpecularF0Factor;\n        #endif\n    }\n#endif\n\n// SPECULAR WORKFLOW\n#ifdef HAS_DIFFUSEPBR\n    uniform float uDiffusePBRFactor;\n\n    vec3 getMaterialDiffuse() {\n        vec3 diffuse;\n        #ifdef SAMPLER_DIFFUSEPBR\n            diffuse = uDiffusePBRFactor * COLOR_CONVERT_DIFFUSEPBR(texture2D(SAMPLER_DIFFUSEPBR, UV_DIFFUSEPBR).PACK_DIFFUSEPBR);\n        #else\n            diffuse = vec3(uDiffusePBRFactor);\n        #endif\n\n        #ifdef HAS_VERTEX_COLOR\n            diffuse *= getVertexColor();\n        #endif\n\n        return diffuse;\n    }\n#endif\n\n#ifdef HAS_SPECULARPBR\n    uniform float uSpecularPBRFactor;\n\n    vec3 getMaterialSpecular() {\n        #ifdef SAMPLER_SPECULARPBR\n            return uSpecularPBRFactor * COLOR_CONVERT_SPECULARPBR(texture2D(SAMPLER_SPECULARPBR, UV_SPECULARPBR).PACK_SPECULARPBR);\n        #else\n            return vec3(uSpecularPBRFactor);\n        #endif\n    }\n#endif\n\n// MICROSURFACE\n#ifdef HAS_ROUGHNESSPBR\n    uniform float uRoughnessPBRFactor;\n\n    float getMaterialRoughness() {\n        #ifdef SAMPLER_ROUGHNESSPBR\n            float fetch = COLOR_CONVERT_ROUGHNESSPBR(texture2D(SAMPLER_ROUGHNESSPBR, UV_ROUGHNESSPBR).PACK_ROUGHNESSPBR);\n\n            #ifdef HAS_REFRACTION_MICROSURFACE\n                gRefractionRoughness *= fetch;\n            #endif\n\n            return uRoughnessPBRFactor * fetch;\n        #else\n            return uRoughnessPBRFactor;\n        #endif\n    }\n#endif\n\n#ifdef HAS_GLOSSINESSPBR\n    uniform float uGlossinessPBRFactor;\n\n    float getMaterialGlossiness() {\n        #ifdef SAMPLER_GLOSSINESSPBR\n            float fetch = COLOR_CONVERT_GLOSSINESSPBR(texture2D(SAMPLER_GLOSSINESSPBR, UV_GLOSSINESSPBR).PACK_GLOSSINESSPBR);\n\n            #ifdef HAS_REFRACTION_MICROSURFACE\n                gRefractionRoughness = mix(1.0 - fetch, 1.0, gRefractionRoughness);\n            #endif\n\n            return uGlossinessPBRFactor * fetch;\n        #else\n            return uGlossinessPBRFactor;\n        #endif\n    }\n#endif\n\n\n#ifdef HAS_EMITCOLOR\n    uniform float uEmitColorFactor;\n    uniform int uEmitMultiplicative;\n\n    vec3 getMaterialEmitColor() {\n        #ifdef SAMPLER_EMITCOLOR\n            return uEmitColorFactor * COLOR_CONVERT_EMITCOLOR(texture2D(SAMPLER_EMITCOLOR, UV_EMITCOLOR).PACK_EMITCOLOR);\n        #else\n            return vec3(0.0);\n        #endif\n    }\n#endif\n\n#ifdef HAS_AOPBR\n    uniform float uAOPBRFactor;\n    uniform int uAOPBROccludeSpecular;\n\n    float getMaterialAO() {\n        return mix(1.0, COLOR_CONVERT_AOPBR(texture2D(SAMPLER_AOPBR, UV_AOPBR).PACK_AOPBR), uAOPBRFactor);\n    }\n#endif\n\n#ifdef HAS_CAVITYPBR\n    uniform float uCavityPBRFactor;\n\n    float getMaterialCavity() {\n        return mix(1.0, COLOR_CONVERT_CAVITYPBR(texture2D(SAMPLER_CAVITYPBR, UV_CAVITYPBR).PACK_CAVITYPBR), uCavityPBRFactor);\n    }\n#endif\n\n#ifdef HAS_SUBSURFACETRANSLUCENCY\n    uniform float uSubsurfaceTranslucencyFactor;\n    uniform float uSubsurfaceTranslucencyThicknessFactor;\n    uniform vec3 uSubsurfaceTranslucencyColor;\n\n    float getMaterialTranslucency() {\n        #ifdef SAMPLER_SUBSURFACETRANSLUCENCY\n            return uSubsurfaceTranslucencyFactor * COLOR_CONVERT_SUBSURFACETRANSLUCENCY(texture2D(SAMPLER_SUBSURFACETRANSLUCENCY, UV_SUBSURFACETRANSLUCENCY).PACK_SUBSURFACETRANSLUCENCY);\n        #else\n            return uSubsurfaceTranslucencyFactor;\n        #endif\n    }\n#endif\n\n#ifdef HAS_NORMALMAP\n    uniform float uNormalMapFactor;\n    uniform int uNormalMapFlipY;\n\n    vec3 getMaterialNormalMap() {\n        vec3 nmap = COLOR_CONVERT_NORMALMAP(texture2D(SAMPLER_NORMALMAP, UV_NORMALMAP).PACK_NORMALMAP) * 2.0 - 1.0;\n        nmap.y = uNormalMapFlipY == 1 ? -nmap.y : nmap.y;\n        return nmap;\n    }\n#endif\n\n#ifdef HAS_BUMPMAP\n    uniform float uBumpMapFactor;\n    uniform vec2 uBumpMapSize;\n\n    vec2 getMaterialBumpMap() {\n        vec2 bump;\n        vec3 invSize = vec3(1.0 / uBumpMapSize, 0.0);\n        return uBumpMapFactor * vec2(COLOR_CONVERT_BUMPMAP(texture2D(SAMPLER_BUMPMAP, UV_BUMPMAP - invSize.xz).PACK_BUMPMAP)\n                                    - COLOR_CONVERT_BUMPMAP(texture2D(SAMPLER_BUMPMAP, UV_BUMPMAP + invSize.xz).PACK_BUMPMAP),\n                                    COLOR_CONVERT_BUMPMAP(texture2D(SAMPLER_BUMPMAP, UV_BUMPMAP - invSize.zy).PACK_BUMPMAP)\n                                    -COLOR_CONVERT_BUMPMAP(texture2D(SAMPLER_BUMPMAP, UV_BUMPMAP + invSize.zy).PACK_BUMPMAP));\n    }\n#endif\n\n#ifdef HAS_SUBSURFACESCATTERING\n    uniform float uSubsurfaceScatteringProfile;\n    uniform float uSubsurfaceScatteringFactor;\n    uniform float uScatteringFactorPacker;\n\n    float getMaterialScattering() {\n        #ifdef SAMPLER_SUBSURFACESCATTERING\n            return uScatteringFactorPacker * uSubsurfaceScatteringFactor * COLOR_CONVERT_SUBSURFACESCATTERING(texture2D(SAMPLER_SUBSURFACESCATTERING, UV_SUBSURFACESCATTERING).PACK_SUBSURFACESCATTERING);\n        #else\n            return uScatteringFactorPacker * uSubsurfaceScatteringFactor;\n        #endif\n    }\n#endif\n\n#ifdef HAS_ALPHAMASK\n    uniform float uAlphaMaskFactor;\n    uniform int uAlphaMaskInvert;\n\n    float getMaterialAlphaMask() {\n      float alpha = 1.0;\n\n     #ifdef SAMPLER_ALPHAMASK\n      alpha = COLOR_CONVERT_ALPHAMASK(texture2D(SAMPLER_ALPHAMASK, UV_ALPHAMASK).PACK_ALPHAMASK);\n      if (uAlphaMaskInvert == 1) alpha = 1.0 - alpha;\n    #endif\n\n    #ifdef HAS_VERTEX_ALPHA\n      alpha *= vColor.a;\n    #endif\n\n      return alpha;\n  }\n#endif\n\n#ifdef HAS_OPACITY\n    uniform float uOpacityFactor;\n    uniform int uOpacityInvert;\n\n    #ifdef HAS_OPACITY_DITHER\n        uniform float uOpacityThinLayer;\n        uniform int uOpacityDithering;\n    #endif\n\n    #ifdef HAS_OPACITY_BLEND_OR_ADDITIVE\n        uniform int uOpacityAdditive;\n    #endif\n\n    #ifdef HAS_OPACITY_REFRACTION\n        uniform float uOpacityRoughnessFactor;\n    #endif\n\n    float getMaterialOpacity() {\n        float alpha = 1.0;\n\n        #ifdef SAMPLER_OPACITY\n            alpha = COLOR_CONVERT_OPACITY(texture2D(SAMPLER_OPACITY, UV_OPACITY).PACK_OPACITY);\n            if (uOpacityInvert == 1) alpha = 1.0 - alpha;\n        #endif\n\n        #ifndef HAS_OPACITY_DITHER\n            alpha *= uOpacityFactor;\n        #endif\n\n        #ifdef HAS_VERTEX_ALPHA\n            alpha *= vColor.a;\n        #endif\n\n        return alpha;\n    }\n#endif // HAS_OPACITY\n\n\n#ifdef HAS_CLEARCOAT\n    uniform vec3 uClearCoatTint;\n    uniform float uClearCoatThickness;\n    uniform float uClearCoatIor;\n    uniform float uClearCoatFactor;\n    uniform float uClearCoatF0;\n\n    float getMaterialClearCoat() {\n        #ifdef SAMPLER_CLEARCOAT\n            return uClearCoatFactor * COLOR_CONVERT_CLEARCOAT(texture2D(SAMPLER_CLEARCOAT, UV_CLEARCOAT).PACK_CLEARCOAT);\n        #else\n            return uClearCoatFactor;\n        #endif\n    }\n#endif\n\n#ifdef HAS_CLEARCOATROUGHNESS\n    uniform float uClearCoatRoughnessFactor;\n\n    float getMaterialClearCoatRoughness() {\n        #ifdef SAMPLER_CLEARCOATROUGHNESS\n            return uClearCoatRoughnessFactor * COLOR_CONVERT_CLEARCOATROUGHNESS(texture2D(SAMPLER_CLEARCOATROUGHNESS, UV_CLEARCOATROUGHNESS).PACK_CLEARCOATROUGHNESS);\n        #else\n            return uClearCoatRoughnessFactor;\n        #endif\n    }\n#endif\n\n#ifdef HAS_CLEARCOATNORMALMAP\n    uniform float uClearCoatNormalMapFactor;\n    uniform int uClearCoatNormalMapFlipY;\n\n    vec3 getMaterialClearCoatNormal() {\n        vec3 nmap = COLOR_CONVERT_CLEARCOATNORMALMAP(texture2D(SAMPLER_CLEARCOATNORMALMAP, UV_CLEARCOATNORMALMAP).PACK_CLEARCOATNORMALMAP) * 2.0 - 1.0;\n        nmap.y = uClearCoatNormalMapFlipY == 1 ? -nmap.y : nmap.y;\n        return nmap;\n    }\n#endif\n\n#ifdef HAS_ANISOTROPY\n    uniform float uAnisotropyFactor;\n    uniform float uAnisotropyDirection;\n    uniform int uAnisotropyFlipXY;\n\n    #ifdef SAMPLER_ANISOTROPY\n        vec2 getMaterialDirectionAnisotropy() {\n            vec2 dir = COLOR_CONVERT_ANISOTROPY(texture2D(SAMPLER_ANISOTROPY, UV_ANISOTROPY).PACK_ANISOTROPY) * 2.0 - 1.0;\n            if (uAnisotropyFlipXY == 1) dir.xy = dir.yx;\n            return dir;\n        }\n    #endif\n\n#endif\n\n\n#ifdef HAS_SHEEN\n\nuniform float uSheenFactor;\nuniform vec3 uSheenColorFactor;\nuniform float uSheenRoughnessFactor;\n\n\nfloat sheenLobe(const float sheenRoughness, const float NdotV, const float NdotL, const float NdotH) {\n  // Charlie Sheen distribution, Conty Estevez and Kulla Production Friendly Microfacet Sheen BRDF\n  float r =  sheenRoughness *  sheenRoughness;\n  float invAlpha  = 1.0 / r;\n  float cos2h = NdotH * NdotH;\n  // 0.0078125 => 2^(-14/2), so sin2h^2 > 0 in fp16\n  float sin2h = max(1.0 - cos2h, 0.0078125);\n  float D = (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n\n  // Sheen visibility (much faster than charlie sheen distribution)\n  // Ashikhmin and Premoze Distribution-based Brdfs\n  // also Neubelt and Pettineo Crafting a Next-gen Material Pipeline for The Order\n  float V = clamp(1.0 / (4.0 * (NdotL + NdotV - NdotL * NdotV)), 0.0, 1.0);\n  return (D * V);\n}\n\nfloat getMaterialSheenRoughness(){\n#if defined(SAMPLER_SHEENROUGHNESS)\n  return uSheenRoughnessFactor * texture2D(SAMPLER_SHEENROUGHNESS, UV_SHEENROUGHNESS).PACK_SHEENROUGHNESS;\n#else\n  return uSheenRoughnessFactor;\n#endif\n}\n\nvec3 computeSheen(const vec3 normal, const vec3 lightDir, const vec3 eyeVector, const float sheenRoughness){\n\n  float NdotL = dot(normal, lightDir);\n  float NdotV = dot(normal, eyeVector);\n  vec3 H = normalize(lightDir + eyeVector);\n  float NdotH = dot(normal, H);\n\n  float sheenContribution = sheenLobe(max(0.04, sheenRoughness), NdotV, NdotL, NdotH);\n\n#if defined(SAMPLER_SHEEN)\n  vec3 sheenColor = uSheenFactor * uSheenColorFactor * COLOR_CONVERT_SHEEN(texture2D(SAMPLER_SHEEN, UV_SHEEN).PACK_SHEEN);\n#else\n  vec3 sheenColor = uSheenFactor * uSheenColorFactor;\n#endif\n\n  return max(vec3(0.0), sheenContribution * sheenColor);\n}\n\n#endif\n\n\n\n\n\n/////////////////\n// LEGACY CLASSIC\n/////////////////\n#ifdef HAS_LEGACY_CLASSIC\n    uniform vec2 uTextureEnvironmentSpecularTextureSize;\n    uniform samplerCube sEnvironmentSpecular;\n    uniform mat3 uEnvironmentTransform;\n\n    uniform float uReflection;\n\n    uniform float uDiffuseColorFactor;\n    uniform float uDiffuseIntensityFactor;\n        vec3 getMaterialLegacyDiffuse() {\n        vec3 diffuse = vec3(0.0);\n        #if defined(SAMPLER_DIFFUSECOLOR)\n            diffuse = uDiffuseColorFactor * COLOR_CONVERT_DIFFUSECOLOR(texture2D(SAMPLER_DIFFUSECOLOR, UV_DIFFUSECOLOR).PACK_DIFFUSECOLOR);\n        #elif defined(HAS_DIFFUSECOLOR)\n            diffuse = vec3(uDiffuseColorFactor);\n        #endif\n\n        #ifdef HAS_VERTEX_COLOR\n            diffuse *= getVertexColor();\n        #endif\n\n        #ifdef HAS_DIFFUSEINTENSITY\n            #ifdef SAMPLER_DIFFUSEINTENSITY\n                diffuse *= uDiffuseIntensityFactor * COLOR_CONVERT_DIFFUSEINTENSITY(texture2D(SAMPLER_DIFFUSEINTENSITY, UV_DIFFUSEINTENSITY).PACK_DIFFUSEINTENSITY);\n            #else\n                diffuse *= uDiffuseIntensityFactor;\n            #endif\n        #endif\n\n        return diffuse;\n    }\n\n    uniform float uSpecularColorFactor;\n        vec3 getMaterialLegacySpecular() {\n        #if defined(SAMPLER_SPECULARCOLOR)\n            return uSpecularColorFactor * COLOR_CONVERT_SPECULARCOLOR(texture2D(SAMPLER_SPECULARCOLOR, UV_SPECULARCOLOR).PACK_SPECULARCOLOR);\n        #elif defined(HAS_SPECULARCOLOR)\n            return vec3(uSpecularColorFactor);\n        #else\n            return vec3(0.0);\n        #endif\n    }\n\n    uniform float uSpecularHardnessFactor;\n    float getMaterialLegacyShininess() {\n        #if defined(SAMPLER_SPECULARHARDNESS)\n            return uSpecularHardnessFactor * COLOR_CONVERT_SPECULARHARDNESS(texture2D(SAMPLER_SPECULARHARDNESS, UV_SPECULARHARDNESS).PACK_SPECULARHARDNESS);\n        #elif defined(HAS_SPECULARHARDNESS)\n            return uSpecularHardnessFactor;\n        #else\n            return 0.0;\n        #endif\n    }\n\n#endif\n'},P40d:e=>{"use strict";e.exports="vec3 morphing(const in vec4 weights, const in vec3 vertex, const in vec3 target0) {\n    return mix(vertex, target0, weights[0]);\n}\n\nvec3 morphing(const in vec4 weights, const in vec3 vertex, const in vec3 target0, const in vec3 target1) {\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1]));\n    vecOut += target0 * weights[0];\n    vecOut += target1 * weights[1];\n    return vecOut;\n}\n\nvec3 morphing(const in vec4 weights, const in vec3 vertex, const in vec3 target0, const in vec3 target1, const in vec3 target2) {\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1] + weights[2]));\n    vecOut += target0 * weights[0];\n    vecOut += target1 * weights[1];\n    vecOut += target2 * weights[2];\n    return vecOut;\n}\n\nvec3 morphing(const in vec4 weights,const in vec3 vertex,const in vec3 target0,const in vec3 target1,const in vec3 target2,const in vec3 target3) {\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1] + weights[2] + weights[3]));\n    vecOut += target0 * weights[0];\n    vecOut += target1 * weights[1];\n    vecOut += target2 * weights[2];\n    vecOut += target3 * weights[3];\n    return vecOut;\n}\n"},"2rs+":e=>{"use strict";e.exports="// version for vertex shader\nvec3 bumpMap(const in vec4 tangent, const in vec3 normal, const in vec2 gradient) {\n    vec3 tang =  normalize(tangent.xyz);\n    vec3 binormal = tangent.w * normalize(cross(normal, tang));\n    return normalize(normal + gradient.x * tang + gradient.y * binormal);\n}\n\n// #define transformNormal(f, tn, tex, b, n) n = f * n.xy; n = normalize(tex.x * t.xyz + tex.y * b + tex.z * n)\nvec3 transformNormal(const in float factor, in vec3 normal, const in vec3 t, const in vec3 b, in vec3 n) {\n    normal.xy = factor * normal.xy;\n    return normalize(normal.x * t + normal.y * b + normal.z * n);\n}\n\n// anisotropy transform\nvec3 transformTangent(in vec2 tangent, const in vec3 t, const in vec3 b) {\n    return normalize(tangent.x * t + tangent.y * b);\n}\n\n// #define transformBump(tex, t, b, n) n = normalize(tex.x * t.xyz + tex.y * b + n)\nvec3 transformBump(in vec2 bump, const in vec3 t, const in vec3 b, in vec3 n) {\n    return normalize(bump.x * t + bump.y * b + n);\n}\n#if HAS_NORMALMAP && COMPUTE_FRAGMENT_TANGENTS\n    float rsqrt(float a)\n    {\n        return pow(a, -0.5);\n    }\n\n    // #ifdef GL_OES_standard_derivatives\n\n    //     void tangentFrame(vec3 denormNormal, vec3 pos, vec2 texCoord, out vec3 T, out vec3 B, out vec3 N){\n    //         vec3 denormTangent =  dFdx(pos) * dFdy(texCoord.y) -dFdx(texCoord.y) * dFdy(pos);\n    //         T = normalize(denormTangent - denormNormal * dot(denormNormal, denormTangent));\n    //         N = normalize(denormNormal);\n    //         B = cross(N, T);\n    //         float invmax = rsqrt(max(dot(T, T), dot(B, B)));\n    //         T *= invmax;\n    //         B *= invmax;\n    //     }\n\n    //     void makeTBN(out vec4 tangent, out vec3 binormal, in vec3 viewNormal, in vec3 viewPos, in vec2 uv){   \n    //         float renormFactor = 1.0 / length(viewNormal);\n    //         vec3 nrmBaseNormal = ((gl_FrontFacing ? 1.0 : -1.0 ) * renormFactor) * viewNormal;\n\n    //         vec3 dPdx = dFdx(viewPos);\n    //         vec3 dPdy = -dFdy(viewPos);            \n    //         float flipSign = dot (dPdy, cross(nrmBaseNormal, dPdx)) < 0.0 ? -1.0 : 1.0;\n    //         vec3 T;\n    //         tangentFrame(nrmBaseNormal, viewPos, uv, T, binormal, nrmBaseNormal);            \n    //         tangent = vec4(T, flipSign);\n    //     }\n     \n    // #else\n        void makeTBN(out vec4 tangent, out vec3 binormal, in vec3 viewNormal, in vec3 viewPos, in vec2 uv){                   \n            vec3 normal = normalize((gl_FrontFacing ? 1.0 : -1.0 ) * viewNormal);\n            tangent = vec4(normalize(cross(normal, vec3(0.0,1.0,0.0))), 1.0);\n            binormal = -normalize(cross(normal,tangent.xyz));              \n        }\n    // #endif\n\n#endif\n"},orCE:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\r\n\r\nvec2 computeUVForMipmap(const in float level, const in vec2 uv) {\r\n    // width for level\r\n    float widthForLevel = exp2(uTextureEnvironmentSpecularPBRLodRange.x - level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n    // compact version\r\n    float texelSize = 1.0 / uTextureEnvironmentSpecularPBRTextureSize.x;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += uTextureEnvironmentSpecularPBRTextureSize.x - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\n//for y up\r\nvec2 normalToPanoramaUVY(const in vec3 dir) {\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2((n > 0.0000001) ? max(-1.0, dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if (pos.x > 0.0) pos.x = min(0.999999, pos.x);\r\n\r\n    pos = acos(pos) * 0.3183098861837907; // inv_pi\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x * 0.5 : 1.0 - (pos.x * 0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x - 0.25 + 1.0, 1.0);\r\n    pos.y = 1.0 - pos.y;\r\n    return pos;\r\n}\r\n\r\nvec3 prefilterEnvMapPanorama(const in float rLinear, const in vec3 R) {\r\n    float lod = min(uTextureEnvironmentSpecularPBRLodRange.x, linRoughnessToMipmap(rLinear) * uTextureEnvironmentSpecularPBRLodRange.y);\r\n    vec2 uvBase = normalToPanoramaUVY(R);\r\n\r\n    // // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n\r\n    vec3 texel0 = LUVToRGB(texture2D(sSpecularPBR, computeUVForMipmap(floor(lod), uvBase)));\r\n    vec3 texel1 = LUVToRGB(texture2D(sSpecularPBR, computeUVForMipmap(ceil(lod), uvBase)));\r\n\r\n    return mix(texel0, texel1, fract(lod));\r\n}\r\n'},aabx:e=>{"use strict";e.exports="\n// white vs interleaved vs blue noise\n// https://blog.demofox.org/2017/10/31/animating-noise-for-integration-over-time/\n\n// to test in a shadertoy\n// https://www.shadertoy.com/view/lsdfD4\n\n// https://www.shadertoy.com/view/4djSRW\n// most combinations are possible : in[1,2,3] -> out[1,2,3]\n#define INT_SCALE1 .1031\nfloat pseudoRandom(const in vec2 fragCoord) {\n    vec3 p3  = fract(vec3(fragCoord.xyx) * INT_SCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/Random.ush#L27\nfloat interleavedGradientNoise(const in vec2 fragCoord, const in float frameMod) {\n    vec3 magic = vec3(0.06711056, 0.00583715, 52.9829189);\n    return fract(magic.z * fract(dot(fragCoord.xy + frameMod * vec2(47.0, 17.0) * 0.695, magic.xy)));\n}\n\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/MaterialTemplate.ush#L1863\n// we slighty change it by multiplying by 1.2 (to match with other noise), otherwise the range seems to be between [0 - 0.83]\nfloat ditheringNoise(const in vec2 fragCoord, const in float frameMod) {\n    // float fm = mod(frameMod, 2.0) == 0.0 ? 1.0 : -1.0;\n    float fm = frameMod;\n    float dither5 = fract((fragCoord.x + fragCoord.y * 2.0 - 1.5 + fm) / 5.0);\n    float noise = fract(dot(vec2(171.0, 231.0) / 71.0, fragCoord.xy));\n    return (dither5 * 5.0 + noise) * (1.2 / 6.0);\n}\n\nvoid ditheringMaskingDiscard(\n    const in vec4 fragCoord,\n    const in int dithering,\n    const in float alpha,\n    const in float factor,\n\n    const in float thinLayer,\n\n    const in float frameMod,\n    const in vec2 nearFar,\n\n    const in vec4 halton) {\n\n    float rnd;\n\n    if (thinLayer == 0.0) {\n        float linZ = (1.0 / fragCoord.w - nearFar.x) / (nearFar.y - nearFar.x);\n        float sliceZ = floor(linZ * 500.0) / 500.0;\n        rnd = interleavedGradientNoise(fragCoord.xy + sliceZ, frameMod);\n    } else {\n        rnd = pseudoRandom(fragCoord.xy + halton.xy * 1000.0 + fragCoord.z * (abs(halton.z) == 2.0 ? 1000.0 : 1.0));\n    }\n\n    if ((alpha * factor) < rnd) discard;\n}\n"},"7VuN":e=>{"use strict";e.exports='#pragma include "utils/encodeDecode.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\n// manual refract mostly to re-use dot(I, N)\nvec3 batchRefract(const in vec3 I, const in vec3 N , const in float eta, const in float dotNI) {\n    float k = 1.0 - eta * eta * (1.0 - dotNI * dotNI);\n    return (k < 0.0) ? vec3(0.0) :  eta * I - (eta * dotNI + sqrt(k)) * N;\n}\n\nuniform float uOpacityIOR;\nuniform vec3 uOpacityRefractionColor;\n\nuniform float uBoxRadius;\nuniform int uIsVr;\nuniform sampler2D uTextureToBeRefracted;\nuniform vec2 uTextureToBeRefractedSize;\nuniform mat4 uProjectionMatrix;\nuniform vec4 uPreviousHalton;\nuniform vec2 uPreviousGlobalTexRatio;\nuniform vec2 uPreviousGlobalTexSize;\nuniform vec2 uGlobalTexSize;\n\n    uniform sampler2D uTextureMipmapDepth;\n    uniform vec2 uNearFar;\n    uniform vec2 uPreviousNearFar;\n    uniform vec2 uGlobalTexRatio;\n\n    uniform mat4 uProjectionMatrix;\n    uniform mat4 uReprojectViewProj;\n    uniform vec4 uTaaCornersCSLeft[2];\n\nvec3 refraction(\n    const in float roughness,\n    const in vec3 normalSurface,\n\n#ifdef HAS_REFRACTION_NORMAL_OFFSET\n    const in vec3 normalVertex,\n#endif\n    const in vec3 eyeVector\n)\n\n{\n    \n    float dotNI = dot(-eyeVector, normalSurface);\n\n    // same as using glsl refract but doesnt compute  dotNI twice\n    // vec3 normalRefract = refract(-eyeVector, normalSurface, 1.0 / uOpacityIOR);\n    vec3 normalRefract = batchRefract(-eyeVector, normalSurface, 1.0 / uOpacityIOR, dotNI);    \n    // \n    // uboxradius is "world space constant" but view space should not scale scene\n    vec3 viewPosRefractedCurrentFrame = vViewVertex.xyz + uBoxRadius * normalRefract;\n    \n    // get uv in current frame to get depth\n    vec3 clipPosRefractedCurrentFrame = (uProjectionMatrix * vec4(viewPosRefractedCurrentFrame, 1.0)).xyw;\n    vec2 uvRefractedCurrentPos = 0.5 + 0.5 * clipPosRefractedCurrentFrame.xy / clipPosRefractedCurrentFrame.z;\n\n     #ifdef DEPTH_MIPMAP\n           vec3 pack = texture2D(uTextureMipmapDepth, uGlobalTexRatio * vec2(uvRefractedCurrentPos.x, (1.0 - uvRefractedCurrentPos.y) * 0.5)).xyz;\n           //float depthRefracted = pack.x == 1.0 ? (-vViewVertex.z - uNearFar.x) / (uNearFar.y - uNearFar.x) : decode24(pack);\n           float depthRefracted = pack.x == 1.0 ? 0.0 : decode24(pack);\n     #else\n           vec4 pack = texture2D(uTextureMipmapDepth, uGlobalTexRatio * uvRefractedCurrentPos);\n           //float depthRefracted = pack.x == 1.0 ? (-vViewVertex.z - uNearFar.x) / (uNearFar.y - uNearFar.x) : decodeDepth(pack);\n           float depthRefracted = pack.x == 1.0 ? 0.0 : decodeDepth(pack);\n     #endif\n\n    vec2 uv;    \n\n\n\n    // check if Refracted Depth is BEHIND the surface in Current Frame\n    // Before trying to reproject so that we get something BEHIND in Previous Frame\n    // so we compare vector direction fomr depth->pos with normal if incidence is negative, it comes from behind\n    vec3 color;\n\n    // compute clipsace depth\n    float clipCurrentRasterZ = (- vViewVertex.z - uPreviousNearFar.x) / (uPreviousNearFar.y - uPreviousNearFar.x);\n    // if background or if refracted is behind the refracting surface we can refract\n    if ( pack.x == 1.0 || clipCurrentRasterZ - depthRefracted < 0.001 ) {\n\n        // compute view space refracted position from depth CURRENT FRAME\n        vec4 AB = mix(uTaaCornersCSLeft[0], uTaaCornersCSLeft[1], uvRefractedCurrentPos.x);\n        \n        // if translate it\'s ok\n        // if rotation, very small depth change makes for same object to appear twice as we don\'t have prev Depth but current Depth\n        //float constantDepthRefracted = depthRefracted;\n        // A constant shiftvalue per scene in order to ensure we get no double and yet give consistent results\n        // previous depth would allow to scale using abs(prevDepth - curDepth))\n        float scaleVector =  clipCurrentRasterZ - 0.01 * (depthRefracted - clipCurrentRasterZ);\n        scaleVector = - ((scaleVector *  (uPreviousNearFar.y - uPreviousNearFar.x)) + uPreviousNearFar.x);\n        //float scaleVector =  vViewVertex.z - uBoxRadius/(uPreviousNearFar.y - uPreviousNearFar.x);\n        vec3 viewPosRefractedCurrentFrameFromDepth = vec3(mix(AB.xy, AB.zw, uvRefractedCurrentPos.y), 1.0) * scaleVector;\n        vec4 posReproj = uReprojectViewProj * vec4(viewPosRefractedCurrentFrameFromDepth.xyz, 1.0);\n        \n        uv  = 0.5 + 0.5 * (posReproj.xy / posReproj.w);        \n    }      \n    else{\n        \n        // prevent same or things just in front of refract surface\n        // being "mirrored" on the refracting surface\n        uv =  gl_FragCoord.xy / uPreviousGlobalTexSize.xy;\n    }\n\n    if (uIsVr == 1) {\n        // no reprojection in vr (would require another uTaaCornersCSRight uniform)\n        uv.x *= 0.5;\n        if (gl_FragCoord.x > uGlobalTexSize.x * 0.5) uv.x += 0.5;\n    }\n\n    \n       \n    // position of refracted point in last frame clipspace\n\n#ifdef HAS_REFRACTION_NORMAL_OFFSET\n    // no reprojection and no depth compare for the normal offset version (not worth it as for the moment)\n    uv = uv.xy + (normalVertex.xy - normalSurface.xy) * (uOpacityIOR - 1.0);\n    \n#endif\n\n    // unjitter (so that the refraction is stable when doing supersampling)\n    uv -= 0.5 * uPreviousHalton.xy / uPreviousGlobalTexSize.xy;\n\n    // repeat mirror for out of screen fetches (it\'s better than a sudden cut)\n    // we can\'t simply use MIRRORED_REPEAT because of manual mipmap\n    uv = abs(uv); \n    if (uv.x > 1.0) uv.x -= 2.0 * (uv.x - 1.0);\n    if (uv.y > 1.0) uv.y -= 2.0 * (uv.y - 1.0);\n\n    \n    // adjusts roughness-to-mipmap depending of distance from surface (aka: consistent blurring even when we unzoom)\n    float adjustRoughness = clamp(uProjectionMatrix[1][1] / 12.0 * uBoxRadius / -vViewVertex.z, 0.0, 1.0);\n    float adjustFactor = 0.05; // the higher it is, the sharper it will be when we are far away\n    adjustRoughness = (1.0 + adjustFactor) * adjustRoughness / (adjustFactor + adjustRoughness);\n\n    // roughness support\n    float maxLod = 7.0;\n    float lodLevel = maxLod * min(0.99, roughness * adjustRoughness); // same as in pbr\n\n    float lowerLevel = floor(lodLevel);\n    float higherLevel = min(maxLod, lowerLevel + 1.0);\n    float lerpFactor = lodLevel - lowerLevel; // [0,1]\n\n    // see packMipmapRefraction.glsl\n    // mipmap packing of refracted texture (the packing is not optimal and is a bit naive):\n    // level0: (1-uv)/2\n    // level1: (3-uv)/4\n    // level2: (7-uv)/8\n    // level3: (15-uv)/16\n    // level4: (31-uv)/32\n    // etc...\n\n    float powLevel = pow(2.0, higherLevel);\n\n    // border pixel issue with bilinear...\n    vec2 pixelSize = 2.0 * powLevel / uTextureToBeRefractedSize;\n    uv = max(pixelSize, min(1.0 - pixelSize, uv));\n\n    // lower uv\n    vec2 uvLower = vec2(2.0 * uv.x, powLevel - 1.0 - uv.y) * uPreviousGlobalTexRatio.xy / powLevel;\n\n    // higher uv\n    powLevel *= 2.0;\n    vec2 uvHigher = vec2(2.0 * uv.x, powLevel - 1.0 - uv.y) * uPreviousGlobalTexRatio.xy / powLevel;\n\n    // manual lerp, mixing rgbm colors exhibits visible seams\n    vec3 fetch = mix(decodeRGBM(texture2D(uTextureToBeRefracted, uvLower), 7.0), decodeRGBM(texture2D(uTextureToBeRefracted, uvHigher), 7.0), lerpFactor);\n\n#ifndef HAS_REFRACTION_NORMAL_OFFSET\n    // reduce bright fresnel effect, it darkens/accentuates the edges in some cases (very rough surface)\n    fetch.rgb -= fetch.rgb * pow(clamp(1.0 + dotNI, 0.0, 1.0), 4.0);\n#endif\n\n    return uOpacityRefractionColor * fetch.rgb ;\n}\n'},F2PT:e=>{"use strict";e.exports="//////////////////////////////\n// UN-OPTIMIZED VERSION (WITH IF)\n//////////////////////////////\n\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\n// mat4 getMat4FromVec4(const int index, inout mat4 myMat) {\n//     // We have to use a global variable because we can't access dynamically\n//     // matrix is transpose so we should do vec * matrix\n//     myMat[0] = uBones[index];\n//     myMat[1] = uBones[index + 1];\n//     myMat[2] = uBones[index + 2];\n//     return myMat;\n// }\n\n// mat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\n//     ivec4 idx =  3 * ivec4(bonesIndex);\n//     mat4 tmpMat = mat4(1.0);\n//     mat4 outMat = mat4(0.0);\n\n//     // we handle negative weights\n//     if(all(equal(weights, vec4(0.0)))) return tmpMat;\n\n//     if(weights.x != 0.0) outMat += weights.x * getMat4FromVec4(idx.x, tmpMat);\n//     if(weights.y != 0.0) outMat += weights.y * getMat4FromVec4(idx.y, tmpMat);\n//     if(weights.z != 0.0) outMat += weights.z * getMat4FromVec4(idx.z, tmpMat);\n//     if(weights.w != 0.0) outMat += weights.w * getMat4FromVec4(idx.w, tmpMat);\n//     return outMat;\n// }\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (NO IF)\n//////////////////////////////\n\nmat4 skinning(const in vec4 weights, const in vec4 bonesIndex) {\n    ivec4 idx =  3 * ivec4(bonesIndex);\n    mat4 tmpMat = mat4(1.0);\n\n    // if sum is 0, return identity\n    vec4 absWeights = -abs(weights);\n    mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\n\n    // we handle negative weights\n    // outMat[3][3] += weights.x + weights.y + weights.z + weights.w;\n\n    tmpMat[0] = uBones[idx.x];\n    tmpMat[1] = uBones[idx.x + 1];\n    tmpMat[2] = uBones[idx.x + 2];\n    outMat += weights.x * tmpMat;\n\n    tmpMat[0] = uBones[idx.y];\n    tmpMat[1] = uBones[idx.y + 1];\n    tmpMat[2] = uBones[idx.y + 2];\n    outMat += weights.y * tmpMat;\n\n    tmpMat[0] = uBones[idx.z];\n    tmpMat[1] = uBones[idx.z + 1];\n    tmpMat[2] = uBones[idx.z + 2];\n    outMat += weights.z * tmpMat;\n\n    tmpMat[0] = uBones[idx.w];\n    tmpMat[1] = uBones[idx.w + 1];\n    tmpMat[2] = uBones[idx.w + 2];\n    outMat += weights.w * tmpMat;\n\n    return outMat;\n}\n"},TObL:e=>{"use strict";e.exports='#pragma include "utils/decodeDepth.glsl"\n#pragma include "utils/rand.glsl"\n\n#define SSR_STEPS 8\n\n#define LOD_COLOR 7.0\n#define LOD_DEPTH 5.0\n\nuniform int uDrawOpaque;\nuniform float uFrameModTaaSS;\nuniform float uQuality;\nuniform float uSsrFactor;\n\nuniform sampler2D uTextureToBeRefracted;\nuniform sampler2D uTextureMipmapDepth;\n\nuniform vec2 uTextureToBeRefractedSize;\nuniform vec2 uPreviousGlobalTexRatio;\nuniform vec2 uPreviousGlobalTexSize;\nuniform vec2 uNearFar;\nuniform vec2 uGlobalTexRatio;\nuniform vec4 uTaaCornersCSLeft[2];\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uReprojectViewProj;\nuniform mat4 uPreviousViewInvView;\nuniform mat4 uPreviousProjection; // DEPTH_MIPMAP\n\nvec3 computeLodNearestPixelSizePowLevel(const in float lodLevelIn, const in float maxLod, const in vec2 size) {\n    float lodLevel = min(maxLod - 0.01, lodLevelIn);\n    float lowerLevel = floor(lodLevel);\n    float higherLevel = min(maxLod, lowerLevel + 1.0);\n\n    float powLevel = pow(2.0, higherLevel);\n    vec2 pixelSize = 2.0 * powLevel / size;\n\n    if (lodLevel - lowerLevel > 0.5) powLevel *= 2.0;\n    return vec3(pixelSize, powLevel);\n}\n\n// lerping between 2 mipmap is too costly (with no notable quality gain in the end)\nvec2 computeLodUVNearest(const in vec2 uvIn, const in vec3 pixelSizePowLevel) {\n    // border pixel issue with bilinear...\n    vec2 uv = max(pixelSizePowLevel.xy, min(1.0 - pixelSizePowLevel.xy, uvIn));\n    return vec2(2.0 * uv.x, pixelSizePowLevel.z - 1.0 - uv.y) / pixelSizePowLevel.z;\n}\n\nfloat fetchDepthLod(const in vec2 uv, const in vec3 pixelSizePowLevel) {\n#ifdef DEPTH_MIPMAP\n    vec2 uvNearest = computeLodUVNearest(uv, pixelSizePowLevel);\n    float depth =  decodeDepth(texture2D(uTextureMipmapDepth, uvNearest * uPreviousGlobalTexRatio));\n#else\n    float depth = decodeDepth(texture2D(uTextureMipmapDepth, uv * uGlobalTexRatio));\n#endif\n\n    if (depth >= 1.0) return -uNearFar.y * 100.0; // very far so it won\'t reflect background\n    return -uNearFar.x - depth * (uNearFar.y - uNearFar.x);\n}\n\nvec4 fetchDepthLod(const in vec4 uv0, const in vec4 uv1, const in vec3 pixelSizePowLevel) {\n    vec4 result = vec4(0.0);\n    result.x = fetchDepthLod(uv0.xy, pixelSizePowLevel);\n    result.y = fetchDepthLod(uv0.zw, pixelSizePowLevel);\n    result.z = fetchDepthLod(uv1.xy, pixelSizePowLevel);\n    result.w = fetchDepthLod(uv1.zw, pixelSizePowLevel);\n    return result;\n}\n\nvec3 ssrViewToScreen(const in mat4 projection, const in vec3 viewVertex) {\n    vec4 projected = projection * vec4(viewVertex, 1.0);\n    return vec3(0.5 + 0.5 * projected.xy / projected.w, projected.w);\n}\n\nvec3 fetchColorLod(const in float level, const in vec2 uv) {\n    vec3 pixelSizePowLevel = computeLodNearestPixelSizePowLevel(LOD_COLOR * level, LOD_COLOR, uPreviousGlobalTexSize); \n    vec2 uvNearest = computeLodUVNearest(uv, pixelSizePowLevel);\n    return decodeRGBM(texture2D(uTextureToBeRefracted, uvNearest * uPreviousGlobalTexRatio), 7.0);\n}\n\n// #define HASHSCALE1 .1031\n// #define HASHSCALE3 vec3(.1031, .1030, .0973)\n// #define HASHSCALE4 vec4(.1031, .1030, .0973, .1099)\n\n// vec2 hash23(vec3 p3)\n// {\n//     p3 = fract(p3 * HASHSCALE3);\n//     p3 += dot(p3, p3.yzx + 19.19);\n//     return fract((p3.xx + p3.yz) * p3.zy);\n// }\n\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/ScreenSpaceReflections.usf#L143\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/MonteCarlo.ush#L169\nvec3 unrealImportanceSampling(const in float frameMod, const in vec3 tangentX, const in vec3 tangentY, const in vec3 tangentZ, const in vec3 eyeVector, const in float rough4) {\n    vec2 E;\n\n    // could be improved (visible patterns)\n    E.x = interleavedGradientNoise(gl_FragCoord.yx, frameMod);\n    E.y = fract(E.x * 52.9829189);\n    // E = hash23(vec3(gl_FragCoord.xy + frameMod * 150.2420, frameMod * 100.0));\n\n    // Reduces BRDF tail is noisy, we clamp it\n    // https://www.slideshare.net/DICEStudio/stochastic-screenspace-reflections#p=67\n    E.y = mix(E.y, 1.0, 0.7);\n\n    float phi = 2.0 * 3.14159 * E.x;\n    // float cosTheta = sqrt((1.0 - E.y) / (1.0 + (rough4 - 1.0) * E.y)); // ggx (long tail, more noisy)\n    float cosTheta = pow(max(E.y, 0.000001), rough4 / (2.0 - rough4)); // blinn\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\n    vec3 h = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n    h = h.x * tangentX + h.y * tangentY + h.z * tangentZ;\n    return normalize((2.0 * dot(eyeVector, h)) * h - eyeVector);\n}\n\nfloat getStepOffset(const in float frameMod) {\n    return (interleavedGradientNoise(gl_FragCoord.xy, frameMod) - 0.5);\n}\n\nvec3 computeRayDirUV(const in vec3 rayOriginUV, const in float rayLen, const in vec3 rayDirView) {\n#ifdef DEPTH_MIPMAP\n    vec3 rayDirUV = ssrViewToScreen(uPreviousProjection, vViewVertex.xyz + rayDirView * rayLen);\n#else\n    vec3 rayDirUV = ssrViewToScreen(uProjectionMatrix, vViewVertex.xyz + rayDirView * rayLen);\n#endif\n\n    rayDirUV.z = 1.0 / rayDirUV.z;\n    rayDirUV -= rayOriginUV;\n\n    // clip the line to the viewport edges\n    // https://github.com/godotengine/godot/blob/master/drivers/gles3/shaders/screen_space_reflection.glsl#L124\n    float scaleMaxX = min(1.0, 0.99 * (1.0 - rayOriginUV.x) / max(1e-5, rayDirUV.x));\n    float scaleMaxY = min(1.0, 0.99 * (1.0 - rayOriginUV.y) / max(1e-5, rayDirUV.y));\n    float scaleMinX = min(1.0, 0.99 * rayOriginUV.x / max(1e-5, -rayDirUV.x));\n    float scaleMinY = min(1.0, 0.99 * rayOriginUV.y / max(1e-5, -rayDirUV.y));\n    return rayDirUV * min(scaleMaxX, scaleMaxY) * min(scaleMinX, scaleMinY);\n}\n\n#define SSR_RAY_FETCH(void) \\\nsampleUV = rayOriginUV + rayDirUV * diffSampleW.y; \\\ndepth = fetchDepthLod(sampleUV.xy, pixelSizePowLevel); \\\ndepthDiff = -1.0 / sampleUV.z - depth; \\\nhit = abs(depthDiff + depthTolerance) < depthTolerance; \\\ntimeLerp = clamp(diffSampleW.x / (diffSampleW.x - depthDiff), 0.0, 1.0); \\\nhitTime = hit ? (diffSampleW.y + timeLerp * invNumSteps - invNumSteps) : 1.0; \\\ndiffSampleW.z = min(diffSampleW.z, hitTime); \\\ndiffSampleW.x = depthDiff; \\\ndiffSampleW.y += invNumSteps; \\\n\n#define SSR_RAY_UNROLLED(void) \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\nSSR_RAY_FETCH() \\\n\nvec4 rayTraceUnrealSimple(\n    const in vec3 rayOriginUV,\n    const in float rayLen,\n    in float depthTolerance,\n    const in vec3 rayDirView,\n\n    const in float roughness,\n    const in float frameMod) {\n\n    vec3 pixelSizePowLevel = computeLodNearestPixelSizePowLevel(LOD_DEPTH * roughness, LOD_DEPTH, uTextureToBeRefractedSize); \n\n    float invNumSteps = 1.0 / float(SSR_STEPS);\n    if (uQuality > 1.0) invNumSteps /= 2.0;\n\n    depthTolerance *= invNumSteps;\n\n    vec3 rayDirUV = computeRayDirUV(rayOriginUV, rayLen, rayDirView);\n\n    float sampleTime = getStepOffset(frameMod) * invNumSteps + invNumSteps;\n    vec3 diffSampleW = vec3(0.0, sampleTime, 1.0);\n\n    vec3 sampleUV;\n    float depth, depthDiff, timeLerp, hitTime;\n    bool hit;\n\n    SSR_RAY_UNROLLED()\n    if (uQuality > 1.0) { SSR_RAY_UNROLLED() }\n\n    // alternative : ray refinement around the intersected cell\n    // if (uQuality > 1.0) {\n    //     rayOriginUV = rayOriginUV + rayDirUV * diffSampleW.z - rayDirUV * invNumSteps * 0.5;\n    //     diffSampleW = vec3(0.0, sampleTime, 1.0);\n    //     rayDirUV *= invNumSteps;\n    //     depthTolerance *= invNumSteps;\n    //     SSR_RAY_UNROLLED()\n    // }\n\n    return vec4(rayOriginUV + rayDirUV * diffSampleW.z, 1.0 - diffSampleW.z);\n}\n\nvec4 fetchColorContribution(\n    in vec4 resRay,\n    const in float maskSsr,\n    const in vec3 specularEnvironment,\n    const in vec3 specularColor,\n    const in float roughness) {\n\n    // reprojection\n    vec4 AB = mix(uTaaCornersCSLeft[0], uTaaCornersCSLeft[1], resRay.x);\n    resRay.xyz = vec3(mix(AB.xy, AB.zw, resRay.y), 1.0) * -1.0 / resRay.z;\n    resRay.xyz = (uReprojectViewProj * vec4(resRay.xyz, 1.0)).xyw;\n    resRay.xy /= resRay.z;\n\n    // fade edge of screen\n    float maskEdge = clamp(6.0 - 6.0 * max(abs(resRay.x), abs(resRay.y)), 0.0, 1.0);\n\n    resRay.xy = 0.5 + 0.5 * resRay.xy;\n\n    vec3 fetchColor = specularColor * fetchColorLod(roughness * (1.0 - resRay.w), resRay.xy);\n\n    // fade ray count\n    // maskEdge *= resRay.w;\n\n    return vec4(mix(specularEnvironment, fetchColor, maskSsr * maskEdge), 1.0);\n}\n\nvec3 ssr(const in vec3 specularEnvironment, const in vec3 specularColor, const in float roughness, const in vec3 normal, const in vec3 eyeVector) {\n\n#if (defined(HAS_OPACITY_BLEND_OR_ADDITIVE) || defined(HAS_OPACITY_REFRACTION)) && !defined(HAS_SSR_TRANSPARENT)\n    // no ssr for transparent pxiels for now (mainly performance reason)\n    if (uDrawOpaque == 0) return specularEnvironment;\n#endif\n\n    vec4 result = vec4(0.0);\n\n    // precompute importance sampling roughness^4\n    float rough4 = roughness * roughness;\n    rough4 = rough4 * rough4;\n\n    // precompute importance sampling basis tangent\n    vec3 upVector = abs(normal.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangentX = normalize(cross(upVector, normal));\n    vec3 tangentY = cross(normal, tangentX);\n\n    // fade ray that points toward camera\n    float maskSsr = uSsrFactor * clamp(-4.0 * dot(eyeVector, normal) + 3.8, 0.0, 1.0);\n    maskSsr *= clamp(4.7 - roughness * 5.0, 0.0, 1.0); // fade out ssr for high roughness values\n\n    // compute ray uv origin\n    vec3 rayOriginUV = ssrViewToScreen(uProjectionMatrix, vViewVertex.xyz);\n    rayOriginUV.z = 1.0 / rayOriginUV.z;\n\n    // direction of reflection\n    vec3 rayDirView = unrealImportanceSampling(uFrameModTaaSS, tangentX, tangentY, normal, eyeVector, rough4);\n\n    // if reflection is toward us, we cast [near, vertex], otherwise [vertex, far]\n    float rayLen = mix(uNearFar.y + vViewVertex.z, -vViewVertex.z - uNearFar.x, rayDirView.z * 0.5 + 0.5);\n    float depthTolerance = 0.5 * rayLen;\n\n    // ray under the surface (normalmap or inverted normal)\n    if (dot(rayDirView, normal) > 0.001 && maskSsr > 0.0) {\n        vec4 resRay = rayTraceUnrealSimple(rayOriginUV, rayLen, depthTolerance, rayDirView, roughness, uFrameModTaaSS);\n        if (resRay.w > 0.0) result += fetchColorContribution(resRay, maskSsr, specularEnvironment, specularColor, roughness);\n    }\n\n    // if (uQuality > 0.4) {\n    //     for (int i = 1; i < 4; ++i) {\n    //         float frameRay = frameMod + float(i) * 50.0;\n    //         rayDirView = unrealImportanceSampling(frameRay, tangentX, tangentY, normal, eyeVector, rough4);\n    //         rayLen = mix(uNearFar.y + vViewVertex.z, -vViewVertex.z - uNearFar.x, rayDirView.z * 0.5 + 0.5);\n    //         depthTolerance = 0.5 * rayLen;\n\n    //         if (dot(rayDirView, normal) > 0.001) {\n    //             vec4 resRay = rayTraceUnrealSimple(rayOriginUV, rayLen, depthTolerance, rayDirView, roughness, frameRay);\n    //             if (resRay.w > 0.0) result += fetchColorContribution(resRay, maskSsr, specularEnvironment, specularColor, roughness);\n    //         }\n    //     }\n    // }\n\n    return result.w > 0.0 ? result.rgb / result.w : specularEnvironment;\n}\n'},I9Ql:e=>{"use strict";e.exports='#define MIN_ROUGHNESS 0.045\n\nuniform float uRGBMRange;\nuniform int uOutputLinear;\n\nvarying vec4 vViewVertex;\nvarying vec3 vViewNormal;\nvarying vec4 vColor;\n\nuniform float uNormalSign;\nuniform vec3 uAlbedo;\nuniform float uRoughness;\nuniform float uMetalness;\n\nvec3 lightDir = normalize(vec3(0.0, 0.3, 0.9));\nvec3 lightColor = vec3(0.7, 0.7, 0.9);\n\n#pragma include "utils/functions.glsl"\n\n#pragma include "utils/lightsPBR.glsl"\n\nvoid main() {\n    vec3 eyeVector = -normalize(vViewVertex.xyz);\n    vec3 materialNormal = uNormalSign * normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n\n    // material\n    float f0 = 0.04;\n    vec3 materialDiffuse = uAlbedo * vColor.r;\n    vec3 materialSpecular = mix(vec3(f0), materialDiffuse, uMetalness);\n    materialDiffuse *= 1.0 - uMetalness;\n    float materialRoughness = max(MIN_ROUGHNESS, uRoughness);\n    float materialF90 = clamp(50.0 * materialSpecular.g, 0.0, 1.0);\n\n    // precompute light\n    float attenuation, dotNL;\n    vec3 eyeLightDir;\n    bool lighted;\n    vec3 lightSpecular;\n    vec3 lightDiffuse;\n    vec4 prepGGX = precomputeGGX(materialNormal, eyeVector, materialRoughness);\n\n    // shading\n    attenuation = 1.0;\n    dotNL = dot(lightDir, materialNormal);\n    computeLightLambertGGX(materialNormal, eyeVector, dotNL, prepGGX, materialDiffuse, materialSpecular, attenuation, lightColor, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\n\n    vec3 frag = lightDiffuse + lightSpecular;\n    if (uOutputLinear != 1) frag = linearTosRGB(frag);\n    gl_FragColor = encodeRGBM(frag, uRGBMRange);\n}\n'},Ws5y:e=>{"use strict";e.exports='#define HAS_VERTEX_COLOR\n#define HAS_VIEW_VERTEX\n#define HAS_VIEW_NORMAL\n#pragma include "base.vert"\n'},"60rR":e=>{"use strict";e.exports='varying vec2 vLocalVertex;\n\nuniform float uAlpha;\nuniform int uOutputLinear;\nuniform vec3 uCursorColor;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uCursorColor, 1.0) * uAlpha * smoothstep(0.0, 1.0, 1.0 - 2.0 * length(vLocalVertex));\n\n  gl_FragColor = linearTosRGB(color);\n}\n'},xgxp:e=>{"use strict";e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vLocalVertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vLocalVertex = Vertex.xy;\n\n  vec3 posLocal = Vertex.xyz * 0.5;\n  posLocal += vec3(0.0, 0.0, 0.1);\n\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"},IOM8:e=>{"use strict";e.exports='uniform vec3 uColor;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * uAlpha * smoothstep(1.0, 0.0, pow(vHeight, 0.3));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},MdnG:e=>{"use strict";e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},uymv:e=>{"use strict";e.exports='#pragma include "utils/functions.glsl"\n#pragma include "utils/decodeDepth.glsl"\n\nvarying vec2 vTexCoord0;\n\nuniform sampler2D uTextureFloor;\nuniform float uScaleToMeter;\nuniform int uOutputLinear;\n\nvarying vec4 vViewPos;\nuniform vec2 uNearFar;\nuniform sampler2D uTextureDepth;\nuniform vec2 uGlobalTexSize;\nuniform vec2 uGlobalTexRatio;\n\nvoid main(void) {\n\n#ifndef DISPLAY_FLOOR\n  discard;\n#else\n\n  float distDepth = distanceToDepth(uTextureDepth, uGlobalTexRatio * gl_FragCoord.xy / uGlobalTexSize, vViewPos, uNearFar);\n  if (distDepth >= 0.0) discard;\n\n  float x = length(vTexCoord0 * 2.0 - 1.0);\n  x *= x;\n  float fade = smoothstep(0.0, 1.0, 1.0 - x * x);\n\n  float value = sRGBToLinear(texture2D(uTextureFloor, (vTexCoord0 * 1.0 - 0.5) * uScaleToMeter).r);\n  vec4 color = vec4(vec3(value), fade * max(0.8, value));\n  color.rgb *= color.a;\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n#endif\n}\n'},o0dJ:e=>{"use strict";e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = (uProjectionMatrix * vViewPos).xyww;\n}\n"},tkW9:e=>{"use strict";e.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTexturePanel;\nuniform vec4 uHoveredArea;\nuniform float uHoveredOpaque;\nuniform float uAlpha;\nuniform float uRatio;\nuniform float uRound;\nuniform float uVeilFactor;\n\n#pragma include "utils/functions.glsl"\n\n// signed distance to a 2D rounded box\nfloat sdRoundBox( const in vec2 p, const in vec2 b, const in float r ) {\n    vec2 q = abs(p) - b;\n    vec2 m = vec2( min(q.x,q.y), max(q.x,q.y) );\n    float d = (m.x > 0.0) ? length(q) : m.y;\n    return d - r;\n}\n\nvoid main(void) {\n  vec4 color = texture2D(uTexturePanel, vTexCoord0);\n\n  float lerpValue = step(0.0, -vTexCoord0.x);\n  lerpValue += step(1.0, vTexCoord0.x);\n\n  float round = uRound;\n  float left = uHoveredArea.x + round;\n  float right = uHoveredArea.y - round;\n  float top = uHoveredArea.z - round;\n  float bottom = uHoveredArea.w + round;\n\n  vec2 halfSize = abs(vec2(left - right, top - bottom) * 0.5);\n  vec2 center = vec2(halfSize.x + left, halfSize.y + bottom);\n\n  lerpValue += max(0.0, -sign(sdRoundBox( vTexCoord0 - center, halfSize, round)));\n\n  color.rgba = mix(color.rgba, color.rgba + vec4(0.109, 0.664, 0.848, step(0.1, uHoveredOpaque)), lerpValue);\n\n  color.a *= uAlpha;\n  color.rgb *= (color.a * uVeilFactor);\n\n  gl_FragColor = color;\n}\n'},wwK1:e=>{"use strict";e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\n\n// uniform mat4 uModelMatrix;\n// uniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n}\n"},FYHc:e=>{"use strict";e.exports='uniform vec3 uColor;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * smoothstep(1.0, 0.0, vHeight + 1.0);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},Onwk:e=>{"use strict";e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},Ma4s:e=>{"use strict";e.exports='varying vec3 vLocalVertex;\n\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n  vec4 color = linearTosRGB(vec4(0.1, 0.66, 0.85, 1.0)) * (smoothstep(1.0, 0.0, vLocalVertex.y) * smoothstep(1.0, 0.0, abs(vLocalVertex.x * 4.0))) * uAlpha;\n\n  gl_FragColor = color;\n}\n'},ND70:e=>{"use strict";e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void) {\n  vLocalVertex = Vertex;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},"pJ/q":e=>{"use strict";e.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureTeleportCircle;\nuniform float uScale;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\n#pragma include "utils/functions.glsl"\n\nvoid main(void) {\n  vec3 tex = sRGBToLinear(texture2D(uTextureTeleportCircle, vTexCoord0).rgb);\n  vec4 color = uScale == 1.0 ? vec4(tex.rrr, 1.0) * uAlpha * tex.g : vec4(uAlpha * tex.b);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},uCEv:e=>{"use strict";e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nuniform float uScale;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n\n  vec3 posLocal = Vertex.xyz * vec3(uScale, uScale, 1.0 - uScale);\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"},"m/Zu":e=>{"use strict";e.exports="uniform vec4 uColor;\n\nvoid main() {\n    gl_FragColor = vec4(uColor.rgb * uColor.a, uColor.a);\n}\n"},cvIH:e=>{"use strict";e.exports='#define WIREFRAME\n#pragma include "base.vert"\n'},zpE6:()=>{}},e=>{"use strict";return e.O(0,[3918,2698,8612,2928,7913,1377,9778,9278,7070,593,8408,5999,4244,3080,5105,9375,9794,4139,2417,4920,3453,9025,3655,3642,6418,9220,290,623,4522,9690,213,1835,9994,8578,9415,2902,5701,6111,2145,4679,3401],(()=>{return t="Heae6",e(e.s=t);var t})),e.O()}])}));